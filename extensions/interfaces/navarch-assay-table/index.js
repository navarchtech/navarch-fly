import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{defineComponent as a,ref as l,inject as o,watch as i,resolveComponent as s,resolveDirective as n,openBlock as r,createElementBlock as u,createCommentVNode as d,createBlock as m,withCtx as c,createVNode as v,createElementVNode as f,toDisplayString as y,withDirectives as p,normalizeClass as _,createTextVNode as g,pushScopeId as h,popScopeId as b}from"vue";var w={},$={},A={};let N;Object.defineProperty(A,"__esModule",{value:!0}),A.default=function(){if(!N&&(N="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!N))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(S)};const S=new Uint8Array(16);var U={},O={},I={};Object.defineProperty(I,"__esModule",{value:!0}),I.default=void 0;I.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Object.defineProperty(O,"__esModule",{value:!0}),O.default=void 0;var C,T=(C=I)&&C.__esModule?C:{default:C};var D=function(e){return"string"==typeof e&&T.default.test(e)};O.default=D,Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0,U.unsafeStringify=V;var E=function(e){return e&&e.__esModule?e:{default:e}}(O);const L=[];for(let e=0;e<256;++e)L.push((e+256).toString(16).slice(1));function V(e,t=0){return(L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]).toLowerCase()}var k=function(e,t=0){const a=V(e,t);if(!(0,E.default)(a))throw TypeError("Stringified UUID is invalid");return a};U.default=k,Object.defineProperty($,"__esModule",{value:!0}),$.default=void 0;var M=function(e){return e&&e.__esModule?e:{default:e}}(A),x=U;let R,P,H=0,F=0;var q=function(e,t,a){let l=t&&a||0;const o=t||new Array(16);let i=(e=e||{}).node||R,s=void 0!==e.clockseq?e.clockseq:P;if(null==i||null==s){const t=e.random||(e.rng||M.default)();null==i&&(i=R=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==s&&(s=P=16383&(t[6]<<8|t[7]))}let n=void 0!==e.msecs?e.msecs:Date.now(),r=void 0!==e.nsecs?e.nsecs:F+1;const u=n-H+(r-F)/1e4;if(u<0&&void 0===e.clockseq&&(s=s+1&16383),(u<0||n>H)&&void 0===e.nsecs&&(r=0),r>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");H=n,F=r,P=s,n+=122192928e5;const d=(1e4*(268435455&n)+r)%4294967296;o[l++]=d>>>24&255,o[l++]=d>>>16&255,o[l++]=d>>>8&255,o[l++]=255&d;const m=n/4294967296*1e4&268435455;o[l++]=m>>>8&255,o[l++]=255&m,o[l++]=m>>>24&15|16,o[l++]=m>>>16&255,o[l++]=s>>>8|128,o[l++]=255&s;for(let e=0;e<6;++e)o[l+e]=i[e];return t||(0,x.unsafeStringify)(o)};$.default=q;var j={},J={},B={};Object.defineProperty(B,"__esModule",{value:!0}),B.default=void 0;var W=function(e){return e&&e.__esModule?e:{default:e}}(O);var Y=function(e){if(!(0,W.default)(e))throw TypeError("Invalid UUID");let t;const a=new Uint8Array(16);return a[0]=(t=parseInt(e.slice(0,8),16))>>>24,a[1]=t>>>16&255,a[2]=t>>>8&255,a[3]=255&t,a[4]=(t=parseInt(e.slice(9,13),16))>>>8,a[5]=255&t,a[6]=(t=parseInt(e.slice(14,18),16))>>>8,a[7]=255&t,a[8]=(t=parseInt(e.slice(19,23),16))>>>8,a[9]=255&t,a[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,a[11]=t/4294967296&255,a[12]=t>>>24&255,a[13]=t>>>16&255,a[14]=t>>>8&255,a[15]=255&t,a};B.default=Y,Object.defineProperty(J,"__esModule",{value:!0}),J.URL=J.DNS=void 0,J.default=function(e,t,a){function l(e,l,o,i){var s;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let a=0;a<e.length;++a)t.push(e.charCodeAt(a));return t}(e)),"string"==typeof l&&(l=(0,K.default)(l)),16!==(null===(s=l)||void 0===s?void 0:s.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let n=new Uint8Array(16+e.length);if(n.set(l),n.set(e,l.length),n=a(n),n[6]=15&n[6]|t,n[8]=63&n[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=n[e];return o}return(0,G.unsafeStringify)(n)}try{l.name=e}catch(e){}return l.DNS=z,l.URL=Q,l};var G=U,K=function(e){return e&&e.__esModule?e:{default:e}}(B);const z="6ba7b810-9dad-11d1-80b4-00c04fd430c8";J.DNS=z;const Q="6ba7b811-9dad-11d1-80b4-00c04fd430c8";J.URL=Q;var X={};function Z(e){return 14+(e+64>>>9<<4)+1}function ee(e,t){const a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function te(e,t,a,l,o,i){return ee((s=ee(ee(t,e),ee(l,i)))<<(n=o)|s>>>32-n,a);var s,n}function ae(e,t,a,l,o,i,s){return te(t&a|~t&l,e,t,o,i,s)}function le(e,t,a,l,o,i,s){return te(t&l|a&~l,e,t,o,i,s)}function oe(e,t,a,l,o,i,s){return te(t^a^l,e,t,o,i,s)}function ie(e,t,a,l,o,i,s){return te(a^(t|~l),e,t,o,i,s)}Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var se=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let a=0;a<t.length;++a)e[a]=t.charCodeAt(a)}return function(e){const t=[],a=32*e.length,l="0123456789abcdef";for(let o=0;o<a;o+=8){const a=e[o>>5]>>>o%32&255,i=parseInt(l.charAt(a>>>4&15)+l.charAt(15&a),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[Z(t)-1]=t;let a=1732584193,l=-271733879,o=-1732584194,i=271733878;for(let t=0;t<e.length;t+=16){const s=a,n=l,r=o,u=i;a=ae(a,l,o,i,e[t],7,-680876936),i=ae(i,a,l,o,e[t+1],12,-389564586),o=ae(o,i,a,l,e[t+2],17,606105819),l=ae(l,o,i,a,e[t+3],22,-1044525330),a=ae(a,l,o,i,e[t+4],7,-176418897),i=ae(i,a,l,o,e[t+5],12,1200080426),o=ae(o,i,a,l,e[t+6],17,-1473231341),l=ae(l,o,i,a,e[t+7],22,-45705983),a=ae(a,l,o,i,e[t+8],7,1770035416),i=ae(i,a,l,o,e[t+9],12,-1958414417),o=ae(o,i,a,l,e[t+10],17,-42063),l=ae(l,o,i,a,e[t+11],22,-1990404162),a=ae(a,l,o,i,e[t+12],7,1804603682),i=ae(i,a,l,o,e[t+13],12,-40341101),o=ae(o,i,a,l,e[t+14],17,-1502002290),l=ae(l,o,i,a,e[t+15],22,1236535329),a=le(a,l,o,i,e[t+1],5,-165796510),i=le(i,a,l,o,e[t+6],9,-1069501632),o=le(o,i,a,l,e[t+11],14,643717713),l=le(l,o,i,a,e[t],20,-373897302),a=le(a,l,o,i,e[t+5],5,-701558691),i=le(i,a,l,o,e[t+10],9,38016083),o=le(o,i,a,l,e[t+15],14,-660478335),l=le(l,o,i,a,e[t+4],20,-405537848),a=le(a,l,o,i,e[t+9],5,568446438),i=le(i,a,l,o,e[t+14],9,-1019803690),o=le(o,i,a,l,e[t+3],14,-187363961),l=le(l,o,i,a,e[t+8],20,1163531501),a=le(a,l,o,i,e[t+13],5,-1444681467),i=le(i,a,l,o,e[t+2],9,-51403784),o=le(o,i,a,l,e[t+7],14,1735328473),l=le(l,o,i,a,e[t+12],20,-1926607734),a=oe(a,l,o,i,e[t+5],4,-378558),i=oe(i,a,l,o,e[t+8],11,-2022574463),o=oe(o,i,a,l,e[t+11],16,1839030562),l=oe(l,o,i,a,e[t+14],23,-35309556),a=oe(a,l,o,i,e[t+1],4,-1530992060),i=oe(i,a,l,o,e[t+4],11,1272893353),o=oe(o,i,a,l,e[t+7],16,-155497632),l=oe(l,o,i,a,e[t+10],23,-1094730640),a=oe(a,l,o,i,e[t+13],4,681279174),i=oe(i,a,l,o,e[t],11,-358537222),o=oe(o,i,a,l,e[t+3],16,-722521979),l=oe(l,o,i,a,e[t+6],23,76029189),a=oe(a,l,o,i,e[t+9],4,-640364487),i=oe(i,a,l,o,e[t+12],11,-421815835),o=oe(o,i,a,l,e[t+15],16,530742520),l=oe(l,o,i,a,e[t+2],23,-995338651),a=ie(a,l,o,i,e[t],6,-198630844),i=ie(i,a,l,o,e[t+7],10,1126891415),o=ie(o,i,a,l,e[t+14],15,-1416354905),l=ie(l,o,i,a,e[t+5],21,-57434055),a=ie(a,l,o,i,e[t+12],6,1700485571),i=ie(i,a,l,o,e[t+3],10,-1894986606),o=ie(o,i,a,l,e[t+10],15,-1051523),l=ie(l,o,i,a,e[t+1],21,-2054922799),a=ie(a,l,o,i,e[t+8],6,1873313359),i=ie(i,a,l,o,e[t+15],10,-30611744),o=ie(o,i,a,l,e[t+6],15,-1560198380),l=ie(l,o,i,a,e[t+13],21,1309151649),a=ie(a,l,o,i,e[t+4],6,-145523070),i=ie(i,a,l,o,e[t+11],10,-1120210379),o=ie(o,i,a,l,e[t+2],15,718787259),l=ie(l,o,i,a,e[t+9],21,-343485551),a=ee(a,s),l=ee(l,n),o=ee(o,r),i=ee(i,u)}return[a,l,o,i]}(function(e){if(0===e.length)return[];const t=8*e.length,a=new Uint32Array(Z(t));for(let l=0;l<t;l+=8)a[l>>5]|=(255&e[l/8])<<l%32;return a}(e),8*e.length))};X.default=se,Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var ne=ue(J),re=ue(X);function ue(e){return e&&e.__esModule?e:{default:e}}var de=(0,ne.default)("v3",48,re.default);j.default=de;var me={},ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.default=void 0;var ve={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};ce.default=ve,Object.defineProperty(me,"__esModule",{value:!0}),me.default=void 0;var fe=_e(ce),ye=_e(A),pe=U;function _e(e){return e&&e.__esModule?e:{default:e}}var ge=function(e,t,a){if(fe.default.randomUUID&&!t&&!e)return fe.default.randomUUID();const l=(e=e||{}).random||(e.rng||ye.default)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=l[e];return t}return(0,pe.unsafeStringify)(l)};me.default=ge;var he={},be={};function we(e,t,a,l){switch(e){case 0:return t&a^~t&l;case 1:case 3:return t^a^l;case 2:return t&a^t&l^a&l}}function $e(e,t){return e<<t|e>>>32-t}Object.defineProperty(be,"__esModule",{value:!0}),be.default=void 0;var Ae=function(e){const t=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let a=0;a<t.length;++a)e.push(t.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const l=e.length/4+2,o=Math.ceil(l/16),i=new Array(o);for(let t=0;t<o;++t){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=e[64*t+4*l]<<24|e[64*t+4*l+1]<<16|e[64*t+4*l+2]<<8|e[64*t+4*l+3];i[t]=a}i[o-1][14]=8*(e.length-1)/Math.pow(2,32),i[o-1][14]=Math.floor(i[o-1][14]),i[o-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<o;++e){const l=new Uint32Array(80);for(let t=0;t<16;++t)l[t]=i[e][t];for(let e=16;e<80;++e)l[e]=$e(l[e-3]^l[e-8]^l[e-14]^l[e-16],1);let o=a[0],s=a[1],n=a[2],r=a[3],u=a[4];for(let e=0;e<80;++e){const a=Math.floor(e/20),i=$e(o,5)+we(a,s,n,r)+u+t[a]+l[e]>>>0;u=r,r=n,n=$e(s,30)>>>0,s=o,o=i}a[0]=a[0]+o>>>0,a[1]=a[1]+s>>>0,a[2]=a[2]+n>>>0,a[3]=a[3]+r>>>0,a[4]=a[4]+u>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]};be.default=Ae,Object.defineProperty(he,"__esModule",{value:!0}),he.default=void 0;var Ne=Ue(J),Se=Ue(be);function Ue(e){return e&&e.__esModule?e:{default:e}}var Oe=(0,Ne.default)("v5",80,Se.default);he.default=Oe;var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;Ie.default="00000000-0000-0000-0000-000000000000";var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;var Te=function(e){return e&&e.__esModule?e:{default:e}}(O);var De,Ee,Le,Ve,ke=function(e){if(!(0,Te.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)};Ce.default=ke,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return s.default}});var t=d($),a=d(j),l=d(me),o=d(he),i=d(Ie),s=d(Ce),n=d(O),r=d(U),u=d(B);function d(e){return e&&e.__esModule?e:{default:e}}}(w),function(e){e.INTURN="Inturn",e.INTURN_FINAL="Inturn Final",e.OUTTURN="Outturn",e.ESTIMATED="Estimated",e.PLANNED="Planned"}(De||(De={})),function(e){e.SELLER="Seller",e.BUYER="Buyer",e.SPLIT="Split"}(Ee||(Ee={})),function(e){e.AVG_WITH_MIDDLE_ASSAY_AS_FINAL_FOR_ARBITRATION="AVG_WITH_MIDDLE_ASSAY_AS_FINAL_FOR_ARBITRATION",e.AVG_WITH_AVG_OF_UMPIRE_AND_CLOSEST_AS_FINAL_FOR_ARBITRATION="AVG_WITH_AVG_OF_UMPIRE_AND_CLOSEST_AS_FINAL_FOR_ARBITRATION"}(Le||(Le={})),function(e){e[e.DRY_WEIGHT=0]="DRY_WEIGHT",e[e.DRY_WEIGHT_UOM=1]="DRY_WEIGHT_UOM",e[e.SELLER_ASSAY=2]="SELLER_ASSAY",e[e.BUYER_ASSAY=3]="BUYER_ASSAY",e[e.DIFFERENCE=4]="DIFFERENCE",e[e.SPLITTING_LIMIT=5]="SPLITTING_LIMIT",e[e.TO_UMPIRE=6]="TO_UMPIRE",e[e.UMPIRE_NAME=7]="UMPIRE_NAME",e[e.UMPIRE_ASSAY=8]="UMPIRE_ASSAY",e[e.LOSING_PARTY=9]="LOSING_PARTY",e[e.FINAL_ASSAY=10]="FINAL_ASSAY"}(Ve||(Ve={}));var Me=a({props:{value:{type:String,default:null}},emits:["input"],setup(t,{attrs:a,emit:s}){const n=l([{text:"Commodity",value:"commodity_name",sortable:!1,width:150,align:"left"},{text:"Seller Assay",value:"seller_assay",sortable:!1,width:150,align:"left"},{text:"Buyer Assay",value:"buyer_assay",sortable:!1,width:150,align:"left"},{text:"Difference",value:"difference",sortable:!1,width:150,align:"left"},{text:"Splitting Limit",value:"splitting_limit",sortable:!1,width:150,align:"left"},{text:"To Umpire",value:"to_umpire",sortable:!1,width:60,align:"left"},{text:"Umpire Name",value:"umpire_name",sortable:!1,width:150,align:"left"},{text:"Umpire Assay",value:"umpire_assay",sortable:!1,width:150,align:"left"},{text:"Losing Party",value:"losing_party",sortable:!1,width:150,align:"left"},{text:"Final Assay",value:"final_assay",sortable:!1,width:150,align:"left"}]),r=l([{text:"To Delete",value:"delete",sortable:!1,width:60,align:"left"},{text:"Lot",value:"lot_number",sortable:!1,width:60,align:"left"},{text:"Dry Weight",value:"dry_weight",sortable:!1,width:150,align:"left"},{text:"Seller Assay",value:"seller_assay",sortable:!1,width:150,align:"left"},{text:"Buyer Assay",value:"buyer_assay",sortable:!1,width:150,align:"left"},{text:"Difference",value:"difference",sortable:!1,width:150,align:"left"},{text:"To Umpire",value:"to_umpire",sortable:!1,width:60,align:"center"},{text:"Umpire Name",value:"umpire_name",sortable:!1,width:150,align:"left"},{text:"Umpire Assay",value:"umpire_assay",sortable:!1,width:150,align:"left"},{text:"Losing Party",value:"losing_party",sortable:!1,width:150,align:"left"},{text:"Final Assay",value:"final_assay",sortable:!1,width:150,align:"left"}]),u=l(null),d=l([]),m=e(),c="navarch_unit",v="symbol",f="dry_symbol",y="navarch_assay_unit",p="description",_="unit",g="navarch_assay_lot",h="navarch_weight_lot",b="lot_number",$="dry_weight",A="method",N="navarch_contract",S="weight_uom",U="umpire_when_equal",O="final_assay_equation",I="methods",C="navarch_commodity_in_contract",T="commodity",D="primary_commodity",E="splitting_limit",L="splitting_limit_unit",V="navarch_commodity",k="name",M="code",x="foreign_key",R="contract",P="INVALID_ID",H="-- Deselect method --",F="-- Select a method --",q="assay_results",j="weight_result",J=l([]),B=l([]),W=l(!0),Y=l([]),G=l(!0),K=l([]),z=l(!0),Q=l([]),X=l(!0),Z=l([]),ee=l(!0),te=l(-1),ae=l([]),le=l([]),oe=l({}),ie=l([]),se=l([]),ne=l(void 0),re=l(void 0),ue=l(void 0),de=l(void 0),me=l(void 0),ce=l(!1),ve=l(void 0),fe=l(void 0),ye=l(void 0),pe=l(void 0),_e=l(void 0),ge=l(void 0),he=l(void 0),be=l(void 0),we=l(!u.value),$e=o("values",l({}));let Ae=$e.value[q];Ae||(Ae=w.v4(),console.log(`[setup] key generated for assay lots=${Ae}`));const Ne=l(void 0),Se=l([]);(async function(){return(await Ce(c,[v])).map((e=>({text:e[v],value:e[v]})))})().then((e=>{Se.value=e}));const Ue=l([]);(async function(){return(await Ce(y,[p,_])).map((e=>({text:`${e[p]} - ${e[_]}`,value:e[_]})))})().then((e=>{Ue.value=e}));const Oe=l({});m.get(`/items/${g}?filter[${x}]=${Ae}&sort[]=lot_number`).then((async e=>{console.log(`assay lots successfully fetched: ${JSON.stringify(e.data.data)}`);const t=e.data.data.map((e=>e.commodity)).filter(((e,t,a)=>a.indexOf(e)===t));if(t.length>0){const e=t.map(((e,t)=>`filter[_or][${t}][code]=${e}`)).join("&"),a=await m.get(`/items/${V}?${e}`,{params:{fields:["name","code"]}});console.log(`commodity mapping response: ${JSON.stringify(a.data.data)}`),Oe.value=a.data.data.reduce(((e,t)=>(e[t.code]=t.name,e)),{}),console.log(`commodity code to name mapping: ${JSON.stringify(Oe.value)}`)}J.value=je(e.data.data,Oe.value)})).catch((e=>console.log(`fetching the assay lots went wrong due to: ${e}`)));const Ie=l("");async function Ce(e,t){return(await m.get(`/items/${e}`,{params:{fields:t}})).data.data}async function Te(e){if(console.log(`weight lots foreign key: ${e} in form values: ${JSON.stringify($e.value)}`),e)try{const t=await m.get(`/items/${h}?filter[${x}]=${e}&sort[]=${b}`,{params:{fields:[b,$,A]}});console.log(`weight lots successfully fetched in assay results interface: ${JSON.stringify(t.data.data)}`),d.value=t.data.data}catch(e){console.log(`fetching the weight lots went wrong due to: ${e}`)}}function Ve(e){if(!e)throw new Error("commodity in contract data response is null");if(!e[T])throw new Error(`commodity in contract data response '${T}'=${e[T]} is undefined`);if(!e[E]||isNaN(Number(e[E])))throw new Error(`commodity in contract data response '${E}'=${e[E]} is undefined or cannot be converted to a number`);if(!e[L])throw new Error(`commodity in contract data response '${L}'=${e[L]} is undefined`)}function ke(e){if(!e)throw new Error("commodity data response is null");if(!e[k])throw new Error(`commodity data response '${k}'=${e[k]} is undefined`);if(!e[M])throw new Error(`commodity data response 'code'=${e[M]} is undefined`)}i((()=>$e.value[j]),(async e=>{e&&e!==Ie.value&&(console.log(`[setup assay lots] weight lots foreign key watcher: ${e}`),Ie.value=e,await Te(Ie.value))}),{immediate:!0}),i((()=>$e.value[R]),(async e=>{await async function(e){if(!e)return u.value=null,void console.log(`contract data cleared in assay results interface; contractData: ${JSON.stringify(u.value)}`);try{const t=await m.get(`/items/${N}/${e}`,{params:{fields:[S,U,O,I]}});console.log(`contract data successfully fetched in assay results interface: ${JSON.stringify(t.data.data)}`);const a=t.data.data;!function(e){if(!e)throw new Error("contract data response is null");if(!e[S])throw new Error(`contract data response '${S}'=${e[S]} is undefined`);if(!e[I])throw new Error(`contract data response '${I}'=${e[I]} is undefined`);if(void 0===e[U]||null===e[U]||"boolean"!=typeof e[U])throw new Error(`contract data response '${U}'=${e[U]} is undefined or cannot be converted to a boolean`);if(!e[O]||!Object.values(Le).includes(e[O]))throw new Error(`contract data response '${O}'=${e[O]} is undefined or cannot be converted to type FinalAssayEquation`)}(a);const l=await m.get(`/items/${c}/${a[S]}`,{params:{fields:[f]}});!function(e){if(!e)throw new Error("dry weight uom response is null");if(!e[f])throw new Error(`dry weight uom response '${f}'=${e[f]} is undefined`)}(l.data.data);const o=await m.get(`/items/${C}?filter[${R}]=${e}`,{params:{fields:[T,D,E,L]}});console.log(`[getContractData] commodity in contract response: ${JSON.stringify(o.data.data)}`),function(e){if(!e||!Array.isArray(e))throw new Error(`commodities in contract data response=${JSON.stringify(e)} is null or not of type array`);for(const t of e)Ve(t)}(o.data.data);const i=[];for(const e of o.data.data){const t=await m.get(`/items/${V}/${e.commodity}`,{params:{fields:[k,M]}});ke(t.data.data);const a={name:t.data.data[k],code:t.data.data[M],isPrimaryCommodity:e[D],splittingLimit:e[E],splittingLimitUOM:e[L]};i.push(a)}u.value={commodities:null!=i?i:[],dryWeightUOM:l.data.data[f],methods:a[I],umpires:[],umpireArbitrationWhenSLEqualsDiff:a[U],finalAssayEquation:a[O]},console.log(`contract data: ${JSON.stringify(u.value)}`)}catch(e){console.error(`fetching the contract data went wrong due to: ${e}`)}}(e),function(){if(console.log("[assignMethodSelectionRef]"),!u.value)return console.error("contract data is not defined"),void(st.value=[]);const e={text:F,value:void 0};console.log(`[assignMethodSelectionRef] contractData=${JSON.stringify(u.value)}`),st.value=[e,...u.value[I].map((e=>({text:e,value:e})))],console.log(`[assignMethodSelectionRef] allMethodSelection=${JSON.stringify(st.value)}`),nt.value=[...st.value]}()}),{immediate:!0});const Me=l(!1);function xe(){const e=w.v4(),t={id:e,foreign_key:Ae,lot_number:ae.value.length+1,commodity:J.value[te.value].commodity,method:J.value[te.value].method};console.log(`[addNewAssayLot] Adding new lot ${t} with generated id=${e}`),ae.value.push(t),ie.value.push(e),console.log(`[addNewAssayLot] Adding new row to assay lots and now has ${ae.value.length} rows`)}async function Re(e,t){if(t.assay_uom||t.dry_weight_uom||void 0!==t.splitting_limit)try{const a=ae.value.map((e=>e.id)).filter((e=>void 0!==e)),l=await async function(e,t,a){if(!a.assay_uom&&!a.dry_weight_uom&&void 0===a.splitting_limit)return void console.log("Properties to batch update are undefined, there are no properties to update");try{m.patch(`/items/${e}?sort[]=lot_number`,{keys:t,data:a}).then((e=>(console.log("[batchUpdateAssays] batch update of assays success"),e.data.data)))}catch(e){console.error(`[batchUpdateAssays] batch update of assays with foreign_key=${Ae} failed with reason: '${e}'`)}}(e,a,t);console.log("batch update of lots success"),ae.value=l,J.value[te.value].lots=ae.value}catch(e){console.log(`batch update of lots with foreign_key=${Ae} failed with reason: '${e}'`)}else console.log("Properties to batch update are undefined, there are no properties to update")}async function Pe(e,t){try{const a=await m.post(`/items/${e}`,t);console.log(`[createComposite] Composite item successfully created with response=${JSON.stringify(a.data.data)}`);const l=Je(a.data.data,Oe.value);null!==l?(console.log(`[createComposite] Assays before adding new one=${J.value}`),J.value.push(l),console.log(`[createComposite] Assay calculated and set to=${JSON.stringify(l)} in ${JSON.stringify(J.value)}}`)):console.log(`[createComposite] Assay could not be calculated for newly created composite item with foreign_key=${t.foreign_key} and id=${a.data.data.id}`)}catch(e){console.log(`[createComposite] creation of composite item with foreign_key=${t.foreign_key} failed with reason: '${e}'`)}}async function He(e,t){if(0!=t.length)try{const a=await m.delete(`/items/${e}`,{data:t});if(204!==a.status)throw new Error(`response status=${a.status} is not 204`);console.log(`Item successfully deleted with response status=${a.status}`),ae.value=ae.value.filter((e=>{var a;return!t.includes(null!==(a=e.id)&&void 0!==a?a:"INVALID_ID")})),console.log(`remaining assay lots by ids=${JSON.stringify(ae.value.map((e=>e.id)))} vs data=${JSON.stringify(t)}`);const l=ae.value.map(((e,t)=>({id:e.id,lot_number:t+1}))),o=await m.patch(`/items/${g}?sort[]=lot_number`,l);ae.value=o.data.data}catch(e){console.log(`deletion of lots with ids=${t} failed with reason: '${e}'`)}else console.log("no lot items to be deleted")}async function Fe(e){if(ie.value.forEach((e=>{const t=le.value.findIndex((t=>t===e));-1!==t&&le.value.splice(t,1)})),se.value.forEach((e=>{const t=ie.value.findIndex((t=>t===e));-1!==t&&ie.value.splice(t,1)})),se.value.forEach((e=>{const t=le.value.findIndex((t=>t===e));-1!==t&&le.value.splice(t,1)})),console.log("[saveAssayLots] synced staged changes"),0!==ie.value.length){const t=ae.value.filter((e=>{var t;return ie.value.includes(null!==(t=e.id)&&void 0!==t?t:P)})).map((e=>({...e,assay_uom:de.value,dry_weight_uom:Ne.value,splitting_limit:me.value})));console.log(`Creating new lots; ${t.length} number of lots to be created`),await async function(e,t){if(0!=t.length)try{const a=await m.post(`/items/${e}?sort[]=lot_number`,t);console.log(`Item successfully created with response=${JSON.stringify(a.data.data)} to be updated to display assays=${JSON.stringify(ae.value)}`);for(const e of a.data.data){const t=ae.value.findIndex((t=>t.id===e.id));console.log(`Item with id=${e.id} has been created to local assay lot array with index=${t}`),ae.value[t]=e}}catch(e){console.log(`creation of lots with foreign_key=${Ae} failed with reason: '${e}'`)}else console.log("no new lot items to be created")}(e,t)}let t=!1;de.value!==J.value[te.value].assay_uom&&(console.log("batch update required for assay_uom"),t=!0,oe.value.assay_uom=de.value),Ne.value!==J.value[te.value].dry_weight_uom&&(console.log("batch update required for dry_weight_uom"),t=!0,oe.value.dry_weight_uom=Ne.value),me.value!==J.value[te.value].splitting_limit&&(console.log("batch update required for splitting_limit"),t=!0,oe.value.splitting_limit=me.value),t&&(console.log("batch update required with properties: ",oe.value),await Re(e,oe.value)),0!==le.value.length&&await async function(){if(-1===te.value)return void console.log("no assay selected, aborting update");if(0===le.value.length)return;const e=le.value.map((e=>ae.value.find((t=>t.id===e))));console.log(`updating lots=${JSON.stringify(e)}`);try{if(!ze(J.value[te.value])){const t=await m.patch(`/items/${g}`,e);console.log(`lot data successfully patched with response id='${t.data.data.id}'`);for(const e of t.data.data){const t=ae.value.findIndex((t=>t.id===e.id));ae.value[t]=e}J.value[te.value].lots=ae.value}}catch(e){console.log(`patching for lots=${JSON.stringify(le.value)} failed with reason: '${e}'`)}}(),await He(e,se.value),J.value[te.value].lots=ae.value,console.log(`display assays=${JSON.stringify(ae.value)} vs assay lots=${JSON.stringify(J.value[te.value].lots)}`);const a=je(J.value[te.value].lots,Oe.value);a.length<=0?(console.log("evaluated assay lot data is empty, removing assay from assays list"),J.value.splice(te.value,1)):(console.log(`evaluated assay lot data is ${JSON.stringify(a[0])}`),J.value[te.value]=a[0])}async function qe(){if(Me.value&&ue.value&&re.value){const e={foreign_key:Ae,dry_weight:fe.value,dry_weight_uom:Ne.value,assay_uom:de.value,seller_assay:ye.value,buyer_assay:pe.value,difference:_e.value,splitting_limit:me.value,to_umpire:ce.value,umpire_name:ve.value,umpire_assay:he.value,losing_party:be.value,final_assay:ge.value,commodity:ue.value,method:re.value};return e.id=w.v4(),await Pe(g,e),void 0!==$e.value[q]&&null!==$e.value[q]||(console.log(`[save] emitting input event with assay lot foreign_key=${Ae}`),s("input",Ae)),void ot()}if(-1===te.value)return console.log("No assay selected. Nothing else to save"),void ot();if(ze(J.value[te.value])||it.value){if(ze(J.value[te.value])&&it.value){if(ue.value&&re.value){const e={foreign_key:Ae,dry_weight:fe.value,dry_weight_uom:Ne.value,assay_uom:de.value,seller_assay:ye.value,buyer_assay:pe.value,difference:_e.value,splitting_limit:me.value,to_umpire:ce.value,umpire_name:ve.value,umpire_assay:he.value,losing_party:be.value,final_assay:ge.value,commodity:ue.value,method:re.value};e.id=ne.value,await async function(e,t){const{id:a,foreign_key:l,...o}=t;try{const l=await m.patch(`/items/${e}/${a}`,o);console.log(`composite lot data successfully patched with response id='${l.data.data.id}'`),J.value[te.value].composite=l.data.data;const i=Je(J.value[te.value].composite,Oe.value);null!==i?(J.value[te.value]=i,console.log(`Assay recalculated and set to=${JSON.stringify(J.value[te.value])}`)):console.log(`Assay could not be recalculated for the composite item with foreign_key=${t.foreign_key} and id=${l.data.data.id}`)}catch(e){console.log(`patching for composite lot=${a} with foreign_key=${l} failed with reason: '${e}'`)}}(g,e)}}else if(ze(J.value[te.value])&&!it.value)await Fe(g);else if(!ze(J.value[te.value])&&it.value){if(ue.value&&re.value){const e={foreign_key:Ae,dry_weight:fe.value,dry_weight_uom:Ne.value,assay_uom:de.value,seller_assay:ye.value,buyer_assay:pe.value,difference:_e.value,splitting_limit:me.value,to_umpire:ce.value,umpire_name:ve.value,umpire_assay:he.value,losing_party:be.value,final_assay:ge.value,commodity:ue.value,method:re.value};e.id=w.v4(),await Pe(g,e)}await He(g,ae.value.map((e=>e.id)).filter((e=>void 0!==e)))}}else await Fe(g);ot()}function je(e,t){const a=[];if(!e)return a;const l=function(e){const t={Planned:{},Estimated:{},Inturn:{},"Inturn Final":{},Outturn:{}};return e.forEach((e=>{var a;t[e.method]||(t[e.method]={}),t[e.method][e.commodity]?null===(a=t[e.method][e.commodity])||void 0===a||a.push(e):t[e.method][e.commodity]=[e]})),[...Object.values(t.Planned),...Object.values(t.Estimated),...Object.values(t.Inturn),...Object.values(t["Inturn Final"]),...Object.values(t.Outturn)]}(e);let o=null;for(const e of l)o=1!==e.length||Ke(e[0])?Be(e,t):Je(e[0],t),null!=o&&a.push(o);return a}function Je(e,t){var a,l,o;if(!e)return null;console.log(`[evaluateAssayDataForComposite] commodity name=${t[e.commodity]} for commodity=${e.commodity}`);return{assay_id:Ge(e),method:e.method,commodity:e.commodity,commodity_name:null!==(a=t[e.commodity])&&void 0!==a?a:e.commodity,assay_uom:e.assay_uom,dry_weight_uom:e.dry_weight_uom,seller_assay:e.seller_assay,buyer_assay:e.buyer_assay,difference:e.difference,splitting_limit:e.splitting_limit,to_umpire:e.to_umpire,umpire_name:e.umpire_name,umpire_assay:e.umpire_assay,losing_party:e.losing_party,final_assay:e.final_assay,total_dry_weight:null!==(l=e.dry_weight)&&void 0!==l?l:0,total_arbitrated_dry_weight:e.to_umpire&&null!==(o=e.dry_weight)&&void 0!==o?o:0,composite:e,lots:[]}}function Be(e,t){var a;if(!e)return null;const l=e.find((e=>!("lot_number"in e))),o=e.filter(Ke).filter((e=>!(null==e)));if(0===o.length)return null;const i=o[0];console.log(`[evaluateAssayDataForLots] commodity name=${t[i.commodity]} for commodity=${i.commodity}`);let s={assay_id:Ge(i),dry_weight_uom:i.dry_weight_uom,method:i.method,commodity:i.commodity,commodity_name:null!==(a=t[i.commodity])&&void 0!==a?a:i.commodity,assay_uom:i.assay_uom,seller_assay:0,buyer_assay:0,difference:0,splitting_limit:i.splitting_limit,final_assay:0,to_umpire:!1,total_dry_weight:0,total_arbitrated_dry_weight:0,composite:l,lots:o};o.forEach((e=>{s.buyer_assay=We(s.buyer_assay)+We(e.buyer_assay)*We(e.dry_weight),s.difference=We(s.difference)+We(e.difference)*We(e.dry_weight),s.final_assay=We(s.final_assay)+We(e.final_assay)*We(e.dry_weight),s.seller_assay=We(s.seller_assay)+We(e.seller_assay)*We(e.dry_weight),s.to_umpire=Ye(s.to_umpire)||Ye(e.to_umpire),e.to_umpire&&(s.umpire_assay=We(s.umpire_assay)+We(e.umpire_assay)*We(e.dry_weight),s.total_arbitrated_dry_weight+=We(e.dry_weight)),s.total_dry_weight+=We(e.dry_weight)})),s.buyer_assay=We(s.buyer_assay)/s.total_dry_weight,s.seller_assay=We(s.seller_assay)/s.total_dry_weight,s.to_umpire&&(s.umpire_assay=We(s.umpire_assay)/s.total_arbitrated_dry_weight),s.final_assay=We(s.final_assay)/s.total_dry_weight,s.difference=We(s.difference)/s.total_dry_weight;const n=o.filter((e=>e.losing_party===Ee.BUYER)).length,r=o.filter((e=>e.losing_party===Ee.SELLER)).length;return 0===r&&0===n||(s.losing_party=r>n?Ee.SELLER:r<n?Ee.BUYER:Ee.SPLIT),s}function We(e,t){return!e||Number.isNaN(e)?null!=t?t:0:e}function Ye(e,t){return null==e?null!=t&&t:e}function Ge(e){return`${e.method}-${e.commodity}-${Ae}`}function Ke(e){return!!e&&!(!("lot_number"in e)||!e.lot_number)}function ze(e){return 0===e.lots.length}function Qe(e,t){if(e&&t)return e-t}function Xe(e,t,a){if(!a||!e||!t)return;const l=Math.abs(e-a),o=Math.abs(t-a);return l>o?Ee.SELLER:o>l?Ee.BUYER:Ee.SPLIT}function Ze(e,t,a,l,o,i){if(e&&t&&!l)return(e+t)/2;if(e&&t&&l){if(!a)return(e+t)/2;if(i===Le.AVG_WITH_MIDDLE_ASSAY_AS_FINAL_FOR_ARBITRATION)return[a,e,t].sort(((e,t)=>e-t))[1];if(i===Le.AVG_WITH_AVG_OF_UMPIRE_AND_CLOSEST_AS_FINAL_FOR_ARBITRATION){if(void 0===o&&(o=Xe(e,t,a)),o===Ee.SPLIT)return[a,e,t].sort(((e,t)=>e-t))[1];if(o===Ee.SELLER)return(a+t)/2;if(o===Ee.BUYER)return(a+e)/2}}}async function et(){if(console.log("[onCompositeToggle]"),!it.value&&-1!==te.value&&ze(J.value[te.value])){dt.value=[J.value[te.value]];const e=J.value[te.value].method;if(await Te(Ie.value),d.value.filter((t=>t.method===e.toString())).length===ae.value.length)return void console.log(`[onCompositeToggle] ${ae.value.length} lot(s) already exist for assay lots, most likely due to the composite toggle being clicked multiple times, no need to add more lots`);const t=d.value.filter((t=>t.method===e.toString())).map((e=>e.dry_weight));for(const e of t)xe(),ae.value[ae.value.length-1].dry_weight=e,ae.value[ae.value.length-1].dry_weight_uom=Ne.value,ae.value[ae.value.length-1].splitting_limit=me.value,ae.value[ae.value.length-1].assay_uom=de.value;console.log("[onCompositeToggle] assayLotsToDisplay: ",ae.value)}}let tt,at;const lt=l(!1);function ot(){console.log(`Toggle drawer: ${lt.value} -> ${!lt.value}`),lt.value=!lt.value,lt.value||(ae.value=[],le.value=[],ie.value=[],se.value=[],dt.value=[],te.value=-1,Me.value=!1,ne.value=void 0,fe.value=void 0,Ne.value=void 0,de.value=void 0,ye.value=void 0,pe.value=void 0,_e.value=void 0,me.value=void 0,ce.value=!1,ve.value=void 0,he.value=void 0,be.value=void 0,ge.value=void 0,ue.value=void 0,re.value=void 0,it.value=!0)}const it=l(!0),st=l([]),nt=l([]),rt=l(u.value?[{text:"-- Select an commodity --",value:void 0},...u.value.commodities.map((e=>({text:`${e.name} (${e.code})`,value:e.code})))]:[]),ut=l([...rt.value]);i(u,(e=>{we.value=!e,e&&(rt.value=[{text:"-- Select an commodity --",value:void 0},...e.commodities.map((e=>({text:`${e.name} (${e.code})`,value:e.code})))],ut.value=[...rt.value])}),{immediate:!0});const dt=l([]),mt=l(!1);const ct=l(!1);function vt(){ct.value=!1}function ft(){vt(),ot()}const yt=l(!1);function pt(){yt.value=!1}function _t(){pt(),qe()}const gt=l(!1);function ht(){gt.value=!1}return i(it,et),i(re,(function(){if(console.log("[onMethodSelected] running"),!Me.value)return void console.log("[onMethodSelected] is not adding new assay, returning");console.log(`[onMethodSelected] assays for selected method=${JSON.stringify(J.value.find((e=>e.method===re.value)))}`);const e=J.value.filter((e=>e.method===re.value)).map((e=>e.commodity));ut.value=[...rt.value.filter((t=>!e.includes(t.value)))],0===ut.value.length&&(ut.value=[{text:"-- All commodities for this method have existing assays --",value:void 0}]),re.value?nt.value[0].text=H:nt.value[0].text=F,fe.value=d.value.filter((e=>e.method===re.value)).reduce(((e,t)=>{var a;return e+(null!==(a=t.dry_weight)&&void 0!==a?a:0)}),0),console.log(`[onMethodSelected] compositeItemWeight=${fe.value}`)})),i(ue,(function(){if(console.log("onCommoditySelected() is running"),!Me.value)return void console.log("is not adding new assay, returning");if(!u.value)return void console.error("contract data is not defined");console.log(`assays for selected commodity=${JSON.stringify(J.value.find((e=>e.commodity===ue.value)))}`);const e=J.value.filter((e=>e.commodity===ue.value)).map((e=>e.method));nt.value=[...st.value.filter((t=>!t.value||!e.includes(t.value)))],0===nt.value.length&&(nt.value=[{text:"-- All methods for this commodity have existing assays --",value:void 0}]),ue.value?ut.value[0].text="-- Deselect commodity --":ut.value[0].text="-- Select a commodity --";const t=u.value.commodities.findIndex((e=>e.code===ue.value));t>=0&&(me.value=u.value.commodities[t].splittingLimit,de.value=u.value.commodities[t].splittingLimitUOM,Ne.value=u.value.dryWeightUOM)})),i([ye,pe],(function(){var e;u.value?(_e.value=Qe(ye.value,pe.value),be.value=Xe(ye.value,pe.value,he.value),ge.value=null!==(e=Ze(ye.value,pe.value,he.value,ce.value,be.value,u.value.finalAssayEquation))&&void 0!==e?e:0):console.error("contract data is not defined")})),i([_e],(function(){var e;if(!u.value)return void console.error("contract data is not defined");if(!_e.value||!me.value)return void console.log("composite difference or splitting limit is undefined");let t=!1;Math.abs(_e.value)>me.value&&!ce.value?(console.log("lot difference is greater than splitting limit"),ce.value=!0,t=!0):Math.abs(_e.value)<me.value&&ce.value?(console.log("lot difference is less than to splitting limit"),ce.value=!1,t=!0):Math.abs(_e.value)===me.value&&!ce.value&&u.value.umpireArbitrationWhenSLEqualsDiff?(console.log("lot difference is equal to splitting limit"),ce.value=!0,t=!0):Math.abs(_e.value)===me.value&&ce.value&&!u.value.umpireArbitrationWhenSLEqualsDiff&&(console.log("lot difference is equal to splitting limit"),ce.value=!1,t=!0),t&&(ce.value||(he.value=void 0,ve.value=void 0,be.value=void 0),ge.value=null!==(e=Ze(ye.value,pe.value,he.value,ce.value,be.value,u.value.finalAssayEquation))&&void 0!==e?e:0)})),i([ce,he],(function(){u.value?(ce.value||(ve.value=void 0,he.value=void 0,be.value=void 0),be.value=Xe(ye.value,pe.value,he.value),ge.value=Ze(ye.value,pe.value,he.value,ce.value,be.value,u.value.finalAssayEquation)):console.error("contract data is not defined")})),i((()=>$e.value[j]),(e=>Te(e))),i(J,(e=>{console.log(`change in assay detected. New assay=${JSON.stringify(e)}`),B.value=[],Y.value=[],K.value=[],Q.value=[],Z.value=[];for(const t of e)switch(t.method){case De.INTURN:B.value.push(t);break;case De.INTURN_FINAL:Y.value.push(t);break;case De.OUTTURN:K.value.push(t);break;case De.ESTIMATED:Z.value.push(t);break;case De.PLANNED:Q.value.push(t)}W.value=0===B.value.length,G.value=0===Y.value.length,z.value=0===K.value.length,X.value=0===Q.value.length,ee.value=0===Z.value.length}),{deep:!0}),{confirmCloseDrawerOverlay:ct,openConfirmCloseDrawerOverly:function(){le.value.length>0||se.value.length>0||ie.value.length>0?ct.value=!0:ft()},closeConfirmCloseDrawerOverlay:vt,confirmCloseDrawer:ft,confirmSaveOverlay:yt,openConfirmSaveOverlay:function(){le.value.length>0||se.value.length>0||ie.value.length>0?yt.value=!0:_t()},closeConfirmSaveOverlay:pt,confirmSave:_t,confirmDeleteAssayOverlay:gt,openConfirmDeleteAssayOverlay:function(){gt.value=!0},closeConfirmDeleteAssayOverlay:ht,confirmDeleteAssay:function(){ht(),async function(){console.log("[deleteAssay]");try{const e=ae.value.map((e=>e.id));e.push(ne.value);const t=await m.delete(`/items/${g}`,{data:e.filter((e=>void 0!==e))});if(204!==t.status)throw new Error(`response status=${t.status} is not 204`);console.log(`Assay successfully deleted with response status=${t.status}`),J.value.splice(te.value,1),ot()}catch(e){console.log(`deletion of assay with method=${J.value[te.value].method} and commodity=${J.value[te.value].commodity} failed with reason: '${e}'`)}}()},attrs:a,assayTableHeaders:n,assayLotTableHeaders:r,units:Se,itemDryWeightUnit:Ne,assayUnits:Ue,saveAssayLots:Fe,foreign_key:Ae,formValues:$e,addNewAssayLot:xe,isOpen:lt,toggleDrawer:ot,isComposite:it,toggleCompositeBoolean:()=>{it.value=!it.value},methodSelection:nt,commoditySelection:ut,itemMethod:re,itemCommodity:ue,itemAssayUoM:de,itemSplittingLimit:me,compositeItemWeight:fe,compositeItemSellerAssay:ye,compositeItemBuyerAssay:pe,compositeItemDifference:_e,compositeItemFinalAssay:ge,compositeItemToUmpire:ce,compositeUmpireName:ve,compositeItemUmpireAssay:he,compositeItemLosingParty:be,rowClickHandler:function(e){var t,a,l,o,i,s,n,r,u,d,m,c,v,f,y,p,_,g,h,b,w;console.log(`[rowClickHandler] ${JSON.stringify(e)} after clicking on an assay row`);const $=e.item;var A;te.value=J.value.findIndex((e=>e.assay_id===Ge($))),ze($)?(console.log("[rowClickHandler] keeping is composite toggle enabled"),mt.value=!1,$.composite=$.composite,ne.value=null===(t=$.composite)||void 0===t?void 0:t.id,re.value=null===(a=$.composite)||void 0===a?void 0:a.method,ue.value=null===(l=$.composite)||void 0===l?void 0:l.commodity,de.value=null===(o=$.composite)||void 0===o?void 0:o.assay_uom,me.value=null===(i=$.composite)||void 0===i?void 0:i.splitting_limit,ce.value=!!(null===(s=$.composite)||void 0===s?void 0:s.to_umpire),ve.value=null===(n=$.composite)||void 0===n?void 0:n.umpire_name,fe.value=null!==(u=null===(r=$.composite)||void 0===r?void 0:r.dry_weight)&&void 0!==u?u:0,Ne.value=null===(d=$.composite)||void 0===d?void 0:d.dry_weight_uom,ye.value=null!==(c=null===(m=$.composite)||void 0===m?void 0:m.seller_assay)&&void 0!==c?c:0,pe.value=null!==(f=null===(v=$.composite)||void 0===v?void 0:v.buyer_assay)&&void 0!==f?f:0,_e.value=null!==(p=null===(y=$.composite)||void 0===y?void 0:y.difference)&&void 0!==p?p:0,ge.value=null!==(g=null===(_=$.composite)||void 0===_?void 0:_.final_assay)&&void 0!==g?g:0,he.value=null!==(b=null===(h=$.composite)||void 0===h?void 0:h.umpire_assay)&&void 0!==b?b:0,be.value=null===(w=$.composite)||void 0===w?void 0:w.losing_party,console.log(`[rowClickHandler] assayLotsToDisplay in composite=${JSON.stringify(ae.value)}`)):(it.value=!1,console.log("[rowClickHandler] disabling is composite toggle"),mt.value=!0,console.log(`[rowClickHandler] Selected assay item is of index=${te.value}`),ae.value=(A=$.lots,console.log("[cloneLots]"),[...A].map((e=>({...e})))),console.log(`[rowClickHandler] assayLotsToDisplay=${JSON.stringify(ae.value)}`),-1!==te.value&&(re.value=J.value[te.value].method,ue.value=J.value[te.value].commodity,de.value=ae.value[0].assay_uom,Ne.value=ae.value[0].dry_weight_uom,me.value=J.value[te.value].splitting_limit,dt.value=[J.value[te.value]])),ot()},assays:J,inturnAssays:B,isInturnAssaysEmpty:W,inturnFinalAssays:Y,isInturnFinalAssaysEmpty:G,outturnAssays:K,isOutturnAssaysEmpty:z,estimateAssays:Z,isEstimateAssaysEmpty:ee,plannedAssays:Q,isPlannedAssaysEmpty:X,selectedAssayForDrawerDisplay:dt,assayLotsToDisplay:ae,assayLotsToDelete:se,onKeyDown:function(e){at&&clearTimeout(at),at=setTimeout((()=>{if(!u.value)return void console.error("contract data is not defined");console.log(`on key down event: ${JSON.stringify(e)}`);let t=-1;var a,l;e.id?(t=ae.value.findIndex((t=>t.id===e.id)),t<0?console.log(`No assay lot found with id=${e.id}`):(e.difference=Qe(e.seller_assay,e.buyer_assay),void 0!==e.difference&&void 0!==e.splitting_limit&&(e.to_umpire=(a=e.difference,l=e.splitting_limit,!(!!!u.value.umpireArbitrationWhenSLEqualsDiff||Math.abs(a)!==l)||Math.abs(a)>l)),e.to_umpire&&void 0!==e.umpire_assay&&void 0!==e.seller_assay&&void 0!==e.buyer_assay&&(e.losing_party=Xe(e.seller_assay,e.buyer_assay,e.umpire_assay)),e.to_umpire||(e.umpire_assay=void 0,e.umpire_name=void 0,e.losing_party=void 0),e.final_assay=Ze(e.seller_assay,e.buyer_assay,e.umpire_assay,e.to_umpire,e.losing_party,u.value.finalAssayEquation),ae.value[t]=e,ie.value.includes(e.id)||le.value.includes(e.id)||le.value.push(e.id))):console.log(`No assay lot id found for item ${e}`)}),500)},deleteButtonHandler:function(e){const t=se.value.findIndex((t=>t===e));-1===t?se.value.push(e):se.value.splice(t,1)},stageSplittingLimitBatchUpdate:function(){1==tt&&clearTimeout(tt),tt=setTimeout((()=>{var e,t;if(u.value)if(ze(J.value[te.value])){if(!_e.value||!me.value)return void console.log("composite difference or splitting limit is undefined");let e=!1;Math.abs(_e.value)>me.value&&!ce.value?(console.log("lot difference is greater than splitting limit"),ce.value=!0,e=!0):Math.abs(_e.value)<me.value&&ce.value?(console.log("lot difference is less than to splitting limit"),ce.value=!1,e=!0):Math.abs(_e.value)===me.value&&!ce.value&&u.value.umpireArbitrationWhenSLEqualsDiff?(console.log("lot difference is equal to splitting limit"),ce.value=!0,e=!0):Math.abs(_e.value)===me.value&&ce.value&&!u.value.umpireArbitrationWhenSLEqualsDiff&&(console.log("lot difference is equal to splitting limit"),ce.value=!1,e=!0),e&&(ce.value||(he.value=0,ve.value=void 0,be.value=void 0),ge.value=null!==(t=Ze(ye.value,pe.value,he.value,ce.value,be.value,u.value.finalAssayEquation))&&void 0!==t?t:0)}else{oe.value.splitting_limit=me.value;let t=!1;for(const a of ae.value)if(void 0!==a.difference&&void 0!==me.value){if(t=!1,Math.abs(a.difference)>me.value&&!a.to_umpire?(console.log("lot difference is greater than splitting limit"),a.to_umpire=!0,t=!0):Math.abs(a.difference)<me.value&&a.to_umpire?(console.log("lot difference is less than to splitting limit"),a.to_umpire=!1,t=!0):Math.abs(a.difference)===me.value&&!a.to_umpire&&u.value.umpireArbitrationWhenSLEqualsDiff?(console.log("lot difference is equal to splitting limit"),a.to_umpire=!0,t=!0):Math.abs(a.difference)===me.value&&a.to_umpire&&!u.value.umpireArbitrationWhenSLEqualsDiff&&(console.log("lot difference is equal to splitting limit"),a.to_umpire=!1,t=!0),t){a.to_umpire||(a.umpire_assay=void 0,a.umpire_name=void 0,a.losing_party=void 0),a.final_assay=Ze(a.seller_assay,a.buyer_assay,a.umpire_assay,a.to_umpire,a.losing_party,u.value.finalAssayEquation);const t=ae.value.findIndex((e=>e.id===a.id));ae.value[t]=a,le.value.push(null!==(e=a.id)&&void 0!==e?e:P)}}else console.log("lot difference or splitting limit is undefined")}else console.error("contract data is not defined")}),2e3)},addAssayButtonHandler:async function(){Me.value=!0,dt.value=[{}],console.log(`[addAssayButtonHandler] weightLotsForeignKey=${Ie.value}`),await Te(Ie.value),ot()},isAddingNewAssay:Me,save:qe,onCompositeToggle:et,isCompositeToggleDisabled:mt,highlightCellToLightSalmon:function(e){return e?"assay_cell_highlighted":"assay_cell"},deleteIcon:function(e){return console.log("[deleteIcon]"),-1===se.value.findIndex((t=>t===e))?"close":"settings_backup_restore"},colourDeleteIcon:function(e){return console.log("[colourDeleteIcon]"),-1===se.value.findIndex((t=>t===e))?"v-icon-delete-button-small-foreground-subdued":"v-icon-delete-button-small-red"},isContractNotSelected:we,formatNumber:function(e,t=4,a=!0){if(console.log(`[formatNumber] with number value=${e}`),isNaN(e)||null===e)return"-";const l=Math.round(e*Math.pow(10,t))/Math.pow(10,t),[o,i]=l.toString().split(".");if(!o)return"";const s=o.replace(/\B(?=(\d{3})+(?!\d))/g,",");return i||a?`${s}.${(null!=i?i:"").padEnd(t,"0")}`:s},isNullOrUndefined:function(e){return null==e}}}});const xe=e=>(h("data-v-64969d30"),e=e(),b(),e),Re={key:0},Pe={key:0},He={key:0},Fe={key:0},qe={key:0},je={class:"drawer-content"},Je={key:0},Be={class:"input-label"},We={key:0},Ye=["disabled"],Ge=xe((()=>f("div",{class:"input-label"},"Method",-1))),Ke=xe((()=>f("div",{class:"input-label"},"Commodity",-1))),ze=xe((()=>f("div",{class:"input-label"},"Assay UoM",-1))),Qe=xe((()=>f("div",{class:"input-label"},"Splitting limit",-1))),Xe={key:0},Ze=xe((()=>f("div",{class:"input-label"},"Weight",-1))),et=xe((()=>f("div",{class:"input-label"},"Unit of Measure (Weight)",-1))),tt=xe((()=>f("div",{class:"input-label"},"Seller Assay",-1))),at=xe((()=>f("div",{class:"input-label"},"Buyer Assay",-1))),lt=xe((()=>f("div",{class:"input-label"},"Difference",-1))),ot=xe((()=>f("div",{class:"input-label"},"To Umpire",-1))),it=xe((()=>f("div",{class:"input-label"},"Umpire name",-1))),st=xe((()=>f("div",{class:"input-label"},"Umpire Assay",-1))),nt=xe((()=>f("div",{class:"input-label"},"Losing party",-1))),rt=xe((()=>f("div",{class:"input-label"},"Final Assay",-1))),ut={key:1},dt=xe((()=>f("div",{class:"input-label"},"Assay Lots",-1))),mt=xe((()=>f("div",null,null,-1))),ct={key:0};var vt=[],ft=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,l=!0===t.prepend?"prepend":"append",o=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(o){var s=vt.indexOf(i);-1===s&&(s=vt.push(i)-1,ft[s]={}),a=ft[s]&&ft[s][l]?ft[s][l]:ft[s][l]=n()}else a=n();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function n(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),o=0;o<a.length;o++)e.setAttribute(a[o],t.attributes[a[o]]);var s="prepend"===l?"afterbegin":"beforeend";return i.insertAdjacentElement(s,e),e}}('.assay-table .table-row[data-v-64969d30] {\n  height: 30px;\n}\n.assay-table .assay_cell[data-v-64969d30] {\n  width: 100%;\n}\n.assay-table .assay_cell_highlighted[data-v-64969d30] {\n  background-color: lightsalmon !important;\n  width: 100%;\n}\n.assay-table .header_cell_with_input[data-v-64969d30] {\n  height: 60px;\n}\n.margin-top-16px[data-v-64969d30] {\n  margin-top: 16px;\n}\n.v-icon-white[data-v-64969d30] {\n  --v-icon-color: #ffffff;\n}\n.v-icon-purple[data-v-64969d30] {\n  --v-icon-color: #8866FF;\n}\n.v-icon-delete-button-small-foreground-subdued[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--foreground-subdued);\n}\n.v-icon-delete-button-small-red[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--red);\n}\n.v-button-red-on-hover[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--background-normal);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--red);\n}\n.v-button-red[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--danger);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--danger-125);\n}\n.drawer-content[data-v-64969d30] {\n  padding: 0 32px 40px;\n}\n.assay-drawer[data-v-64969d30] {\n  max-width: 1500px !important;\n}\n.v-sheet[data-v-64969d30] {\n  --v-sheet-color: var(-red-600);\n}\n.input-label[data-v-64969d30] {\n  color: #f0f6fc;\n  font-weight: 600;\n  font-size: 16px;\n  font-family: "Inter", -apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n  font-style: normal;\n  line-height: 19px;\n  margin-bottom: 8px;\n  padding-top: 20px !important;\n}',{}),Me.render=function(e,t,a,l,o,i){const h=s("v-icon"),b=s("v-table"),w=s("v-detail"),$=s("v-button"),A=s("v-checkbox"),N=s("v-select"),S=s("v-input"),U=s("v-drawer"),O=s("v-card-title"),I=s("v-card-text"),C=s("v-card-actions"),T=s("v-card"),D=s("v-dialog"),E=n("tooltip");return r(),u("div",null,[d(" <div>{{ assays }}</div> "),d(' <input :value="foreign_key"> '),e.isPlannedAssaysEmpty?d("v-if",!0):(r(),m(w,{key:0,label:"Planned"},{default:c((()=>[v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.plannedAssays,rowHeight:30,"onClick:row":t[0]||(t[0]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",Re,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),_:1})),e.isEstimateAssaysEmpty?d("v-if",!0):(r(),m(w,{key:1,label:"Estimate"},{default:c((()=>[v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.estimateAssays,rowHeight:30,"onClick:row":t[1]||(t[1]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",Pe,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),_:1})),e.isInturnAssaysEmpty?d("v-if",!0):(r(),m(w,{key:2,label:"Inturn"},{default:c((()=>[v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.inturnAssays,rowHeight:30,"onClick:row":t[2]||(t[2]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",He,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),_:1})),e.isInturnFinalAssaysEmpty?d("v-if",!0):(r(),m(w,{key:3,label:"Inturn Final"},{default:c((()=>[v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.inturnFinalAssays,rowHeight:30,"onClick:row":t[3]||(t[3]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",Fe,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),_:1})),e.isOutturnAssaysEmpty?d("v-if",!0):(r(),m(w,{key:4,label:"Outturn"},{default:c((()=>[v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.outturnAssays,rowHeight:30,"onClick:row":t[4]||(t[4]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",qe,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),_:1})),v(U,{modelValue:e.isOpen,"onUpdate:modelValue":t[21]||(t[21]=t=>e.isOpen=t),onToggle:e.openConfirmCloseDrawerOverly,onCancel:e.openConfirmCloseDrawerOverly,icon:"gavel",title:"Edit Assay",subtitle:e.isComposite?"Composite Assay":"Assay Lots"},{actions:c((()=>[p((r(),m($,{rounded:"",onClick:e.openConfirmSaveOverlay,disabled:e.isContractNotSelected,icon:""},{default:c((()=>[v(h,{name:"check"})])),_:1},8,["onClick","disabled"])),[[E,e.isContractNotSelected?"Cannot save without a contract selected":null,void 0,{bottom:!0}]]),p((r(),m($,{class:"v-button-red-on-hover",rounded:"",onClick:e.openConfirmDeleteAssayOverlay,disabled:e.isContractNotSelected,icon:""},{default:c((()=>[v(h,{name:"delete"})])),_:1},8,["onClick","disabled"])),[[E,e.isContractNotSelected?"Changes cannot be made without a contract selected":null,void 0,{bottom:!0}]])])),default:c((()=>[f("div",je,[v(A,{modelValue:e.isComposite,"onUpdate:modelValue":t[5]||(t[5]=t=>e.isComposite=t),"icon-on":"toggle_on","icon-off":"toggle_off",label:"Composite",disabled:e.isAddingNewAssay||e.isCompositeToggleDisabled},null,8,["modelValue","disabled"]),e.isComposite?d("v-if",!0):(r(),u("div",Je,[f("div",Be,y(`Assay Result for ${e.selectedAssayForDrawerDisplay[0].commodity_name} (${e.itemMethod})`),1),v(b,{class:"assay-table",headers:e.assayTableHeaders,items:e.selectedAssayForDrawerDisplay,rowHeight:30,fixedHeader:"",inline:""},{"item.seller_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.seller_assay)}${e.isNullOrUndefined(t.seller_assay)?"":t.assay_uom}`),1)])),"item.buyer_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.buyer_assay)}${e.isNullOrUndefined(t.buyer_assay)?"":t.assay_uom}`),1)])),"item.difference":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.difference)}${e.isNullOrUndefined(t.difference)?"":t.assay_uom}`),1)])),"item.splitting_limit":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.splitting_limit)}${e.isNullOrUndefined(t.splitting_limit)?"":t.assay_uom}`),1)])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",We,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.umpire_assay)}${e.isNullOrUndefined(t.umpire_assay)?"":t.assay_uom}`),1)])),"item.final_assay":c((({item:t})=>[f("div",null,y(`${e.formatNumber(t.final_assay)}${e.isNullOrUndefined(t.final_assay)?"":t.assay_uom}`),1)])),_:2},1032,["headers","items"])])),f("fieldset",{disabled:e.isContractNotSelected},[d(" Just disabling adding a new assay by saving lot items, must first create a composite item that is then converted to lots, can be changed in the future "),d(" when a selected assay is made up of assay lots, it should not be convertible back to composite "),Ge,v(N,{modelValue:e.itemMethod,"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemMethod=t),items:e.methodSelection,disabled:!e.isAddingNewAssay},null,8,["modelValue","items","disabled"]),Ke,v(N,{modelValue:e.itemCommodity,"onUpdate:modelValue":t[7]||(t[7]=t=>e.itemCommodity=t),items:e.commoditySelection,disabled:!e.isAddingNewAssay},null,8,["modelValue","items","disabled"]),ze,v(N,{modelValue:e.itemAssayUoM,"onUpdate:modelValue":t[8]||(t[8]=t=>e.itemAssayUoM=t),items:e.assayUnits},null,8,["modelValue","items"]),Qe,v(S,{modelValue:e.itemSplittingLimit,"onUpdate:modelValue":t[9]||(t[9]=t=>e.itemSplittingLimit=t),type:"number",onInput:t[10]||(t[10]=()=>e.stageSplittingLimitBatchUpdate())},null,8,["modelValue"]),e.isComposite?(r(),u("div",Xe,[Ze,v(S,{modelValue:e.compositeItemWeight,"onUpdate:modelValue":t[11]||(t[11]=t=>e.compositeItemWeight=t),type:"number"},null,8,["modelValue"]),et,v(N,{modelValue:e.itemDryWeightUnit,"onUpdate:modelValue":t[12]||(t[12]=t=>e.itemDryWeightUnit=t),items:e.units,disabled:!0},null,8,["modelValue","items"]),tt,v(S,{modelValue:e.compositeItemSellerAssay,"onUpdate:modelValue":t[13]||(t[13]=t=>e.compositeItemSellerAssay=t),type:"number"},null,8,["modelValue"]),at,v(S,{modelValue:e.compositeItemBuyerAssay,"onUpdate:modelValue":t[14]||(t[14]=t=>e.compositeItemBuyerAssay=t),type:"number"},null,8,["modelValue"]),lt,v(S,{modelValue:e.compositeItemDifference,"onUpdate:modelValue":t[15]||(t[15]=t=>e.compositeItemDifference=t),type:"number"},null,8,["modelValue"]),ot,v(S,{modelValue:e.compositeItemToUmpire,"onUpdate:modelValue":t[16]||(t[16]=t=>e.compositeItemToUmpire=t),type:"boolean"},null,8,["modelValue"]),it,v(S,{modelValue:e.compositeUmpireName,"onUpdate:modelValue":t[17]||(t[17]=t=>e.compositeUmpireName=t),disabled:!e.compositeItemToUmpire},null,8,["modelValue","disabled"]),st,v(S,{modelValue:e.compositeItemUmpireAssay,"onUpdate:modelValue":t[18]||(t[18]=t=>e.compositeItemUmpireAssay=t),disabled:!e.compositeItemToUmpire,type:"number"},null,8,["modelValue","disabled"]),nt,v(S,{modelValue:e.compositeItemLosingParty,"onUpdate:modelValue":t[19]||(t[19]=t=>e.compositeItemLosingParty=t),disabled:!e.compositeItemToUmpire},null,8,["modelValue","disabled"]),rt,v(S,{modelValue:e.compositeItemFinalAssay,"onUpdate:modelValue":t[20]||(t[20]=t=>e.compositeItemFinalAssay=t),type:"number"},null,8,["modelValue"])])):(r(),u("div",ut,[dt,v(b,{class:"assay-table",headers:e.assayLotTableHeaders,items:e.assayLotsToDisplay,rowHeight:30,fixedHeader:"",inline:""},{"header.dry_weight":c((({header:t})=>[f("div",null,y(`${t.text} (${e.itemDryWeightUnit})`),1)])),"header.to_umpire":c((()=>[mt])),"item.delete":c((({item:t})=>[v(h,{class:_(e.colourDeleteIcon(t.id)),name:e.deleteIcon(t.id),onClick:()=>e.deleteButtonHandler(t.id)},null,8,["class","name","onClick"])])),"item.dry_weight":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].dry_weight,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].dry_weight=a,placeholder:0,type:"number",nullable:!0},null,8,["class","modelValue","onUpdate:modelValue"])])),"item.seller_assay":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].seller_assay,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].seller_assay=a,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["class","modelValue","onUpdate:modelValue","onKeydown"])])),"item.buyer_assay":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].buyer_assay,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].buyer_assay=a,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["class","modelValue","onUpdate:modelValue","onKeydown"])])),"item.difference":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].difference,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].difference=a,placeholder:0,type:"number",nullable:!0},null,8,["class","modelValue","onUpdate:modelValue"])])),"item.to_umpire":c((({item:e})=>[e.to_umpire?(r(),u("div",ct,[p(v(h,{class:"v-icon-purple",name:"gavel"},null,512),[[E,"Require umpire arbitration",void 0,{bottom:!0}]])])):d("v-if",!0)])),"item.umpire_name":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].umpire_name,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].umpire_name=a,disabled:!e.assayLotsToDisplay[t.lot_number-1].to_umpire,placeholder:0,type:"string",nullable:!0},null,8,["class","modelValue","onUpdate:modelValue","disabled"])])),"item.umpire_assay":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].umpire_assay,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].umpire_assay=a,disabled:!e.assayLotsToDisplay[t.lot_number-1].to_umpire,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["class","modelValue","onUpdate:modelValue","disabled","onKeydown"])])),"item.losing_party":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].losing_party,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].losing_party=a,disabled:!e.assayLotsToDisplay[t.lot_number-1].to_umpire,placeholder:0,type:"string",nullable:!0},null,8,["class","modelValue","onUpdate:modelValue","disabled"])])),"item.final_assay":c((({item:t})=>[v(S,{class:_(e.highlightCellToLightSalmon(t.to_umpire)),modelValue:e.assayLotsToDisplay[t.lot_number-1].final_assay,"onUpdate:modelValue":a=>e.assayLotsToDisplay[t.lot_number-1].final_assay=a,placeholder:0,type:"number",nullable:!0},null,8,["class","modelValue","onUpdate:modelValue"])])),_:2},1032,["headers","items"]),p((r(),m($,{class:"margin-top-16px",onClick:e.addNewAssayLot,disabled:e.isComposite||e.isContractNotSelected},{default:c((()=>[g(" Add New Lot ")])),_:1},8,["onClick","disabled"])),[[E,e.isComposite?"Cannot add new lot for composite items":e.isContractNotSelected?"Cannot add new lot without a contract selected":null,void 0,{bottom:!0}]])]))],8,Ye)])])),_:1},8,["modelValue","onToggle","onCancel","subtitle"]),v(D,{modelValue:e.confirmCloseDrawerOverlay,"onUpdate:modelValue":t[22]||(t[22]=t=>e.confirmCloseDrawerOverlay=t)},{default:c((()=>[v(T,null,{default:c((()=>[v(O,null,{default:c((()=>[g("Unsaved changes")])),_:1}),v(I,null,{default:c((()=>[g("Are you sure you want to leave this page?")])),_:1}),v(C,null,{default:c((()=>[v($,{secondary:"",onClick:e.confirmCloseDrawer},{default:c((()=>[g("Discard Changes")])),_:1},8,["onClick"]),v($,{onClick:e.closeConfirmCloseDrawerOverlay},{default:c((()=>[g("Keep Editing")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),v(D,{modelValue:e.confirmSaveOverlay,"onUpdate:modelValue":t[23]||(t[23]=t=>e.confirmSaveOverlay=t)},{default:c((()=>[v(T,null,{default:c((()=>[v(O,null,{default:c((()=>[g("New changes made")])),_:1}),v(I,null,{default:c((()=>[g("The changes will be saved even if other changes to the Parcel is not saved. Are you sure you want to save?")])),_:1}),v(C,null,{default:c((()=>[v($,{secondary:"",onClick:e.closeConfirmSaveOverlay},{default:c((()=>[g("Keep Editing")])),_:1},8,["onClick"]),v($,{onClick:e.confirmSave},{default:c((()=>[g("Save Changes")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),v(D,{modelValue:e.confirmDeleteAssayOverlay,"onUpdate:modelValue":t[24]||(t[24]=t=>e.confirmDeleteAssayOverlay=t)},{default:c((()=>[v(T,null,{default:c((()=>[v(O,null,{default:c((()=>[g(y(`Delete ${e.selectedAssayForDrawerDisplay[0].commodity_name} (${e.itemMethod}) assay`),1)])),_:1}),v(I,null,{default:c((()=>[g("This action is permanent and can not be undone. Are you sure you would like to proceed?")])),_:1}),v(C,null,{default:c((()=>[v($,{secondary:"",onClick:e.closeConfirmDeleteAssayOverlay},{default:c((()=>[g("Keep Editing")])),_:1},8,["onClick"]),v($,{class:"v-button-red",onClick:e.confirmDeleteAssay},{default:c((()=>[g("Delete")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),v($,{class:"margin-top-16px",onClick:t[25]||(t[25]=()=>e.addAssayButtonHandler()),disabled:e.isContractNotSelected},{default:c((()=>[g("Add Assay")])),_:1},8,["disabled"]),d(" <v-form\r\n\t\t\t:fields=\"[{\r\n\t\t\t\tfield: 'method', \r\n\t\t\t\tname: 'Method', \r\n\t\t\t\ttype: 'string',\r\n\t\t\t\tmeta: {\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tchoices: methodSelection\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\tfield: 'commodity', \r\n\t\t\t\tname: 'Commodity', \r\n\t\t\t\ttype: 'string'\r\n\t\t\t}, {\r\n\t\t\t\tfield: 'assay_uom', \r\n\t\t\t\tname: 'Assay UoM', \r\n\t\t\t\ttype: 'string',\r\n\t\t\t\tmeta: {\r\n\t\t\t\t\tcollection: 'navarch_parcel',\r\n\t\t\t\t\tfield: 'assay_uom', \r\n\t\t\t\t\tinterface: 'select-dropdown',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tchoices: assayUnits\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}]\"\r\n\t\t\t:initial-values=\"{\r\n\t\t\t\tmethod: `${itemMethod}`,\r\n\t\t\t\tcommodity: `${itemCommodity}`,\r\n\t\t\t\tassay_uom: `${itemAssayUoM ?? ''}`\r\n\t\t\t}\"\r\n\t\t/> ")])},Me.__scopeId="data-v-64969d30",Me.__file="src/interface.vue";var yt=t({id:"assay_result_table",name:"Assay Result Table",icon:"box",description:"Custom interface for assay result",component:Me,options:null,types:["string"],group:"standard"});export{yt as default};
