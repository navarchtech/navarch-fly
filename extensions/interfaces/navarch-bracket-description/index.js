import{defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as t,inject as a,ref as n,watch as u,resolveComponent as i,openBlock as l,createBlock as r}from"vue";var o=(e=>(e.ASSAY="assay",e.CHARGE="charge",e.PENALTY="penalty",e))(o||{}),s=(e=>(e.ABOVE="above the lower threshold, plus",e.BELOW="below the upper threshold, minus",e))(s||{}),c=(e=>(e.BRACKET="Bracket",e.MAX_CAP="Maximum Cap",e.MIN_DEDUCTION="Minimum Deduction",e))(c||{}),m=(e=>(e.PERCENTAGE="Percentage",e.FRACTIONAL="Fractional",e))(m||{}),y=t({props:{value:{type:String,default:null},formType:{type:String,default:null}},emits:["input"],setup(e,{emit:t}){const i=a("values",n({}));e.formType;const l="lower_threshold",r="lower_threshold_inclusive",y="upper_threshold",f="upper_threshold_inclusive",h="bracket_type",v="rate",$="rate_type",p="initial_adjustment",d="initial_adjustment_uom",A="minimum_deduction",E="minimum_deduction_uom",w="maximum_cap",_="maximum_cap_uom",g="base_treatment_charge",C="use_btc",N="for_every_unit",P="rate",T="no_penalty",b="rate",D=[l,r,y,f];let S=[];switch(e.formType){case"assay":S=D.concat([h,v,$,p,d,A,E,w,_]);break;case"charge":S=D.concat([g,C,N,P]);break;case"penalty":S=D.concat([T,"for_every_unit",b])}S.forEach((e=>{u((()=>i.value[e]),k)}));const R=n(""),U=n("");function k(){switch(e.formType){case o.ASSAY:R.value=x(i.value[l],!!i.value[r],i.value[y],!!i.value[f],"Commodity Analytical Assay"),U.value=function(e,t,a,n,u,i,l,r,o){switch(e){case c.BRACKET:if(B(t)&&G(n))return`Pay ${t}${a===m.PERCENTAGE?"%":""} of the amount`;if(B(n,t))return`Deduct ${n}${null!=u?u:" assay unit(s)"} from the Commodity Analytical Assay, then pay ${t}${a===m.PERCENTAGE?"%":""} of the amount`;case c.MAX_CAP:if(B(t,r)&&G(n))return`Pay ${t}${a===m.PERCENTAGE?"%":""} of the amount with a maximum cap of ${r}${null!=o?o:" assay unit(s)"}`;if(B(t,r,n))return`Deduct ${n}${null!=u?u:" assay unit(s)"} from the Commodity Analytical Assay, then pay ${t}${a===m.PERCENTAGE?"%":""} of the amount with a maximum cap of ${r}${null!=o?o:" assay unit(s)"}`;case c.MIN_DEDUCTION:if(B(t,i)&&G(n))return`Pay ${t}${a===m.PERCENTAGE?"%":""} of the amount with a minimum deduction of ${i}${null!=l?l:" assay unit(s)"}`;if(B(t,i,n))return`Deduct ${n}${null!=u?u:" assay unit(s)"} from the Commodity Analytical Assay, then pay ${t}${a===m.PERCENTAGE?"%":""} of the amount with a minimum deduction of ${i}${null!=l?l:" assay unit(s)"}`}return null}(i.value[h],i.value[v],i.value[$],i.value[p],i.value[d],i.value[A],i.value[E],i.value[w],i.value[_]),null!==R.value&&null!==U.value&&t("input",`${U.value}${R.value}`);break;case o.CHARGE:U.value=function(e,t,a,n,u,i,l,r){if(i){if(B(u))return`${M(u)} USD/(weight unit)${x(e,t,a,n,"Commodity Price Rate")}`}else if(l===s.ABOVE){if(B(e,r))return`Plus ${M(r)} USD/(weight unit) from ${M(u)} USD/(weight unit) for every 1.00 USD/(weight unit) above ${e} USD/(weight unit)`}else if(l===s.BELOW&&B(a,r))return`Deduct ${M(r)} USD/(weight unit) from ${M(u)} USD/(weight unit) for every 1.00 USD/(weight unit) below ${a} USD/(weight unit)`;return null}(i.value[l],!!i.value[r],i.value[y],!!i.value[f],i.value[g],i.value[C],i.value[N],i.value[P]),null!==U.value&&t("input",`${U.value}`);break;case o.PENALTY:console.log(`Penalty form inputs=${JSON.stringify(i.value)}`),U.value=function(e,t,a,n,u,i){if(u)return`No penalty applied${x(e,t,a,n,"Commodity Analaytical Assay")}`;if(B(e,i)&&G(a))return`Penalty of ${M(i)} USD/(weight unit) for every 1.00 assay unit above ${e} assay unit(s)`;if(B(e,a,i))return`Penalty of ${M(i)} USD/(weight unit) for every 1.00 assay unit between ${e} assay unit(s)${t?" (incl.)":""} and ${a} assay unit(s)${n?" (incl.)":""}`;return null}(i.value[l],!!i.value[r],i.value[y],!!i.value[f],i.value[T],i.value[b]),null!==U.value&&t("input",`${U.value}`)}}return{handleChange:function(e){t("input",e)}};function x(e,t,a,n,u){let i=null;return 0===e&&G(a)?i="":0===e&&B(a)?i=` when the ${u} is less than ${a} assay unit(s)${n?" (incl.)":""}`:B(e,a)?i=` when the ${u} is between ${e} assay unit(s)${t?" (incl.)":""} and ${a}${n?" (incl.)":""}`:B(e)&&G(a)&&(i=` when the ${u} is greater than ${e} assay unit(s)${t?" (incl.)":""}`),i}function B(...e){return e.every((e=>null!=e&&!isNaN(e)))}function G(e){return null==e||isNaN(e)}function M(e,t=2,a=!0){if(console.log(`[formatNumber] with number value=${e}`),isNaN(e)||null===e)return"-";const n=Math.round(e*Math.pow(10,t))/Math.pow(10,t),[u,i]=n.toString().split(".");if(!u)return"";const l=u.replace(/\B(?=(\d{3})+(?!\d))/g,",");if(!i&&!a)return l;return`${l}.${(null!=i?i:"").padEnd(t,"0")}`}}});y.render=function(e,t,a,n,u,o){const s=i("v-input");return l(),r(s,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=t=>e.value=t),disabled:!0},null,8,["modelValue"])},y.__file="src/interface.vue";var f=e({id:"navarch-bracket-description",name:"Navarch Bracket Description",icon:"data_info_alert",description:"To describe bracket for Penalty, Refining Charge, Treatment Charge, & Payable Rates",component:y,options:()=>[{field:"formType",name:"Form Type",type:"string",meta:{interface:"select-dropdown",options:{allowNone:!1,choices:[{text:"Payable Assay Rate",value:"assay"},{text:"Treatment/Refining Charge",value:"charge"},{text:"Penalty Rate",value:"penalty"}]}}}],types:["string"]});export{f as default};
