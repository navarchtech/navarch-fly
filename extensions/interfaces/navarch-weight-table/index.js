import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{defineComponent as o,ref as l,inject as n,watch as a,resolveComponent as i,resolveDirective as r,openBlock as d,createElementBlock as s,createVNode as u,withCtx as c,createElementVNode as h,toDisplayString as g,withDirectives as v,createBlock as f,createTextVNode as m,normalizeClass as w,pushScopeId as p,popScopeId as y}from"vue";var _={},b={},C={};let $;Object.defineProperty(C,"__esModule",{value:!0}),C.default=function(){if(!$&&($="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(D)};const D=new Uint8Array(16);var O={},W={},U={};Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0;U.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Object.defineProperty(W,"__esModule",{value:!0}),W.default=void 0;var M,S=(M=U)&&M.__esModule?M:{default:M};var I=function(e){return"string"==typeof e&&S.default.test(e)};W.default=I,Object.defineProperty(O,"__esModule",{value:!0}),O.default=void 0,O.unsafeStringify=x;var L=function(e){return e&&e.__esModule?e:{default:e}}(W);const N=[];for(let e=0;e<256;++e)N.push((e+256).toString(16).slice(1));function x(e,t=0){return(N[e[t+0]]+N[e[t+1]]+N[e[t+2]]+N[e[t+3]]+"-"+N[e[t+4]]+N[e[t+5]]+"-"+N[e[t+6]]+N[e[t+7]]+"-"+N[e[t+8]]+N[e[t+9]]+"-"+N[e[t+10]]+N[e[t+11]]+N[e[t+12]]+N[e[t+13]]+N[e[t+14]]+N[e[t+15]]).toLowerCase()}var T=function(e,t=0){const o=x(e,t);if(!(0,L.default)(o))throw TypeError("Stringified UUID is invalid");return o};O.default=T,Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var k=function(e){return e&&e.__esModule?e:{default:e}}(C),A=O;let E,V,j=0,H=0;var R=function(e,t,o){let l=t&&o||0;const n=t||new Array(16);let a=(e=e||{}).node||E,i=void 0!==e.clockseq?e.clockseq:V;if(null==a||null==i){const t=e.random||(e.rng||k.default)();null==a&&(a=E=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==i&&(i=V=16383&(t[6]<<8|t[7]))}let r=void 0!==e.msecs?e.msecs:Date.now(),d=void 0!==e.nsecs?e.nsecs:H+1;const s=r-j+(d-H)/1e4;if(s<0&&void 0===e.clockseq&&(i=i+1&16383),(s<0||r>j)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");j=r,H=d,V=i,r+=122192928e5;const u=(1e4*(268435455&r)+d)%4294967296;n[l++]=u>>>24&255,n[l++]=u>>>16&255,n[l++]=u>>>8&255,n[l++]=255&u;const c=r/4294967296*1e4&268435455;n[l++]=c>>>8&255,n[l++]=255&c,n[l++]=c>>>24&15|16,n[l++]=c>>>16&255,n[l++]=i>>>8|128,n[l++]=255&i;for(let e=0;e<6;++e)n[l+e]=a[e];return t||(0,A.unsafeStringify)(n)};b.default=R;var P={},F={},B={};Object.defineProperty(B,"__esModule",{value:!0}),B.default=void 0;var K=function(e){return e&&e.__esModule?e:{default:e}}(W);var J=function(e){if(!(0,K.default)(e))throw TypeError("Invalid UUID");let t;const o=new Uint8Array(16);return o[0]=(t=parseInt(e.slice(0,8),16))>>>24,o[1]=t>>>16&255,o[2]=t>>>8&255,o[3]=255&t,o[4]=(t=parseInt(e.slice(9,13),16))>>>8,o[5]=255&t,o[6]=(t=parseInt(e.slice(14,18),16))>>>8,o[7]=255&t,o[8]=(t=parseInt(e.slice(19,23),16))>>>8,o[9]=255&t,o[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,o[11]=t/4294967296&255,o[12]=t>>>24&255,o[13]=t>>>16&255,o[14]=t>>>8&255,o[15]=255&t,o};B.default=J,Object.defineProperty(F,"__esModule",{value:!0}),F.URL=F.DNS=void 0,F.default=function(e,t,o){function l(e,l,n,a){var i;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let o=0;o<e.length;++o)t.push(e.charCodeAt(o));return t}(e)),"string"==typeof l&&(l=(0,q.default)(l)),16!==(null===(i=l)||void 0===i?void 0:i.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let r=new Uint8Array(16+e.length);if(r.set(l),r.set(e,l.length),r=o(r),r[6]=15&r[6]|t,r[8]=63&r[8]|128,n){a=a||0;for(let e=0;e<16;++e)n[a+e]=r[e];return n}return(0,G.unsafeStringify)(r)}try{l.name=e}catch(e){}return l.DNS=Y,l.URL=z,l};var G=O,q=function(e){return e&&e.__esModule?e:{default:e}}(B);const Y="6ba7b810-9dad-11d1-80b4-00c04fd430c8";F.DNS=Y;const z="6ba7b811-9dad-11d1-80b4-00c04fd430c8";F.URL=z;var Q={};function X(e){return 14+(e+64>>>9<<4)+1}function Z(e,t){const o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function ee(e,t,o,l,n,a){return Z((i=Z(Z(t,e),Z(l,a)))<<(r=n)|i>>>32-r,o);var i,r}function te(e,t,o,l,n,a,i){return ee(t&o|~t&l,e,t,n,a,i)}function oe(e,t,o,l,n,a,i){return ee(t&l|o&~l,e,t,n,a,i)}function le(e,t,o,l,n,a,i){return ee(t^o^l,e,t,n,a,i)}function ne(e,t,o,l,n,a,i){return ee(o^(t|~l),e,t,n,a,i)}Object.defineProperty(Q,"__esModule",{value:!0}),Q.default=void 0;var ae=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let o=0;o<t.length;++o)e[o]=t.charCodeAt(o)}return function(e){const t=[],o=32*e.length,l="0123456789abcdef";for(let n=0;n<o;n+=8){const o=e[n>>5]>>>n%32&255,a=parseInt(l.charAt(o>>>4&15)+l.charAt(15&o),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[X(t)-1]=t;let o=1732584193,l=-271733879,n=-1732584194,a=271733878;for(let t=0;t<e.length;t+=16){const i=o,r=l,d=n,s=a;o=te(o,l,n,a,e[t],7,-680876936),a=te(a,o,l,n,e[t+1],12,-389564586),n=te(n,a,o,l,e[t+2],17,606105819),l=te(l,n,a,o,e[t+3],22,-1044525330),o=te(o,l,n,a,e[t+4],7,-176418897),a=te(a,o,l,n,e[t+5],12,1200080426),n=te(n,a,o,l,e[t+6],17,-1473231341),l=te(l,n,a,o,e[t+7],22,-45705983),o=te(o,l,n,a,e[t+8],7,1770035416),a=te(a,o,l,n,e[t+9],12,-1958414417),n=te(n,a,o,l,e[t+10],17,-42063),l=te(l,n,a,o,e[t+11],22,-1990404162),o=te(o,l,n,a,e[t+12],7,1804603682),a=te(a,o,l,n,e[t+13],12,-40341101),n=te(n,a,o,l,e[t+14],17,-1502002290),l=te(l,n,a,o,e[t+15],22,1236535329),o=oe(o,l,n,a,e[t+1],5,-165796510),a=oe(a,o,l,n,e[t+6],9,-1069501632),n=oe(n,a,o,l,e[t+11],14,643717713),l=oe(l,n,a,o,e[t],20,-373897302),o=oe(o,l,n,a,e[t+5],5,-701558691),a=oe(a,o,l,n,e[t+10],9,38016083),n=oe(n,a,o,l,e[t+15],14,-660478335),l=oe(l,n,a,o,e[t+4],20,-405537848),o=oe(o,l,n,a,e[t+9],5,568446438),a=oe(a,o,l,n,e[t+14],9,-1019803690),n=oe(n,a,o,l,e[t+3],14,-187363961),l=oe(l,n,a,o,e[t+8],20,1163531501),o=oe(o,l,n,a,e[t+13],5,-1444681467),a=oe(a,o,l,n,e[t+2],9,-51403784),n=oe(n,a,o,l,e[t+7],14,1735328473),l=oe(l,n,a,o,e[t+12],20,-1926607734),o=le(o,l,n,a,e[t+5],4,-378558),a=le(a,o,l,n,e[t+8],11,-2022574463),n=le(n,a,o,l,e[t+11],16,1839030562),l=le(l,n,a,o,e[t+14],23,-35309556),o=le(o,l,n,a,e[t+1],4,-1530992060),a=le(a,o,l,n,e[t+4],11,1272893353),n=le(n,a,o,l,e[t+7],16,-155497632),l=le(l,n,a,o,e[t+10],23,-1094730640),o=le(o,l,n,a,e[t+13],4,681279174),a=le(a,o,l,n,e[t],11,-358537222),n=le(n,a,o,l,e[t+3],16,-722521979),l=le(l,n,a,o,e[t+6],23,76029189),o=le(o,l,n,a,e[t+9],4,-640364487),a=le(a,o,l,n,e[t+12],11,-421815835),n=le(n,a,o,l,e[t+15],16,530742520),l=le(l,n,a,o,e[t+2],23,-995338651),o=ne(o,l,n,a,e[t],6,-198630844),a=ne(a,o,l,n,e[t+7],10,1126891415),n=ne(n,a,o,l,e[t+14],15,-1416354905),l=ne(l,n,a,o,e[t+5],21,-57434055),o=ne(o,l,n,a,e[t+12],6,1700485571),a=ne(a,o,l,n,e[t+3],10,-1894986606),n=ne(n,a,o,l,e[t+10],15,-1051523),l=ne(l,n,a,o,e[t+1],21,-2054922799),o=ne(o,l,n,a,e[t+8],6,1873313359),a=ne(a,o,l,n,e[t+15],10,-30611744),n=ne(n,a,o,l,e[t+6],15,-1560198380),l=ne(l,n,a,o,e[t+13],21,1309151649),o=ne(o,l,n,a,e[t+4],6,-145523070),a=ne(a,o,l,n,e[t+11],10,-1120210379),n=ne(n,a,o,l,e[t+2],15,718787259),l=ne(l,n,a,o,e[t+9],21,-343485551),o=Z(o,i),l=Z(l,r),n=Z(n,d),a=Z(a,s)}return[o,l,n,a]}(function(e){if(0===e.length)return[];const t=8*e.length,o=new Uint32Array(X(t));for(let l=0;l<t;l+=8)o[l>>5]|=(255&e[l/8])<<l%32;return o}(e),8*e.length))};Q.default=ae,Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var ie=de(F),re=de(Q);function de(e){return e&&e.__esModule?e:{default:e}}var se=(0,ie.default)("v3",48,re.default);P.default=se;var ue={},ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.default=void 0;var he={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};ce.default=he,Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var ge=me(ce),ve=me(C),fe=O;function me(e){return e&&e.__esModule?e:{default:e}}var we=function(e,t,o){if(ge.default.randomUUID&&!t&&!e)return ge.default.randomUUID();const l=(e=e||{}).random||(e.rng||ve.default)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){o=o||0;for(let e=0;e<16;++e)t[o+e]=l[e];return t}return(0,fe.unsafeStringify)(l)};ue.default=we;var pe={},ye={};function _e(e,t,o,l){switch(e){case 0:return t&o^~t&l;case 1:case 3:return t^o^l;case 2:return t&o^t&l^o&l}}function be(e,t){return e<<t|e>>>32-t}Object.defineProperty(ye,"__esModule",{value:!0}),ye.default=void 0;var Ce=function(e){const t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let o=0;o<t.length;++o)e.push(t.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const l=e.length/4+2,n=Math.ceil(l/16),a=new Array(n);for(let t=0;t<n;++t){const o=new Uint32Array(16);for(let l=0;l<16;++l)o[l]=e[64*t+4*l]<<24|e[64*t+4*l+1]<<16|e[64*t+4*l+2]<<8|e[64*t+4*l+3];a[t]=o}a[n-1][14]=8*(e.length-1)/Math.pow(2,32),a[n-1][14]=Math.floor(a[n-1][14]),a[n-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<n;++e){const l=new Uint32Array(80);for(let t=0;t<16;++t)l[t]=a[e][t];for(let e=16;e<80;++e)l[e]=be(l[e-3]^l[e-8]^l[e-14]^l[e-16],1);let n=o[0],i=o[1],r=o[2],d=o[3],s=o[4];for(let e=0;e<80;++e){const o=Math.floor(e/20),a=be(n,5)+_e(o,i,r,d)+s+t[o]+l[e]>>>0;s=d,d=r,r=be(i,30)>>>0,i=n,n=a}o[0]=o[0]+n>>>0,o[1]=o[1]+i>>>0,o[2]=o[2]+r>>>0,o[3]=o[3]+d>>>0,o[4]=o[4]+s>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]};ye.default=Ce,Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=void 0;var $e=Oe(F),De=Oe(ye);function Oe(e){return e&&e.__esModule?e:{default:e}}var We=(0,$e.default)("v5",80,De.default);pe.default=We;var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;Ue.default="00000000-0000-0000-0000-000000000000";var Me={};Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var Se=function(e){return e&&e.__esModule?e:{default:e}}(W);var Ie,Le,Ne,xe=function(e){if(!(0,Se.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)};Me.default=xe,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return i.default}});var t=u(b),o=u(P),l=u(ue),n=u(pe),a=u(Ue),i=u(Me),r=u(W),d=u(O),s=u(B);function u(e){return e&&e.__esModule?e:{default:e}}}(_),function(e){e.INTURN="Inturn",e.OUTTURN="Outturn",e.PLANNED="Planned",e.ESTIMATED="Estimated",e.INTURN_FINAL="Inturn Final"}(Ie||(Ie={})),function(e){e.WET_WEIGHT="wet_weight",e.DRY_WEIGHT="dry_weight"}(Le||(Le={})),function(e){e.METHOD="method",e.WET_WEIGHT_UOM="wet_weight_uom",e.MOISTURE_UOM="moisture_uom",e.DRY_WEIGHT_UOM="dry_weight_uom"}(Ne||(Ne={}));var Te=o({props:{value:{type:String,default:null}},emits:["input"],setup(t,{emit:o}){var i,r;const d=l([{text:"Method",value:"method",sortable:!1,width:150,align:"left"},{text:"Wet Weight",value:"wet_weight",sortable:!1,width:150,align:"left"},{text:"Moisture (%)",value:"moisture",sortable:!1,width:150,align:"left"},{text:"Dry Weight",value:"dry_weight",sortable:!1,width:150,align:"left"}]),s=l([{text:"To Delete",value:"delete",sortable:!1,width:60,align:"left"},{text:"Lot",value:"lot_number",sortable:!1,width:60,align:"left"},{text:"Wet Weight",value:"wet_weight",sortable:!1,width:150,align:"left"},{text:"Moisture (%)",value:"moisture",sortable:!1,width:150,align:"left"},{text:"Dry Weight",value:"dry_weight",sortable:!1,width:150,align:"left"}]),u=l(null),c="navarch_weight_lot",h="lot_number",g="navarch_contract",v="weight_uom",f="moisture_uom",m="methods",w="INVALID_ID",p="-- Select a method --",y="navarch_unit",b="symbol",C="wet_symbol",$="dry_symbol",D=l([]),O=l(-1),W=l([]),U=l([]),M=l([]),S=l([]),I=l(void 0),L=l([]),N=l(!1),x=l(!u.value),T=l(null),k=l(!1),A=l(!1),E=l(!1),V=l(!1);let j;const H=n("values",l({}));console.log(`[setup] weight lots table form values=${JSON.stringify(H.value)}`);let R=H.value.weight_result||H.value.weight_lot||H.value.weight_results||H.value.weight_lots;console.log(`[setup] weight lots table foreign key=${R}`),R||(R=_.v4(),console.log(`[setup] key generated for weight lots=${R}`));const P=e(),F=l(null===(i=u.value)||void 0===i?void 0:i.wetWeightUOM),B=l(null===(r=u.value)||void 0===r?void 0:r.dryWeightUOM),K=l([]);(async function(){return console.log("[getUnitsSelection]"),(await async function(e,t){return console.log("[getItems]"),(await P.get(`/items/${e}`,{params:{fields:t}})).data.data}(y,[b])).map((e=>({text:e[b],value:e[b]})))})().then((e=>{console.log("[getUnitsSelection]"),K.value=e}));const J=l([]),G=l([]);a(I,(e=>{e&&G.value[0]?(console.log("[setup::watcher] method selected, Deselection option added"),G.value[0].text="-- Deselect method --"):G.value[0]&&(console.log("[setup::watcher] method selected, Selection option added"),G.value[0].text=p)}));const q=l(void 0);return a((()=>H.value.contract),(async e=>{console.log(`[setup::watcher] change in contract field in the parcel form detected with a new id value=${e}`),q.value=e,await async function(e){if(console.log(`[getContractData] contract id=${e}`),!e)return u.value=null,void console.log("[getContractData] contract data has been cleared or is not selected");try{const t=(await P.get(`/items/${g}/${e}`,{params:{fields:[v,f,m]}})).data.data;!function(e){if(console.log("[validateContractData]"),!e)throw new Error("Contract data response is empty, please ensure the selected contract for this parcel still exists");if(!e[v])throw new Error("Contract field 'Weight UOM' is empty");if(!e[f])throw new Error("Contract field 'Moisture UOM' is empty");if(!e[f]||!Array.isArray(e[m]))throw new Error("Contract field 'Methods' is empty or not a list");console.log("[validateContractData] contract data validated")}(t);const o=await P.get(`/items/${y}/${t.weight_uom}`,{params:{fields:[C,$]}});!function(e){if(console.log("[validateDryWetWeightUom]"),!e)throw new Error("Weight uom response is empty, please ensure a valid weight UOM has been selected in the contract");if(!e.wet_symbol)throw new Error(`Contract field 'Weight UOM' may have an invalid 'Wet Symbol' field value of ${e.wet_symbol}, please ensure a valid UOM with a proper Wet Symbol is selected`);if(!e.dry_symbol)throw new Error(`Contract field 'Weight UOM' may have an invalid 'Dry Symbol' field value of ${e.dry_symbol}, please ensure a valid UOM with a proper Dry Symbol is selected`);console.log("[validateDryWetWeightUom] fetched uom for dry/wet weights are valid")}(o.data.data),u.value={wetWeightUOM:o.data.data[C],dryWeightUOM:o.data.data[$],moistureUOM:t[f],methods:t[m]},console.log(`[getContractData] contract data with id=${e} successfully fetched with methods=${u.value[m]}, moisture uom=${t[f]}, wet weight uom=${o.data.data[C]}, dry weight uom=${o.data.data[$]}`)}catch(e){T.value=e.message,console.error(`[getContractData] fetching the contract data went wrong due to: ${e}`)}}(e),function(){if(console.log("[assignMethodSelectionRef]"),!u.value)return console.error("[assignMethodSelectionRef] contract data is not defined"),void(J.value=[]);const e={text:p,value:void 0};J.value=[e,...u.value.methods.map((e=>({text:e,value:e})))],console.log(`[assignMethodSelectionRef] methods from contract=${u.value.methods.join(", ")}`),G.value=ne()}()}),{immediate:!0}),a(u,(e=>{console.log("[setup::watcher] contract data change detected"),e&&(F.value=e.wetWeightUOM,B.value=e.dryWeightUOM),x.value=!e})),P.get(`/items/${c}?filter[foreign_key]=${R}&sort[]=${h}`).then((async e=>{console.log(`[getWeightLots] weight lots fetched with id=${R}`),D.value=function(e){console.log("[evaluateWeights]");const t=Object.values(Ie),o={};for(const l of e)t.includes(l.method)?(o[l.method]||(console.log(`adding method ${l.method} to weightData object`),o[l.method]=[]),console.log(`adding lot ${l.id} to weightData.${l.method} array`),o[l.method.toString()].push(l)):console.error(`lot ${l.id} has invalid method ${l.method}`);const l=[];for(const e of t){if(!o[e]){console.log(`method=${e} does not exist in weightData object`);continue}console.log(`adding lots and other values to weights for method=${e}`);const t=te(o[e]);t&&l.push(t)}return l}(e.data.data)})).catch((e=>console.error(`[getWeightLots] fetching the weight lots with id=${R} went wrong due to=${e}`))),{weightTableHeaders:d,weightLotTableHeaders:s,weightUnits:K,wetWeightUnitSelection:F,dryWeightUnitSelection:B,methodSelection:G,sharedMethodForLots:I,selectedWeightForDrawerDisplay:L,weights:D,weightLotsToDisplay:W,weightLotsToDelete:S,weightLotsToUpdate:U,weightLotsToCreate:M,isOpen:V,isAddingNewWeightByMethod:N,isContractNotSelected:x,disableAddAssayButtonReason:T,confirmCloseDrawerOverlay:k,openConfirmCloseDrawerOverly:function(){console.log("[openConfirmCloseDrawerOverly]");U.value.length>0||S.value.length>0||M.value.length>0?(console.log("[openConfirmCloseDrawerOverly] changes present"),k.value=!0):(console.log("[openConfirmCloseDrawerOverly] no changes detected, closing drawer without confirmation popup"),Q())},closeConfirmCloseDrawerOverlay:z,confirmCloseDrawer:Q,confirmSaveOverlay:A,openConfirmSaveOverlay:function(){console.log("[openConfirmSaveOverlay]");U.value.length>0||S.value.length>0||M.value.length>0?A.value=!0:Z()},closeConfirmSaveOverlay:X,confirmSave:Z,confirmDeleteWeightOverlay:E,openConfirmDeleteWeightOverlay:function(){console.log("[openConfirmDeleteWeightOverlay]"),E.value=!0},closeConfirmDeleteWeightOverlay:ee,confirmDeleteWeight:function(){console.log("[confirmDeleteWeight]"),ee(),async function(){console.log("[deleteWeight]");try{const e=W.value.map((e=>e.id)),t=await P.delete(`/items/${c}`,{data:e.filter((e=>void 0!==e))});if(204!==t.status)throw new Error(`response status=${t.status} is not 204`);D.value.splice(O.value,1),console.log(`[deleteWeight] weight lots successfully deleted with ids=${e} for method=${D.value[O.value].method}`),Y()}catch(e){console.error(`[deleteWeight] deletion of weight with method=${D.value[O.value].method} failed with reason: '${e}'`)}}()},rowClickHandler:function(e){const t=e.item;console.log(`[rowClickHandler] weight lots with method=${t.method} selected`);const o=D.value.findIndex((e=>e.method===t.method));O.value=o,W.value=(l=t.lots,console.log("[cloneLots]"),[...l].map((e=>({...e})))),I.value=t.method,B.value=t.dry_weight_uom,F.value=t.wet_weight_uom,L.value=[t],Y(),console.log("[rowClickHandler] open drawer");var l},addNewWeightByMethod:function(){if(console.log("[addNewWeightByMethod]"),!u.value)return console.error("[addNewWeightByMethod] contract data is not defined. The add button should have been disabled"),[];N.value=!0,G.value=ne(),B.value=u.value.dryWeightUOM,F.value=u.value.wetWeightUOM,L.value=[{}],Y(),console.log("[addNewWeightByMethod] open drawer")},addNewWeightLot:function(){console.log(`[addNewWeightLot] is adding a new weight by method=${N.value}`);const e=_.v4();let t;N.value?t=I.value:-1!==O.value&&(t=D.value[O.value].method);const o={id:e,foreign_key:R,lot_number:W.value.length+1,method:t,dry_weight_uom:B.value,wet_weight_uom:F.value};W.value.push(o),M.value.push(e),console.log(`[addNewWeightLot] new lot generated with id=${e}, lot number=${o.lot_number} and method=${o.method} staged for creation`)},deleteButtonHandler:function(e){console.log(`[deleteButtonHandler] id=${e}`);const t=S.value.findIndex((t=>t===e));-1===t?(S.value.push(e),console.log(`[deleteButtonHandler] id=${e} pushed into weight lots to delete`)):(S.value.splice(t,1),console.log(`[deleteButtonHandler] id=${e} removed from weight lots to delete`))},deleteButtonTooltip:function(e){const t=S.value.findIndex((t=>t===e));if(-1===t)return"Remove Lot";return"Undo Removed Lot"},onKeyDown:function(e){console.log(`[onKeyDown] item=${e.id}`),!j||clearTimeout(j);j=setTimeout((()=>{var t,o,l;if(console.log("lot value is staged for update"),e.dry_weight&&e.wet_weight&&!e.moisture){e.moisture=(e.wet_weight-e.dry_weight)/e.wet_weight*100;const o=W.value.findIndex((t=>t.id===e.id));W.value[o]=e;-1===U.value.findIndex((t=>t===e.id))&&U.value.push(null!==(t=e.id)&&void 0!==t?t:w)}else if(e.dry_weight&&!e.wet_weight&&e.moisture){e.wet_weight=e.dry_weight/(1-e.moisture/100);const t=W.value.findIndex((t=>t.id===e.id));W.value[t]=e;-1===U.value.findIndex((t=>t===e.id))&&U.value.push(null!==(o=e.id)&&void 0!==o?o:w)}else if(!e.dry_weight&&e.wet_weight&&e.moisture){e.dry_weight=e.wet_weight*(1-e.moisture/100);const t=W.value.findIndex((t=>t.id===e.id));W.value[t]=e;-1===U.value.findIndex((t=>t===e.id))&&U.value.push(null!==(l=e.id)&&void 0!==l?l:w)}console.log(`[onKeyDown] item=${JSON.stringify(e)} staged for update`)}),500)},save:ae,toggleDrawer:Y,deleteIcon:function(e){const t=S.value.findIndex((t=>t===e));if(-1===t)return"close";return"settings_backup_restore"},colourDeleteIcon:function(e){const t=S.value.findIndex((t=>t===e));if(-1===t)return"v-icon-delete-button-small-foreground-subdued";return"v-icon-delete-button-small-red"},formatNumber:function(e,t=4,o=!0){if(isNaN(e)||null===e)return"-";const l=Math.round(e*Math.pow(10,t))/Math.pow(10,t),[n,a]=l.toString().split(".");if(!n)return"";const i=n.replace(/\B(?=(\d{3})+(?!\d))/g,",");if(!a&&!o)return i;const r=(null!=a?a:"").padEnd(t,"0");return`${i}.${r}`},isNullOrUndefined:function(e){return null==e}};function Y(){console.log("[toggleDrawer]"),V.value=!V.value,V.value?console.log("[toggleDrawer] open drawer"):(W.value=[],M.value=[],U.value=[],S.value=[],I.value=void 0,B.value=void 0,F.value=void 0,N.value=!1,L.value=[],console.log("[toggleDrawer] reset all values and close drawer"))}function z(){console.log("[closeConfirmCloseDrawerOverlay]"),k.value=!1}function Q(){console.log("[confirmCloseDrawer]"),z(),Y()}function X(){console.log("[closeConfirmSaveOverlay]"),A.value=!1}function Z(){console.log("[confirmSave]"),X(),ae()}function ee(){console.log("[closeConfirmDeleteWeightOverlay]"),E.value=!1}function te(e){if(console.log("[evaluateWeightData]"),0===e.length)return;const t=oe(e,Le.DRY_WEIGHT),o=oe(e,Le.WET_WEIGHT);return console.log(`[evaluateWeightData] method=${e[0].method}`),{method:le(e,Ne.METHOD),lots:e,dry_weight_uom:le(e,Ne.DRY_WEIGHT_UOM),wet_weight_uom:le(e,Ne.WET_WEIGHT_UOM),dry_weight:t,wet_weight:o,moisture:(o-t)/o*100}}function oe(e,t){console.log(`[evaluateAggregateValue] lots method=${e[0].method}`);const o=e.reduce(((e,o)=>{var l;return e+(null!==(l=o[t.toString()])&&void 0!==l?l:0)}),0);return console.log(`[evaluateAggregateValue] aggregate value=${o}`),o}function le(e,t){if(console.log("[getFirstValueAsSharedValue]"),0!==e.length)return console.log(`[getFirstValueAsSharedValue] ${t.toString()}=${e[0][t.toString()]}`),e[0][t.toString()]}function ne(){console.log("[filterUnusedMethods]");const e=D.value.map((e=>e.method)),t=[...J.value.filter((t=>!e.includes(t.value)))];return console.log(`[filterUnusedMethods] unused methods=${t.join(", ")}`),t}async function ae(){console.log("[save]"),console.log("[syncStagedChanges]"),console.log("[removeDeletedIdsFromCreateList]"),S.value.forEach((e=>{const t=M.value.findIndex((t=>t===e));-1!==t&&(M.value.splice(t,1),console.log(`[removeDeletedIdsFromCreateList] removed lot with id=${e}`))})),console.log("[removeCreatedIdsFromUpdateList]"),M.value.forEach((e=>{const t=U.value.findIndex((t=>t===e));-1!==t&&(U.value.splice(t,1),console.log(`[removeCreatedIdsFromUpdateList] removed lot with id=${e}`))})),console.log("[removeDeletedIdsFromUpdateList]"),S.value.forEach((e=>{const t=U.value.findIndex((t=>t===e));-1!==t&&(U.value.splice(t,1),console.log(`[removeDeletedIdsFromUpdateList] removed lot with id=${e}`))})),console.log("[syncStagedChanges] staged changes synced"),S.value.length>0&&(console.log(`[save] weightLotsToDelete=${S.value.length}; ${JSON.stringify(S.value)}`),await async function(){if(console.log("[deleteWeightLots]"),S.value.length<=0)return void console.log("[deleteWeightLots] No weight lots to delete");try{const e=await P.delete(`/items/${c}`,{data:S.value});if(204!==e.status)throw new Error(`response status=${e.status} is not 204`);W.value=W.value.filter((e=>{var t;return!S.value.includes(null!==(t=e.id)&&void 0!==t?t:w)}));const t=W.value.map(((e,t)=>({id:e.id,lot_number:t+1}))),o=await P.patch(`/items/${c}?sort[]=${h}`,t);W.value=o.data.data,console.log(`[deleteWeightLots] weight lots deleted with ids=${JSON.stringify(S.value)}`)}catch(e){console.error(`[deleteWeightLots] deletion of lots with ids=${JSON.stringify(S.value)} failed with reason='${e}'`)}}()),M.value.length>0&&(console.log(`[save] weightLotsToCreate=${M.value.length}; ${JSON.stringify(M.value)}`),await async function(){if(console.log(`[createWeightLots] weight lots created=${JSON.stringify(M.value)} with weight lots key=${R}`),M.value.length<=0)return void console.log("[createWeightLots] No weight lots to create with weight lots key=${foreign_key}");if(!I.value)return void console.error("[createWeightLots] No shared method for lots with weight lots key=${foreign_key}");const e=W.value.filter((e=>{var t;return M.value.includes(null!==(t=e.id)&&void 0!==t?t:w)})).map((e=>({...e,dry_weight_uom:B.value,wet_weight_uom:F.value})));try{const t=await P.post(`/items/${c}?sort[]=${h}`,e);if(200!==t.status)throw new Error(`[createWeightLots] response status=${t.status} is not 200`);console.log(`[createWeightLots] ${t.data.data.length} lots successfully created with weight lots key=${R}`);for(const e of t.data.data){const t=W.value.findIndex((e=>void 0===e.id));W.value[t]=e}N.value?(console.log(`[createWeightLots] new weight by method added, method=${I.value} with weight lots key=${R}`),D.value.push({method:I.value,lots:W.value}),O.value=D.value.length-1):-1!==O.value&&(console.log(`[createWeightLots] weight lots created for existing method=${I.value} with weight lots key=${R}`),D.value[O.value].lots=W.value),console.log(`[createWeightLots] weight lots created=${JSON.stringify(M.value)} with weight lots key=${R}`)}catch(e){console.error("[createWeightLots] Error creating weight lots",e)}}()),U.value.length>0&&(console.log(`[save] weightLotsToUpdate=${U.value.length}; ${JSON.stringify(U.value)}`),await async function(){if(console.log(`[updateWeightLots] weight lots to update with ids=${JSON.stringify(U.value)}`),0===U.value.length)return;const e=U.value.map((e=>W.value.find((t=>t.id===e))));try{const t=await P.patch(`/items/${c}`,e);console.log(`[updateWeightLots] ${t.data.data.length} weight lots updated`);for(const e of t.data.data){const t=W.value.findIndex((t=>t.id===e.id));W.value[t]=e}console.log("[updateWeightLots] Weight lots updated")}catch(e){console.error(`[updateWeightLots] patching for lots=${U.value} failed with reason: '${e}'`)}}()),D.value[O.value].lots=W.value,D.value[O.value]=te(D.value[O.value].lots),D.value=D.value.filter((e=>!!e)),console.log("[save] saving operation completed"),void 0!==H.value.weight_result&&null!==H.value.weight_result||(console.log(`[save] emitting input event with weight lot foreign_key=${R}`),o("input",R)),Y()}}});const ke=e=>(p("data-v-64969d30"),e=e(),y(),e),Ae={class:"drawer-content"},Ee={class:"input-label"},Ve=["disabled"],je=ke((()=>h("div",{class:"input-label"},"Method",-1))),He=ke((()=>h("div",{class:"input-label"},"Weight Lots",-1)));var Re=[],Pe=[];!function(e,t){if(e&&"undefined"!=typeof document){var o,l=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,a="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var i=Re.indexOf(a);-1===i&&(i=Re.push(a)-1,Pe[i]={}),o=Pe[i]&&Pe[i][l]?Pe[i][l]:Pe[i][l]=r()}else o=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),o.styleSheet?o.styleSheet.cssText+=e:o.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var o=Object.keys(t.attributes),n=0;n<o.length;n++)e.setAttribute(o[n],t.attributes[o[n]]);var i="prepend"===l?"afterbegin":"beforeend";return a.insertAdjacentElement(i,e),e}}('.weight-table .table-row[data-v-64969d30] {\n  height: 30px;\n}\n.weight-table .weight_cell[data-v-64969d30] {\n  width: 100%;\n}\n.weight-table .header_cell_with_input[data-v-64969d30] {\n  height: 60px;\n}\n.margin-top-16px[data-v-64969d30] {\n  margin-top: 16px;\n}\n.v-icon-white[data-v-64969d30] {\n  --v-icon-color: #ffffff;\n}\n.v-icon-purple[data-v-64969d30] {\n  --v-icon-color: #8866FF;\n}\n.v-icon-delete-button-small-foreground-subdued[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--foreground-subdued);\n}\n.v-icon-delete-button-small-red[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--red);\n}\n.v-button-red-on-hover[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--background-normal);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--red);\n}\n.v-button-red[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--danger);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--danger-125);\n}\n.drawer-content[data-v-64969d30] {\n  padding: 0 32px 40px;\n}\n.weight-drawer[data-v-64969d30] {\n  max-width: 1500px !important;\n}\n.input-label[data-v-64969d30] {\n  color: #f0f6fc;\n  font-weight: 600;\n  font-size: 16px;\n  font-family: "Inter", -apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n  font-style: normal;\n  line-height: 19px;\n  margin-bottom: 8px;\n  padding-top: 20px;\n}',{}),Te.render=function(e,t,o,l,n,a){const p=i("v-table"),y=i("v-button"),_=i("v-icon"),b=i("v-select"),C=i("v-input"),$=i("v-drawer"),D=i("v-card-title"),O=i("v-card-text"),W=i("v-card-actions"),U=i("v-card"),M=i("v-dialog"),S=r("tooltip");return d(),s("div",null,[u(p,{class:"weight-table",headers:e.weightTableHeaders,items:e.weights,rowHeight:30,"onClick:row":t[0]||(t[0]=t=>e.rowClickHandler(t)),fixedHeader:"",inline:""},{"item.wet_weight":c((({item:t})=>[h("div",null,g(`${e.formatNumber(t.wet_weight)}${e.isNullOrUndefined(t.wet_weight)?"":t.wet_weight_uom}`),1)])),"item.moisture":c((({item:t})=>[h("div",null,g(e.formatNumber(t.moisture)),1)])),"item.dry_weight":c((({item:t})=>[h("div",null,g(`${e.formatNumber(t.dry_weight)}${e.isNullOrUndefined(t.dry_weight)?"":t.dry_weight_uom}`),1)])),_:2},1032,["headers","items"]),v((d(),f(y,{onClick:t[1]||(t[1]=()=>e.addNewWeightByMethod()),class:"margin-top-16px",disabled:e.isContractNotSelected},{default:c((()=>[m("Add Weight")])),_:1},8,["disabled"])),[[S,e.isContractNotSelected?e.disableAddAssayButtonReason??"Cannot save without a contract selected":null,void 0,{bottom:!0}]]),u($,{modelValue:e.isOpen,"onUpdate:modelValue":t[3]||(t[3]=t=>e.isOpen=t),onToggle:e.openConfirmCloseDrawerOverly,onCancel:e.openConfirmCloseDrawerOverly,icon:"scale",title:"Edit Weights",subtitle:"Weight Lots"},{actions:c((()=>[v((d(),f(y,{rounded:"",disabled:e.isContractNotSelected,onClick:e.openConfirmSaveOverlay,icon:""},{default:c((()=>[u(_,{name:"check"})])),_:1},8,["disabled","onClick"])),[[S,e.isContractNotSelected?e.disableAddAssayButtonReason??"Cannot save without a contract selected":null,void 0,{bottom:!0}]]),v((d(),f(y,{class:"v-button-red-on-hover",rounded:"",onClick:e.openConfirmDeleteWeightOverlay,disabled:e.isContractNotSelected,icon:""},{default:c((()=>[u(_,{name:"delete"})])),_:1},8,["onClick","disabled"])),[[S,e.isContractNotSelected?e.disableAddAssayButtonReason??"Changes cannot be made without a contract selected":null,void 0,{bottom:!0}]])])),default:c((()=>[h("div",Ae,[h("div",Ee,g("Weight Result"+(e.sharedMethodForLots?` for ${e.sharedMethodForLots}`:"")),1),u(p,{class:"weight-table",headers:e.weightTableHeaders,items:e.selectedWeightForDrawerDisplay,rowHeight:30,fixedHeader:"",inline:""},{"item.wet_weight":c((({item:t})=>[h("div",null,g(`${e.formatNumber(t.wet_weight)}${e.isNullOrUndefined(t.wet_weight)?"":t.wet_weight_uom}`),1)])),"item.moisture":c((({item:t})=>[h("div",null,g(e.formatNumber(t.moisture)),1)])),"item.dry_weight":c((({item:t})=>[h("div",null,g(`${e.formatNumber(t.dry_weight)}${e.isNullOrUndefined(t.dry_weight)?"":t.dry_weight_uom}`),1)])),_:2},1032,["headers","items"]),h("fieldset",{disabled:e.isContractNotSelected},[je,u(b,{modelValue:e.sharedMethodForLots,"onUpdate:modelValue":t[2]||(t[2]=t=>e.sharedMethodForLots=t),items:e.methodSelection,disabled:!e.isAddingNewWeightByMethod},null,8,["modelValue","items","disabled"]),He,u(p,{class:"weight-table",headers:e.weightLotTableHeaders,items:e.weightLotsToDisplay,rowHeight:30,fixedHeader:"",inline:""},{"header.wet_weight":c((({header:t})=>[h("div",null,g(`${t.text} (${e.wetWeightUnitSelection})`),1)])),"header.dry_weight":c((({header:t})=>[h("div",null,g(`${t.text} (${e.dryWeightUnitSelection})`),1)])),"item.delete":c((({item:t})=>[v(u(_,{class:w(e.colourDeleteIcon(t.id)),name:e.deleteIcon(t.id),onClick:()=>e.deleteButtonHandler(t.id)},null,8,["class","name","onClick"]),[[S,e.deleteButtonTooltip(t.id),void 0,{top:!0}]])])),"item.wet_weight":c((({item:t})=>[u(C,{class:"weight_cell",modelValue:e.weightLotsToDisplay[t.lot_number-1].wet_weight,"onUpdate:modelValue":o=>e.weightLotsToDisplay[t.lot_number-1].wet_weight=o,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["modelValue","onUpdate:modelValue","onKeydown"])])),"item.moisture":c((({item:t})=>[u(C,{class:"weight_cell",modelValue:e.weightLotsToDisplay[t.lot_number-1].moisture,"onUpdate:modelValue":o=>e.weightLotsToDisplay[t.lot_number-1].moisture=o,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["modelValue","onUpdate:modelValue","onKeydown"])])),"item.dry_weight":c((({item:t})=>[u(C,{class:"weight_cell",modelValue:e.weightLotsToDisplay[t.lot_number-1].dry_weight,"onUpdate:modelValue":o=>e.weightLotsToDisplay[t.lot_number-1].dry_weight=o,placeholder:0,type:"number",onKeydown:()=>e.onKeyDown(t),nullable:!0},null,8,["modelValue","onUpdate:modelValue","onKeydown"])])),_:2},1032,["headers","items"]),v((d(),f(y,{class:"margin-top-16px",disabled:e.isContractNotSelected||void 0===e.sharedMethodForLots,onClick:e.addNewWeightLot},{default:c((()=>[m(" Add New Lot ")])),_:1},8,["disabled","onClick"])),[[S,e.isContractNotSelected?e.disableAddAssayButtonReason??"Cannot add new lot without a contract selected":void 0===e.sharedMethodForLots?"Cannot add new lot without a method selected":null,void 0,{bottom:!0}]])],8,Ve)])])),_:1},8,["modelValue","onToggle","onCancel"]),u(M,{modelValue:e.confirmCloseDrawerOverlay,"onUpdate:modelValue":t[4]||(t[4]=t=>e.confirmCloseDrawerOverlay=t)},{default:c((()=>[u(U,null,{default:c((()=>[u(D,null,{default:c((()=>[m("Unsaved changes")])),_:1}),u(O,null,{default:c((()=>[m("Are you sure you want to leave this page?")])),_:1}),u(W,null,{default:c((()=>[u(y,{secondary:"",onClick:e.confirmCloseDrawer},{default:c((()=>[m("Discard Changes")])),_:1},8,["onClick"]),u(y,{onClick:e.closeConfirmCloseDrawerOverlay},{default:c((()=>[m("Keep Editing")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(M,{modelValue:e.confirmSaveOverlay,"onUpdate:modelValue":t[5]||(t[5]=t=>e.confirmSaveOverlay=t)},{default:c((()=>[u(U,null,{default:c((()=>[u(D,null,{default:c((()=>[m("New changes made")])),_:1}),u(O,null,{default:c((()=>[m("The changes will be saved even if other changes to the Parcel is not saved. Are you sure you want to save?")])),_:1}),u(W,null,{default:c((()=>[u(y,{secondary:"",onClick:e.closeConfirmSaveOverlay},{default:c((()=>[m("Keep Editing")])),_:1},8,["onClick"]),u(y,{onClick:e.confirmSave},{default:c((()=>[m("Save Changes")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(M,{modelValue:e.confirmDeleteWeightOverlay,"onUpdate:modelValue":t[6]||(t[6]=t=>e.confirmDeleteWeightOverlay=t)},{default:c((()=>[u(U,null,{default:c((()=>[u(D,null,{default:c((()=>[m(g(`Delete ${e.sharedMethodForLots?`${e.sharedMethodForLots} `:""}weights`),1)])),_:1}),u(O,null,{default:c((()=>[m("This action is permanent and can not be undone. Are you sure you would like to proceed?")])),_:1}),u(W,null,{default:c((()=>[u(y,{secondary:"",onClick:e.closeConfirmDeleteWeightOverlay},{default:c((()=>[m("Keep Editing")])),_:1},8,["onClick"]),u(y,{class:"v-button-red",onClick:e.confirmDeleteWeight},{default:c((()=>[m("Delete")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])},Te.__scopeId="data-v-64969d30",Te.__file="src/interface.vue";var Fe=t({id:"weight_table",name:"Weight Table",icon:"box",description:"Custom interface for weights",component:Te,options:null,types:["string"],group:"standard"});export{Fe as default};
