import{useApi as e,useStores as t,useExtensions as l}from"@directus/extensions-sdk";import{defineComponent as n,inject as i,ref as o,toRef as r,watch as a,openBlock as s,createElementBlock as c,createBlock as d,resolveDynamicComponent as u,mergeProps as p,createCommentVNode as f}from"vue";var m=n({props:{value:{type:String,default:null},currentCollection:{type:String,default:null},listenedField:{type:[String],default:null}},emits:["input"],setup(n,{attrs:s,emit:c}){const d=i("values",o({})),{listenedField:u,currentCollection:p}=n,f=r(n,"value");console.log(`prefiller::current collection: ${p}`),console.log(`prefiller::listened field: ${u}`);const m=u[0].split(".");let v="",g="";m.length>=2&&(v=m[0],g=m[1]);const y=e(),{useRelationsStore:h}=t(),$=h().getRelationForField(p,v).related_collection;a((()=>d.value[v]),(async e=>{console.log("prefiller::id watchedValue: "+e),null!=e&&null==f.value&&(console.log(`prefiller::fetching ${g} from ${$}`),async function(e,t,l){return console.log(`prefiller::fetching ${JSON.stringify(e)} from ${t} in getItems with id ${l}`),(await y.get(`/items/${t}/${l}?${e.map((e=>`fields[]=${e}`)).join("&")}`)).data.data}([g],$,e).then((async e=>{let t=e[g];null!=t&&t!==f.value&&c("input",t)})))}));const{interfaces:C}=l(),{component:_}=C.value.find((e=>"select-dropdown-m2o"===e.id));return{values:d,attrs:s,DropdownM2OComponent:_,handleChange:function(e){c("input",e)}}}});m.render=function(e,t,l,n,i,o){return s(),c("div",null,[(s(),d(u(e.DropdownM2OComponent),p(e.attrs,{value:e.value,onInput:e.handleChange}),null,16,["value","onInput"])),f(" <div>Contract: {{values['contract']}}</div>\r\n\t\t<div>CounterpartyV2: {{values['counterparty_v2']}}</div>\r\n\t\t<div>Counterparty: {{values['counterparty']}}</div>\r\n\t\t<div>Estimated Arrival Date: {{values['estimate_arrival_date']}}</div>\r\n\t\t<div>Assay Lots Foreign Key: {{values['assay_results']}}</div>\r\n\t\t<div>Weight Lots Foreign Key: {{values['weight_result']}}</div> ")])},m.__file="src/interface.vue";var v={id:"navarch-prefilling-select-dropdown-m2o",name:" Navarch Prefilling M2O Extension",description:"Functions like the default Directus M2O interface but can be prefilled with a default value in response to another field in the same collection",icon:"arrow_right_alt",component:m,types:["uuid","string","text","integer","bigInteger"],relational:!0,localTypes:["m2o"],group:"relational",options:({relations:e,collection:t})=>{var l;const n=null==(l=e.m2o)?void 0:l.related_collection;return[{field:"template",name:"$t:interfaces.select-dropdown-m2o.display_template",meta:{interface:"system-display-template",options:{collectionName:n}}},{field:"listenedField",name:"Field to Watch",meta:{interface:"system-fields",options:{collectionName:t}}},{field:"currentCollection",name:"Current Collection Name",meta:{interface:"input"}},{field:"filter",name:"$t:filter",type:"json",meta:{interface:"system-filter",options:{collectionName:n}}}]},recommendedDisplays:["related-values"]};export{v as default};
