import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{ref as a,defineComponent as i,inject as l,watch as o,resolveComponent as n,resolveDirective as r,openBlock as d,createElementBlock as s,Fragment as c,createCommentVNode as h,createVNode as u,renderList as g,withDirectives as v,createBlock as p,withCtx as w,createTextVNode as m,toDisplayString as f,createElementVNode as b,normalizeClass as W,pushScopeId as D,popScopeId as y}from"vue";const I=[];for(let e=0;e<256;++e)I.push((e+256).toString(16).slice(1));let C;const $=new Uint8Array(16);function S(){if(!C){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");C=crypto.getRandomValues.bind(crypto)}return C($)}var _={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function L(e,t,a){if(_.randomUUID&&!t&&!e)return _.randomUUID();const i=(e=e||{}).random||(e.rng||S)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=i[e];return t}return function(e,t=0){return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}(i)}const R="related_parcel",E="lot_number",M="method",k="contract",x="navarch_weight_lot",U="dry_weight",O="wet_weight",P="wet_weight_uom",A="dry_weight_uom",F="moisture",N="weight_uom",T="moisture_uom",V="methods",B="wet_symbol",K="dry_symbol";var H=(e=>(e[e.Estimated=0]="Estimated",e[e.Planned=10]="Planned",e[e.Inturn=20]="Inturn",e[e["Inturn Final"]=30]="Inturn Final",e[e.Outturn=40]="Outturn",e))(H||{}),j=Object.defineProperty,J=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,G=(e,t,a)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;function Q(e,t){return e.reduce(((e,a)=>{var i,l;return e+(null!=(l=Number(null!=(i=a[t])?i:"0"))?l:0)}),0)}function X(e,t){if(null==e)return"--";const a=ae(e,4,!0);return null==t?`${a}`:`${a}${t}`}function Y(e,t){var a;return 0!==e.length&&e[0]&&null!=(a=e[0][t])?a:null}function Z(e){return null==e}function ee(e){const t=H[e];if(!t&&isNaN(t))throw new Error(`Invalid method type ${e}, please contact Navarch for support`);return t}function te(e,t=2,a=!1){if(null==e||isNaN(e))return null;const i=a&&e<0;return i&&(e*=-1),Math.round(e*Math.pow(10,t))/Math.pow(10,t)*(i?-1:1)}function ae(e,t=2,a=!0){if(isNaN(e)||null==e)return"-";const i=Math.round(e*Math.pow(10,t))/Math.pow(10,t),[l,o]=i.toString().split("."),n=l?l.replace(/\B(?=(\d{3})+(?!\d))/g,","):"0";if(!o&&!a)return n;return`${n}.${(null!=o?o:"").padEnd(t,"0")}`}function ie(e){return e.map((e=>((e,t)=>{for(var a in t||(t={}))q.call(t,a)&&G(e,a,t[a]);if(J)for(var a of J(t))z.call(t,a)&&G(e,a,t[a]);return e})({},e)))}const le=a([{text:"Method",value:"method",sortable:!1,width:120,align:"left"},{text:"Wet Weight",value:"wetWeight",sortable:!1,width:150,align:"left"},{text:"Moisture",value:"moisture",sortable:!1,width:150,align:"left"},{text:"Dry Weight",value:"dryWeight",sortable:!1,width:150,align:"left"}]),oe=a([{text:"Wet Weight",value:"compositeWetWeight",sortable:!1,width:150,align:"left"},{text:"Moisture",value:"compositeMoisture",sortable:!1,width:150,align:"left"},{text:"Dry Weight",value:"compositeDryWeight",sortable:!1,width:150,align:"left"}]),ne=a([{text:"To Delete",value:"delete",sortable:!1,width:60,align:"left"},{text:"Lot",value:"lot_number",sortable:!1,width:60,align:"left"},{text:"Wet Weight",value:"wet_weight",sortable:!1,width:200,align:"left"},{text:"Moisture (%)",value:"moisture",sortable:!1,width:200,align:"left"},{text:"Dry Weight",value:"dry_weight",sortable:!1,width:200,align:"left"}]),re="Selecting a contract for this parcel is required to create/edit weight lots",de="Cannot edit weight lot data to a finalised parcel",se="Please save the parcel before inputting weight lot data",ce="Contract data could not be fetched",he="Please select a method first before adding a new weight lot",ue="The dry/wet weight UOMs are not set, please ensure a weight unit has been selected for measuring weight lots in the associated contract";var ge=null;function ve(e,t){const a=e.indexOf(t);a>-1&&e.splice(a,1)}function pe(e,t){e.includes(t)||e.push(t)}var we=i({props:{value:{type:String,default:null}},emits:["input"],setup(t,{emit:i}){const n=e(),r=l("values",a({})),d={},{logInfo:s,logError:c,logWarning:h,logDebug:u}=function(e){return{logInfo:t=>{e.post("/log",{message:t,level:"info"})},logError:t=>{e.post("/log",{message:t,level:"error"})},logWarning:t=>{e.post("/log",{message:t,level:"warning"})},logDebug:t=>{e.post("/log",{message:t,level:"debug"})}}}(n);ge={logInfo:s,logError:c,logWarning:h,logDebug:u};const g=a({create:[],update:[],delete:[]});o(g,(e=>{s(`[navarch-parcellots-weight-v2:watch:editedWeightLotIds:parcelId=${r.value.id}] new edited ids=${JSON.stringify(e)}`),null!==f.value.saveFunctionDisabledReason&&(g.value.create.length>0||g.value.update.length>0||g.value.delete.length>0)&&(s(`[navarch-parcellots-weight-v2:watch:editedWeightLotIds:parcelId=${r.value.id}] changes detected, enabling save functionality`),f.value.saveFunctionDisabledReason=null),null===f.value.saveFunctionDisabledReason&&0===g.value.create.length&&0===g.value.update.length&&0===g.value.delete.length&&(s(`[navarch-parcellots-weight-v2:watch:editedWeightLotIds:parcelId=${r.value.id}] all changes reverted, disabling save functionality if previously enabled`),f.value.saveFunctionDisabledReason="Make changes to the weight lots to enable saving")}),{deep:!0});const v=a({Estimated:null,Planned:null,Inturn:null,"Inturn Final":null,Outturn:null}),p=a([]),w=a([]);o(v,(e=>{s(`[navarch-parcellots-weight-v2:watch:weightLotsByMethod:parcelId=${r.value.id}] new weight lots=${JSON.stringify(e)}`),p.value=Object.values(e).filter((e=>!!e))}),{deep:!0});const m=a([]);o(m,(e=>{s(`[navarch-parcellots-weight-v2:watch:methodSelection:parcelId=${r.value.id}] new method selection=${JSON.stringify(e)}`)}),{deep:!0});const f=a({selectedFilters:{methodsSelected:{}},isConfirmSavePopupOpen:!1,isConfirmDeletePopupOpen:!1,isConfirmClosePopupOpen:!1,isAddingNewWeightByMethod:!1,isLoadingWhilePatching:!1,isCompositeWeightRecalculatedWithEditedLots:!0,contractData:null,editingDisabledReason:r.value.id?[]:[se],saveFunctionDisabledReason:null,isDrawerOpen:!1,editableWeightInDrawer:null});return o(f,(e=>{s(`[navarch-parcellots-weight-v2:watch:interfaceState:parcelId=${r.value.id}] new state=${JSON.stringify(e)}`)}),{deep:!0,immediate:!0}),o((()=>r.value[k]),(async e=>{if(s(`[navarch-parcellots-weight-v2:watch:contract field:parcelId=${r.value.id}] new contract id=${e}`),!e)return f.value.contractData=null,void pe(f.value.editingDisabledReason,re);D()}),{immediate:!0}),o((()=>r.value.id),(e=>{s(`[navarch-parcellots-weight-v2:watch:id field:parcelId=${e}] new parcel id=${e}`),function(e){if(s(`[navarch-parcellots-weight-v2:fetchAndProcessWeightLotsIfExistsForThisParcel:parcelId=${r.value.id}] start with param parcelID=${e}, the parcel id is defined=${!!e}`),!e)return pe(f.value.editingDisabledReason,se),void s(`[navarch-parcellots-weight-v2:fetchAndProcessWeightLotsIfExistsForThisParcel:parcelId=${r.value.id}] parcelID is not defined, stopping fetch`);ve(f.value.editingDisabledReason,se),n.get(`/items/${x}`,{params:{filter:{[R]:{_eq:e}},sort:[E],fields:["id",E,M,O,P,F,U,A]}}).then((e=>{const t=e.data.data,a=t.filter((e=>null===e[E]));u(`[navarch-parcellots-weight-v2:fetchAndProcessWeightLotsIfExistsForThisParcel:parcelId=${r.value.id}] fetched weight lots=${JSON.stringify(a)}`);const i={Estimated:null,Planned:null,Inturn:null,"Inturn Final":null,Outturn:null};for(const e of a){if(i[e.method])throw new Error(`More than one composite weight found for method ${e.method} for this parcel`);i[e.method]={id:e.id,method:e.method,wetWeight:e[O],wetWeightUom:e[P],moisture:e[F],dryWeight:e[U],dryWeightUom:e[A],lots:t.filter((t=>t.method===e.method&&null!==t[E]))}}v.value=i,s(`[navarch-parcellots-weight-v2:fetchAndProcessWeightLotsIfExistsForThisParcel:parcelId=${r.value.id}] weight lots successfully fetched and processed`)})).catch((e=>{c(`[navarch-parcellots-weight-v2:fetchAndProcessWeightLotsIfExistsForThisParcel:parcelId=${r.value.id}] fetch weight lots API call failed with reason: ${e}`)}))}(e),e&&(u(`[navarch-parcellots-weight-v2:id field:watch:parcelId=${e}] parcel ID is not defined`),ve(f.value.editingDisabledReason,se))}),{immediate:!0}),o((()=>r.value.parcel_finalised),(async e=>{r.value.id&&(s(`[navarch-parcellots-weight-v2:watch:parcel finalised field:parcelId=${r.value.id}] change in parcel finalised field in the parcel form detected with a new value=${e}`),e?pe(f.value.editingDisabledReason,de):ve(f.value.editingDisabledReason,de))}),{immediate:!0}),o((()=>f.value.selectedFilters.methodsSelected),(e=>{s(`[navarch-parcellots-weight-v2:watch:filterSelection:parcelId=${r.value.id}] new filter selection=${JSON.stringify(e)}`),p.value&&0!==p.value.length?w.value=p.value.filter((t=>Z(e[t.method])||!!e[t.method])):w.value=[]}),{deep:!0,immediate:!0}),{weightLotsByMethod:v,filteredWeightLotsByMethodListForDisplay:w,interfaceState:f,methodSelection:m,onKeyDownInWeightLotEditorCell:function(e,t,a){if(s(`[navarch-parcellots-weight-v2:onKeyDownInWeightLotEditorCell:parcelId=${r.value.id}] started`),"Enter"===a.code||"NumpadEnter"===a.code)return function(e){var t,a,i;s(`[navarch-parcellots-weight-v2:onFocusNextWeightLotEditorCell:parcelId=${r.value.id}] started`);const l=null==(t=e.target||e.srcElement)?void 0:t.id;if(!l)return void c("currentElementId is not defined");if(!/weightlots-(\w)+-(\d)+/.test(l))return void c(`current element id=${l} is not in the correct format`);const[o,n,d]=l.split("-"),h=parseInt(d),u=parseInt(n);let g=`${o}-`;if(Array.isArray(null==(a=f.value.editableWeightInDrawer)?void 0:a.editableLots)&&h<f.value.editableWeightInDrawer.editableLots.length)g+=`${u}-${h+1}`;else{const e=3===u;g+=`${e?u:u+1}-${e?h:1}`}null==(i=document.getElementById(g))||i.focus(),s(`[navarch-parcellots-weight-v2:onFocusNextWeightLotEditorCell:parcelId=${r.value.id}] completed`)}(a),void s(`[navarch-parcellots-weight-v2:onKeyDownInWeightLotEditorCell:parcelId=${r.value.id}] completed, focusing on the next field`);d[e.id]&&clearTimeout(d[e.id]);d[e.id]=setTimeout((()=>{!function(e,t){s(`[navarch-parcellots-weight-v2:onReevaluateWeightLotEditorCells:parcelId=${r.value.id}] started`);let a=!1;if(e.wet_weight&&e.moisture&&e.dry_weight)switch(t){case"wet_weight":e.wet_weight=te(e.wet_weight,4),e.moisture=te((e.wet_weight-e.dry_weight)/e.wet_weight*100,4),a=!0;break;case"moisture":e.moisture=te(e.moisture,4),e.dry_weight=te(e.wet_weight*(1-e.moisture/100),4),a=!0;break;case"dry_weight":e.dry_weight=te(e.dry_weight,4),e.moisture=te((e.wet_weight-e.dry_weight)/e.wet_weight*100,4),a=!0}else e.wet_weight&&e.moisture&&!e.dry_weight?(e.dry_weight=te(e.wet_weight*(1-e.moisture/100),4),u(`[navarch-parcellots-weight-v2:onReevaluateWeightLotEditorCells:parcelId=${r.value.id}] wet weight=${e.wet_weight}; moisture=${e.moisture}; evaluated dry weight=${e.dry_weight}`),a=!0):e.wet_weight&&!e.moisture&&e.dry_weight?(e.moisture=te((e.wet_weight-e.dry_weight)/e.wet_weight*100,4),u(`[navarch-parcellots-weight-v2:onReevaluateWeightLotEditorCells:parcelId=${r.value.id}] wet weight=${e.wet_weight}; dry weight=${e.dry_weight}; evaluated moisture=${e.moisture}`),a=!0):!e.wet_weight&&e.moisture&&e.dry_weight&&(e.wet_weight=te(e.dry_weight/(1-e.moisture/100),4),u(`[navarch-parcellots-weight-v2:onReevaluateWeightLotEditorCells:parcelId=${r.value.id}] moisture=${e.moisture}; dry weight=${e.dry_weight}; evaluated wet weight=${e.wet_weight}`),a=!0);if(a){-1===g.value.update.indexOf(e.id)&&(f.value.isCompositeWeightRecalculatedWithEditedLots=!1,g.value.update.push(e.id))}s(`[navarch-parcellots-weight-v2:onReevaluateWeightLotEditorCells:parcelId=${r.value.id}] completed`)}(e,t)}),500),s(`[navarch-parcellots-weight-v2:onKeyDownInWeightLotEditorCell:parcelId=${r.value.id}] completed`)},onMainWeightLotTableRowClick:function(e){var t,a,i,l,o;s(`[navarch-parcellots-weight-v2:onMainWeightLotTableRowClick:parcelId=${r.value.id}] started with item=${JSON.stringify(e.item)}`);const n=e.item;f.value.isDrawerOpen=!0,f.value.saveFunctionDisabledReason="Make changes to the weight lots first before saving",f.value.editableWeightInDrawer={compositeWeightId:n.id,commonMethodDisplay:n.method,commonDryWeightUom:null!=(t=n.dryWeightUom)?t:"-",commonWetWeightUom:null!=(a=n.wetWeightUom)?a:"-",compositeDryWeight:null!=(i=n.dryWeight)?i:null,compositeWetWeight:null!=(l=n.wetWeight)?l:null,compositeMoisture:null!=(o=n.moisture)?o:null,editableLots:ie(n.lots)}},WeightCompositeTableHeaders:le,WeightCompositeTableInDrawerHeaders:oe,WeightLotTableHeaders:ne,formatNumber:ae,displayValueAndUnit:X,getMethodRank:ee,onDrawerClickDeleteWeightLotButton:function(e){s(`[navarch-parcellots-weight-v2:onDrawerClickDeleteWeightLotButton:parcelId=${r.value.id}] started`);const t=g.value.delete.indexOf(e);-1===t?(f.value.isCompositeWeightRecalculatedWithEditedLots=!1,g.value.delete.push(e)):(f.value.isCompositeWeightRecalculatedWithEditedLots=!1,g.value.delete.splice(t,1));s(`[navarch-parcellots-weight-v2:onDrawerClickDeleteWeightLotButton:parcelId=${r.value.id}] completed`)},onDrawerClickAddWeightLot:function(){var e,t,a,i;if(s(`[navarch-parcellots-weight-v2:onDrawerClickAddWeightLot:parcelId=${r.value.id}] started`),!(null==(e=f.value.editableWeightInDrawer)?void 0:e.commonMethodDisplay))return pe(f.value.editingDisabledReason,he),void s(`[navarch-parcellots-weight-v2:onDrawerClickAddWeightLot:parcelId=${r.value.id}] completed, commonMethodDisplay is null, cannot add new weight lot`);if(ve(f.value.editingDisabledReason,he),!(null==(t=f.value.editableWeightInDrawer)?void 0:t.commonDryWeightUom)||!(null==(a=f.value.editableWeightInDrawer)?void 0:a.commonWetWeightUom))return void pe(f.value.editingDisabledReason,ue);ve(f.value.editingDisabledReason,ue),Array.isArray(null==(i=f.value.editableWeightInDrawer)?void 0:i.editableLots)||(f.value.editableWeightInDrawer.editableLots=[]);if(!r.value.id)return void c(`[navarch-parcellots-weight-v2:onDrawerClickAddWeightLot:parcelId=${r.value.id}] parcel id is not set, cannot add new weight lot`);const l={id:L(),lot_number:f.value.editableWeightInDrawer.editableLots.length+1,method:f.value.editableWeightInDrawer.commonMethodDisplay,dry_weight_uom:f.value.editableWeightInDrawer.commonDryWeightUom,wet_weight_uom:f.value.editableWeightInDrawer.commonWetWeightUom,related_parcel:r.value.id};f.value.editableWeightInDrawer.editableLots.push(l),f.value.isCompositeWeightRecalculatedWithEditedLots=!1,g.value.create.push(l.id),s(`[navarch-parcellots-weight-v2:onDrawerClickAddWeightLot:parcelId=${r.value.id}] completed`)},onDrawerClose:function(){s(`[navarch-parcellots-weight-v2:onDrawerClose:parcelId=${r.value.id}] started`);g.value.create.length>0||g.value.update.length>0||g.value.delete.length>0?f.value.isConfirmClosePopupOpen=!0:W();s(`[navarch-parcellots-weight-v2:onDrawerClose:parcelId=${r.value.id}] completed`)},onConfirmDrawerClose:function(){s(`[navarch-parcellots-weight-v2:onConfirmDrawerClose:parcelId=${r.value.id}] started`),f.value.isConfirmClosePopupOpen=!1,W(),s(`[navarch-parcellots-weight-v2:onConfirmDrawerClose:parcelId=${r.value.id}] completed`)},onConfirmDrawerSave:async function(){s(`[navarch-parcellots-weight-v2:onConfirmSave:parcelId=${r.value.id}] started`),f.value.isConfirmSavePopupOpen=!1,f.value.isLoadingWhilePatching=!0,await async function(){var e,t,a,i;s(`[navarch-parcellots-weight-v2:saveWeightLotChanges:parcelId=${r.value.id}] started`),s(`[navarch-parcellots-weight-v2:stageAllChanges:parcelId=${r.value.id}] started`),g.value.create=g.value.create.filter((e=>!g.value.delete.includes(e))),g.value.create=[...new Set(g.value.create)],g.value.update=g.value.update.filter((e=>!g.value.delete.includes(e))),g.value.update=[...new Set(g.value.update)],g.value.update=g.value.update.filter((e=>!g.value.create.includes(e))),s(`[navarch-parcellots-weight-v2:stageAllChanges:parcelId=${r.value.id}] completed`);try{if(await async function(){if(s(`[navarch-parcellots-weight-v2:updateExistingWeightLots:parcelId=${r.value.id}] started`),g.value.update.length<=0)return void s(`[navarch-parcellots-weight-v2:updateExistingWeightLots:parcelId=${r.value.id}] completed, no weight lots to update`);const e=g.value.update.map((e=>{var t;return null===f.value.editableWeightInDrawer?(h(`[navarch-parcellots-weight-v2:updateExistingWeightLots:parcelId=${r.value.id}] something went wrong, list of edited weight lots is null`),null):null!=(t=f.value.editableWeightInDrawer.editableLots.find((t=>t.id===e)))?t:null}));u(`[navarch-parcellots-weight-v2:updateExistingWeightLots:parcelId=${r.value.id}] lotsToUpdate=${JSON.stringify(e)}`);const t=await n.patch(`/items/${x}`,e);if(200!==t.status)throw new Error(`Failed to update weight lots: ${t.statusText}`);s(`[navarch-parcellots-weight-v2:updateExistingWeightLots:parcelId=${r.value.id}] completed`)}(),await async function(){if(s(`[navarch-parcellots-weight-v2:createNewWeightLots:parcelId=${r.value.id}] started`),g.value.create.length<=0)return void s(`[navarch-parcellots-weight-v2:createNewWeightLots:parcelId=${r.value.id}] completed, no weight lots to create`);const e=g.value.create.map((e=>{var t;return null===f.value.editableWeightInDrawer?(h(`[navarch-parcellots-weight-v2:createNewWeightLots:parcelId=${r.value.id}] something went wrong, list of edited weight lots is null`),null):null!=(t=f.value.editableWeightInDrawer.editableLots.find((t=>t.id===e)))?t:null}));u(`[navarch-parcellots-weight-v2:createNewWeightLots:parcelId=${r.value.id}] lotsToCreate=${JSON.stringify(e)}`);const t=await n.post(`/items/${x}`,e);if(200!==t.status)throw new Error(`Failed to create weight lots: ${t.statusText}`);s(`[navarch-parcellots-weight-v2:createNewWeightLots:parcelId=${r.value.id}] completed`)}(),await async function(){if(s(`[navarch-parcellots-weight-v2:deleteExistingWeightLots:parcelId=${r.value.id}] started`),g.value.delete.length<=0)return void s(`[navarch-parcellots-weight-v2:deleteExistingWeightLots:parcelId=${r.value.id}] completed, no weight lots to delete`);const e=await n.delete(`/items/${x}`,{data:g.value.delete});if(204!==e.status)throw new Error(`Failed to delete weight lots: ${e.status}`);if(null===f.value.editableWeightInDrawer)return void h(`[navarch-parcellots-weight-v2:deleteExistingWeightLots:parcelId=${r.value.id}] something went wrong, list of edited weight lots is null`);const t=f.value.editableWeightInDrawer.editableLots.filter((e=>!g.value.delete.includes(e.id))).map(((e,t)=>({id:e.id,lot_number:t+1}))),a=await n.patch(`/items/${x}`,t);if(200!==a.status)throw new Error(`Failed to patch weight lots numbers after deletion of weight lots: ${a.statusText}`);f.value.editableWeightInDrawer.editableLots=a.data.data.sort(((e,t)=>e.lot_number-t.lot_number)),s(`[navarch-parcellots-weight-v2:deleteExistingWeightLots:parcelId=${r.value.id}] completed`)}(),f.value.isCompositeWeightRecalculatedWithEditedLots||y(),await async function(){var e,t,a;if(!f.value.editableWeightInDrawer)throw c(`[navarch-parcellots-weight-v2:saveCompositeWeight:parcelId=${r.value.id}] editableWeightInDrawer is not set, cannot save composite weight`),new Error("Editable weight in drawer is not set, cannot save composite weight");if(!f.value.editableWeightInDrawer.commonMethodDisplay)throw c(`[navarch-parcellots-weight-v2:saveCompositeWeight:parcelId=${r.value.id}] commonMethodDisplay is not set, cannot save composite weight, the Save button in the drawer should have been disabled through  the 'saveFunctionDisabledReason' property in the interfaceState`),new Error("Method is not set in the drawer, cannot save composite weight");const i={id:f.value.editableWeightInDrawer.compositeWeightId,lot_number:null,method:f.value.editableWeightInDrawer.commonMethodDisplay,dry_weight:null!=(e=f.value.editableWeightInDrawer.compositeDryWeight)?e:void 0,dry_weight_uom:f.value.editableWeightInDrawer.commonDryWeightUom,wet_weight:null!=(t=f.value.editableWeightInDrawer.compositeWetWeight)?t:void 0,wet_weight_uom:f.value.editableWeightInDrawer.commonWetWeightUom,moisture:null!=(a=f.value.editableWeightInDrawer.compositeMoisture)?a:void 0,related_parcel:r.value.id};let l;l=f.value.isAddingNewWeightByMethod?await n.post(`/items/${x}`,i):await n.patch(`/items/${x}/${i.id}`,i);if(200!==l.status)throw new Error(`Failed to save composite weight: ${l.statusText}`)}(),!(null==(e=f.value.editableWeightInDrawer)?void 0:e.commonMethodDisplay))throw new Error("Method is not set in the drawer, cannot save weight lots");v.value[f.value.editableWeightInDrawer.commonMethodDisplay]={id:f.value.editableWeightInDrawer.compositeWeightId,method:f.value.editableWeightInDrawer.commonMethodDisplay,dryWeight:null!=(t=f.value.editableWeightInDrawer.compositeDryWeight)?t:void 0,dryWeightUom:f.value.editableWeightInDrawer.commonDryWeightUom,wetWeight:null!=(a=f.value.editableWeightInDrawer.compositeWetWeight)?a:void 0,wetWeightUom:f.value.editableWeightInDrawer.commonWetWeightUom,moisture:null!=(i=f.value.editableWeightInDrawer.compositeMoisture)?i:void 0,lots:f.value.editableWeightInDrawer.editableLots}}catch(e){c(`[navarch-parcellots-weight-v2:saveWeightLotChanges:parcelId=${r.value.id}] failed with reason: ${e}`)}s(`[navarch-parcellots-weight-v2:saveWeightLotChanges:parcelId=${r.value.id}] completed`)}(),f.value.isLoadingWhilePatching=!1,W(),s(`[navarch-parcellots-weight-v2:onConfirmSave:parcelId=${r.value.id}] completed`)},onDrawerSave:function(){s(`[navarch-parcellots-weight-v2:onSaveClicked:parcelId=${r.value.id}] started`),f.value.isConfirmSavePopupOpen=!0,s(`[navarch-parcellots-weight-v2:onSaveClicked:parcelId=${r.value.id}] completed`)},onDrawerDeleteWeight:function(){s(`[navarch-parcellots-weight-v2:onDrawerDeleteWeight:parcelId=${r.value.id}] started`),f.value.isConfirmDeletePopupOpen=!0,s(`[navarch-parcellots-weight-v2:onDrawerDeleteWeight:parcelId=${r.value.id}] completed`)},onConfirmDrawerDeleteWeight:async function(){s(`[navarch-parcellots-weight-v2:onConfirmDeleteWeight:parcelId=${r.value.id}] started`),f.value.isConfirmDeletePopupOpen=!1,f.value.isLoadingWhilePatching=!0,await async function(){if(s(`[navarch-parcellots-weight-v2:deleteWeight:parcelId=${r.value.id}] started`),!f.value.editableWeightInDrawer)return void h(`[navarch-parcellots-weight-v2:deleteWeight:parcelId=${r.value.id}] editableWeightInDrawer is null, cannot delete weight lots`);if(Z(f.value.editableWeightInDrawer.commonMethodDisplay))return void s(`[navarch-parcellots-weight-v2:deleteWeight:parcelId=${r.value.id}] completed, commonMethodDisplay is null, no weight lots to delete`);const e=f.value.editableWeightInDrawer.editableLots.map((e=>e.id));e.push(f.value.editableWeightInDrawer.compositeWeightId);const t=await n.delete(`/items/${x}`,{data:e});if(204!==t.status)return void c(`[navarch-parcellots-weight-v2:deleteWeight:parcelId=${r.value.id}] failed to delete weight lots, received response with status code: ${t.status}`);v.value[f.value.editableWeightInDrawer.commonMethodDisplay]=null,s(`[navarch-parcellots-weight-v2:deleteWeight:parcelId=${r.value.id}] completed`)}(),f.value.isLoadingWhilePatching=!1,W(),s(`[navarch-parcellots-weight-v2:onConfirmDeleteWeight:parcelId=${r.value.id}] completed`)},onMainPageClickAddWeight:function(){if(s(`[navarch-parcellots-weight-v2:onMainPageClickAddWeight:parcelId=${r.value.id}] started`),!f.value.contractData)return void h(`[navarch-parcellots-weight-v2:onMainPageClickAddWeight:parcelId=${r.value.id}] contract data not loaded yet, cannot add new weight lot`);f.value.isAddingNewWeightByMethod=!0,function(){if(s("[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=${formValues.value.id}] start"),!f.value.contractData)return m.value=[],void s("[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=${formValues.value.id}] completed with no contract data found");const e=f.value.contractData.methods.map((e=>({value:e,text:e})));u(`[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=\${formValues.value.id}] allMethodSelectionInContract=${JSON.stringify(e)}`),Object.keys(v.value).forEach((t=>{if(u(`[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=${r.value.id}] ${t};;${JSON.stringify(v.value[t])}`),v.value[t]){u(`[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=${r.value.id}] removing method ${t} (rank: ${H[t]}) from selectable methods`);const a=e.findIndex((e=>e.value===t));e.splice(a,1)}})),m.value=e,s(`[navarch-parcellots-weight-v2:setSelectableMethodSelection:parcelId=\${formValues.value.id}] completed for parcel id=${r.value.id}`)}(),f.value.saveFunctionDisabledReason="Select a method and add new weight lots first before saving",f.value.isDrawerOpen=!0,f.value.editableWeightInDrawer={compositeWeightId:L(),commonMethodDisplay:null,compositeDryWeight:null,commonDryWeightUom:f.value.contractData.dryWeightUom,compositeWetWeight:null,commonWetWeightUom:f.value.contractData.wetWeightUom,compositeMoisture:null,editableLots:[]},s(`[navarch-parcellots-weight-v2:onMainPageClickAddWeight:parcelId=${r.value.id}] completed`)},onHoverWeightLotDeleteButtonForTooltip:function(e){const t=g.value.delete.indexOf(e);if(-1===t)return"Remove Lot";return"Undo Removed Lot"},onRefetchContractData:D,onRecalculateCompositeWeight:y,onFilterChipClicked:function(e){s(`[navarch-parcellots-weight-v2:onFilterChipClicked:parcelId=${r.value.id}] started with method clicked=${e}`),f.value.selectedFilters.methodsSelected[e]=!f.value.selectedFilters.methodsSelected[e],s(`[navarch-parcellots-weight-v2:onFilterChipClicked:parcelId=${r.value.id}] completed`)},getDeleteIconName:function(e){const t=g.value.delete.findIndex((t=>t===e));if(-1===t)return"close";return"settings_backup_restore"},getDeleteIconColour:function(e){const t=g.value.delete.findIndex((t=>t===e));if(-1===t)return"v-icon-delete-button-small-foreground-subdued";return"v-icon-delete-button-small-red"}};async function b(e){s(`[navarch-parcellots-weight-v2:getContractData:parcelId=${r.value.id}] start with param contractId=${e}`);try{ve(f.value.editingDisabledReason,ce),ve(f.value.editingDisabledReason,re);const t=(await n.get(`/items/navarch_contract/${e}`,{params:{fields:[N,T,V]}})).data.data;!function(e){if(null==ge||ge.logInfo("[navarch-parcellots-weight-v2:validateContractData] started"),!e)throw new Error("Contract data response is empty, please ensure the selected contract for this parcel still exists");if(!e[N])throw new Error("Contract field 'Weight UOM' is empty");if(!e[T])throw new Error("Contract field 'Moisture UOM' is empty");if(!e[V]||!Array.isArray(e[V])||0===e[V].length)throw new Error("Contract field 'Methods' is empty or not a list");null==ge||ge.logInfo("[navarch-parcellots-weight-v2:validateContractData] contract data validated")}(t);const a=await n.get(`/items/navarch_unit/${t.weight_uom}`,{params:{fields:[B,K]}});!function(e){if(null==ge||ge.logInfo("[navarch-parcellots-weight-v2:validateDryWetWeightUom] started"),!e)throw new Error("Weight uom response is empty, please ensure a valid weight UOM has been selected in the contract");if(!e[B])throw new Error(`Contract field 'Weight UOM' may have an invalid 'Wet Symbol' field value of ${e.wet_symbol}, please ensure a valid UOM with a proper Wet Symbol is selected`);if(!e[K])throw new Error(`Contract field 'Weight UOM' may have an invalid 'Dry Symbol' field value of ${e.dry_symbol}, please ensure a valid UOM with a proper Dry Symbol is selected`);null==ge||ge.logInfo("[navarch-parcellots-weight-v2:validateDryWetWeightUom] fetched uom for dry/wet weights are valid")}(a.data.data),f.value.contractData={wetWeightUom:a.data.data[B],dryWeightUom:a.data.data[K],moistureUom:t[T],methods:t[V]};const i={};f.value.contractData.methods.forEach((e=>{i[e]=!0})),f.value.selectedFilters.methodsSelected=i,s(`[navarch-parcellots-weight-v2:getContractData:parcelId=${r.value.id}] completed`)}catch(e){pe(f.value.editingDisabledReason,ce),c(`[navarch-parcellots-weight-v2:getContractData:parcelId=${r.value.id}] failed with reason: ${e}`)}}function W(){f.value.saveFunctionDisabledReason=null,f.value.isDrawerOpen=!1,f.value.isCompositeWeightRecalculatedWithEditedLots=!0,f.value.editableWeightInDrawer=null,f.value.isAddingNewWeightByMethod=!1,ve(f.value.editingDisabledReason,he),ve(f.value.editingDisabledReason,ue),g.value={create:[],update:[],delete:[]}}async function D(){s(`[navarch-parcellots-weight-v2:onRefetchContractData:parcelId=${r.value.id}] started`),r.value[k]?(await b(r.value[k]),s(`[navarch-parcellots-weight-v2:onRefetchContractData:parcelId=${r.value.id}] completed`)):s(`[navarch-parcellots-weight-v2:onRefetchContractData:parcelId=${r.value.id}] contract field is not set, cannot refetch contract data`)}function y(){var e,t,a,i,l,o,n,d,h;if(s(`[navarch-parcellots-weight-v2:onRecalculateCompositeWeight:parcelId=${r.value.id}] started`),!(null==(e=f.value.editableWeightInDrawer)?void 0:e.editableLots))return void c(`[navarch-parcellots-weight-v2:onRecalculateCompositeWeight:parcelId=${r.value.id}] editableLots is not set, cannot recalculate composite weight`);const u=function(e){if(0===e.length)return null;const t=Q(e,"dry_weight"),a=Q(e,"wet_weight");return{method:Y(e,"method"),lots:e,dryWeightUom:Y(e,"dry_weight_uom"),wetWeightUom:Y(e,"wet_weight_uom"),dryWeight:te(t,4),wetWeight:te(a,4),moisture:te((a-t)/a*100,4)}}(f.value.editableWeightInDrawer.editableLots.filter((e=>!g.value.delete.includes(e.id))));f.value.editableWeightInDrawer={compositeWeightId:f.value.editableWeightInDrawer.compositeWeightId,compositeDryWeight:null!=(t=null==u?void 0:u.dryWeight)?t:null,commonDryWeightUom:null!=(i=null==(a=f.value.contractData)?void 0:a.dryWeightUom)?i:"-",compositeWetWeight:null!=(l=null==u?void 0:u.wetWeight)?l:null,commonWetWeightUom:null!=(n=null==(o=f.value.contractData)?void 0:o.wetWeightUom)?n:"-",compositeMoisture:null!=(d=null==u?void 0:u.moisture)?d:null,commonMethodDisplay:null!=(h=null==u?void 0:u.method)?h:null,editableLots:f.value.editableWeightInDrawer.editableLots},f.value.isCompositeWeightRecalculatedWithEditedLots=!0,s(`[navarch-parcellots-weight-v2:onRecalculateCompositeWeight:parcelId=${r.value.id}] completed`)}}});const me=e=>(D("data-v-64969d30"),e=e(),y(),e),fe={key:0,class:"filter"},be={class:"margin-top-16px"},We={key:0,class:"drawer-content"},De=me((()=>b("div",{class:"input-label"},"Method",-1))),ye=me((()=>b("div",{class:"input-label"},"Composite Weight Results",-1))),Ie={key:0,class:"margin-top-16px"},Ce=me((()=>b("div",{class:"input-label"},"Weight Lots",-1))),$e={class:"margin-top-16px"},Se=me((()=>b("div",null,"Something went wrong with displaying the weight lots, please contact Navarch with a screenshot of this",-1)));var _e=[],Le=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,i=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var n=_e.indexOf(o);-1===n&&(n=_e.push(o)-1,Le[n]={}),a=Le[n]&&Le[n][i]?Le[n][i]:Le[n][i]=r()}else a=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var n="prepend"===i?"afterbegin":"beforeend";return o.insertAdjacentElement(n,e),e}}('.weight-table .table-row[data-v-64969d30] {\n  height: 30px;\n}\n.weight-table .weight_cell[data-v-64969d30] {\n  width: 100%;\n}\n.weight-table .header_cell_with_input[data-v-64969d30] {\n  height: 60px;\n}\n.margin-top-16px[data-v-64969d30] {\n  margin-top: 16px;\n}\n.margin-left-16px[data-v-64969d30] {\n  margin-left: 16px;\n}\n.secondary-button[data-v-64969d30] {\n  --v-button-background-color: var(--background-page);\n  --v-button-color: var(--primary);\n  border: 1px solid var(--primary);\n  border-radius: var(--border-radius);\n}\n.secondary-button[data-v-64969d30]:disabled {\n  border-radius: var(--border-radius);\n}\n.secondary-button[data-v-64969d30]:hover {\n  border-color: var(--v-button-background-color-hover);\n  --v-button-color: inherit;\n}\n.v-icon-white[data-v-64969d30] {\n  --v-icon-color: #ffffff;\n}\n.v-icon-purple[data-v-64969d30] {\n  --v-icon-color: #8866FF;\n}\n.v-icon-delete-button-small-foreground-subdued[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--foreground-subdued);\n}\n.v-icon-delete-button-small-red[data-v-64969d30] {\n  --v-icon-size: 18px;\n  --v-icon-color: var(--red);\n}\n.v-button-red-on-hover[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--background-normal);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--red);\n}\n.v-button-red[data-v-64969d30] {\n  --v-button-color: var(--white);\n  --v-button-background-color: var(--danger);\n  --v-button-color-hover: var(--white);\n  --v-button-background-color-hover: var(--danger-125);\n}\n.drawer-content[data-v-64969d30] {\n  padding: 0 32px 40px;\n}\n.weight-drawer[data-v-64969d30] {\n  max-width: 1500px !important;\n}\n.input-label[data-v-64969d30] {\n  color: #f0f6fc;\n  font-weight: 600;\n  font-size: 16px;\n  font-family: "Inter", -apple-system, "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n  font-style: normal;\n  line-height: 19px;\n  margin-bottom: 8px;\n  padding-top: 20px;\n}\n.filter[data-v-64969d30] {\n  margin-bottom: 8px;\n  display: flex;\n  flex-direction: row;\n  gap: 8px;\n}',{}),we.render=function(e,t,a,i,l,o){const D=n("v-overlay"),y=n("v-chip"),I=n("v-table"),C=n("v-button"),$=n("v-icon"),S=n("v-notice"),_=n("v-select"),L=n("v-input"),R=n("v-drawer"),E=n("v-card-title"),M=n("v-card-text"),k=n("v-card-actions"),x=n("v-card"),U=n("v-dialog"),O=r("tooltip");return d(),s(c,null,[h(" Darkened area over the UI when loading "),u(D,{active:e.interfaceState.isLoadingWhilePatching,clickable:!1},null,8,["active"]),e.interfaceState.contractData?.methods?(d(),s("div",fe,[(d(!0),s(c,null,g(e.interfaceState.contractData.methods,(t=>v((d(),p(y,{key:t,outlined:!e.interfaceState.selectedFilters.methodsSelected[t],onClick:()=>e.onFilterChipClicked(t)},{default:w((()=>[m(f(t),1)])),_:2},1032,["outlined","onClick"])),[[O,e.interfaceState.selectedFilters.methodsSelected[t]?`Click to hide ${t} weight lots`:`Click to show ${t} weight lots`]]))),128))])):h("v-if",!0),h(" Displayed in the Parcel form "),u(I,{class:"weight-table",headers:e.WeightCompositeTableHeaders,items:e.filteredWeightLotsByMethodListForDisplay,rowHeight:30,"onClick:row":e.onMainWeightLotTableRowClick,fixedHeader:"",inline:""},{"item.wetWeight":w((({item:t})=>[b("div",null,f(e.displayValueAndUnit(t.wetWeight,t.wetWeightUom)),1)])),"item.moisture":w((({item:t})=>[b("div",null,f(`${e.formatNumber(t.moisture,4,!0)}%`),1)])),"item.dryWeight":w((({item:t})=>[b("div",null,f(e.displayValueAndUnit(t.dryWeight,t.dryWeightUom)),1)])),_:2},1032,["headers","items","onClick:row"]),h(" Needs to be disabled through the editing Disabled Reason in the interface state OR by the contract data being null "),b("div",be,[v((d(),p(C,{onClick:e.onMainPageClickAddWeight,disabled:!!e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData},{default:w((()=>[m(" Add Weight ")])),_:1},8,["onClick","disabled"])),[[O,e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData?e.interfaceState.editingDisabledReason[0]??(e.interfaceState.contractData?"Editing is disabled":"Please select a contract first"):"Click to add a new weight lot by method"]])]),h(" Displayed when the Drawer is open to show Weight Lots by Method "),u(R,{modelValue:e.interfaceState.isDrawerOpen,"onUpdate:modelValue":t[1]||(t[1]=t=>e.interfaceState.isDrawerOpen=t),onToggle:e.onDrawerClose,onCancel:e.onDrawerClose,icon:"scale",title:`Edit ${e.interfaceState?.editableWeightInDrawer?.commonMethodDisplay?e.interfaceState?.editableWeightInDrawer?.commonMethodDisplay+" ":""}Weight`,subtitle:"Weight Lots"},{actions:w((()=>[v((d(),p(C,{rounded:"",onClick:e.onConfirmDrawerSave,disabled:!!e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData||!!e.interfaceState.saveFunctionDisabledReason,icon:""},{default:w((()=>[u($,{name:"check"})])),_:1},8,["onClick","disabled"])),[[O,e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData||e.interfaceState.saveFunctionDisabledReason?e.interfaceState.editingDisabledReason[0]??e.interfaceState.saveFunctionDisabledReason??"Editing has been disabled":null,void 0,{bottom:!0}]]),v((d(),p(C,{class:"v-button-red-on-hover",rounded:"",onClick:e.onDrawerDeleteWeight,disabled:!!e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData,icon:""},{default:w((()=>[u($,{name:"delete"})])),_:1},8,["onClick","disabled"])),[[O,e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData?e.interfaceState.editingDisabledReason[0]??"Editing has been disabled":null,void 0,{bottom:!0}]])])),default:w((()=>[e.interfaceState.editableWeightInDrawer?(d(),s("div",We,[e.interfaceState.editingDisabledReason.length>0?(d(),p(S,{key:0,type:"warning"},{default:w((()=>[m(f(`Editing disabled due to: ${e.interfaceState.editingDisabledReason[0]}`),1)])),_:1})):h("v-if",!0),b("fieldset",null,[h(' <fieldset v-if="!!interfaceState.editableWeightInDrawer" :disabled="((!!interfaceState.editingDisabledReason && interfaceState.editingDisabledReason.length > 0) || !interfaceState.contractData)"> '),De,u(_,{modelValue:e.interfaceState.editableWeightInDrawer.commonMethodDisplay,"onUpdate:modelValue":t[0]||(t[0]=t=>e.interfaceState.editableWeightInDrawer.commonMethodDisplay=t),items:e.methodSelection,disabled:!e.interfaceState.isAddingNewWeightByMethod},null,8,["modelValue","items","disabled"]),ye,h(" interfaceState.editableWeightInDrawer should not be null, but just in case, default to empty array "),u(I,{class:"weight-table",headers:e.WeightCompositeTableInDrawerHeaders,items:e.interfaceState.editableWeightInDrawer?[e.interfaceState.editableWeightInDrawer]:[],rowHeight:30,fixedHeader:"",inline:""},{"item.compositeWetWeight":w((({item:t})=>[b("div",null,[h(" compositeWetWeight is either a valid number or is null, isNaN returns false for null so can't use that "),m(" "+f(e.displayValueAndUnit(t.compositeWetWeight,t.commonWetWeightUom)),1)])])),"item.compositeMoisture":w((({item:t})=>[b("div",null,f(e.displayValueAndUnit(t.compositeMoisture,"%")),1)])),"item.compositeDryWeight":w((({item:t})=>[b("div",null,[h(" compositeDryWeight is either a valid number or is null, isNaN returns false for null so can't use that "),m(" "+f(e.displayValueAndUnit(t.compositeDryWeight,t.commonDryWeightUom)),1)])])),_:2},1032,["headers","items"]),e.interfaceState.editableWeightInDrawer?(d(),s("div",Ie,[v((d(),p(C,{disabled:!!e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData||!e.interfaceState.editableWeightInDrawer.commonMethodDisplay,onClick:e.onRecalculateCompositeWeight},{default:w((()=>[m(" Evaluate Composite ")])),_:1},8,["disabled","onClick"])),[[O,e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData?e.interfaceState.editingDisabledReason[0]??"Editing has been disabled":e.interfaceState.editableWeightInDrawer.commonMethodDisplay?"Recalculate the composite weight data based on the weight lots currently entered":"Cannot evaluate composite value without a method selected",void 0,{bottom:!0}]])])):h("v-if",!0),h(" Table with editable cells to enter each weight lot data "),Ce,u(I,{class:"weight-table",headers:e.WeightLotTableHeaders,items:e.interfaceState.editableWeightInDrawer.editableLots,rowHeight:30,fixedHeader:"",inline:""},{"header.wet_weight":w((({header:t})=>[b("div",null,f(`${t.text} (${e.interfaceState.editableWeightInDrawer.commonWetWeightUom})`),1)])),"header.dry_weight":w((({header:t})=>[b("div",null,f(`${t.text} (${e.interfaceState.editableWeightInDrawer.commonDryWeightUom})`),1)])),"item.delete":w((({item:t})=>[v(u($,{class:W(e.getDeleteIconColour(t.id)),name:e.getDeleteIconName(t.id),onClick:()=>e.onDrawerClickDeleteWeightLotButton(t.id)},null,8,["class","name","onClick"]),[[O,e.onHoverWeightLotDeleteButtonForTooltip(t.id),void 0,{top:!0}]])])),"item.wet_weight":w((({item:t})=>[u(L,{class:"weight_cell",modelValue:t.wet_weight,"onUpdate:modelValue":e=>t.wet_weight=e,placeholder:0,type:"number",onKeydown:a=>e.onKeyDownInWeightLotEditorCell(t,"wet_weight",a),nullable:!0,id:`weightlots-1-${t.lot_number}`},null,8,["modelValue","onUpdate:modelValue","onKeydown","id"])])),"item.moisture":w((({item:t})=>[u(L,{class:"weight_cell",modelValue:t.moisture,"onUpdate:modelValue":e=>t.moisture=e,placeholder:0,type:"number",onKeydown:a=>e.onKeyDownInWeightLotEditorCell(t,"moisture",a),nullable:!0,id:`weightlots-2-${t.lot_number}`},null,8,["modelValue","onUpdate:modelValue","onKeydown","id"])])),"item.dry_weight":w((({item:t})=>[u(L,{class:"weight_cell",modelValue:t.dry_weight,"onUpdate:modelValue":e=>t.dry_weight=e,placeholder:0,type:"number",onKeydown:a=>e.onKeyDownInWeightLotEditorCell(t,"dry_weight",a),nullable:!0,id:`weightlots-3-${t.lot_number}`},null,8,["modelValue","onUpdate:modelValue","onKeydown","id"])])),_:2},1032,["headers","items"]),b("div",$e,[v((d(),p(C,{disabled:!!e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData||!e.interfaceState.editableWeightInDrawer.commonMethodDisplay,onClick:e.onDrawerClickAddWeightLot},{default:w((()=>[m(" Add New Lot ")])),_:1},8,["disabled","onClick"])),[[O,e.interfaceState.editingDisabledReason&&e.interfaceState.editingDisabledReason.length>0||!e.interfaceState.contractData?e.interfaceState.editingDisabledReason[0]??"Editing has been disabled":e.interfaceState.editableWeightInDrawer.commonMethodDisplay?null:"Cannot add new lot without a method selected",void 0,{bottom:!0}]])])])])):(d(),s(c,{key:1},[h(" This div below absolutely should not be shown at all, it means the interfaceState.editableWeightInDrawer is null and the drawer should never be opened in this case "),Se],2112))])),_:1},8,["modelValue","onToggle","onCancel","title"]),h(" Confirmation popups when exiting or performing a save or delete operation "),u(U,{modelValue:e.interfaceState.isConfirmSavePopupOpen,"onUpdate:modelValue":t[3]||(t[3]=t=>e.interfaceState.isConfirmSavePopupOpen=t)},{default:w((()=>[h(" This will be disabled "),u(x,null,{default:w((()=>[u(E,null,{default:w((()=>[m("New changes made")])),_:1}),u(M,null,{default:w((()=>[m("The changes will be saved even if other changes to the Parcel is not saved. Are you sure you want to save?")])),_:1}),u(k,null,{default:w((()=>[u(C,{secondary:"",onClick:t[2]||(t[2]=()=>e.interfaceState.isConfirmSavePopupOpen=!1)},{default:w((()=>[m("Keep Editing")])),_:1}),u(C,{loading:e.interfaceState.isLoadingWhilePatching,onClick:e.onConfirmDrawerSave},{default:w((()=>[m("Save Changes")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(U,{modelValue:e.interfaceState.isConfirmDeletePopupOpen,"onUpdate:modelValue":t[5]||(t[5]=t=>e.interfaceState.isConfirmDeletePopupOpen=t)},{default:w((()=>[u(x,null,{default:w((()=>[e.interfaceState.editableWeightInDrawer?.commonMethodDisplay?(d(),p(E,{key:0},{default:w((()=>[m(f(`Delete ${e.interfaceState.editableWeightInDrawer.commonMethodDisplay.toLowerCase()} weights`),1)])),_:1})):(d(),p(E,{key:1},{default:w((()=>[m("Delete weights")])),_:1})),h(" This should never be shown, but just in case "),u(M,null,{default:w((()=>[m("This action is permanent and can not be undone. Are you sure you would like to proceed?")])),_:1}),u(k,null,{default:w((()=>[u(C,{secondary:"",onClick:t[4]||(t[4]=()=>e.interfaceState.isConfirmDeletePopupOpen=!1)},{default:w((()=>[m("Keep Editing")])),_:1}),u(C,{class:"v-button-red",loading:e.interfaceState.isLoadingWhilePatching,onClick:e.onConfirmDrawerDeleteWeight},{default:w((()=>[m("Delete")])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(U,{modelValue:e.interfaceState.isConfirmClosePopupOpen,"onUpdate:modelValue":t[7]||(t[7]=t=>e.interfaceState.isConfirmClosePopupOpen=t)},{default:w((()=>[u(x,null,{default:w((()=>[u(E,null,{default:w((()=>[m("Unsaved changes")])),_:1}),u(M,null,{default:w((()=>[m("Are you sure you want to leave this page?")])),_:1}),u(k,null,{default:w((()=>[u(C,{secondary:"",onClick:e.onConfirmDrawerClose},{default:w((()=>[m("Discard Changes")])),_:1},8,["onClick"]),u(C,{onClick:t[6]||(t[6]=()=>e.interfaceState.isConfirmClosePopupOpen=!1)},{default:w((()=>[m("Keep Editing")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(" For some reason, the dialog box doesn't appear if coded like this, must use the above way with a v-card element "),h(' <v-dialog\r\n\t\tv-model="interfaceState.isConfirmClosePopupOpen"\r\n\t\t@confirm="onConfirmDrawerClose"\r\n\t\t@cancel="interfaceState.isConfirmClosePopupOpen = false"\r\n\t\ttitle="Unsaved changes"\r\n\t\tsubtitle="Are you sure you want to leave this page?"\r\n\t/> ')],64)},we.__scopeId="data-v-64969d30",we.__file="src/interface.vue";var Re=t({id:"navarch-parcellots-weight-v2",name:"Navarch Weight Lots Table v2",icon:"arrow_right_alt",description:"Navarch Weight Lots Table Interface for Parcel Form",component:we,options:null,types:["uuid","string","text","integer","bigInteger","alias"],group:"relational",localTypes:["o2m"],relational:!0});export{Re as default};
