import{useApi as t,defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as r,ref as n,inject as o,resolveComponent as a,resolveDirective as i,openBlock as s,createElementBlock as u,Fragment as l,createCommentVNode as f,createElementVNode as c,createBlock as h,withCtx as d,createTextVNode as p,createVNode as g,withDirectives as y,toDisplayString as m}from"vue";for(var w={},v={byteLength:function(t){var e=U(t),r=e[0],n=e[1];return 3*(r+n)/4-n},toByteArray:function(t){var e,r,n=U(t),o=n[0],a=n[1],i=new E(function(t,e,r){return 3*(e+r)/4-r}(0,o,a)),s=0,u=a>0?o-4:o;for(r=0;r<u;r+=4)e=_[t.charCodeAt(r)]<<18|_[t.charCodeAt(r+1)]<<12|_[t.charCodeAt(r+2)]<<6|_[t.charCodeAt(r+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=255&e;2===a&&(e=_[t.charCodeAt(r)]<<2|_[t.charCodeAt(r+1)]>>4,i[s++]=255&e);1===a&&(e=_[t.charCodeAt(r)]<<10|_[t.charCodeAt(r+1)]<<4|_[t.charCodeAt(r+2)]>>2,i[s++]=e>>8&255,i[s++]=255&e);return i},fromByteArray:function(t){for(var e,r=t.length,n=r%3,o=[],a=16383,i=0,s=r-n;i<s;i+=a)o.push(C(t,i,i+a>s?s:i+a));1===n?(e=t[r-1],o.push(b[e>>2]+b[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],o.push(b[e>>10]+b[e>>4&63]+b[e<<2&63]+"="));return o.join("")}},b=[],_=[],E="undefined"!=typeof Uint8Array?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$=0;$<64;++$)b[$]=A[$],_[A.charCodeAt($)]=$;function U(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function C(t,e,r){for(var n,o,a=[],i=e;i<r;i+=3)n=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),a.push(b[(o=n)>>18&63]+b[o>>12&63]+b[o>>6&63]+b[63&o]);return a.join("")}_["-".charCodeAt(0)]=62,_["_".charCodeAt(0)]=63;var B={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,n,o){var a,i,s=8*o-n-1,u=(1<<s)-1,l=u>>1,f=-7,c=r?o-1:0,h=r?-1:1,d=t[e+c];for(c+=h,a=d&(1<<-f)-1,d>>=-f,f+=s;f>0;a=256*a+t[e+c],c+=h,f-=8);for(i=a&(1<<-f)-1,a>>=-f,f+=n;f>0;i=256*i+t[e+c],c+=h,f-=8);if(0===a)a=1-l;else{if(a===u)return i?NaN:1/0*(d?-1:1);i+=Math.pow(2,n),a-=l}return(d?-1:1)*i*Math.pow(2,a-n)},write:function(t,e,r,n,o,a){var i,s,u,l=8*a-o-1,f=(1<<l)-1,c=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,i=f):(i=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-i))<1&&(i--,u*=2),(e+=i+c>=1?h/u:h*Math.pow(2,1-c))*u>=2&&(i++,u/=2),i+c>=f?(s=0,i=f):i+c>=1?(s=(e*u-1)*Math.pow(2,o),i+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,o),i=0));o>=8;t[r+d]=255&s,d+=p,s/=256,o-=8);for(i=i<<o|s,l+=o;l>0;t[r+d]=255&i,d+=p,i/=256,l-=8);t[r+d-p]|=128*g}};
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
!function(t){var e=v,r=B,n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=i,t.SlowBuffer=function(t){+t!=t&&(t=0);return i.alloc(+t)},t.INSPECT_MAX_BYTES=50;var o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,i.prototype),e}function i(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return s(t,e,r)}function s(t,e,r){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!i.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|d(t,e),n=a(r),o=n.write(t,e);o!==r&&(n=n.slice(0,o));return n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(j(t,Uint8Array)){var e=new Uint8Array(t);return c(e.buffer,e.byteOffset,e.byteLength)}return f(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(j(t,ArrayBuffer)||t&&j(t.buffer,ArrayBuffer))return c(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(j(t,SharedArrayBuffer)||t&&j(t.buffer,SharedArrayBuffer)))return c(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return i.from(n,e,r);var o=function(t){if(i.isBuffer(t)){var e=0|h(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}if(void 0!==t.length)return"number"!=typeof t.length||V(t.length)?a(0):f(t);if("Buffer"===t.type&&Array.isArray(t.data))return f(t.data)}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return i.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return u(t),a(t<0?0:0|h(t))}function f(t){for(var e=t.length<0?0:0|h(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function c(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,i.prototype),n}function h(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function d(t,e){if(i.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||j(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return k(t).length;default:if(o)return n?-1:F(t).length;e=(""+e).toLowerCase(),o=!0}}function p(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return O(this,e,r);case"utf8":case"utf-8":return U(this,e,r);case"ascii":return S(this,e,r);case"latin1":case"binary":return D(this,e,r);case"base64":return $(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,o){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),V(r=+r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=i.from(e,n)),i.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,o);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,o){var a,i=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;i=2,s/=2,u/=2,r/=2}function l(t,e){return 1===i?t[e]:t.readUInt16BE(e*i)}if(o){var f=-1;for(a=r;a<s;a++)if(l(t,a)===l(e,-1===f?0:a-f)){if(-1===f&&(f=a),a-f+1===u)return f*i}else-1!==f&&(a-=a-f),f=-1}else for(r+u>s&&(r=s-u),a=r;a>=0;a--){for(var c=!0,h=0;h<u;h++)if(l(t,a+h)!==l(e,h)){c=!1;break}if(c)return a}return-1}function w(t,e,r,n){r=Number(r)||0;var o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;var a=e.length;n>a/2&&(n=a/2);for(var i=0;i<n;++i){var s=parseInt(e.substr(2*i,2),16);if(V(s))return i;t[r+i]=s}return i}function b(t,e,r,n){return x(F(e,t.length-r),t,r,n)}function _(t,e,r,n){return x(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function E(t,e,r,n){return x(k(e),t,r,n)}function A(t,e,r,n){return x(function(t,e){for(var r,n,o,a=[],i=0;i<t.length&&!((e-=2)<0);++i)n=(r=t.charCodeAt(i))>>8,o=r%256,a.push(o),a.push(n);return a}(e,t.length-r),t,r,n)}function $(t,r,n){return 0===r&&n===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(r,n))}function U(t,e,r){r=Math.min(t.length,r);for(var n=[],o=e;o<r;){var a,i,s,u,l=t[o],f=null,c=l>239?4:l>223?3:l>191?2:1;if(o+c<=r)switch(c){case 1:l<128&&(f=l);break;case 2:128==(192&(a=t[o+1]))&&(u=(31&l)<<6|63&a)>127&&(f=u);break;case 3:a=t[o+1],i=t[o+2],128==(192&a)&&128==(192&i)&&(u=(15&l)<<12|(63&a)<<6|63&i)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:a=t[o+1],i=t[o+2],s=t[o+3],128==(192&a)&&128==(192&i)&&128==(192&s)&&(u=(15&l)<<18|(63&a)<<12|(63&i)<<6|63&s)>65535&&u<1114112&&(f=u)}null===f?(f=65533,c=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=c}return function(t){var e=t.length;if(e<=C)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=C));return r}(n)}t.kMaxLength=o,i.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}}),i.poolSize=8192,i.from=function(t,e,r){return s(t,e,r)},Object.setPrototypeOf(i.prototype,Uint8Array.prototype),Object.setPrototypeOf(i,Uint8Array),i.alloc=function(t,e,r){return function(t,e,r){return u(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},i.allocUnsafe=function(t){return l(t)},i.allocUnsafeSlow=function(t){return l(t)},i.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==i.prototype},i.compare=function(t,e){if(j(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),j(e,Uint8Array)&&(e=i.from(e,e.offset,e.byteLength)),!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,o=0,a=Math.min(r,n);o<a;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=i.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var a=t[r];if(j(a,Uint8Array))o+a.length>n.length?i.from(a).copy(n,o):Uint8Array.prototype.set.call(n,a,o);else{if(!i.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o)}o+=a.length}return n},i.byteLength=d,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},i.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?U(this,0,t):p.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},n&&(i.prototype[n]=i.prototype.inspect),i.prototype.compare=function(t,e,r,n,o){if(j(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return-1;if(e>=r)return 1;if(this===t)return 0;for(var a=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),u=Math.min(a,s),l=this.slice(n,o),f=t.slice(e,r),c=0;c<u;++c)if(l[c]!==f[c]){a=l[c],s=f[c];break}return a<s?-1:s<a?1:0},i.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},i.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},i.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},i.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-e;if((void 0===r||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":case"latin1":case"binary":return _(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function S(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}function D(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}function O(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var o="",a=e;a<r;++a)o+=J[t[a]];return o}function T(t,e,r){for(var n=t.slice(e,r),o="",a=0;a<n.length-1;a+=2)o+=String.fromCharCode(n[a]+256*n[a+1]);return o}function I(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,r,n,o,a){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function N(t,e,r,n,o,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(t,e,n,o,a){return e=+e,n>>>=0,a||N(t,0,n,4),r.write(t,e,n,o,23,4),n+4}function P(t,e,n,o,a){return e=+e,n>>>=0,a||N(t,0,n,8),r.write(t,e,n,o,52,8),n+8}i.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,i.prototype),n},i.prototype.readUintLE=i.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],o=1,a=0;++a<e&&(o*=256);)n+=this[t+a]*o;return n},i.prototype.readUintBE=i.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t+--e],o=1;e>0&&(o*=256);)n+=this[t+--e]*o;return n},i.prototype.readUint8=i.prototype.readUInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),this[t]},i.prototype.readUint16LE=i.prototype.readUInt16LE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUint16BE=i.prototype.readUInt16BE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUint32LE=i.prototype.readUInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUint32BE=i.prototype.readUInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],o=1,a=0;++a<e&&(o*=256);)n+=this[t+a]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*e)),n},i.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=e,o=1,a=this[t+--n];n>0&&(o*=256);)a+=this[t+--n]*o;return a>=(o*=128)&&(a-=Math.pow(2,8*e)),a},i.prototype.readInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,e){return t>>>=0,e||I(t,4,this.length),r.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return t>>>=0,e||I(t,4,this.length),r.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return t>>>=0,e||I(t,8,this.length),r.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return t>>>=0,e||I(t,8,this.length),r.read(this,t,!1,52,8)},i.prototype.writeUintLE=i.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||L(this,t,e,r,Math.pow(2,8*r)-1,0);var o=1,a=0;for(this[e]=255&t;++a<r&&(o*=256);)this[e+a]=t/o&255;return e+r},i.prototype.writeUintBE=i.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||L(this,t,e,r,Math.pow(2,8*r)-1,0);var o=r-1,a=1;for(this[e+o]=255&t;--o>=0&&(a*=256);)this[e+o]=t/a&255;return e+r},i.prototype.writeUint8=i.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,1,255,0),this[e]=255&t,e+1},i.prototype.writeUint16LE=i.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeUint16BE=i.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeUint32LE=i.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},i.prototype.writeUint32BE=i.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var o=Math.pow(2,8*r-1);L(this,t,e,r,o-1,-o)}var a=0,i=1,s=0;for(this[e]=255&t;++a<r&&(i*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/i>>0)-s&255;return e+r},i.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var o=Math.pow(2,8*r-1);L(this,t,e,r,o-1,-o)}var a=r-1,i=1,s=0;for(this[e+a]=255&t;--a>=0&&(i*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/i>>0)-s&255;return e+r},i.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},i.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeFloatLE=function(t,e,r){return M(this,t,e,!0,r)},i.prototype.writeFloatBE=function(t,e,r){return M(this,t,e,!1,r)},i.prototype.writeDoubleLE=function(t,e,r){return P(this,t,e,!0,r)},i.prototype.writeDoubleBE=function(t,e,r){return P(this,t,e,!1,r)},i.prototype.copy=function(t,e,r,n){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var o=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),o},i.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var o=t.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(t=o)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var a;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=e;a<r;++a)this[a]=t;else{var s=i.isBuffer(t)?t:i.from(t,n),u=s.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<r-e;++a)this[a+e]=s[a%u]}return this};var R=/[^+/0-9A-Za-z-_]/g;function F(t,e){var r;e=e||1/0;for(var n=t.length,o=null,a=[],i=0;i<n;++i){if((r=t.charCodeAt(i))>55295&&r<57344){if(!o){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(i+1===n){(e-=3)>-1&&a.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(e-=3)>-1&&a.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function k(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function x(t,e,r,n){for(var o=0;o<n&&!(o+r>=e.length||o>=t.length);++o)e[o+r]=t[o];return o}function j(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function V(t){return t!=t}var J=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=16*r,o=0;o<16;++o)e[n+o]=t[r]+t[o];return e}()}(w);const S="navarch_shipment_latest";var D=(t=>(t.PNG="image/png",t.JPEG="image/jpeg",t.JPG="image/jpg",t))(D||{}),O=r({props:{value:{type:Object,default:null}},emits:["input"],setup(e,{emit:r}){const a=n(""),i=n(!1),s=n(!1),u=n(e.value),l=t(),f=n(""),c=n(""),h={},d={},p=o("values",n({})),g="id",y="method",m="lot_number",v="related_parcel",b="counterparty",_="vessel",E="destination",A="contract",$="bl_date",U="invoice",C="parcel",B="invoice_date",O="logo",T="commodity",I="dry_weight",L="final_assay",N="assay_uom",M="lot_number",P="commodity",R="price_per_uom",F="code",k="codename",x="port_name",j="name",V="navarch_unit",J="unit",W="symbol",z="dry_symbol",G="conversionToGram",Y="navarch_assay_unit",q="unit",K="conversion_to_ppb",X="composition";return{documentData:u,isGeneraingDoc:i,failureReason:a,viewPdf:function(t){const r=null!=t?t:e.value.doc_name;console.log(`[viewPdf] doc ID: ${r}`),window.open(`/assets/${r}?access_token=9TKZlOUjs29Svyop45nyyyN02lYPlX_x`)},downloadDocAsPdf:H,downloadDocAsCsv:function(){var t;const r=null!=(t=u.value)?t:e.value,{start_date:n,end_date:o,filter_date:a,wet_weight_uom:i,dry_weight_uom:s,parcels:l}=r,f=[];l.forEach((t=>{t.assays.forEach((e=>{f.push({Parcel:t.name,Counterparty:t.counterparty,Port:t.port,Vessel:t.vessel,"Physical Status":t.phy_status,"Financial Status":t.fin_status,"Shipment Date":t.shipment_date,"Weight Source":t.weight_source,[i]:t.wet_weight,Moisture:t.moisture,[s]:t.dry_weight,"Assay Source":t.assay_source,Commodity:`${e.commodity} (${e.code})`,Assay:e.assay,"Assay UOM":e.assay_uom,"Contained Metal":e.contained_metal,"Contained Metal UOM":e.contained_metal_uom})}))})),Q(f);!function(t,e){const r=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=`${e}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o)}(Q(f),`Shipment Latest Report (${a}) ${n} - ${o}`)},clearDocument:function(){u.value=null,a.value="",r("input",null)},copy:async function(){s.value=!0;const{id:t,user_created:e,date_created:r,user_updated:n,date_updated:o,shipment_latest:i,...u}=p.value;console.log(`[shipment latest::copy] requestBody=${JSON.stringify(u)}`);const f=await l.post("/items/navarch_shipment_latest",u);if(200!==f.status)return console.log(`[shipment latest::copy] copy response status: ${f.status}`),void(a.value=`Failed to duplicate shipment latest with status ${f.status}`);s.value=!1,window.open(`/admin/content/navarch_shipment_latest/${f.data.data.id}`)},isCopying:s,generateDocument:async function(){var t,e;a.value="",i.value=!0;try{const r=p.value.start_date,n=p.value.end_date,o=p.value.filter_date;if(!r)return a.value="Start date not selected",void(i.value=!1);if(!n)return a.value="End date not selected",void(i.value=!1);if(!o)return a.value="Filter date not selected",void(i.value=!1);let s,h="",z=!1;switch(o){case"Arrival Date":h="actual_arrival_date";break;case"Invoice Date":z=!0;break;case"B/L Date":h=$;break;case"Parcel Finalisation Date":h="parcel_finalisation_date";break;default:return a.value="Invalid filter date",void(i.value=!1)}if(z){const t=await l.get(`/items/navarch_invoices?filter[${U}][_nnull]=true`,{params:{fields:[C,U]}});if(200!==t.status)return console.error(`[generateDocument] invoiceResponse status: ${t.status}`),a.value="Failed to fetch invoices for filter date Invoice Date",void(i.value=!1);const e=t.data.data.filter((t=>{if(!t[U][B])return!1;const e=new Date(t[U][B]);return e>=new Date(r)&&e<=new Date(n)})).map((t=>t[C])).filter(((t,e,r)=>r.indexOf(t)===e));s=`filter[id][_in]=${e.join(",")}`}else s=`filter[_and][0][_and][0][${h}][_between][0]=${r}&filter[_and][0][_and][0][${h}][_between][1]=${n}`;const G=await l.get(`/items/navarch_parcel?${s}`,{params:{fields:[g,"shipment_code",b,"physical_status","financial_status",$,_,E,A]}});if(200!==G.status)return console.error(`[generateDocument] parcelResponce status: ${G.status}`),a.value="Failed to fetch parcels",void(i.value=!1);if(0===G.data.data.length)return a.value=`No parcels found within the selected date range of ${r} to ${n} for the filter date ${o}`,void(i.value=!1);const Y=[];for(const t of G.data.data){if(null===t.contract)return a.value=`Contract not selected for parcel with shipment code ${t.shipment_code}`,void(i.value=!1);const e=t.contract,r=await l.get(`/items/navarch_commodity_in_contract?filter[${A}]=${e}&filter[payable_commodity]=true`,{params:{fields:[P,R]}});if(200!==r.status)return console.error(`[generateDocument] commodityInContractResponse status: ${r.status}`),a.value="Failed to fetch payable commodities",void(i.value=!1);if(0===r.data.data.length){console.log(`[generateDocument] No payable commodities found for parcel with shipment code ${t.shipment_code}`);continue}const n=r.data.data.map((t=>t[P])),o=await l.get(`/items/navarch_commodity?filter[id][_in]=${n.join(",")}`,{params:{fields:[g,"name",F]}});if(200!==o.status)return console.error(`[generateDocument] commodityResponse status: ${o.status}`),a.value="Failed to fetch commodities",void(i.value=!1);if(0===o.data.data.length)throw new Error(`[generateDocument] No commodities found for parcel with shipment code ${t.shipment_code}`);if(!t.id)continue;const s=t.id,u=o.data.data.map((t=>t.code)),h=st((await l.get(`/items/navarch_assay_lot?filter[${v}]=${s}&filter[${T}][_in]=${u}&sort[]=${M}`,{params:{fields:[g,y,T,I,L,M,N]}})).data.data);let p,w;if(p||(p=h.Outturn,w="Outturn"),p||(p=h["Inturn Final"],w="Inturn Final"),p||(p=h.Inturn,w="Inturn"),p||(p=h.Estimated,w="Estimated"),p||(p=h.Planned,w="Planned"),!p)throw new Error("No assay lot data found for all assay methods. Please ensure assay lot data has been entered in the selected parcel.");console.log("assayByLatestMethod=",JSON.stringify(p));const U=nt((await l.get(`/items/navarch_weight_lot?filter[${v}]=${s}&filter[${m}][_nnull]=true&sort[]=${m}`,{params:{fields:[g,"dry_weight","wet_weight",y,"moisture","wet_weight_uom","dry_weight_uom"]}})).data.data);let C;if(C||(C=U.find((t=>"Outturn"===t.method))),C||(C=U.find((t=>"Inturn Final"===t.method))),C||(C=U.find((t=>"Inturn"===t.method))),C||(C=U.find((t=>"Estimated"===t.method))),C||(C=U.find((t=>"Planned"===t.method))),!C)throw new Error("No weight lot data found for all weight methods. Please ensure weight lot data has been entered in the selected parcel.");if(void 0===C.dry_weight||null===C.dry_weight||void 0===C.wet_weight||null===C.wet_weight||void 0===C.moisture||null===C.moisture||void 0===C.dry_weight_uom||null===C.dry_weight_uom||void 0===C.wet_weight_uom||null===C.wet_weight_uom||void 0===C.method||null===C.method)throw new Error("One of the fields for weight lots is undefined");""===f.value&&(f.value=C.dry_weight_uom),""===c.value&&(c.value=C.wet_weight_uom);const B=await l.get(`/items/navarch_counterparty/${t[b]}`,{params:{fields:[k]}}),S=await l.get(`/items/navarch_world_port/${t[E]}`,{params:{fields:[x]}}),D=t[_];let O;D&&(O=await l.get(`/items/navarch_vessel/${D}`,{params:{fields:[j]}}));const z=o.data.data.reduce(((t,e)=>(t[e.code]=e.name,t)),{});console.log("commodityCodeToNameMap=",JSON.stringify(z));const G=r.data.data.map((t=>t[R])),q=(await l.get(`/items/${V}?filter[${J}][_in]=${G.join(",")}`,{params:{fields:[J,W]}})).data.data.reduce(((t,e)=>(t[e[J]]=e[W],t)),{});r.data.data.forEach((t=>{const e=o.data.data.find((e=>e[g]===t[P]))[F];if(!d[e]){const r=q[t[R]];d[e]=r}})),console.log("commodityCodeToMetalUomMap=",JSON.stringify(d));const K=await ut(C.dry_weight_uom,f.value),X=C.wet_weight*K,Z=C.dry_weight*K,H={name:t.shipment_code,counterparty:B.data.data[k],port:S.data.data[x],vessel:O?O.data.data[j]:"N/A",phy_status:t.physical_status,fin_status:t.financial_status,shipment_date:rt(new Date(t[$])),weight_source:C.method,wet_weight:X,moisture:C.moisture,dry_weight:Z,assay_source:w,assays:await tt(p,z,d,Z)};Y.push(H)}const q=(await l.get("/items/navarch_company",{params:{fields:[O]}})).data.data;let K=null;if(q[O]){const t=q[O],e=await l.get(`/assets/${t}`,{responseType:"arraybuffer"}),r=w.Buffer.from(e.data,"binary"),n=e.headers["content-type"];Object.values(D).includes(n)&&(K={imageData:r.toString("base64"),imageType:n})}const X={doc_name:null,folder_id:await Z(),start_date:et(new Date(r)),end_date:et(new Date(n)),filter_date:o,parcels:Y,wet_weight_uom:null==(t=c.value)?void 0:t.toUpperCase(),dry_weight_uom:null==(e=f.value)?void 0:e.toUpperCase()};let Q;try{Q=await l.post("/generate/shipment-latest",X)}catch(t){throw console.error(`[generateDocument] error: ${t}`),new Error(JSON.stringify(t.response.data))}if(200!==Q.status)return console.log(`[generateDocument] response status: ${Q.status}`),a.value=Q.data,void(i.value=!1);const ot=await async function(t){if(!t)throw console.error("[uploadGeneratedDoc] fileData is empty"),new Error("A failure occured while trying to upload the generated document, no file data found. Please try again.");const e=function(t){console.log("[convertJsonToFormData] json=",JSON.stringify(t));const e=new FormData;for(let r in t)"file"!==r&&e.append(r,t[r]);const r=t.file,n=function(t,e){const r=atob(t),n=new ArrayBuffer(r.length),o=new Uint8Array(n);for(let t=0;t<r.length;t++)o[t]=r.charCodeAt(t);const a=new Blob([o],{type:e});return a}(r,"application/pdf");return e.append("file",n,t.filename_download),e}(t),r=await l.post("/files",e,{headers:{"Content-Type":"multipart/form-data"}});if(200!==r.status)throw console.error(`[uploadGeneratedDoc] uploadedFileData status: ${r.status}`),new Error("A failure occured while trying to upload the generated document. Please try again.");return r.data.data.id}(Q.data);if(X.doc_name=ot,u.value=X,p.value[g]){const{id:t,user_created:e,date_created:r,user_updated:n,date_updated:o,...i}=p.value,s=await l.patch(`/items/${S}/${t}`,{...i,shipment_latest:X});if(200!==s.status)return console.log(`[navarch-docgen-shipment-latest::generateDocument] update response status: ${s.status}`),void(a.value=`Failed to update royalty report with status ${s.status}`)}else{const t=await l.post(`/items/${S}`,{...p.value,shipment_latest:X});if(200!==t.status)return console.log(`[navarch-docgen-shipment-latest::generateDocument] create response status: ${t.status}`),void(a.value=`Failed to create royalty report with status ${t.status}`);const{id:e}=t.data.data;window.open(`/admin/content/${S}/${e}`)}H(ot)}catch(t){a.value=t.message}finally{i.value=!1}}};async function Z(){const t=await l.get(`/folders?filter[name][_eq]=${encodeURI("Shipment Latest")}`);return 200===t.status&&t.data&&t.data.data?0===t.data.data.length?await async function(){return(await l.post("/folders",{name:"Shipments Latest"})).data.data.id}():t.data.data[0].id:null}async function H(t){var r;const n=null!=(r=null!=t?t:u.value.doc_name)?r:e.value.doc_name;if(console.log(`[downloadDocAsPdf] doc ID: ${n}`),!n)throw new Error("No document ID found, please ensure the document has been generated");try{const t=(await l.get(`/files/${n}`)).data.data.filename_download,e=await l.get(`/assets/${n}`,{responseType:"arraybuffer"}),r=new Blob([e.data],{type:"application/pdf"}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=null!=t?t:"shipment-latest.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}catch(t){throw console.error(`[downloadDocAsPdf] error: ${t}`),new Error("Failed to fetch the document, please try again")}}function Q(t){const e=[],r=Object.keys(t[0]);e.push(r.join(","));for(const n of t){const t=r.map((t=>`"${String(n[t]).replace(/"/g,'\\"')}"`));e.push(t.join(","))}return e.join("\n")}async function tt(t,e,r,n){const o=Object.keys(t);return await Promise.all(o.map((async o=>{const a=t[o];h[o]||(h[o]=a.assay_uom);const i=await async function(t,e){if(null==t||null==e)return 1;if(t===e)return 1;const r=await l.get(`/items/${Y}?filter[${q}]=${t}`,{params:{fields:[K]}});if(0===r.data.data.length||void 0===r.data.data[0][K]||null===r.data.data[0][K])throw new Error(`[getAssayUnitConversionValue] failed to get conversion value for source weight unit ${t}. Ensure that the symbol is correct and is a weight unit symbol`);const n=await l.get(`/items/${Y}?filter[${q}]=${e}`,{params:{fields:[K]}});if(0===n.data.data.length||void 0===n.data.data[0][K]||null===n.data.data[0][K])throw new Error(`[getAssayUnitConversionValue] failed to get conversion value for the target weight unit ${e}. Ensure that the symbol is correct and is a weight unit symbol`);const o=parseFloat(r.data.data[0][K]);if(isNaN(o))throw new Error(`[getAssayUnitConversionValue] source weight unit ${t} conversion value=${o} is not a number`);console.log(`[getAssayUnitConversionValue] source unit conversion value=${o}`);const a=parseFloat(n.data.data[0][K]);if(isNaN(a))throw new Error(`[getAssayUnitConversionValue] target weight unit ${t} conversion value=${a} is not a number`);return console.log(`[getAssayUnitConversionValue] target unit conversion value=${a}`),console.log("[getAssayUnitConversionValue] returning "+o/a),o/a}(a.assay_uom,h[o]),s=await async function(t,e,r){const n=await l.get(`/items/${V}?filter[${z}]=${e}`,{params:{fields:[W]}});if(!n.data.data||!n.data.data[0]||!n.data.data[0][W])throw new Error(`[getConversionValuesAndUnitsForPayableMetalCalculation] Dry weight uom not found for symbol ${e}`);const o=n.data.data[0][W];if("%"===r)return o===t?.01:await ut(o,t);let a=r.split("/");if(1==a.length){const t=await async function(t){const e=await l.get(`/items/${Y}`,{params:{fields:[q,X],filter:{[X]:{_nnull:!0},[q]:{_eq:t}}}});if(200!==e.status||!e.data||0===e.data.data.length)throw new Error("[getAssayUnitComposition] no assay units found with composition");return e.data.data[0][X]}(r);if(!t)throw new Error(`[getConversionValuesAndUnitsForPayableMetalCalculation] assay unit ${r} does not have a composition`);a=t.split("/")}if(a.length>2||0===a.length)throw new Error(`[getConversionValuesAndUnitsForPayableMetalCalculation] assay unit ${r} is not in the format of 'unit1/unit2'`);const i=a[0],s=a[1];let u=1;if(s!==o){const t=await ut(o,s);if(isNaN(t)||0===t)throw new Error(`[getConversionValuesAndUnitsForPayableMetalCalculation] conversion value=${t} for original weight unit ${o} and assay unit denominator ${s} is not a number or is zero`);u*=t}if(i!==t){const e=await ut(i,t);if(isNaN(e)||0===e)throw new Error(`[getConversionValuesAndUnitsForPayableMetalCalculation] conversion value=${e} for evaluated contained metal uom ${i} and target weight unit ${t} is not a number or is zero`);u*=e}return console.log(`[getConversionValuesAndUnitsForPayableMetalCalculation] returning conversion value=${u}`),u}(r[o],f.value,a.assay_uom);return{commodity:e[o],code:o,assay:a.analytical_assay*i,assay_uom:h[o],contained_metal:n*a.analytical_assay*s,contained_metal_uom:r[o]}})))}function et(t){const e=t.getDay(),r=t.getDate(),n=t.getMonth(),o=t.getFullYear();return`${r} ${["January","February","March","April","May","June","July","August","September","October","November","December"][n]} ${o} (${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]})`}function rt(t){const e=t.getDate(),r=t.getMonth(),n=t.getFullYear().toString().slice(-2);return`${e} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r]} ${n}`}function nt(t){console.log("[evaluateWeights]");const e={};for(const r of t)e[r.method]||(console.log(`adding method ${r.method} to weightData object`),e[r.method]=[]),console.log(`adding lot ${r.id} to weightData.${r.method} array`),e[r.method.toString()].push(r);const r=[];for(const t of Object.keys(e)){if(!e[t]){console.log(`method=${t} does not exist in weightData object`);continue}console.log(`adding lots and other values to weights for method=${t}`);const n=ot(e[t]);n&&r.push(n)}return r}function ot(t){if(console.log("[evaluateWeightData]"),0===t.length)return;const e=it(t,"dry_weight"),r=it(t,"wet_weight");return{method:at(t,"method"),lots:t,dry_weight_uom:at(t,"dry_weight_uom"),wet_weight_uom:at(t,"wet_weight_uom"),dry_weight:e,wet_weight:r,moisture:(r-e)/r*100}}function at(t,e){if(console.log("[getFirstValueAsSharedValue]"),0!==t.length)return console.log(`lots[0][${e.toString()}]=${t[0][e.toString()]}`),t[0][e.toString()]}function it(t,e){return console.log("[evaluateAggregateValue]"),t.reduce(((t,r)=>{var n;return t+parseFloat(null!=(n=r[e.toString()])?n:"0")}),0)}function st(t){var e;console.log("[evaluateAnalyticalAssay]");const r={};for(const e of t)r[e.method]||(r[e.method]={}),r[e.method][e.commodity]||(r[e.method][e.commodity]=[]),null!==e.lot_number?(1===r[e.method][e.commodity].length&&null===r[e.method][e.commodity][0].lot_number&&(r[e.method][e.commodity]=[]),r[e.method][e.commodity].push(e)):null===e.lot_number&&0===r[e.method][e.commodity].length&&r[e.method][e.commodity].push(e);console.log(`[evaluateAnalyticalAssay] group: ${JSON.stringify(r)}}`);const n={};for(const t in r){console.log(`[evaluateAnalyticalAssay] methodKey: ${t}, group[methodKey]: ${JSON.stringify(r[t])}`);for(const o in r[t]){console.log(`[evaluateAnalyticalAssay] commodityKey: ${o}, group[methodKey][commodityKey]: ${JSON.stringify(r[t][o])}`),n[t]=null!=(e=n[t])?e:{},n[t][o]={};const a=r[t][o].reduce(((t,e)=>{var r;return t+parseFloat(null!=(r=e[I])?r:"0")}),0);console.log(`[evaluateAnalyticalAssay] totalDryWeight: ${a} from ${JSON.stringify(r[t][o])}`),n[t][o].analytical_assay=r[t][o].reduce(((t,e)=>{var r,n;return t+parseFloat(null!=(r=e[L])?r:"0")*parseFloat(null!=(n=e[I])?n:"0")}),0)/(0!==a?a:1),console.log(`[evaluateAnalyticalAssay] analytical assay: ${n[t][o].analytical_assay}`),r[t][o].length>0&&(n[t][o][N]=r[t][o][0][N])}}return console.log(`[evaluateAnalyticalAssay] analyticalAssay: ${JSON.stringify(n)}`),n}async function ut(t,e){if(t===e)return 1;const r=await l.get(`/items/${V}?filter[${W}]=${t}`,{params:{fields:[G]}});if(0===r.data.data.length||null===r.data.data[0][G]||void 0===r.data.data[0][G])throw new Error(`[getWeightUnitConversionValue] failed to get conversion value for source weight unit ${t}. Ensure that the symbol is correct and is a weight unit symbol`);const n=await l.get(`/items/${V}?filter[${W}]=${e}`,{params:{fields:[G]}});if(0===n.data.data.length||null===n.data.data[0][G]||void 0===n.data.data[0][G])throw new Error(`[getWeightUnitConversionValue] failed to get conversion value for the target weight unit ${e}. Ensure that the symbol is correct and is a weight unit symbol`);const o=parseFloat(r.data.data[0][G]);if(isNaN(o))throw new Error(`[getWeightUnitConversionValue] source weight unit ${t} conversion value=${o} is not a number`);const a=parseFloat(n.data.data[0][G]);if(isNaN(a))throw new Error(`[getWeightUnitConversionValue] target weight unit ${e} conversion value=${a} is not a number`);return console.log(`[getWeightUnitConversionValue] source weight unit=${t}, target weight unit=${e}, source weight unit conversion=${o}, target weight unit conversion=${a}`),console.log("[getWeightUnitConversionValue] conversion factor="+o/a),o/a}}});const T={class:"margin-top-16px"};var I=[],L=[];!function(t,e){if(t&&"undefined"!=typeof document){var r,n=!0===e.prepend?"prepend":"append",o=!0===e.singleTag,a="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(o){var i=I.indexOf(a);-1===i&&(i=I.push(a)-1,L[i]={}),r=L[i]&&L[i][n]?L[i][n]:L[i][n]=s()}else r=s();65279===t.charCodeAt(0)&&(t=t.substring(1)),r.styleSheet?r.styleSheet.cssText+=t:r.appendChild(document.createTextNode(t))}function s(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var r=Object.keys(e.attributes),o=0;o<r.length;o++)t.setAttribute(r[o],e.attributes[r[o]]);var i="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(i,t),t}}(".margin-top-16px[data-v-64969d30] {\n  margin-top: 16px;\n}\n.margin-left-16px[data-v-64969d30] {\n  margin-left: 16px;\n}\n.secondary-button[data-v-64969d30] {\n  --v-button-background-color: var(--background-page);\n  --v-button-color: var(--primary);\n  border: 1px solid var(--primary);\n  border-radius: var(--border-radius);\n}\n.secondary-button[data-v-64969d30]:disabled {\n  border-radius: var(--border-radius);\n}\n.secondary-button[data-v-64969d30]:hover {\n  border-color: var(--v-button-background-color-hover);\n  --v-button-color: inherit;\n}",{}),O.render=function(t,e,r,n,o,w){const v=a("v-button"),b=a("v-notice"),_=i("tooltip");return s(),u(l,null,[f(' <input :value="value" @input="handleChange($event.target.value)" /> '),f(" create a button only interface for Directus"),c("div",T,[t.documentData?f("v-if",!0):(s(),h(v,{key:0,onClick:e[0]||(e[0]=()=>t.generateDocument()),loading:t.isGeneraingDoc},{default:d((()=>[p(" Generate Shipment Latest ")])),_:1},8,["loading"])),t.documentData?(s(),h(v,{key:1,onClick:e[1]||(e[1]=()=>t.downloadDocAsPdf())},{default:d((()=>[p(" Download PDF ")])),_:1})):f("v-if",!0),t.documentData?(s(),h(v,{key:2,onClick:e[2]||(e[2]=()=>t.downloadDocAsCsv()),class:"margin-left-16px"},{default:d((()=>[p(" Download CSV ")])),_:1})):f("v-if",!0),g(v,{class:"margin-left-16px secondary-button",onClick:e[3]||(e[3]=()=>t.copy()),loading:t.isCopying},{default:d((()=>[p("Copy")])),_:1},8,["loading"]),y((s(),h(v,{class:"margin-left-16px secondary-button",onClick:e[4]||(e[4]=()=>t.clearDocument())},{default:d((()=>[p("Clear")])),_:1})),[[_,"Clear the generated Shipment Latest (if already generated) to regenerate again."]])]),t.failureReason?(s(),h(b,{key:0,class:"margin-top-16px"},{default:d((()=>[p(m(t.failureReason),1)])),_:1})):f("v-if",!0)],64)},O.__scopeId="data-v-64969d30",O.__file="src/interface.vue";var N=e({id:"navarch-shipment-latest-generator",name:"Shipment Latest Doc Generator",icon:"receipt_long",description:"This is a custom interface for Navarch's Shipment Latest Document Generator Button.",component:O,options:null,types:["json"],group:"standard"});export{N as default};
