import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{defineComponent as a,ref as o,inject as d,watch as n,resolveComponent as l,resolveDirective as i,openBlock as c,createBlock as s,withCtx as r,createElementBlock as m,createVNode as u,Fragment as p,renderList as f,createElementVNode as v,toDisplayString as _,withDirectives as y}from"vue";var h=a({props:{value:{type:Object,default:null}},emits:["input"],setup(t,{emit:a}){var l;const i=e(),c=o(!1),s=o(null!=(l=t.value)?l:{}),r=o([]),m="contract",u="id",p="navarch_commodity_in_contract",f="contract",v="commodity",_="primary_commodity",y="payable_commodity",h="quotational_periods",b="navarch_commodity",g="name",q="code",S=d("values",o({}));return c.value=!!S.value[m],n((()=>S.value[m]),(async e=>{e?async function(e){c.value=!0;const t=await i.get(`/items/${p}`,{params:{filter:{_and:[{[f]:{_eq:e}},{_or:[{[_]:{_eq:!0}},{[y]:{_eq:!0}}]}]},fields:[v,h]}});console.log(`[loadQpSelectionField] fetched commodity in contract data=${JSON.stringify(t.data.data)}`);const a=t.data.data.map((e=>e[v])),o=await i.get(`/items/${b}`,{params:{filter:{[u]:{_in:a}},fields:[u,g,q]}});console.log(`[loadQpSelectionField] fetched commodity data=${JSON.stringify(o.data.data)}`),r.value=o.data.data.map((e=>e[q]));const d=o.data.data.reduce(((e,t)=>(e[t[u]]={name:t[g],code:t[q]},e)),{});0===Object.keys(s.value).length&&(s.value=t.data.data.reduce(((e,t)=>{const a=t[v],o=d[a],n=t[h];return e[o.code]={commodity_name:o.name,commodity_code:o.code,commodity_id:a,declared:!1,qp_selected:null,qp_selections:n.map((e=>({text:`${e.qp_period} ${e.qp_code}${e.default?" (default)":""}`,value:`${e.qp_period} ${e.qp_code}`})))},e}),{}));console.log(`[loadQpSelectionField] qpCommodities=${JSON.stringify(s.value)}`)}(e):(c.value=!1,a("input",null))}),{immediate:!0}),n(s,(e=>{console.log("[watch] changes detected for the QP settings for the commodities"),a("input",JSON.stringify(e))}),{deep:!0}),{isContractSelected:c,qpCommodities:s,commodityCodeList:r}}});const b={key:0},g={key:1},q={class:"list-item-component left"};var S=[],x=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,o=!0===t.prepend?"prepend":"append",d=!0===t.singleTag,n="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(d){var l=S.indexOf(n);-1===l&&(l=S.push(n)-1,x[l]={}),a=x[l]&&x[l][o]?x[l][o]:x[l][o]=i()}else a=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),d=0;d<a.length;d++)e.setAttribute(a[d],t.attributes[a[d]]);var l="prepend"===o?"afterbegin":"beforeend";return n.insertAdjacentElement(l,e),e}}('.list-item[data-v-64969d30] {\n  margin-bottom: 10px;\n}\n.list-item-component[data-v-64969d30] {\n  float: left;\n}\n.left[data-v-64969d30] {\n  width: 30%;\n}\n.middle[data-v-64969d30] {\n  width: 40%;\n}\n.right[data-v-64969d30] {\n  width: 30%;\n  padding-left: 20px;\n}\n\n/* Clear floats after the columns */\n.list-item[data-v-64969d30]:after {\n  content: "";\n  display: table;\n  clear: both;\n}',{}),h.render=function(e,t,a,o,d,n){const h=l("v-select"),S=l("v-checkbox"),x=l("v-list-item"),$=l("v-list"),k=l("v-sheet"),C=i("tooltip");return c(),s(k,null,{default:r((()=>[e.isContractSelected?(c(),m("div",g,[u($,null,{default:r((()=>[(c(!0),m(p,null,f(e.qpCommodities,(e=>(c(),s(x,{class:"list-item",key:e.commodity_id},{default:r((()=>[v("div",q,_(`${e.commodity_name} (${e.commodity_code}):`),1),y(u(h,{class:"list-item-component middle",modelValue:e.qp_selected,"onUpdate:modelValue":t=>e.qp_selected=t,items:e.qp_selections,disabled:e.declared},null,8,["modelValue","onUpdate:modelValue","items","disabled"]),[[C,e.declared?"Cannot change Quotational Period if Declared.":null,void 0,{bottom:!0}]]),y(u(S,{class:"list-item-component right",modelValue:e.declared,"onUpdate:modelValue":t=>e.declared=t,"icon-on":"check_box","icon-off":"check_box_outline_blank",label:"Declared",disabled:null===e.qp_selected},null,8,["modelValue","onUpdate:modelValue","disabled"]),[[C,e.qp_selected?null:"Please select a Quotational Period first.",void 0,{bottom:!0}]])])),_:2},1024)))),128))])),_:1})])):(c(),m("div",b,"Please select a contract first."))])),_:1})},h.__scopeId="data-v-64969d30",h.__file="src/interface.vue";var $=t({id:"navarch-qp-select",name:"Navarch QP Select",icon:"format_list_numbered_rtl",description:"For QP selection in the Parcel form",component:h,options:null,types:["json"]});export{$ as default};
