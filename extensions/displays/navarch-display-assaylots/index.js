import{useApi as t,defineDisplay as n}from"@directus/extensions-sdk";import{defineComponent as r,ref as e,openBlock as a,createElementBlock as s,toDisplayString as o}from"vue";const l="foreign_key",u="method",i="commodity",c="assay_uom",d="final_assay",p="dry_weight";var f=(t=>(t[t.Estimated=0]="Estimated",t[t.Planned=10]="Planned",t[t.Inturn=20]="Inturn",t[t.InturnFinal=30]="InturnFinal",t[t.Outturn=40]="Outturn",t))(f||{});function h(t){switch(t){case"Inturn":return f.Inturn;case"Outturn":return f.Outturn;case"Inturn Final":return f.InturnFinal;case"Planned":return f.Planned;case"Estimated":return f.Estimated;default:throw new Error(`Invalid method type ${t}, please contact Navarch for support`)}}function m(t,n=2,r=!1){if(null==t||isNaN(t))return null;const e=r&&t<0;return e&&(t*=-1),Math.round(t*Math.pow(10,n))/Math.pow(10,n)*(e?-1:1)}function y(t,n=2,r=!0){if(isNaN(t)||null==t)return"-";const e=Math.round(t*Math.pow(10,n))/Math.pow(10,n),[a,s]=e.toString().split("."),o=a?a.replace(/\B(?=(\d{3})+(?!\d))/g,","):0;if(!s&&!r)return o;return`${o}.${(null!=s?s:"").padEnd(n,"0")}`}var v=r({props:{value:{type:String,default:null}},setup(n){const r=e(null);return t().get("/items/navarch_assay_lot",{params:{filter:{[l]:{_eq:n.value}},fields:["lot_number",u,p,d,c,i]}}).then((t=>{var n,e;const a=t.data.data,s=a.map((t=>t[u])).sort(((t,n)=>h(n)-h(t)));if(0===s.length)return;const o=s[0],l=a.filter((t=>t[u]===o)).reduce(((t,n)=>{const r=n[i];return t[r]||(t[r]=[]),t[r].push(n),t}),{}),f=[];for(const t of Object.values(l))if(!(t.length<1))if(1===t.length)f.push(`${t[0][d]} ${t[0][c]} (${t[0][i]})`);else if(t.length>1){const r=t.filter((t=>null!==t[d]));let a=0,s=0;for(const t of r)a+=parseFloat(t[p]),s+=null!=(n=m(parseFloat(t[d])*parseFloat(t[p]),4))?n:0;const o=null!=(e=m(s/a,4))?e:0;f.push(`${y(o,4)}${r[0][c]} (${r[0][i]})`)}r.value=f.join(" | ")})).catch((t=>{console.error(t),r.value="Error occured"})),{finalAssaysByCommodity:r}}});v.render=function(t,n,r,e,l,u){return a(),s("div",null,o(t.finalAssaysByCommodity??"-"),1)},v.__file="src/display.vue";var g=n({id:"navarch-display-assaylots",name:"Navarch Display Assay Lots",icon:"box",description:"This is for displaying aggregate assay lot values in the Parcel home page.",component:v,options:null,types:["string"]});export{g as default};
