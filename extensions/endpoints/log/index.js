"use strict";var e=require("fs"),t=require("path"),n=require("os"),r=require("crypto"),s=require("util"),o=require("perf_hooks"),i=require("url"),a=require("module"),c=require("tty"),u=require("worker_threads"),l=require("events"),p=require("node:diagnostics_channel"),d=require("diagnostics_channel"),h=require("node:net"),f=require("async_hooks"),_=require("node:child_process"),m=require("node:fs"),g=require("node:os"),E=require("node:path"),S=require("node:util"),T=require("node:readline"),y=require("node:worker_threads"),A=require("node:http"),v=require("node:https"),b=require("node:stream"),R=require("node:zlib"),O=require("node:tls");function N(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}require("axios");var C=N(t),I=N(p),P=N(d),M=N(h),w=N(g),L=N(S),x=N(A),D=N(v),k=N(O),U="object"==typeof globalThis?globalThis:global,$="1.9.0",G=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var j=function(e){var t=new Set([e]),n=new Set,r=e.match(G);if(!r)return function(){return!1};var s=+r[1],o=+r[2],i=+r[3];if(null!=r[4])return function(t){return t===e};function a(e){return n.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(G);if(!r)return a(e);var u=+r[1],l=+r[2],p=+r[3];return null!=r[4]||s!==u?a(e):0===s?o===l&&i<=p?c(e):a(e):o<=l?c(e):a(e)}}($),V=$.split(".")[0],H=Symbol.for("opentelemetry.js.api."+V),B=U;function F(e,t,n,r){var s;void 0===r&&(r=!1);var o=B[H]=null!==(s=B[H])&&void 0!==s?s:{version:$};if(!r&&o[e]){var i=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(i.stack||i.message),!1}if(o.version!==$){i=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+$);return n.error(i.stack||i.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+$+"."),!0}function Y(e){var t,n,r=null===(t=B[H])||void 0===t?void 0:t.version;if(r&&j(r))return null===(n=B[H])||void 0===n?void 0:n[e]}function q(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+$+".");var n=B[H];n&&delete n[e]}var K,W=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},Z=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},X=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("verbose",this._namespace,e)},e}();function z(e,t,n){var r=Y("diag");if(r)return n.unshift(t),r[e].apply(r,Z([],W(n),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(K||(K={}));var Q=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},J=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},ee=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Y("diag");if(r)return r[e].apply(r,J([],Q(t),!1))}}var t=this;t.setLogger=function(e,n){var r,s,o;if(void 0===n&&(n={logLevel:K.INFO}),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}"number"==typeof n&&(n={logLevel:n});var a=Y("diag"),c=function(e,t){function n(n,r){var s=t[n];return"function"==typeof s&&e>=r?s.bind(t):function(){}}return e<K.NONE?e=K.NONE:e>K.ALL&&(e=K.ALL),t=t||{},{error:n("error",K.ERROR),warn:n("warn",K.WARN),info:n("info",K.INFO),debug:n("debug",K.DEBUG),verbose:n("verbose",K.VERBOSE)}}(null!==(s=n.logLevel)&&void 0!==s?s:K.INFO,e);if(a&&!n.suppressOverrideMessage){var u=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+u),c.warn("Current logger will overwrite one already registered from "+u)}return F("diag",c,t,!0)},t.disable=function(){q("diag",t)},t.createComponentLogger=function(e){return new X(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),te=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},ne=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},re=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=te(e,2);return[t[0],t[1]]})},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=new e(this._entries);try{for(var i=ne(r),a=i.next();!a.done;a=i.next()){var c=a.value;o._entries.delete(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),se=Symbol("BaggageEntryMetadata"),oe=ee.instance();function ie(e){return void 0===e&&(e={}),new re(new Map(Object.entries(e)))}function ae(e){return"string"!=typeof e&&(oe.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:se,toString:function(){return e}}}function ce(e){return Symbol.for(e)}var ue,le,pe=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var s=new e(n._currentContext);return s._currentContext.set(t,r),s},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},de=new pe,he=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],fe=function(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(console){var r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}for(var t=0;t<he.length;t++)this[he[t].n]=e(he[t].c)},_e=(ue=function(e,t){return ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ue(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ue(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),me=function(){function e(){}return e.prototype.createGauge=function(e,t){return Ce},e.prototype.createHistogram=function(e,t){return Ie},e.prototype.createCounter=function(e,t){return Ne},e.prototype.createUpDownCounter=function(e,t){return Pe},e.prototype.createObservableGauge=function(e,t){return we},e.prototype.createObservableCounter=function(e,t){return Me},e.prototype.createObservableUpDownCounter=function(e,t){return Le},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),ge=function(){},Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.prototype.add=function(e,t){},t}(ge),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.prototype.add=function(e,t){},t}(ge),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.prototype.record=function(e,t){},t}(ge),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.prototype.record=function(e,t){},t}(ge),Ae=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t}(Ae),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t}(Ae),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t}(Ae),Oe=new me,Ne=new Ee,Ce=new Te,Ie=new ye,Pe=new Se,Me=new ve,we=new be,Le=new Re;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(le||(le={}));var xe,De={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},ke={set:function(e,t,n){null!=e&&(e[t]=n)}},Ue=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},$e=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},Ge=function(){function e(){}return e.prototype.active=function(){return de},e.prototype.with=function(e,t,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];return t.call.apply(t,$e([n],Ue(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),je=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},Ve=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},He="context",Be=new Ge,Fe=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return F(He,e,ee.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,Ve([e,t,n],je(s),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Y(He)||Be},e.prototype.disable=function(){this._getContextManager().disable(),q(He,ee.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(xe||(xe={}));var Ye="0000000000000000",qe="00000000000000000000000000000000",Ke={traceId:qe,spanId:Ye,traceFlags:xe.NONE},We=function(){function e(e){void 0===e&&(e=Ke),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),Ze=ce("OpenTelemetry Context Key SPAN");function Xe(e){return e.getValue(Ze)||void 0}function ze(){return Xe(Fe.getInstance().active())}function Qe(e,t){return e.setValue(Ze,t)}function Je(e){return e.deleteValue(Ze)}function et(e,t){return Qe(e,new We(t))}function tt(e){var t;return null===(t=Xe(e))||void 0===t?void 0:t.spanContext()}var nt=/^([0-9a-f]{32})$/i,rt=/^[0-9a-f]{16}$/i;function st(e){return nt.test(e)&&e!==qe}function ot(e){return rt.test(e)&&e!==Ye}function it(e){return st(e.traceId)&&ot(e.spanId)}function at(e){return new We(e)}var ct=Fe.getInstance(),ut=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(void 0===n&&(n=ct.active()),Boolean(null==t?void 0:t.root))return new We;var r,s=n&&tt(n);return"object"==typeof(r=s)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&it(s)?new We(s):new We},e.prototype.startActiveSpan=function(e,t,n,r){var s,o,i;if(!(arguments.length<2)){2===arguments.length?i=t:3===arguments.length?(s=t,i=n):(s=t,o=n,i=r);var a=null!=o?o:ct.active(),c=this.startSpan(e,s,a),u=Qe(a,c);return ct.with(u,i,void 0,c)}},e}();var lt,pt,dt,ht=new ut,ft=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):ht},e}(),_t=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new ut},e}()),mt=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new ft(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:_t},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(lt||(lt={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(pt||(pt={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(dt||(dt={}));var gt="[_0-9a-z-*/]",Et=new RegExp("^(?:"+("[a-z]"+gt+"{0,255}")+"|"+("[a-z0-9]"+gt+"{0,240}@[a-z]"+gt+"{0,13}")+")$"),St=/^[ -~]{0,255}[!-~]$/,Tt=/,|=/;var yt=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,n){return t.push(n+"="+e.get(n)),t},[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce(function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var s=n.slice(0,r),o=n.slice(r+1,t.length);(function(e){return Et.test(e)})(s)&&function(e){return St.test(e)&&!Tt.test(e)}(o)&&e.set(s,o)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var At=Fe.getInstance(),vt=ee.instance(),bt=new(function(){function e(){}return e.prototype.getMeter=function(e,t,n){return Oe},e}()),Rt="metrics",Ot=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return F(Rt,e,ee.instance())},e.prototype.getMeterProvider=function(){return Y(Rt)||bt},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){q(Rt,ee.instance())},e}(),Nt=Ot.getInstance(),Ct=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),It=ce("OpenTelemetry Baggage Key");function Pt(e){return e.getValue(It)||void 0}function Mt(){return Pt(Fe.getInstance().active())}function wt(e,t){return e.setValue(It,t)}function Lt(e){return e.deleteValue(It)}var xt="propagation",Dt=new Ct,kt=function(){function e(){this.createBaggage=ie,this.getBaggage=Pt,this.getActiveBaggage=Mt,this.setBaggage=wt,this.deleteBaggage=Lt}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return F(xt,e,ee.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=ke),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=De),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){q(xt,ee.instance())},e.prototype._getGlobalPropagator=function(){return Y(xt)||Dt},e}(),Ut=kt.getInstance(),$t="trace",Gt=function(){function e(){this._proxyTracerProvider=new mt,this.wrapSpanContext=at,this.isSpanContextValid=it,this.deleteSpan=Je,this.getSpan=Xe,this.getActiveSpan=ze,this.getSpanContext=tt,this.setSpan=Qe,this.setSpanContext=et}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=F($t,this._proxyTracerProvider,ee.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Y($t)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){q($t,ee.instance()),this._proxyTracerProvider=new mt},e}(),jt=Gt.getInstance(),Vt={context:At,diag:vt,metrics:Nt,propagation:Ut,trace:jt};function Ht(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Bt(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),n}var Ft={},Yt={},qt=Bt(Object.freeze({__proto__:null,DiagConsoleLogger:fe,get DiagLogLevel(){return K},INVALID_SPANID:Ye,INVALID_SPAN_CONTEXT:Ke,INVALID_TRACEID:qe,ProxyTracer:ft,ProxyTracerProvider:mt,ROOT_CONTEXT:de,get SamplingDecision(){return lt},get SpanKind(){return pt},get SpanStatusCode(){return dt},get TraceFlags(){return xe},get ValueType(){return le},baggageEntryMetadataFromString:ae,context:At,createContextKey:ce,createNoopMeter:function(){return Oe},createTraceState:function(e){return new yt(e)},default:Vt,defaultTextMapGetter:De,defaultTextMapSetter:ke,diag:vt,isSpanContextValid:it,isValidSpanId:ot,isValidTraceId:st,metrics:Nt,propagation:Ut,trace:jt}));const Kt=ce("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Wt(e){return e.setValue(Kt,!0)}function Zt(e){return!0===e.getValue(Kt)}const Xt=",",zt="baggage";function Qt(e){const t=e.split(";");if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const s=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim());let i;return t.length>0&&(i=ae(t.join(";"))),{key:s,value:o,metadata:i}}class Jt{inject(e,t,n){const r=Ut.getBaggage(e);if(!r||Zt(e))return;const s=function(e){return e.getAllEntries().map(([e,t])=>{let n=`${encodeURIComponent(e)}=${encodeURIComponent(t.value)}`;return void 0!==t.metadata&&(n+=";"+t.metadata.toString()),n})}(r).filter(e=>e.length<=4096).slice(0,180),o=function(e){return e.reduce((e,t)=>{const n=`${e}${""!==e?Xt:""}${t}`;return n.length>8192?e:n},"")}(s);o.length>0&&n.set(t,zt,o)}extract(e,t,n){const r=n.get(t,zt),s=Array.isArray(r)?r.join(Xt):r;if(!s)return e;const o={};if(0===s.length)return e;return s.split(Xt).forEach(e=>{const t=Qt(e);if(t){const e={value:t.value};t.metadata&&(e.metadata=t.metadata),o[t.key]=e}}),0===Object.entries(o).length?e:Ut.setBaggage(e,Ut.createBaggage(o))}fields(){return[zt]}}function en(e){const t={};if("object"!=typeof e||null==e)return t;for(const[n,r]of Object.entries(e))tn(n)?nn(r)?Array.isArray(r)?t[n]=r.slice():t[n]=r:vt.warn(`Invalid attribute value set for key: ${n}`):vt.warn(`Invalid attribute key: ${n}`);return t}function tn(e){return"string"==typeof e&&e.length>0}function nn(e){return null==e||(Array.isArray(e)?function(e){let t;for(const n of e)if(null!=n){if(!t){if(rn(n)){t=typeof n;continue}return!1}if(typeof n!==t)return!1}return!0}(e):rn(e))}function rn(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function sn(){return e=>{vt.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){const t={};let n=e;for(;null!==n;)Object.getOwnPropertyNames(n).forEach(e=>{if(t[e])return;const r=n[e];r&&(t[e]=String(r))}),n=Object.getPrototypeOf(n);return t}(e))}(e))}}let on=sn();function an(e){try{on(e)}catch{}}function cn(e){const t=process.env[e];if(null==t||""===t.trim())return;const n=Number(t);if(!isNaN(n))return n;vt.warn(`Unknown value ${s.inspect(t)} for ${e}, expected a number, using defaults`)}function un(e){const t=process.env[e];if(null!=t&&""!==t.trim())return t}const ln="object"==typeof globalThis?globalThis:global,pn=o.performance;function dn(e){let t={};const n=e.length;for(let r=0;r<n;r++){const n=e[r];n&&(t[String(n).toUpperCase().replace(/[-.]/g,"_")]=n)}return t}const hn="aws.lambda.invoked_arn",fn="db.system",_n="db.connection_string",mn="db.user",gn="db.jdbc.driver_classname",En="db.name",Sn="db.statement",Tn="db.operation",yn="db.mssql.instance_name",An="db.cassandra.keyspace",vn="db.cassandra.page_size",bn="db.cassandra.consistency_level",Rn="db.cassandra.table",On="db.cassandra.idempotence",Nn="db.cassandra.speculative_execution_count",Cn="db.cassandra.coordinator.id",In="db.cassandra.coordinator.dc",Pn="db.hbase.namespace",Mn="db.redis.database_index",wn="db.mongodb.collection",Ln="db.sql.table",xn="exception.type",Dn="exception.message",kn="exception.stacktrace",Un="exception.escaped",$n="faas.trigger",Gn="faas.execution",jn="faas.document.collection",Vn="faas.document.operation",Hn="faas.document.time",Bn="faas.document.name",Fn="faas.time",Yn="faas.cron",qn="faas.coldstart",Kn="faas.invoked_name",Wn="faas.invoked_provider",Zn="faas.invoked_region",Xn="net.transport",zn="net.peer.ip",Qn="net.peer.port",Jn="net.peer.name",er="net.host.ip",tr="net.host.port",nr="net.host.name",rr="net.host.connection.type",sr="net.host.connection.subtype",or="net.host.carrier.name",ir="net.host.carrier.mcc",ar="net.host.carrier.mnc",cr="net.host.carrier.icc",ur="peer.service",lr="enduser.id",pr="enduser.role",dr="enduser.scope",hr="thread.id",fr="thread.name",_r="code.function",mr="code.namespace",gr="code.filepath",Er="code.lineno",Sr="http.method",Tr="http.url",yr="http.target",Ar="http.host",vr="http.scheme",br="http.status_code",Rr="http.flavor",Or="http.user_agent",Nr="http.request_content_length",Cr="http.request_content_length_uncompressed",Ir="http.response_content_length",Pr="http.response_content_length_uncompressed",Mr="http.server_name",wr="http.route",Lr="http.client_ip",xr="aws.dynamodb.table_names",Dr="aws.dynamodb.consumed_capacity",kr="aws.dynamodb.item_collection_metrics",Ur="aws.dynamodb.provisioned_read_capacity",$r="aws.dynamodb.provisioned_write_capacity",Gr="aws.dynamodb.consistent_read",jr="aws.dynamodb.projection",Vr="aws.dynamodb.limit",Hr="aws.dynamodb.attributes_to_get",Br="aws.dynamodb.index_name",Fr="aws.dynamodb.select",Yr="aws.dynamodb.global_secondary_indexes",qr="aws.dynamodb.local_secondary_indexes",Kr="aws.dynamodb.exclusive_start_table",Wr="aws.dynamodb.table_count",Zr="aws.dynamodb.scan_forward",Xr="aws.dynamodb.segment",zr="aws.dynamodb.total_segments",Qr="aws.dynamodb.count",Jr="aws.dynamodb.scanned_count",es="aws.dynamodb.attribute_definitions",ts="aws.dynamodb.global_secondary_index_updates",ns="messaging.system",rs="messaging.destination",ss="messaging.destination_kind",os="messaging.temp_destination",is="messaging.protocol",as="messaging.protocol_version",cs="messaging.url",us="messaging.message_id",ls="messaging.conversation_id",ps="messaging.message_payload_size_bytes",ds="messaging.message_payload_compressed_size_bytes",hs="messaging.operation",fs="messaging.consumer_id",_s="messaging.rabbitmq.routing_key",ms="messaging.kafka.message_key",gs="messaging.kafka.consumer_group",Es="messaging.kafka.client_id",Ss="messaging.kafka.partition",Ts="messaging.kafka.tombstone",ys="rpc.system",As="rpc.service",vs="rpc.method",bs="rpc.grpc.status_code",Rs="rpc.jsonrpc.version",Os="rpc.jsonrpc.request_id",Ns="rpc.jsonrpc.error_code",Cs="rpc.jsonrpc.error_message",Is="message.type",Ps="message.id",Ms="message.compressed_size",ws="message.uncompressed_size",Ls=hn,xs=fn,Ds=_n,ks=mn,Us=gn,$s=En,Gs=Sn,js=Tn,Vs=yn,Hs=An,Bs=vn,Fs=bn,Ys=Rn,qs=On,Ks=Nn,Ws=Cn,Zs=In,Xs=Pn,zs=Mn,Qs=wn,Js=Ln,eo=xn,to=Dn,no=kn,ro=Un,so=$n,oo=Gn,io=jn,ao=Vn,co=Hn,uo=Bn,lo=Fn,po=Yn,ho=qn,fo=Kn,_o=Wn,mo=Zn,go=Xn,Eo=zn,So=Qn,To=Jn,yo=er,Ao=tr,vo=nr,bo=rr,Ro=sr,Oo=or,No=ir,Co=ar,Io=cr,Po=ur,Mo=lr,wo=pr,Lo=dr,xo=hr,Do=fr,ko=_r,Uo=mr,$o=gr,Go=Er,jo=Sr,Vo=Tr,Ho=yr,Bo=Ar,Fo=vr,Yo=br,qo=Rr,Ko=Or,Wo=Nr,Zo=Cr,Xo=Ir,zo=Pr,Qo=Mr,Jo=wr,ei=Lr,ti=xr,ni=Dr,ri=kr,si=Ur,oi=$r,ii=Gr,ai=jr,ci=Vr,ui=Hr,li=Br,pi=Fr,di=Yr,hi=qr,fi=Kr,_i=Wr,mi=Zr,gi=Xr,Ei=zr,Si=Qr,Ti=Jr,yi=es,Ai=ts,vi=ns,bi=rs,Ri=ss,Oi=os,Ni=is,Ci=as,Ii=cs,Pi=us,Mi=ls,wi=ps,Li=ds,xi=hs,Di=fs,ki=_s,Ui=ms,$i=gs,Gi=Es,ji=Ss,Vi=Ts,Hi=ys,Bi=As,Fi=vs,Yi=bs,qi=Rs,Ki=Os,Wi=Ns,Zi=Cs,Xi=Is,zi=Ps,Qi=Ms,Ji=ws,ea=dn([hn,fn,_n,mn,gn,En,Sn,Tn,yn,An,vn,bn,Rn,On,Nn,Cn,In,Pn,Mn,wn,Ln,xn,Dn,kn,Un,$n,Gn,jn,Vn,Hn,Bn,Fn,Yn,qn,Kn,Wn,Zn,Xn,zn,Qn,Jn,er,tr,nr,rr,sr,or,ir,ar,cr,ur,lr,pr,dr,hr,fr,_r,mr,gr,Er,Sr,Tr,yr,Ar,vr,br,Rr,Or,Nr,Cr,Ir,Pr,Mr,wr,Lr,xr,Dr,kr,Ur,$r,Gr,jr,Vr,Hr,Br,Fr,Yr,qr,Kr,Wr,Zr,Xr,zr,Qr,Jr,es,ts,ns,rs,ss,os,is,as,cs,us,ls,ps,ds,hs,fs,_s,ms,gs,Es,Ss,Ts,ys,As,vs,bs,Rs,Os,Ns,Cs,Is,Ps,Ms,ws]),ta="other_sql",na="mssql",ra="mysql",sa="oracle",oa="postgresql",ia="redshift",aa="hive",ca="cloudscape",ua="hsqldb",la="progress",pa="maxdb",da="hanadb",ha="ingres",fa="firstsql",_a="cache",ma="adabas",ga="firebird",Ea="derby",Sa="filemaker",Ta="informix",ya="instantdb",Aa="interbase",va="mariadb",ba="netezza",Ra="pervasive",Oa="pointbase",Na="sqlite",Ca="sybase",Ia="teradata",Pa="vertica",Ma="coldfusion",wa="cassandra",La="hbase",xa="mongodb",Da="redis",ka="couchbase",Ua="couchdb",$a="cosmosdb",Ga="dynamodb",ja="neo4j",Va="geode",Ha="elasticsearch",Ba="memcached",Fa="cockroachdb",Ya=ta,qa=na,Ka=ra,Wa=sa,Za=oa,Xa=ia,za=aa,Qa=ca,Ja=ua,ec=la,tc=pa,nc=da,rc=ha,sc=fa,oc=_a,ic=ma,ac=ga,cc=Ea,uc=Sa,lc=Ta,pc=ya,dc=Aa,hc=va,fc=ba,_c=Ra,mc=Oa,gc=Na,Ec=Ca,Sc=Ia,Tc=Pa,yc=Ma,Ac=wa,vc=La,bc=xa,Rc=Da,Oc=ka,Nc=Ua,Cc=$a,Ic=Ga,Pc=ja,Mc=Va,wc=Ha,Lc=Ba,xc=Fa,Dc=dn([ta,na,ra,sa,"db2",oa,ia,aa,ca,ua,la,pa,da,ha,fa,"edb",_a,ma,ga,Ea,Sa,Ta,ya,Aa,va,ba,Ra,Oa,Na,Ca,Ia,Pa,"h2",Ma,wa,La,xa,Da,ka,Ua,$a,Ga,ja,Va,Ha,Ba,Fa]),kc="each_quorum",Uc="quorum",$c="local_quorum",Gc="three",jc="local_one",Vc="serial",Hc="local_serial",Bc=kc,Fc=Uc,Yc=$c,qc=Gc,Kc=jc,Wc=Vc,Zc=Hc,Xc=dn(["all",kc,Uc,$c,"one","two",Gc,jc,"any",Vc,Hc]),zc="datasource",Qc="http",Jc="pubsub",eu="timer",tu="other",nu=zc,ru=Qc,su=Jc,ou=eu,iu=tu,au=dn([zc,Qc,Jc,eu,tu]),cu="insert",uu="edit",lu="delete",pu=cu,du=uu,hu=lu,fu=dn([cu,uu,lu]),_u="alibaba_cloud",mu="azure",gu=_u,Eu=mu,Su=dn([_u,"aws",mu,"gcp"]),Tu="ip_tcp",yu="ip_udp",Au="unix",vu="pipe",bu="inproc",Ru="other",Ou=Tu,Nu=yu,Cu=Au,Iu=vu,Pu=bu,Mu=Ru,wu=dn([Tu,yu,"ip",Au,vu,bu,Ru]),Lu="wifi",xu="wired",Du="cell",ku="unavailable",Uu="unknown",$u=Lu,Gu=xu,ju=Du,Vu=ku,Hu=Uu,Bu=dn([Lu,xu,Du,ku,Uu]),Fu="gprs",Yu="edge",qu="umts",Ku="cdma",Wu="evdo_0",Zu="evdo_a",Xu="cdma2000_1xrtt",zu="hsdpa",Qu="hsupa",Ju="hspa",el="iden",tl="evdo_b",nl="ehrpd",rl="hspap",sl="td_scdma",ol="iwlan",il="nrnsa",al="lte_ca",cl=Fu,ul=Yu,ll=qu,pl=Ku,dl=Wu,hl=Zu,fl=Xu,_l=zu,ml=Qu,gl=Ju,El=el,Sl=tl,Tl=nl,yl=rl,Al=sl,vl=ol,bl=il,Rl=al,Ol=dn([Fu,Yu,qu,Ku,Wu,Zu,Xu,zu,Qu,Ju,el,tl,"lte",nl,rl,"gsm",sl,ol,"nr",il,al]),Nl="SPDY",Cl="QUIC",Il=Nl,Pl=Cl,Ml={HTTP_1_0:"1.0",HTTP_1_1:"1.1",HTTP_2_0:"2.0",SPDY:Nl,QUIC:Cl},wl="queue",Ll="topic",xl=wl,Dl=Ll,kl=dn([wl,Ll]),Ul="receive",$l="process",Gl=Ul,jl=$l,Vl=dn([Ul,$l]),Hl={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16},Bl="SENT",Fl="RECEIVED",Yl=Bl,ql=Fl,Kl=dn([Bl,Fl]),Wl="cloud.provider",Zl="cloud.account.id",Xl="cloud.region",zl="cloud.availability_zone",Ql="cloud.platform",Jl="aws.ecs.container.arn",ep="aws.ecs.cluster.arn",tp="aws.ecs.launchtype",np="aws.ecs.task.arn",rp="aws.ecs.task.family",sp="aws.ecs.task.revision",op="aws.eks.cluster.arn",ip="aws.log.group.names",ap="aws.log.group.arns",cp="aws.log.stream.names",up="aws.log.stream.arns",lp="container.name",pp="container.id",dp="container.runtime",hp="container.image.name",fp="container.image.tag",_p="deployment.environment",mp="device.id",gp="device.model.identifier",Ep="device.model.name",Sp="faas.name",Tp="faas.id",yp="faas.version",Ap="faas.instance",vp="faas.max_memory",bp="host.id",Rp="host.name",Op="host.type",Np="host.arch",Cp="host.image.name",Ip="host.image.id",Pp="host.image.version",Mp="k8s.cluster.name",wp="k8s.node.name",Lp="k8s.node.uid",xp="k8s.namespace.name",Dp="k8s.pod.uid",kp="k8s.pod.name",Up="k8s.container.name",$p="k8s.replicaset.uid",Gp="k8s.replicaset.name",jp="k8s.deployment.uid",Vp="k8s.deployment.name",Hp="k8s.statefulset.uid",Bp="k8s.statefulset.name",Fp="k8s.daemonset.uid",Yp="k8s.daemonset.name",qp="k8s.job.uid",Kp="k8s.job.name",Wp="k8s.cronjob.uid",Zp="k8s.cronjob.name",Xp="os.type",zp="os.description",Qp="os.name",Jp="os.version",ed="process.pid",td="process.executable.name",nd="process.executable.path",rd="process.command",sd="process.command_line",od="process.command_args",id="process.owner",ad="process.runtime.name",cd="process.runtime.version",ud="process.runtime.description",ld="service.name",pd="service.namespace",dd="service.instance.id",hd="service.version",fd="telemetry.sdk.name",_d="telemetry.sdk.language",md="telemetry.sdk.version",gd="telemetry.auto.version",Ed="webengine.name",Sd="webengine.version",Td="webengine.description",yd=Wl,Ad=Zl,vd=Xl,bd=zl,Rd=Ql,Od=Jl,Nd=ep,Cd=tp,Id=np,Pd=rp,Md=sp,wd=op,Ld=ip,xd=ap,Dd=cp,kd=up,Ud=lp,$d=pp,Gd=dp,jd=hp,Vd=fp,Hd=_p,Bd=mp,Fd=gp,Yd=Ep,qd=Sp,Kd=Tp,Wd=yp,Zd=Ap,Xd=vp,zd=bp,Qd=Rp,Jd=Op,eh=Np,th=Cp,nh=Ip,rh=Pp,sh=Mp,oh=wp,ih=Lp,ah=xp,ch=Dp,uh=kp,lh=Up,ph=$p,dh=Gp,hh=jp,fh=Vp,_h=Hp,mh=Bp,gh=Fp,Eh=Yp,Sh=qp,Th=Kp,yh=Wp,Ah=Zp,vh=Xp,bh=zp,Rh=Qp,Oh=Jp,Nh=ed,Ch=td,Ih=nd,Ph=rd,Mh=sd,wh=od,Lh=id,xh=ad,Dh=cd,kh=ud,Uh=ld,$h=pd,Gh=dd,jh=hd,Vh=fd,Hh=_d,Bh=md,Fh=gd,Yh=Ed,qh=Sd,Kh=Td,Wh=dn([Wl,Zl,Xl,zl,Ql,Jl,ep,tp,np,rp,sp,op,ip,ap,cp,up,lp,pp,dp,hp,fp,_p,mp,gp,Ep,Sp,Tp,yp,Ap,vp,bp,Rp,Op,Np,Cp,Ip,Pp,Mp,wp,Lp,xp,Dp,kp,Up,$p,Gp,jp,Vp,Hp,Bp,Fp,Yp,qp,Kp,Wp,Zp,Xp,zp,Qp,Jp,ed,td,nd,rd,sd,od,id,ad,cd,ud,ld,pd,dd,hd,fd,_d,md,gd,Ed,Sd,Td]),Zh="alibaba_cloud",Xh="azure",zh=Zh,Qh=Xh,Jh=dn([Zh,"aws",Xh,"gcp"]),ef="alibaba_cloud_ecs",tf="alibaba_cloud_fc",nf="aws_ec2",rf="aws_ecs",sf="aws_eks",of="aws_lambda",af="aws_elastic_beanstalk",cf="azure_vm",uf="azure_container_instances",lf="azure_aks",pf="azure_functions",df="azure_app_service",hf="gcp_compute_engine",ff="gcp_cloud_run",_f="gcp_kubernetes_engine",mf="gcp_cloud_functions",gf="gcp_app_engine",Ef=ef,Sf=tf,Tf=nf,yf=rf,Af=sf,vf=of,bf=af,Rf=cf,Of=uf,Nf=lf,Cf=pf,If=df,Pf=hf,Mf=ff,wf=_f,Lf=mf,xf=gf,Df=dn([ef,tf,nf,rf,sf,of,af,cf,uf,lf,pf,df,hf,ff,_f,mf,gf]),kf="fargate",Uf=kf,$f=dn(["ec2",kf]),Gf="amd64",jf="arm32",Vf="arm64",Hf="ia64",Bf="ppc32",Ff="ppc64",Yf=Gf,qf=jf,Kf=Vf,Wf=Hf,Zf=Bf,Xf=Ff,zf=dn([Gf,jf,Vf,Hf,Bf,Ff,"x86"]),Qf="windows",Jf="linux",e_="darwin",t_="freebsd",n_="netbsd",r_="openbsd",s_="dragonflybsd",o_="hpux",i_="solaris",a_="z_os",c_=Qf,u_=Jf,l_=e_,p_=t_,d_=n_,h_=r_,f_=s_,__=o_,m_=i_,g_=a_,E_=dn([Qf,Jf,e_,t_,n_,r_,s_,o_,"aix",i_,a_]),S_="dotnet",T_="erlang",y_="java",A_="nodejs",v_="python",b_="ruby",R_="webjs",O_=S_,N_=T_,C_=y_,I_=A_,P_=v_,M_=b_,w_=R_,L_=dn(["cpp",S_,T_,"go",y_,A_,"php",v_,b_,R_]),x_="db.collection.name",D_="db.namespace",k_="db.operation.name",U_="db.query.text",$_="db.response.status_code",G_="db.system.name",j_="error.type",V_="exception.message",H_="exception.stacktrace",B_="exception.type",F_="http.request.method",Y_="http.response.status_code",q_="http.route",K_="server.address",W_="server.port",Z_="service.name",X_="service.version",z_="telemetry.sdk.language",Q_="nodejs",J_="telemetry.sdk.name",em="telemetry.sdk.version",tm="url.full";var nm=Object.freeze({__proto__:null,ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED:"aborted",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED:"handled",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED:"skipped",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED:"unhandled",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED:"acquired",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER:"endpoint_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER:"global_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED:"request_canceled",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE:"failure",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS:"success",ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT:"aspnetcore.diagnostics.exception.result",ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE:"aspnetcore.diagnostics.handler.type",ATTR_ASPNETCORE_RATE_LIMITING_POLICY:"aspnetcore.rate_limiting.policy",ATTR_ASPNETCORE_RATE_LIMITING_RESULT:"aspnetcore.rate_limiting.result",ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED:"aspnetcore.request.is_unhandled",ATTR_ASPNETCORE_ROUTING_IS_FALLBACK:"aspnetcore.routing.is_fallback",ATTR_ASPNETCORE_ROUTING_MATCH_STATUS:"aspnetcore.routing.match_status",ATTR_CLIENT_ADDRESS:"client.address",ATTR_CLIENT_PORT:"client.port",ATTR_CODE_COLUMN_NUMBER:"code.column.number",ATTR_CODE_FILE_PATH:"code.file.path",ATTR_CODE_FUNCTION_NAME:"code.function.name",ATTR_CODE_LINE_NUMBER:"code.line.number",ATTR_CODE_STACKTRACE:"code.stacktrace",ATTR_DB_COLLECTION_NAME:x_,ATTR_DB_NAMESPACE:D_,ATTR_DB_OPERATION_BATCH_SIZE:"db.operation.batch.size",ATTR_DB_OPERATION_NAME:k_,ATTR_DB_QUERY_SUMMARY:"db.query.summary",ATTR_DB_QUERY_TEXT:U_,ATTR_DB_RESPONSE_STATUS_CODE:$_,ATTR_DB_STORED_PROCEDURE_NAME:"db.stored_procedure.name",ATTR_DB_SYSTEM_NAME:G_,ATTR_DOTNET_GC_HEAP_GENERATION:"dotnet.gc.heap.generation",ATTR_ERROR_TYPE:j_,ATTR_EXCEPTION_ESCAPED:"exception.escaped",ATTR_EXCEPTION_MESSAGE:V_,ATTR_EXCEPTION_STACKTRACE:H_,ATTR_EXCEPTION_TYPE:B_,ATTR_HTTP_REQUEST_HEADER:e=>`http.request.header.${e}`,ATTR_HTTP_REQUEST_METHOD:F_,ATTR_HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",ATTR_HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",ATTR_HTTP_RESPONSE_HEADER:e=>`http.response.header.${e}`,ATTR_HTTP_RESPONSE_STATUS_CODE:Y_,ATTR_HTTP_ROUTE:q_,ATTR_JVM_GC_ACTION:"jvm.gc.action",ATTR_JVM_GC_NAME:"jvm.gc.name",ATTR_JVM_MEMORY_POOL_NAME:"jvm.memory.pool.name",ATTR_JVM_MEMORY_TYPE:"jvm.memory.type",ATTR_JVM_THREAD_DAEMON:"jvm.thread.daemon",ATTR_JVM_THREAD_STATE:"jvm.thread.state",ATTR_NETWORK_LOCAL_ADDRESS:"network.local.address",ATTR_NETWORK_LOCAL_PORT:"network.local.port",ATTR_NETWORK_PEER_ADDRESS:"network.peer.address",ATTR_NETWORK_PEER_PORT:"network.peer.port",ATTR_NETWORK_PROTOCOL_NAME:"network.protocol.name",ATTR_NETWORK_PROTOCOL_VERSION:"network.protocol.version",ATTR_NETWORK_TRANSPORT:"network.transport",ATTR_NETWORK_TYPE:"network.type",ATTR_OTEL_SCOPE_NAME:"otel.scope.name",ATTR_OTEL_SCOPE_VERSION:"otel.scope.version",ATTR_OTEL_STATUS_CODE:"otel.status_code",ATTR_OTEL_STATUS_DESCRIPTION:"otel.status_description",ATTR_SERVER_ADDRESS:K_,ATTR_SERVER_PORT:W_,ATTR_SERVICE_NAME:Z_,ATTR_SERVICE_VERSION:X_,ATTR_SIGNALR_CONNECTION_STATUS:"signalr.connection.status",ATTR_SIGNALR_TRANSPORT:"signalr.transport",ATTR_TELEMETRY_SDK_LANGUAGE:z_,ATTR_TELEMETRY_SDK_NAME:J_,ATTR_TELEMETRY_SDK_VERSION:em,ATTR_URL_FRAGMENT:"url.fragment",ATTR_URL_FULL:tm,ATTR_URL_PATH:"url.path",ATTR_URL_QUERY:"url.query",ATTR_URL_SCHEME:"url.scheme",ATTR_USER_AGENT_ORIGINAL:"user_agent.original",AWSECSLAUNCHTYPEVALUES_EC2:"ec2",AWSECSLAUNCHTYPEVALUES_FARGATE:Uf,AwsEcsLaunchtypeValues:$f,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS:Ef,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC:Sf,CLOUDPLATFORMVALUES_AWS_EC2:Tf,CLOUDPLATFORMVALUES_AWS_ECS:yf,CLOUDPLATFORMVALUES_AWS_EKS:Af,CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK:bf,CLOUDPLATFORMVALUES_AWS_LAMBDA:vf,CLOUDPLATFORMVALUES_AZURE_AKS:Nf,CLOUDPLATFORMVALUES_AZURE_APP_SERVICE:If,CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES:Of,CLOUDPLATFORMVALUES_AZURE_FUNCTIONS:Cf,CLOUDPLATFORMVALUES_AZURE_VM:Rf,CLOUDPLATFORMVALUES_GCP_APP_ENGINE:xf,CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS:Lf,CLOUDPLATFORMVALUES_GCP_CLOUD_RUN:Mf,CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE:Pf,CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE:wf,CLOUDPROVIDERVALUES_ALIBABA_CLOUD:zh,CLOUDPROVIDERVALUES_AWS:"aws",CLOUDPROVIDERVALUES_AZURE:Qh,CLOUDPROVIDERVALUES_GCP:"gcp",CloudPlatformValues:Df,CloudProviderValues:Jh,DBCASSANDRACONSISTENCYLEVELVALUES_ALL:"all",DBCASSANDRACONSISTENCYLEVELVALUES_ANY:"any",DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM:Bc,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE:Kc,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM:Yc,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL:Zc,DBCASSANDRACONSISTENCYLEVELVALUES_ONE:"one",DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM:Fc,DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL:Wc,DBCASSANDRACONSISTENCYLEVELVALUES_THREE:qc,DBCASSANDRACONSISTENCYLEVELVALUES_TWO:"two",DBSYSTEMVALUES_ADABAS:ic,DBSYSTEMVALUES_CACHE:oc,DBSYSTEMVALUES_CASSANDRA:Ac,DBSYSTEMVALUES_CLOUDSCAPE:Qa,DBSYSTEMVALUES_COCKROACHDB:xc,DBSYSTEMVALUES_COLDFUSION:yc,DBSYSTEMVALUES_COSMOSDB:Cc,DBSYSTEMVALUES_COUCHBASE:Oc,DBSYSTEMVALUES_COUCHDB:Nc,DBSYSTEMVALUES_DB2:"db2",DBSYSTEMVALUES_DERBY:cc,DBSYSTEMVALUES_DYNAMODB:Ic,DBSYSTEMVALUES_EDB:"edb",DBSYSTEMVALUES_ELASTICSEARCH:wc,DBSYSTEMVALUES_FILEMAKER:uc,DBSYSTEMVALUES_FIREBIRD:ac,DBSYSTEMVALUES_FIRSTSQL:sc,DBSYSTEMVALUES_GEODE:Mc,DBSYSTEMVALUES_H2:"h2",DBSYSTEMVALUES_HANADB:nc,DBSYSTEMVALUES_HBASE:vc,DBSYSTEMVALUES_HIVE:za,DBSYSTEMVALUES_HSQLDB:Ja,DBSYSTEMVALUES_INFORMIX:lc,DBSYSTEMVALUES_INGRES:rc,DBSYSTEMVALUES_INSTANTDB:pc,DBSYSTEMVALUES_INTERBASE:dc,DBSYSTEMVALUES_MARIADB:hc,DBSYSTEMVALUES_MAXDB:tc,DBSYSTEMVALUES_MEMCACHED:Lc,DBSYSTEMVALUES_MONGODB:bc,DBSYSTEMVALUES_MSSQL:qa,DBSYSTEMVALUES_MYSQL:Ka,DBSYSTEMVALUES_NEO4J:Pc,DBSYSTEMVALUES_NETEZZA:fc,DBSYSTEMVALUES_ORACLE:Wa,DBSYSTEMVALUES_OTHER_SQL:Ya,DBSYSTEMVALUES_PERVASIVE:_c,DBSYSTEMVALUES_POINTBASE:mc,DBSYSTEMVALUES_POSTGRESQL:Za,DBSYSTEMVALUES_PROGRESS:ec,DBSYSTEMVALUES_REDIS:Rc,DBSYSTEMVALUES_REDSHIFT:Xa,DBSYSTEMVALUES_SQLITE:gc,DBSYSTEMVALUES_SYBASE:Ec,DBSYSTEMVALUES_TERADATA:Sc,DBSYSTEMVALUES_VERTICA:Tc,DB_SYSTEM_NAME_VALUE_MARIADB:"mariadb",DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER:"microsoft.sql_server",DB_SYSTEM_NAME_VALUE_MYSQL:"mysql",DB_SYSTEM_NAME_VALUE_POSTGRESQL:"postgresql",DOTNET_GC_HEAP_GENERATION_VALUE_GEN0:"gen0",DOTNET_GC_HEAP_GENERATION_VALUE_GEN1:"gen1",DOTNET_GC_HEAP_GENERATION_VALUE_GEN2:"gen2",DOTNET_GC_HEAP_GENERATION_VALUE_LOH:"loh",DOTNET_GC_HEAP_GENERATION_VALUE_POH:"poh",DbCassandraConsistencyLevelValues:Xc,DbSystemValues:Dc,ERROR_TYPE_VALUE_OTHER:"_OTHER",FAASDOCUMENTOPERATIONVALUES_DELETE:hu,FAASDOCUMENTOPERATIONVALUES_EDIT:du,FAASDOCUMENTOPERATIONVALUES_INSERT:pu,FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD:gu,FAASINVOKEDPROVIDERVALUES_AWS:"aws",FAASINVOKEDPROVIDERVALUES_AZURE:Eu,FAASINVOKEDPROVIDERVALUES_GCP:"gcp",FAASTRIGGERVALUES_DATASOURCE:nu,FAASTRIGGERVALUES_HTTP:ru,FAASTRIGGERVALUES_OTHER:iu,FAASTRIGGERVALUES_PUBSUB:su,FAASTRIGGERVALUES_TIMER:ou,FaasDocumentOperationValues:fu,FaasInvokedProviderValues:Su,FaasTriggerValues:au,HOSTARCHVALUES_AMD64:Yf,HOSTARCHVALUES_ARM32:qf,HOSTARCHVALUES_ARM64:Kf,HOSTARCHVALUES_IA64:Wf,HOSTARCHVALUES_PPC32:Zf,HOSTARCHVALUES_PPC64:Xf,HOSTARCHVALUES_X86:"x86",HTTPFLAVORVALUES_HTTP_1_0:"1.0",HTTPFLAVORVALUES_HTTP_1_1:"1.1",HTTPFLAVORVALUES_HTTP_2_0:"2.0",HTTPFLAVORVALUES_QUIC:Pl,HTTPFLAVORVALUES_SPDY:Il,HTTP_REQUEST_METHOD_VALUE_CONNECT:"CONNECT",HTTP_REQUEST_METHOD_VALUE_DELETE:"DELETE",HTTP_REQUEST_METHOD_VALUE_GET:"GET",HTTP_REQUEST_METHOD_VALUE_HEAD:"HEAD",HTTP_REQUEST_METHOD_VALUE_OPTIONS:"OPTIONS",HTTP_REQUEST_METHOD_VALUE_OTHER:"_OTHER",HTTP_REQUEST_METHOD_VALUE_PATCH:"PATCH",HTTP_REQUEST_METHOD_VALUE_POST:"POST",HTTP_REQUEST_METHOD_VALUE_PUT:"PUT",HTTP_REQUEST_METHOD_VALUE_TRACE:"TRACE",HostArchValues:zf,HttpFlavorValues:Ml,JVM_MEMORY_TYPE_VALUE_HEAP:"heap",JVM_MEMORY_TYPE_VALUE_NON_HEAP:"non_heap",JVM_THREAD_STATE_VALUE_BLOCKED:"blocked",JVM_THREAD_STATE_VALUE_NEW:"new",JVM_THREAD_STATE_VALUE_RUNNABLE:"runnable",JVM_THREAD_STATE_VALUE_TERMINATED:"terminated",JVM_THREAD_STATE_VALUE_TIMED_WAITING:"timed_waiting",JVM_THREAD_STATE_VALUE_WAITING:"waiting",MESSAGETYPEVALUES_RECEIVED:ql,MESSAGETYPEVALUES_SENT:Yl,MESSAGINGDESTINATIONKINDVALUES_QUEUE:xl,MESSAGINGDESTINATIONKINDVALUES_TOPIC:Dl,MESSAGINGOPERATIONVALUES_PROCESS:jl,MESSAGINGOPERATIONVALUES_RECEIVE:Gl,METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS:"aspnetcore.diagnostics.exceptions",METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES:"aspnetcore.rate_limiting.active_request_leases",METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS:"aspnetcore.rate_limiting.queued_requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS:"aspnetcore.rate_limiting.requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION:"aspnetcore.rate_limiting.request_lease.duration",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE:"aspnetcore.rate_limiting.request.time_in_queue",METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS:"aspnetcore.routing.match_attempts",METRIC_DB_CLIENT_OPERATION_DURATION:"db.client.operation.duration",METRIC_DOTNET_ASSEMBLY_COUNT:"dotnet.assembly.count",METRIC_DOTNET_EXCEPTIONS:"dotnet.exceptions",METRIC_DOTNET_GC_COLLECTIONS:"dotnet.gc.collections",METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED:"dotnet.gc.heap.total_allocated",METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE:"dotnet.gc.last_collection.heap.fragmentation.size",METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE:"dotnet.gc.last_collection.heap.size",METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE:"dotnet.gc.last_collection.memory.committed_size",METRIC_DOTNET_GC_PAUSE_TIME:"dotnet.gc.pause.time",METRIC_DOTNET_JIT_COMPILATION_TIME:"dotnet.jit.compilation.time",METRIC_DOTNET_JIT_COMPILED_IL_SIZE:"dotnet.jit.compiled_il.size",METRIC_DOTNET_JIT_COMPILED_METHODS:"dotnet.jit.compiled_methods",METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS:"dotnet.monitor.lock_contentions",METRIC_DOTNET_PROCESS_CPU_COUNT:"dotnet.process.cpu.count",METRIC_DOTNET_PROCESS_CPU_TIME:"dotnet.process.cpu.time",METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET:"dotnet.process.memory.working_set",METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH:"dotnet.thread_pool.queue.length",METRIC_DOTNET_THREAD_POOL_THREAD_COUNT:"dotnet.thread_pool.thread.count",METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT:"dotnet.thread_pool.work_item.count",METRIC_DOTNET_TIMER_COUNT:"dotnet.timer.count",METRIC_HTTP_CLIENT_REQUEST_DURATION:"http.client.request.duration",METRIC_HTTP_SERVER_REQUEST_DURATION:"http.server.request.duration",METRIC_JVM_CLASS_COUNT:"jvm.class.count",METRIC_JVM_CLASS_LOADED:"jvm.class.loaded",METRIC_JVM_CLASS_UNLOADED:"jvm.class.unloaded",METRIC_JVM_CPU_COUNT:"jvm.cpu.count",METRIC_JVM_CPU_RECENT_UTILIZATION:"jvm.cpu.recent_utilization",METRIC_JVM_CPU_TIME:"jvm.cpu.time",METRIC_JVM_GC_DURATION:"jvm.gc.duration",METRIC_JVM_MEMORY_COMMITTED:"jvm.memory.committed",METRIC_JVM_MEMORY_LIMIT:"jvm.memory.limit",METRIC_JVM_MEMORY_USED:"jvm.memory.used",METRIC_JVM_MEMORY_USED_AFTER_LAST_GC:"jvm.memory.used_after_last_gc",METRIC_JVM_THREAD_COUNT:"jvm.thread.count",METRIC_KESTREL_ACTIVE_CONNECTIONS:"kestrel.active_connections",METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES:"kestrel.active_tls_handshakes",METRIC_KESTREL_CONNECTION_DURATION:"kestrel.connection.duration",METRIC_KESTREL_QUEUED_CONNECTIONS:"kestrel.queued_connections",METRIC_KESTREL_QUEUED_REQUESTS:"kestrel.queued_requests",METRIC_KESTREL_REJECTED_CONNECTIONS:"kestrel.rejected_connections",METRIC_KESTREL_TLS_HANDSHAKE_DURATION:"kestrel.tls_handshake.duration",METRIC_KESTREL_UPGRADED_CONNECTIONS:"kestrel.upgraded_connections",METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS:"signalr.server.active_connections",METRIC_SIGNALR_SERVER_CONNECTION_DURATION:"signalr.server.connection.duration",MessageTypeValues:Kl,MessagingDestinationKindValues:kl,MessagingOperationValues:Vl,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA:pl,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT:fl,NETHOSTCONNECTIONSUBTYPEVALUES_EDGE:ul,NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD:Tl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0:dl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A:hl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B:Sl,NETHOSTCONNECTIONSUBTYPEVALUES_GPRS:cl,NETHOSTCONNECTIONSUBTYPEVALUES_GSM:"gsm",NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA:_l,NETHOSTCONNECTIONSUBTYPEVALUES_HSPA:gl,NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP:yl,NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA:ml,NETHOSTCONNECTIONSUBTYPEVALUES_IDEN:El,NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN:vl,NETHOSTCONNECTIONSUBTYPEVALUES_LTE:"lte",NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA:Rl,NETHOSTCONNECTIONSUBTYPEVALUES_NR:"nr",NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA:bl,NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA:Al,NETHOSTCONNECTIONSUBTYPEVALUES_UMTS:ll,NETHOSTCONNECTIONTYPEVALUES_CELL:ju,NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE:Vu,NETHOSTCONNECTIONTYPEVALUES_UNKNOWN:Hu,NETHOSTCONNECTIONTYPEVALUES_WIFI:$u,NETHOSTCONNECTIONTYPEVALUES_WIRED:Gu,NETTRANSPORTVALUES_INPROC:Pu,NETTRANSPORTVALUES_IP:"ip",NETTRANSPORTVALUES_IP_TCP:Ou,NETTRANSPORTVALUES_IP_UDP:Nu,NETTRANSPORTVALUES_OTHER:Mu,NETTRANSPORTVALUES_PIPE:Iu,NETTRANSPORTVALUES_UNIX:Cu,NETWORK_TRANSPORT_VALUE_PIPE:"pipe",NETWORK_TRANSPORT_VALUE_QUIC:"quic",NETWORK_TRANSPORT_VALUE_TCP:"tcp",NETWORK_TRANSPORT_VALUE_UDP:"udp",NETWORK_TRANSPORT_VALUE_UNIX:"unix",NETWORK_TYPE_VALUE_IPV4:"ipv4",NETWORK_TYPE_VALUE_IPV6:"ipv6",NetHostConnectionSubtypeValues:Ol,NetHostConnectionTypeValues:Bu,NetTransportValues:wu,OSTYPEVALUES_AIX:"aix",OSTYPEVALUES_DARWIN:l_,OSTYPEVALUES_DRAGONFLYBSD:f_,OSTYPEVALUES_FREEBSD:p_,OSTYPEVALUES_HPUX:__,OSTYPEVALUES_LINUX:u_,OSTYPEVALUES_NETBSD:d_,OSTYPEVALUES_OPENBSD:h_,OSTYPEVALUES_SOLARIS:m_,OSTYPEVALUES_WINDOWS:c_,OSTYPEVALUES_Z_OS:g_,OTEL_STATUS_CODE_VALUE_ERROR:"ERROR",OTEL_STATUS_CODE_VALUE_OK:"OK",OsTypeValues:E_,RPCGRPCSTATUSCODEVALUES_ABORTED:10,RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS:6,RPCGRPCSTATUSCODEVALUES_CANCELLED:1,RPCGRPCSTATUSCODEVALUES_DATA_LOSS:15,RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED:4,RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION:9,RPCGRPCSTATUSCODEVALUES_INTERNAL:13,RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT:3,RPCGRPCSTATUSCODEVALUES_NOT_FOUND:5,RPCGRPCSTATUSCODEVALUES_OK:0,RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE:11,RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED:7,RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED:8,RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED:16,RPCGRPCSTATUSCODEVALUES_UNAVAILABLE:14,RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED:12,RPCGRPCSTATUSCODEVALUES_UNKNOWN:2,RpcGrpcStatusCodeValues:Hl,SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET:ui,SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:yi,SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ:ii,SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY:ni,SEMATTRS_AWS_DYNAMODB_COUNT:Si,SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE:fi,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:di,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:Ai,SEMATTRS_AWS_DYNAMODB_INDEX_NAME:li,SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS:ri,SEMATTRS_AWS_DYNAMODB_LIMIT:ci,SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:hi,SEMATTRS_AWS_DYNAMODB_PROJECTION:ai,SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:si,SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:oi,SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT:Ti,SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD:mi,SEMATTRS_AWS_DYNAMODB_SEGMENT:gi,SEMATTRS_AWS_DYNAMODB_SELECT:pi,SEMATTRS_AWS_DYNAMODB_TABLE_COUNT:_i,SEMATTRS_AWS_DYNAMODB_TABLE_NAMES:ti,SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS:Ei,SEMATTRS_AWS_LAMBDA_INVOKED_ARN:Ls,SEMATTRS_CODE_FILEPATH:$o,SEMATTRS_CODE_FUNCTION:ko,SEMATTRS_CODE_LINENO:Go,SEMATTRS_CODE_NAMESPACE:Uo,SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL:Fs,SEMATTRS_DB_CASSANDRA_COORDINATOR_DC:Zs,SEMATTRS_DB_CASSANDRA_COORDINATOR_ID:Ws,SEMATTRS_DB_CASSANDRA_IDEMPOTENCE:qs,SEMATTRS_DB_CASSANDRA_KEYSPACE:Hs,SEMATTRS_DB_CASSANDRA_PAGE_SIZE:Bs,SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:Ks,SEMATTRS_DB_CASSANDRA_TABLE:Ys,SEMATTRS_DB_CONNECTION_STRING:Ds,SEMATTRS_DB_HBASE_NAMESPACE:Xs,SEMATTRS_DB_JDBC_DRIVER_CLASSNAME:Us,SEMATTRS_DB_MONGODB_COLLECTION:Qs,SEMATTRS_DB_MSSQL_INSTANCE_NAME:Vs,SEMATTRS_DB_NAME:$s,SEMATTRS_DB_OPERATION:js,SEMATTRS_DB_REDIS_DATABASE_INDEX:zs,SEMATTRS_DB_SQL_TABLE:Js,SEMATTRS_DB_STATEMENT:Gs,SEMATTRS_DB_SYSTEM:xs,SEMATTRS_DB_USER:ks,SEMATTRS_ENDUSER_ID:Mo,SEMATTRS_ENDUSER_ROLE:wo,SEMATTRS_ENDUSER_SCOPE:Lo,SEMATTRS_EXCEPTION_ESCAPED:ro,SEMATTRS_EXCEPTION_MESSAGE:to,SEMATTRS_EXCEPTION_STACKTRACE:no,SEMATTRS_EXCEPTION_TYPE:eo,SEMATTRS_FAAS_COLDSTART:ho,SEMATTRS_FAAS_CRON:po,SEMATTRS_FAAS_DOCUMENT_COLLECTION:io,SEMATTRS_FAAS_DOCUMENT_NAME:uo,SEMATTRS_FAAS_DOCUMENT_OPERATION:ao,SEMATTRS_FAAS_DOCUMENT_TIME:co,SEMATTRS_FAAS_EXECUTION:oo,SEMATTRS_FAAS_INVOKED_NAME:fo,SEMATTRS_FAAS_INVOKED_PROVIDER:_o,SEMATTRS_FAAS_INVOKED_REGION:mo,SEMATTRS_FAAS_TIME:lo,SEMATTRS_FAAS_TRIGGER:so,SEMATTRS_HTTP_CLIENT_IP:ei,SEMATTRS_HTTP_FLAVOR:qo,SEMATTRS_HTTP_HOST:Bo,SEMATTRS_HTTP_METHOD:jo,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH:Wo,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:Zo,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH:Xo,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:zo,SEMATTRS_HTTP_ROUTE:Jo,SEMATTRS_HTTP_SCHEME:Fo,SEMATTRS_HTTP_SERVER_NAME:Qo,SEMATTRS_HTTP_STATUS_CODE:Yo,SEMATTRS_HTTP_TARGET:Ho,SEMATTRS_HTTP_URL:Vo,SEMATTRS_HTTP_USER_AGENT:Ko,SEMATTRS_MESSAGE_COMPRESSED_SIZE:Qi,SEMATTRS_MESSAGE_ID:zi,SEMATTRS_MESSAGE_TYPE:Xi,SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE:Ji,SEMATTRS_MESSAGING_CONSUMER_ID:Di,SEMATTRS_MESSAGING_CONVERSATION_ID:Mi,SEMATTRS_MESSAGING_DESTINATION:bi,SEMATTRS_MESSAGING_DESTINATION_KIND:Ri,SEMATTRS_MESSAGING_KAFKA_CLIENT_ID:Gi,SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP:$i,SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY:Ui,SEMATTRS_MESSAGING_KAFKA_PARTITION:ji,SEMATTRS_MESSAGING_KAFKA_TOMBSTONE:Vi,SEMATTRS_MESSAGING_MESSAGE_ID:Pi,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:Li,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:wi,SEMATTRS_MESSAGING_OPERATION:xi,SEMATTRS_MESSAGING_PROTOCOL:Ni,SEMATTRS_MESSAGING_PROTOCOL_VERSION:Ci,SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY:ki,SEMATTRS_MESSAGING_SYSTEM:vi,SEMATTRS_MESSAGING_TEMP_DESTINATION:Oi,SEMATTRS_MESSAGING_URL:Ii,SEMATTRS_NET_HOST_CARRIER_ICC:Io,SEMATTRS_NET_HOST_CARRIER_MCC:No,SEMATTRS_NET_HOST_CARRIER_MNC:Co,SEMATTRS_NET_HOST_CARRIER_NAME:Oo,SEMATTRS_NET_HOST_CONNECTION_SUBTYPE:Ro,SEMATTRS_NET_HOST_CONNECTION_TYPE:bo,SEMATTRS_NET_HOST_IP:yo,SEMATTRS_NET_HOST_NAME:vo,SEMATTRS_NET_HOST_PORT:Ao,SEMATTRS_NET_PEER_IP:Eo,SEMATTRS_NET_PEER_NAME:To,SEMATTRS_NET_PEER_PORT:So,SEMATTRS_NET_TRANSPORT:go,SEMATTRS_PEER_SERVICE:Po,SEMATTRS_RPC_GRPC_STATUS_CODE:Yi,SEMATTRS_RPC_JSONRPC_ERROR_CODE:Wi,SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE:Zi,SEMATTRS_RPC_JSONRPC_REQUEST_ID:Ki,SEMATTRS_RPC_JSONRPC_VERSION:qi,SEMATTRS_RPC_METHOD:Fi,SEMATTRS_RPC_SERVICE:Bi,SEMATTRS_RPC_SYSTEM:Hi,SEMATTRS_THREAD_ID:xo,SEMATTRS_THREAD_NAME:Do,SEMRESATTRS_AWS_ECS_CLUSTER_ARN:Nd,SEMRESATTRS_AWS_ECS_CONTAINER_ARN:Od,SEMRESATTRS_AWS_ECS_LAUNCHTYPE:Cd,SEMRESATTRS_AWS_ECS_TASK_ARN:Id,SEMRESATTRS_AWS_ECS_TASK_FAMILY:Pd,SEMRESATTRS_AWS_ECS_TASK_REVISION:Md,SEMRESATTRS_AWS_EKS_CLUSTER_ARN:wd,SEMRESATTRS_AWS_LOG_GROUP_ARNS:xd,SEMRESATTRS_AWS_LOG_GROUP_NAMES:Ld,SEMRESATTRS_AWS_LOG_STREAM_ARNS:kd,SEMRESATTRS_AWS_LOG_STREAM_NAMES:Dd,SEMRESATTRS_CLOUD_ACCOUNT_ID:Ad,SEMRESATTRS_CLOUD_AVAILABILITY_ZONE:bd,SEMRESATTRS_CLOUD_PLATFORM:Rd,SEMRESATTRS_CLOUD_PROVIDER:yd,SEMRESATTRS_CLOUD_REGION:vd,SEMRESATTRS_CONTAINER_ID:$d,SEMRESATTRS_CONTAINER_IMAGE_NAME:jd,SEMRESATTRS_CONTAINER_IMAGE_TAG:Vd,SEMRESATTRS_CONTAINER_NAME:Ud,SEMRESATTRS_CONTAINER_RUNTIME:Gd,SEMRESATTRS_DEPLOYMENT_ENVIRONMENT:Hd,SEMRESATTRS_DEVICE_ID:Bd,SEMRESATTRS_DEVICE_MODEL_IDENTIFIER:Fd,SEMRESATTRS_DEVICE_MODEL_NAME:Yd,SEMRESATTRS_FAAS_ID:Kd,SEMRESATTRS_FAAS_INSTANCE:Zd,SEMRESATTRS_FAAS_MAX_MEMORY:Xd,SEMRESATTRS_FAAS_NAME:qd,SEMRESATTRS_FAAS_VERSION:Wd,SEMRESATTRS_HOST_ARCH:eh,SEMRESATTRS_HOST_ID:zd,SEMRESATTRS_HOST_IMAGE_ID:nh,SEMRESATTRS_HOST_IMAGE_NAME:th,SEMRESATTRS_HOST_IMAGE_VERSION:rh,SEMRESATTRS_HOST_NAME:Qd,SEMRESATTRS_HOST_TYPE:Jd,SEMRESATTRS_K8S_CLUSTER_NAME:sh,SEMRESATTRS_K8S_CONTAINER_NAME:lh,SEMRESATTRS_K8S_CRONJOB_NAME:Ah,SEMRESATTRS_K8S_CRONJOB_UID:yh,SEMRESATTRS_K8S_DAEMONSET_NAME:Eh,SEMRESATTRS_K8S_DAEMONSET_UID:gh,SEMRESATTRS_K8S_DEPLOYMENT_NAME:fh,SEMRESATTRS_K8S_DEPLOYMENT_UID:hh,SEMRESATTRS_K8S_JOB_NAME:Th,SEMRESATTRS_K8S_JOB_UID:Sh,SEMRESATTRS_K8S_NAMESPACE_NAME:ah,SEMRESATTRS_K8S_NODE_NAME:oh,SEMRESATTRS_K8S_NODE_UID:ih,SEMRESATTRS_K8S_POD_NAME:uh,SEMRESATTRS_K8S_POD_UID:ch,SEMRESATTRS_K8S_REPLICASET_NAME:dh,SEMRESATTRS_K8S_REPLICASET_UID:ph,SEMRESATTRS_K8S_STATEFULSET_NAME:mh,SEMRESATTRS_K8S_STATEFULSET_UID:_h,SEMRESATTRS_OS_DESCRIPTION:bh,SEMRESATTRS_OS_NAME:Rh,SEMRESATTRS_OS_TYPE:vh,SEMRESATTRS_OS_VERSION:Oh,SEMRESATTRS_PROCESS_COMMAND:Ph,SEMRESATTRS_PROCESS_COMMAND_ARGS:wh,SEMRESATTRS_PROCESS_COMMAND_LINE:Mh,SEMRESATTRS_PROCESS_EXECUTABLE_NAME:Ch,SEMRESATTRS_PROCESS_EXECUTABLE_PATH:Ih,SEMRESATTRS_PROCESS_OWNER:Lh,SEMRESATTRS_PROCESS_PID:Nh,SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION:kh,SEMRESATTRS_PROCESS_RUNTIME_NAME:xh,SEMRESATTRS_PROCESS_RUNTIME_VERSION:Dh,SEMRESATTRS_SERVICE_INSTANCE_ID:Gh,SEMRESATTRS_SERVICE_NAME:Uh,SEMRESATTRS_SERVICE_NAMESPACE:$h,SEMRESATTRS_SERVICE_VERSION:jh,SEMRESATTRS_TELEMETRY_AUTO_VERSION:Fh,SEMRESATTRS_TELEMETRY_SDK_LANGUAGE:Hh,SEMRESATTRS_TELEMETRY_SDK_NAME:Vh,SEMRESATTRS_TELEMETRY_SDK_VERSION:Bh,SEMRESATTRS_WEBENGINE_DESCRIPTION:Kh,SEMRESATTRS_WEBENGINE_NAME:Yh,SEMRESATTRS_WEBENGINE_VERSION:qh,SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN:"app_shutdown",SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE:"normal_closure",SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT:"timeout",SIGNALR_TRANSPORT_VALUE_LONG_POLLING:"long_polling",SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS:"server_sent_events",SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS:"web_sockets",SemanticAttributes:ea,SemanticResourceAttributes:Wh,TELEMETRYSDKLANGUAGEVALUES_CPP:"cpp",TELEMETRYSDKLANGUAGEVALUES_DOTNET:O_,TELEMETRYSDKLANGUAGEVALUES_ERLANG:N_,TELEMETRYSDKLANGUAGEVALUES_GO:"go",TELEMETRYSDKLANGUAGEVALUES_JAVA:C_,TELEMETRYSDKLANGUAGEVALUES_NODEJS:I_,TELEMETRYSDKLANGUAGEVALUES_PHP:"php",TELEMETRYSDKLANGUAGEVALUES_PYTHON:P_,TELEMETRYSDKLANGUAGEVALUES_RUBY:M_,TELEMETRYSDKLANGUAGEVALUES_WEBJS:w_,TELEMETRY_SDK_LANGUAGE_VALUE_CPP:"cpp",TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET:"dotnet",TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG:"erlang",TELEMETRY_SDK_LANGUAGE_VALUE_GO:"go",TELEMETRY_SDK_LANGUAGE_VALUE_JAVA:"java",TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS:Q_,TELEMETRY_SDK_LANGUAGE_VALUE_PHP:"php",TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON:"python",TELEMETRY_SDK_LANGUAGE_VALUE_RUBY:"ruby",TELEMETRY_SDK_LANGUAGE_VALUE_RUST:"rust",TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT:"swift",TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS:"webjs",TelemetrySdkLanguageValues:L_});const rm="process.runtime.name",sm={[J_]:"opentelemetry",[rm]:"node",[z_]:Q_,[em]:"2.0.1"};const om=Math.pow(10,6),im=Math.pow(10,9);function am(e){const t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*om)]}function cm(){let e=pn.timeOrigin;if("number"!=typeof e){const t=pn;e=t.timing&&t.timing.fetchStart}return e}function um(e){return hm(am(cm()),am("number"==typeof e?e:pn.now()))}function lm(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=im),[n,r]}function pm(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function dm(e){return pm(e)||"number"==typeof e||e instanceof Date}function hm(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=im&&(n[1]-=im,n[0]+=1),n}var fm;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(fm||(fm={}));const _m="[_0-9a-z-*/]",mm=new RegExp(`^(?:${`[a-z]${_m}{0,255}`}|${`[a-z0-9]${_m}{0,240}@[a-z]${_m}{0,13}`})$`),gm=/^[ -~]{0,255}[!-~]$/,Em=/,|=/;class Sm{_internalState=new Map;constructor(e){e&&this._parse(e)}set(e,t){const n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n}unset(e){const t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((e,t)=>{const n=t.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),o=n.slice(r+1,t.length);(function(e){return mm.test(e)})(s)&&function(e){return gm.test(e)&&!Em.test(e)}(o)&&e.set(s,o)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new Sm;return e._internalState=new Map(this._internalState),e}}const Tm="traceparent",ym="tracestate",Am=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");function vm(e){const t=Am.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}const bm=ce("OpenTelemetry SDK Context Key RPC_METADATA");var Rm;function Om(e){return e.getValue(bm)}!function(e){e.HTTP="http"}(Rm||(Rm={}));const Nm="[object Null]",Cm="[object Undefined]",Im=Function.prototype.toString,Pm=Im.call(Object),Mm=Object.getPrototypeOf,wm=Object.prototype,Lm=wm.hasOwnProperty,xm=Symbol?Symbol.toStringTag:void 0,Dm=wm.toString;function km(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?Cm:Nm;return xm&&xm in Object(e)?function(e){const t=Lm.call(e,xm),n=e[xm];let r=!1;try{e[xm]=void 0,r=!0}catch(e){}const s=Dm.call(e);r&&(t?e[xm]=n:delete e[xm]);return s}(e):function(e){return Dm.call(e)}(e)}(e))return!1;const t=Mm(e);if(null===t)return!0;const n=Lm.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Im.call(n)===Pm}function Um(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=Gm(t,e.shift(),0,n);return t}function $m(e){return Vm(e)?e.slice():e}function Gm(e,t,n=0,r){let s;if(!(n>20)){if(n++,Fm(e)||Fm(t)||Hm(t))s=$m(t);else if(Vm(e)){if(s=e.slice(),Vm(t))for(let e=0,n=t.length;e<n;e++)s.push($m(t[e]));else if(Bm(t)){const e=Object.keys(t);for(let n=0,r=e.length;n<r;n++){const r=e[n];s[r]=$m(t[r])}}}else if(Bm(e))if(Bm(t)){if(!function(e,t){if(!km(e)||!km(t))return!1;return!0}(e,t))return t;s=Object.assign({},e);const o=Object.keys(t);for(let i=0,a=o.length;i<a;i++){const a=o[i],c=t[a];if(Fm(c))void 0===c?delete s[a]:s[a]=c;else{const o=s[a],i=c;if(jm(e,a,r)||jm(t,a,r))delete s[a];else{if(Bm(o)&&Bm(i)){const n=r.get(o)||[],s=r.get(i)||[];n.push({obj:e,key:a}),s.push({obj:t,key:a}),r.set(o,n),r.set(i,s)}s[a]=Gm(s[a],c,n,r)}}}}else s=t;return s}}function jm(e,t,n){const r=n.get(e[t])||[];for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.key===t&&s.obj===e)return!0}return!1}function Vm(e){return Array.isArray(e)}function Hm(e){return"function"==typeof e}function Bm(e){return!Fm(e)&&!Vm(e)&&!Hm(e)&&"object"==typeof e}function Fm(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}class Ym extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ym.prototype)}}function qm(e,t){return"string"==typeof t?e===t:!!e.match(t)}class Km{_promise;_resolve;_reject;constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const Wm={ALL:K.ALL,VERBOSE:K.VERBOSE,DEBUG:K.DEBUG,INFO:K.INFO,WARN:K.WARN,ERROR:K.ERROR,NONE:K.NONE};const Zm={_export:function(e,t){return new Promise(n=>{At.with(Wt(At.active()),()=>{e.export(t,e=>{n(e)})})})}};var Xm,zm=Object.freeze({__proto__:null,AnchoredClock:class{_monotonicClock;_epochMillis;_performanceMillis;constructor(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}now(){const e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}},BindOnceFuture:class{_callback;_that;_isCalled=!1;_deferred=new Km;constructor(e,t){this._callback=e,this._that=t}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(e=>this._deferred.resolve(e),e=>this._deferred.reject(e))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}},CompositePropagator:class{_propagators;_fields;constructor(e={}){this._propagators=e.propagators??[],this._fields=Array.from(new Set(this._propagators.map(e=>"function"==typeof e.fields?e.fields():[]).reduce((e,t)=>e.concat(t),[])))}inject(e,t,n){for(const r of this._propagators)try{r.inject(e,t,n)}catch(e){vt.warn(`Failed to inject with ${r.constructor.name}. Err: ${e.message}`)}}extract(e,t,n){return this._propagators.reduce((e,r)=>{try{return r.extract(e,t,n)}catch(e){vt.warn(`Failed to extract with ${r.constructor.name}. Err: ${e.message}`)}return e},e)}fields(){return this._fields.slice()}},get ExportResultCode(){return fm},get RPCType(){return Rm},SDK_INFO:sm,TRACE_PARENT_HEADER:Tm,TRACE_STATE_HEADER:ym,TimeoutError:Ym,TraceState:Sm,W3CBaggagePropagator:Jt,W3CTraceContextPropagator:class{inject(e,t,n){const r=jt.getSpanContext(e);if(!r||Zt(e)||!it(r))return;const s=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||xe.NONE).toString(16)}`;n.set(t,Tm,s),r.traceState&&n.set(t,ym,r.traceState.serialize())}extract(e,t,n){const r=n.get(t,Tm);if(!r)return e;const s=Array.isArray(r)?r[0]:r;if("string"!=typeof s)return e;const o=vm(s);if(!o)return e;o.isRemote=!0;const i=n.get(t,ym);if(i){const e=Array.isArray(i)?i.join(","):i;o.traceState=new Sm("string"==typeof e?e:void 0)}return jt.setSpanContext(e,o)}fields(){return[Tm,ym]}},_globalThis:ln,addHrTimes:hm,callWithTimeout:function(e,t){let n;const r=new Promise(function(e,r){n=setTimeout(function(){r(new Ym("Operation timed out."))},t)});return Promise.race([e,r]).then(e=>(clearTimeout(n),e),e=>{throw clearTimeout(n),e})},deleteRPCMetadata:function(e){return e.deleteValue(bm)},diagLogLevelFromString:function(e){if(null==e)return;const t=Wm[e.toUpperCase()];return null==t?(vt.warn(`Unknown log level "${e}", expected one of ${Object.keys(Wm)}, using default`),K.INFO):t},getBooleanFromEnv:function(e){const t=process.env[e]?.trim().toLowerCase();return null!=t&&""!==t&&("true"===t||("false"===t||vt.warn(`Unknown value ${s.inspect(t)} for ${e}, expected 'true' or 'false', falling back to 'false' (default)`),!1))},getNumberFromEnv:cn,getRPCMetadata:Om,getStringFromEnv:un,getStringListFromEnv:function(e){return un(e)?.split(",").map(e=>e.trim()).filter(e=>""!==e)},getTimeOrigin:cm,globalErrorHandler:an,hrTime:um,hrTimeDuration:lm,hrTimeToMicroseconds:function(e){return 1e6*e[0]+e[1]/1e3},hrTimeToMilliseconds:function(e){return 1e3*e[0]+e[1]/1e6},hrTimeToNanoseconds:function(e){return e[0]*im+e[1]},hrTimeToTimeStamp:function(e){const t=`${"0".repeat(9)}${e[1]}Z`,n=t.substring(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",n)},internal:Zm,isAttributeValue:nn,isTimeInput:dm,isTimeInputHrTime:pm,isTracingSuppressed:Zt,isUrlIgnored:function(e,t){if(!t)return!1;for(const n of t)if(qm(e,n))return!0;return!1},loggingErrorHandler:sn,merge:Um,millisToHrTime:am,otperformance:pn,parseKeyPairsIntoRecord:function(e){const t={};return"string"==typeof e&&e.length>0&&e.split(Xt).forEach(e=>{const n=Qt(e);void 0!==n&&n.value.length>0&&(t[n.key]=n.value)}),t},parseTraceParent:vm,sanitizeAttributes:en,setGlobalErrorHandler:function(e){on=e},setRPCMetadata:function(e,t){return e.setValue(bm,t)},suppressTracing:Wt,timeInputToHrTime:function(e){if(pm(e))return e;if("number"==typeof e)return e<cm()?um(e):am(e);if(e instanceof Date)return am(e.getTime());throw TypeError("Invalid input type")},unrefTimer:function(e){e.unref()},unsuppressTracing:function(e){return e.deleteValue(Kt)},urlMatches:qm}),Qm=Bt(zm),Jm={};Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.VERSION=void 0,Jm.VERSION="0.203.0",function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRACE=1]="TRACE",e[e.TRACE2=2]="TRACE2",e[e.TRACE3=3]="TRACE3",e[e.TRACE4=4]="TRACE4",e[e.DEBUG=5]="DEBUG",e[e.DEBUG2=6]="DEBUG2",e[e.DEBUG3=7]="DEBUG3",e[e.DEBUG4=8]="DEBUG4",e[e.INFO=9]="INFO",e[e.INFO2=10]="INFO2",e[e.INFO3=11]="INFO3",e[e.INFO4=12]="INFO4",e[e.WARN=13]="WARN",e[e.WARN2=14]="WARN2",e[e.WARN3=15]="WARN3",e[e.WARN4=16]="WARN4",e[e.ERROR=17]="ERROR",e[e.ERROR2=18]="ERROR2",e[e.ERROR3=19]="ERROR3",e[e.ERROR4=20]="ERROR4",e[e.FATAL=21]="FATAL",e[e.FATAL2=22]="FATAL2",e[e.FATAL3=23]="FATAL3",e[e.FATAL4=24]="FATAL4"}(Xm||(Xm={}));let eg=class{emit(e){}};const tg=new eg;const ng=new class{getLogger(e,t,n){return new eg}};let rg=class{constructor(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}emit(e){this._getLogger().emit(e)}_getLogger(){if(this._delegate)return this._delegate;const e=this._provider.getDelegateLogger(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):tg}},sg=class{getLogger(e,t,n){var r;return null!==(r=this.getDelegateLogger(e,t,n))&&void 0!==r?r:new rg(this,e,t,n)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:ng}setDelegate(e){this._delegate=e}getDelegateLogger(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(e,t,n)}};const og="object"==typeof globalThis?globalThis:global,ig=Symbol.for("io.opentelemetry.js.api.logs"),ag=og;const cg=class e{constructor(){this._proxyLoggerProvider=new sg}static getInstance(){return this._instance||(this._instance=new e),this._instance}setGlobalLoggerProvider(e){return ag[ig]?this.getLoggerProvider():(ag[ig]=(t=1,n=e,r=ng,e=>e===t?n:r),this._proxyLoggerProvider.setDelegate(e),e);var t,n,r}getLoggerProvider(){var e,t;return null!==(t=null===(e=ag[ig])||void 0===e?void 0:e.call(ag,1))&&void 0!==t?t:this._proxyLoggerProvider}getLogger(e,t,n){return this.getLoggerProvider().getLogger(e,t,n)}disable(){delete ag[ig],this._proxyLoggerProvider=new sg}}.getInstance();function ug(e){const t=e.tracerProvider||jt.getTracerProvider(),n=e.meterProvider||Nt.getMeterProvider(),r=e.loggerProvider||cg.getLoggerProvider(),s=e.instrumentations?.flat()??[];return function(e,t,n,r){for(let s=0,o=e.length;s<o;s++){const o=e[s];t&&o.setTracerProvider(t),n&&o.setMeterProvider(n),r&&o.setLoggerProvider&&o.setLoggerProvider(r),o.getConfig().enabled||o.enable()}}(s,t,n,r),()=>{!function(e){e.forEach(e=>e.disable())}(s)}}const lg=/^(?:v)?(?<version>(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*))(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,pg=/^(?<op><|>|=|==|<=|>=|~|\^|~>)?\s*(?:v)?(?<version>(?<major>x|X|\*|0|[1-9]\d*)(?:\.(?<minor>x|X|\*|0|[1-9]\d*))?(?:\.(?<patch>x|X|\*|0|[1-9]\d*))?)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,dg={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]};function hg(e,t,n){if(!function(e){return"string"==typeof e&&lg.test(e)}(e))return vt.error(`Invalid version: ${e}`),!1;if(!t)return!0;t=t.replace(/([<>=~^]+)\s+/g,"$1");const r=function(e){const t=e.match(lg);if(!t)return void vt.error(`Invalid version: ${e}`);const n=t.groups.version,r=t.groups.prerelease,s=t.groups.build,o=n.split("."),i=r?.split(".");return{op:void 0,version:n,versionSegments:o,versionSegmentCount:o.length,prerelease:r,prereleaseSegments:i,prereleaseSegmentCount:i?i.length:0,build:s}}(e);if(!r)return!1;const s=[],o=fg(r,t,s,n);return o&&!n?.includePrerelease?function(e,t){if(e.prerelease)return t.some(t=>t.prerelease&&t.version===e.version);return!0}(r,s):o}function fg(e,t,n,r){if(t.includes("||")){const s=t.trim().split("||");for(const t of s)if(_g(e,t,n,r))return!0;return!1}if(t.includes(" - "))t=function(e,t){const n=Cg;return e.replace(n,(e,n,r,s,o,i,a,c,u,l,p,d)=>`${n=mg(r)?"":mg(s)?`>=${r}.0.0${t?.includePrerelease?"-0":""}`:mg(o)?`>=${r}.${s}.0${t?.includePrerelease?"-0":""}`:i?`>=${n}`:`>=${n}${t?.includePrerelease?"-0":""}`} ${c=mg(u)?"":mg(l)?`<${+u+1}.0.0-0`:mg(p)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${p}-${d}`:t?.includePrerelease?`<${u}.${l}.${+p+1}-0`:`<=${c}`}`.trim())}(t,r);else if(t.includes(" ")){const s=t.trim().replace(/\s{2,}/g," ").split(" ");for(const t of s)if(!_g(e,t,n,r))return!1;return!0}return _g(e,t,n,r)}function _g(e,t,n,r){if(t=function(e,t){return e=e.trim(),e=function(e,t){const n=Pg,r=t?.includePrerelease?"-0":"";return e.replace(n,(e,t,n,s,o)=>{let i;return i=mg(t)?"":mg(n)?`>=${t}.0.0${r} <${+t+1}.0.0-0`:mg(s)?"0"===t?`>=${t}.${n}.0${r} <${t}.${+n+1}.0-0`:`>=${t}.${n}.0${r} <${+t+1}.0.0-0`:o?"0"===t?"0"===n?`>=${t}.${n}.${s}-${o} <${t}.${n}.${+s+1}-0`:`>=${t}.${n}.${s}-${o} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${s}-${o} <${+t+1}.0.0-0`:"0"===t?"0"===n?`>=${t}.${n}.${s}${r} <${t}.${n}.${+s+1}-0`:`>=${t}.${n}.${s}${r} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${s} <${+t+1}.0.0-0`,i})}(e,t),e=function(e){const t=Ig;return e.replace(t,(e,t,n,r,s)=>{let o;return o=mg(t)?"":mg(n)?`>=${t}.0.0 <${+t+1}.0.0-0`:mg(r)?`>=${t}.${n}.0 <${t}.${+n+1}.0-0`:s?`>=${t}.${n}.${r}-${s} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${r} <${t}.${+n+1}.0-0`,o})}(e),e=function(e,t){const n=Ng;return e.replace(n,(e,n,r,s,o,i)=>{const a=mg(r),c=a||mg(s),u=c||mg(o),l=u;return"="===n&&l&&(n=""),i=t?.includePrerelease?"-0":"",a?e=">"===n||"<"===n?"<0.0.0-0":"*":n&&l?(c&&(s=0),o=0,">"===n?(n=">=",c?(r=+r+1,s=0,o=0):(s=+s+1,o=0)):"<="===n&&(n="<",c?r=+r+1:s=+s+1),"<"===n&&(i="-0"),e=`${n+r}.${s}.${o}${i}`):c?e=`>=${r}.0.0${i} <${+r+1}.0.0-0`:u&&(e=`>=${r}.${s}.0${i} <${r}.${+s+1}.0-0`),e})}(e,t),e=e.trim(),e}(t,r),t.includes(" "))return fg(e,t,n,r);{const r=function(e){if(!e)return{};const t=e.match(pg);if(!t)return vt.error(`Invalid range: ${e}`),{invalid:!0};let n=t.groups.op;const r=t.groups.version,s=t.groups.prerelease,o=t.groups.build,i=r.split("."),a=s?.split(".");"=="===n&&(n="=");return{op:n||"=",version:r,versionSegments:i,versionSegmentCount:i.length,prerelease:s,prereleaseSegments:a,prereleaseSegmentCount:a?a.length:0,build:o}}(t);return n.push(r),function(e,t){if(t.invalid)return!1;if(!t.version||gg(t.version))return!0;let n=Tg(e.versionSegments||[],t.versionSegments||[]);if(0===n){const r=e.prereleaseSegments||[],s=t.prereleaseSegments||[];n=r.length||s.length?!r.length&&s.length?1:r.length&&!s.length?-1:Tg(r,s):0}return dg[t.op]?.includes(n)}(e,r)}}function mg(e){return!e||"x"===e.toLowerCase()||"*"===e}function gg(e){return"*"===e||"x"===e||"X"===e}function Eg(e){const t=parseInt(e,10);return isNaN(t)?e:t}function Sg(e,t){if(gg(e)||gg(t))return 0;const[n,r]=function(e,t){if(typeof e==typeof t){if("number"==typeof e)return[e,t];if("string"==typeof e)return[e,t];throw new Error("Version segments can only be strings or numbers")}return[String(e),String(t)]}(Eg(e),Eg(t));return n>r?1:n<r?-1:0}function Tg(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const r=Sg(e[n]||"0",t[n]||"0");if(0!==r)return r}return 0}const yg="[a-zA-Z0-9-]",Ag="0|[1-9]\\d*",vg=`(?:${Ag}|${`\\d*[a-zA-Z-]${yg}*`})`,bg=`${yg}+`,Rg=`${Ag}|x|X|\\*`,Og=`[v=\\s]*(${Rg})(?:\\.(${Rg})(?:\\.(${Rg})(?:${`(?:-(${vg}(?:\\.${vg})*))`})?${`(?:\\+(${bg}(?:\\.${bg})*))`}?)?)?`,Ng=new RegExp(`^((?:<|>)?=?)\\s*${Og}$`),Cg=new RegExp(`^\\s*(${Og})\\s+-\\s+(${Og})\\s*$`),Ig=new RegExp(`^(?:~>?)${Og}$`),Pg=new RegExp(`^(?:\\^)${Og}$`);let Mg=console.error.bind(console);function wg(e,t,n){const r=!!e[t]&&Object.prototype.propertyIsEnumerable.call(e,t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}const Lg=(e,t,n)=>{if(!e||!e[t])return void Mg("no original function "+String(t)+" to wrap");if(!n)return Mg("no wrapper function"),void Mg((new Error).stack);const r=e[t];if("function"!=typeof r||"function"!=typeof n)return void Mg("original object and wrapper must be functions");const s=n(r,t);return wg(s,"__original",r),wg(s,"__unwrap",()=>{e[t]===s&&wg(e,t,r)}),wg(s,"__wrapped",!0),wg(e,t,s),s},xg=(e,t,n)=>{if(!e)return Mg("must provide one or more modules to patch"),void Mg((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{Lg(e,t,n)})}):Mg("must provide one or more functions to wrap on modules")},Dg=(e,t)=>{if(!e||!e[t])return Mg("no function to unwrap."),void Mg((new Error).stack);const n=e[t];n.__unwrap?n.__unwrap():Mg("no original to unwrap to -- has "+String(t)+" already been unwrapped?")},kg=(e,t)=>{if(!e)return Mg("must provide one or more modules to patch"),void Mg((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{Dg(e,t)})}):Mg("must provide one or more functions to unwrap on modules")};let Ug=class{instrumentationName;instrumentationVersion;_config={};_tracer;_meter;_logger;_diag;constructor(e,t,n){this.instrumentationName=e,this.instrumentationVersion=t,this.setConfig(n),this._diag=vt.createComponentLogger({namespace:e}),this._tracer=jt.getTracer(e,t),this._meter=Nt.getMeter(e,t),this._logger=cg.getLogger(e,t),this._updateMetricInstruments()}_wrap=Lg;_unwrap=Dg;_massWrap=xg;_massUnwrap=kg;get meter(){return this._meter}setMeterProvider(e){this._meter=e.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(e){this._logger=e.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){const e=this.init()??[];return Array.isArray(e)?e:[e]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(e){this._config={enabled:!0,...e}}setTracerProvider(e){this._tracer=e.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(e,t,n,r){if(e)try{e(n,r)}catch(e){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:t},e)}}};var $g,Gg,jg,Vg,Hg,Bg={exports:{}},Fg={exports:{}},Yg={exports:{}};function qg(){if(Gg)return $g;Gg=1;var e=1e3,t=60*e,n=60*t,r=24*n,s=7*r,o=365.25*r;function i(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}return $g=function(a,c){c=c||{};var u=typeof a;if("string"===u&&a.length>0)return function(i){if((i=String(i)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(a);if("number"===u&&isFinite(a))return c.long?function(s){var o=Math.abs(s);if(o>=r)return i(s,o,r,"day");if(o>=n)return i(s,o,n,"hour");if(o>=t)return i(s,o,t,"minute");if(o>=e)return i(s,o,e,"second");return s+" ms"}(a):function(s){var o=Math.abs(s);if(o>=r)return Math.round(s/r)+"d";if(o>=n)return Math.round(s/n)+"h";if(o>=t)return Math.round(s/t)+"m";if(o>=e)return Math.round(s/e)+"s";return s+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},$g}function Kg(){if(Vg)return jg;return Vg=1,jg=function(e){function t(e){let r,s,o,i=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),o=s-(r||s);n.diff=o,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return"%";i++;const o=t.formatters[s];if("function"==typeof o){const t=e[i];r=o.call(n,t),e.splice(i,1),i--}return r}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(s!==t.namespaces&&(s=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e,t){let n=0,r=0,s=-1,o=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(s=r,o=n,r++):(n++,r++);else{if(-1===s)return!1;r=s+1,o++,n=o}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=qg(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},jg}var Wg,Zg={exports:{}};"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?Fg.exports=(Hg||(Hg=1,function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Kg()(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Yg,Yg.exports)),Yg.exports):Fg.exports=(Wg||(Wg=1,function(e,t){const n=c,r=s;t.init=function(e){e.inspectOpts={};const n=Object.keys(t.inspectOpts);for(let r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(n){const{namespace:r,useColors:s}=this;if(s){const t=this.color,s="[3"+(t<8?t:"8;5;"+t),o=`  ${s};1m${r} [0m`;n[0]=o+n[0].split("\n").join("\n"+o),n.push(s+"m+"+e.exports.humanize(this.diff)+"[0m")}else n[0]=(t.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+r+" "+n[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=require("supports-color");e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{}),e.exports=Kg()(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}}(Zg,Zg.exports)),Zg.exports);var Xg,zg,Qg,Jg,eE=Fg.exports,tE=t.sep,nE=function(e){var t=e.split(tE),n=t.lastIndexOf("node_modules");if(-1!==n&&t[n+1]){for(var r="@"===t[n+1][0],s=r?t[n+1]+"/"+t[n+2]:t[n+1],o=r?3:2,i="",a=n+o-1,c=0;c<=a;c++)i+=c===a?t[c]:t[c]+tE;for(var u="",l=t.length-1,p=n+o;p<=l;p++)u+=p===l?t[p]:t[p]+tE;return{name:s,basedir:i,path:u}}};function rE(){return zg?Xg:(zg=1,Xg=n.homedir||function(){var e=process.env.HOME,t=process.env.LOGNAME||process.env.USER||process.env.LNAME||process.env.USERNAME;return"win32"===process.platform?process.env.USERPROFILE||process.env.HOMEDRIVE+process.env.HOMEPATH||e||null:"darwin"===process.platform?e||(t?"/Users/"+t:null):"linux"===process.platform?e||(0===process.getuid()?"/root":t?"/home/"+t:null):e||null})}function sE(){return Jg?Qg:(Jg=1,Qg=function(){var e=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t};var t=(new Error).stack;return Error.prepareStackTrace=e,t[2].getFileName()})}var oE,iE,aE,cE,uE,lE,pE,dE,hE,fE,_E,mE={exports:{}};function gE(){if(oE)return mE.exports;oE=1;var e="win32"===process.platform,t=/^(((?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?[\\\/]?)(?:[^\\\/]*[\\\/])*)((\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))[\\\/]*$/,n={};n.parse=function(e){if("string"!=typeof e)throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var n,r=(n=e,t.exec(n).slice(1));if(!r||5!==r.length)throw new TypeError("Invalid path '"+e+"'");return{root:r[1],dir:r[0]===r[1]?r[0]:r[0].slice(0,-1),base:r[2],ext:r[4],name:r[3]}};var r=/^((\/?)(?:[^\/]*\/)*)((\.{1,2}|[^\/]+?|)(\.[^.\/]*|))[\/]*$/,s={};return s.parse=function(e){if("string"!=typeof e)throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t,n=(t=e,r.exec(t).slice(1));if(!n||5!==n.length)throw new TypeError("Invalid path '"+e+"'");return{root:n[1],dir:n[0].slice(0,-1),base:n[2],ext:n[4],name:n[3]}},mE.exports=e?n.parse:s.parse,mE.exports.posix=s.parse,mE.exports.win32=n.parse,mE.exports}function EE(){if(aE)return iE;aE=1;var e=t,n=e.parse||gE(),r=function(t,r){var s="/";/^([A-Za-z]:)/.test(t)?s="":/^\\\\/.test(t)&&(s="\\\\");for(var o=[t],i=n(t);i.dir!==o[o.length-1];)o.push(i.dir),i=n(i.dir);return o.reduce(function(t,n){return t.concat(r.map(function(t){return e.resolve(s,n,t)}))},[])};return iE=function(e,t,n){var s=t&&t.moduleDirectory?[].concat(t.moduleDirectory):["node_modules"];if(t&&"function"==typeof t.paths)return t.paths(n,e,function(){return r(e,s)},t);var o=r(e,s);return t&&t.paths?o.concat(t.paths):o}}function SE(){return uE?cE:(uE=1,cE=function(e,t){return t||{}})}function TE(){if(pE)return lE;pE=1;var e=Object.prototype.toString,t=Math.max,n=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var s=0;s<t.length;s+=1)n[s+e.length]=t[s];return n};return lE=function(r){var s=this;if("function"!=typeof s||"[object Function]"!==e.apply(s))throw new TypeError("Function.prototype.bind called on incompatible "+s);for(var o,i=function(e,t){for(var n=[],r=t||0,s=0;r<e.length;r+=1,s+=1)n[s]=e[r];return n}(arguments,1),a=t(0,s.length-i.length),c=[],u=0;u<a;u++)c[u]="$"+u;if(o=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(c,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var e=s.apply(this,n(i,arguments));return Object(e)===e?e:this}return s.apply(r,n(i,arguments))}),s.prototype){var l=function(){};l.prototype=s.prototype,o.prototype=new l,l.prototype=null}return o},lE}function yE(){if(_E)return fE;_E=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,n=function(){if(hE)return dE;hE=1;var e=TE();return dE=Function.prototype.bind||e}();return fE=n.call(e,t)}var AE,vE,bE,RE,OE={assert:!0,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:">= 8","node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:">= 0.5 && < 0.9.7",buffer:!0,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:!0,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:">= 0.5","node:cluster":[">= 14.18 && < 15",">= 16"],console:!0,"node:console":[">= 14.18 && < 15",">= 16"],constants:!0,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:!0,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:">= 1 && < 8",_debugger:"< 8",dgram:!0,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:[">= 14.17 && < 15",">= 15.1"],"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:!0,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:">= 0.7.12","node:domain":[">= 14.18 && < 15",">= 16"],events:!0,"node:events":[">= 14.18 && < 15",">= 16"],freelist:"< 6",fs:!0,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:">= 0.11.1","node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:">= 0.11.1","node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:">= 0.11.1","node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:">= 0.11.1","node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:">= 0.11.1","node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:">= 0.11.1","node:_http_server":[">= 14.18 && < 15",">= 16"],http:!0,"node:http":[">= 14.18 && < 15",">= 16"],http2:">= 8.8","node:http2":[">= 14.18 && < 15",">= 16"],https:!0,"node:https":[">= 14.18 && < 15",">= 16"],inspector:">= 8","node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:"< 8",module:!0,"node:module":[">= 14.18 && < 15",">= 16"],net:!0,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:!0,"node:os":[">= 14.18 && < 15",">= 16"],path:!0,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:">= 8.5","node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:">= 1","node:process":[">= 14.18 && < 15",">= 16"],punycode:">= 0.5","node:punycode":[">= 14.18 && < 15",">= 16"],querystring:!0,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:!0,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:!0,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:">= 0.11.5 && < 3","node:sqlite":[">= 22.13 && < 23",">= 23.4"],_stream_duplex:">= 0.9.4","node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:">= 0.9.4","node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:">= 1.4.1","node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:">= 0.9.4","node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:">= 0.9.4","node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:">= 0.9.4","node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:!0,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:!0,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:[">= 0.4 && < 0.7",">= 0.8"],"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:!0,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:">= 0.11.13","node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:">= 0.11.3 && < 10",_tls_wrap:">= 0.11.3","node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:!0,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:">= 10","node:trace_events":[">= 14.18 && < 15",">= 16"],tty:!0,"node:tty":[">= 14.18 && < 15",">= 16"],url:!0,"node:url":[">= 14.18 && < 15",">= 16"],util:!0,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:">= 1","node:v8":[">= 14.18 && < 15",">= 16"],vm:!0,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:">= 11.7","node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:">= 0.5","node:zlib":[">= 14.18 && < 15",">= 16"]};function NE(){if(vE)return AE;vE=1;var e=yE();function t(e,t){for(var n=e.split("."),r=t.split(" "),s=r.length>1?r[0]:"=",o=(r.length>1?r[1]:r[0]).split("."),i=0;i<3;++i){var a=parseInt(n[i]||0,10),c=parseInt(o[i]||0,10);if(a!==c)return"<"===s?a<c:">="===s&&a>=c}return">="===s}function n(e,n){var r=n.split(/ ?&& ?/);if(0===r.length)return!1;for(var s=0;s<r.length;++s)if(!t(e,r[s]))return!1;return!0}var r=OE;return AE=function(t,s){return e(r,t)&&function(e,t){if("boolean"==typeof t)return t;var r=void 0===e?process.versions&&process.versions.node:e;if("string"!=typeof r)throw new TypeError(void 0===e?"Unable to determine current node version":"If provided, a valid node version is required");if(t&&"object"==typeof t){for(var s=0;s<t.length;++s)if(n(r,t[s]))return!0;return!1}return n(r,t)}(s,r[t])}}function CE(){if(RE)return bE;RE=1;var n=e,r=rE(),s=t,o=sE(),i=EE(),a=SE(),c=NE(),u="win32"!==process.platform&&n.realpath&&"function"==typeof n.realpath.native?n.realpath.native:n.realpath,l=r(),p=function(e,t){n.stat(e,function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?t(null,!1):t(e):t(null,n.isFile()||n.isFIFO())})},d=function(e,t){n.stat(e,function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?t(null,!1):t(e):t(null,n.isDirectory())})},h=function(e,t){u(e,function(n,r){n&&"ENOENT"!==n.code?t(n):t(null,n?e:r)})},f=function(e,t,n,r){n&&!1===n.preserveSymlinks?e(t,r):r(null,t)},_=function(e,t,n){e(t,function(e,t){if(e)n(e);else try{var r=JSON.parse(t);n(null,r)}catch(e){n(null)}})};return bE=function(e,t,r){var u=r,m=t;if("function"==typeof t&&(u=m,m={}),"string"!=typeof e){var g=new TypeError("Path must be a string.");return process.nextTick(function(){u(g)})}var E=(m=a(e,m)).isFile||p,S=m.isDirectory||d,T=m.readFile||n.readFile,y=m.realpath||h,A=m.readPackage||_;if(m.readFile&&m.readPackage){var v=new TypeError("`readFile` and `readPackage` are mutually exclusive.");return process.nextTick(function(){u(v)})}var b=m.packageIterator,R=m.extensions||[".js"],O=!1!==m.includeCoreModules,N=m.basedir||s.dirname(o()),C=m.filename||N;m.paths=m.paths||[s.join(l,".node_modules"),s.join(l,".node_libraries")];var I,P=s.resolve(N);function M(t,n,r){t?u(t):n?u(null,n,r):x(I,function(t,n,r){if(t)u(t);else if(n)f(y,n,m,function(e,t){e?u(e):u(null,t,r)});else{var s=new Error("Cannot find module '"+e+"' from '"+C+"'");s.code="MODULE_NOT_FOUND",u(s)}})}function w(e,t,n){var r=t,o=n;"function"==typeof r&&(o=r,r=void 0),function e(t,n,r){if(0===t.length)return o(null,void 0,r);var i=n+t[0],a=r;a?c(null,a):L(s.dirname(i),c);function c(r,c,l){if(a=c,r)return o(r);if(l&&a&&m.pathFilter){var p=s.relative(l,i),d=p.slice(0,p.length-t[0].length),h=m.pathFilter(a,n,d);if(h)return e([""].concat(R.slice()),s.resolve(l,h),a)}E(i,u)}function u(r,s){return r?o(r):s?o(null,i,a):void e(t.slice(1),n,a)}}([""].concat(R),e,r)}function L(e,t){return""===e||"/"===e||"win32"===process.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e)?t(null):void f(y,e,m,function(n,r){if(n)return L(s.dirname(e),t);var o=s.join(r,"package.json");E(o,function(n,r){if(!r)return L(s.dirname(e),t);A(T,o,function(n,r){n&&t(n);var s=r;s&&m.packageFilter&&(s=m.packageFilter(s,o)),t(null,s,e)})})})}function x(e,t,n){var r=n,o=t;"function"==typeof o&&(r=o,o=m.package),f(y,e,m,function(t,n){if(t)return r(t);var i=s.join(n,"package.json");E(i,function(t,n){return t?r(t):n?void A(T,i,function(t,n){if(t)return r(t);var o=n;if(o&&m.packageFilter&&(o=m.packageFilter(o,i)),o&&o.main){if("string"!=typeof o.main){var a=new TypeError("package “"+o.name+"” `main` must be a string");return a.code="INVALID_PACKAGE_MAIN",r(a)}return"."!==o.main&&"./"!==o.main||(o.main="index"),void w(s.resolve(e,o.main),o,function(t,n,o){return t?r(t):n?r(null,n,o):o?void x(s.resolve(e,o.main),o,function(t,n,o){return t?r(t):n?r(null,n,o):void w(s.join(e,"index"),o,r)}):w(s.join(e,"index"),o,r)})}w(s.join(e,"/index"),o,r)}):w(s.join(e,"index"),o,r)})})}function D(e,t){if(0===t.length)return e(null,void 0);var n=t[0];function r(t,r,s){return t?e(t):r?e(null,r,s):void x(n,m.package,o)}function o(n,r,s){return n?e(n):r?e(null,r,s):void D(e,t.slice(1))}S(s.dirname(n),function(s,o){if(s)return e(s);if(!o)return D(e,t.slice(1));w(n,m.package,r)})}f(y,P,m,function(t,n){t?u(t):function(t){if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e))I=s.resolve(t,e),"."!==e&&".."!==e&&"/"!==e.slice(-1)||(I+="/"),/\/$/.test(e)&&I===t?x(I,m.package,M):w(I,m.package,M);else{if(O&&c(e))return u(null,e);!function(e,t,n){var r=function(){return function(e,t,n){for(var r=i(t,n,e),o=0;o<r.length;o++)r[o]=s.join(r[o],e);return r}(e,t,m)};D(n,b?b(e,t,r,m):r())}(e,t,function(t,n,r){if(t)u(t);else{if(n)return f(y,n,m,function(e,t){e?u(e):u(null,t,r)});var s=new Error("Cannot find module '"+e+"' from '"+C+"'");s.code="MODULE_NOT_FOUND",u(s)}})}}(n)})}}var IE,PE,ME,wE,LE,xE,DE,kE,UE={assert:!0,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:">= 8","node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:">= 0.5 && < 0.9.7",buffer:!0,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:!0,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:">= 0.5","node:cluster":[">= 14.18 && < 15",">= 16"],console:!0,"node:console":[">= 14.18 && < 15",">= 16"],constants:!0,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:!0,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:">= 1 && < 8",_debugger:"< 8",dgram:!0,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:[">= 14.17 && < 15",">= 15.1"],"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:!0,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:">= 0.7.12","node:domain":[">= 14.18 && < 15",">= 16"],events:!0,"node:events":[">= 14.18 && < 15",">= 16"],freelist:"< 6",fs:!0,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:">= 0.11.1","node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:">= 0.11.1","node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:">= 0.11.1","node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:">= 0.11.1","node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:">= 0.11.1","node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:">= 0.11.1","node:_http_server":[">= 14.18 && < 15",">= 16"],http:!0,"node:http":[">= 14.18 && < 15",">= 16"],http2:">= 8.8","node:http2":[">= 14.18 && < 15",">= 16"],https:!0,"node:https":[">= 14.18 && < 15",">= 16"],inspector:">= 8","node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:"< 8",module:!0,"node:module":[">= 14.18 && < 15",">= 16"],net:!0,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:!0,"node:os":[">= 14.18 && < 15",">= 16"],path:!0,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:">= 8.5","node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:">= 1","node:process":[">= 14.18 && < 15",">= 16"],punycode:">= 0.5","node:punycode":[">= 14.18 && < 15",">= 16"],querystring:!0,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:!0,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:!0,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:">= 0.11.5 && < 3","node:sqlite":">= 23.4",_stream_duplex:">= 0.9.4","node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:">= 0.9.4","node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:">= 1.4.1","node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:">= 0.9.4","node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:">= 0.9.4","node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:">= 0.9.4","node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:!0,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:!0,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:[">= 0.4 && < 0.7",">= 0.8"],"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:!0,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:">= 0.11.13","node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:">= 0.11.3 && < 10",_tls_wrap:">= 0.11.3","node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:!0,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:">= 10","node:trace_events":[">= 14.18 && < 15",">= 16"],tty:!0,"node:tty":[">= 14.18 && < 15",">= 16"],url:!0,"node:url":[">= 14.18 && < 15",">= 16"],util:!0,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:">= 1","node:v8":[">= 14.18 && < 15",">= 16"],vm:!0,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:">= 11.7","node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:">= 0.5","node:zlib":[">= 14.18 && < 15",">= 16"]};function $E(){if(xE)return LE;xE=1;var n=NE(),r=e,s=t,o=rE(),i=sE(),a=EE(),c=SE(),u="win32"!==process.platform&&r.realpathSync&&"function"==typeof r.realpathSync.native?r.realpathSync.native:r.realpathSync,l=o(),p=function(e){try{var t=r.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!t&&(t.isFile()||t.isFIFO())},d=function(e){try{var t=r.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!t&&t.isDirectory()},h=function(e){try{return u(e)}catch(e){if("ENOENT"!==e.code)throw e}return e},f=function(e,t,n){return n&&!1===n.preserveSymlinks?e(t):t},_=function(e,t){var n=e(t);try{return JSON.parse(n)}catch(e){}};return LE=function(e,t){if("string"!=typeof e)throw new TypeError("Path must be a string.");var o=c(e,t),u=o.isFile||p,m=o.readFileSync||r.readFileSync,g=o.isDirectory||d,E=o.realpathSync||h,S=o.readPackageSync||_;if(o.readFileSync&&o.readPackageSync)throw new TypeError("`readFileSync` and `readPackageSync` are mutually exclusive.");var T=o.packageIterator,y=o.extensions||[".js"],A=!1!==o.includeCoreModules,v=o.basedir||s.dirname(i()),b=o.filename||v;o.paths=o.paths||[s.join(l,".node_modules"),s.join(l,".node_libraries")];var R=f(E,s.resolve(v),o);if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e)){var O=s.resolve(R,e);"."!==e&&".."!==e&&"/"!==e.slice(-1)||(O+="/");var N=P(O)||w(O);if(N)return f(E,N,o)}else{if(A&&n(e))return e;var C=function(e,t){for(var n=function(){return function(e,t,n){for(var r=a(t,n,e),o=0;o<r.length;o++)r[o]=s.join(r[o],e);return r}(e,t,o)},r=T?T(e,t,n,o):n(),i=0;i<r.length;i++){var c=r[i];if(g(s.dirname(c))){var u=P(c);if(u)return u;var l=w(c);if(l)return l}}}(e,R);if(C)return f(E,C,o)}var I=new Error("Cannot find module '"+e+"' from '"+b+"'");throw I.code="MODULE_NOT_FOUND",I;function P(e){var t=M(s.dirname(e));if(t&&t.dir&&t.pkg&&o.pathFilter){var n=s.relative(t.dir,e),r=o.pathFilter(t.pkg,e,n);r&&(e=s.resolve(t.dir,r))}if(u(e))return e;for(var i=0;i<y.length;i++){var a=e+y[i];if(u(a))return a}}function M(e){if(""!==e&&"/"!==e&&!("win32"===process.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e))){var t=s.join(f(E,e,o),"package.json");if(!u(t))return M(s.dirname(e));var n=S(m,t);return n&&o.packageFilter&&(n=o.packageFilter(n,e)),{pkg:n,dir:e}}}function w(e){var t=s.join(f(E,e,o),"/package.json");if(u(t)){try{var n=S(m,t)}catch(e){}if(n&&o.packageFilter&&(n=o.packageFilter(n,e)),n&&n.main){if("string"!=typeof n.main){var r=new TypeError("package “"+n.name+"” `main` must be a string");throw r.code="INVALID_PACKAGE_MAIN",r}"."!==n.main&&"./"!==n.main||(n.main="index");try{var i=P(s.resolve(e,n.main));if(i)return i;var a=w(s.resolve(e,n.main));if(a)return a}catch(e){}}}return P(s.join(e,"/index"))}}}function GE(){if(kE)return DE;kE=1;var e=CE();return e.core=function(){if(PE)return IE;PE=1;var e=NE(),t=UE,n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=e(r));return IE=n}(),e.isCore=function(){if(wE)return ME;wE=1;var e=NE();return ME=function(t){return e(t)}}(),e.sync=$E(),DE=e}var jE={url:"https://github.com/nodejs/require-in-the-middle/issues"};const VE=t,HE=a,BE=eE("require-in-the-middle"),FE=nE;Bg.exports=zE;var YE=Bg.exports.Hook=zE;let qE,KE,WE;if(HE.isBuiltin)KE=HE.isBuiltin;else if(HE.builtinModules)KE=e=>!!e.startsWith("node:")||(void 0===qE&&(qE=new Set(HE.builtinModules)),qE.has(e));else{const e=GE(),[t,n]=process.versions.node.split(".").map(Number);KE=8===t&&n<8?t=>"http2"===t||!!e.core[t]:t=>!!e.core[t]}const ZE=/([/\\]index)?(\.js)?$/;class XE{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(e,t){if(this._localCache.has(e))return!0;if(t)return!1;{const t=require.cache[e];return!(!t||!(this._kRitmExports in t))}}get(e,t){const n=this._localCache.get(e);if(void 0!==n)return n;if(!t){const t=require.cache[e];return t&&t[this._kRitmExports]}}set(e,t,n){n?this._localCache.set(e,t):e in require.cache?require.cache[e][this._kRitmExports]=t:(BE('non-core module is unexpectedly not in require.cache: "%s"',e),this._localCache.set(e,t))}}function zE(e,t,n){if(this instanceof zE==!1)return new zE(e,t,n);if("function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),"function"!=typeof HE._resolveFilename)return console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof HE._resolveFilename),void console.error("Please report this error as an issue related to Node.js %s at %s",process.version,jE.url);this._cache=new XE,this._unhooked=!1,this._origRequire=HE.prototype.require;const r=this,s=new Set,o=!!t&&!0===t.internals,i=Array.isArray(e);function a(t,a){const c=t[0],u=KE(c);let l,p,d;if(u){if(l=c,c.startsWith("node:")){const e=c.slice(5);KE(e)&&(l=e)}}else{if(a)return BE("call to process.getBuiltinModule with unknown built-in id"),r._origGetBuiltinModule.apply(this,t);try{l=HE._resolveFilename(c,this)}catch(e){return BE('Module._resolveFilename("%s") threw %j, calling original Module.require',c,e.message),r._origRequire.apply(this,t)}}if(BE("processing %s module require('%s'): %s",!0===u?"core":"non-core",c,l),!0===r._cache.has(l,u))return BE("returning already patched cached module: %s",l),r._cache.get(l,u);const h=s.has(l);!1===h&&s.add(l);const f=a?r._origGetBuiltinModule.apply(this,t):r._origRequire.apply(this,t);if(!0===h)return BE("module is in the process of being patched already - ignoring: %s",l),f;if(s.delete(l),!0===u){if(!0===i&&!1===e.includes(l))return BE("ignoring core module not on whitelist: %s",l),f;p=l}else if(!0===i&&e.includes(l)){const e=VE.parse(l);p=e.name,d=e.dir}else{const t=FE(l);if(void 0===t)return BE("could not parse filename: %s",l),f;p=t.name,d=t.basedir;const n=function(e){const t="/"!==VE.sep?e.path.split(VE.sep).join("/"):e.path;return VE.posix.join(e.name,t).replace(ZE,"")}(t);BE("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",p,c,n,d);let s=!1;if(i){if(!c.startsWith(".")&&e.includes(c)&&(p=c,s=!0),!e.includes(p)&&!e.includes(n))return f;e.includes(n)&&n!==p&&(p=n,s=!0)}if(!s){let e;try{e=function(e,t){if(!WE)if(require.resolve&&require.resolve.paths)WE=function(e,t){return require.resolve(e,{paths:[t]})};else{const e=GE();WE=function(t,n){return e.sync(t,{basedir:n})}}return WE(e,t)}(p,d)}catch(e){return BE("could not resolve module: %s",p),r._cache.set(l,f,u),f}if(e!==l){if(!0!==o)return BE("ignoring require of non-main module file: %s",e),r._cache.set(l,f,u),f;p=p+VE.sep+VE.relative(d,l),BE("preparing to process require of internal file: %s",p)}}}r._cache.set(l,f,u),BE("calling require hook: %s",p);const _=n(f,p,d);return r._cache.set(l,_,u),BE("returning module: %s",p),_}BE("registering require hook"),this._require=HE.prototype.require=function(e){return!0===r._unhooked?(BE("ignoring require call - module is soft-unhooked"),r._origRequire.apply(this,arguments)):a.call(this,arguments,!1)},"function"==typeof process.getBuiltinModule&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(e){return!0===r._unhooked?(BE("ignoring process.getBuiltinModule call - module is soft-unhooked"),r._origGetBuiltinModule.apply(this,arguments)):a.call(this,arguments,!0)})}zE.prototype.unhook=function(){this._unhooked=!0,this._require===HE.prototype.require?(HE.prototype.require=this._origRequire,BE("require unhook successful")):BE("require unhook unsuccessful"),void 0!==process.getBuiltinModule&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,BE("process.getBuiltinModule unhook successful")):BE("process.getBuiltinModule unhook unsuccessful"))};const QE="/";let JE=class{hooks=[];children=new Map},eS=class{_trie=new JE;_counter=0;insert(e){let t=this._trie;for(const n of e.moduleName.split(QE)){let e=t.children.get(n);e||(e=new JE,t.children.set(n,e)),t=e}t.hooks.push({hook:e,insertedId:this._counter++})}search(e,{maintainInsertionOrder:t,fullOnly:n}={}){let r=this._trie;const s=[];let o=!0;for(const t of e.split(QE)){const e=r.children.get(t);if(!e){o=!1;break}n||s.push(...e.hooks),r=e}return n&&o&&s.push(...r.hooks),0===s.length?[]:1===s.length?[s[0].hook]:(t&&s.sort((e,t)=>e.insertedId-t.insertedId),s.map(({hook:e})=>e))}};const tS=["afterEach","after","beforeEach","before","describe","it"].every(e=>"function"==typeof global[e]);let nS=class e{_moduleNameTrie=new eS;static _instance;constructor(){this._initialize()}_initialize(){new YE(null,{internals:!0},(e,t,n)=>{const r=(s=t,C.sep!==QE?s.split(C.sep).join(QE):s);var s;const o=this._moduleNameTrie.search(r,{maintainInsertionOrder:!0,fullOnly:void 0===n});for(const{onRequire:r}of o)e=r(e,t,n);return e})}register(e,t){const n={moduleName:e,onRequire:t};return this._moduleNameTrie.insert(n),n}static getInstance(){return tS?new e:this._instance=this._instance??new e}};var rS={exports:{}},sS={};const oS=[],iS=new WeakMap,aS=new WeakMap,cS=new Map,uS=[],lS={set:(e,t,n)=>iS.get(e)[t](n),get(e,t){if(t===Symbol.toStringTag)return"Module";const n=aS.get(e)[t];return"function"==typeof n?n():void 0},defineProperty(e,t,n){if(!("value"in n))throw new Error("Getters/setters are not supported for exports property descriptors.");return iS.get(e)[t](n.value)}};let pS=!1;sS.register=function(e,t,n,r,s){cS.set(e,s),iS.set(t,n),aS.set(t,r);const o=new Proxy(t,lS);oS.forEach(t=>t(e,o)),uS.push([e,o])},sS.importHooks=oS,sS.specifiers=cS,sS.toHook=uS,sS.getExperimentalPatchInternals=function(){return pS},sS.setExperimentalPatchInternals=function(e){pS=e};const dS=t,hS=nE,{fileURLToPath:fS}=i,{MessageChannel:_S}=u,{importHooks:mS,specifiers:gS,toHook:ES,getExperimentalPatchInternals:SS}=sS;function TS(e){mS.push(e),ES.forEach(([t,n])=>e(t,n))}function yS(e){const t=mS.indexOf(e);t>-1&&mS.splice(t,1)}function AS(e,t,n,r){const s=e(t,n,r);s&&s!==t&&(t.default=s)}let vS;function bS(e,t,n){if(this instanceof bS==!1)return new bS(e,t,n);"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null);const r=!!t&&!0===t.internals;vS&&Array.isArray(e)&&vS(e),this._iitmHook=(t,s)=>{const o=t;let i;if(t.startsWith("node:"))t=t.replace(/^node:/,"");else{if(t.startsWith("file://"))try{t=fS(t)}catch(e){}const e=hS(t);e&&(t=e.name,i=e.basedir)}if(e){for(const a of e)if(a===t){if(i)if(r)t=t+dS.sep+dS.relative(i,fS(o));else if(!SS()&&!i.endsWith(gS.get(o)))continue;AS(n,s,t,i)}}else AS(n,s,t,i)},TS(this._iitmHook)}bS.prototype.unhook=function(){yS(this._iitmHook)},rS.exports=bS;var RS=rS.exports.Hook=bS;rS.exports.addHook=TS,rS.exports.removeHook=yS;var OS=rS.exports.createAddHookMessageChannel=function(){const{port1:e,port2:t}=new _S;let n,r=0;return vS=t=>{r++,e.postMessage(t)},e.on("message",()=>{r--,n&&r<=0&&n()}).unref(),{registerOptions:{data:{addHookMessagePort:t,include:[]},transferList:[t]},addHookMessagePort:t,waitForAllMessagesAcknowledged:function(){const e=setInterval(()=>{},1e3),t=new Promise(e=>{n=e}).then(()=>{clearInterval(e)});return 0===r&&n(),t}}};function NS(e,t,n){let r,s;try{s=e()}catch(e){r=e}finally{if(t(r,s),r&&!n)throw r;return s}}function CS(e){return"function"==typeof e&&"function"==typeof e.__original&&"function"==typeof e.__unwrap&&!0===e.__wrapped}let IS=class extends Ug{_modules;_hooks=[];_requireInTheMiddleSingleton=nS.getInstance();_enabled=!1;constructor(e,t,n){super(e,t,n);let r=this.init();r&&!Array.isArray(r)&&(r=[r]),this._modules=r||[],this._config.enabled&&this.enable()}_wrap=(e,t,n)=>{if(CS(e[t])&&this._unwrap(e,t),s.types.isProxy(e)){const r=Lg(Object.assign({},e),t,n);return Object.defineProperty(e,t,{value:r}),r}return Lg(e,t,n)};_unwrap=(e,t)=>s.types.isProxy(e)?Object.defineProperty(e,t,{value:e[t]}):Dg(e,t);_massWrap=(e,t,n)=>{e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{this._wrap(e,t,n)})}):vt.error("must provide one or more functions to wrap on modules")):vt.error("must provide one or more modules to patch")};_massUnwrap=(e,t)=>{e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{this._unwrap(e,t)})}):vt.error("must provide one or more functions to wrap on modules")):vt.error("must provide one or more modules to patch")};_warnOnPreloadedModules(){this._modules.forEach(e=>{const{name:t}=e;try{const e=require.resolve(t);require.cache[e]&&this._diag.warn(`Module ${t} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${t}`)}catch{}})}_extractPackageVersion(t){try{const n=e.readFileSync(C.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return"string"==typeof r?r:void 0}catch{vt.warn("Failed extracting version",t)}}_onRequire(e,t,n,r){if(!r)return"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:e.name}),e.patch(t)):t;const s=this._extractPackageVersion(r);if(e.moduleVersion=s,e.name===n)return PS(e.supportedVersions,s,e.includePrerelease)&&"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:e.name,version:e.moduleVersion,baseDir:r}),e.patch(t,e.moduleVersion)):t;const o=e.files??[],i=C.normalize(n);return o.filter(e=>e.name===i).filter(t=>PS(t.supportedVersions,s,e.includePrerelease)).reduce((t,n)=>(n.moduleExports=t,this._enabled?(this._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:e.name,version:e.moduleVersion,fileName:n.name,baseDir:r}),n.patch(t,e.moduleVersion)):t),t)}enable(){if(!this._enabled)if(this._enabled=!0,this._hooks.length>0)for(const e of this._modules){"function"==typeof e.patch&&e.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:e.name,version:e.moduleVersion}),e.patch(e.moduleExports,e.moduleVersion));for(const t of e.files)t.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:e.name,version:e.moduleVersion,fileName:t.name}),t.patch(t.moduleExports,e.moduleVersion))}else{this._warnOnPreloadedModules();for(const e of this._modules){const t=(t,n,r)=>{if(!r&&C.isAbsolute(n)){const e=C.parse(n);n=e.name,r=e.dir}return this._onRequire(e,t,n,r)},n=(t,n,r)=>this._onRequire(e,t,n,r),r=C.isAbsolute(e.name)?new YE([e.name],{internals:!0},n):this._requireInTheMiddleSingleton.register(e.name,n);this._hooks.push(r);const s=new RS([e.name],{internals:!1},t);this._hooks.push(s)}}}disable(){if(this._enabled){this._enabled=!1;for(const e of this._modules){"function"==typeof e.unpatch&&e.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:e.name,version:e.moduleVersion}),e.unpatch(e.moduleExports,e.moduleVersion));for(const t of e.files)t.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:e.name,version:e.moduleVersion,fileName:t.name}),t.unpatch(t.moduleExports,e.moduleVersion))}}}isEnabled(){return this._enabled}};function PS(e,t,n){return void 0===t?e.includes("*"):e.some(e=>hg(t,e,{includePrerelease:n}))}let MS=class{name;supportedVersions;patch;unpatch;files;constructor(e,t,n,r,s){this.name=e,this.supportedVersions=t,this.patch=n,this.unpatch=r,this.files=s||[]}};class wS{supportedVersions;patch;unpatch;name;constructor(e,n,r,s){this.supportedVersions=n,this.patch=r,this.unpatch=s,this.name=t.normalize(e)}}var LS;!function(e){e[e.STABLE=1]="STABLE",e[e.OLD=2]="OLD",e[e.DUPLICATE=3]="DUPLICATE"}(LS||(LS={}));var xS=Object.freeze({__proto__:null,InstrumentationBase:IS,InstrumentationNodeModuleDefinition:MS,InstrumentationNodeModuleFile:wS,get SemconvStability(){return LS},isWrapped:CS,registerInstrumentations:ug,safeExecuteInTheMiddle:NS,safeExecuteInTheMiddleAsync:async function(e,t,n){let r,s;try{s=await e()}catch(e){r=e}finally{if(t(r,s),r&&!n)throw r;return s}},semconvStabilityFromStr:function(e,t){let n=LS.OLD;const r=t?.split(",").map(e=>e.trim()).filter(e=>""!==e);for(const t of r??[]){if(t.toLowerCase()===e+"/dup"){n=LS.DUPLICATE;break}t.toLowerCase()===e&&(n=LS.STABLE)}return n}}),DS=Bt(xS),kS=Bt(nm),US={},$S={};Object.defineProperty($S,"__esModule",{value:!0}),$S.HTTP_FLAVOR_VALUE_HTTP_1_1=$S.NET_TRANSPORT_VALUE_IP_UDP=$S.NET_TRANSPORT_VALUE_IP_TCP=$S.ATTR_NET_TRANSPORT=$S.ATTR_NET_PEER_PORT=$S.ATTR_NET_PEER_NAME=$S.ATTR_NET_PEER_IP=$S.ATTR_NET_HOST_PORT=$S.ATTR_NET_HOST_NAME=$S.ATTR_NET_HOST_IP=$S.ATTR_HTTP_USER_AGENT=$S.ATTR_HTTP_URL=$S.ATTR_HTTP_TARGET=$S.ATTR_HTTP_STATUS_CODE=$S.ATTR_HTTP_SERVER_NAME=$S.ATTR_HTTP_SCHEME=$S.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=$S.ATTR_HTTP_RESPONSE_CONTENT_LENGTH=$S.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=$S.ATTR_HTTP_REQUEST_CONTENT_LENGTH=$S.ATTR_HTTP_METHOD=$S.ATTR_HTTP_HOST=$S.ATTR_HTTP_FLAVOR=$S.ATTR_HTTP_CLIENT_IP=$S.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST=$S.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT=$S.ATTR_USER_AGENT_SYNTHETIC_TYPE=void 0,$S.ATTR_USER_AGENT_SYNTHETIC_TYPE="user_agent.synthetic.type",$S.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT="bot",$S.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST="test",$S.ATTR_HTTP_CLIENT_IP="http.client_ip",$S.ATTR_HTTP_FLAVOR="http.flavor",$S.ATTR_HTTP_HOST="http.host",$S.ATTR_HTTP_METHOD="http.method",$S.ATTR_HTTP_REQUEST_CONTENT_LENGTH="http.request_content_length",$S.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED="http.request_content_length_uncompressed",$S.ATTR_HTTP_RESPONSE_CONTENT_LENGTH="http.response_content_length",$S.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED="http.response_content_length_uncompressed",$S.ATTR_HTTP_SCHEME="http.scheme",$S.ATTR_HTTP_SERVER_NAME="http.server_name",$S.ATTR_HTTP_STATUS_CODE="http.status_code",$S.ATTR_HTTP_TARGET="http.target",$S.ATTR_HTTP_URL="http.url",$S.ATTR_HTTP_USER_AGENT="http.user_agent",$S.ATTR_NET_HOST_IP="net.host.ip",$S.ATTR_NET_HOST_NAME="net.host.name",$S.ATTR_NET_HOST_PORT="net.host.port",$S.ATTR_NET_PEER_IP="net.peer.ip",$S.ATTR_NET_PEER_NAME="net.peer.name",$S.ATTR_NET_PEER_PORT="net.peer.port",$S.ATTR_NET_TRANSPORT="net.transport",$S.NET_TRANSPORT_VALUE_IP_TCP="ip_tcp",$S.NET_TRANSPORT_VALUE_IP_UDP="ip_udp",$S.HTTP_FLAVOR_VALUE_HTTP_1_1="1.1";var GS,jS={};GS=jS,Object.defineProperty(GS,"__esModule",{value:!0}),GS.AttributeNames=void 0,function(e){e.HTTP_ERROR_NAME="http.error_name",e.HTTP_ERROR_MESSAGE="http.error_message",e.HTTP_STATUS_TEXT="http.status_text"}(GS.AttributeNames||(GS.AttributeNames={}));var VS={};function HS(e,t){Error.captureStackTrace(this,HS),this.name=this.constructor.name,this.message=e,this.input=t}Object.defineProperty(VS,"__esModule",{value:!0}),VS.SYNTHETIC_BOT_NAMES=VS.SYNTHETIC_TEST_NAMES=void 0,VS.SYNTHETIC_TEST_NAMES=["alwayson"],VS.SYNTHETIC_BOT_NAMES=["googlebot","bingbot"],s.inherits(HS,Error);var BS={isDelimiter:function(e){return 34===e||40===e||41===e||44===e||47===e||e>=58&&e<=64||e>=91&&e<=93||123===e||125===e},isTokenChar:function(e){return 33===e||e>=35&&e<=39||42===e||43===e||45===e||46===e||e>=48&&e<=57||e>=65&&e<=90||e>=94&&e<=122||124===e||126===e},isExtended:function(e){return e>=128&&e<=255},isPrint:function(e){return e>=32&&e<=126}},FS=s,YS=HS,qS=BS.isDelimiter,KS=BS.isTokenChar,WS=BS.isExtended,ZS=BS.isPrint;function XS(e){return e.replace(/\\(.)/g,"$1")}function zS(e,t){return FS.format("Unexpected character '%s' at index %d",e.charAt(t),t)}var QS=function(e){for(var t,n,r=!1,s=!1,o=!1,i={},a=[],c=-1,u=-1,l=0;l<e.length;l++)if(n=e.charCodeAt(l),void 0===t){if(0!==l&&-1===c&&(32===n||9===n))continue;if(KS(n))-1===c&&(c=l);else{if(61!==n||-1===c)throw new YS(zS(e,l),e);t=e.slice(c,l).toLowerCase(),c=-1}}else if(s&&(9===n||ZS(n)||WS(n)))s=!1;else if(KS(n)){if(-1!==u)throw new YS(zS(e,l),e);-1===c&&(c=l)}else if(qS(n)||WS(n))if(o)34===n?(o=!1,u=l):92===n?(-1===c&&(c=l),s=r=!0):-1===c&&(c=l);else if(34===n&&61===e.charCodeAt(l-1))o=!0;else{if(44!==n&&59!==n||-1===c&&-1===u)throw new YS(zS(e,l),e);-1!==c?(-1===u&&(u=l),i[t]=r?XS(e.slice(c,u)):e.slice(c,u)):i[t]="",44===n&&(a.push(i),i={}),t=void 0,c=u=-1}else{if(32!==n&&9!==n)throw new YS(zS(e,l),e);if(-1!==u)continue;if(o)-1===c&&(c=l);else{if(-1===c)throw new YS(zS(e,l),e);u=l}}if(void 0===t||o||-1===c&&-1===u||32===n||9===n)throw new YS("Unexpected end of input",e);return-1!==c?(-1===u&&(u=l),i[t]=r?XS(e.slice(c,u)):e.slice(c,u)):i[t]="",a.push(i),a};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.headerCapture=e.getIncomingStableRequestMetricAttributesOnResponse=e.getIncomingRequestMetricAttributesOnResponse=e.getIncomingRequestAttributesOnResponse=e.getIncomingRequestMetricAttributes=e.getIncomingRequestAttributes=e.getRemoteClientAddress=e.getOutgoingStableRequestMetricAttributesOnResponse=e.getOutgoingRequestMetricAttributesOnResponse=e.getOutgoingRequestAttributesOnResponse=e.setAttributesFromHttpKind=e.getOutgoingRequestMetricAttributes=e.getOutgoingRequestAttributes=e.extractHostnameAndPort=e.isValidOptionsType=e.getRequestInfo=e.isCompressed=e.setResponseContentLengthAttribute=e.setRequestContentLengthAttribute=e.setSpanWithError=e.satisfiesPattern=e.parseResponseStatus=e.getAbsoluteUrl=void 0;const t=qt,n=kS,r=$S,s=Qm,o=DS,a=i,c=jS,u=VS,l=QS;e.getAbsoluteUrl=(e,t,n="http:")=>{const r=e||{},s=r.protocol||n,o=(r.port||"").toString(),i=r.path||"/";let a=r.host||r.hostname||t.host||"localhost";return-1===a.indexOf(":")&&o&&"80"!==o&&"443"!==o&&(a+=`:${o}`),`${s}//${a}${i}`};e.parseResponseStatus=(e,n)=>{const r=e===t.SpanKind.CLIENT?400:500;return n&&n>=100&&n<r?t.SpanStatusCode.UNSET:t.SpanStatusCode.ERROR};e.satisfiesPattern=(e,t)=>{if("string"==typeof t)return t===e;if(t instanceof RegExp)return t.test(e);if("function"==typeof t)return t(e);throw new TypeError("Pattern is in unsupported datatype")};e.setSpanWithError=(e,r,s)=>{const i=r.message;s&o.SemconvStability.OLD&&(e.setAttribute(c.AttributeNames.HTTP_ERROR_NAME,r.name),e.setAttribute(c.AttributeNames.HTTP_ERROR_MESSAGE,i)),s&o.SemconvStability.STABLE&&e.setAttribute(n.ATTR_ERROR_TYPE,r.name),e.setStatus({code:t.SpanStatusCode.ERROR,message:i}),e.recordException(r)};e.setRequestContentLengthAttribute=(t,n)=>{const s=p(t.headers);null!==s&&((0,e.isCompressed)(t.headers)?n[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH]=s:n[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED]=s)};function p(e){const t=e["content-length"];if(void 0===t)return null;const n=parseInt(t,10);return isNaN(n)?null:n}e.setResponseContentLengthAttribute=(t,n)=>{const s=p(t.headers);null!==s&&((0,e.isCompressed)(t.headers)?n[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH]=s:n[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED]=s)};e.isCompressed=e=>{const t=e["content-encoding"];return!!t&&"identity"!==t};e.getRequestInfo=(e,t,n)=>{let r,s,o,i=!1;if("string"==typeof t){try{const e=function(e){const{hostname:t,pathname:n,port:r,username:s,password:o,search:i,protocol:a,hash:c,href:u,origin:l,host:p}=new URL(e),d={protocol:a,hostname:t&&"["===t[0]?t.slice(1,-1):t,hash:c,search:i,pathname:n,path:`${n||""}${i||""}`,href:u,origin:l,host:p};return""!==r&&(d.port=Number(r)),(s||o)&&(d.auth=`${decodeURIComponent(s)}:${decodeURIComponent(o)}`),d}(t);o=e,r=e.pathname||"/"}catch(n){i=!0,e.verbose("Unable to parse URL provided to HTTP request, using fallback to determine path. Original error:",n),o={path:t},r=o.path||"/"}s=`${o.protocol||"http:"}//${o.host}`,void 0!==n&&Object.assign(o,n)}else if(t instanceof a.URL)o={protocol:t.protocol,hostname:"string"==typeof t.hostname&&t.hostname.startsWith("[")?t.hostname.slice(1,-1):t.hostname,path:`${t.pathname||""}${t.search||""}`},""!==t.port&&(o.port=Number(t.port)),(t.username||t.password)&&(o.auth=`${t.username}:${t.password}`),r=t.pathname,s=t.origin,void 0!==n&&Object.assign(o,n);else{o=Object.assign({protocol:t.host?"http:":void 0},t);const e=o.host||(null!=o.port?`${o.hostname}${o.port}`:o.hostname);if(s=`${o.protocol||"http:"}//${e}`,r=t.pathname,!r&&o.path)try{r=new URL(o.path,s).pathname||"/"}catch{r="/"}}return{origin:s,pathname:r,method:o.method?o.method.toUpperCase():"GET",optionsParsed:o,invalidUrl:i}};e.isValidOptionsType=e=>{if(!e)return!1;const t=typeof e;return"string"===t||"object"===t&&!Array.isArray(e)};e.extractHostnameAndPort=e=>{if(e.hostname&&e.port)return{hostname:e.hostname,port:e.port};const t=e.host?.match(/^([^:/ ]+)(:\d{1,5})?/)||null,n=e.hostname||(null===t?"localhost":t[1]);let r=e.port;return r||(r=t&&t[2]?t[2].substring(1):"https:"===e.protocol?"443":"80"),{hostname:n,port:r}};e.getOutgoingRequestAttributes=(t,s,i,a)=>{const c=s.hostname,u=s.port,l=t.method??"GET",p=m(l),h=t.headers||{},f=h["user-agent"],_=(0,e.getAbsoluteUrl)(t,h,`${s.component}:`),g={[r.ATTR_HTTP_URL]:_,[r.ATTR_HTTP_METHOD]:l,[r.ATTR_HTTP_TARGET]:t.path||"/",[r.ATTR_NET_PEER_NAME]:c,[r.ATTR_HTTP_HOST]:h.host??`${c}:${u}`},E={[n.ATTR_HTTP_REQUEST_METHOD]:p,[n.ATTR_SERVER_ADDRESS]:c,[n.ATTR_SERVER_PORT]:Number(u),[n.ATTR_URL_FULL]:_,[n.ATTR_USER_AGENT_ORIGINAL]:f};switch(l!==p&&(E[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=l),a&&f&&(E[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=d(f)),void 0!==f&&(g[r.ATTR_HTTP_USER_AGENT]=f),i){case o.SemconvStability.STABLE:return Object.assign(E,s.hookAttributes);case o.SemconvStability.OLD:return Object.assign(g,s.hookAttributes)}return Object.assign(g,E,s.hookAttributes)};e.getOutgoingRequestMetricAttributes=e=>{const t={};return t[r.ATTR_HTTP_METHOD]=e[r.ATTR_HTTP_METHOD],t[r.ATTR_NET_PEER_NAME]=e[r.ATTR_NET_PEER_NAME],t};e.setAttributesFromHttpKind=(e,t)=>{e&&(t[r.ATTR_HTTP_FLAVOR]=e,"QUIC"!==e.toUpperCase()?t[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_TCP:t[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_UDP)};const d=e=>{const t=String(e).toLowerCase();for(const e of u.SYNTHETIC_TEST_NAMES)if(t.includes(e))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST;for(const e of u.SYNTHETIC_BOT_NAMES)if(t.includes(e))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT};e.getOutgoingRequestAttributesOnResponse=(t,s)=>{const{statusCode:i,statusMessage:a,httpVersion:u,socket:l}=t,p={},d={};if(null!=i&&(d[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=i),l){const{remoteAddress:e,remotePort:s}=l;p[r.ATTR_NET_PEER_IP]=e,p[r.ATTR_NET_PEER_PORT]=s,d[n.ATTR_NETWORK_PEER_ADDRESS]=e,d[n.ATTR_NETWORK_PEER_PORT]=s,d[n.ATTR_NETWORK_PROTOCOL_VERSION]=t.httpVersion}switch((0,e.setResponseContentLengthAttribute)(t,p),i&&(p[r.ATTR_HTTP_STATUS_CODE]=i,p[c.AttributeNames.HTTP_STATUS_TEXT]=(a||"").toUpperCase()),(0,e.setAttributesFromHttpKind)(u,p),s){case o.SemconvStability.STABLE:return d;case o.SemconvStability.OLD:return p}return Object.assign(p,d)};e.getOutgoingRequestMetricAttributesOnResponse=e=>{const t={};return t[r.ATTR_NET_PEER_PORT]=e[r.ATTR_NET_PEER_PORT],t[r.ATTR_HTTP_STATUS_CODE]=e[r.ATTR_HTTP_STATUS_CODE],t[r.ATTR_HTTP_FLAVOR]=e[r.ATTR_HTTP_FLAVOR],t};function h(e,t){const n=e.split(":");if(1===n.length)return"http"===t?{host:n[0],port:"80"}:"https"===t?{host:n[0],port:"443"}:{host:n[0]};if(2===n.length)return{host:n[0],port:n[1]};if(n[0].startsWith("["))if(n[n.length-1].endsWith("]")){if("http"===t)return{host:e,port:"80"};if("https"===t)return{host:e,port:"443"}}else if(n[n.length-2].endsWith("]"))return{host:n.slice(0,-1).join(":"),port:n[n.length-1]};return{host:e}}function f(e){const t=e.headers.forwarded;if(t)for(const e of g(t))if(e.for)return e.for;const n=e.headers["x-forwarded-for"];if("string"==typeof n)return n;if(Array.isArray(n))return n[0];const r=e.socket.remoteAddress;return r||null}e.getOutgoingStableRequestMetricAttributesOnResponse=e=>{const t={};return e[n.ATTR_NETWORK_PROTOCOL_VERSION]&&(t[n.ATTR_NETWORK_PROTOCOL_VERSION]=e[n.ATTR_NETWORK_PROTOCOL_VERSION]),e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(t[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),t},e.getRemoteClientAddress=f;e.getIncomingRequestAttributes=(t,s,i)=>{const a=t.headers,c=a["user-agent"],u=a["x-forwarded-for"],l=t.httpVersion,p=a.host,_=p?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",E=t.method,S=m(E),T=function(e,t){const n=e.headers.forwarded;if(n)for(const e of g(n))if(e.host)return h(e.host,e.proto);const r=e.headers["x-forwarded-host"];if("string"==typeof r)return"string"==typeof e.headers["x-forwarded-proto"]?h(r,e.headers["x-forwarded-proto"]):Array.isArray(e.headers["x-forwarded-proto"])?h(r,e.headers["x-forwarded-proto"][0]):h(r);if(Array.isArray(r)&&"string"==typeof r[0]&&r[0].length>0)return"string"==typeof e.headers["x-forwarded-proto"]?h(r[0],e.headers["x-forwarded-proto"]):Array.isArray(e.headers["x-forwarded-proto"])?h(r[0],e.headers["x-forwarded-proto"][0]):h(r[0]);const s=e.headers.host;return"string"==typeof s&&s.length>0?h(s,t):null}(t,s.component),y=s.serverName,A=f(t),v={[n.ATTR_HTTP_REQUEST_METHOD]:S,[n.ATTR_URL_SCHEME]:s.component,[n.ATTR_SERVER_ADDRESS]:T?.host,[n.ATTR_NETWORK_PEER_ADDRESS]:t.socket.remoteAddress,[n.ATTR_NETWORK_PEER_PORT]:t.socket.remotePort,[n.ATTR_NETWORK_PROTOCOL_VERSION]:t.httpVersion,[n.ATTR_USER_AGENT_ORIGINAL]:c},b=function(e,t,n){try{if(t.headers.host)return new URL(t.url??"/",`${e}://${t.headers.host}`);{const n=new URL(t.url??"/",`${e}://localhost`);return{pathname:n.pathname,search:n.search,toString:function(){return n.pathname+n.search}}}}catch(e){return n.verbose("Unable to get URL from request",e),{}}}(s.component,t,i);null!=b?.pathname&&(v[n.ATTR_URL_PATH]=b.pathname),b.search&&(v[n.ATTR_URL_QUERY]=b.search.slice(1)),null!=A&&(v[n.ATTR_CLIENT_ADDRESS]=A.split(",")[0]),null!=T?.port&&(v[n.ATTR_SERVER_PORT]=Number(T.port)),E!==S&&(v[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=E),s.enableSyntheticSourceDetection&&c&&(v[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=d(c));const R={[r.ATTR_HTTP_URL]:b.toString(),[r.ATTR_HTTP_HOST]:p,[r.ATTR_NET_HOST_NAME]:_,[r.ATTR_HTTP_METHOD]:E,[r.ATTR_HTTP_SCHEME]:s.component};switch("string"==typeof u&&(R[r.ATTR_HTTP_CLIENT_IP]=u.split(",")[0]),"string"==typeof y&&(R[r.ATTR_HTTP_SERVER_NAME]=y),b?.pathname&&(R[r.ATTR_HTTP_TARGET]=b?.pathname+b?.search||"/"),void 0!==c&&(R[r.ATTR_HTTP_USER_AGENT]=c),(0,e.setRequestContentLengthAttribute)(t,R),(0,e.setAttributesFromHttpKind)(l,R),s.semconvStability){case o.SemconvStability.STABLE:return Object.assign(v,s.hookAttributes);case o.SemconvStability.OLD:return Object.assign(R,s.hookAttributes)}return Object.assign(R,v,s.hookAttributes)};e.getIncomingRequestMetricAttributes=e=>{const t={};return t[r.ATTR_HTTP_SCHEME]=e[r.ATTR_HTTP_SCHEME],t[r.ATTR_HTTP_METHOD]=e[r.ATTR_HTTP_METHOD],t[r.ATTR_NET_HOST_NAME]=e[r.ATTR_NET_HOST_NAME],t[r.ATTR_HTTP_FLAVOR]=e[r.ATTR_HTTP_FLAVOR],t};e.getIncomingRequestAttributesOnResponse=(e,i,a)=>{const{socket:u}=e,{statusCode:l,statusMessage:p}=i,d={[n.ATTR_HTTP_RESPONSE_STATUS_CODE]:l},h=(0,s.getRPCMetadata)(t.context.active()),f={};if(u){const{localAddress:e,localPort:t,remoteAddress:n,remotePort:s}=u;f[r.ATTR_NET_HOST_IP]=e,f[r.ATTR_NET_HOST_PORT]=t,f[r.ATTR_NET_PEER_IP]=n,f[r.ATTR_NET_PEER_PORT]=s}switch(f[r.ATTR_HTTP_STATUS_CODE]=l,f[c.AttributeNames.HTTP_STATUS_TEXT]=(p||"").toUpperCase(),h?.type===s.RPCType.HTTP&&void 0!==h.route&&(f[n.ATTR_HTTP_ROUTE]=h.route,d[n.ATTR_HTTP_ROUTE]=h.route),a){case o.SemconvStability.STABLE:return d;case o.SemconvStability.OLD:return f}return Object.assign(f,d)};e.getIncomingRequestMetricAttributesOnResponse=e=>{const t={};return t[r.ATTR_HTTP_STATUS_CODE]=e[r.ATTR_HTTP_STATUS_CODE],t[r.ATTR_NET_HOST_PORT]=e[r.ATTR_NET_HOST_PORT],void 0!==e[n.ATTR_HTTP_ROUTE]&&(t[n.ATTR_HTTP_ROUTE]=e[n.ATTR_HTTP_ROUTE]),t};e.getIncomingStableRequestMetricAttributesOnResponse=e=>{const t={};return void 0!==e[n.ATTR_HTTP_ROUTE]&&(t[n.ATTR_HTTP_ROUTE]=e[n.ATTR_HTTP_ROUTE]),e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(t[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),t},e.headerCapture=function(e,t){const n=new Map;for(let e=0,r=t.length;e<r;e++){const r=t[e].toLowerCase();n.set(r,r.replace(/-/g,"_"))}return(t,r)=>{for(const s of n.keys()){const o=r(s);if(void 0===o)continue;const i=n.get(s),a=`http.${e}.header.${i}`;"string"==typeof o?t.setAttribute(a,[o]):Array.isArray(o)?t.setAttribute(a,o):t.setAttribute(a,[o])}}};const _=new Set(["GET","HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","TRACE","PATCH"]);function m(e){if(null==e)return"GET";const t=e.toUpperCase();return _.has(t)?t:"_OTHER"}function g(e){try{return l(e)}catch{return[]}}}(US),Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.HttpInstrumentation=void 0;const JS=qt,eT=Qm,tT=i,nT=Jm,rT=DS,sT=l,oT=kS,iT=US;class aT extends rT.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=rT.SemconvStability.OLD;constructor(e={}){super("@opentelemetry/instrumentation-http",nT.VERSION,e),this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,rT.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:JS.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:JS.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(oT.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:JS.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(oT.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:JS.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}_recordServerDuration(e,t,n){this._semconvStability&rT.SemconvStability.OLD&&this._oldHttpServerDurationHistogram.record(e,t),this._semconvStability&rT.SemconvStability.STABLE&&this._stableHttpServerDurationHistogram.record(e/1e3,n)}_recordClientDuration(e,t,n){this._semconvStability&rT.SemconvStability.OLD&&this._oldHttpClientDurationHistogram.record(e,t),this._semconvStability&rT.SemconvStability.STABLE&&this._stableHttpClientDurationHistogram.record(e/1e3,n)}setConfig(e={}){super.setConfig(e),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new rT.InstrumentationNodeModuleDefinition("http",["*"],e=>{const t="Module"===e[Symbol.toStringTag];if(!this.getConfig().disableOutgoingRequestInstrumentation){const n=this._wrap(e,"request",this._getPatchOutgoingRequestFunction("http")),r=this._wrap(e,"get",this._getPatchOutgoingGetFunction(n));t&&(e.default.request=n,e.default.get=r)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(e.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http")),e},e=>{void 0!==e&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(e,"request"),this._unwrap(e,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(e.Server.prototype,"emit"))})}_getHttpsInstrumentation(){return new rT.InstrumentationNodeModuleDefinition("https",["*"],e=>{const t="Module"===e[Symbol.toStringTag];if(!this.getConfig().disableOutgoingRequestInstrumentation){const n=this._wrap(e,"request",this._getPatchHttpsOutgoingRequestFunction("https")),r=this._wrap(e,"get",this._getPatchHttpsOutgoingGetFunction(n));t&&(e.default.request=n,e.default.get=r)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(e.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https")),e},e=>{void 0!==e&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(e,"request"),this._unwrap(e,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(e.Server.prototype,"emit"))})}_getPatchIncomingRequestFunction(e){return t=>this._incomingRequestFunction(e,t)}_getPatchOutgoingRequestFunction(e){return t=>this._outgoingRequestFunction(e,t)}_getPatchOutgoingGetFunction(e){return t=>function(t,...n){const r=e(t,...n);return r.end(),r}}_getPatchHttpsOutgoingRequestFunction(e){return t=>{const n=this;return function(r,...s){return"https"===e&&"object"==typeof r&&"URL"!==r?.constructor?.name&&(r=Object.assign({},r),n._setDefaultOptions(r)),n._getPatchOutgoingRequestFunction(e)(t)(r,...s)}}}_setDefaultOptions(e){e.protocol=e.protocol||"https:",e.port=e.port||443}_getPatchHttpsOutgoingGetFunction(e){return t=>{const n=this;return function(r,...s){return n._getPatchOutgoingGetFunction(e)(t)(r,...s)}}}_traceClientRequest(e,t,n,r,s){this.getConfig().requestHook&&this._callRequestHook(t,e);let o=!1;return e.prependListener("response",i=>{this._diag.debug("outgoingRequest on response()"),e.listenerCount("response")<=1&&i.resume();const a=(0,iT.getOutgoingRequestAttributesOnResponse)(i,this._semconvStability);t.setAttributes(a),r=Object.assign(r,(0,iT.getOutgoingRequestMetricAttributesOnResponse)(a)),s=Object.assign(s,(0,iT.getOutgoingStableRequestMetricAttributesOnResponse)(a)),this.getConfig().responseHook&&this._callResponseHook(t,i),this._headerCapture.client.captureRequestHeaders(t,t=>e.getHeader(t)),this._headerCapture.client.captureResponseHeaders(t,e=>i.headers[e]),JS.context.bind(JS.context.active(),i);i.on("end",()=>{if(this._diag.debug("outgoingRequest on end()"),o)return;let a;o=!0,a=i.aborted&&!i.complete?{code:JS.SpanStatusCode.ERROR}:{code:(0,iT.parseResponseStatus)(JS.SpanKind.CLIENT,i.statusCode)},t.setStatus(a),this.getConfig().applyCustomAttributesOnSpan&&(0,rT.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(t,e,i),()=>{},!0),this._closeHttpSpan(t,JS.SpanKind.CLIENT,n,r,s)}),i.on(sT.errorMonitor,e=>{this._diag.debug("outgoingRequest on error()",e),o||(o=!0,(0,iT.setSpanWithError)(t,e,this._semconvStability),t.setStatus({code:JS.SpanStatusCode.ERROR,message:e.message}),this._closeHttpSpan(t,JS.SpanKind.CLIENT,n,r,s))})}),e.on("close",()=>{this._diag.debug("outgoingRequest on request close()"),e.aborted||o||(o=!0,this._closeHttpSpan(t,JS.SpanKind.CLIENT,n,r,s))}),e.on(sT.errorMonitor,e=>{this._diag.debug("outgoingRequest on request error()",e),o||(o=!0,(0,iT.setSpanWithError)(t,e,this._semconvStability),this._closeHttpSpan(t,JS.SpanKind.CLIENT,n,r,s))}),this._diag.debug("http.ClientRequest return request"),e}_incomingRequestFunction(e,t){const n=this;return function(r,...s){if("request"!==r)return t.apply(this,[r,...s]);const o=s[0],i=s[1],a=o.method||"GET";if(n._diag.debug(`${e} instrumentation incomingRequest`),(0,rT.safeExecuteInTheMiddle)(()=>n.getConfig().ignoreIncomingRequestHook?.(o),e=>{null!=e&&n._diag.error("caught ignoreIncomingRequestHook error: ",e)},!0))return JS.context.with((0,eT.suppressTracing)(JS.context.active()),()=>(JS.context.bind(JS.context.active(),o),JS.context.bind(JS.context.active(),i),t.apply(this,[r,...s])));const c=o.headers,u=(0,iT.getIncomingRequestAttributes)(o,{component:e,serverName:n.getConfig().serverName,hookAttributes:n._callStartSpanHook(o,n.getConfig().startIncomingSpanHook),semconvStability:n._semconvStability,enableSyntheticSourceDetection:n.getConfig().enableSyntheticSourceDetection||!1},n._diag),l={kind:JS.SpanKind.SERVER,attributes:u},p=(0,eT.hrTime)(),d=(0,iT.getIncomingRequestMetricAttributes)(u),h={[oT.ATTR_HTTP_REQUEST_METHOD]:u[oT.ATTR_HTTP_REQUEST_METHOD],[oT.ATTR_URL_SCHEME]:u[oT.ATTR_URL_SCHEME]};u[oT.ATTR_NETWORK_PROTOCOL_VERSION]&&(h[oT.ATTR_NETWORK_PROTOCOL_VERSION]=u[oT.ATTR_NETWORK_PROTOCOL_VERSION]);const f=JS.propagation.extract(JS.ROOT_CONTEXT,c),_=n._startHttpSpan(a,l,f),m={type:eT.RPCType.HTTP,span:_};return JS.context.with((0,eT.setRPCMetadata)(JS.trace.setSpan(f,_),m),()=>{JS.context.bind(JS.context.active(),o),JS.context.bind(JS.context.active(),i),n.getConfig().requestHook&&n._callRequestHook(_,o),n.getConfig().responseHook&&n._callResponseHook(_,i),n._headerCapture.server.captureRequestHeaders(_,e=>o.headers[e]);let e=!1;return i.on("close",()=>{e||n._onServerResponseFinish(o,i,_,d,h,p)}),i.on(sT.errorMonitor,t=>{e=!0,n._onServerResponseError(_,d,h,p,t)}),(0,rT.safeExecuteInTheMiddle)(()=>t.apply(this,[r,...s]),e=>{if(e)throw(0,iT.setSpanWithError)(_,e,n._semconvStability),n._closeHttpSpan(_,JS.SpanKind.SERVER,p,d,h),e})})}}_outgoingRequestFunction(e,t){const n=this;return function(r,...s){if(!(0,iT.isValidOptionsType)(r))return t.apply(this,[r,...s]);const o="object"==typeof s[0]&&("string"==typeof r||r instanceof tT.URL)?s.shift():void 0,{method:i,invalidUrl:a,optionsParsed:c}=(0,iT.getRequestInfo)(n._diag,r,o);if((0,rT.safeExecuteInTheMiddle)(()=>n.getConfig().ignoreOutgoingRequestHook?.(c),e=>{null!=e&&n._diag.error("caught ignoreOutgoingRequestHook error: ",e)},!0))return t.apply(this,[c,...s]);const{hostname:u,port:l}=(0,iT.extractHostnameAndPort)(c),p=(0,iT.getOutgoingRequestAttributes)(c,{component:e,port:l,hostname:u,hookAttributes:n._callStartSpanHook(c,n.getConfig().startOutgoingSpanHook)},n._semconvStability,n.getConfig().enableSyntheticSourceDetection||!1),d=(0,eT.hrTime)(),h=(0,iT.getOutgoingRequestMetricAttributes)(p),f={[oT.ATTR_HTTP_REQUEST_METHOD]:p[oT.ATTR_HTTP_REQUEST_METHOD],[oT.ATTR_SERVER_ADDRESS]:p[oT.ATTR_SERVER_ADDRESS],[oT.ATTR_SERVER_PORT]:p[oT.ATTR_SERVER_PORT]};p[oT.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(f[oT.ATTR_HTTP_RESPONSE_STATUS_CODE]=p[oT.ATTR_HTTP_RESPONSE_STATUS_CODE]),p[oT.ATTR_NETWORK_PROTOCOL_VERSION]&&(f[oT.ATTR_NETWORK_PROTOCOL_VERSION]=p[oT.ATTR_NETWORK_PROTOCOL_VERSION]);const _={kind:JS.SpanKind.CLIENT,attributes:p},m=n._startHttpSpan(i,_),g=JS.context.active(),E=JS.trace.setSpan(g,m);return c.headers?c.headers=Object.assign({},c.headers):c.headers={},JS.propagation.inject(E,c.headers),JS.context.with(E,()=>{const o=s[s.length-1];"function"==typeof o&&(s[s.length-1]=JS.context.bind(g,o));const i=(0,rT.safeExecuteInTheMiddle)(()=>a?t.apply(this,[r,...s]):t.apply(this,[c,...s]),e=>{if(e)throw(0,iT.setSpanWithError)(m,e,n._semconvStability),n._closeHttpSpan(m,JS.SpanKind.CLIENT,d,h,f),e});return n._diag.debug(`${e} instrumentation outgoingRequest`),JS.context.bind(g,i),n._traceClientRequest(i,m,d,h,f)})}}_onServerResponseFinish(e,t,n,r,s,o){const i=(0,iT.getIncomingRequestAttributesOnResponse)(e,t,this._semconvStability);r=Object.assign(r,(0,iT.getIncomingRequestMetricAttributesOnResponse)(i)),s=Object.assign(s,(0,iT.getIncomingStableRequestMetricAttributesOnResponse)(i)),this._headerCapture.server.captureResponseHeaders(n,e=>t.getHeader(e)),n.setAttributes(i).setStatus({code:(0,iT.parseResponseStatus)(JS.SpanKind.SERVER,t.statusCode)});const a=i[oT.ATTR_HTTP_ROUTE];a&&n.updateName(`${e.method||"GET"} ${a}`),this.getConfig().applyCustomAttributesOnSpan&&(0,rT.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(n,e,t),()=>{},!0),this._closeHttpSpan(n,JS.SpanKind.SERVER,o,r,s)}_onServerResponseError(e,t,n,r,s){(0,iT.setSpanWithError)(e,s,this._semconvStability),this._closeHttpSpan(e,JS.SpanKind.SERVER,r,t,n)}_startHttpSpan(e,t,n=JS.context.active()){const r=t.kind===JS.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans;let s;const o=JS.trace.getSpan(n);return s=!0===r&&void 0===o?JS.trace.wrapSpanContext(JS.INVALID_SPAN_CONTEXT):!0===r&&o?.spanContext().isRemote?o:this.tracer.startSpan(e,t,n),this._spanNotEnded.add(s),s}_closeHttpSpan(e,t,n,r,s){if(!this._spanNotEnded.has(e))return;e.end(),this._spanNotEnded.delete(e);const o=(0,eT.hrTimeToMilliseconds)((0,eT.hrTimeDuration)(n,(0,eT.hrTime)()));t===JS.SpanKind.SERVER?this._recordServerDuration(o,r,s):t===JS.SpanKind.CLIENT&&this._recordClientDuration(o,r,s)}_callResponseHook(e,t){(0,rT.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(e,t),()=>{},!0)}_callRequestHook(e,t){(0,rT.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(e,t),()=>{},!0)}_callStartSpanHook(e,t){if("function"==typeof t)return(0,rT.safeExecuteInTheMiddle)(()=>t(e),()=>{},!0)}_createHeaderCapture(){const e=this.getConfig();return{client:{captureRequestHeaders:(0,iT.headerCapture)("request",e.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,iT.headerCapture)("response",e.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,iT.headerCapture)("request",e.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,iT.headerCapture)("response",e.headersToSpanAttributes?.server?.responseHeaders??[])}}}}Yt.HttpInstrumentation=aT,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpInstrumentation=void 0;var t=Yt;Object.defineProperty(e,"HttpInstrumentation",{enumerable:!0,get:function(){return t.HttpInstrumentation}})}(Ft);const cT="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,uT=globalThis,lT="10.8.0";function pT(){return dT(uT),uT}function dT(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||lT,t[lT]=t[lT]||{}}function hT(e,t,n=uT){const r=n.__SENTRY__=n.__SENTRY__||{},s=r[lT]=r[lT]||{};return s[e]||(s[e]=t())}const fT=["debug","info","warn","error","log","assert","trace"],_T={};function mT(e){if(!("console"in uT))return e();const t=uT.console,n={},r=Object.keys(_T);r.forEach(e=>{const r=_T[e];n[e]=t[e],t[e]=r});try{return e()}finally{r.forEach(e=>{t[e]=n[e]})}}function gT(){return ST().enabled}function ET(e,...t){cT&&gT()&&mT(()=>{uT.console[e](`Sentry Logger [${e}]:`,...t)})}function ST(){return cT?hT("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const TT={enable:function(){ST().enabled=!0},disable:function(){ST().enabled=!1},isEnabled:gT,log:function(...e){ET("log",...e)},warn:function(...e){ET("warn",...e)},error:function(...e){ET("error",...e)}},yT=/\(error: (.*)\)/,AT=/captureMessage|captureException/;function vT(...e){const t=e.sort((e,t)=>e[0]-t[0]).map(e=>e[1]);return(e,n=0,r=0)=>{const s=[],o=e.split("\n");for(let e=n;e<o.length;e++){let n=o[e];n.length>1024&&(n=n.slice(0,1024));const i=yT.test(n)?n.replace(yT,"$1"):n;if(!i.match(/\S*Error: /)){for(const e of t){const t=e(i);if(t){s.push(t);break}}if(s.length>=50+r)break}}return function(e){if(!e.length)return[];const t=Array.from(e);/sentryWrapped/.test(RT(t).function||"")&&t.pop();t.reverse(),AT.test(RT(t).function||"")&&(t.pop(),AT.test(RT(t).function||"")&&t.pop());return t.slice(0,50).map(e=>({...e,filename:e.filename||RT(t).filename,function:e.function||"?"}))}(s.slice(r))}}function bT(e){return Array.isArray(e)?vT(...e):e}function RT(e){return e[e.length-1]||{}}const OT="<anonymous>";function NT(e){try{return e&&"function"==typeof e&&e.name||OT}catch{return OT}}const CT={},IT={};function PT(e,t){CT[e]=CT[e]||[],CT[e].push(t)}function MT(e,t){if(!IT[e]){IT[e]=!0;try{t()}catch(t){cT&&TT.error(`Error while instrumenting ${e}`,t)}}}function wT(e,t){const n=e&&CT[e];if(n)for(const r of n)try{r(t)}catch(t){cT&&TT.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${NT(r)}\nError:`,t)}}let LT=null;function xT(){LT=uT.onerror,uT.onerror=function(e,t,n,r,s){return wT("error",{column:r,error:s,line:n,msg:e,url:t}),!!LT&&LT.apply(this,arguments)},uT.onerror.__SENTRY_INSTRUMENTED__=!0}let DT=null;function kT(){DT=uT.onunhandledrejection,uT.onunhandledrejection=function(e){return wT("unhandledrejection",e),!DT||DT.apply(this,arguments)},uT.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const UT=Object.prototype.toString;function $T(e){switch(UT.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return YT(e,Error)}}function GT(e,t){return UT.call(e)===`[object ${t}]`}function jT(e){return GT(e,"String")}function VT(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function HT(e){return null===e||VT(e)||"object"!=typeof e&&"function"!=typeof e}function BT(e){return GT(e,"Object")}function FT(e){return Boolean(e?.then&&"function"==typeof e.then)}function YT(e,t){try{return e instanceof t}catch{return!1}}function qT(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}const KT=uT;function WT(e,t){const n=e,r=[];if(!n?.tagName)return"";if(KT.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const s=t?.length?t.filter(e=>n.getAttribute(e)).map(e=>[e,n.getAttribute(e)]):null;if(s?.length)s.forEach(e=>{r.push(`[${e[0]}="${e[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&jT(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const o=["aria-label","type","name","title","alt"];for(const e of o){const t=n.getAttribute(e);t&&r.push(`[${e}="${t}"]`)}return r.join("")}function ZT(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function XT(e,t,n=!1){return!!jT(e)&&(GT(t,"RegExp")?t.test(e):!!jT(t)&&(n?e===t:e.includes(t)))}function zT(e,t=[],n=!1){return t.some(t=>XT(e,t,n))}function QT(e,t,n){if(!(t in e))return;const r=e[t];if("function"!=typeof r)return;const s=n(r);"function"==typeof s&&function(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,JT(e,"__sentry_original__",t)}catch{}}(s,r);try{e[t]=s}catch{cT&&TT.log(`Failed to replace method "${t}" in object`,e)}}function JT(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{cT&&TT.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function ey(e){if($T(e))return{message:e.message,name:e.name,stack:e.stack,...ny(e)};if(t=e,"undefined"!=typeof Event&&YT(t,Event)){const t={type:e.type,target:ty(e.target),currentTarget:ty(e.currentTarget),...ny(e)};return"undefined"!=typeof CustomEvent&&YT(e,CustomEvent)&&(t.detail=e.detail),t}return e;var t}function ty(e){try{return t=e,"undefined"!=typeof Element&&YT(t,Element)?function(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,s=[];let o=0,i=0;const a=" > ",c=a.length;let u;const l=Array.isArray(t)?t:t.keyAttrs,p=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&o++<r&&(u=WT(n,l),!("html"===u||o>1&&i+s.length*c+u.length>=p));)s.push(u),i+=u.length,n=n.parentNode;return s.reverse().join(a)}catch{return"<unknown>"}}(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}var t}function ny(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function ry(e=function(){const e=uT;return e.crypto||e.msCrypto}()){let t=()=>16*Math.random();try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"");e?.getRandomValues&&(t=()=>{const t=new Uint8Array(1);return e.getRandomValues(t),t[0]})}catch{}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,e=>(e^(15&t())>>e/4).toString(16))}function sy(e){return e.exception?.values?.[0]}function oy(e){const{message:t,event_id:n}=e;if(t)return t;const r=sy(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function iy(e,t){const n=sy(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r?.data,...t.data};n.mechanism.data=e}}const ay=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function cy(e){return parseInt(e||"",10)}function uy(e){if(function(e){try{return e.__sentry_captured__}catch{}}(e))return!0;try{JT(e,"__sentry_captured__",!0)}catch{}return!1}function ly(){return Date.now()/1e3}let py;function dy(){return(py??(py=function(){const{performance:e}=uT;if(!e?.now||!e.timeOrigin)return ly;const t=e.timeOrigin;return()=>(t+e.now())/1e3}()))()}function hy(e){const t=dy(),n={sid:ry(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(e){return{sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}(n)};return e&&fy(n,e),n}function fy(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||dy(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:ry()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function _y(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&0===Object.keys(t).length)return e;const r={...e};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=_y(r[e],t[e],n-1));return r}function my(){return ry()}function gy(){return ry().substring(16)}const Ey="_sentrySpan";function Sy(e,t){t?JT(e,Ey,t):delete e[Ey]}function Ty(e){return e[Ey]}class yy{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:my(),sampleRand:Math.random()}}clone(){const e=new yy;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Sy(e,Ty(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&fy(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,n=t instanceof yy?t.getScopeData():BT(t)?e:void 0,{tags:r,extra:s,user:o,contexts:i,level:a,fingerprint:c=[],propagationContext:u}=n||{};return this._tags={...this._tags,...r},this._extra={...this._extra,...s},this._contexts={...this._contexts,...i},o&&Object.keys(o).length&&(this._user=o),a&&(this._level=a),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Sy(this,void 0),this._attachments=[],this.setPropagationContext({traceId:my(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:ly(),...e,message:e.message?ZT(e.message,2048):e.message};return this._breadcrumbs.push(r),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Ty(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=_y(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t?.event_id||ry();if(!this._client)return cT&&TT.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n?.event_id||ry();if(!this._client)return cT&&TT.warn("No client configured on scope - will not capture message!"),r;const s=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:s,...n,event_id:r},this),r}captureEvent(e,t){const n=t?.event_id||ry();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(cT&&TT.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function Ay(){return hT("defaultCurrentScope",()=>new yy)}function vy(){return hT("defaultIsolationScope",()=>new yy)}class by{constructor(e,t){let n,r;n=e||new yy,r=t||new yy,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(e){throw this._popScope(),e}return FT(n)?n.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function Ry(){const e=dT(pT());return e.stack=e.stack||new by(Ay(),vy())}function Oy(e){return Ry().withScope(e)}function Ny(e,t){const n=Ry();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function Cy(e){return Ry().withScope(()=>e(Ry().getIsolationScope()))}function Iy(e){const t=dT(e);return t.acs?t.acs:{withIsolationScope:Cy,withScope:Oy,withSetScope:Ny,withSetIsolationScope:(e,t)=>Cy(t),getCurrentScope:()=>Ry().getScope(),getIsolationScope:()=>Ry().getIsolationScope()}}function Py(){return Iy(pT()).getCurrentScope()}function My(){return Iy(pT()).getIsolationScope()}function wy(...e){const t=Iy(pT());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function Ly(){return Py().getClient()}function xy(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:s}=t,o={trace_id:n,span_id:s||gy()};return r&&(o.parent_span_id=r),o}const Dy="sentry.source",ky="sentry.sample_rate",Uy="sentry.op",$y="sentry.origin",Gy="sentry.custom_span_name",jy="sentry.profile_id",Vy="sentry.exclusive_time",Hy="cache.key";const By="_sentryScope",Fy="_sentryIsolationScope";function Yy(e,t,n){e&&(JT(e,Fy,n),JT(e,By,t))}function qy(e){return{scope:e[By],isolationScope:e[Fy]}}const Ky="sentry-",Wy=/^sentry-/;function Zy(e){const t=zy(e);if(!t)return;const n=Object.entries(t).reduce((e,[t,n])=>{if(t.match(Wy)){e[t.slice(7)]=n}return e},{});return Object.keys(n).length>0?n:void 0}function Xy(e){if(!e)return;return Jy(Object.entries(e).reduce((e,[t,n])=>(n&&(e[`${Ky}${t}`]=n),e),{}))}function zy(e){if(e&&(jT(e)||Array.isArray(e)))return Array.isArray(e)?e.reduce((e,t)=>{const n=Qy(t);return Object.entries(n).forEach(([t,n])=>{e[t]=n}),e},{}):Qy(e)}function Qy(e){return e.split(",").map(e=>e.split("=").map(e=>{try{return decodeURIComponent(e.trim())}catch{return}})).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{})}function Jy(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce((e,[t,n],r)=>{const s=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,o=0===r?s:`${e},${s}`;return o.length>8192?(cT&&TT.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):o},"")}const eA=/^o(\d+)\./,tA=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function nA(e,t=!1){const{host:n,path:r,pass:s,port:o,projectId:i,protocol:a,publicKey:c}=e;return`${a}://${c}${t&&s?`:${s}`:""}@${n}${o?`:${o}`:""}/${r?`${r}/`:r}${i}`}function rA(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function sA(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=function(e){const t=e.match(eA);return t?.[1]}(n)),r}function oA(e){const t="string"==typeof e?function(e){const t=tA.exec(e);if(!t)return void mT(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});const[n,r,s="",o="",i="",a=""]=t.slice(1);let c="",u=a;const l=u.split("/");if(l.length>1&&(c=l.slice(0,-1).join("/"),u=l.pop()),u){const e=u.match(/^\d+/);e&&(u=e[0])}return rA({host:o,pass:s,path:c,projectId:u,port:i,protocol:n,publicKey:r})}(e):rA(e);if(t&&function(e){if(!cT)return!0;const{port:t,projectId:n,protocol:r}=e;return!(["protocol","publicKey","host","projectId"].find(t=>!e[t]&&(TT.error(`Invalid Sentry Dsn: ${t} missing`),!0))||(n.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(r)?t&&isNaN(parseInt(t,10))&&(TT.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(TT.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(TT.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(t))return t}function iA(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;return"number"!=typeof t||isNaN(t)||t<0||t>1?void 0:t}const aA=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function cA(e,t){const n=function(e){if(!e)return;const t=e.match(aA);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}(e),r=Zy(t);if(!n?.traceId)return{traceId:my(),sampleRand:Math.random()};const s=function(e,t){const n=iA(t?.sample_rand);if(void 0!==n)return n;const r=iA(t?.sample_rate);return r&&void 0!==e?.parentSampled?e.parentSampled?Math.random()*r:r+Math.random()*(1-r):Math.random()}(n,r);r&&(r.sample_rand=s.toString());const{traceId:o,parentSpanId:i,parentSampled:a}=n;return{traceId:o,parentSpanId:i,sampled:a,dsc:r||{},sampleRand:s}}function uA(e=my(),t=gy(),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}let lA=!1;function pA(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:s,parent_span_id:o,status:i,origin:a,links:c}=mA(e);return{parent_span_id:o,span_id:t,trace_id:n,data:r,op:s,status:i,origin:a,links:c}}function dA(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),s=r?t:mA(e).parent_span_id,o=qy(e).scope;return{parent_span_id:s,span_id:r?o?.getPropagationContext().propagationSpanId||gy():t,trace_id:n}}function hA(e){return e&&e.length>0?e.map(({context:{spanId:e,traceId:t,traceFlags:n,...r},attributes:s})=>({span_id:e,trace_id:t,sampled:1===n,attributes:s,...r})):void 0}function fA(e){return"number"==typeof e?_A(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?_A(e.getTime()):dy()}function _A(e){return e>9999999999?e/1e3:e}function mA(e){if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:r,startTime:s,name:o,endTime:i,status:a,links:c}=e;return{span_id:t,trace_id:n,data:r,description:o,parent_span_id:"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0,start_timestamp:fA(s),timestamp:fA(i)||void 0,status:EA(a),op:r[Uy],origin:r[$y],links:hA(c)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function gA(e){const{traceFlags:t}=e.spanContext();return 1===t}function EA(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"unknown_error"}const SA="_sentryChildSpans",TA="_sentryRootSpan";function yA(e,t){const n=e[TA]||e;JT(t,TA,n),e[SA]?e[SA].add(t):JT(e,SA,new Set([t]))}function AA(e){return e[TA]||e}function vA(){const e=Iy(pT());return e.getActiveSpan?e.getActiveSpan():Ty(Py())}function bA(){lA||(mT(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly.")}),lA=!0)}let RA=!1;function OA(){function e(){const e=vA(),t=e&&AA(e);if(t){const e="internal_error";cT&&TT.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}RA||(e.tag="sentry_tracingErrorCallback",RA=!0,function(e){const t="error";PT(t,e),MT(t,xT)}(e),function(e){const t="unhandledrejection";PT(t,e),MT(t,kT)}(e))}function NA(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=e||Ly()?.getOptions();return!(!t||null==t.tracesSampleRate&&!t.tracesSampler)}const CA="production",IA="_frozenDsc";function PA(e,t){JT(e,IA,t)}function MA(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},s={environment:n.environment||CA,release:n.release,public_key:r,trace_id:e,org_id:sA(t)};return t.emit("createDsc",s),s}function wA(e,t){const n=t.getPropagationContext();return n.dsc||MA(n.traceId,e)}function LA(e){const t=Ly();if(!t)return{};const n=AA(e),r=mA(n),s=r.data,o=n.spanContext().traceState,i=o?.get("sentry.sample_rate")??s[ky]??s["sentry.previous_trace_sample_rate"];function a(e){return"number"!=typeof i&&"string"!=typeof i||(e.sample_rate=`${i}`),e}const c=n[IA];if(c)return a(c);const u=o?.get("sentry.dsc"),l=u&&Zy(u);if(l)return a(l);const p=MA(e.spanContext().traceId,t),d=s[Dy],h=r.description;return"url"!==d&&h&&(p.transaction=h),NA()&&(p.sampled=String(gA(n)),p.sample_rand=o?.get("sentry.sample_rand")??qy(n).scope?.getPropagationContext().sampleRand.toString()),a(p),t.emit("createDsc",p,n),p}class xA{constructor(e={}){this._traceId=e.traceId||my(),this._spanId=e.spanId||gy()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function DA(e,t=100,n=1/0){try{return UA("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function kA(e,t=3,n=102400){const r=DA(e,t);return s=r,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(s))>n?kA(e,t-1,n):r;var s}function UA(e,t,n=1/0,r=1/0,s=function(){const e=new WeakSet;function t(t){return!!e.has(t)||(e.add(t),!1)}function n(t){e.delete(t)}return[t,n]}()){const[o,i]=s;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const a=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(qT(t))return"[VueViewModel]";if(BT(n=t)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${NT(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const r=function(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(e){return`**non-serializable** (${e})`}var n}(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const c="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===c)return a.replace("object ","");if(o(t))return"[Circular ~]";const u=t;if(u&&"function"==typeof u.toJSON)try{return UA("",u.toJSON(),c-1,r,s)}catch{}const l=Array.isArray(t)?[]:{};let p=0;const d=ey(t);for(const e in d){if(!Object.prototype.hasOwnProperty.call(d,e))continue;if(p>=r){l[e]="[MaxProperties ~]";break}const t=d[e];l[e]=UA(e,t,c-1,r,s),p++}return i(t),l}function $A(e,t=[]){return[e,t]}function GA(e,t){const[n,r]=e;return[n,[...r,t]]}function jA(e,t){const n=e[1];for(const e of n){if(t(e,e[0].type))return!0}return!1}function VA(e){const t=dT(uT);return t.encodePolyfill?t.encodePolyfill(e):(new TextEncoder).encode(e)}function HA(e){const[t,n]=e;let r=JSON.stringify(t);function s(e){"string"==typeof r?r="string"==typeof e?r+e:[VA(r),e]:r.push("string"==typeof e?VA(e):e)}for(const e of n){const[t,n]=e;if(s(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)s(n);else{let e;try{e=JSON.stringify(n)}catch{e=JSON.stringify(DA(n))}s(e)}}return"string"==typeof r?r:function(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}(r)}function BA(e){return[{type:"span"},e]}function FA(e){const t="string"==typeof e.data?VA(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const YA={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item"};function qA(e){return YA[e]}function KA(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function WA(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(XA(n)){if(XT(e.description,n))return!0;continue}if(!n.name&&!n.op)continue;const t=!n.name||XT(e.description,n.name),r=!n.op||e.op&&XT(e.op,n.op);if(t&&r)return!0}return!1}function ZA(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const t of e)t.parent_span_id===r&&(t.parent_span_id=n)}function XA(e){return"string"==typeof e||e instanceof RegExp}function zA(e,t,n,r){const s=KA(n),o=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){if(!t)return e;const n=e.sdk||{};e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0}}(e,n?.sdk);const i=function(e,t,n,r){const s=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:nA(r)},...s&&{trace:s}}}(e,s,r,t);delete e.sdkProcessingMetadata;return $A(i,[[{type:o},e]])}function QA(e){if(!cT)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=mA(e),{spanId:s}=e.spanContext(),o=gA(e),i=AA(e),a=i===e,c=`[Tracing] Starting ${o?"sampled":"unsampled"} ${a?"root ":""}span`,u=[`op: ${n}`,`name: ${t}`,`ID: ${s}`];if(r&&u.push(`parent ID: ${r}`),!a){const{op:e,description:t}=mA(i);u.push(`root ID: ${i.spanContext().spanId}`),e&&u.push(`root op: ${e}`),t&&u.push(`root description: ${t}`)}TT.log(`${c}\n  ${u.join("\n  ")}`)}function JA(e){if(!cT)return;const{description:t="< unknown name >",op:n="< unknown op >"}=mA(e),{spanId:r}=e.spanContext(),s=`[Tracing] Finishing "${n}" ${AA(e)===e?"root ":""}span "${t}" with ID ${r}`;TT.log(s)}function ev(e){if(!e||0===e.length)return;const t={};return e.forEach(e=>{const n=e.attributes||{},r=n["sentry.measurement_unit"],s=n["sentry.measurement_value"];"string"==typeof r&&"number"==typeof s&&(t[e.name]={value:s,unit:r})}),t}class tv{constructor(e={}){this._traceId=e.traceId||my(),this._spanId=e.spanId||gy(),this._startTime=e.startTimestamp||dy(),this._links=e.links,this._attributes={},this.setAttributes({[$y]:"manual",[Uy]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this._links?this._links.push(e):this._links=[e],this}addLinks(e){return this._links?this._links.push(...e):this._links=e,this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=fA(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Dy,"custom"),this}end(e){this._endTime||(this._endTime=fA(e),JA(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[Uy],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:EA(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[$y],profile_id:this._attributes[jy],exclusive_time:this._attributes[Vy],measurements:ev(this._events),is_segment:this._isStandaloneSpan&&AA(this)===this||void 0,segment_id:this._isStandaloneSpan?AA(this).spanContext().spanId:void 0,links:hA(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){cT&&TT.log("[Tracing] Adding an event to span:",e);const r=nv(t)?t:n||dy(),s=nv(t)?{}:t||{},o={name:e,time:fA(r),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=Ly();e&&e.emit("spanEnd",this);if(!(this._isStandaloneSpan||this===AA(this)))return;if(this._isStandaloneSpan)return void(this._sampled?function(e){const t=Ly();if(!t)return;const n=e[1];if(!n||0===n.length)return void t.recordDroppedEvent("before_send","span");t.sendEnvelope(e)}(function(e,t){const n=LA(e[0]),r=t?.getDsn(),s=t?.getOptions().tunnel,o={sent_at:(new Date).toISOString(),...function(e){return!!e.trace_id&&!!e.public_key}(n)&&{trace:n},...!!s&&r&&{dsn:nA(r)}},{beforeSendSpan:i,ignoreSpans:a}=t?.getOptions()||{},c=a?.length?e.filter(e=>!WA(mA(e),a)):e,u=e.length-c.length;u&&t?.recordDroppedEvent("before_send","span",u);const l=i?e=>{const t=mA(e);return i(t)||(bA(),t)}:mA,p=[];for(const e of c){const t=l(e);t&&p.push(BA(t))}return $A(o,p)}([this],e)):(cT&&TT.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();if(t){(qy(this).scope||Py()).captureEvent(t)}}_convertSpanToTransaction(){if(!rv(mA(this)))return;this._name||(cT&&TT.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=qy(this),n=e?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(!0!==this._sampled)return;const r=function(e){const t=new Set;return function e(n){if(!t.has(n)&&gA(n)){t.add(n);const r=n[SA]?Array.from(n[SA]):[];for(const t of r)e(t)}}(e),Array.from(t)}(this).filter(e=>e!==this&&!function(e){return e instanceof tv&&e.isStandaloneSpan()}(e)).map(e=>mA(e)).filter(rv),s=this._attributes[Dy];delete this._attributes[Gy],r.forEach(e=>{delete e.data[Gy]});const o={contexts:{trace:pA(this)},spans:r.length>1e3?r.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,1e3):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,dynamicSamplingContext:LA(this)},request:n,...s&&{transaction_info:{source:s}}},i=ev(this._events);return i&&Object.keys(i).length&&(cT&&TT.log("[Measurements] Adding measurements to transaction event",JSON.stringify(i,void 0,2)),o.measurements=i),o}}function nv(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function rv(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function sv(e,t,n=()=>{}){let r;try{r=e()}catch(e){throw t(e),n(),e}return function(e,t,n){if(FT(e))return e.then(e=>(n(),e),e=>{throw t(e),n(),e});return n(),e}(r,t,n)}function ov(e,t,n){if(!NA(e))return[!1];let r,s;"function"==typeof e.tracesSampler?(s=e.tracesSampler({...t,inheritOrSampleWith:e=>"number"==typeof t.parentSampleRate?t.parentSampleRate:"boolean"==typeof t.parentSampled?Number(t.parentSampled):e}),r=!0):void 0!==t.parentSampled?s=t.parentSampled:void 0!==e.tracesSampleRate&&(s=e.tracesSampleRate,r=!0);const o=iA(s);if(void 0===o)return cT&&TT.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(s)} of type ${JSON.stringify(typeof s)}.`),[!1];if(!o)return cT&&TT.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,o,r];const i=n<o;return i||cT&&TT.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(s)})`),[i,o,r]}const iv="__SENTRY_SUPPRESS_TRACING__";function av(e,t){const n=hv();if(n.startSpan)return n.startSpan(e,t);const r=dv(e),{forceTransaction:s,parentSpan:o,scope:i}=e,a=i?.clone();return wy(a,()=>mv(o)(()=>{const n=Py(),i=_v(n,o),a=e.onlyIfParent&&!i?new xA:pv({parentSpan:i,spanArguments:r,forceTransaction:s,scope:n});return Sy(n,a),sv(()=>t(a),()=>{const{status:e}=mA(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})},()=>{a.end()})}))}function cv(e,t){const n=hv();if(n.startSpanManual)return n.startSpanManual(e,t);const r=dv(e),{forceTransaction:s,parentSpan:o,scope:i}=e,a=i?.clone();return wy(a,()=>mv(o)(()=>{const n=Py(),i=_v(n,o),a=e.onlyIfParent&&!i?new xA:pv({parentSpan:i,spanArguments:r,forceTransaction:s,scope:n});return Sy(n,a),sv(()=>t(a,()=>a.end()),()=>{const{status:e}=mA(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})})}))}function uv(e,t){const n=hv();return n.withActiveSpan?n.withActiveSpan(e,t):wy(n=>(Sy(n,e||void 0),t(n)))}function lv(e){const t=hv();return t.suppressTracing?t.suppressTracing(e):wy(t=>{t.setSDKProcessingMetadata({[iv]:!0});const n=e();return t.setSDKProcessingMetadata({[iv]:void 0}),n})}function pv({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!NA()){const r=new xA;if(n||!e){PA(r,{sampled:"false",sample_rate:"0",transaction:t.name,...LA(r)})}return r}const s=My();let o;if(e&&!n)o=function(e,t,n){const{spanId:r,traceId:s}=e.spanContext(),o=!t.getScopeData().sdkProcessingMetadata[iv]&&gA(e),i=o?new tv({...n,parentSpanId:r,traceId:s,sampled:o}):new xA({traceId:s});yA(e,i);const a=Ly();a&&(a.emit("spanStart",i),n.endTimestamp&&a.emit("spanEnd",i));return i}(e,r,t),yA(e,o);else if(e){const n=LA(e),{traceId:s,spanId:i}=e.spanContext(),a=gA(e);o=fv({traceId:s,parentSpanId:i,...t},r,a),PA(o,n)}else{const{traceId:e,dsc:n,parentSpanId:i,sampled:a}={...s.getPropagationContext(),...r.getPropagationContext()};o=fv({traceId:e,parentSpanId:i,...t},r,a),n&&PA(o,n)}return QA(o),Yy(o,r,s),o}function dv(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=fA(e.startTime),delete n.startTime,n}return t}function hv(){return Iy(pT())}function fv(e,t,n){const r=Ly(),s=r?.getOptions()||{},{name:o=""}=e,i={spanAttributes:{...e.attributes},spanName:o,parentSampled:n};r?.emit("beforeSampling",i,{decision:!1});const a=i.parentSampled??n,c=i.spanAttributes,u=t.getPropagationContext(),[l,p,d]=t.getScopeData().sdkProcessingMetadata[iv]?[!1]:ov(s,{name:o,parentSampled:a,attributes:c,parentSampleRate:iA(u.dsc?.sample_rate)},u.sampleRand),h=new tv({...e,attributes:{[Dy]:"custom",[ky]:void 0!==p&&d?p:void 0,...c},sampled:l});return!l&&r&&(cT&&TT.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",h),h}function _v(e,t){if(t)return t;if(null===t)return;const n=Ty(e);if(!n)return;const r=Ly();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?AA(n):n}function mv(e){return void 0!==e?t=>uv(e,t):e=>e()}function gv(e){return new Sv(t=>{t(e)})}function Ev(e){return new Sv((t,n)=>{n(e)})}class Sv{constructor(e){this._state=0,this._handlers=[],this._runExecutor(e)}then(e,t){return new Sv((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()})}catch(e){return this.then(e=>e,e)}finally(e){return new Sv((t,n)=>{let r,s;return this.then(t=>{s=!1,r=t,e&&e()},t=>{s=!0,r=t,e&&e()}).then(()=>{s?n(r):t(r)})})}_executeHandlers(){if(0===this._state)return;const e=this._handlers.slice();this._handlers=[],e.forEach(e=>{e[0]||(1===this._state&&e[1](this._value),2===this._state&&e[2](this._value),e[0]=!0)})}_runExecutor(e){const t=(e,t)=>{0===this._state&&(FT(t)?t.then(n,r):(this._state=e,this._value=t,this._executeHandlers()))},n=e=>{t(1,e)},r=e=>{t(2,e)};try{e(n,r)}catch(e){r(e)}}}function Tv(e,t,n,r=0){return new Sv((s,o)=>{const i=e[r];if(null===t||"function"!=typeof i)s(t);else{const a=i({...t},n);cT&&i.id&&null===a&&TT.log(`Event processor "${i.id}" dropped event`),FT(a)?a.then(t=>Tv(e,t,n,r+1).then(s)).then(null,o):Tv(e,a,n,r+1).then(s).then(null,o)}})}function yv(e,t){const{fingerprint:n,span:r,breadcrumbs:s,sdkProcessingMetadata:o}=t;!function(e,t){const{extra:n,tags:r,user:s,contexts:o,level:i,transactionName:a}=t;Object.keys(n).length&&(e.extra={...n,...e.extra});Object.keys(r).length&&(e.tags={...r,...e.tags});Object.keys(s).length&&(e.user={...s,...e.user});Object.keys(o).length&&(e.contexts={...o,...e.contexts});i&&(e.level=i);a&&"transaction"!==e.type&&(e.transaction=a)}(e,t),r&&function(e,t){e.contexts={trace:dA(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:LA(t),...e.sdkProcessingMetadata};const n=AA(t),r=mA(n).description;r&&!e.transaction&&"transaction"===e.type&&(e.transaction=r)}(e,r),function(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t));e.fingerprint.length||delete e.fingerprint}(e,n),function(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}(e,s),function(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}(e,o)}function Av(e,t){const{extra:n,tags:r,user:s,contexts:o,level:i,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:u,eventProcessors:l,attachments:p,propagationContext:d,transactionName:h,span:f}=t;vv(e,"extra",n),vv(e,"tags",r),vv(e,"user",s),vv(e,"contexts",o),e.sdkProcessingMetadata=_y(e.sdkProcessingMetadata,a,2),i&&(e.level=i),h&&(e.transactionName=h),f&&(e.span=f),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),u.length&&(e.fingerprint=[...e.fingerprint,...u]),l.length&&(e.eventProcessors=[...e.eventProcessors,...l]),p.length&&(e.attachments=[...e.attachments,...p]),e.propagationContext={...e.propagationContext,...d}}function vv(e,t,n){e[t]=_y(e[t],n,1)}let bv,Rv,Ov;function Nv(e,t,n,r,s,o){const{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=e,c={...t,event_id:t.event_id||n.event_id||ry(),timestamp:t.timestamp||ly()},u=n.integrations||e.integrations.map(e=>e.name);!function(e,t){const{environment:n,release:r,dist:s,maxValueLength:o=250}=t;e.environment=e.environment||n||CA,!e.release&&r&&(e.release=r);!e.dist&&s&&(e.dist=s);const i=e.request;i?.url&&(i.url=ZT(i.url,o))}(c,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(c,u),s&&s.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){const n=function(e){const t=uT._sentryDebugIds;if(!t)return{};const n=Object.keys(t);return Ov&&n.length===Rv||(Rv=n.length,Ov=n.reduce((n,r)=>{bv||(bv={});const s=bv[r];if(s)n[s[0]]=s[1];else{const s=e(r);for(let e=s.length-1;e>=0;e--){const o=s[e],i=o?.filename,a=t[r];if(i&&a){n[i]=a,bv[r]=[i,a];break}}}return n},{})),Ov}(t);e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.filename&&(e.debug_id=n[e.filename])})})}(c,e.stackParser);const l=function(e,t){if(!t)return e;const n=e?e.clone():new yy;return n.update(t),n}(r,n.captureContext);n.mechanism&&iy(c,n.mechanism);const p=s?s.getEventProcessors():[],d=hT("globalScope",()=>new yy).getScopeData();if(o){Av(d,o.getScopeData())}if(l){Av(d,l.getScopeData())}const h=[...n.attachments||[],...d.attachments];h.length&&(n.attachments=h),yv(c,d);return Tv([...p,...d.eventProcessors],c,n).then(e=>(e&&function(e){const t={};if(e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)})}),0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})})}(e),"number"==typeof i&&i>0?function(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(e=>({...e,...e.data&&{data:DA(e.data,t,n)}}))},...e.user&&{user:DA(e.user,t,n)},...e.contexts&&{contexts:DA(e.contexts,t,n)},...e.extra&&{extra:DA(e.extra,t,n)}};e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=DA(e.contexts.trace.data,t,n)));e.spans&&(r.spans=e.spans.map(e=>({...e,...e.data&&{data:DA(e.data,t,n)}})));e.contexts?.flags&&r.contexts&&(r.contexts.flags=DA(e.contexts.flags,3,n));return r}(e,i,a):e))}function Cv(e){if(e)return function(e){return e instanceof yy||"function"==typeof e}(e)||function(e){return Object.keys(e).some(e=>Iv.includes(e))}(e)?{captureContext:e}:e}const Iv=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function Pv(e,t){return Py().captureException(e,Cv(t))}function Mv(e,t){return Py().captureEvent(e,t)}function wv(){const e=My(),t=Py().getSession()||e.getSession();t&&function(e,t){let n={};t?n={status:t}:"ok"===e.status&&(n={status:"exited"}),fy(e,n)}(t),function(){const e=My(),t=Ly(),n=e.getSession();n&&t&&t.captureSession(n)}(),e.setSession()}function Lv(e,t,n){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}(e,n)}`}const xv=[];function Dv(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;if(t.forEach(e=>{e.isDefaultInstance=!0}),Array.isArray(n))r=[...t,...n];else if("function"==typeof n){const e=n(t);r=Array.isArray(e)?e:[e]}else r=t;return function(e){const t={};return e.forEach(e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)}),Object.values(t)}(r)}function kv(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function Uv(e,t,n){if(n[t.name])cT&&TT.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===xv.indexOf(t.name)&&"function"==typeof t.setupOnce&&(t.setupOnce(),xv.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",(t,r)=>n(t,r,e))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign((t,r)=>n(t,r,e),{id:t.name});e.addEventProcessor(r)}cT&&TT.log(`Integration installed: ${t.name}`)}}function $v(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}const Gv="Not capturing exception because it's already been captured.",jv="Discarded session because of missing or non-string release",Vv=Symbol.for("SentryInternalError"),Hv=Symbol.for("SentryDoNotSendEventError");function Bv(e){return{message:e,[Vv]:!0}}function Fv(e){return{message:e,[Hv]:!0}}function Yv(e){return!!e&&"object"==typeof e&&Vv in e}function qv(e){return!!e&&"object"==typeof e&&Hv in e}class Kv{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=oA(e.dsn):cT&&TT.warn("No DSN provided, client will not send events."),this._dsn){const t=Lv(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,n){const r=ry();if(uy(e))return cT&&TT.log(Gv),r;const s={event_id:r,...t};return this._process(this.eventFromException(e,s).then(e=>this._captureEvent(e,s,n))),s.event_id}captureMessage(e,t,n,r){const s={event_id:ry(),...n},o=VT(e)?e:String(e),i=HT(e)?this.eventFromMessage(o,t,s):this.eventFromException(e,s);return this._process(i.then(e=>this._captureEvent(e,s,r))),s.event_id}captureEvent(e,t,n){const r=ry();if(t?.originalException&&uy(t.originalException))return cT&&TT.log(Gv),r;const s={event_id:r,...t},o=e.sdkProcessingMetadata||{},i=o.capturedSpanScope,a=o.capturedSpanIsolationScope;return this._process(this._captureEvent(e,s,i||n,a)),s.event_id}captureSession(e){this.sendSession(e),fy(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(n=>t.flush(e).then(e=>n&&e))):gv(!0)}close(e){return this.flush(e).then(e=>(this.getOptions().enabled=!1,this.emit("close"),e))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Uv(this,e,this._integrations),t||kv(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=zA(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=GA(n,FA(e));const r=this.sendEnvelope(n);r&&r.then(t=>this.emit("afterSendEvent",e,t),null)}sendSession(e){const{release:t,environment:n=CA}=this._options;if("aggregates"in e){const r=e.attrs||{};if(!r.release&&!t)return void(cT&&TT.warn(jv));r.release=r.release||t,r.environment=r.environment||n,e.attrs=r}else{if(!e.release&&!t)return void(cT&&TT.warn(jv));e.release=e.release||t,e.environment=e.environment||n}this.emit("beforeSendSession",e);const r=function(e,t,n,r){const s=KA(n);return $A({sent_at:(new Date).toISOString(),...s&&{sdk:s},...!!r&&t&&{dsn:nA(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,t,n=1){if(this._options.sendClientReports){const r=`${e}:${t}`;cT&&TT.log(`Recording outcome: "${r}"${n>1?` (${n} times)`:""}`),this._outcomes[r]=(this._outcomes[r]||0)+n}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach(e=>e(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,e=>(cT&&TT.error("Error while sending envelope:",e),e)):(cT&&TT.error("Transport disabled"),gv({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const n={};return t.forEach(t=>{t&&Uv(e,t,n)}),n}(this,e),kv(this,e)}_updateSessionFromEvent(e,t){let n="fatal"===t.level,r=!1;const s=t.exception?.values;if(s){r=!0;for(const e of s){const t=e.mechanism;if(!1===t?.handled){n=!0;break}}}const o="ok"===e.status;(o&&0===e.errors||o&&n)&&(fy(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Sv(t=>{let n=0;const r=setInterval(()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))},1)})}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r){const s=this.getOptions(),o=Object.keys(this._integrations);return!t.integrations&&o?.length&&(t.integrations=o),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),Nv(s,e,t,n,this,r).then(e=>{if(null===e)return e;this.emit("postprocessEvent",e,t),e.contexts={trace:xy(n),...e.contexts};const r=wA(this,n);return e.sdkProcessingMetadata={dynamicSamplingContext:r,...e.sdkProcessingMetadata},e})}_captureEvent(e,t={},n=Py(),r=My()){return cT&&Wv(e)&&TT.log(`Captured error event \`${$v(e)[0]||"<unknown>"}\``),this._processEvent(e,t,n,r).then(e=>e.event_id,e=>{cT&&(qv(e)?TT.log(e.message):Yv(e)?TT.warn(e.message):TT.warn(e))})}_processEvent(e,t,n,r){const s=this.getOptions(),{sampleRate:o}=s,i=Zv(e),a=Wv(e),c=e.type||"error",u=`before send for type \`${c}\``,l=void 0===o?void 0:iA(o);if(a&&"number"==typeof l&&Math.random()>l)return this.recordDroppedEvent("sample_rate","error"),Ev(Fv(`Discarding event because it's not included in the random sample (sampling rate = ${o})`));const p="replay_event"===c?"replay":c;return this._prepareEvent(e,t,n,r).then(e=>{if(null===e)throw this.recordDroppedEvent("event_processor",p),Fv("An event processor returned `null`, will not send event.");if(t.data&&!0===t.data.__sentry__)return e;const n=function(e,t,n,r){const{beforeSend:s,beforeSendTransaction:o,beforeSendSpan:i,ignoreSpans:a}=t;let c=n;if(Wv(c)&&s)return s(c,r);if(Zv(c)){if(i||a){const t=function(e){const{trace_id:t,parent_span_id:n,span_id:r,status:s,origin:o,data:i,op:a}=e.contexts?.trace??{};return{data:i??{},description:e.transaction,op:a,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:s,timestamp:e.timestamp,trace_id:t??"",origin:o,profile_id:i?.[jy],exclusive_time:i?.[Vy],measurements:e.measurements,is_segment:!0}}(c);if(a?.length&&WA(t,a))return null;if(i){const e=i(t);e?c=_y(n,{type:"transaction",timestamp:(u=e).timestamp,start_timestamp:u.start_timestamp,transaction:u.description,contexts:{trace:{trace_id:u.trace_id,span_id:u.span_id,parent_span_id:u.parent_span_id,op:u.op,status:u.status,origin:u.origin,data:{...u.data,...u.profile_id&&{[jy]:u.profile_id},...u.exclusive_time&&{[Vy]:u.exclusive_time}}}},measurements:u.measurements}):bA()}if(c.spans){const t=[],n=c.spans;for(const e of n)if(a?.length&&WA(e,a))ZA(n,e);else if(i){const n=i(e);n?t.push(n):(bA(),t.push(e))}else t.push(e);const r=c.spans.length-t.length;r&&e.recordDroppedEvent("before_send","span",r),c.spans=t}}if(o){if(c.spans){const e=c.spans.length;c.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return o(c,r)}}var u;return c}(this,s,e,t);return function(e,t){const n=`${t} must return \`null\` or a valid event.`;if(FT(e))return e.then(e=>{if(!BT(e)&&null!==e)throw Bv(n);return e},e=>{throw Bv(`${t} rejected with ${e}`)});if(!BT(e)&&null!==e)throw Bv(n);return e}(n,u)}).then(s=>{if(null===s){if(this.recordDroppedEvent("before_send",p),i){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw Fv(`${u} returned \`null\`, will not send event.`)}const o=n.getSession()||r.getSession();if(a&&o&&this._updateSessionFromEvent(o,s),i){const e=(s.sdkProcessingMetadata?.spanCountBeforeProcessing||0)-(s.spans?s.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const c=s.transaction_info;if(i&&c&&s.transaction!==e.transaction){const e="custom";s.transaction_info={...c,source:e}}return this.sendEvent(s,t),s}).then(null,e=>{if(qv(e)||Yv(e))throw e;throw this.captureException(e,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:e}),Bv(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)})}_process(e){this._numProcessing++,e.then(e=>(this._numProcessing--,e),e=>(this._numProcessing--,e))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}})}_flushOutcomes(){cT&&TT.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(cT&&TT.log("No outcomes to send"));if(!this._dsn)return void(cT&&TT.log("No dsn provided, will not send outcomes"));cT&&TT.log("Sending outcomes:",e);const t=(n=e,$A((r=this._options.tunnel&&nA(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:s||ly(),discarded_events:n}]]));var n,r,s;this.sendEnvelope(t)}}function Wv(e){return void 0===e.type}function Zv(e){return"transaction"===e.type}function Xv(e,t){const n=t??function(e){return zv().get(e)}(e)??[];if(0===n.length)return;const r=e.getOptions(),s=function(e,t,n,r){const s={};return t?.sdk&&(s.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(s.dsn=nA(r)),$A(s,[(o=e,[{type:"log",item_count:o.length,content_type:"application/vnd.sentry.items.log+json"},{items:o}])]);var o}(n,r._metadata,r.tunnel,e.getDsn());zv().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(s)}function zv(){return hT("clientToLogBufferMap",()=>new WeakMap)}function Qv(e,t){return e(t.stack||"",1)}function Jv(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=Qv(e,t);return r.length&&(n.stacktrace={frames:r}),n}function eb(e){if("name"in e&&"string"==typeof e.name){let t=`'${e.name}' captured as exception`;return"message"in e&&"string"==typeof e.message&&(t+=` with message '${e.message}'`),t}if("message"in e&&"string"==typeof e.message)return e.message;const t=function(e,t=40){const n=Object.keys(ey(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return ZT(r,t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:ZT(r,t)}return""}(e);if(GT(e,"ErrorEvent"))return`Event \`ErrorEvent\` captured as exception with message \`${e.message}\``;const n=function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}(e);return`${n&&"Object"!==n?`'${n}'`:"Object"} captured as exception with keys: ${t}`}function tb(e,t,n,r){if($T(n))return[n,void 0];if(t.synthetic=!0,BT(n)){const t=e?.getOptions().normalizeDepth,s={__serialized__:kA(n,t)},o=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}(n);if(o)return[o,s];const i=eb(n),a=r?.syntheticException||new Error(i);return a.message=i,[a,s]}const s=r?.syntheticException||new Error(n);return s.message=`${n}`,[s,void 0]}class nb extends Kv{constructor(e){if(OA(),super(e),this._logWeight=0,this._options.enableLogs){const e=this;e.on("flushLogs",()=>{e._logWeight=0,clearTimeout(e._logFlushIdleTimeout)}),e.on("afterCaptureLog",t=>{e._logWeight+=function(e){let t=0;e.message&&(t+=2*e.message.length);e.attributes&&Object.values(e.attributes).forEach(e=>{Array.isArray(e)?t+=e.length*sb(e[0]):HT(e)?t+=sb(e):t+=100});return t}(t),e._logWeight>=8e5?Xv(e):e._logFlushIdleTimeout=setTimeout(()=>{Xv(e)},5e3)}),e.on("flush",()=>{Xv(e)})}}eventFromException(e,t){const n=function(e,t,n,r){const s=r?.data&&r.data.mechanism||{handled:!0,type:"generic"},[o,i]=tb(e,s,n,r),a={exception:{values:[Jv(t,o)]}};return i&&(a.extra=i),function(e,t,n){const r=e.exception=e.exception||{},s=r.values=r.values||[],o=s[0]=s[0]||{};o.value||(o.value=t||""),o.type||(o.type=n||"Error")}(a,void 0,void 0),iy(a,s),{...a,event_id:r?.event_id}}(this,this._options.stackParser,e,t);return n.level="error",gv(n)}eventFromMessage(e,t="info",n){return gv(function(e,t,n="info",r,s){const o={event_id:r?.event_id,level:n};if(s&&r?.syntheticException){const n=Qv(e,r.syntheticException);n.length&&(o.exception={values:[{value:t,stacktrace:{frames:n}}]},iy(o,{synthetic:!0}))}if(VT(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return o.logentry={message:e,params:n},o}return o.message=t,o}(this._options.stackParser,e,t,n,this._options.attachStacktrace))}captureException(e,t,n){return rb(t),super.captureException(e,t,n)}captureEvent(e,t,n){return!e.type&&e.exception?.values&&e.exception.values.length>0&&rb(t),super.captureEvent(e,t,n)}captureCheckIn(e,t,n){const r="checkInId"in e&&e.checkInId?e.checkInId:ry();if(!this._isEnabled())return cT&&TT.warn("SDK not enabled, will not capture check-in."),r;const s=this.getOptions(),{release:o,environment:i,tunnel:a}=s,c={check_in_id:r,monitor_slug:e.monitorSlug,status:e.status,release:o,environment:i};"duration"in e&&(c.duration=e.duration),t&&(c.monitor_config={schedule:t.schedule,checkin_margin:t.checkinMargin,max_runtime:t.maxRuntime,timezone:t.timezone,failure_issue_threshold:t.failureIssueThreshold,recovery_threshold:t.recoveryThreshold});const[u,l]=function(e,t){return t?wy(t,()=>{const n=vA(),r=n?dA(n):xy(t);return[n?LA(n):wA(e,t),r]}):[void 0,void 0]}(this,n);l&&(c.contexts={trace:l});const p=function(e,t,n,r,s){const o={sent_at:(new Date).toISOString()};n?.sdk&&(o.sdk={name:n.sdk.name,version:n.sdk.version}),r&&s&&(o.dsn=nA(s)),t&&(o.trace=t);const i=function(e){return[{type:"check_in"},e]}(e);return $A(o,[i])}(c,u,this.getSdkMetadata(),a,this.getDsn());return cT&&TT.log("Sending checkin:",e.monitorSlug,e.status),this.sendEnvelope(p),r}_prepareEvent(e,t,n,r){return this._options.platform&&(e.platform=e.platform||this._options.platform),this._options.runtime&&(e.contexts={...e.contexts,runtime:e.contexts?.runtime||this._options.runtime}),this._options.serverName&&(e.server_name=e.server_name||this._options.serverName),super._prepareEvent(e,t,n,r)}}function rb(e){const t=My().getScopeData().sdkProcessingMetadata.requestSession;if(t){const n=e?.mechanism?.handled??!0;n&&"crashed"!==t.status?t.status="errored":n||(t.status="crashed")}}function sb(e){return"string"==typeof e?2*e.length:"number"==typeof e?8:"boolean"==typeof e?4:0}const ob=Symbol.for("SentryBufferFullError");function ib(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]||Promise.resolve(void 0)}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return Ev(ob);const s=r();return-1===t.indexOf(s)&&t.push(s),s.then(()=>n(s)).then(null,()=>n(s).then(null,()=>{})),s},drain:function(e){return new Sv((n,r)=>{let s=t.length;if(!s)return n(!0);const o=setTimeout(()=>{e&&e>0&&n(!1)},e);t.forEach(e=>{gv(e).then(()=>{--s||(clearTimeout(o),n(!0))},r)})})}}}function ab(e,{statusCode:t,headers:n},r=Date.now()){const s={...e},o=n?.["x-sentry-rate-limits"],i=n?.["retry-after"];if(o)for(const e of o.trim().split(",")){const[t,n,,,o]=e.split(":",5),i=parseInt(t,10),a=1e3*(isNaN(i)?60:i);if(n)for(const e of n.split(";"))"metric_bucket"===e&&o&&!o.split(";").includes("custom")||(s[e]=r+a);else s.all=r+a}else i?s.all=r+function(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?6e4:r-t}(i,r):429===t&&(s.all=r+6e4);return s}function cb(e,t,n=ib(e.bufferSize||64)){let r={};return{send:function(s){const o=[];if(jA(s,(t,n)=>{const s=qA(n);!function(e,t,n=Date.now()){return function(e,t){return e[t]||e.all||0}(e,t)>n}(r,s)?o.push(t):e.recordDroppedEvent("ratelimit_backoff",s)}),0===o.length)return gv({});const i=$A(s[0],o),a=t=>{jA(i,(n,r)=>{e.recordDroppedEvent(t,qA(r))})};return n.add(()=>t({body:HA(i)}).then(e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&cT&&TT.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=ab(r,e),e),e=>{throw a("network_error"),cT&&TT.error("Encountered error running transport request:",e),e})).then(e=>e,e=>{if(e===ob)return cT&&TT.error("Skipped sending event because buffer is full."),a("queue_overflow"),gv({});throw e})},flush:e=>n.drain(e)}}function ub(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function lb(e){return e.split(/[?#]/,1)[0]}function pb(e){const{protocol:t,host:n,path:r}=e;return`${t?`${t}://`:""}${n?.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||""}${r}`}function db(e,t,n=[t],r="npm"){const s=e._metadata||{};s.sdk||(s.sdk={name:`sentry.javascript.${t}`,packages:n.map(e=>({name:`${r}:@sentry/${e}`,version:lT})),version:lT}),e._metadata=s}function hb(e={}){const t=e.client||Ly();if(!function(){const e=Ly();return!1!==e?.getOptions().enabled&&!!e?.getTransport()}()||!t)return{};const n=Iy(pT());if(n.getTraceData)return n.getTraceData(e);const r=e.scope||Py(),s=e.span||vA(),o=s?function(e){const{traceId:t,spanId:n}=e.spanContext();return uA(t,n,gA(e))}(s):function(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return uA(t,r,n)}(r),i=Xy(s?LA(s):wA(t,r));return aA.test(o)?{"sentry-trace":o,baggage:i}:(TT.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function fb(e){const t=Object.create(null);try{Object.entries(e).forEach(([e,n])=>{"string"==typeof n&&(t[e]=n)})}catch{}return t}function _b(e){const t=e.headers||{},n=("string"==typeof t["x-forwarded-host"]?t["x-forwarded-host"]:void 0)||("string"==typeof t.host?t.host:void 0),r=("string"==typeof t["x-forwarded-proto"]?t["x-forwarded-proto"]:void 0)||e.protocol||(e.socket?.encrypted?"https":"http"),s=e.url||"",o=function({url:e,protocol:t,host:n}){if(e?.startsWith("http"))return e;if(e&&n)return`${t}://${n}${e}`;return}({url:s,host:n,protocol:r}),i=e.body||void 0,a=e.cookies;return{url:o,method:e.method,query_string:mb(s),headers:fb(t),cookies:a,data:i}}function mb(e){if(e)try{const t=new URL(e,"http://s.io").search.slice(1);return t.length?t:void 0}catch{return}}const gb=100;function Eb(e,t){const n=Ly(),r=My();if(!n)return;const{beforeBreadcrumb:s=null,maxBreadcrumbs:o=gb}=n.getOptions();if(o<=0)return;const i={timestamp:ly(),...e},a=s?mT(()=>s(i,t)):i;null!==a&&(n.emit&&n.emit("beforeAddBreadcrumb",a,t),r.addBreadcrumb(a,o))}let Sb;const Tb=new WeakMap,yb=()=>({name:"FunctionToString",setupOnce(){Sb=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=this.__sentry_original__;const n=Tb.has(Ly())&&void 0!==t?t:this;return Sb.apply(n,e)}}catch{}},setup(e){Tb.set(e,!0)}}),Ab=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],vb=(e={})=>{let t;return{name:"EventFilters",setup(n){const r=n.getOptions();t=Rb(e,r)},processEvent(n,r,s){if(!t){const n=s.getOptions();t=Rb(e,n)}return function(e,t){if(e.type){if("transaction"===e.type&&function(e,t){if(!t?.length)return!1;const n=e.transaction;return!!n&&zT(n,t)}(e,t.ignoreTransactions))return cT&&TT.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${oy(e)}`),!0}else{if(function(e,t){if(!t?.length)return!1;return $v(e).some(e=>zT(e,t))}(e,t.ignoreErrors))return cT&&TT.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${oy(e)}`),!0;if(function(e){if(!e.exception?.values?.length)return!1;return!e.message&&!e.exception.values.some(e=>e.stacktrace||e.type&&"Error"!==e.type||e.value)}(e))return cT&&TT.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${oy(e)}`),!0;if(function(e,t){if(!t?.length)return!1;const n=Ob(e);return!!n&&zT(n,t)}(e,t.denyUrls))return cT&&TT.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${oy(e)}.\nUrl: ${Ob(e)}`),!0;if(!function(e,t){if(!t?.length)return!0;const n=Ob(e);return!n||zT(n,t)}(e,t.allowUrls))return cT&&TT.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${oy(e)}.\nUrl: ${Ob(e)}`),!0}return!1}(n,t)?null:n}}},bb=(e={})=>({...vb(e),name:"InboundFilters"});function Rb(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:Ab],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function Ob(e){try{const t=[...e.exception?.values??[]].reverse().find(e=>void 0===e.mechanism?.parent_id&&e.stacktrace?.frames?.length),n=t?.stacktrace?.frames;return n?function(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(n):null}catch{return cT&&TT.error(`Cannot extract url for event ${oy(e)}`),null}}function Nb(e,t,n,r,s,o){if(!s.exception?.values||!o||!YT(o.originalException,Error))return;const i=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;i&&(s.exception.values=Cb(e,t,r,o.originalException,n,s.exception.values,i,0))}function Cb(e,t,n,r,s,o,i,a){if(o.length>=n+1)return o;let c=[...o];if(YT(r[s],Error)){Ib(i,a);const o=e(t,r[s]),u=c.length;Pb(o,s,u,a),c=Cb(e,t,n,r[s],s,[o,...c],o,u)}return Array.isArray(r.errors)&&r.errors.forEach((r,o)=>{if(YT(r,Error)){Ib(i,a);const u=e(t,r),l=c.length;Pb(u,`errors[${o}]`,l,a),c=Cb(e,t,n,r,s,[u,...c],u,l)}}),c}function Ib(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function Pb(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const Mb=(e={})=>{const t=e.limit||5,n=e.key||"cause";return{name:"LinkedErrors",preprocessEvent(e,r,s){Nb(Jv,s.getOptions().stackParser,n,t,e,r)}}};const wb=["X-Client-IP","X-Forwarded-For","Fly-Client-IP","CF-Connecting-IP","Fastly-Client-Ip","True-Client-Ip","X-Real-IP","X-Cluster-Client-IP","X-Forwarded","Forwarded-For","Forwarded","X-Vercel-Forwarded-For"];const Lb={cookies:!0,data:!0,headers:!0,query_string:!0,url:!0},xb=(e={})=>{const t={...Lb,...e.include};return{name:"RequestData",processEvent(e,n,r){const{sdkProcessingMetadata:s={}}=e,{normalizedRequest:o,ipAddress:i}=s,a={...t,ip:t.ip??r.getOptions().sendDefaultPii};return o&&function(e,t,n,r){if(e.request={...e.request,...Db(t,r)},r.ip){const r=t.headers&&function(e){const t=wb.map(t=>{const n=e[t],r=Array.isArray(n)?n.join(";"):n;return"Forwarded"===t?function(e){if(!e)return null;for(const t of e.split(";"))if(t.startsWith("for="))return t.slice(4);return null}(r):r?.split(",").map(e=>e.trim())}).reduce((e,t)=>t?e.concat(t):e,[]).find(e=>null!==e&&/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/.test(e));return t||null}(t.headers)||n.ipAddress;r&&(e.user={...e.user,ip_address:r})}}(e,o,{ipAddress:i},a),e}}};function Db(e,t){const n={},r={...e.headers};if(t.headers&&(n.headers=r,t.cookies||delete r.cookie,t.ip||wb.forEach(e=>{delete r[e]})),n.method=e.method,t.url&&(n.url=e.url),t.cookies){const t=e.cookies||(r?.cookie?function(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(-1===r)break;let s=e.indexOf(";",n);if(-1===s)s=e.length;else if(s<r){n=e.lastIndexOf(";",r-1)+1;continue}const o=e.slice(n,r).trim();if(void 0===t[o]){let n=e.slice(r+1,s).trim();34===n.charCodeAt(0)&&(n=n.slice(1,-1));try{t[o]=-1!==n.indexOf("%")?decodeURIComponent(n):n}catch{t[o]=n}}n=s+1}return t}(r.cookie):void 0);n.cookies=t||{}}return t.query_string&&(n.query_string=e.query_string),t.data&&(n.data=e.data),n}function kb(){"console"in uT&&fT.forEach(function(e){e in uT.console&&QT(uT.console,e,function(t){return _T[e]=t,function(...t){wT("console",{args:t,level:e});const n=_T[e];n?.apply(uT.console,t)}})})}function Ub(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const $b=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function Gb(e){const t=function(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=$b.exec(t);return n?n.slice(1):[]}(e),n=t[0]||"";let r=t[1];return n||r?(r&&(r=r.slice(0,r.length-1)),n+r):"."}const jb=(e={})=>{const t=new Set(e.levels||fT);return{name:"Console",setup(e){!function(e){const t="console";PT(t,e),MT(t,kb)}(({args:n,level:r})=>{Ly()===e&&t.has(r)&&function(e,t){const n={category:"console",data:{arguments:t,logger:"console"},level:Ub(e),message:Vb(t)};if("assert"===e){if(!1!==t[0])return;{const e=t.slice(1);n.message=e.length>0?`Assertion failed: ${Vb(e)}`:"Assertion failed",n.data.arguments=e}}Eb(n,{input:t,level:e})}(r,n)})}}};function Vb(e){return"util"in uT&&"function"==typeof uT.util.format?uT.util.format(...e):function(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{qT(r)?n.push("[VueViewModel]"):n.push(String(r))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}(e," ")}const Hb=new Map,Bb="gen_ai.prompt",Fb="gen_ai.system",Yb="gen_ai.request.model",qb="gen_ai.request.stream",Kb="gen_ai.request.temperature",Wb="gen_ai.request.frequency_penalty",Zb="gen_ai.request.top_p",Xb="gen_ai.response.finish_reasons",zb="gen_ai.response.model",Qb="gen_ai.response.id",Jb="gen_ai.usage.input_tokens",eR="gen_ai.usage.output_tokens",tR="gen_ai.usage.total_tokens",nR="gen_ai.operation.name",rR="gen_ai.request.messages",sR="gen_ai.response.text",oR="gen_ai.response.streaming",iR="gen_ai.response.tool_calls",aR="openai.response.id",cR="openai.response.model",uR="openai.response.timestamp",lR="openai.usage.completion_tokens",pR="openai.usage.prompt_tokens",dR="chat",hR="responses",fR="anthropic.response.timestamp";function _R(e,t){const n=e.parent_span_id;if(!n)return;const r=e.data[Jb],s=e.data[eR];if("number"==typeof r||"number"==typeof s){const e=t.get(n)||{inputTokens:0,outputTokens:0};"number"==typeof r&&(e.inputTokens+=r),"number"==typeof s&&(e.outputTokens+=s),t.set(n,e)}}function mR(e,t){const n=t.get(e.span_id);n&&e.data&&(n.inputTokens>0&&(e.data[Jb]=n.inputTokens),n.outputTokens>0&&(e.data[eR]=n.outputTokens),(n.inputTokens>0||n.outputTokens>0)&&(e.data["gen_ai.usage.total_tokens"]=n.inputTokens+n.outputTokens))}function gR(e){return Hb.get(e)}function ER(e){Hb.delete(e)}const SR="ai.prompt",TR="ai.model.id",yR="ai.response.providerMetadata",AR="ai.telemetry.functionId",vR="gen_ai.response.model",bR="gen_ai.usage.input_tokens",RR="gen_ai.usage.output_tokens",OR="ai.toolCall.name",NR="ai.toolCall.id";function CR(e,t){e.setAttribute($y,t)}function IR(e){const{data:t,description:n}=mA(e);if(!n)return;if(t[OR]&&t[NR]&&"ai.toolCall"===n)return void function(e,t){CR(e,"auto.vercelai.otel"),e.setAttribute(Uy,"gen_ai.execute_tool"),wR(t,OR,"gen_ai.tool.name"),wR(t,NR,"gen_ai.tool.call.id");const n=t["gen_ai.tool.call.id"];"string"==typeof n&&Hb.set(n,e);t["gen_ai.tool.type"]||e.setAttribute("gen_ai.tool.type","function");const r=t["gen_ai.tool.name"];r&&e.updateName(`execute_tool ${r}`)}(e,t);const r=t[TR],s=t["ai.model.provider"];"string"==typeof r&&"string"==typeof s&&r&&s&&function(e,t,n){CR(e,"auto.vercelai.otel");const r=t.replace("ai.","");e.setAttribute("ai.pipeline.name",r),e.updateName(r);const s=n[AR];s&&"string"==typeof s&&t.split(".").length-1==1&&(e.updateName(`${r} ${s}`),e.setAttribute("gen_ai.function_id",s));n[SR]&&e.setAttribute("gen_ai.prompt",n[SR]);n[TR]&&!n[vR]&&e.setAttribute(vR,n[TR]);if(e.setAttribute("ai.streaming",t.includes("stream")),"ai.generateText"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.generateText.doGenerate"===t)return e.setAttribute(Uy,"gen_ai.generate_text"),void e.updateName(`generate_text ${n[TR]}`);if("ai.streamText"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.streamText.doStream"===t)return e.setAttribute(Uy,"gen_ai.stream_text"),void e.updateName(`stream_text ${n[TR]}`);if("ai.generateObject"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.generateObject.doGenerate"===t)return e.setAttribute(Uy,"gen_ai.generate_object"),void e.updateName(`generate_object ${n[TR]}`);if("ai.streamObject"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.streamObject.doStream"===t)return e.setAttribute(Uy,"gen_ai.stream_object"),void e.updateName(`stream_object ${n[TR]}`);if("ai.embed"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.embed.doEmbed"===t)return e.setAttribute(Uy,"gen_ai.embed"),void e.updateName(`embed ${n[TR]}`);if("ai.embedMany"===t)return void e.setAttribute(Uy,"gen_ai.invoke_agent");if("ai.embedMany.doEmbed"===t)return e.setAttribute(Uy,"gen_ai.embed_many"),void e.updateName(`embed_many ${n[TR]}`);if(t.startsWith("ai.stream"))e.setAttribute(Uy,"ai.run")}(e,n,t)}function PR(e){if("transaction"===e.type&&e.spans){const t=new Map;for(const n of e.spans)MR(n),_R(n,t);for(const n of e.spans)"gen_ai.invoke_agent"===n.op&&mR(n,t);const n=e.contexts?.trace;n&&"gen_ai.invoke_agent"===n.op&&mR(n,t)}return e}function MR(e){const{data:t,origin:n}=e;if("auto.vercelai.otel"===n){wR(t,"ai.usage.completionTokens",RR),wR(t,"ai.usage.promptTokens",bR),"number"==typeof t[RR]&&"number"==typeof t[bR]&&(t["gen_ai.usage.total_tokens"]=t[RR]+t[bR]),wR(t,"ai.prompt.messages","gen_ai.request.messages"),wR(t,"ai.response.text","gen_ai.response.text"),wR(t,"ai.response.toolCalls","gen_ai.response.tool_calls"),wR(t,"ai.response.object","gen_ai.response.object"),wR(t,"ai.prompt.tools","gen_ai.request.available_tools"),wR(t,"ai.toolCall.args","gen_ai.tool.input"),wR(t,"ai.toolCall.result","gen_ai.tool.output"),function(e){const t=e[yR];if(t)try{const n=JSON.parse(t);n.openai&&(xR(e,"gen_ai.usage.input_tokens.cached",n.openai.cachedPromptTokens),xR(e,"gen_ai.usage.output_tokens.reasoning",n.openai.reasoningTokens),xR(e,"gen_ai.usage.output_tokens.prediction_accepted",n.openai.acceptedPredictionTokens),xR(e,"gen_ai.usage.output_tokens.prediction_rejected",n.openai.rejectedPredictionTokens),xR(e,"gen_ai.conversation.id",n.openai.responseId)),n.anthropic&&(xR(e,"gen_ai.usage.input_tokens.cached",n.anthropic.cacheReadInputTokens),xR(e,"gen_ai.usage.input_tokens.cache_write",n.anthropic.cacheCreationInputTokens)),n.bedrock?.usage&&(xR(e,"gen_ai.usage.input_tokens.cached",n.bedrock.usage.cacheReadInputTokens),xR(e,"gen_ai.usage.input_tokens.cache_write",n.bedrock.usage.cacheWriteInputTokens)),n.deepseek&&(xR(e,"gen_ai.usage.input_tokens.cached",n.deepseek.promptCacheHitTokens),xR(e,"gen_ai.usage.input_tokens.cache_miss",n.deepseek.promptCacheMissTokens))}catch{}}(t);for(const e of Object.keys(t))e.startsWith("ai.")&&wR(t,e,`vercel.${e}`)}}function wR(e,t,n){null!=e[t]&&(e[n]=e[t],delete e[t])}function LR(e){e.on("spanStart",IR),e.addEventProcessor(Object.assign(PR,{id:"VercelAiEventProcessor"}))}function xR(e,t,n){null!=n&&(e[t]=n)}const DR="OpenAI",kR=["responses.create","chat.completions.create"],UR=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta","response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"];function $R(e){return e.includes("chat.completions")?dR:e.includes("responses")?hR:e.split(".").pop()||"unknown"}function GR(e){return`gen_ai.${$R(e)}`}function jR(e){return null!==e&&"object"==typeof e&&"type"in e&&"string"==typeof e.type&&e.type.startsWith("response.")}function VR(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion.chunk"===e.object}function HR(e,t,n,r){void 0!==t&&e.setAttributes({[pR]:t,[Jb]:t}),void 0!==n&&e.setAttributes({[lR]:n,[eR]:n}),void 0!==r&&e.setAttributes({[tR]:r})}function BR(e,t,n,r){e.setAttributes({[aR]:t,[Qb]:t}),e.setAttributes({[cR]:n,[zb]:n}),e.setAttributes({[uR]:new Date(1e3*r).toISOString()})}function FR(e,t){for(const n of e){const e=n.index;if(void 0!==e&&n.function)if(e in t.chatCompletionToolCalls){const r=t.chatCompletionToolCalls[e];n.function.arguments&&r?.function&&(r.function.arguments+=n.function.arguments)}else t.chatCompletionToolCalls[e]={...n,function:{name:n.function.name,arguments:n.function.arguments||""}}}}function YR(e,t,n){t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const r of e.choices??[])n&&(r.delta?.content&&t.responseTexts.push(r.delta.content),r.delta?.tool_calls&&FR(r.delta.tool_calls,t)),r.finish_reason&&t.finishReasons.push(r.finish_reason)}function qR(e,t,n,r){if(!e||"object"!=typeof e)return void t.eventTypes.push("unknown:non-object");if(e instanceof Error)return r.setStatus({code:2,message:"internal_error"}),void Pv(e,{mechanism:{handled:!1}});if(!("type"in e))return;const s=e;if(UR.includes(s.type)){if(n&&("response.output_item.done"===s.type&&"item"in s&&t.responsesApiToolCalls.push(s.item),"response.output_text.delta"===s.type&&"delta"in s&&s.delta))t.responseTexts.push(s.delta);else if("response"in s){const{response:e}=s;t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created_at??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.input_tokens,t.completionTokens=e.usage.output_tokens,t.totalTokens=e.usage.total_tokens),e.status&&t.finishReasons.push(e.status),n&&e.output_text&&t.responseTexts.push(e.output_text)}}else t.eventTypes.push(s.type)}function KR(e,t,n){if(!t||"object"!=typeof t)return;const r=t;if(function(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion"===e.object}(r)){if(function(e,t,n){if(BR(e,t.id,t.model,t.created),t.usage&&HR(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map(e=>e.finish_reason).filter(e=>null!==e);if(r.length>0&&e.setAttributes({[Xb]:JSON.stringify(r)}),n){const n=t.choices.map(e=>e.message?.tool_calls).filter(e=>Array.isArray(e)&&e.length>0).flat();n.length>0&&e.setAttributes({[iR]:JSON.stringify(n)})}}}(e,r,n),n&&r.choices?.length){const t=r.choices.map(e=>e.message?.content||"");e.setAttributes({[sR]:JSON.stringify(t)})}}else(function(e){return null!==e&&"object"==typeof e&&"object"in e&&"response"===e.object})(r)&&(!function(e,t,n){if(BR(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[Xb]:JSON.stringify([t.status])}),t.usage&&HR(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const n=t;if(Array.isArray(n.output)&&n.output.length>0){const t=n.output.filter(e=>"object"==typeof e&&null!==e&&"function_call"===e.type);t.length>0&&e.setAttributes({[iR]:JSON.stringify(t)})}}}(e,r,n),n&&r.output_text&&e.setAttributes({[sR]:r.output_text}))}function WR(e,t){"messages"in t&&e.setAttributes({[rR]:JSON.stringify(t.messages)}),"input"in t&&e.setAttributes({[rR]:JSON.stringify(t.input)})}function ZR(e,t,n,r){return async function(...s){const o=r||function(){const e=Py().getClient(),t=e?.getIntegrationByName(DR),n=!!t&&Boolean(e?.getOptions().sendDefaultPii);return{recordInputs:t?.options?.recordInputs??n,recordOutputs:t?.options?.recordOutputs??n}}(),i=function(e,t){const n={[Fb]:"openai",[nR]:$R(t)};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0],r=[...Array.isArray(t.tools)?t.tools:[],...t.web_search_options&&"object"==typeof t.web_search_options?[{type:"web_search_options",...t.web_search_options}]:[]];r.length>0&&(n["gen_ai.request.available_tools"]=JSON.stringify(r))}if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];n[Yb]=t.model??"unknown","temperature"in t&&(n[Kb]=t.temperature),"top_p"in t&&(n[Zb]=t.top_p),"frequency_penalty"in t&&(n[Wb]=t.frequency_penalty),"presence_penalty"in t&&(n["gen_ai.request.presence_penalty"]=t.presence_penalty),"stream"in t&&(n[qb]=t.stream)}else n[Yb]="unknown";return n}(s,t),a=i[Yb]||"unknown",c=$R(t),u=s[0];return u&&"object"==typeof u&&!0===u.stream?cv({name:`${c} ${a} stream-response`,op:GR(t),attributes:i},async t=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&WR(t,s[0]);return async function*(e,t,n){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{for await(const s of e)VR(s)?YR(s,r,n):jR(s)&&qR(s,r,n,t),yield s}finally{BR(t,r.responseId,r.responseModel,r.responseTimestamp),HR(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[oR]:!0}),r.finishReasons.length&&t.setAttributes({[Xb]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[sR]:r.responseTexts.join("")});const e=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];e.length>0&&t.setAttributes({[iR]:JSON.stringify(e)}),t.end()}}(await e.apply(n,s),t,o.recordOutputs??!1)}catch(e){throw t.setStatus({code:2,message:"internal_error"}),Pv(e,{mechanism:{handled:!1}}),t.end(),e}}):av({name:`${c} ${a}`,op:GR(t),attributes:i},async t=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&WR(t,s[0]);const r=await e.apply(n,s);return KR(t,r,o.recordOutputs),r}catch(e){throw Pv(e),e}})}}function XR(e,t="",n){return new Proxy(e,{get(e,r){const s=e[r],o=function(e,t){return e?`${e}.${t}`:t}(t,String(r));return"function"==typeof s&&function(e){return kR.includes(e)}(o)?ZR(s,o,e,n):"function"==typeof s?s.bind(e):s&&"object"==typeof s?XR(s,o,n):s}})}function zR(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.split(".").pop()||"unknown"}function QR(e){return`gen_ai.${zR(e)}`}function JR(e,t,n,r,s){if(void 0!==t&&e.setAttributes({[Jb]:t}),void 0!==n&&e.setAttributes({[eR]:n}),void 0!==t||void 0!==n||void 0!==r||void 0!==s){const o=(t??0)+(n??0)+(r??0)+(s??0);e.setAttributes({[tR]:o})}}const eO="Anthropic_AI",tO=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve"];function nO(e,t,n,r){if(!e||"object"!=typeof e)return;const s=function(e,t,n,r){if("type"in e&&"string"==typeof e.type){if("error"===e.type){const t=e.error?.message??"internal_error";return r.setStatus({code:2,message:t}),Pv(new Error(`anthropic_stream_error: ${t}`),{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:"anthropic_stream_error"}},data:{function:"anthropic_stream_error"}}),!0}if(n&&"content_block_delta"===e.type){const n=e.delta?.text;n&&t.responseTexts.push(n)}}return!1}(e,t,n,r);s||function(e,t){if("message_delta"===e.type&&e.usage&&"output_tokens"in e.usage&&"number"==typeof e.usage.output_tokens&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&("number"==typeof n.usage.input_tokens&&(t.promptTokens=n.usage.input_tokens),"number"==typeof n.usage.cache_creation_input_tokens&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),"number"==typeof n.usage.cache_read_input_tokens&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}(e,t)}function rO(e,t){"messages"in t&&e.setAttributes({[rR]:JSON.stringify(t.messages)}),"input"in t&&e.setAttributes({[rR]:JSON.stringify(t.input)}),"prompt"in t&&e.setAttributes({[Bb]:JSON.stringify(t.prompt)})}function sO(e,t,n,r){return async function(...s){const o=r||function(){const e=Py().getClient(),t=e?.getIntegrationByName(eO),n=!!t&&Boolean(e?.getOptions().sendDefaultPii);return{recordInputs:t?.options?.recordInputs??n,recordOutputs:t?.options?.recordOutputs??n}}(),i=function(e,t){const n={[Fb]:"anthropic",[nR]:zR(t),[$y]:"auto.ai.anthropic"};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];n[Yb]=t.model??"unknown","temperature"in t&&(n[Kb]=t.temperature),"top_p"in t&&(n[Zb]=t.top_p),"stream"in t&&(n[qb]=t.stream),"top_k"in t&&(n["gen_ai.request.top_k"]=t.top_k),"frequency_penalty"in t&&(n[Wb]=t.frequency_penalty),"max_tokens"in t&&(n["gen_ai.request.max_tokens"]=t.max_tokens)}else n[Yb]="models.retrieve"===t||"models.get"===t?e[0]:"unknown";return n}(s,t),a=i[Yb]??"unknown",c=zR(t),u="object"==typeof s[0]?s[0]:void 0;return Boolean(u?.stream)||"messages.stream"===t?cv({name:`${c} ${a} stream-response`,op:QR(t),attributes:i},async r=>{try{o.recordInputs&&u&&rO(r,u);return async function*(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0};try{for await(const s of e)nO(s,r,n,t),yield s}finally{r.responseId&&t.setAttributes({[Qb]:r.responseId}),r.responseModel&&t.setAttributes({[zb]:r.responseModel}),JR(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[oR]:!0}),r.finishReasons.length>0&&t.setAttributes({[Xb]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[sR]:r.responseTexts.join("")}),t.end()}}(await e.apply(n,s),r,o.recordOutputs??!1)}catch(e){throw r.setStatus({code:2,message:"internal_error"}),Pv(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}}),r.end(),e}}):av({name:`${c} ${a}`,op:QR(t),attributes:i},async r=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&rO(r,s[0]);const t=await e.apply(n,s);return function(e,t,n){t&&"object"==typeof t&&(n&&("content"in t&&Array.isArray(t.content)&&e.setAttributes({[sR]:t.content.map(e=>e.text).filter(e=>void 0!==e).join("")}),"completion"in t&&e.setAttributes({[sR]:t.completion}),"input_tokens"in t&&e.setAttributes({[sR]:JSON.stringify(t.input_tokens)})),e.setAttributes({[Qb]:t.id}),e.setAttributes({[zb]:t.model}),"created"in t&&"number"==typeof t.created&&e.setAttributes({[fR]:new Date(1e3*t.created).toISOString()}),"created_at"in t&&"number"==typeof t.created_at&&e.setAttributes({[fR]:new Date(1e3*t.created_at).toISOString()}),t.usage&&JR(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}(r,t,o.recordOutputs),t}catch(e){throw Pv(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}}),e}})}}function oO(e,t="",n){return new Proxy(e,{get(e,r){const s=e[r],o=function(e,t){return e?`${e}.${t}`:t}(t,String(r));return"function"==typeof s&&function(e){return tO.includes(e)}(o)?sO(s,o,e,n):"function"==typeof s?s.bind(e):s&&"object"==typeof s?oO(s,o,n):s}})}function iO(e){return void 0===e?void 0:e>=400&&e<500?"warning":e>=500?"error":void 0}function aO(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&void 0!==e&&!e.includes("node_modules/")}function cO(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,r=/at (?:async )?(.+?) \(data:(.*?),/;return s=>{const o=s.match(r);if(o)return{filename:`<data:${o[2]}>`,function:o[1]};const i=s.match(n);if(i){let t,n,r,s,o;if(i[1]){r=i[1];let e=r.lastIndexOf(".");if("."===r[e-1]&&e--,e>0){t=r.slice(0,e),n=r.slice(e+1);const s=t.indexOf(".Module");s>0&&(r=r.slice(s+1),t=t.slice(0,s))}s=void 0}n&&(s=t,o=n),"<anonymous>"===n&&(o=void 0,r=void 0),void 0===r&&(o=o||"?",r=s?`${s}.${o}`:o);let a=i[2]?.startsWith("file://")?i[2].slice(7):i[2];const c="native"===i[5];return a?.match(/\/[A-Z]:/)&&(a=a.slice(1)),a||!i[5]||c||(a=i[5]),{filename:a?decodeURI(a):void 0,module:e?e(a):void 0,function:r,lineno:uO(i[3]),colno:uO(i[4]),in_app:aO(a||"",c)}}return s.match(t)?{filename:s}:void 0}}function uO(e){return parseInt(e||"",10)||void 0}class lO{constructor(e){this._maxSize=e,this._cache=new Map}get size(){return this._cache.size}get(e){const t=this._cache.get(e);if(void 0!==t)return this._cache.delete(e),this._cache.set(e,t),t}set(e,t){this._cache.size>=this._maxSize&&this._cache.delete(this._cache.keys().next().value),this._cache.set(e,t)}remove(e){const t=this._cache.get(e);return t&&this._cache.delete(e),t}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const e=[];return this._cache.forEach(t=>e.push(t)),e}}const pO={};function dO(e,t,n){return n?function(e,t,n){return Object.assign(r=>{const s=n(r),o=pO[e];if(o)return o.setConfig(s),o;const i=new t(s);return pO[e]=i,ug({instrumentations:[i]}),i},{id:e})}(e,t,n):function(e,t){return Object.assign(n=>{const r=pO[e];if(r)return n&&r.setConfig(n),r;const s=t(n);return pO[e]=s,ug({instrumentations:[s]}),s},{id:e})}(e,t)}function hO(e){let t=!1,n=[];if(function(e){return"function"==typeof e._wrap}(e)){const r=e._wrap;e._wrap=(...e)=>(t=!0,n.forEach(e=>e()),n=[],r(...e))}else t=!0;return e=>{t?e():n.push(e)}}const fO="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function _O(e){const t=e.protocol||"",n=e.hostname||e.host||"";return`${t}//${n}${!e.port||80===e.port||443===e.port||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`}${e.path?e.path:"/"}`}const mO="@sentry/instrumentation-http",gO=1048576,EO=new Map;function SO(e,{ignoreIncomingRequestBody:t,maxIncomingRequestBodySize:n="medium",trackIncomingRequestsAsSessions:r=!0,sessionFlushingDelayMS:s}){const o=e.emit;if(o.__sentry_patched__)return;const i=new Proxy(o,{apply(e,o,i){if("request"!==i[0])return e.apply(o,i);fO&&TT.log(mO,"Handling incoming request");const a=My().clone(),c=i[1],u=i[2],l=_b(c),p=c.ip||c.socket?.remoteAddress,d=c.url||"/";t?.(d,c)||"none"===n||function(e,t,n){let r=0;const s=[];fO&&TT.log(mO,"Patching request.on");const o=new WeakMap,i="small"===n?1e3:"medium"===n?1e4:gO;try{e.on=new Proxy(e.on,{apply:(e,t,n)=>{const[a,c,...u]=n;if("data"===a){fO&&TT.log(mO,`Handling request.on("data") with maximum body size of ${i}b`);const n=new Proxy(c,{apply:(e,t,n)=>{try{const e=n[0],t=Buffer.from(e);r<i?(s.push(t),r+=t.byteLength):fO&&TT.log(mO,`Dropping request body chunk because maximum body length of ${i}b is exceeded.`)}catch(e){fO&&TT.error(mO,"Encountered error while storing body chunk.")}return Reflect.apply(e,t,n)}});return o.set(c,n),Reflect.apply(e,t,[a,n,...u])}return Reflect.apply(e,t,n)}}),e.off=new Proxy(e.off,{apply:(e,t,n)=>{const[,r]=n,s=o.get(r);if(s){o.delete(r);const i=n.slice();return i[1]=s,Reflect.apply(e,t,i)}return Reflect.apply(e,t,n)}}),e.on("end",()=>{try{const e=Buffer.concat(s).toString("utf-8");if(e){const n=Buffer.byteLength(e,"utf-8")>i?`${Buffer.from(e).subarray(0,i-3).toString("utf-8")}...`:e;t.setSDKProcessingMetadata({normalizedRequest:{data:n}})}}catch(e){fO&&TT.error(mO,"Error building captured request body",e)}})}catch(e){fO&&TT.error(mO,"Error patching request to capture body",e)}}(c,a,n),a.setSDKProcessingMetadata({normalizedRequest:l,ipAddress:p});const h=`${(c.method||"GET").toUpperCase()} ${lb(d)}`;return a.setTransactionName(h),!1!==r&&function({requestIsolationScope:e,response:t,sessionFlushingDelayMS:n}){e.setSDKProcessingMetadata({requestSession:{status:"ok"}}),t.once("close",()=>{const t=Ly(),r=e.getScopeData().sdkProcessingMetadata.requestSession;if(t&&r){fO&&TT.log(`Recorded request session with status: ${r.status}`);const e=new Date;e.setSeconds(0,0);const s=e.toISOString(),o=EO.get(t),i=o?.[s]||{exited:0,crashed:0,errored:0};if(i[{ok:"exited",crashed:"crashed",errored:"errored"}[r.status]]++,o)o[s]=i;else{fO&&TT.log("Opened new request session aggregate.");const e={[s]:i};EO.set(t,e);const r=()=>{clearTimeout(a),o(),EO.delete(t);const n=Object.entries(e).map(([e,t])=>({started:e,exited:t.exited,errored:t.errored,crashed:t.crashed}));t.sendSession({aggregates:n})},o=t.on("flush",()=>{fO&&TT.log("Sending request session aggregate due to client flush"),r()}),a=setTimeout(()=>{fO&&TT.log("Sending request session aggregate due to flushing schedule"),r()},n).unref()}}})}({requestIsolationScope:a,response:u,sessionFlushingDelayMS:s??6e4}),function(...e){const t=Iy(pT());if(2===e.length){const[n,r]=e;return n?t.withSetIsolationScope(n,r):t.withIsolationScope(r)}return t.withIsolationScope(e[0])}(a,()=>{Py().getPropagationContext().propagationSpanId=gy();const t=Ut.extract(At.active(),l.headers);return At.with(t,()=>e.apply(o,i))})}});JT(i,"__sentry_patched__",!0),e.emit=i}const TO=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then;class yO{_rawAttributes;_asyncAttributesPending=!1;_memoizedAttributes;static FromAttributeList(e){const t=new yO({});return t._rawAttributes=bO(e),t._asyncAttributesPending=e.filter(([e,t])=>TO(t)).length>0,t}constructor(e){const t=e.attributes??{};this._rawAttributes=Object.entries(t).map(([e,t])=>(TO(t)&&(this._asyncAttributesPending=!0),[e,t])),this._rawAttributes=bO(this._rawAttributes)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){const[t,n]=this._rawAttributes[e];this._rawAttributes[e]=[t,TO(n)?await n:n]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&vt.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const e={};for(const[t,n]of this._rawAttributes)TO(n)?vt.debug(`Unsettled resource attribute ${t} skipped`):null!=n&&(e[t]??=n);return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}merge(e){return null==e?this:yO.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()])}}function AO(e){return yO.FromAttributeList(Object.entries(e))}function vO(){return AO({[Z_]:`unknown_service:${process.argv0}`,[z_]:sm[z_],[J_]:sm[J_],[em]:sm[em]})}function bO(e){return e.map(([e,t])=>TO(t)?[e,t.catch(t=>{vt.debug("promise rejection for resource attribute: %s - %s",e,t)})]:[e,t])}class RO{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:dt.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(e){const t=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=pn.now(),this._performanceOffset=t-(this._performanceStartTime+cm()),this._startTimeProvided=null!=e.startTime,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??t),this.resource=e.resource,this.instrumentationScope=e.scope,null!=e.attributes&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,t){if(null==t||this._isSpanEnded())return this;if(0===e.length)return vt.warn(`Invalid attribute key: ${e}`),this;if(!nn(t))return vt.warn(`Invalid attribute value set for key: ${e}`),this;const{attributeCountLimit:n}=this._spanLimits;return void 0!==n&&Object.keys(this.attributes).length>=n&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this)}setAttributes(e){for(const[t,n]of Object.entries(e))this.setAttribute(t,n);return this}addEvent(e,t,n){if(this._isSpanEnded())return this;const{eventCountLimit:r}=this._spanLimits;if(0===r)return vt.warn("No events allowed."),this._droppedEventsCount++,this;void 0!==r&&this.events.length>=r&&(0===this._droppedEventsCount&&vt.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),dm(t)&&(dm(n)||(n=t),t=void 0);const s=en(t);return this.events.push({name:e,attributes:s,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()||(this.status={...e},null!=this.status.message&&"string"!=typeof e.message&&(vt.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message)),this}updateName(e){return this._isSpanEnded()||(this.name=e),this}end(e){this._isSpanEnded()?vt.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(e),this._duration=lm(this.startTime,this.endTime),this._duration[0]<0&&(vt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&vt.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(e){if("number"==typeof e&&e<=pn.now())return um(e+this._performanceOffset);if("number"==typeof e)return am(e);if(e instanceof Date)return am(e.getTime());if(pm(e))return e;if(this._startTimeProvided)return am(Date.now());const t=pn.now()-this._performanceStartTime;return hm(this.startTime,am(t))}isRecording(){return!1===this._ended}recordException(e,t){const n={};"string"==typeof e?n[V_]=e:e&&(e.code?n[B_]=e.code.toString():e.name&&(n[B_]=e.name),e.message&&(n[V_]=e.message),e.stack&&(n[H_]=e.stack)),n[B_]||n[V_]?this.addEvent("exception",n,t):vt.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const e=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);vt.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,t){return e.length<=t?e:e.substring(0,t)}_truncateToSize(e){const t=this._attributeValueLengthLimit;return t<=0?(vt.warn(`Attribute value limit must be positive, got ${t}`),e):"string"==typeof e?this._truncateToLimitUtil(e,t):Array.isArray(e)?e.map(e=>"string"==typeof e?this._truncateToLimitUtil(e,t):e):e}}var OO;!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(OO||(OO={}));class NO{shouldSample(){return{decision:OO.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class CO{shouldSample(){return{decision:OO.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class IO{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(e){this._root=e.root,this._root||(an(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new CO),this._remoteParentSampled=e.remoteParentSampled??new CO,this._remoteParentNotSampled=e.remoteParentNotSampled??new NO,this._localParentSampled=e.localParentSampled??new CO,this._localParentNotSampled=e.localParentNotSampled??new NO}shouldSample(e,t,n,r,s,o){const i=jt.getSpanContext(e);return i&&it(i)?i.isRemote?i.traceFlags&xe.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,s,o):this._remoteParentNotSampled.shouldSample(e,t,n,r,s,o):i.traceFlags&xe.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,s,o):this._localParentNotSampled.shouldSample(e,t,n,r,s,o):this._root.shouldSample(e,t,n,r,s,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class PO{_ratio;_upperBound;constructor(e=0){this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(e,t){return{decision:st(t)&&this._accumulate(t)<this._upperBound?OO.RECORD_AND_SAMPLED:OO.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let t=0;for(let n=0;n<e.length/8;n++){const r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}function MO(){return{sampler:wO(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:cn("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:cn("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:cn("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:cn("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:cn("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:cn("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:cn("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:cn("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function wO(){const e=un("OTEL_TRACES_SAMPLER")??"parentbased_always_on";switch(e){case"always_on":return new CO;case"always_off":return new NO;case"parentbased_always_on":return new IO({root:new CO});case"parentbased_always_off":return new IO({root:new NO});case"traceidratio":return new PO(LO());case"parentbased_traceidratio":return new IO({root:new PO(LO())});default:return vt.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "parentbased_always_on".`),new IO({root:new CO})}}function LO(){const e=cn("OTEL_TRACES_SAMPLER_ARG");return null==e?(vt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1):e<0||e>1?(vt.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}const xO=1/0;class DO{generateTraceId=UO(16);generateSpanId=UO(8)}const kO=Buffer.allocUnsafe(16);function UO(e){return function(){for(let t=0;t<e/4;t++)kO.writeUInt32BE(Math.random()*2**32>>>0,4*t);for(let t=0;t<e&&!(kO[t]>0);t++)t===e-1&&(kO[e-1]=1);return kO.toString("hex",0,e)}}class $O{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(e,t,n,r){const s=function(e){const t={sampler:wO()},n=MO(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}(t);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=t.idGenerator||new DO,this._resource=n,this._spanProcessor=r,this.instrumentationScope=e}startSpan(e,t={},n=At.active()){t.root&&(n=jt.deleteSpan(n));const r=jt.getSpan(n);if(Zt(n)){vt.debug("Instrumentation suppressed, returning Noop Span");return jt.wrapSpanContext(Ke)}const s=r?.spanContext(),o=this._idGenerator.generateSpanId();let i,a,c;s&&jt.isSpanContextValid(s)?(a=s.traceId,c=s.traceState,i=s):a=this._idGenerator.generateTraceId();const u=t.kind??pt.INTERNAL,l=(t.links??[]).map(e=>({context:e.context,attributes:en(e.attributes)})),p=en(t.attributes),d=this._sampler.shouldSample(n,a,e,u,p,l);c=d.traceState??c;const h={traceId:a,spanId:o,traceFlags:d.decision===lt.RECORD_AND_SAMPLED?xe.SAMPLED:xe.NONE,traceState:c};if(d.decision===lt.NOT_RECORD){vt.debug("Recording is off, propagating context in a non-recording span");return jt.wrapSpanContext(h)}const f=en(Object.assign(p,d.attributes));return new RO({resource:this._resource,scope:this.instrumentationScope,context:n,spanContext:h,name:e,kind:u,links:l,parentSpanContext:i,attributes:f,startTime:t.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,t,n,r){let s,o,i;if(arguments.length<2)return;2===arguments.length?i=t:3===arguments.length?(s=t,i=n):(s=t,o=n,i=r);const a=o??At.active(),c=this.startSpan(e,s,a),u=jt.setSpan(a,c);return At.with(u,i,void 0,c)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class GO{_spanProcessors;constructor(e){this._spanProcessors=e}forceFlush(){const e=[];for(const t of this._spanProcessors)e.push(t.forceFlush());return new Promise(t=>{Promise.all(e).then(()=>{t()}).catch(e=>{an(e||new Error("MultiSpanProcessor: forceFlush failed")),t()})})}onStart(e,t){for(const n of this._spanProcessors)n.onStart(e,t)}onEnd(e){for(const t of this._spanProcessors)t.onEnd(e)}shutdown(){const e=[];for(const t of this._spanProcessors)e.push(t.shutdown());return new Promise((t,n)=>{Promise.all(e).then(()=>{t()},n)})}}var jO;!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(jO||(jO={}));class VO{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(e={}){const t=Um({},MO(),function(e){const t=Object.assign({},e.spanLimits);return t.attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??cn("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??cn("OTEL_ATTRIBUTE_COUNT_LIMIT")??128,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??cn("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??cn("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??xO,Object.assign({},e,{spanLimits:t})}(e));this._resource=t.resource??vO(),this._config=Object.assign({},t,{resource:this._resource});const n=[];e.spanProcessors?.length&&n.push(...e.spanProcessors),this._activeSpanProcessor=new GO(n)}getTracer(e,t,n){const r=`${e}@${t||""}:${n?.schemaUrl||""}`;return this._tracers.has(r)||this._tracers.set(r,new $O({name:e,version:t,schemaUrl:n?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(r)}forceFlush(){const e=this._config.forceFlushTimeoutMillis,t=this._activeSpanProcessor._spanProcessors.map(t=>new Promise(n=>{let r;const s=setTimeout(()=>{n(new Error(`Span processor did not completed within timeout period of ${e} ms`)),r=jO.timeout},e);t.forceFlush().then(()=>{clearTimeout(s),r!==jO.timeout&&(r=jO.resolved,n(r))}).catch(e=>{clearTimeout(s),r=jO.error,n(e)})}));return new Promise((e,n)=>{Promise.all(t).then(t=>{const r=t.filter(e=>e!==jO.resolved);r.length>0?n(r):e()}).catch(e=>n([e]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}const HO="sentry.parentIsRemote",BO="sentry.graphql.operation";function FO(e){return"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0}function YO(e){const t=e;return!!t.attributes&&"object"==typeof t.attributes}function qO(e){return!!e.name}const KO="sentry-trace",WO="baggage",ZO="sentry.dsc",XO="sentry.sampled_not_recording",zO="sentry.url",QO=ce("sentry_scopes"),JO=ce("sentry_fork_isolation_scope"),eN=ce("sentry_fork_set_scope"),tN=ce("sentry_fork_set_isolation_scope"),nN="_scopeContext";function rN(e){return e.getValue(QO)}function sN(e,t){return e.setValue(QO,t)}function oN(e){return e[nN]}function iN(e){const{traceFlags:t,traceState:n}=e,r=!!n&&"1"===n.get(XO);if(t===xe.SAMPLED)return!0;if(r)return!1;const s=n?n.get(ZO):void 0,o=s?Zy(s):void 0;return"true"===o?.sampled||"false"!==o?.sampled&&void 0}function aN(e,t,n){const r=t[F_]||t[jo];if(r)return function({name:e,kind:t,attributes:n},r){const s=["http"];switch(t){case pt.CLIENT:s.push("client");break;case pt.SERVER:s.push("server")}n["sentry.http.prefetch"]&&s.push("prefetch");const{urlPath:o,url:i,query:a,fragment:c,hasRoute:u}=function(e,t){const n=e[Ho],r=e[Vo]||e[tm],s=e[q_],o="string"==typeof r?ub(r):void 0,i=o?pb(o):void 0,a=o?.search||void 0,c=o?.hash||void 0;if("string"==typeof s)return{urlPath:s,url:i,query:a,fragment:c,hasRoute:!0};if(t===pt.SERVER&&"string"==typeof n)return{urlPath:lb(n),url:i,query:a,fragment:c,hasRoute:!1};if(o)return{urlPath:i,url:i,query:a,fragment:c,hasRoute:!1};if("string"==typeof n)return{urlPath:lb(n),url:i,query:a,fragment:c,hasRoute:!1};return{urlPath:void 0,url:i,query:a,fragment:c,hasRoute:!1}}(n,t);if(!o)return{...uN(e,n),op:s.join(".")};const l=n[BO],p=`${r} ${o}`,d=l?`${p} (${function(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}(l)})`:p,h=u||"/"===o?"route":"url",f={};i&&(f.url=i);a&&(f["http.query"]=a);c&&(f["http.fragment"]=c);const _=t===pt.CLIENT||t===pt.SERVER,m=n[$y]||"manual",g=!`${m}`.startsWith("auto"),E="custom"===n[Dy],S=n[Gy],T=!E&&null==S&&(_||!g),{description:y,source:A}=T?{description:d,source:h}:uN(e,n);return{op:s.join("."),description:y,source:A,data:f}}({attributes:t,name:e,kind:n},r);const s=t[xs],o="string"==typeof t[Uy]&&t[Uy].startsWith("cache.");if(s&&!o)return function({attributes:e,name:t}){const n=e[Gy];if("string"==typeof n)return{op:"db",description:n,source:e[Dy]||"custom"};if("custom"===e[Dy])return{op:"db",description:t,source:"custom"};const r=e[Gs],s=r?r.toString():t;return{op:"db",description:s,source:"task"}}({attributes:t,name:e});const i="custom"===t[Dy]?"custom":"route";if(t[Bi])return{...uN(e,t,"route"),op:"rpc"};if(t[vi])return{...uN(e,t,i),op:"message"};const a=t[so];return a?{...uN(e,t,i),op:a.toString()}:{op:void 0,description:e,source:"custom"}}function cN(e){const t=YO(e)?e.attributes:{},n=qO(e)?e.name:"<unknown>",r=function(e){return function(e){return"number"==typeof e.kind}(e)?e.kind:pt.INTERNAL}(e);return aN(n,t,r)}function uN(e,t,n="custom"){const r=t[Dy]||n,s=t[Gy];return s&&"string"==typeof s?{description:s,source:r}:{description:e,source:r}}function lN(){return jt.getActiveSpan()}const pN="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function dN({dsc:e,sampled:t}){const n=e?Xy(e):void 0,r=new Sm,s=n?r.set(ZO,n):r;return!1===t?s.set(XO,"1"):s}const hN=new Set;function fN(e){hN.add(e)}class _N extends Jt{constructor(){super(),fN("SentryPropagator"),this._urlMatchesTargetsMap=new lO(100)}inject(e,t,n){if(Zt(e))return void(pN&&TT.log("[Tracing] Not injecting trace data for url because tracing is suppressed."));const r=jt.getSpan(e),s=r&&function(e){const t=mA(e).data,n=t[Vo]||t[tm];if("string"==typeof n)return n;const r=e.spanContext().traceState?.get(zO);if(r)return r;return}(r),o=Ly()?.getOptions()?.tracePropagationTargets;if(!gN(s,o,this._urlMatchesTargetsMap))return void(pN&&TT.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",s));const i=function(e){try{const t=e[WO];return Array.isArray(t)?t.join(","):t}catch{return}}(t);let a=Ut.getBaggage(e)||Ut.createBaggage({});const{dynamicSamplingContext:c,traceId:u,spanId:l,sampled:p}=EN(e);if(i){const e=zy(i);e&&Object.entries(e).forEach(([e,t])=>{a=a.setEntry(e,{value:t})})}c&&(a=Object.entries(c).reduce((e,[t,n])=>n?e.setEntry(`${Ky}${t}`,{value:n}):e,a)),u&&u!==qe&&n.set(t,KO,uA(u,l,p)),super.inject(Ut.setBaggage(e,a),t,n)}extract(e,t,n){const r=n.get(t,KO),s=n.get(t,WO);return TN(SN(e,{sentryTrace:r?Array.isArray(r)?r[0]:r:void 0,baggage:s}))}fields(){return[KO,WO]}}const mN="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function gN(e,t,n){if("string"!=typeof e||!t)return!0;const r=n?.get(e);if(void 0!==r)return pN&&!r&&TT.log(mN,e),r;const s=zT(e,t);return n?.set(e,s),pN&&!s&&TT.log(mN,e),s}function EN(e,t={}){const n=jt.getSpan(e);if(n?.spanContext().isRemote){const e=n.spanContext();return{dynamicSamplingContext:LA(n),traceId:e.traceId,spanId:void 0,sampled:iN(e)}}if(n){const e=n.spanContext();return{dynamicSamplingContext:LA(n),traceId:e.traceId,spanId:e.spanId,sampled:iN(e)}}const r=t.scope||rN(e)?.scope||Py(),s=t.client||Ly(),o=r.getPropagationContext();return{dynamicSamplingContext:s?wA(s,r):void 0,traceId:o.traceId,spanId:o.propagationSpanId,sampled:o.sampled}}function SN(e,{sentryTrace:t,baggage:n}){const r=cA(t,n),{traceId:s,parentSpanId:o,sampled:i,dsc:a}=r,c=Ly(),u=Zy(n);if(!o||c&&!function(e,t){const n=sA(e);return t&&n&&t!==n?(TT.log(`Won't continue trace because org IDs don't match (incoming baggage: ${t}, SDK options: ${n})`),!1):!e.getOptions().strictTraceContinuation||!(t&&!n||!t&&n)||(TT.log(`Starting a new trace because strict trace continuation is enabled but one org ID is missing (incoming baggage: ${t}, Sentry client: ${n})`),!1)}(c,u?.org_id))return e;const l=function({spanId:e,traceId:t,sampled:n,dsc:r}){const s=dN({dsc:r,sampled:n}),o={traceId:t,spanId:e,isRemote:!0,traceFlags:n?xe.SAMPLED:xe.NONE,traceState:s};return o}({traceId:s,spanId:o,sampled:i,dsc:a});return jt.setSpanContext(e,l)}function TN(e){const t=rN(e);return sN(e,{scope:t?t.scope:Py().clone(),isolationScope:t?t.isolationScope:My()})}function yN(e,t){const n=RN(),{name:r,parentSpan:s}=e;return IN(s)(()=>{const s=NN(e.scope,e.forceTransaction),o=e.onlyIfParent&&!jt.getSpan(s)?Wt(s):s,i=ON(e);return n.startActiveSpan(r,i,o,e=>sv(()=>t(e),()=>{void 0===mA(e).status&&e.setStatus({code:dt.ERROR})},()=>e.end()))})}function AN(e,t){const n=RN(),{name:r,parentSpan:s}=e;return IN(s)(()=>{const s=NN(e.scope,e.forceTransaction),o=e.onlyIfParent&&!jt.getSpan(s)?Wt(s):s,i=ON(e);return n.startActiveSpan(r,i,o,e=>sv(()=>t(e,()=>e.end()),()=>{void 0===mA(e).status&&e.setStatus({code:dt.ERROR})}))})}function vN(e){const t=RN(),{name:n,parentSpan:r}=e;return IN(r)(()=>{const r=NN(e.scope,e.forceTransaction),s=e.onlyIfParent&&!jt.getSpan(r)?Wt(r):r,o=ON(e);return t.startSpan(n,o,s)})}function bN(e,t){const n=e?jt.setSpan(At.active(),e):jt.deleteSpan(At.active());return At.with(n,()=>t(Py()))}function RN(){const e=Ly();return e?.tracer||jt.getTracer("@sentry/opentelemetry",lT)}function ON(e){const{startTime:t,attributes:n,kind:r,op:s,links:o}=e,i="number"==typeof t?(a=t)<9999999999?1e3*a:a:t;var a;return{attributes:s?{[Uy]:s,...n}:n,kind:r,links:o,startTime:i}}function NN(e,t){const n=function(e){if(e){const t=oN(e);if(t)return t}return At.active()}(e),r=jt.getSpan(n);if(!r)return n;if(!t)return n;const s=jt.deleteSpan(n),{spanId:o,traceId:i}=r.spanContext(),a=iN(r.spanContext()),c=dN({dsc:LA(AA(r)),sampled:a}),u={traceId:i,spanId:o,isRemote:!0,traceFlags:a?xe.SAMPLED:xe.NONE,traceState:c};return jt.setSpanContext(s,u)}function CN(e,t){return function(e,t,n){const r=TN(SN(e,t));return At.with(r,n)}(At.active(),e,t)}function IN(e){return void 0!==e?t=>bN(e,t):e=>e()}function PN(e){const t=Wt(At.active());return At.with(t,e)}function MN({span:e,scope:t,client:n}={}){let r=(t&&oN(t))??At.active();if(e){const{scope:t}=qy(e);r=t&&oN(t)||jt.setSpan(At.active(),e)}const{traceId:s,spanId:o,sampled:i,dynamicSamplingContext:a}=EN(r,{scope:t,client:n});return{"sentry-trace":uA(s,o,i),baggage:Xy(a)}}function wN(){function e(){const e=rN(At.active());return e||{scope:Ay(),isolationScope:vy()}}function t(){return e().scope}function n(){return e().isolationScope}var r;r={withScope:function(e){const n=At.active();return At.with(n,()=>e(t()))},withSetScope:function(e,t){const n=oN(e)||At.active();return At.with(n.setValue(eN,e),()=>t(e))},withSetIsolationScope:function(e,t){const r=At.active();return At.with(r.setValue(tN,e),()=>t(n()))},withIsolationScope:function(e){const t=At.active();return At.with(t.setValue(JO,!0),()=>e(n()))},getCurrentScope:t,getIsolationScope:n,startSpan:yN,startSpanManual:AN,startInactiveSpan:vN,getActiveSpan:lN,suppressTracing:PN,getTraceData:MN,continueTrace:CN,withActiveSpan:bN},dT(pT()).acs=r}function LN(e){return!0===e.attributes[HO]?void 0:FO(e)}function xN(e,t){const n=t.spanContext().spanId,r=LN(t);if(!r)return void DN(e,{id:n,span:t,children:[]});const s=function(e,t){const n=e.get(t);if(n)return n;return DN(e,{id:t,children:[]})}(e,r),o=DN(e,{id:n,span:t,parentNode:s,children:[]});s.children.push(o)}function DN(e,t){const n=e.get(t.id);return n?.span?n:n&&!n.span?(n.span=t.span,n.parentNode=t.parentNode,n):(e.set(t.id,t),t)}const kN={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"};function UN(e){const t=YO(e)?e.attributes:{},n=function(e){return!!e.status}(e)?e.status:void 0;if(n){if(n.code===dt.OK)return{code:1};if(n.code===dt.ERROR){if(void 0===n.message){const e=$N(t);if(e)return e}return n.message&&(r=n.message,Object.values(kN).includes(r))?{code:2,message:n.message}:{code:2,message:"unknown_error"}}}var r;const s=$N(t);return s||(n?.code===dt.UNSET?{code:1}:{code:2,message:"unknown_error"})}function $N(e){const t=e[Y_]||e[Yo],n=e[Yi],r="number"==typeof t?t:"string"==typeof t?parseInt(t):void 0;return"number"==typeof r?function(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"unknown_error"}}(r):"string"==typeof n?{code:2,message:kN[n]||"unknown_error"}:void 0}class GN{constructor(e){this._finishedSpanBucketSize=e?.timeout||300,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap,this._sentSpans=new Map,this._debouncedFlush=function(e,t,n){let r,s,o;const i=n?.maxWait?Math.max(n.maxWait,t):0,a=n?.setTimeoutImpl||setTimeout;function c(){return u(),r=e(),r}function u(){void 0!==s&&clearTimeout(s),void 0!==o&&clearTimeout(o),s=o=void 0}function l(){return s&&clearTimeout(s),s=a(c,t),i&&void 0===o&&(o=a(c,i)),r}return l.cancel=u,l.flush=function(){return void 0!==s||void 0!==o?c():r},l}(this.flush.bind(this),1,{maxWait:100})}export(e){const t=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==t){let e=0;this._finishedSpanBuckets.forEach((n,r)=>{n&&n.timestampInS<=t-this._finishedSpanBucketSize&&(e+=n.spans.size,this._finishedSpanBuckets[r]=void 0)}),e>0&&pN&&TT.log(`SpanExporter dropped ${e} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=t}const n=t%this._finishedSpanBucketSize,r=this._finishedSpanBuckets[n]||{timestampInS:t,spans:new Set};this._finishedSpanBuckets[n]=r,r.spans.add(e),this._spansToBucketEntry.set(e,r);const s=LN(e);s&&!this._sentSpans.has(s)||this._debouncedFlush()}flush(){const e=this._finishedSpanBuckets.flatMap(e=>e?Array.from(e.spans):[]);this._flushSentSpanCache();const t=this._maybeSend(e),n=t.size,r=e.length-n;pN&&TT.log(`SpanExporter exported ${n} spans, ${r} spans are waiting for their parent spans to finish`);const s=Date.now()+3e5;for(const e of t){this._sentSpans.set(e.spanContext().spanId,s);const t=this._spansToBucketEntry.get(e);t&&t.spans.delete(e)}this._debouncedFlush.cancel()}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._sentSpans.clear(),this._debouncedFlush.cancel()}_maybeSend(e){const t=function(e){const t=new Map;for(const n of e)xN(t,n);return Array.from(t,function([e,t]){return t})}(e),n=new Set,r=this._getCompletedRootNodes(t);for(const e of r){const t=e.span;n.add(t);const r=jN(t);if(e.parentNode&&this._sentSpans.has(e.parentNode.id)){const e=r.contexts?.trace?.data;e&&(e["sentry.parent_span_already_sent"]=!0)}const s=r.spans||[];for(const t of e.children)VN(t,s,n);r.spans=s.length>1e3?s.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,1e3):s;const o=ev(t.events);o&&(r.measurements=o),Mv(r)}return n}_flushSentSpanCache(){const e=Date.now();for(const[t,n]of this._sentSpans.entries())n<=e&&this._sentSpans.delete(t)}_nodeIsCompletedRootNodeOrHasSentParent(e){return!!e.span&&(!e.parentNode||this._sentSpans.has(e.parentNode.id))}_getCompletedRootNodes(e){return e.filter(e=>this._nodeIsCompletedRootNodeOrHasSentParent(e))}}function jN(e){const{op:t,description:n,data:r,origin:s="manual",source:o}=HN(e),i=qy(e),a=e.attributes[ky],c={[Dy]:o,[ky]:a,[Uy]:t,[$y]:s,...r,...BN(e.attributes)},{links:u}=e,{traceId:l,spanId:p}=e.spanContext(),d={parent_span_id:FO(e),span_id:p,trace_id:l,data:c,origin:s,op:t,status:EA(UN(e)),links:hA(u)},h=c[Y_],f="number"==typeof h?{response:{status_code:h}}:void 0;return{contexts:{trace:d,otel:{resource:e.resource.attributes},...f},spans:[],start_timestamp:fA(e.startTime),timestamp:fA(e.endTime),transaction:n,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:i.scope,capturedSpanIsolationScope:i.isolationScope,sampleRate:a,dynamicSamplingContext:LA(e)},...o&&{transaction_info:{source:o}}}}function VN(e,t,n){const r=e.span;r&&n.add(r);if(!r)return void e.children.forEach(e=>{VN(e,t,n)});const s=r.spanContext().spanId,o=r.spanContext().traceId,i=FO(r),{attributes:a,startTime:c,endTime:u,links:l}=r,{op:p,description:d,data:h,origin:f="manual"}=HN(r),_={[$y]:f,[Uy]:p,...BN(a),...h},m=UN(r),g={span_id:s,trace_id:o,data:_,description:d,parent_span_id:i,start_timestamp:fA(c),timestamp:fA(u)||void 0,status:EA(m),op:p,origin:f,measurements:ev(r.events),links:hA(l)};t.push(g),e.children.forEach(e=>{VN(e,t,n)})}function HN(e){const{op:t,source:n,origin:r}=function(e){const t=e.attributes;return{origin:t[$y],op:t[Uy],source:t[Dy]}}(e),{op:s,description:o,source:i,data:a}=cN(e);return{op:t||s,description:o,source:n||i,origin:r,data:{...a,...FN(e)}}}function BN(e){const t={...e};return delete t[ky],delete t[HO],delete t[Gy],t}function FN(e){const t=e.attributes,n={};e.kind!==pt.INTERNAL&&(n["otel.kind"]=pt[e.kind]);const r=t[Yo];r&&(n[Y_]=r);const s=function(e){if(!YO(e))return{};const t=e.attributes[tm]||e.attributes[Vo],n={url:t,"http.method":e.attributes[F_]||e.attributes[jo]};!n["http.method"]&&n.url&&(n["http.method"]="GET");try{if("string"==typeof t){const e=ub(t);n.url=pb(e),e.search&&(n["http.query"]=e.search),e.hash&&(n["http.fragment"]=e.hash)}}catch{}return n}(e);return s.url&&(n.url=s.url),s["http.query"]&&(n["http.query"]=s["http.query"].slice(1)),s["http.fragment"]&&(n["http.fragment"]=s["http.fragment"].slice(1)),n}class YN{constructor(e){fN("SentrySpanProcessor"),this._exporter=new GN(e)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(e,t){!function(e,t){const n=jt.getSpan(t);let r=rN(t);n&&!n.spanContext().isRemote&&yA(n,e),n?.spanContext().isRemote&&e.setAttribute(HO,!0),t===de&&(r={scope:Ay(),isolationScope:vy()}),r&&Yy(e,r.scope,r.isolationScope),QA(e);const s=Ly();s?.emit("spanStart",e)}(e,t)}onEnd(e){!function(e){JA(e);const t=Ly();t?.emit("spanEnd",e)}(e),this._exporter.export(e)}}class qN{constructor(e){this._client=e,fN("SentrySampler")}shouldSample(e,t,n,r,s,o){const i=this._client.getOptions(),a=function(e){const t=jt.getSpan(e);return t&&it(t.spanContext())?t:void 0}(e),c=a?.spanContext();if(!NA(i))return KN({decision:void 0,context:e,spanAttributes:s});const u=s[jo]||s[F_];if(r===pt.CLIENT&&u&&(!a||c?.isRemote))return KN({decision:void 0,context:e,spanAttributes:s});const l=a?function(e,t,n){const r=e.spanContext();if(it(r)&&r.traceId===t){if(r.isRemote){const t=iN(e.spanContext());return pN&&TT.log(`[Tracing] Inheriting remote parent's sampled decision for ${n}: ${t}`),t}const t=iN(r);return pN&&TT.log(`[Tracing] Inheriting parent's sampled decision for ${n}: ${t}`),t}return}(a,t,n):void 0;if(!(!a||c?.isRemote))return KN({decision:l?OO.RECORD_AND_SAMPLED:OO.NOT_RECORD,context:e,spanAttributes:s});const{description:p,data:d,op:h}=aN(n,s,r),f={...d,...s};h&&(f[Uy]=h);const _={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:f,spanName:p,parentSampled:l,parentContext:c},_),!_.decision)return KN({decision:void 0,context:e,spanAttributes:s});const{isolationScope:m}=rN(e)??{},g=c?.traceState?c.traceState.get(ZO):void 0,E=g?Zy(g):void 0,S=iA(E?.sample_rand)??Math.random(),[T,y,A]=ov(i,{name:p,attributes:f,normalizedRequest:m?.getScopeData().sdkProcessingMetadata.normalizedRequest,parentSampled:l,parentSampleRate:iA(E?.sample_rate)},S),v=`${u}`.toUpperCase();return"OPTIONS"===v||"HEAD"===v?(pN&&TT.log(`[Tracing] Not sampling span because HTTP method is '${v}' for ${n}`),KN({decision:OO.NOT_RECORD,context:e,spanAttributes:s,sampleRand:S,downstreamTraceSampleRate:0})):(T||void 0!==l||(pN&&TT.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),this._client.recordDroppedEvent("sample_rate","transaction")),{...KN({decision:T?OO.RECORD_AND_SAMPLED:OO.NOT_RECORD,context:e,spanAttributes:s,sampleRand:S,downstreamTraceSampleRate:A?y:void 0}),attributes:{[ky]:A?y:void 0}})}toString(){return"SentrySampler"}}function KN({decision:e,context:t,spanAttributes:n,sampleRand:r,downstreamTraceSampleRate:s}){let o=function(e,t){const n=jt.getSpan(e),r=n?.spanContext();let s=r?.traceState||new Sm;const o=t[Vo]||t[tm];o&&"string"==typeof o&&(s=s.set(zO,o));return s}(t,n);return void 0!==s&&(o=o.set("sentry.sample_rate",`${s}`)),void 0!==r&&(o=o.set("sentry.sample_rand",`${r}`)),null==e?{decision:OO.NOT_RECORD,traceState:o}:e===OO.NOT_RECORD?{decision:e,traceState:o.set(XO,"1")}:{decision:e,traceState:o}}function WN(e,t){if(!e)return t;const n=zy(e),r=zy(t);if(!r)return e;const s={...n};return Object.entries(r).forEach(([e,t])=>{s[e]||(s[e]=t)}),Jy(s)}function ZN(e,t){const n=function(e){try{const t=e.getHeader("host")||e.host,n=ub(new URL(e.path,`${e.protocol}//${t}`).toString()),r={url:pb(n),"http.method":e.method||"GET"};return n.search&&(r["http.query"]=n.search),n.hash&&(r["http.fragment"]=n.hash),r}catch{return{}}}(e),r=t?.statusCode;Eb({category:"http",data:{status_code:r,...n},type:"http",level:iO(r)},{event:"response",request:e,response:t})}class XN extends IS{constructor(e={}){super(mO,lT,e),this._propagationDecisionMap=new lO(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){let e=!1;const t=e=>{SO(e.server,{ignoreIncomingRequestBody:this.getConfig().ignoreIncomingRequestBody,maxIncomingRequestBodySize:this.getConfig().maxIncomingRequestBodySize,trackIncomingRequestsAsSessions:this.getConfig().trackIncomingRequestsAsSessions,sessionFlushingDelayMS:this.getConfig().sessionFlushingDelayMS??6e4})},n=e=>{const t=e;this._onOutgoingRequestFinish(t.request,t.response)},r=e=>{const t=e;this._onOutgoingRequestFinish(t.request,void 0)},s=e=>{const t=e;this._onOutgoingRequestCreated(t.request)},o=o=>(e||(e=!0,p.subscribe("http.server.request.start",t),p.subscribe("http.client.response.finish",n),p.subscribe("http.client.request.error",r),this.getConfig().propagateTraceInOutgoingRequests&&p.subscribe("http.client.request.created",s)),o),i=()=>{p.unsubscribe("http.server.request.start",t),p.unsubscribe("http.client.response.finish",n),p.unsubscribe("http.client.request.error",r),p.unsubscribe("http.client.request.created",s)};return[new MS("http",["*"],o,i),new MS("https",["*"],o,i)]}_onOutgoingRequestFinish(e,t){fO&&TT.log(mO,"Handling finished outgoing request");const n=this.getConfig().breadcrumbs,r=void 0===n||n,s=this._ignoreOutgoingRequestsMap.get(e)??this._shouldIgnoreOutgoingRequest(e);this._ignoreOutgoingRequestsMap.set(e,s),r&&!s&&ZN(e,t)}_onOutgoingRequestCreated(e){const t=this._ignoreOutgoingRequestsMap.get(e)??this._shouldIgnoreOutgoingRequest(e);this._ignoreOutgoingRequestsMap.set(e,t),t||function(e,t){const n=function(e){const t=e.getHeader("host")||e.host;return`${e.protocol}//${t}${e.path}`}(e),r=Ly()?.getOptions().tracePropagationTargets,s=gN(n,r,t)?hb():void 0;if(!s)return;const{"sentry-trace":o,baggage:i}=s;if(o&&!e.getHeader("sentry-trace"))try{e.setHeader("sentry-trace",o),fO&&TT.log(mO,"Added sentry-trace header to outgoing request")}catch(e){fO&&TT.error(mO,"Failed to add sentry-trace header to outgoing request:",$T(e)?e.message:"Unknown error")}if(i){const t=WN(e.getHeader("baggage"),i);if(t)try{e.setHeader("baggage",t),fO&&TT.log(mO,"Added baggage header to outgoing request")}catch(e){fO&&TT.error(mO,"Failed to add baggage header to outgoing request:",$T(e)?e.message:"Unknown error")}}}(e,this._propagationDecisionMap)}_shouldIgnoreOutgoingRequest(e){if(Zt(At.active()))return!0;const t=this.getConfig().ignoreOutgoingRequests;if(!t)return!1;const n=function(e){return{method:e.method,protocol:e.protocol,host:e.host,hostname:e.host,path:e.path,headers:e.getHeaders()}}(e);return t(_O(e),n)}}const zN="Http",QN=dO(`${zN}.sentry`,e=>new XN(e)),JN=(e={})=>{const t=e.dropSpansForIncomingRequestStatusCodes??[[401,404],[300,399]];return{name:zN,setupOnce(){QN({...e,extractIncomingTraceFromHeader:!0,propagateTraceInOutgoingRequests:!0})},processEvent(e){if("transaction"===e.type){const n=e.contexts?.trace?.data?.["http.response.status_code"];if("number"==typeof n&&t.some(e=>{if("number"==typeof e)return e===n;const[t,r]=e;return n>=t&&n<=r}))return null}return e}}},eC=function(e){const t=e.match(ay)||[],n=cy(t[1]),r=cy(t[2]),s=cy(t[3]);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(s)?void 0:s,prerelease:t[4]}}(process.versions.node),tC=eC.major,nC=eC.minor,rC="sentry-trace",sC="baggage",oC=/baggage: (.*)\r\n/;class iC extends IS{constructor(e={}){super("@sentry/instrumentation-node-fetch",lT,e),this._channelSubs=[],this._propagationDecisionMap=new lO(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(e=>e.unsubscribe()),this._channelSubs=[]}enable(){super.enable(),this._channelSubs=this._channelSubs||[],this._channelSubs.length>0||(this._subscribeToChannel("undici:request:create",this._onRequestCreated.bind(this)),this._subscribeToChannel("undici:request:headers",this._onResponseHeaders.bind(this)))}_onRequestCreated({request:e}){if(!(!1!==this.getConfig().enabled))return;const t=this._shouldIgnoreOutgoingRequest(e);if(this._ignoreOutgoingRequestsMap.set(e,t),t)return;const n=aC(e.origin,e.path),r=Ly()?.getOptions().tracePropagationTargets,s=gN(n,r,this._propagationDecisionMap)?hb():void 0;if(!s)return;const{"sentry-trace":o,baggage:i}=s;if(Array.isArray(e.headers)){const t=e.headers;o&&!t.includes(rC)&&t.push(rC,o);const n=t.findIndex(e=>e===sC);if(i&&-1===n)t.push(sC,i);else if(i){const e=WN(t[n+1],i);e&&(t[n+1]=e)}}else{const t=e.headers;o&&!t.includes(`${rC}:`)&&(e.headers+=`${rC}: ${o}\r\n`);const n=e.headers.match(oC)?.[1];if(i&&!n)e.headers+=`${sC}: ${i}\r\n`;else if(i){const t=WN(n,i);t&&(e.headers=e.headers.replace(oC,`baggage: ${t}\r\n`))}}}_onResponseHeaders({request:e,response:t}){const n=this.getConfig();if(!(!1!==n.enabled))return;const r=n.breadcrumbs,s=void 0===r||r,o=this._ignoreOutgoingRequestsMap.get(e);s&&!o&&function(e,t){const n=function(e){try{const t=ub(aC(e.origin,e.path)),n={url:pb(t),"http.method":e.method||"GET"};return t.search&&(n["http.query"]=t.search),t.hash&&(n["http.fragment"]=t.hash),n}catch{return{}}}(e),r=t.statusCode,s=iO(r);Eb({category:"http",data:{status_code:r,...n},type:"http",level:s},{event:"response",request:e,response:t})}(e,t)}_subscribeToChannel(e,t){let n;if(tC>18||18===tC&&nC>=19)P.subscribe?.(e,t),n=()=>P.unsubscribe?.(e,t);else{const r=P.channel(e);r.subscribe(t),n=()=>r.unsubscribe(t)}this._channelSubs.push({name:e,unsubscribe:n})}_shouldIgnoreOutgoingRequest(e){if(Zt(At.active()))return!0;const t=aC(e.origin,e.path),n=this.getConfig().ignoreOutgoingRequests;return!("function"!=typeof n||!t)&&n(t)}}function aC(e,t="/"){try{return new URL(t,e).toString()}catch{const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:n.endsWith("/")||t.startsWith("/")?`${n}${t}`:`${n}/${t.slice(1)}`}}const cC=dO("NodeFetch.sentry",iC,e=>e),uC=(e={})=>({name:"NodeFetch",setupOnce(){cC(e)}}),lC=S.promisify(m.readFile),pC=S.promisify(m.readdir),dC=(e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(e){void 0===t&&(t=async function(){const e={};n.os&&(e.os=await async function(){const e=w.platform();switch(e){case"darwin":return async function(){const e={kernel_version:w.release(),name:"Mac OS X",version:"10."+(Number(w.release().split(".")[0])-4)};try{const t=await new Promise((e,t)=>{_.execFile("/usr/bin/sw_vers",(n,r)=>{n?t(n):e(r)})});e.name=mC(/^ProductName:\s+(.*)$/m,t),e.version=mC(/^ProductVersion:\s+(.*)$/m,t),e.build=mC(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}();case"linux":return async function(){const e={kernel_version:w.release(),name:"Linux"};try{const t=await pC("/etc"),n=fC.find(e=>t.includes(e.name));if(!n)return e;const r=E.join("/etc",n.name),s=(await lC(r,{encoding:"utf-8"})).toLowerCase(),{distros:o}=n;e.name=o.find(e=>s.indexOf(gC(e))>=0)||o[0];const i=gC(e.name);e.version=_C[i]?.(s)}catch{}return e}();default:return{name:hC[e]||e,version:w.release()}}}());n.app&&(e.app=function(){const e=process.memoryUsage().rss,t={app_start_time:new Date(Date.now()-1e3*process.uptime()).toISOString(),app_memory:e};if("function"==typeof process.availableMemory){const e=process.availableMemory?.();null!=e&&(t.free_memory=e)}return t}());n.device&&(e.device=function(e){const t={};let n;try{n=w.uptime()}catch{}"number"==typeof n&&(t.boot_time=new Date(Date.now()-1e3*n).toISOString());t.arch=w.arch(),(!0===e||e.memory)&&(t.memory_size=w.totalmem(),t.free_memory=w.freemem());if(!0===e||e.cpu){const e=w.cpus(),n=e?.[0];n&&(t.processor_count=e.length,t.cpu_description=n.model,t.processor_frequency=n.speed)}return t}(n.device));if(n.culture){const t=function(){try{if("string"!=typeof process.versions.icu)return;const e=new Date(9e8);if("enero"===new Intl.DateTimeFormat("es",{month:"long"}).format(e)){const e=Intl.DateTimeFormat().resolvedOptions();return{locale:e.locale,timezone:e.timeZone}}}catch{}return}();t&&(e.culture=t)}n.cloudResource&&(e.cloud_resource=process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0);return e}());const r=function(e){e.app?.app_memory&&(e.app.app_memory=process.memoryUsage().rss);if(e.app?.free_memory&&"function"==typeof process.availableMemory){const t=process.availableMemory?.();null!=t&&(e.app.free_memory=t)}e.device?.free_memory&&(e.device.free_memory=w.freemem());return e}(await t);return e.contexts={...e.contexts,app:{...r.app,...e.contexts?.app},os:{...r.os,...e.contexts?.os},device:{...r.device,...e.contexts?.device},culture:{...r.culture,...e.contexts?.culture},cloud_resource:{...r.cloud_resource,...e.contexts?.cloud_resource}},e}return{name:"Context",processEvent:e=>r(e)}};const hC={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows"},fC=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],_C={alpine:e=>e,arch:e=>mC(/distrib_release=(.*)/,e),centos:e=>mC(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>mC(/release (..)/,e),mint:e=>mC(/distrib_release=(.*)/,e),red:e=>mC(/release ([^ ]+)/,e),suse:e=>mC(/VERSION = (.*)\n/,e),ubuntu:e=>mC(/distrib_release=(.*)/,e)};function mC(e,t){const n=e.exec(t);return n?n[1]:void 0}function gC(e){return e.split(" ")[0].toLowerCase()}const EC=new lO(10),SC=new lO(20);function TC(e,t,n){const r=e.get(t);return void 0===r?(e.set(t,n),n):r}function yC(e){return!!e.startsWith("node:")||(!!e.endsWith(".min.js")||(!!e.endsWith(".min.cjs")||(!!e.endsWith(".min.mjs")||!!e.startsWith("data:"))))}function AC(e){return void 0!==e.lineno&&e.lineno>1e4||void 0!==e.colno&&e.colno>1e3}function vC(e,t){const n=EC.get(e);if(void 0===n)return!1;for(let e=t[0];e<=t[1];e++)if(void 0===n[e])return!1;return!0}function bC(e,t){if(!e.length)return[];let n=0;const r=e[0];if("number"!=typeof r)return[];let s=MC(r,t);const o=[];for(;;){if(n===e.length-1){o.push(s);break}const r=e[n+1];if("number"!=typeof r)break;r<=s[1]?s[1]=r+t:(o.push(s),s=MC(r,t)),n++}return o}function RC(e,t,n){return new Promise((r,s)=>{const o=m.createReadStream(e),i=T.createInterface({input:o});function a(){o.destroy(),r()}let c=0,u=0;const l=t[u];if(void 0===l)return void a();let p=l[0],d=l[1];function h(t){SC.set(e,1),fO&&TT.error(`Failed to read file: ${e}. Error: ${t}`),i.close(),i.removeAllListeners(),a()}o.on("error",h),i.on("error",h),i.on("close",a),i.on("line",e=>{if(c++,!(c<p)&&(n[c]=function(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let s=Math.max(t-60,0);s<5&&(s=0);let o=Math.min(s+140,r);return o>r-5&&(o=r),o===r&&(s=Math.max(o-140,0)),n=n.slice(s,o),s>0&&(n=`'{snip} ${n}`),o<r&&(n+=" {snip}"),n}(e,0),c>=d)){if(u===t.length-1)return i.close(),void i.removeAllListeners();u++;const e=t[u];if(void 0===e)return i.close(),void i.removeAllListeners();p=e[0],d=e[1]}})})}function OC(e,t,n){for(const r of e)if(r.filename&&void 0===r.context_line&&"number"==typeof r.lineno){const e=n.get(r.filename);if(void 0===e)continue;CC(r.lineno,r,t,e)}}function NC(e){delete e.pre_context,delete e.context_line,delete e.post_context}function CC(e,t,n,r){if(void 0===t.lineno||void 0===r)return void(fO&&TT.error("Cannot resolve context for frame with no lineno or file contents"));t.pre_context=[];for(let s=IC(e,n);s<e;s++){const e=r[s];if(void 0===e)return NC(t),void(fO&&TT.error(`Could not find line ${s} in file ${t.filename}`));t.pre_context.push(e)}if(void 0===r[e])return NC(t),void(fO&&TT.error(`Could not find line ${e} in file ${t.filename}`));t.context_line=r[e];const s=PC(e,n);t.post_context=[];for(let n=e+1;n<=s;n++){const e=r[n];if(void 0===e)break;t.post_context.push(e)}}function IC(e,t){return Math.max(1,e-t)}function PC(e,t){return e+t}function MC(e,t){return[IC(e,t),PC(e,t)]}const wC=(e={})=>{const t=void 0!==e.frameContextLines?e.frameContextLines:7;return{name:"ContextLines",processEvent:e=>async function(e,t){const n={};if(t>0&&e.exception?.values)for(const t of e.exception.values)if(t.stacktrace?.frames?.length)for(let e=t.stacktrace.frames.length-1;e>=0;e--){const r=t.stacktrace.frames[e],s=r?.filename;!r||"string"!=typeof s||"number"!=typeof r.lineno||yC(s)||AC(r)||(n[s]||(n[s]=[]),n[s].push(r.lineno))}const r=Object.keys(n);if(0==r.length)return e;const s=[];for(const e of r){if(SC.get(e))continue;const r=n[e];if(!r)continue;r.sort((e,t)=>e-t);const o=bC(r,t);if(o.every(t=>vC(e,t)))continue;const i=TC(EC,e,{});s.push(RC(e,o,i))}if(await Promise.all(s).catch(()=>{fO&&TT.log("Failed to read one or more source files and resolve context lines")}),t>0&&e.exception?.values)for(const n of e.exception.values)n.stacktrace?.frames&&n.stacktrace.frames.length>0&&OC(n.stacktrace.frames,t,EC);return e}(e,t)}};let LC;async function xC(){if(void 0===LC)try{const e=await import("node:inspector");LC=!!e.url()}catch{LC=!1}return LC}const DC="__SENTRY_ERROR_LOCAL_VARIABLES__";function kC(e){return void 0!==e&&(0===e.length||"?"===e||"<anonymous>"===e)}function UC(e,t){return e===t||`Object.${e}`===t||e===`Object.${t}`||kC(e)&&kC(t)}function $C(...e){TT.log("[LocalVariables]",...e)}const GC=(e={})=>{function t(e,t){const n=(e.stacktrace?.frames||[]).filter(e=>"new Promise"!==e.function);for(let e=0;e<n.length;e++){const r=n.length-e-1,s=t[e],o=n[r];if(!o||!s)break;void 0!==s.vars&&!1!==o.in_app&&UC(o.function,s.function)&&(o.vars=s.vars)}}return{name:"LocalVariablesAsync",async setup(t){if(!t.getOptions().includeLocalVariables)return;if(await xC())return void TT.warn("Local variables capture has been disabled because the debugger was already enabled");const n={...e,debug:TT.isEnabled()};(async function(){const e=await import("node:inspector");e.url()||e.open(0)})().then(()=>{try{!function(e){const t=new y.Worker(new URL("data:application/javascript;base64,LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjguMCAoYmQ4NDU4ZSkgfCBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0ICovCmltcG9ydHtTZXNzaW9uIGFzIGV9ZnJvbSJub2RlOmluc3BlY3Rvci9wcm9taXNlcyI7aW1wb3J0e3dvcmtlckRhdGEgYXMgdH1mcm9tIm5vZGU6d29ya2VyX3RocmVhZHMiO2NvbnN0IG49Z2xvYmFsVGhpcyxpPXt9O2NvbnN0IG89Il9fU0VOVFJZX0VSUk9SX0xPQ0FMX1ZBUklBQkxFU19fIjtjb25zdCBhPXQ7ZnVuY3Rpb24gcyguLi5lKXthLmRlYnVnJiZmdW5jdGlvbihlKXtpZighKCJjb25zb2xlImluIG4pKXJldHVybiBlKCk7Y29uc3QgdD1uLmNvbnNvbGUsbz17fSxhPU9iamVjdC5rZXlzKGkpO2EuZm9yRWFjaChlPT57Y29uc3Qgbj1pW2VdO29bZV09dFtlXSx0W2VdPW59KTt0cnl7cmV0dXJuIGUoKX1maW5hbGx5e2EuZm9yRWFjaChlPT57dFtlXT1vW2VdfSl9fSgoKT0+Y29uc29sZS5sb2coIltMb2NhbFZhcmlhYmxlcyBXb3JrZXJdIiwuLi5lKSl9YXN5bmMgZnVuY3Rpb24gYyhlLHQsbixpKXtjb25zdCBvPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSk7aVtuXT1vLnJlc3VsdC5maWx0ZXIoZT0+Imxlbmd0aCIhPT1lLm5hbWUmJiFpc05hTihwYXJzZUludChlLm5hbWUsMTApKSkuc29ydCgoZSx0KT0+cGFyc2VJbnQoZS5uYW1lLDEwKS1wYXJzZUludCh0Lm5hbWUsMTApKS5tYXAoZT0+ZS52YWx1ZT8udmFsdWUpfWFzeW5jIGZ1bmN0aW9uIHIoZSx0LG4saSl7Y29uc3Qgbz1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pO2lbbl09by5yZXN1bHQubWFwKGU9PltlLm5hbWUsZS52YWx1ZT8udmFsdWVdKS5yZWR1Y2UoKGUsW3Qsbl0pPT4oZVt0XT1uLGUpLHt9KX1mdW5jdGlvbiB1KGUsdCl7ZS52YWx1ZSYmKCJ2YWx1ZSJpbiBlLnZhbHVlP3ZvaWQgMD09PWUudmFsdWUudmFsdWV8fG51bGw9PT1lLnZhbHVlLnZhbHVlP3RbZS5uYW1lXT1gPCR7ZS52YWx1ZS52YWx1ZX0+YDp0W2UubmFtZV09ZS52YWx1ZS52YWx1ZToiZGVzY3JpcHRpb24iaW4gZS52YWx1ZSYmImZ1bmN0aW9uIiE9PWUudmFsdWUudHlwZT90W2UubmFtZV09YDwke2UudmFsdWUuZGVzY3JpcHRpb259PmA6InVuZGVmaW5lZCI9PT1lLnZhbHVlLnR5cGUmJih0W2UubmFtZV09Ijx1bmRlZmluZWQ+IikpfWFzeW5jIGZ1bmN0aW9uIGwoZSx0KXtjb25zdCBuPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSksaT17fTtmb3IoY29uc3QgdCBvZiBuLnJlc3VsdClpZih0LnZhbHVlPy5vYmplY3RJZCYmIkFycmF5Ij09PXQudmFsdWUuY2xhc3NOYW1lKXtjb25zdCBuPXQudmFsdWUub2JqZWN0SWQ7YXdhaXQgYyhlLG4sdC5uYW1lLGkpfWVsc2UgaWYodC52YWx1ZT8ub2JqZWN0SWQmJiJPYmplY3QiPT09dC52YWx1ZS5jbGFzc05hbWUpe2NvbnN0IG49dC52YWx1ZS5vYmplY3RJZDthd2FpdCByKGUsbix0Lm5hbWUsaSl9ZWxzZSB0LnZhbHVlJiZ1KHQsaSk7cmV0dXJuIGl9bGV0IGY7KGFzeW5jIGZ1bmN0aW9uKCl7Y29uc3QgdD1uZXcgZTt0LmNvbm5lY3RUb01haW5UaHJlYWQoKSxzKCJDb25uZWN0ZWQgdG8gbWFpbiB0aHJlYWQiKTtsZXQgbj0hMTt0Lm9uKCJEZWJ1Z2dlci5yZXN1bWVkIiwoKT0+e249ITF9KSx0Lm9uKCJEZWJ1Z2dlci5wYXVzZWQiLGU9PntuPSEwLGFzeW5jIGZ1bmN0aW9uKGUse3JlYXNvbjp0LGRhdGE6e29iamVjdElkOm59LGNhbGxGcmFtZXM6aX0pe2lmKCJleGNlcHRpb24iIT09dCYmInByb21pc2VSZWplY3Rpb24iIT09dClyZXR1cm47aWYoZj8uKCksbnVsbD09bilyZXR1cm47Y29uc3QgYT1bXTtmb3IobGV0IHQ9MDt0PGkubGVuZ3RoO3QrKyl7Y29uc3R7c2NvcGVDaGFpbjpuLGZ1bmN0aW9uTmFtZTpvLHRoaXM6c309aVt0XSxjPW4uZmluZChlPT4ibG9jYWwiPT09ZS50eXBlKSxyPSJnbG9iYWwiIT09cy5jbGFzc05hbWUmJnMuY2xhc3NOYW1lP2Ake3MuY2xhc3NOYW1lfS4ke299YDpvO2lmKHZvaWQgMD09PWM/Lm9iamVjdC5vYmplY3RJZClhW3RdPXtmdW5jdGlvbjpyfTtlbHNle2NvbnN0IG49YXdhaXQgbChlLGMub2JqZWN0Lm9iamVjdElkKTthW3RdPXtmdW5jdGlvbjpyLHZhcnM6bn19fWF3YWl0IGUucG9zdCgiUnVudGltZS5jYWxsRnVuY3Rpb25PbiIse2Z1bmN0aW9uRGVjbGFyYXRpb246YGZ1bmN0aW9uKCkgeyB0aGlzLiR7b30gPSB0aGlzLiR7b30gfHwgJHtKU09OLnN0cmluZ2lmeShhKX07IH1gLHNpbGVudDohMCxvYmplY3RJZDpufSksYXdhaXQgZS5wb3N0KCJSdW50aW1lLnJlbGVhc2VPYmplY3QiLHtvYmplY3RJZDpufSl9KHQsZS5wYXJhbXMpLnRoZW4oYXN5bmMoKT0+e24mJmF3YWl0IHQucG9zdCgiRGVidWdnZXIucmVzdW1lIil9LGFzeW5jIGU9PntuJiZhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpfSl9KSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLmVuYWJsZSIpO2NvbnN0IGk9ITEhPT1hLmNhcHR1cmVBbGxFeGNlcHRpb25zO2lmKGF3YWl0IHQucG9zdCgiRGVidWdnZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMiLHtzdGF0ZTppPyJhbGwiOiJ1bmNhdWdodCJ9KSxpKXtjb25zdCBlPWEubWF4RXhjZXB0aW9uc1BlclNlY29uZHx8NTA7Zj1mdW5jdGlvbihlLHQsbil7bGV0IGk9MCxvPTUsYT0wO3JldHVybiBzZXRJbnRlcnZhbCgoKT0+ezA9PT1hP2k+ZSYmKG8qPTIsbihvKSxvPjg2NDAwJiYobz04NjQwMCksYT1vKTooYS09MSwwPT09YSYmdCgpKSxpPTB9LDFlMykudW5yZWYoKSwoKT0+e2krPTF9fShlLGFzeW5jKCk9PntzKCJSYXRlLWxpbWl0IGxpZnRlZC4iKSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6ImFsbCJ9KX0sYXN5bmMgZT0+e3MoYFJhdGUtbGltaXQgZXhjZWVkZWQuIERpc2FibGluZyBjYXB0dXJpbmcgb2YgY2F1Z2h0IGV4Y2VwdGlvbnMgZm9yICR7ZX0gc2Vjb25kcy5gKSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6InVuY2F1Z2h0In0pfSl9fSkoKS5jYXRjaChlPT57cygiRmFpbGVkIHRvIHN0YXJ0IGRlYnVnZ2VyIixlKX0pLHNldEludGVydmFsKCgpPT57fSwxZTQpOw=="),{workerData:e,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{t.terminate()}),t.once("error",e=>{$C("Worker error",e)}),t.once("exit",e=>{$C("Worker exit",e)}),t.unref()}(n)}catch(e){TT.error("Failed to start worker",e)}},e=>{TT.error("Failed to start inspector",e)})},processEvent:(e,n)=>function(e,n){if(n.originalException&&"object"==typeof n.originalException&&DC in n.originalException&&Array.isArray(n.originalException[DC])){for(const r of e.exception?.values||[])t(r,n.originalException[DC]);n.originalException[DC]=void 0}return e}(e,n)}};function jC(e){if(void 0!==e)return e.slice(-10).reduce((e,t)=>`${e},${t.function},${t.lineno},${t.colno}`,"")}function VC(e){let t=[],n=!1;function r(r){t=[],n||(n=!0,e(r))}return t.push(r),{add:function(e){t.push(e)},next:function(e){const n=t.pop()||r;try{n(e)}catch{r(e)}}}}class HC{constructor(e){this._session=e}static async create(e){if(e)return e;const t=await import("node:inspector");return new HC(new t.Session)}configureAndConnect(e,t){this._session.connect(),this._session.on("Debugger.paused",t=>{e(t,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}setPauseOnExceptions(e){this._session.post("Debugger.setPauseOnExceptions",{state:e?"all":"uncaught"})}getLocalVariables(e,t){this._getProperties(e,e=>{const{add:n,next:r}=VC(t);for(const t of e)if(t.value?.objectId&&"Array"===t.value.className){const e=t.value.objectId;n(n=>this._unrollArray(e,t.name,n,r))}else if(t.value?.objectId&&"Object"===t.value.className){const e=t.value.objectId;n(n=>this._unrollObject(e,t.name,n,r))}else t.value&&n(e=>this._unrollOther(t,e,r));r({})})}_getProperties(e,t){this._session.post("Runtime.getProperties",{objectId:e,ownProperties:!0},(e,n)=>{t(e?[]:n.result)})}_unrollArray(e,t,n,r){this._getProperties(e,e=>{n[t]=e.filter(e=>"length"!==e.name&&!isNaN(parseInt(e.name,10))).sort((e,t)=>parseInt(e.name,10)-parseInt(t.name,10)).map(e=>e.value?.value),r(n)})}_unrollObject(e,t,n,r){this._getProperties(e,e=>{n[t]=e.map(e=>[e.name,e.value?.value]).reduce((e,[t,n])=>(e[t]=n,e),{}),r(n)})}_unrollOther(e,t,n){e.value&&("value"in e.value?void 0===e.value.value||null===e.value.value?t[e.name]=`<${e.value.value}>`:t[e.name]=e.value.value:"description"in e.value&&"function"!==e.value.type?t[e.name]=`<${e.value.description}>`:"undefined"===e.value.type&&(t[e.name]="<undefined>")),n(t)}}const BC=(e={},t)=>{const n=new lO(20);let r,s=!1;function o(e){const t=jC(e.stacktrace?.frames);if(void 0===t)return;const r=n.remove(t);if(void 0===r)return;const s=(e.stacktrace?.frames||[]).filter(e=>"new Promise"!==e.function);for(let e=0;e<s.length;e++){const t=s.length-e-1,n=r[e],o=s[t];if(!o||!n)break;void 0!==n.vars&&!1!==o.in_app&&UC(o.function,n.function)&&(o.vars=n.vars)}}return{name:"LocalVariables",async setupOnce(){const o=Ly(),i=o?.getOptions();if(!i?.includeLocalVariables)return;tC<18?TT.log("The `LocalVariables` integration is only supported on Node >= v18."):await xC()?TT.warn("Local variables capture has been disabled because the debugger was already enabled"):HC.create(t).then(t=>{function o(e,{params:{reason:s,data:o,callFrames:i}},a){if("exception"!==s&&"promiseRejection"!==s)return void a();r?.();const c=function(e,t){if(void 0!==t)return jC(e(t,1))}(e,o.description);if(null==c)return void a();const{add:u,next:l}=VC(e=>{n.set(c,e),a()});for(let e=0;e<Math.min(i.length,5);e++){const{scopeChain:n,functionName:r,this:s}=i[e],o=n.find(e=>"local"===e.type),a="global"!==s.className&&s.className?`${s.className}.${r}`:r;if(void 0===o?.object.objectId)u(t=>{t[e]={function:a},l(t)});else{const n=o.object.objectId;u(r=>t.getLocalVariables(n,t=>{r[e]={function:a,vars:t},l(r)}))}}l([])}const a=!1!==e.captureAllExceptions;if(t.configureAndConnect((e,t)=>o(i.stackParser,e,t),a),a){const n=e.maxExceptionsPerSecond||50;r=function(e,t,n){let r=0,s=5,o=0;return setInterval(()=>{0===o?r>e&&(s*=2,n(s),s>86400&&(s=86400),o=s):(o-=1,0===o&&t()),r=0},1e3).unref(),()=>{r+=1}}(n,()=>{TT.log("Local variables rate-limit lifted."),t.setPauseOnExceptions(!0)},e=>{TT.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${e} seconds.`),t.setPauseOnExceptions(!1)})}s=!0},e=>{TT.log("The `LocalVariables` integration failed to start.",e)})},processEvent:e=>s?function(e){for(const t of e.exception?.values||[])o(t);return e}(e):e,_getCachedFramesCount:()=>n.size,_getFirstCachedFrame:()=>n.values()[0]}},FC=(e={})=>eC.major<19?BC(e):GC(e);function YC(){try{return"undefined"!=typeof module&&void 0!==module.exports}catch{return!1}}let qC;const KC="undefined"==typeof __SENTRY_SERVER_MODULES__?{}:__SENTRY_SERVER_MODULES__,WC=()=>({name:"Modules",processEvent:e=>(e.modules={...e.modules,...XC()},e),getModules:XC});function ZC(){const e=require.main?.paths||[],t=function(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}(),n={},r=new Set;return t.forEach(t=>{let s=t;const o=()=>{const t=s;if(s=E.dirname(t),!s||t===s||r.has(t))return;if(e.indexOf(s)<0)return o();const i=E.join(t,"package.json");if(r.add(t),!m.existsSync(i))return o();try{const e=JSON.parse(m.readFileSync(i,"utf8"));n[e.name]=e.version}catch{}};o()}),n}function XC(){return qC||(qC={...KC,...zC(),...YC()?ZC():{}}),qC}function zC(){const e=function(){try{const e=E.join(process.cwd(),"package.json");return JSON.parse(m.readFileSync(e,"utf8"))}catch{return{}}}();return{...e.dependencies,...e.devDependencies}}function QC(e){mT(()=>{console.error(e)});const t=Ly();if(void 0===t)return fO&&TT.warn("No NodeClient was defined, we are exiting the process now."),void global.process.exit(1);const n=t.getOptions(),r=n?.shutdownTimeout&&n.shutdownTimeout>0?n.shutdownTimeout:2e3;t.close(r).then(e=>{e||fO&&TT.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},e=>{fO&&TT.error(e)})}const JC=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!1,...e};return{name:"OnUncaughtException",setup(e){global.process.on("uncaughtException",function(e,t){const n=2e3;let r,s=!1,o=!1,i=!1;const a=e.getOptions();return Object.assign(c=>{let u=QC;t.onFatalError?u=t.onFatalError:a.onFatalError&&(u=a.onFatalError);const l=0===global.process.listeners("uncaughtException").filter(e=>"domainUncaughtExceptionClear"!==e.name&&"sentry_tracingErrorCallback"!==e.tag&&!0!==e._errorHandler).length,p=t.exitEvenIfOtherHandlersAreRegistered||l;s?p&&(i?(fO&&TT.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),QC(c)):o||(o=!0,setTimeout(()=>{i||(i=!0,u(r,c))},n))):(r=c,s=!0,Ly()===e&&Pv(c,{originalException:c,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"onuncaughtexception"}}),!i&&p&&(i=!0,u(c)))},{_errorHandler:!0})}(e,t))}}};const eI=(e={})=>{const t={mode:"warn",...e};return{name:"OnUnhandledRejection",setup(e){global.process.on("unhandledRejection",function(e,t){return function(n,r){if(Ly()!==e)return;const s="strict"===t.mode?"fatal":"error",o=n&&"object"==typeof n?n._sentry_active_span:void 0;(o?e=>uv(o,e):e=>e())(()=>{Pv(n,{originalException:r,captureContext:{extra:{unhandledPromiseRejection:!0},level:s},mechanism:{handled:!1,type:"onunhandledrejection"}})}),function(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";"warn"===t?mT(()=>{console.warn(n),console.error(e&&"object"==typeof e&&"stack"in e?e.stack:e)}):"strict"===t&&(mT(()=>{console.warn(n)}),QC(e))}(n,t.mode)}}(e,t))}}};const tI="Spotlight",nI=(e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:tI,setup(e){try{TT.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?")}catch{}!function(e,t){const n=function(e){try{return new URL(`${e}`)}catch{return void TT.warn(`[Spotlight] Invalid sidecar URL: ${e}`)}}(t.sidecarUrl);if(!n)return;let r=0;e.on("beforeEnvelope",e=>{if(r>3)return void TT.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");const t=HA(e);lv(()=>{const e=x.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},e=>{e.statusCode&&e.statusCode>=200&&e.statusCode<400&&(r=0),e.on("data",()=>{}),e.on("end",()=>{}),e.setEncoding("utf8")});e.on("error",()=>{r++,TT.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),e.write(t),e.end()})})}(e,t)}}};const rI=(e={})=>({name:"NodeSystemError",processEvent:(t,n,r)=>{if(!function(e){return e instanceof Error&&"errno"in e&&"number"==typeof e.errno&&L.getSystemErrorMap().has(e.errno)}(n.originalException))return t;const s=n.originalException,o={...s};r.getOptions().sendDefaultPii||!0===e.includePaths||(delete o.path,delete o.dest),t.contexts={...t.contexts,node_system_error:o};for(const e of t.exception?.values||[])e.value&&(s.path&&e.value.includes(s.path)&&(e.value=e.value.replace(`'${s.path}'`,"").trim()),s.dest&&e.value.includes(s.dest)&&(e.value=e.value.replace(`'${s.dest}'`,"").trim()));return t}}),sI=(e={})=>({name:"ChildProcess",setup(){I.channel("child_process").subscribe(t=>{t&&"object"==typeof t&&"process"in t&&function(e,t){let n,r=!1;e.on("spawn",()=>{"/usr/bin/sw_vers"!==e.spawnfile?(n={spawnfile:e.spawnfile},t.includeChildProcessArgs&&(n.spawnargs=e.spawnargs)):r=!0}).on("exit",e=>{r||(r=!0,null!==e&&0!==e&&Eb({category:"child_process",message:`Child process exited with code '${e}'`,level:0===e?"info":"warning",data:n}))}).on("error",e=>{r||(r=!0,Eb({category:"child_process",message:`Child process errored with '${e.message}'`,level:"error",data:n}))})}(t.process,e)}),I.channel("worker_threads").subscribe(t=>{t&&"object"==typeof t&&"worker"in t&&function(e,t){let n;e.on("online",()=>{n=e.threadId}).on("error",e=>{!1!==t.captureWorkerErrors?Pv(e,{mechanism:{type:"instrument",handled:!1,data:{threadId:String(n)}}}):Eb({category:"worker_thread",message:`Worker thread errored with '${e.message}'`,level:"error",data:{threadId:n}})})}(t.worker,e)})}});var oI={},iI={},aI={};Object.defineProperty(aI,"__esModule",{value:!0}),aI.AbstractAsyncHooksContextManager=void 0;const cI=l,uI=["addListener","on","once","prependListener","prependOnceListener"];aI.AbstractAsyncHooksContextManager=class{bind(e,t){return t instanceof cI.EventEmitter?this._bindEventEmitter(e,t):"function"==typeof t?this._bindFunction(e,t):t}_bindFunction(e,t){const n=this,r=function(...r){return n.with(e,()=>t.apply(this,r))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r}_bindEventEmitter(e,t){return void 0!==this._getPatchMap(t)||(this._createPatchMap(t),uI.forEach(n=>{void 0!==t[n]&&(t[n]=this._patchAddListener(t,t[n],e))}),"function"==typeof t.removeListener&&(t.removeListener=this._patchRemoveListener(t,t.removeListener)),"function"==typeof t.off&&(t.off=this._patchRemoveListener(t,t.off)),"function"==typeof t.removeAllListeners&&(t.removeAllListeners=this._patchRemoveAllListeners(t,t.removeAllListeners))),t}_patchRemoveListener(e,t){const n=this;return function(r,s){const o=n._getPatchMap(e)?.[r];if(void 0===o)return t.call(this,r,s);const i=o.get(s);return t.call(this,r,i||s)}}_patchRemoveAllListeners(e,t){const n=this;return function(r){const s=n._getPatchMap(e);return void 0!==s&&(0===arguments.length?n._createPatchMap(e):void 0!==s[r]&&delete s[r]),t.apply(this,arguments)}}_patchAddListener(e,t,n){const r=this;return function(s,o){if(r._wrapped)return t.call(this,s,o);let i=r._getPatchMap(e);void 0===i&&(i=r._createPatchMap(e));let a=i[s];void 0===a&&(a=new WeakMap,i[s]=a);const c=r.bind(n,o);a.set(o,c),r._wrapped=!0;try{return t.call(this,s,c)}finally{r._wrapped=!1}}}_createPatchMap(e){const t=Object.create(null);return e[this._kOtListeners]=t,t}_getPatchMap(e){return e[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1},Object.defineProperty(iI,"__esModule",{value:!0}),iI.AsyncHooksContextManager=void 0;const lI=qt,pI=f,dI=aI;class hI extends dI.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=pI.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??lI.ROOT_CONTEXT}with(e,t,n,...r){this._enterContext(e);try{return t.call(n,...r)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(e,t){if("TIMERWRAP"===t)return;const n=this._stack[this._stack.length-1];void 0!==n&&this._contexts.set(e,n)}_destroy(e){this._contexts.delete(e)}_before(e){const t=this._contexts.get(e);void 0!==t&&this._enterContext(t)}_after(){this._exitContext()}_enterContext(e){this._stack.push(e)}_exitContext(){this._stack.pop()}}iI.AsyncHooksContextManager=hI;var fI={};Object.defineProperty(fI,"__esModule",{value:!0}),fI.AsyncLocalStorageContextManager=void 0;const _I=qt,mI=f,gI=aI;class EI extends gI.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new mI.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??_I.ROOT_CONTEXT}with(e,t,n,...r){const s=null==n?t:t.bind(n);return this._asyncLocalStorage.run(e,s,...r)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}}fI.AsyncLocalStorageContextManager=EI,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncLocalStorageContextManager=e.AsyncHooksContextManager=void 0;var t=iI;Object.defineProperty(e,"AsyncHooksContextManager",{enumerable:!0,get:function(){return t.AsyncHooksContextManager}});var n=fI;Object.defineProperty(e,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return n.AsyncLocalStorageContextManager}})}(oI);const SI=(TI=oI.AsyncLocalStorageContextManager,class extends TI{constructor(...e){super(...e),fN("SentryContextManager")}with(e,t,n,...r){const s=rN(e),o=s?.scope||Py(),i=s?.isolationScope||My(),a=!0===e.getValue(JO),c=e.getValue(eN),u=e.getValue(tN),l=c||o.clone(),p=sN(e,{scope:l,isolationScope:u||(a?i.clone():i)}).deleteValue(JO).deleteValue(eN).deleteValue(tN);return function(e,t){JT(e,nN,t)}(l,p),super.with(p,t,n,...r)}});var TI;const yI=()=>({name:"ProcessSession",setupOnce(){!function(e){const t=My(),n=Py(),{userAgent:r}=uT.navigator||{},s=hy({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),o=t.getSession();"ok"===o?.status&&fy(o,{status:"exited"}),wv(),t.setSession(s)}(),process.on("beforeExit",()=>{const e=My().getSession();"ok"!==e?.status&&wv()})}}),AI=Symbol("AgentBaseInternalState");class vI extends x.Agent{constructor(e){super(e),this[AI]={}}isSecureEndpoint(e){if(e){if("boolean"==typeof e.secureEndpoint)return e.secureEndpoint;if("string"==typeof e.protocol)return"https:"===e.protocol}const{stack:t}=new Error;return"string"==typeof t&&t.split("\n").some(e=>-1!==e.indexOf("(https.js:")||-1!==e.indexOf("node:https:"))}createSocket(e,t,n){const r={...t,secureEndpoint:this.isSecureEndpoint(t)};Promise.resolve().then(()=>this.connect(e,r)).then(s=>{if(s instanceof x.Agent)return s.addRequest(e,r);this[AI].currentSocket=s,super.createSocket(e,t,n)},n)}createConnection(){const e=this[AI].currentSocket;if(this[AI].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[AI].defaultPort??("https:"===this.protocol?443:80)}set defaultPort(e){this[AI]&&(this[AI].defaultPort=e)}get protocol(){return this[AI].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[AI]&&(this[AI].protocol=e)}}function bI(...e){TT.log("[https-proxy-agent:parse-proxy-response]",...e)}function RI(e){return new Promise((t,n)=>{let r=0;const s=[];function o(){const a=e.read();a?function(a){s.push(a),r+=a.length;const c=Buffer.concat(s,r),u=c.indexOf("\r\n\r\n");if(-1===u)return bI("have not received end of HTTP headers yet..."),void o();const l=c.subarray(0,u).toString("ascii").split("\r\n"),p=l.shift();if(!p)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const d=p.split(" "),h=+(d[1]||0),f=d.slice(2).join(" "),_={};for(const t of l){if(!t)continue;const r=t.indexOf(":");if(-1===r)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${t}"`));const s=t.slice(0,r).toLowerCase(),o=t.slice(r+1).trimStart(),i=_[s];"string"==typeof i?_[s]=[i,o]:Array.isArray(i)?i.push(o):_[s]=o}bI("got proxy server response: %o %o",p,_),i(),t({connect:{statusCode:h,statusText:f,headers:_},buffered:c})}(a):e.once("readable",o)}function i(){e.removeListener("end",a),e.removeListener("error",c),e.removeListener("readable",o)}function a(){i(),bI("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function c(e){i(),bI("onerror %o",e),n(e)}e.on("error",c),e.on("end",a),o()})}function OI(...e){TT.log("[https-proxy-agent]",...e)}class NI extends vI{static __initStatic(){this.protocols=["http","https"]}constructor(e,t){super(t),this.options={},this.proxy="string"==typeof e?new URL(e):e,this.proxyHeaders=t?.headers??{},OI("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),r=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?II(t,"headers"):null,host:n,port:r}}async connect(e,t){const{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let r;if("https:"===n.protocol){OI("Creating `tls.Socket`: %o",this.connectOpts);const e=this.connectOpts.servername||this.connectOpts.host;r=k.connect({...this.connectOpts,servername:e&&M.isIP(e)?void 0:e})}else OI("Creating `net.Socket`: %o",this.connectOpts),r=M.connect(this.connectOpts);const s="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},o=M.isIPv6(t.host)?`[${t.host}]`:t.host;let i=`CONNECT ${o}:${t.port} HTTP/1.1\r\n`;if(n.username||n.password){const e=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;s["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}s.Host=`${o}:${t.port}`,s["Proxy-Connection"]||(s["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const e of Object.keys(s))i+=`${e}: ${s[e]}\r\n`;const a=RI(r);r.write(`${i}\r\n`);const{connect:c,buffered:u}=await a;if(e.emit("proxyConnect",c),this.emit("proxyConnect",c,e),200===c.statusCode){if(e.once("socket",CI),t.secureEndpoint){OI("Upgrading socket connection to TLS");const e=t.servername||t.host;return k.connect({...II(t,"host","path","port"),socket:r,servername:M.isIP(e)?void 0:e})}return r}r.destroy();const l=new M.Socket({writable:!1});return l.readable=!0,e.once("socket",e=>{OI("Replaying proxy buffer for failed request"),e.push(u),e.push(null)}),l}}function CI(e){e.resume()}function II(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}NI.__initStatic();function PI(e){let t;try{t=new URL(e.url)}catch(t){return mT(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),cb(e,()=>Promise.resolve({}))}const n="https:"===t.protocol,r=function(e,t){const{no_proxy:n}=process.env,r=n?.split(",").some(t=>e.host.endsWith(t)||e.hostname.endsWith(t));return r?void 0:t}(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),s=n?D:x,o=void 0!==e.keepAlive&&e.keepAlive,i=r?new NI(r):new s.Agent({keepAlive:o,maxSockets:30,timeout:2e3}),a=function(e,t,n){const{hostname:r,pathname:s,port:o,protocol:i,search:a}=new URL(e.url);return function(c){return new Promise((u,l)=>{lv(()=>{let p=function(e){return new b.Readable({read(){this.push(e),this.push(null)}})}(c.body);const d={...e.headers};c.body.length>32768&&(d["content-encoding"]="gzip",p=p.pipe(R.createGzip()));const h=t.request({method:"POST",agent:n,headers:d,hostname:r,path:`${s}${a}`,port:o,protocol:i,ca:e.caCerts},e=>{e.on("data",()=>{}),e.on("end",()=>{}),e.setEncoding("utf8");const t=e.headers["retry-after"]??null,n=e.headers["x-sentry-rate-limits"]??null;u({statusCode:e.statusCode,headers:{"retry-after":t,"x-sentry-rate-limits":Array.isArray(n)?n[0]||null:n}})});h.on("error",l),p.pipe(h)})})}}(e,e.httpModule??s,i);return cb(e,a)}const MI=new Set(["false","f","n","no","off","0"]),wI=new Set(["true","t","y","yes","on","1"]);function LI(e,t){const n=String(e).toLowerCase();return!MI.has(n)&&(!!wI.has(n)||(t?.strict?null:Boolean(e)))}function xI(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}const DI=vT((kI=function(e=(process.argv[1]?Gb(process.argv[1]):process.cwd()),t="\\"===E.sep){const n=t?xI(e):e;return e=>{if(!e)return;const r=t?xI(e):e;let{dir:s,base:o,ext:i}=E.posix.parse(r);".js"!==i&&".mjs"!==i&&".cjs"!==i||(o=o.slice(0,-1*i.length));const a=decodeURIComponent(o);s||(s=".");const c=s.lastIndexOf("/node_modules");if(c>-1)return`${s.slice(c+14).replace(/\//g,".")}:${a}`;if(s.startsWith(n)){const e=s.slice(n.length+1).replace(/\//g,".");return e?`${e}:${a}`:a}return a}}(),[90,cO(kI)]));var kI;class UI extends nb{constructor(e){const t=!1===e.includeServerName?void 0:e.serverName||global.process.env.SENTRY_NAME||w.hostname(),n={...e,platform:"node",runtime:{name:"node",version:global.process.version},serverName:t};e.openTelemetryInstrumentations&&ug({instrumentations:e.openTelemetryInstrumentations}),db(n,"node"),TT.log(`Initializing Sentry: process: ${process.pid}, thread: ${u.isMainThread?"main":`worker-${u.threadId}`}.`),super(n),this.getOptions().enableLogs&&(this._logOnExitFlushListener=()=>{Xv(this)},t&&this.on("beforeCaptureLog",e=>{e.attributes={...e.attributes,"server.address":t}}),process.on("beforeExit",this._logOnExitFlushListener))}get tracer(){if(this._tracer)return this._tracer;const e=lT,t=jt.getTracer("@sentry/node",e);return this._tracer=t,t}async flush(e){const t=this.traceProvider;return await(t?.forceFlush()),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(e)}close(e){return this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),this._logOnExitFlushListener&&process.off("beforeExit",this._logOnExitFlushListener),super.close(e)}startClientReportTracking(){const e=this.getOptions();e.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{fO&&TT.log("Flushing client reports based on interval."),this._flushOutcomes()},e.clientReportFlushInterval??6e4).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_getTraceInfoFromScope(e){return e?function(e,t){const n=oN(t),r=n&&jt.getSpan(n),s=r?dA(r):xy(t);return[r?LA(r):wA(e,t),s]}(this,e):[void 0,void 0]}}function $I(){return[bb(),yb(),Mb(),xb(),rI(),jb(),JN(),uC(),JC(),eI(),wC(),FC(),dC(),sI(),yI(),WC()]}function GI(e={}){return function(e={},t){const n=function(e,t){const n=function(e){if(void 0!==e)return e;const t=function(e){if(process.env.SENTRY_RELEASE)return process.env.SENTRY_RELEASE;if(uT.SENTRY_RELEASE?.id)return uT.SENTRY_RELEASE.id;const t=process.env.GITHUB_SHA||process.env.CI_MERGE_REQUEST_SOURCE_BRANCH_SHA||process.env.CI_BUILD_REF||process.env.CI_COMMIT_SHA||process.env.BITBUCKET_COMMIT,n=process.env.APPVEYOR_PULL_REQUEST_HEAD_COMMIT||process.env.APPVEYOR_REPO_COMMIT||process.env.CODEBUILD_RESOLVED_SOURCE_VERSION||process.env.AWS_COMMIT_ID||process.env.BUILD_SOURCEVERSION||process.env.GIT_CLONE_COMMIT_HASH||process.env.BUDDY_EXECUTION_REVISION||process.env.BUILDKITE_COMMIT||process.env.CIRCLE_SHA1||process.env.CIRRUS_CHANGE_IN_REPO||process.env.CF_REVISION||process.env.CM_COMMIT||process.env.CF_PAGES_COMMIT_SHA||process.env.DRONE_COMMIT_SHA||process.env.FC_GIT_COMMIT_SHA||process.env.HEROKU_TEST_RUN_COMMIT_VERSION||process.env.HEROKU_SLUG_COMMIT||process.env.RAILWAY_GIT_COMMIT_SHA||process.env.RENDER_GIT_COMMIT||process.env.SEMAPHORE_GIT_SHA||process.env.TRAVIS_PULL_REQUEST_SHA||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA,r=process.env.CI_COMMIT_ID||process.env.SOURCE_COMMIT||process.env.SOURCE_VERSION||process.env.GIT_COMMIT||process.env.COMMIT_REF||process.env.BUILD_VCS_NUMBER||process.env.CI_COMMIT_SHA;return t||n||r||e}();if(void 0!==t)return t;return}(e.release),r=e.spotlight??LI(process.env.SENTRY_SPOTLIGHT,{strict:!0})??process.env.SENTRY_SPOTLIGHT,s=function(e){if(void 0!==e)return e;const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(!t)return;const n=parseFloat(t);return isFinite(n)?n:void 0}(e.tracesSampleRate),o={...e,dsn:e.dsn??process.env.SENTRY_DSN,environment:e.environment??process.env.SENTRY_ENVIRONMENT,sendClientReports:e.sendClientReports??!0,transport:e.transport??PI,stackParser:bT(e.stackParser||DI),release:n,tracesSampleRate:s,spotlight:r,debug:LI(e.debug??process.env.SENTRY_DEBUG)},i=e.integrations,a=e.defaultIntegrations??t(o);return{...o,integrations:Dv({defaultIntegrations:a,integrations:i})}}(e,t);!0===n.debug&&(fO?TT.enable():mT(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")}));YC()||!1===n.registerEsmLoaderHooks||function(){const[e=0,t=0]=process.versions.node.split(".").map(Number);if(e>=21||20===e&&t>=6||18===e&&t>=19){if(!uT._sentryEsmLoaderHookRegistered)try{const{addHookMessagePort:e}=OS();a.register("import-in-the-middle/hook.mjs","undefined"==typeof document?require("url").pathToFileURL(__filename).href:document.currentScript&&document.currentScript.src||new URL("index.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){TT.warn("Failed to register ESM hook",e)}}else mT(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})}();wN();Py().update(n.initialScope),n.spotlight&&!n.integrations.some(({name:e})=>e===tI)&&n.integrations.push(nI({sidecarUrl:"string"==typeof n.spotlight?n.spotlight:void 0}));db(n,"node-core");const r=new UI(n);return Py().setClient(r),r.init(),TT.log(`Running in ${YC()?"CommonJS":"ESM"} mode.`),r.startClientReportTracking(),function(){if(!1!==LI(process.env.SENTRY_USE_ENVIRONMENT)){const e=cA(process.env.SENTRY_TRACE,process.env.SENTRY_BAGGAGE);Py().setPropagationContext(e)}}(),function(e){e.on("createDsc",(e,t)=>{if(!t)return;const n=mA(t).data[Dy],{description:r}=qO(t)?cN(t):{description:void 0};if("url"!==n&&r&&(e.transaction=r),NA()){const n=iN(t.spanContext());e.sampled=null==n?void 0:String(n)}})}(r),function(e){e.on("preprocessEvent",e=>{const t=lN();if(!t||"transaction"===e.type)return;e.contexts={trace:dA(t),...e.contexts};const n=AA(t);return e.sdkProcessingMetadata={dynamicSamplingContext:LA(n),...e.sdkProcessingMetadata},e})}(r),r}(e,$I)}function jI(){if(!fO)return;const e=Array.from(hN),t=["SentryContextManager","SentryPropagator"];NA()&&t.push("SentrySpanProcessor");for(const n of t)e.includes(n)||TT.error(`You have to set up the ${n}. Without this, the OpenTelemetry & Sentry integration will not work properly.`);e.includes("SentrySampler")||TT.warn("You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected. If you use a custom sampler, make sure to use `wrapSamplingDecision`.")}function VI(e,t){e.setAttribute($y,t)}const HI="Http",BI="@opentelemetry_sentry-patched/instrumentation-http",FI=dO(`${HI}.sentry`,e=>new XN(e)),YI=dO(HI,e=>{const t=new Ft.HttpInstrumentation(e);try{t._diag=vt.createComponentLogger({namespace:BI}),t.instrumentationName=BI}catch{}return t});const qI=(e={})=>{const t=e.dropSpansForIncomingRequestStatusCodes??[[401,404],[300,399]];return{name:HI,setupOnce(){const t=function(e,t={}){return"boolean"==typeof e.spans?e.spans:!(t.skipOpenTelemetrySetup||!NA(t)&&eC.major>=22)}(e,Ly()?.getOptions());if(FI({...e,extractIncomingTraceFromHeader:!t,propagateTraceInOutgoingRequests:!t}),t){const t=function(e={}){const t={...e.instrumentation?._experimentalConfig,disableIncomingRequestInstrumentation:e.disableIncomingRequestSpans,ignoreOutgoingRequestHook:t=>{const n=_O(t);if(!n)return!1;const r=e.ignoreOutgoingRequests;return!!r?.(n,t)},ignoreIncomingRequestHook:t=>{const n=t.url,r=t.method?.toUpperCase();if("OPTIONS"===r||"HEAD"===r)return!0;if(!1!==e.ignoreStaticAssets&&"GET"===r&&n&&function(e){const t=lb(e);if(t.match(/\.(ico|png|jpg|jpeg|gif|svg|css|js|woff|woff2|ttf|eot|webp|avif)$/))return!0;if(t.match(/^\/(robots\.txt|sitemap\.xml|manifest\.json|browserconfig\.xml)$/))return!0;return!1}(n))return!0;const s=e.ignoreIncomingRequests;return!(!n||!s?.(n,t))},requireParentforOutgoingSpans:!1,requireParentforIncomingSpans:!1,requestHook:(t,n)=>{VI(t,"auto.http.otel.http"),!function(e){return"outputData"in e&&"outputSize"in e&&!("client"in e)&&!("statusCode"in e)}(n)&&function(e){return"1"===e.headers["next-router-prefetch"]}(n)&&t.setAttribute("sentry.http.prefetch",!0),e.instrumentation?.requestHook?.(t,n)},responseHook:(t,n)=>{e.instrumentation?.responseHook?.(t,n)},applyCustomAttributesOnSpan:(t,n,r)=>{e.instrumentation?.applyCustomAttributesOnSpan?.(t,n,r)}};return t}(e);YI(t)}},processEvent(e){if("transaction"===e.type){const n=e.contexts?.trace?.data?.["http.response.status_code"];if("number"==typeof n&&t.some(e=>{if("number"==typeof e)return e===n;const[t,r]=e;return n>=t&&n<=r}))return null}return e}}};var KI={},WI={},ZI={};Object.defineProperty(ZI,"__esModule",{value:!0}),ZI.PACKAGE_NAME=ZI.PACKAGE_VERSION=void 0,ZI.PACKAGE_VERSION="0.14.0",ZI.PACKAGE_NAME="@opentelemetry/instrumentation-undici";var XI={};Object.defineProperty(XI,"__esModule",{value:!0}),XI.SemanticAttributes=void 0,XI.SemanticAttributes={HTTP_CONNECTION_STATE:"http.connection.state",ERROR_TYPE:"error.type",HTTP_REQUEST_BODY_SIZE:"http.request.body.size",HTTP_REQUEST_METHOD:"http.request.method",HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",HTTP_RESPONSE_BODY_SIZE:"http.response.body.size",HTTP_RESPONSE_STATUS_CODE:"http.response.status_code",HTTP_ROUTE:"http.route",NETWORK_PEER_ADDRESS:"network.peer.address",NETWORK_PEER_PORT:"network.peer.port",NETWORK_PROTOCOL_NAME:"network.protocol.name",NETWORK_PROTOCOL_VERSION:"network.protocol.version",SERVER_ADDRESS:"server.address",SERVER_PORT:"server.port",URL_FULL:"url.full",URL_PATH:"url.path",URL_QUERY:"url.query",URL_SCHEME:"url.scheme",USER_AGENT_ORIGINAL:"user_agent.original"},Object.defineProperty(WI,"__esModule",{value:!0}),WI.UndiciInstrumentation=void 0;const zI=d,QI=i,JI=DS,eP=qt,tP=ZI,nP=XI,rP=Qm;class sP extends JI.InstrumentationBase{_recordFromReq=new WeakMap;constructor(e={}){super(tP.PACKAGE_NAME,tP.PACKAGE_VERSION,e)}init(){}disable(){super.disable(),this._channelSubs.forEach(e=>e.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],this._channelSubs.length>0||(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram("http.client.request.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:eP.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(e,t){const[n,r]=process.version.replace("v","").split(".").map(e=>Number(e));let s;if(n>18||18===n&&r>=19)zI.subscribe?.(e,t),s=()=>zI.unsubscribe?.(e,t);else{const n=zI.channel(e);n.subscribe(t),s=()=>n.unsubscribe(t)}this._channelSubs.push({name:e,unsubscribe:s})}parseRequestHeaders(e){const t=new Map;if(Array.isArray(e.headers))for(let n=0;n<e.headers.length;n+=2){const r=e.headers[n],s=e.headers[n+1];"string"==typeof r&&t.set(r.toLowerCase(),s)}else if("string"==typeof e.headers){const n=e.headers.split("\r\n");for(const e of n){if(!e)continue;const n=e.indexOf(":");if(-1===n)continue;const r=e.substring(0,n).toLowerCase(),s=e.substring(n+1).trim(),o=t.get(r);o&&Array.isArray(o)?o.push(s):o?t.set(r,[o,s]):t.set(r,s)}}return t}onRequestCreated({request:e}){const t=this.getConfig(),n=!1!==t.enabled;if((0,JI.safeExecuteInTheMiddle)(()=>!n||"CONNECT"===e.method||t.ignoreRequestHook?.(e),e=>e&&this._diag.error("caught ignoreRequestHook error: ",e),!0))return;const r=(0,rP.hrTime)();let s;try{s=new QI.URL(e.path,e.origin)}catch(e){return void this._diag.warn("could not determine url.full:",e)}const o=s.protocol.replace(":",""),i=this.getRequestMethod(e.method),a={[nP.SemanticAttributes.HTTP_REQUEST_METHOD]:i,[nP.SemanticAttributes.HTTP_REQUEST_METHOD_ORIGINAL]:e.method,[nP.SemanticAttributes.URL_FULL]:s.toString(),[nP.SemanticAttributes.URL_PATH]:s.pathname,[nP.SemanticAttributes.URL_QUERY]:s.search,[nP.SemanticAttributes.URL_SCHEME]:o},c=s.hostname,u=s.port||{https:"443",http:"80"}[o];a[nP.SemanticAttributes.SERVER_ADDRESS]=c,u&&!isNaN(Number(u))&&(a[nP.SemanticAttributes.SERVER_PORT]=Number(u));const l=this.parseRequestHeaders(e).get("user-agent");if(l){const e=Array.isArray(l)?l[l.length-1]:l;a[nP.SemanticAttributes.USER_AGENT_ORIGINAL]=e}const p=(0,JI.safeExecuteInTheMiddle)(()=>t.startSpanHook?.(e),e=>e&&this._diag.error("caught startSpanHook error: ",e),!0);p&&Object.entries(p).forEach(([e,t])=>{a[e]=t});const d=eP.context.active(),h=eP.trace.getSpan(d);let f;f=!t.requireParentforSpans||h&&eP.trace.isSpanContextValid(h.spanContext())?this.tracer.startSpan("_OTHER"===i?"HTTP":i,{kind:eP.SpanKind.CLIENT,attributes:a},d):eP.trace.wrapSpanContext(eP.INVALID_SPAN_CONTEXT),(0,JI.safeExecuteInTheMiddle)(()=>t.requestHook?.(f,e),e=>e&&this._diag.error("caught requestHook error: ",e),!0);const _=eP.trace.setSpan(eP.context.active(),f),m={};eP.propagation.inject(_,m);const g=Object.entries(m);for(let t=0;t<g.length;t++){const[n,r]=g[t];"function"==typeof e.addHeader?e.addHeader(n,r):"string"==typeof e.headers?e.headers+=`${n}: ${r}\r\n`:Array.isArray(e.headers)&&e.headers.push(n,r)}this._recordFromReq.set(e,{span:f,attributes:a,startTime:r})}onRequestHeaders({request:e,socket:t}){const n=this._recordFromReq.get(e);if(!n)return;const r=this.getConfig(),{span:s}=n,{remoteAddress:o,remotePort:i}=t,a={[nP.SemanticAttributes.NETWORK_PEER_ADDRESS]:o,[nP.SemanticAttributes.NETWORK_PEER_PORT]:i};if(r.headersToSpanAttributes?.requestHeaders){const t=new Set(r.headersToSpanAttributes.requestHeaders.map(e=>e.toLowerCase())),n=this.parseRequestHeaders(e);for(const[e,r]of n.entries())if(t.has(e)){const t=Array.isArray(r)?r.join(", "):r;a[`http.request.header.${e}`]=t}}s.setAttributes(a)}onResponseHeaders({request:e,response:t}){const n=this._recordFromReq.get(e);if(!n)return;const{span:r,attributes:s}=n,o={[nP.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE]:t.statusCode},i=this.getConfig();(0,JI.safeExecuteInTheMiddle)(()=>i.responseHook?.(r,{request:e,response:t}),e=>e&&this._diag.error("caught responseHook error: ",e),!0);const a=new Set;i.headersToSpanAttributes?.responseHeaders&&i.headersToSpanAttributes?.responseHeaders.forEach(e=>a.add(e.toLowerCase()));for(let e=0;e<t.headers.length;e+=2){const n=t.headers[e].toString().toLowerCase(),r=t.headers[e+1];if(a.has(n)&&(o[`http.response.header.${n}`]=r.toString()),"content-length"===n){const e=Number(r.toString());isNaN(e)||(o["http.response.header.content-length"]=e)}}r.setAttributes(o),r.setStatus({code:t.statusCode>=400?eP.SpanStatusCode.ERROR:eP.SpanStatusCode.UNSET}),n.attributes=Object.assign(s,o)}onDone({request:e}){const t=this._recordFromReq.get(e);if(!t)return;const{span:n,attributes:r,startTime:s}=t;n.end(),this._recordFromReq.delete(e),this.recordRequestDuration(r,s)}onError({request:e,error:t}){const n=this._recordFromReq.get(e);if(!n)return;const{span:r,attributes:s,startTime:o}=n;r.recordException(t),r.setStatus({code:eP.SpanStatusCode.ERROR,message:t.message}),r.end(),this._recordFromReq.delete(e),s[nP.SemanticAttributes.ERROR_TYPE]=t.message,this.recordRequestDuration(s,o)}recordRequestDuration(e,t){const n={};[nP.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE,nP.SemanticAttributes.HTTP_REQUEST_METHOD,nP.SemanticAttributes.SERVER_ADDRESS,nP.SemanticAttributes.SERVER_PORT,nP.SemanticAttributes.URL_SCHEME,nP.SemanticAttributes.ERROR_TYPE].forEach(t=>{t in e&&(n[t]=e[t])});const r=(0,rP.hrTimeToMilliseconds)((0,rP.hrTimeDuration)(t,(0,rP.hrTime)()))/1e3;this._httpClientDurationHistogram.record(r,n)}getRequestMethod(e){return e.toUpperCase()in{CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0}?e.toUpperCase():"_OTHER"}}WI.UndiciInstrumentation=sP,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UndiciInstrumentation=void 0;var t=WI;Object.defineProperty(e,"UndiciInstrumentation",{enumerable:!0,get:function(){return t.UndiciInstrumentation}})}(KI);const oP="NodeFetch",iP=dO(oP,KI.UndiciInstrumentation,e=>function(e={}){const t={requireParentforSpans:!1,ignoreRequestHook:t=>{const n=function(e,t="/"){const n=`${e}`;if(n.endsWith("/")&&t.startsWith("/"))return`${n}${t.slice(1)}`;if(!n.endsWith("/")&&!t.startsWith("/"))return`${n}/${t.slice(1)}`;return`${n}${t}`}(t.origin,t.path),r=e.ignoreOutgoingRequests;return!!(r&&n&&r(n))},startSpanHook:()=>({[$y]:"auto.http.otel.node_fetch"})};return t}(e)),aP=dO(`${oP}.sentry`,iC,e=>e),cP=(e={})=>({name:"NodeFetch",setupOnce(){const t=function(e,t={}){return"boolean"==typeof e.spans?e.spans:!t.skipOpenTelemetrySetup&&NA(t)}(e,Ly()?.getOptions());t&&iP(e),aP(e)}});var uP={},lP={},pP={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExpressLayerType=void 0,function(e){e.ROUTER="router",e.MIDDLEWARE="middleware",e.REQUEST_HANDLER="request_handler"}(e.ExpressLayerType||(e.ExpressLayerType={}))}(pP);var dP={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.EXPRESS_TYPE="express.type",e.EXPRESS_NAME="express.name"}(e.AttributeNames||(e.AttributeNames={}))}(dP);var hP={},fP={};Object.defineProperty(fP,"__esModule",{value:!0}),fP._LAYERS_STORE_PROPERTY=fP.kLayerPatched=void 0,fP.kLayerPatched=Symbol("express-layer-patched"),fP._LAYERS_STORE_PROPERTY="__ot_middlewares",function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getActualMatchedRoute=e.getConstructedRoute=e.getLayerPath=e.asErrorAndMessage=e.isLayerIgnored=e.getLayerMetadata=e.getRouterPath=e.storeLayerPath=void 0;const t=pP,n=dP,r=fP;e.storeLayerPath=(e,t)=>(!1===Array.isArray(e[r._LAYERS_STORE_PROPERTY])&&Object.defineProperty(e,r._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),void 0===t?{isLayerPathStored:!1}:(e[r._LAYERS_STORE_PROPERTY].push(t),{isLayerPathStored:!0}));e.getRouterPath=(t,n)=>{const r=n.handle?.stack?.[0];return r?.route?.path?`${t}${r.route.path}`:r?.handle?.stack?(0,e.getRouterPath)(t,r):t};e.getLayerMetadata=(r,s,o)=>{if("router"===s.name){const i=(0,e.getRouterPath)("",s),a=i||(o||r||"/");return{attributes:{[n.AttributeNames.EXPRESS_NAME]:a,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.ROUTER},name:`router - ${a}`}}return"bound dispatch"===s.name||"handle"===s.name?{attributes:{[n.AttributeNames.EXPRESS_NAME]:(r||o)??"request handler",[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.REQUEST_HANDLER},name:"request handler"+(s.path?` - ${r||o}`:"")}:{attributes:{[n.AttributeNames.EXPRESS_NAME]:s.name,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.MIDDLEWARE},name:`middleware - ${s.name}`}};const s=(e,t)=>{if("string"==typeof t)return t===e;if(t instanceof RegExp)return t.test(e);if("function"==typeof t)return t(e);throw new TypeError("Pattern is in unsupported datatype")};e.isLayerIgnored=(e,t,n)=>{if(Array.isArray(n?.ignoreLayersType)&&n?.ignoreLayersType?.includes(t))return!0;if(!1===Array.isArray(n?.ignoreLayers))return!1;try{for(const t of n.ignoreLayers)if(s(e,t))return!0}catch(e){}return!1};e.asErrorAndMessage=e=>e instanceof Error?[e,e.message]:[String(e),String(e)];e.getLayerPath=e=>{const t=e[0];return Array.isArray(t)?t.map(e=>o(e)||"").join(","):o(t)};const o=e=>"string"==typeof e?e:e instanceof RegExp||"number"==typeof e?e.toString():void 0;function i(e){const t=(Array.isArray(e[r._LAYERS_STORE_PROPERTY])?e[r._LAYERS_STORE_PROPERTY]:[]).filter(e=>"/"!==e&&"/*"!==e);return 1===t.length&&"*"===t[0]?"*":t.join("").replace(/\/{2,}/g,"/")}e.getConstructedRoute=i,e.getActualMatchedRoute=function(e){const t=Array.isArray(e[r._LAYERS_STORE_PROPERTY])?e[r._LAYERS_STORE_PROPERTY]:[];if(0===t.length)return;if(t.every(e=>"/"===e))return"/"===e.originalUrl?"/":void 0;const n=i(e);if("*"===n)return n;if(n.includes("/")&&(n.includes(",")||n.includes("\\")||n.includes("*")||n.includes("[")))return n;const s=n.startsWith("/")?n:`/${n}`;var o;return s.length>0&&(e.originalUrl===s||e.originalUrl.startsWith(s)||((o=s).includes(":")||o.includes("*")))?s:void 0}}(hP);var _P={};Object.defineProperty(_P,"__esModule",{value:!0}),_P.PACKAGE_NAME=_P.PACKAGE_VERSION=void 0,_P.PACKAGE_VERSION="0.52.0",_P.PACKAGE_NAME="@opentelemetry/instrumentation-express",Object.defineProperty(lP,"__esModule",{value:!0}),lP.ExpressInstrumentation=void 0;const mP=Qm,gP=qt,EP=pP,SP=dP,TP=hP,yP=_P,AP=DS,vP=kS,bP=fP;class RP extends AP.InstrumentationBase{constructor(e={}){super(yP.PACKAGE_NAME,yP.PACKAGE_VERSION,e)}init(){return[new AP.InstrumentationNodeModuleDefinition("express",[">=4.0.0 <6"],e=>{const t="function"==typeof e?.Router?.prototype?.route,n=t?e.Router.prototype:e.Router;return(0,AP.isWrapped)(n.route)&&this._unwrap(n,"route"),this._wrap(n,"route",this._getRoutePatch()),(0,AP.isWrapped)(n.use)&&this._unwrap(n,"use"),this._wrap(n,"use",this._getRouterUsePatch()),(0,AP.isWrapped)(e.application.use)&&this._unwrap(e.application,"use"),this._wrap(e.application,"use",this._getAppUsePatch(t)),e},e=>{if(void 0===e)return;const t="function"==typeof e?.Router?.prototype?.route?e.Router.prototype:e.Router;this._unwrap(t,"route"),this._unwrap(t,"use"),this._unwrap(e.application,"use")})]}_getRoutePatch(){const e=this;return function(t){return function(...n){const r=t.apply(this,n),s=this.stack[this.stack.length-1];return e._applyPatch(s,(0,TP.getLayerPath)(n)),r}}}_getRouterUsePatch(){const e=this;return function(t){return function(...n){const r=t.apply(this,n),s=this.stack[this.stack.length-1];return e._applyPatch(s,(0,TP.getLayerPath)(n)),r}}}_getAppUsePatch(e){const t=this;return function(n){return function(...r){const s=e?this.router:this._router,o=n.apply(this,r);if(s){const e=s.stack[s.stack.length-1];t._applyPatch(e,(0,TP.getLayerPath)(r))}return o}}}_applyPatch(e,t){const n=this;!0!==e[bP.kLayerPatched]&&(e[bP.kLayerPatched]=!0,this._wrap(e,"handle",r=>{if(4===r.length)return r;const s=function(s,o){const{isLayerPathStored:i}=(0,TP.storeLayerPath)(s,t),a=(0,TP.getConstructedRoute)(s),c=(0,TP.getActualMatchedRoute)(s),u={[vP.ATTR_HTTP_ROUTE]:c},l=(0,TP.getLayerMetadata)(a,e,t),p=l.attributes[SP.AttributeNames.EXPRESS_TYPE],d=(0,mP.getRPCMetadata)(gP.context.active());if(d?.type===mP.RPCType.HTTP&&(d.route=c),(0,TP.isLayerIgnored)(l.name,p,n.getConfig()))return p===EP.ExpressLayerType.MIDDLEWARE&&s[bP._LAYERS_STORE_PROPERTY].pop(),r.apply(this,arguments);if(void 0===gP.trace.getSpan(gP.context.active()))return r.apply(this,arguments);const h=n._getSpanName({request:s,layerType:p,route:a},l.name),f=n.tracer.startSpan(h,{attributes:Object.assign(u,l.attributes)}),_=gP.context.active();let m=gP.trace.setSpan(_,f);const{requestHook:g}=n.getConfig();g&&(0,AP.safeExecuteInTheMiddle)(()=>g(f,{request:s,layerType:p,route:a}),e=>{e&&gP.diag.error("express instrumentation: request hook failed",e)},!0);let E=!1;l.attributes[SP.AttributeNames.EXPRESS_TYPE]===EP.ExpressLayerType.ROUTER&&(f.end(),E=!0,m=_);const S=()=>{!1===E&&(E=!0,f.end())},T=Array.from(arguments),y=T.findIndex(e=>"function"==typeof e);y>=0&&(arguments[y]=function(){const e=arguments[0],t=![void 0,null,"route","router"].includes(e);if(!E&&t){const[t,n]=(0,TP.asErrorAndMessage)(e);f.recordException(t),f.setStatus({code:gP.SpanStatusCode.ERROR,message:n})}!1===E&&(E=!0,s.res?.removeListener("finish",S),f.end()),s.route&&t||!i||s[bP._LAYERS_STORE_PROPERTY].pop();const n=T[y];return gP.context.bind(_,n).apply(this,arguments)});try{return gP.context.bind(m,r).apply(this,arguments)}catch(e){const[t,n]=(0,TP.asErrorAndMessage)(e);throw f.recordException(t),f.setStatus({code:gP.SpanStatusCode.ERROR,message:n}),e}finally{E||o.once("finish",S)}};for(const e in r)Object.defineProperty(s,e,{get:()=>r[e],set(t){r[e]=t}});return s}))}_getSpanName(e,t){const{spanNameHook:n}=this.getConfig();if(!(n instanceof Function))return t;try{return n(e,t)??t}catch(e){return gP.diag.error("express instrumentation: error calling span name rewrite hook",e),t}}}lP.ExpressInstrumentation=RP,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.ExpressLayerType=e.ExpressInstrumentation=void 0;var t=lP;Object.defineProperty(e,"ExpressInstrumentation",{enumerable:!0,get:function(){return t.ExpressInstrumentation}});var n=pP;Object.defineProperty(e,"ExpressLayerType",{enumerable:!0,get:function(){return n.ExpressLayerType}});var r=dP;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return r.AttributeNames}})}(uP);const OP="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,NP="Express";const CP=dO(NP,()=>new uP.ExpressInstrumentation({requestHook:e=>function(e){VI(e,"auto.http.otel.express");const t=mA(e).data,n=t["express.type"];n&&e.setAttribute(Uy,`${n}.express`);const r=t["express.name"];"string"==typeof r&&e.updateName(r)}(e),spanNameHook:(e,t)=>function(e,t){if(My()===vy())return OP&&TT.warn("Isolation scope is still default isolation scope - skipping setting transactionName"),t;if("request_handler"===e.layerType){const t=e.request,n=t.method?t.method.toUpperCase():"GET";My().setTransactionName(`${n} ${e.route}`)}return t}(e,t)})),IP=()=>({name:NP,setupOnce(){CP()}});var PP=MP;function MP(e,t,n){e instanceof RegExp&&(e=wP(e,n)),t instanceof RegExp&&(t=wP(t,n));var r=LP(e,t,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+e.length,r[1]),post:n.slice(r[1]+t.length)}}function wP(e,t){var n=t.match(e);return n?n[0]:null}function LP(e,t,n){var r,s,o,i,a,c=n.indexOf(e),u=n.indexOf(t,c+1),l=c;if(c>=0&&u>0){if(e===t)return[c,u];for(r=[],o=n.length;l>=0&&!a;)l==c?(r.push(l),c=n.indexOf(e,l+1)):1==r.length?a=[r.pop(),u]:((s=r.pop())<o&&(o=s,i=u),u=n.indexOf(t,l+1)),l=c<u&&c>=0?c:u;r.length&&(a=[o,i])}return a}MP.range=LP;var xP=PP,DP=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return WP(function(e){return e.split("\\\\").join(kP).split("\\{").join(UP).split("\\}").join($P).split("\\,").join(GP).split("\\.").join(jP)}(e),!0).map(HP)},kP="\0SLASH"+Math.random()+"\0",UP="\0OPEN"+Math.random()+"\0",$P="\0CLOSE"+Math.random()+"\0",GP="\0COMMA"+Math.random()+"\0",jP="\0PERIOD"+Math.random()+"\0";function VP(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function HP(e){return e.split(kP).join("\\").split(UP).join("{").split($P).join("}").split(GP).join(",").split(jP).join(".")}function BP(e){if(!e)return[""];var t=[],n=xP("{","}",e);if(!n)return e.split(",");var r=n.pre,s=n.body,o=n.post,i=r.split(",");i[i.length-1]+="{"+s+"}";var a=BP(o);return o.length&&(i[i.length-1]+=a.shift(),i.push.apply(i,a)),t.push.apply(t,i),t}function FP(e){return"{"+e+"}"}function YP(e){return/^-?0\d/.test(e)}function qP(e,t){return e<=t}function KP(e,t){return e>=t}function WP(e,t){var n=[],r=xP("{","}",e);if(!r)return[e];var s=r.pre,o=r.post.length?WP(r.post,!1):[""];if(/\$$/.test(r.pre))for(var i=0;i<o.length;i++){var a=s+"{"+r.body+"}"+o[i];n.push(a)}else{var c,u,l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),d=l||p,h=r.body.indexOf(",")>=0;if(!d&&!h)return r.post.match(/,(?!,).*\}/)?WP(e=r.pre+"{"+r.body+$P+r.post):[e];if(d)c=r.body.split(/\.\./);else if(1===(c=BP(r.body)).length&&1===(c=WP(c[0],!1).map(FP)).length)return o.map(function(e){return r.pre+c[0]+e});if(d){var f=VP(c[0]),_=VP(c[1]),m=Math.max(c[0].length,c[1].length),g=3==c.length?Math.abs(VP(c[2])):1,E=qP;_<f&&(g*=-1,E=KP);var S=c.some(YP);u=[];for(var T=f;E(T,_);T+=g){var y;if(p)"\\"===(y=String.fromCharCode(T))&&(y="");else if(y=String(T),S){var A=m-y.length;if(A>0){var v=new Array(A+1).join("0");y=T<0?"-"+v+y.slice(1):v+y}}u.push(y)}}else{u=[];for(var b=0;b<c.length;b++)u.push.apply(u,WP(c[b],!1))}for(b=0;b<u.length;b++)for(i=0;i<o.length;i++){a=s+u[b]+o[i];(!t||d||a)&&n.push(a)}}return n}var ZP=Ht(DP);const XP=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},zP={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},QP=e=>e.replace(/[[\]\\-]/g,"\\$&"),JP=e=>e.join(""),eM=(e,t)=>{const n=t;if("["!==e.charAt(n))throw new Error("not in a brace expression");const r=[],s=[];let o=n+1,i=!1,a=!1,c=!1,u=!1,l=n,p="";e:for(;o<e.length;){const t=e.charAt(o);if("!"!==t&&"^"!==t||o!==n+1){if("]"===t&&i&&!c){l=o+1;break}if(i=!0,"\\"!==t||c){if("["===t&&!c)for(const[t,[i,c,u]]of Object.entries(zP))if(e.startsWith(t,o)){if(p)return["$.",!1,e.length-n,!0];o+=t.length,u?s.push(i):r.push(i),a=a||c;continue e}c=!1,p?(t>p?r.push(QP(p)+"-"+QP(t)):t===p&&r.push(QP(t)),p="",o++):e.startsWith("-]",o+1)?(r.push(QP(t+"-")),o+=2):e.startsWith("-",o+1)?(p=t,o+=2):(r.push(QP(t)),o++)}else c=!0,o++}else u=!0,o++}if(l<o)return["",!1,0,!1];if(!r.length&&!s.length)return["$.",!1,e.length-n,!0];if(0===s.length&&1===r.length&&/^\\?.$/.test(r[0])&&!u){const e=2===r[0].length?r[0].slice(-1):r[0];return[(d=e,d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,l-n,!1]}var d;const h="["+(u?"^":"")+JP(r)+"]",f="["+(u?"":"^")+JP(s)+"]";return[r.length&&s.length?"("+h+"|"+f+")":r.length?h:f,a,l-n,!0]},tM=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),nM=new Set(["!","?","+","*","@"]),rM=e=>nM.has(e),sM="(?!\\.)",oM=new Set(["[","."]),iM=new Set(["..","."]),aM=new Set("().*{}+?[]^$\\!"),cM=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),uM="[^/]",lM=uM+"*?",pM=uM+"+?";class dM{type;#e;#t;#n=!1;#r=[];#s;#o;#i;#a=!1;#c;#u;#l=!1;constructor(e,t,n={}){this.type=e,e&&(this.#t=!0),this.#s=t,this.#e=this.#s?this.#s.#e:this,this.#c=this.#e===this?n:this.#e.#c,this.#i=this.#e===this?[]:this.#e.#i,"!"!==e||this.#e.#a||this.#i.push(this),this.#o=this.#s?this.#s.#r.length:0}get hasMagic(){if(void 0!==this.#t)return this.#t;for(const e of this.#r)if("string"!=typeof e&&(e.type||e.hasMagic))return this.#t=!0;return this.#t}toString(){return void 0!==this.#u?this.#u:this.type?this.#u=this.type+"("+this.#r.map(e=>String(e)).join("|")+")":this.#u=this.#r.map(e=>String(e)).join("")}#p(){if(this!==this.#e)throw new Error("should only call on root");if(this.#a)return this;let e;for(this.toString(),this.#a=!0;e=this.#i.pop();){if("!"!==e.type)continue;let t=e,n=t.#s;for(;n;){for(let r=t.#o+1;!n.type&&r<n.#r.length;r++)for(const t of e.#r){if("string"==typeof t)throw new Error("string part in extglob AST??");t.copyIn(n.#r[r])}t=n,n=t.#s}}return this}push(...e){for(const t of e)if(""!==t){if("string"!=typeof t&&!(t instanceof dM&&t.#s===this))throw new Error("invalid part: "+t);this.#r.push(t)}}toJSON(){const e=null===this.type?this.#r.slice().map(e=>"string"==typeof e?e:e.toJSON()):[this.type,...this.#r.map(e=>e.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#a&&"!"===this.#s?.type)&&e.push({}),e}isStart(){if(this.#e===this)return!0;if(!this.#s?.isStart())return!1;if(0===this.#o)return!0;const e=this.#s;for(let t=0;t<this.#o;t++){const n=e.#r[t];if(!(n instanceof dM&&"!"===n.type))return!1}return!0}isEnd(){if(this.#e===this)return!0;if("!"===this.#s?.type)return!0;if(!this.#s?.isEnd())return!1;if(!this.type)return this.#s?.isEnd();const e=this.#s?this.#s.#r.length:0;return this.#o===e-1}copyIn(e){"string"==typeof e?this.push(e):this.push(e.clone(this))}clone(e){const t=new dM(this.type,e);for(const e of this.#r)t.copyIn(e);return t}static#d(e,t,n,r){let s=!1,o=!1,i=-1,a=!1;if(null===t.type){let c=n,u="";for(;c<e.length;){const n=e.charAt(c++);if(s||"\\"===n)s=!s,u+=n;else if(o)c===i+1?"^"!==n&&"!"!==n||(a=!0):"]"!==n||c===i+2&&a||(o=!1),u+=n;else if("["!==n){if(!r.noext&&rM(n)&&"("===e.charAt(c)){t.push(u),u="";const s=new dM(n,t);c=dM.#d(e,s,c,r),t.push(s);continue}u+=n}else o=!0,i=c,a=!1,u+=n}return t.push(u),c}let c=n+1,u=new dM(null,t);const l=[];let p="";for(;c<e.length;){const n=e.charAt(c++);if(s||"\\"===n)s=!s,p+=n;else if(o)c===i+1?"^"!==n&&"!"!==n||(a=!0):"]"!==n||c===i+2&&a||(o=!1),p+=n;else if("["!==n){if(rM(n)&&"("===e.charAt(c)){u.push(p),p="";const t=new dM(n,u);u.push(t),c=dM.#d(e,t,c,r);continue}if("|"!==n){if(")"===n)return""===p&&0===t.#r.length&&(t.#l=!0),u.push(p),p="",t.push(...l,u),c;p+=n}else u.push(p),p="",l.push(u),u=new dM(null,t)}else o=!0,i=c,a=!1,p+=n}return t.type=null,t.#t=void 0,t.#r=[e.substring(n-1)],c}static fromGlob(e,t={}){const n=new dM(null,void 0,t);return dM.#d(e,n,0,t),n}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();const e=this.toString(),[t,n,r,s]=this.toRegExpSource();if(!(r||this.#t||this.#c.nocase&&!this.#c.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;const o=(this.#c.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${t}$`,o),{_src:t,_glob:e})}get options(){return this.#c}toRegExpSource(e){const t=e??!!this.#c.dot;if(this.#e===this&&this.#p(),!this.type){const n=this.isStart()&&this.isEnd(),r=this.#r.map(t=>{const[r,s,o,i]="string"==typeof t?dM.#h(t,this.#t,n):t.toRegExpSource(e);return this.#t=this.#t||o,this.#n=this.#n||i,r}).join("");let s="";if(this.isStart()&&"string"==typeof this.#r[0]){if(!(1===this.#r.length&&iM.has(this.#r[0]))){const n=oM,o=t&&n.has(r.charAt(0))||r.startsWith("\\.")&&n.has(r.charAt(2))||r.startsWith("\\.\\.")&&n.has(r.charAt(4)),i=!t&&!e&&n.has(r.charAt(0));s=o?"(?!(?:^|/)\\.\\.?(?:$|/))":i?sM:""}}let o="";this.isEnd()&&this.#e.#a&&"!"===this.#s?.type&&(o="(?:$|\\/)");return[s+r+o,tM(r),this.#t=!!this.#t,this.#n]}const n="*"===this.type||"+"===this.type,r="!"===this.type?"(?:(?!(?:":"(?:";let s=this.#f(t);if(this.isStart()&&this.isEnd()&&!s&&"!"!==this.type){const e=this.toString();return this.#r=[e],this.type=null,this.#t=void 0,[e,tM(this.toString()),!1,!1]}let o=!n||e||t?"":this.#f(!0);o===s&&(o=""),o&&(s=`(?:${s})(?:${o})*?`);let i="";if("!"===this.type&&this.#l)i=(this.isStart()&&!t?sM:"")+pM;else{i=r+s+("!"===this.type?"))"+(!this.isStart()||t||e?"":sM)+lM+")":"@"===this.type?")":"?"===this.type?")?":"+"===this.type&&o?")":"*"===this.type&&o?")?":`)${this.type}`)}return[i,tM(s),this.#t=!!this.#t,this.#n]}#f(e){return this.#r.map(t=>{if("string"==typeof t)throw new Error("string type in extglob ast??");const[n,r,s,o]=t.toRegExpSource(e);return this.#n=this.#n||o,n}).filter(e=>!(this.isStart()&&this.isEnd()&&!e)).join("|")}static#h(e,t,n=!1){let r=!1,s="",o=!1;for(let i=0;i<e.length;i++){const a=e.charAt(i);if(r)r=!1,s+=(aM.has(a)?"\\":"")+a;else if("\\"!==a){if("["===a){const[n,r,a,c]=eM(e,i);if(a){s+=n,o=o||r,i+=a-1,t=t||c;continue}}"*"!==a?"?"!==a?s+=cM(a):(s+=uM,t=!0):(s+=n&&"*"===e?pM:lM,t=!0)}else i===e.length-1?s+="\\\\":r=!0}return[s,tM(e),!!t,o]}}const hM=(e,t,n={})=>(XP(t),!(!n.nocomment&&"#"===t.charAt(0))&&new GM(t,n).match(e)),fM=/^\*+([^+@!?\*\[\(]*)$/,_M=e=>t=>!t.startsWith(".")&&t.endsWith(e),mM=e=>t=>t.endsWith(e),gM=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),EM=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),SM=/^\*+\.\*+$/,TM=e=>!e.startsWith(".")&&e.includes("."),yM=e=>"."!==e&&".."!==e&&e.includes("."),AM=/^\.\*+$/,vM=e=>"."!==e&&".."!==e&&e.startsWith("."),bM=/^\*+$/,RM=e=>0!==e.length&&!e.startsWith("."),OM=e=>0!==e.length&&"."!==e&&".."!==e,NM=/^\?+([^+@!?\*\[\(]*)?$/,CM=([e,t=""])=>{const n=wM([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},IM=([e,t=""])=>{const n=LM([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},PM=([e,t=""])=>{const n=LM([e]);return t?e=>n(e)&&e.endsWith(t):n},MM=([e,t=""])=>{const n=wM([e]);return t?e=>n(e)&&e.endsWith(t):n},wM=([e])=>{const t=e.length;return e=>e.length===t&&!e.startsWith(".")},LM=([e])=>{const t=e.length;return e=>e.length===t&&"."!==e&&".."!==e},xM="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";hM.sep="win32"===xM?{sep:"\\"}.sep:{sep:"/"}.sep;const DM=Symbol("globstar **");hM.GLOBSTAR=DM;hM.filter=(e,t={})=>n=>hM(n,e,t);const kM=(e,t={})=>Object.assign({},e,t);hM.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return hM;const t=hM;return Object.assign((n,r,s={})=>t(n,r,kM(e,s)),{Minimatch:class extends t.Minimatch{constructor(t,n={}){super(t,kM(e,n))}static defaults(n){return t.defaults(kM(e,n)).Minimatch}},AST:class extends t.AST{constructor(t,n,r={}){super(t,n,kM(e,r))}static fromGlob(n,r={}){return t.AST.fromGlob(n,kM(e,r))}},unescape:(n,r={})=>t.unescape(n,kM(e,r)),escape:(n,r={})=>t.escape(n,kM(e,r)),filter:(n,r={})=>t.filter(n,kM(e,r)),defaults:n=>t.defaults(kM(e,n)),makeRe:(n,r={})=>t.makeRe(n,kM(e,r)),braceExpand:(n,r={})=>t.braceExpand(n,kM(e,r)),match:(n,r,s={})=>t.match(n,r,kM(e,s)),sep:t.sep,GLOBSTAR:DM})};const UM=(e,t={})=>(XP(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:ZP(e));hM.braceExpand=UM;hM.makeRe=(e,t={})=>new GM(e,t).makeRe();hM.match=(e,t,n={})=>{const r=new GM(t,n);return e=e.filter(e=>r.match(e)),r.options.nonull&&!e.length&&e.push(t),e};const $M=/[?*]|[+@!]\(.*?\)|\[|\]/;class GM{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){XP(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||xM,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||!1===t.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==t.windowsNoMagicRoot?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if("string"!=typeof t)return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,this.globSet);const n=this.globSet.map(e=>this.slashSplit(e));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let r=this.globParts.map((e,t,n)=>{if(this.isWindows&&this.windowsNoMagicRoot){const t=!(""!==e[0]||""!==e[1]||"?"!==e[2]&&$M.test(e[2])||$M.test(e[3])),n=/^[a-z]:/i.test(e[0]);if(t)return[...e.slice(0,4),...e.slice(4).map(e=>this.parse(e))];if(n)return[e[0],...e.slice(1).map(e=>this.parse(e))]}return e.map(e=>this.parse(e))});if(this.debug(this.pattern,r),this.set=r.filter(e=>-1===e.indexOf(!1)),this.isWindows)for(let e=0;e<this.set.length;e++){const t=this.set[e];""===t[0]&&""===t[1]&&"?"===this.globParts[e][2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3])&&(t[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++)"**"===e[t][n]&&(e[t][n]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(e=>{let t=-1;for(;-1!==(t=e.indexOf("**",t+1));){let n=t;for(;"**"===e[n+1];)n++;n!==t&&e.splice(t,n-t)}return e})}levelOneOptimize(e){return e.map(e=>0===(e=e.reduce((e,t)=>{const n=e[e.length-1];return"**"===t&&"**"===n?e:".."===t&&n&&".."!==n&&"."!==n&&"**"!==n?(e.pop(),e):(e.push(t),e)},[])).length?[""]:e)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let n=1;n<e.length-1;n++){const r=e[n];1===n&&""===r&&""===e[0]||("."!==r&&""!==r||(t=!0,e.splice(n,1),n--))}"."!==e[0]||2!==e.length||"."!==e[1]&&""!==e[1]||(t=!0,e.pop())}let n=0;for(;-1!==(n=e.indexOf("..",n+1));){const r=e[n-1];r&&"."!==r&&".."!==r&&"**"!==r&&(t=!0,e.splice(n-1,2),n-=2)}}while(t);return 0===e.length?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let n of e){let r=-1;for(;-1!==(r=n.indexOf("**",r+1));){let s=r;for(;"**"===n[s+1];)s++;s>r&&n.splice(r+1,s-r);let o=n[r+1];const i=n[r+2],a=n[r+3];if(".."!==o)continue;if(!i||"."===i||".."===i||!a||"."===a||".."===a)continue;t=!0,n.splice(r,1);const c=n.slice(0);c[r]="**",e.push(c),r--}if(!this.preserveMultipleSlashes){for(let e=1;e<n.length-1;e++){const r=n[e];1===e&&""===r&&""===n[0]||("."!==r&&""!==r||(t=!0,n.splice(e,1),e--))}"."!==n[0]||2!==n.length||"."!==n[1]&&""!==n[1]||(t=!0,n.pop())}let s=0;for(;-1!==(s=n.indexOf("..",s+1));){const e=n[s-1];if(e&&"."!==e&&".."!==e&&"**"!==e){t=!0;const e=1===s&&"**"===n[s+1]?["."]:[];n.splice(s-1,2,...e),0===n.length&&n.push(""),s-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let n=t+1;n<e.length;n++){const r=this.partsMatch(e[t],e[n],!this.preserveMultipleSlashes);if(r){e[t]=[],e[n]=r;break}}return e.filter(e=>e.length)}partsMatch(e,t,n=!1){let r=0,s=0,o=[],i="";for(;r<e.length&&s<t.length;)if(e[r]===t[s])o.push("b"===i?t[s]:e[r]),r++,s++;else if(n&&"**"===e[r]&&t[s]===e[r+1])o.push(e[r]),r++;else if(n&&"**"===t[s]&&e[r]===t[s+1])o.push(t[s]),s++;else if("*"!==e[r]||!t[s]||!this.options.dot&&t[s].startsWith(".")||"**"===t[s]){if("*"!==t[s]||!e[r]||!this.options.dot&&e[r].startsWith(".")||"**"===e[r])return!1;if("a"===i)return!1;i="b",o.push(t[s]),r++,s++}else{if("b"===i)return!1;i="a",o.push(e[r]),r++,s++}return e.length===t.length&&o}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,n=0;for(let r=0;r<e.length&&"!"===e.charAt(r);r++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n=!1){const r=this.options;if(this.isWindows){const n="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),r=!n&&""===e[0]&&""===e[1]&&"?"===e[2]&&/^[a-z]:$/i.test(e[3]),s="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),o=r?3:n?0:void 0,i=!s&&""===t[0]&&""===t[1]&&"?"===t[2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3])?3:s?0:void 0;if("number"==typeof o&&"number"==typeof i){const[n,r]=[e[o],t[i]];n.toLowerCase()===r.toLowerCase()&&(t[i]=n,i>o?t=t.slice(i):o>i&&(e=e.slice(o)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var o=0,i=0,a=e.length,c=t.length;o<a&&i<c;o++,i++){this.debug("matchOne loop");var u=t[i],l=e[o];if(this.debug(t,u,l),!1===u)return!1;if(u===DM){this.debug("GLOBSTAR",[t,u,l]);var p=o,d=i+1;if(d===c){for(this.debug("** at the end");o<a;o++)if("."===e[o]||".."===e[o]||!r.dot&&"."===e[o].charAt(0))return!1;return!0}for(;p<a;){var h=e[p];if(this.debug("\nglobstar while",e,p,t,d,h),this.matchOne(e.slice(p),t.slice(d),n))return this.debug("globstar found match!",p,a,h),!0;if("."===h||".."===h||!r.dot&&"."===h.charAt(0)){this.debug("dot detected!",e,p,t,d);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!n||(this.debug("\n>>> no match, partial?",e,p,t,d),p!==a))}let s;if("string"==typeof u?(s=l===u,this.debug("string match",u,l,s)):(s=u.test(l),this.debug("pattern match",u,l,s)),!s)return!1}if(o===a&&i===c)return!0;if(o===a)return n;if(i===c)return o===a-1&&""===e[o];throw new Error("wtf?")}braceExpand(){return UM(this.pattern,this.options)}parse(e){XP(e);const t=this.options;if("**"===e)return DM;if(""===e)return"";let n,r=null;(n=e.match(bM))?r=t.dot?OM:RM:(n=e.match(fM))?r=(t.nocase?t.dot?EM:gM:t.dot?mM:_M)(n[1]):(n=e.match(NM))?r=(t.nocase?t.dot?IM:CM:t.dot?PM:MM)(n):(n=e.match(SM))?r=t.dot?yM:TM:(n=e.match(AM))&&(r=vM);const s=dM.fromGlob(e,this.options).toMMPattern();return r&&"object"==typeof s&&Reflect.defineProperty(s,"test",{value:r}),s}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,n=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=new Set(t.nocase?["i"]:[]);let s=e.map(e=>{const t=e.map(e=>{if(e instanceof RegExp)for(const t of e.flags.split(""))r.add(t);return"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===DM?DM:e._src});return t.forEach((e,r)=>{const s=t[r+1],o=t[r-1];e===DM&&o!==DM&&(void 0===o?void 0!==s&&s!==DM?t[r+1]="(?:\\/|"+n+"\\/)?"+s:t[r]=n:void 0===s?t[r-1]=o+"(?:\\/|"+n+")?":s!==DM&&(t[r-1]=o+"(?:\\/|\\/"+n+"\\/)"+s,t[r+1]=DM))}),t.filter(e=>e!==DM).join("/")}).join("|");const[o,i]=e.length>1?["(?:",")"]:["",""];s="^"+o+s+i+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...r].join(""))}catch(e){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const n=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const s=this.set;this.debug(this.pattern,"set",s);let o=r[r.length-1];if(!o)for(let e=r.length-2;!o&&e>=0;e--)o=r[e];for(let e=0;e<s.length;e++){const i=s[e];let a=r;n.matchBase&&1===i.length&&(a=[o]);if(this.matchOne(a,i,t))return!!n.flipNegate||!this.negate}return!n.flipNegate&&this.negate}static defaults(e){return hM.defaults(e).Minimatch}}hM.AST=dM,hM.Minimatch=GM,hM.escape=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),hM.unescape=tM;const jM="@fastify/otel",VM=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],HM="hook.name",BM="fastify.type",FM="hook.callback.name",YM="fastify.root",qM="route-hook",KM="hook",WM="request-handler",ZM="anonymous",XM=Symbol("fastify otel instance"),zM=Symbol("fastify otel request spans"),QM=Symbol("fastify otel request context"),JM=Symbol("fastify otel addhook original"),ew=Symbol("fastify otel setnotfound original"),tw=Symbol("fastify otel ignore path");class nw extends IS{constructor(e){if(super(jM,"0.8.0",e),this.servername=e?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[tw]=null,this._logger=vt.createComponentLogger({namespace:jM}),null!=e?.ignorePaths||null!=process.env.OTEL_FASTIFY_IGNORE_PATHS){const t=e?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if(("string"!=typeof t||0===t.length)&&"function"!=typeof t)throw new TypeError("ignorePaths must be a string or a function");const n=hM;this[tw]=e=>"function"==typeof t?t(e):n(e.url,t)}}enable(){if(void 0===this._handleInitialization&&this.getConfig().registerOnInitialization){const e=this.plugin();this._handleInitialization=t=>{t.fastify.register(e)},p.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){return this._handleInitialization&&(p.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0),super.disable()}init(){return[]}plugin(){const e=this;return t[Symbol.for("skip-override")]=!0,t[Symbol.for("fastify.display-name")]="@fastify/otel",t[Symbol.for("plugin-meta")]={fastify:">=4.0.0 <6",name:"@fastify/otel"},t;function t(t,n,r){function s(e,t,n,r){const s=e[zM];null!=s&&(t.statusCode<500&&s.setStatus({code:dt.OK,message:"OK"}),s.setAttributes({[Y_]:t.statusCode}),s.end()),e[zM]=null,r(null,n)}function o(e,t,n,r){const s=e[zM];null!=s&&(s.setStatus({code:dt.ERROR,message:n.message}),s.recordException(n)),r()}function i(e,t={}){return function(...n){const r=this[XM],[s]=n;if(!1===r.isEnabled())return e.call(this,...n);const o=s[QM]??At.active(),i=r.tracer.startSpan(`handler - ${e.name?.length>0?e.name:this.pluginName??ZM}`,{attributes:t},o);return At.with(jt.setSpan(o,i),function(){try{const t=e.call(this,...n);return"function"==typeof t?.then?t.then(e=>(i.end(),e),e=>(i.setStatus({code:dt.ERROR,message:e.message}),i.recordException(e),i.end(),Promise.reject(e))):(i.end(),t)}catch(e){throw i.setStatus({code:dt.ERROR,message:e.message}),i.recordException(e),i.end(),e}},this)}}t.decorate(XM,e),t.decorate(JM,t.addHook),t.decorate(ew,t.setNotFoundHandler),t.decorateRequest("opentelemetry",function(){const t=this[QM];return{span:this[zM],tracer:e.tracer,context:t,inject:(e,n)=>Ut.inject(t,e,n),extract:(e,n)=>Ut.extract(t,e,n)}}),t.decorateRequest(zM,null),t.decorateRequest(QM,null),t.addHook("onRoute",function(n){if(!0!==e[tw]?.(n)){for(const e of VM)if(null!=n[e]){const r=n[e];if("function"==typeof r)n[e]=i(r,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - route -> ${e}`,[BM]:qM,[q_]:n.url,[FM]:r.name?.length>0?r.name:ZM});else if(Array.isArray(r)){const s=[];for(const o of r)s.push(i(o,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - route -> ${e}`,[BM]:qM,[q_]:n.url,[FM]:o.name?.length>0?o.name:ZM}));n[e]=s}}null!=n.onSend?n.onSend=Array.isArray(n.onSend)?[...n.onSend,s]:[n.onSend,s]:n.onSend=s,null!=n.onError?n.onError=Array.isArray(n.onError)?[...n.onError,o]:[n.onError,o]:n.onError=o,n.handler=i(n.handler,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - route-handler`,[BM]:WM,[q_]:n.url,[FM]:n.handler.name.length>0?n.handler.name:ZM})}else e._logger.debug(`Ignoring route instrumentation ${n.method} ${n.url} because it matches the ignore path`)}),t.addHook("onRequest",function(e,n,r){if(!1===this[XM].isEnabled())return r();if(!0===this[XM][tw]?.({url:e.url,method:e.method}))return this[XM]._logger.debug(`Ignoring request ${e.method} ${e.url} because it matches the ignore path`),r();let s=At.active();null==jt.getSpan(s)&&(s=Ut.extract(s,e.headers));const o=Om(s);null!=e.routeOptions.url&&o?.type===Rm.HTTP&&(o.route=e.routeOptions.url);const i=this[XM].tracer.startSpan("request",{attributes:{[Z_]:t[XM].servername,[YM]:"@fastify/otel",[q_]:e.url,[F_]:e.method}},s);e[QM]=jt.setSpan(s,i),e[zM]=i,At.with(e[QM],()=>{r()})}),t.addHook("onResponse",function(e,t,n){const r=e[zM];null!=r&&(r.setStatus({code:dt.OK,message:"OK"}),r.setAttributes({[Y_]:404}),r.end()),e[zM]=null,n()}),t.addHook=function(e,n){const r=this[JM];return VM.includes(e)?r.call(this,e,i(n,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - ${e}`,[BM]:KM,[FM]:n.name?.length>0?n.name:ZM})):r.call(this,e,n)},t.setNotFoundHandler=function(e,n){const r=this[ew];"function"==typeof e?(n=i(e,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - not-found-handler`,[BM]:KM,[FM]:e.name?.length>0?e.name:ZM}),r.call(this,n)):(null!=e.preValidation&&(e.preValidation=i(e.preValidation,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - not-found-handler - preValidation`,[BM]:KM,[FM]:e.preValidation.name?.length>0?e.preValidation.name:ZM})),null!=e.preHandler&&(e.preHandler=i(e.preHandler,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - not-found-handler - preHandler`,[BM]:KM,[FM]:e.preHandler.name?.length>0?e.preHandler.name:ZM})),n=i(n,{[Z_]:t[XM].servername,[HM]:`${this.pluginName} - not-found-handler`,[BM]:KM,[FM]:n.name?.length>0?n.name:ZM}),r.call(this,e,n))},r()}}}var rw,sw,ow;!function(e){e.FASTIFY_NAME="fastify.name";e.FASTIFY_TYPE="fastify.type";e.HOOK_NAME="hook.name";e.PLUGIN_NAME="plugin.name"}(rw||(rw={})),function(e){e.MIDDLEWARE="middleware";e.REQUEST_HANDLER="request_handler"}(sw||(sw={})),function(e){e.MIDDLEWARE="middleware";e.REQUEST_HANDLER="request handler"}(ow||(ow={}));const iw=Symbol("opentelemetry.instrumentation.fastify.request_active_span");function aw(e,t,n,r={}){const s=t.startSpan(n,{attributes:r}),o=e[iw]||[];return o.push(s),Object.defineProperty(e,iw,{enumerable:!1,configurable:!0,value:o}),s}function cw(e,t){const n=e[iw]||[];n.length&&(n.forEach(e=>{t&&(e.setStatus({code:dt.ERROR,message:t.message}),e.recordException(t)),e.end()}),delete e[iw])}function uw(e){return"object"==typeof e&&e&&"function"==typeof Object.getOwnPropertyDescriptor(e,"then")?.value||!1}const lw="anonymous",pw=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);class dw extends IS{constructor(e={}){super("@sentry/instrumentation-fastify-v3","0.1.0",e)}init(){return[new MS("fastify",[">=3.0.0 <4"],e=>this._patchConstructor(e))]}_hookOnRequest(){const e=this;return function(t,n,r){if(!e.isEnabled())return r();e._wrap(n,"send",e._patchSend());const s=t,o=Om(At.active()),i=s.routeOptions?s.routeOptions.url:t.routerPath;i&&o?.type===Rm.HTTP&&(o.route=i);const a=t.method||"GET";My().setTransactionName(`${a} ${i}`),r()}}_wrapHandler(e,t,n,r){const s=this;return this._diag.debug("Patching fastify route.handler function"),function(...o){if(!s.isEnabled())return n.apply(this,o);const i=n.name||e||lw,a=`${ow.MIDDLEWARE} - ${i}`,c=o[1],u=aw(c,s.tracer,a,{[rw.FASTIFY_TYPE]:sw.MIDDLEWARE,[rw.PLUGIN_NAME]:e,[rw.HOOK_NAME]:t}),l=r&&o[o.length-1];return l&&(o[o.length-1]=function(...e){cw(c),l.apply(this,e)}),At.with(jt.setSpan(At.active(),u),()=>function(e,t){let n,r;try{r=e(),uw(r)&&r.then(e=>t(void 0,e),e=>t(e))}catch(e){n=e}finally{if(!uw(r)&&(t(n,r),n))throw n;return r}}(()=>n.apply(this,o),e=>{e instanceof Error&&(u.setStatus({code:dt.ERROR,message:e.message}),u.recordException(e)),r||cw(c)}))}}_wrapAddHook(){const e=this;return this._diag.debug("Patching fastify server.addHook function"),function(t){return function(...n){const r=n[0],s=n[1],o=this.pluginName;if(!pw.has(r))return t.apply(this,n);const i="function"==typeof n[n.length-1]&&"AsyncFunction"!==s.constructor.name;return t.apply(this,[r,e._wrapHandler(o,r,s,i)])}}}_patchConstructor(e){const t=this;function n(...n){const r=e.fastify.apply(this,n);return r.addHook("onRequest",t._hookOnRequest()),r.addHook("preHandler",t._hookPreHandler()),function(){const e=Ly();e&&e.on("spanStart",e=>{hw(e)})}(),t._wrap(r,"addHook",t._wrapAddHook()),r}return void 0!==e.errorCodes&&(n.errorCodes=e.errorCodes),n.fastify=n,n.default=n,n}_patchSend(){const e=this;return this._diag.debug("Patching fastify reply.send function"),function(t){return function(...n){const r=n[0];return e.isEnabled()?NS(()=>t.apply(this,n),e=>{!e&&r instanceof Error&&(e=r),cw(this,e)}):t.apply(this,n)}}}_hookPreHandler(){const e=this;return this._diag.debug("Patching fastify preHandler function"),function(t,n,r){if(!e.isEnabled())return r();const s=t,o=s.routeOptions?.handler||s.context?.handler,i=o?.name.startsWith("bound ")?o.name.substring(6):o?.name,a=`${ow.REQUEST_HANDLER} - ${i||this.pluginName||lw}`,c={[rw.PLUGIN_NAME]:this.pluginName,[rw.FASTIFY_TYPE]:sw.REQUEST_HANDLER,[Jo]:s.routeOptions?s.routeOptions.url:t.routerPath};i&&(c[rw.FASTIFY_NAME]=i);const u=aw(n,e.tracer,a,c);hw(u);const{requestHook:l}=e.getConfig();return l&&NS(()=>l(u,{request:t}),t=>{t&&e._diag.error("request hook failed",t)},!0),At.with(jt.setSpan(At.active(),u),()=>{r()})}}}function hw(e){const t=mA(e).data,n=t["fastify.type"];if(t[Uy]||!n)return;e.setAttributes({[$y]:"auto.http.otel.fastify",[Uy]:`${n}.fastify`});const r=t["fastify.name"]||t["plugin.name"]||t["hook.name"];if("string"==typeof r){const t=r.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(t)}}const fw="Fastify",_w=dO(`${fw}.v3`,()=>new dw);function mw(e,t,n,r){const s=function(){const e=Ly();return e?e.getIntegrationByName(fw):void 0}()?.getShouldHandleError()||Sw;"diagnostics-channel"===r&&(this.diagnosticsChannelExists=!0),this.diagnosticsChannelExists&&"onError-hook"===r?OP&&TT.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options."):s(e,t,n)&&Pv(e,{mechanism:{handled:!1,type:"fastify"}})}const gw=dO(`${fw}.v5`,()=>{const e=new nw,t=e.plugin();return I.subscribe("fastify.initialization",e=>{const n=e.fastify;n?.register(t).after(e=>{e?OP&&TT.error("Failed to setup Fastify instrumentation",e):(!function(){const e=Ly();e&&e.on("spanStart",e=>{Tw(e)})}(),n&&n.addHook("onRequest",async(e,t)=>{if(e.opentelemetry){const{span:t}=e.opentelemetry();t&&Tw(t)}const n=e.routeOptions?.url,r=e.method||"GET";My().setTransactionName(`${r} ${n}`)}))})}),I.subscribe("tracing:fastify.request.handler:error",e=>{const{error:t,request:n,reply:r}=e;mw.call(mw,t,n,r,"diagnostics-channel")}),e}),Ew=(e={})=>(({shouldHandleError:e})=>{let t;return{name:fw,setupOnce(){t=e||Sw,_w(),gw()},getShouldHandleError:()=>t,setShouldHandleError(e){t=e}}})(e);function Sw(e,t,n){const r=n.statusCode;return r>=500||r<=299}function Tw(e){const t=mA(e),n=t.description,r=t.data,s=r["fastify.type"],o="hook"===s,i=s===n?.startsWith("handler -"),a="request"===n||"request-handler"===s;if(r[Uy]||!i&&!a&&!o)return;const c=o?"hook":i?"middleware":a?"request-handler":"<unknown>";e.setAttributes({[$y]:"auto.http.otel.fastify",[Uy]:`${c}.fastify`});const u=r["fastify.name"]||r["plugin.name"]||r["hook.name"];if("string"==typeof u){const t=u.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(t)}}var yw={},Aw={},vw={};!function(e){var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=e.TokenKind=e.AllowedOperationTypes=void 0,(t=e.AllowedOperationTypes||(e.AllowedOperationTypes={})).QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription",(n=e.TokenKind||(e.TokenKind={})).SOF="<SOF>",n.EOF="<EOF>",n.BANG="!",n.DOLLAR="$",n.AMP="&",n.PAREN_L="(",n.PAREN_R=")",n.SPREAD="...",n.COLON=":",n.EQUALS="=",n.AT="@",n.BRACKET_L="[",n.BRACKET_R="]",n.BRACE_L="{",n.PIPE="|",n.BRACE_R="}",n.NAME="Name",n.INT="Int",n.FLOAT="Float",n.STRING="String",n.BLOCK_STRING="BlockString",n.COMMENT="Comment",function(e){e.EXECUTE="graphql.execute",e.PARSE="graphql.parse",e.RESOLVE="graphql.resolve",e.VALIDATE="graphql.validate",e.SCHEMA_VALIDATE="graphql.validateSchema",e.SCHEMA_PARSE="graphql.parseSchema"}(e.SpanNames||(e.SpanNames={}))}(vw);var bw={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.SOURCE="graphql.source",e.FIELD_NAME="graphql.field.name",e.FIELD_PATH="graphql.field.path",e.FIELD_TYPE="graphql.field.type",e.OPERATION_TYPE="graphql.operation.type",e.OPERATION_NAME="graphql.operation.name",e.VARIABLES="graphql.variables.",e.ERROR_VALIDATION_NAME="graphql.validation.error"}(e.AttributeNames||(e.AttributeNames={}))}(bw);var Rw={};Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.OTEL_GRAPHQL_DATA_SYMBOL=Rw.OTEL_PATCHED_SYMBOL=void 0,Rw.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched"),Rw.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data");var Ow={};Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.OPERATION_NOT_SUPPORTED=void 0,Ow.OPERATION_NOT_SUPPORTED="Operation$operationName$not supported";var Nw={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapFieldResolver=e.wrapFields=e.getSourceFromLocation=e.getOperation=e.endSpan=e.addSpanSource=e.addInputVariableAttributes=e.isPromise=void 0;const t=qt,n=vw,r=bw,s=Rw,o=Object.values(n.AllowedOperationTypes);e.isPromise=e=>"function"==typeof e?.then;function i(e,t,n){Array.isArray(n)?n.forEach((n,r)=>{i(e,`${t}.${r}`,n)}):n instanceof Object?Object.entries(n).forEach(([n,r])=>{i(e,`${t}.${n}`,r)}):e.setAttribute(`${r.AttributeNames.VARIABLES}${String(t)}`,n)}function a(e,t,n,s,o){const i=m(t,n,s,o);e.setAttribute(r.AttributeNames.SOURCE,i)}function c(e,t,n,r,o){let i=l(n,o),a=!1;if(!i){a=!0;const c=p(n,o);i={parent:c,span:u(e,t,n,r,o,c.span),error:null},function(e,t,n){e[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[t.join(".")]=n}(n,o,i)}return{spanAdded:a,field:i}}function u(e,o,i,c,u,l){const p={[r.AttributeNames.FIELD_NAME]:c.fieldName,[r.AttributeNames.FIELD_PATH]:u.join("."),[r.AttributeNames.FIELD_TYPE]:c.returnType.toString()},d=e.startSpan(`${n.SpanNames.RESOLVE} ${p[r.AttributeNames.FIELD_PATH]}`,{attributes:p},l?t.trace.setSpan(t.context.active(),l):void 0),h=i[s.OTEL_GRAPHQL_DATA_SYMBOL].source,f=c.fieldNodes.find(e=>"Field"===e.kind);return f&&a(d,h.loc,o().allowValues,f.loc?.start,f.loc?.end),d}function l(e,t){return e[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[t.join(".")]}function p(e,t){for(let n=t.length-1;n>0;n--){const r=l(e,t.slice(0,n));if(r)return r}return{span:e[s.OTEL_GRAPHQL_DATA_SYMBOL].span}}function d(e){return f("\n",e)}function h(e){return f(" ",e)}function f(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}e.addInputVariableAttributes=function(e,t){Object.entries(t).forEach(([t,n])=>{i(e,t,n)})},e.addSpanSource=a,e.endSpan=function(e,t){t&&e.recordException(t),e.end()},e.getOperation=function(e,t){if(e&&Array.isArray(e.definitions))return t?e.definitions.filter(e=>-1!==o.indexOf(e?.operation)).find(e=>t===e?.name?.value):e.definitions.find(e=>-1!==o.indexOf(e?.operation))};const _=[n.TokenKind.FLOAT,n.TokenKind.STRING,n.TokenKind.INT,n.TokenKind.BLOCK_STRING];function m(e,t=!1,r,s){let o="";if(e?.startToken){const i="number"==typeof r?r:e.start,a="number"==typeof s?s:e.end;let c=e.startToken.next,u=1;for(;c;){if(c.start<i){c=c.next,u=c?.line;continue}if(c.end>a){c=c.next,u=c?.line;continue}let e=c.value||c.kind,r="";!t&&_.indexOf(c.kind)>=0&&(e="*"),c.kind===n.TokenKind.STRING&&(e=`"${e}"`),c.kind===n.TokenKind.EOF&&(e=""),c.line>u?(o+=d(c.line-u),u=c.line,r=h(c.column-1)):c.line===c.prev?.line&&(r=h(c.start-(c.prev?.end||0))),o+=r+e,c&&(c=c.next)}}return o}e.getSourceFromLocation=m,e.wrapFields=function e(t,n,r){if(!t||"function"!=typeof t.getFields||t[s.OTEL_PATCHED_SYMBOL])return;const o=t.getFields();t[s.OTEL_PATCHED_SYMBOL]=!0,Object.keys(o).forEach(t=>{const s=o[t];if(s&&(s.resolve&&(s.resolve=S(n,r,s.resolve)),s.type)){let t=s.type;for(;t.ofType;)t=t.ofType;e(t,n,r)}})};const g=(e,n,r)=>{r&&(e.recordException(n),e.setStatus({code:t.SpanStatusCode.ERROR,message:n.message}),e.end())},E=(e,t)=>{t&&e.end()};function S(n,r,o,i=!1){if(a[s.OTEL_PATCHED_SYMBOL]||"function"!=typeof o)return o;function a(a,u,l,d){if(!o)return;const h=r();if(h.ignoreTrivialResolveSpans&&i&&("object"==typeof(f=a)&&null!==f||"function"==typeof a)){if("function"!=typeof a[d.fieldName])return o.call(this,a,u,l,d)}var f;if(!l[s.OTEL_GRAPHQL_DATA_SYMBOL])return o.call(this,a,u,l,d);const _=function(e,t){const n=[];let r=t;for(;r;){let t=r.key;e&&"number"==typeof t&&(t="*"),n.push(String(t)),r=r.prev}return n.reverse()}(h.mergeItems,d&&d.path),m=_.filter(e=>"string"==typeof e).length;let S,T=!1;if(h.depth>=0&&h.depth<m)S=p(l,_);else{const e=c(n,r,l,d,_);S=e.field,T=e.spanAdded}return t.context.with(t.trace.setSpan(t.context.active(),S.span),()=>{try{const t=o.call(this,a,u,l,d);return(0,e.isPromise)(t)?t.then(e=>(E(S.span,T),e),e=>{throw g(S.span,e,T),e}):(E(S.span,T),t)}catch(e){throw g(S.span,e,T),e}})}return a[s.OTEL_PATCHED_SYMBOL]=!0,a}e.wrapFieldResolver=S}(Nw);var Cw={};Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.PACKAGE_NAME=Cw.PACKAGE_VERSION=void 0,Cw.PACKAGE_VERSION="0.51.0",Cw.PACKAGE_NAME="@opentelemetry/instrumentation-graphql",Object.defineProperty(Aw,"__esModule",{value:!0}),Aw.GraphQLInstrumentation=void 0;const Iw=qt,Pw=DS,Mw=vw,ww=bw,Lw=Rw,xw=Ow,Dw=Nw,kw=Cw,Uw={mergeItems:!1,depth:-1,allowValues:!1,ignoreResolveSpans:!1},$w=[">=14.0.0 <17"];class Gw extends Pw.InstrumentationBase{constructor(e={}){super(kw.PACKAGE_NAME,kw.PACKAGE_VERSION,{...Uw,...e})}setConfig(e={}){super.setConfig({...Uw,...e})}init(){const e=new Pw.InstrumentationNodeModuleDefinition("graphql",$w);return e.files.push(this._addPatchingExecute()),e.files.push(this._addPatchingParser()),e.files.push(this._addPatchingValidate()),e}_addPatchingExecute(){return new Pw.InstrumentationNodeModuleFile("graphql/execution/execute.js",$w,e=>((0,Pw.isWrapped)(e.execute)&&this._unwrap(e,"execute"),this._wrap(e,"execute",this._patchExecute(e.defaultFieldResolver)),e),e=>{e&&this._unwrap(e,"execute")})}_addPatchingParser(){return new Pw.InstrumentationNodeModuleFile("graphql/language/parser.js",$w,e=>((0,Pw.isWrapped)(e.parse)&&this._unwrap(e,"parse"),this._wrap(e,"parse",this._patchParse()),e),e=>{e&&this._unwrap(e,"parse")})}_addPatchingValidate(){return new Pw.InstrumentationNodeModuleFile("graphql/validation/validate.js",$w,e=>((0,Pw.isWrapped)(e.validate)&&this._unwrap(e,"validate"),this._wrap(e,"validate",this._patchValidate()),e),e=>{e&&this._unwrap(e,"validate")})}_patchExecute(e){const t=this;return function(n){return function(){let r;if(arguments.length>=2){const n=arguments;r=t._wrapExecuteArgs(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],e)}else{const n=arguments[0];r=t._wrapExecuteArgs(n.schema,n.document,n.rootValue,n.contextValue,n.variableValues,n.operationName,n.fieldResolver,n.typeResolver,e)}const s=(0,Dw.getOperation)(r.document,r.operationName),o=t._createExecuteSpan(s,r);return r.contextValue[Lw.OTEL_GRAPHQL_DATA_SYMBOL]={source:r.document?r.document||r.document[Lw.OTEL_GRAPHQL_DATA_SYMBOL]:void 0,span:o,fields:{}},Iw.context.with(Iw.trace.setSpan(Iw.context.active(),o),()=>(0,Pw.safeExecuteInTheMiddle)(()=>n.apply(this,[r]),(e,n)=>{t._handleExecutionResult(o,e,n)}))}}}_handleExecutionResult(e,t,n){const r=this.getConfig();if(void 0===n||t)(0,Dw.endSpan)(e,t);else if((0,Dw.isPromise)(n))n.then(t=>{"function"==typeof r.responseHook?this._executeResponseHook(e,t):(0,Dw.endSpan)(e)},t=>{(0,Dw.endSpan)(e,t)});else{if("function"!=typeof r.responseHook)return void(0,Dw.endSpan)(e);this._executeResponseHook(e,n)}}_executeResponseHook(e,t){const{responseHook:n}=this.getConfig();n&&(0,Pw.safeExecuteInTheMiddle)(()=>{n(e,t)},t=>{t&&this._diag.error("Error running response hook",t),(0,Dw.endSpan)(e,void 0)},!0)}_patchParse(){const e=this;return function(t){return function(n,r){return e._parse(this,t,n,r)}}}_patchValidate(){const e=this;return function(t){return function(n,r,s,o,i){return e._validate(this,t,n,r,s,i,o)}}}_parse(e,t,n,r){const s=this.getConfig(),o=this.tracer.startSpan(Mw.SpanNames.PARSE);return Iw.context.with(Iw.trace.setSpan(Iw.context.active(),o),()=>(0,Pw.safeExecuteInTheMiddle)(()=>t.call(e,n,r),(e,t)=>{if(t){(0,Dw.getOperation)(t)?t.loc&&(0,Dw.addSpanSource)(o,t.loc,s.allowValues):o.updateName(Mw.SpanNames.SCHEMA_PARSE)}(0,Dw.endSpan)(o,e)}))}_validate(e,t,n,r,s,o,i){const a=this.tracer.startSpan(Mw.SpanNames.VALIDATE,{});return Iw.context.with(Iw.trace.setSpan(Iw.context.active(),a),()=>(0,Pw.safeExecuteInTheMiddle)(()=>t.call(e,n,r,s,i,o),(e,t)=>{r.loc||a.updateName(Mw.SpanNames.SCHEMA_VALIDATE),t&&t.length&&a.recordException({name:ww.AttributeNames.ERROR_VALIDATION_NAME,message:JSON.stringify(t)}),(0,Dw.endSpan)(a,e)}))}_createExecuteSpan(e,t){const n=this.getConfig(),r=this.tracer.startSpan(Mw.SpanNames.EXECUTE,{});if(e){const{operation:t,name:n}=e;r.setAttribute(ww.AttributeNames.OPERATION_TYPE,t);const s=n?.value;s?(r.setAttribute(ww.AttributeNames.OPERATION_NAME,s),r.updateName(`${t} ${s}`)):r.updateName(t)}else{let e=" ";t.operationName&&(e=` "${t.operationName}" `),e=xw.OPERATION_NOT_SUPPORTED.replace("$operationName$",e),r.setAttribute(ww.AttributeNames.OPERATION_NAME,e)}return t.document?.loc&&(0,Dw.addSpanSource)(r,t.document.loc,n.allowValues),t.variableValues&&n.allowValues&&(0,Dw.addInputVariableAttributes)(r,t.variableValues),r}_wrapExecuteArgs(e,t,n,r,s,o,i,a,c){if(r||(r={}),r[Lw.OTEL_GRAPHQL_DATA_SYMBOL]||this.getConfig().ignoreResolveSpans)return{schema:e,document:t,rootValue:n,contextValue:r,variableValues:s,operationName:o,fieldResolver:i,typeResolver:a};const u=null==i,l=i??c;return i=(0,Dw.wrapFieldResolver)(this.tracer,()=>this.getConfig(),l,u),e&&((0,Dw.wrapFields)(e.getQueryType(),this.tracer,()=>this.getConfig()),(0,Dw.wrapFields)(e.getMutationType(),this.tracer,()=>this.getConfig())),{schema:e,document:t,rootValue:n,contextValue:r,variableValues:s,operationName:o,fieldResolver:i,typeResolver:a}}}Aw.GraphQLInstrumentation=Gw,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLInstrumentation=void 0;var t=Aw;Object.defineProperty(e,"GraphQLInstrumentation",{enumerable:!0,get:function(){return t.GraphQLInstrumentation}})}(yw);const jw="Graphql",Vw=dO(jw,yw.GraphQLInstrumentation,e=>{const t=Bw(e);return{...t,responseHook(e,n){VI(e,"auto.graphql.otel.graphql");const r=n;r.errors?.length&&!mA(e).status&&e.setStatus({code:dt.ERROR});const s=mA(e).data,o=s["graphql.operation.type"],i=s["graphql.operation.name"];if(t.useOperationNameForRootSpan&&o){const t=AA(e),n=mA(t).data[BO]||[],r=i?`${o} ${i}`:`${o}`;Array.isArray(n)?(n.push(r),t.setAttribute(BO,n)):"string"==typeof n?t.setAttribute(BO,[n,r]):t.setAttribute(BO,r),mA(t).data["original-description"]||t.setAttribute("original-description",mA(t).description),t.updateName(`${mA(t).data["original-description"]} (${function(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}(n)})`)}}}}),Hw=(e={})=>({name:jw,setupOnce(){Vw(Bw(e))}});function Bw(e){return{ignoreResolveSpans:!0,ignoreTrivialResolveSpans:!0,useOperationNameForRootSpan:!0,...e}}var Fw={},Yw={},qw={};Object.defineProperty(qw,"__esModule",{value:!0}),qw.EVENT_LISTENERS_SET=void 0,qw.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet");var Kw={};Object.defineProperty(Kw,"__esModule",{value:!0}),Kw.bufferTextMapGetter=void 0,Kw.bufferTextMapGetter={get(e,t){if(!e)return;const n=Object.keys(e);for(const r of n)if(r===t||r.toLowerCase()===t)return e[r]?.toString()},keys:e=>e?Object.keys(e):[]};var Ww={};Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.METRIC_MESSAGING_PROCESS_DURATION=Ww.METRIC_MESSAGING_CLIENT_SENT_MESSAGES=Ww.METRIC_MESSAGING_CLIENT_OPERATION_DURATION=Ww.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES=Ww.MESSAGING_SYSTEM_VALUE_KAFKA=Ww.MESSAGING_OPERATION_TYPE_VALUE_SEND=Ww.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE=Ww.MESSAGING_OPERATION_TYPE_VALUE_PROCESS=Ww.ATTR_MESSAGING_SYSTEM=Ww.ATTR_MESSAGING_OPERATION_TYPE=Ww.ATTR_MESSAGING_OPERATION_NAME=Ww.ATTR_MESSAGING_KAFKA_OFFSET=Ww.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE=Ww.ATTR_MESSAGING_KAFKA_MESSAGE_KEY=Ww.ATTR_MESSAGING_DESTINATION_PARTITION_ID=Ww.ATTR_MESSAGING_DESTINATION_NAME=Ww.ATTR_MESSAGING_BATCH_MESSAGE_COUNT=void 0,Ww.ATTR_MESSAGING_BATCH_MESSAGE_COUNT="messaging.batch.message_count",Ww.ATTR_MESSAGING_DESTINATION_NAME="messaging.destination.name",Ww.ATTR_MESSAGING_DESTINATION_PARTITION_ID="messaging.destination.partition.id",Ww.ATTR_MESSAGING_KAFKA_MESSAGE_KEY="messaging.kafka.message.key",Ww.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE="messaging.kafka.message.tombstone",Ww.ATTR_MESSAGING_KAFKA_OFFSET="messaging.kafka.offset",Ww.ATTR_MESSAGING_OPERATION_NAME="messaging.operation.name",Ww.ATTR_MESSAGING_OPERATION_TYPE="messaging.operation.type",Ww.ATTR_MESSAGING_SYSTEM="messaging.system",Ww.MESSAGING_OPERATION_TYPE_VALUE_PROCESS="process",Ww.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE="receive",Ww.MESSAGING_OPERATION_TYPE_VALUE_SEND="send",Ww.MESSAGING_SYSTEM_VALUE_KAFKA="kafka",Ww.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES="messaging.client.consumed.messages",Ww.METRIC_MESSAGING_CLIENT_OPERATION_DURATION="messaging.client.operation.duration",Ww.METRIC_MESSAGING_CLIENT_SENT_MESSAGES="messaging.client.sent.messages",Ww.METRIC_MESSAGING_PROCESS_DURATION="messaging.process.duration";var Zw={};Object.defineProperty(Zw,"__esModule",{value:!0}),Zw.PACKAGE_NAME=Zw.PACKAGE_VERSION=void 0,Zw.PACKAGE_VERSION="0.13.0",Zw.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs",Object.defineProperty(Yw,"__esModule",{value:!0}),Yw.KafkaJsInstrumentation=void 0;const Xw=qt,zw=DS,Qw=kS,Jw=qw,eL=Kw,tL=Ww,nL=Zw;function rL(e,t,n){return r=>{e.add(t,{...n,...r?{[Qw.ATTR_ERROR_TYPE]:r}:{}})}}function sL(e,t,n){return r=>{e.record((Date.now()-t)/1e3,{...n,...r?{[Qw.ATTR_ERROR_TYPE]:r}:{}})}}const oL=[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10];class iL extends zw.InstrumentationBase{constructor(e={}){super(nL.PACKAGE_NAME,nL.PACKAGE_VERSION,e)}_updateMetricInstruments(){this._clientDuration=this.meter.createHistogram(tL.METRIC_MESSAGING_CLIENT_OPERATION_DURATION,{advice:{explicitBucketBoundaries:oL}}),this._sentMessages=this.meter.createCounter(tL.METRIC_MESSAGING_CLIENT_SENT_MESSAGES),this._consumedMessages=this.meter.createCounter(tL.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES),this._processDuration=this.meter.createHistogram(tL.METRIC_MESSAGING_PROCESS_DURATION,{advice:{explicitBucketBoundaries:oL}})}init(){const e=e=>{(0,zw.isWrapped)(e?.Kafka?.prototype.producer)&&this._unwrap(e.Kafka.prototype,"producer"),(0,zw.isWrapped)(e?.Kafka?.prototype.consumer)&&this._unwrap(e.Kafka.prototype,"consumer")};return new zw.InstrumentationNodeModuleDefinition("kafkajs",[">=0.3.0 <3"],t=>(e(t),this._wrap(t?.Kafka?.prototype,"producer",this._getProducerPatch()),this._wrap(t?.Kafka?.prototype,"consumer",this._getConsumerPatch()),t),e)}_getConsumerPatch(){const e=this;return t=>function(...n){const r=t.apply(this,n);return(0,zw.isWrapped)(r.run)&&e._unwrap(r,"run"),e._wrap(r,"run",e._getConsumerRunPatch()),e._setKafkaEventListeners(r),r}}_setKafkaEventListeners(e){e[Jw.EVENT_LISTENERS_SET]||(e.events?.REQUEST&&e.on(e.events.REQUEST,this._recordClientDurationMetric.bind(this)),e[Jw.EVENT_LISTENERS_SET]=!0)}_recordClientDurationMetric(e){const[t,n]=e.payload.broker.split(":");this._clientDuration.record(e.payload.duration/1e3,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:`${e.payload.apiName}`,[Qw.ATTR_SERVER_ADDRESS]:t,[Qw.ATTR_SERVER_PORT]:Number.parseInt(n,10)})}_getProducerPatch(){const e=this;return t=>function(...n){const r=t.apply(this,n);return(0,zw.isWrapped)(r.sendBatch)&&e._unwrap(r,"sendBatch"),e._wrap(r,"sendBatch",e._getSendBatchPatch()),(0,zw.isWrapped)(r.send)&&e._unwrap(r,"send"),e._wrap(r,"send",e._getSendPatch()),(0,zw.isWrapped)(r.transaction)&&e._unwrap(r,"transaction"),e._wrap(r,"transaction",e._getProducerTransactionPatch()),e._setKafkaEventListeners(r),r}}_getConsumerRunPatch(){const e=this;return t=>function(...n){const r=n[0];return r?.eachMessage&&((0,zw.isWrapped)(r.eachMessage)&&e._unwrap(r,"eachMessage"),e._wrap(r,"eachMessage",e._getConsumerEachMessagePatch())),r?.eachBatch&&((0,zw.isWrapped)(r.eachBatch)&&e._unwrap(r,"eachBatch"),e._wrap(r,"eachBatch",e._getConsumerEachBatchPatch())),t.call(this,r)}}_getConsumerEachMessagePatch(){const e=this;return t=>function(...n){const r=n[0],s=Xw.propagation.extract(Xw.ROOT_CONTEXT,r.message.headers,eL.bufferTextMapGetter),o=e._startConsumerSpan({topic:r.topic,message:r.message,operationType:tL.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,ctx:s,attributes:{[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)}}),i=[sL(e._processDuration,Date.now(),{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"process",[tL.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)}),rL(e._consumedMessages,1,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"process",[tL.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)})],a=Xw.context.with(Xw.trace.setSpan(s,o),()=>t.apply(this,n));return e._endSpansOnPromise([o],i,a)}}_getConsumerEachBatchPatch(){return e=>{const t=this;return function(...n){const r=n[0],s=t._startConsumerSpan({topic:r.batch.topic,message:void 0,operationType:tL.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE,ctx:Xw.ROOT_CONTEXT,attributes:{[tL.ATTR_MESSAGING_BATCH_MESSAGE_COUNT]:r.batch.messages.length,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}});return Xw.context.with(Xw.trace.setSpan(Xw.context.active(),s),()=>{const o=Date.now(),i=[],a=[rL(t._consumedMessages,r.batch.messages.length,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"process",[tL.ATTR_MESSAGING_DESTINATION_NAME]:r.batch.topic,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)})];r.batch.messages.forEach(e=>{const n=Xw.propagation.extract(Xw.ROOT_CONTEXT,e.headers,eL.bufferTextMapGetter),s=Xw.trace.getSpan(n)?.spanContext();let c;s&&(c={context:s}),i.push(t._startConsumerSpan({topic:r.batch.topic,message:e,operationType:tL.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,link:c,attributes:{[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}})),a.push(sL(t._processDuration,o,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"process",[tL.ATTR_MESSAGING_DESTINATION_NAME]:r.batch.topic,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}))});const c=e.apply(this,n);return i.unshift(s),t._endSpansOnPromise(i,a,c)})}}}_getProducerTransactionPatch(){const e=this;return t=>function(...n){const r=e.tracer.startSpan("transaction"),s=t.apply(this,n);return s.then(t=>{const n=t.send;t.send=function(...t){return Xw.context.with(Xw.trace.setSpan(Xw.context.active(),r),()=>e._getSendPatch()(n).apply(this,t).catch(e=>{throw r.setStatus({code:Xw.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),e}))};const s=t.sendBatch;t.sendBatch=function(...t){return Xw.context.with(Xw.trace.setSpan(Xw.context.active(),r),()=>e._getSendBatchPatch()(s).apply(this,t).catch(e=>{throw r.setStatus({code:Xw.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),e}))};const o=t.commit;t.commit=function(...t){const n=o.apply(this,t).then(()=>{r.setStatus({code:Xw.SpanStatusCode.OK})});return e._endSpansOnPromise([r],[],n)};const i=t.abort;t.abort=function(...t){const n=i.apply(this,t);return e._endSpansOnPromise([r],[],n)}}).catch(e=>{r.setStatus({code:Xw.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),r.end()}),s}}_getSendBatchPatch(){const e=this;return t=>function(...n){const r=n[0].topicMessages||[],s=[],o=[];r.forEach(t=>{t.messages.forEach(n=>{s.push(e._startProducerSpan(t.topic,n)),o.push(rL(e._sentMessages,1,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"send",[tL.ATTR_MESSAGING_DESTINATION_NAME]:t.topic,...void 0!==n.partition?{[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(n.partition)}:{}}))})});const i=t.apply(this,n);return e._endSpansOnPromise(s,o,i)}}_getSendPatch(){const e=this;return t=>function(...n){const r=n[0],s=r.messages.map(t=>e._startProducerSpan(r.topic,t)),o=r.messages.map(t=>rL(e._sentMessages,1,{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_OPERATION_NAME]:"send",[tL.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,...void 0!==t.partition?{[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(t.partition)}:{}})),i=t.apply(this,n);return e._endSpansOnPromise(s,o,i)}}_endSpansOnPromise(e,t,n){return Promise.resolve(n).then(e=>(t.forEach(e=>e()),e)).catch(n=>{let r,s=Qw.ERROR_TYPE_VALUE_OTHER;throw"string"==typeof n||void 0===n?r=n:"object"==typeof n&&Object.prototype.hasOwnProperty.call(n,"message")&&(r=n.message,s=n.constructor.name),t.forEach(e=>e(s)),e.forEach(e=>{e.setAttribute(Qw.ATTR_ERROR_TYPE,s),e.setStatus({code:Xw.SpanStatusCode.ERROR,message:r})}),n}).finally(()=>{e.forEach(e=>e.end())})}_startConsumerSpan({topic:e,message:t,operationType:n,ctx:r,link:s,attributes:o}){const i=n===tL.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?"poll":n,a=this.tracer.startSpan(`${i} ${e}`,{kind:n===tL.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?Xw.SpanKind.CLIENT:Xw.SpanKind.CONSUMER,attributes:{...o,[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_DESTINATION_NAME]:e,[tL.ATTR_MESSAGING_OPERATION_TYPE]:n,[tL.ATTR_MESSAGING_OPERATION_NAME]:i,[tL.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:t?.key?String(t.key):void 0,[tL.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:!(!t?.key||null!==t.value)||void 0,[tL.ATTR_MESSAGING_KAFKA_OFFSET]:t?.offset},links:s?[s]:[]},r),{consumerHook:c}=this.getConfig();return c&&t&&(0,zw.safeExecuteInTheMiddle)(()=>c(a,{topic:e,message:t}),e=>{e&&this._diag.error("consumerHook error",e)},!0),a}_startProducerSpan(e,t){const n=this.tracer.startSpan(`send ${e}`,{kind:Xw.SpanKind.PRODUCER,attributes:{[tL.ATTR_MESSAGING_SYSTEM]:tL.MESSAGING_SYSTEM_VALUE_KAFKA,[tL.ATTR_MESSAGING_DESTINATION_NAME]:e,[tL.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:t.key?String(t.key):void 0,[tL.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:!(!t.key||null!==t.value)||void 0,[tL.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:void 0!==t.partition?String(t.partition):void 0,[tL.ATTR_MESSAGING_OPERATION_NAME]:"send",[tL.ATTR_MESSAGING_OPERATION_TYPE]:tL.MESSAGING_OPERATION_TYPE_VALUE_SEND}});t.headers=t.headers??{},Xw.propagation.inject(Xw.trace.setSpan(Xw.context.active(),n),t.headers);const{producerHook:r}=this.getConfig();return r&&(0,zw.safeExecuteInTheMiddle)(()=>r(n,{topic:e,message:t}),e=>{e&&this._diag.error("producerHook error",e)},!0),n}}Yw.KafkaJsInstrumentation=iL,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KafkaJsInstrumentation=void 0;var t=Yw;Object.defineProperty(e,"KafkaJsInstrumentation",{enumerable:!0,get:function(){return t.KafkaJsInstrumentation}})}(Fw);const aL="Kafka",cL=dO(aL,()=>new Fw.KafkaJsInstrumentation({consumerHook(e){VI(e,"auto.kafkajs.otel.consumer")},producerHook(e){VI(e,"auto.kafkajs.otel.producer")}})),uL=()=>({name:aL,setupOnce(){cL()}});var lL={},pL={},dL={};Object.defineProperty(dL,"__esModule",{value:!0}),dL.PACKAGE_NAME=dL.PACKAGE_VERSION=void 0,dL.PACKAGE_VERSION="0.48.0",dL.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer",Object.defineProperty(pL,"__esModule",{value:!0}),pL.LruMemoizerInstrumentation=void 0;const hL=qt,fL=DS,_L=dL;class mL extends fL.InstrumentationBase{constructor(e={}){super(_L.PACKAGE_NAME,_L.PACKAGE_VERSION,e)}init(){return[new fL.InstrumentationNodeModuleDefinition("lru-memoizer",[">=1.3 <3"],e=>{const t=function(){const t=e.apply(this,arguments);return function(){const e=[...arguments],n=e.pop(),r="function"==typeof n?hL.context.bind(hL.context.active(),n):n;return e.push(r),t.apply(this,e)}};return t.sync=e.sync,t},void 0)]}}pL.LruMemoizerInstrumentation=mL,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LruMemoizerInstrumentation=void 0;var t=pL;Object.defineProperty(e,"LruMemoizerInstrumentation",{enumerable:!0,get:function(){return t.LruMemoizerInstrumentation}})}(lL);const gL="LruMemoizer",EL=dO(gL,()=>new lL.LruMemoizerInstrumentation),SL=()=>({name:gL,setupOnce(){EL()}});var TL={},yL={},AL={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(t=e.MongodbCommandType||(e.MongodbCommandType={})).CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.AGGREGATE="aggregate",t.UNKNOWN="unknown"}(AL);var vL={};Object.defineProperty(vL,"__esModule",{value:!0}),vL.PACKAGE_NAME=vL.PACKAGE_VERSION=void 0,vL.PACKAGE_VERSION="0.56.0",vL.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb",Object.defineProperty(yL,"__esModule",{value:!0}),yL.MongoDBInstrumentation=void 0;const bL=qt,RL=DS,OL=kS,NL=AL,CL=vL,IL={requireParentSpan:!0};class PL extends RL.InstrumentationBase{constructor(e={}){super(CL.PACKAGE_NAME,CL.PACKAGE_VERSION,{...IL,...e})}setConfig(e={}){super.setConfig({...IL,...e})}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter("db.client.connections.usage",{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){const{v3PatchConnection:e,v3UnpatchConnection:t}=this._getV3ConnectionPatches(),{v4PatchConnect:n,v4UnpatchConnect:r}=this._getV4ConnectPatches(),{v4PatchConnectionCallback:s,v4PatchConnectionPromise:o,v4UnpatchConnection:i}=this._getV4ConnectionPatches(),{v4PatchConnectionPool:a,v4UnpatchConnectionPool:c}=this._getV4ConnectionPoolPatches(),{v4PatchSessions:u,v4UnpatchSessions:l}=this._getV4SessionsPatches();return[new RL.InstrumentationNodeModuleDefinition("mongodb",[">=3.3.0 <4"],void 0,void 0,[new RL.InstrumentationNodeModuleFile("mongodb/lib/core/wireprotocol/index.js",[">=3.3.0 <4"],e,t)]),new RL.InstrumentationNodeModuleDefinition("mongodb",[">=4.0.0 <7"],void 0,void 0,[new RL.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=4.0.0 <6.4"],s,i),new RL.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=6.4.0 <7"],o,i),new RL.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection_pool.js",[">=4.0.0 <6.4"],a,c),new RL.InstrumentationNodeModuleFile("mongodb/lib/cmap/connect.js",[">=4.0.0 <7"],n,r),new RL.InstrumentationNodeModuleFile("mongodb/lib/sessions.js",[">=4.0.0 <7"],u,l)])]}_getV3ConnectionPatches(){return{v3PatchConnection:e=>((0,RL.isWrapped)(e.insert)&&this._unwrap(e,"insert"),this._wrap(e,"insert",this._getV3PatchOperation("insert")),(0,RL.isWrapped)(e.remove)&&this._unwrap(e,"remove"),this._wrap(e,"remove",this._getV3PatchOperation("remove")),(0,RL.isWrapped)(e.update)&&this._unwrap(e,"update"),this._wrap(e,"update",this._getV3PatchOperation("update")),(0,RL.isWrapped)(e.command)&&this._unwrap(e,"command"),this._wrap(e,"command",this._getV3PatchCommand()),(0,RL.isWrapped)(e.query)&&this._unwrap(e,"query"),this._wrap(e,"query",this._getV3PatchFind()),(0,RL.isWrapped)(e.getMore)&&this._unwrap(e,"getMore"),this._wrap(e,"getMore",this._getV3PatchCursor()),e),v3UnpatchConnection:e=>{void 0!==e&&(this._unwrap(e,"insert"),this._unwrap(e,"remove"),this._unwrap(e,"update"),this._unwrap(e,"command"),this._unwrap(e,"query"),this._unwrap(e,"getMore"))}}}_getV4SessionsPatches(){return{v4PatchSessions:e=>((0,RL.isWrapped)(e.acquire)&&this._unwrap(e,"acquire"),this._wrap(e.ServerSessionPool.prototype,"acquire",this._getV4AcquireCommand()),(0,RL.isWrapped)(e.release)&&this._unwrap(e,"release"),this._wrap(e.ServerSessionPool.prototype,"release",this._getV4ReleaseCommand()),e),v4UnpatchSessions:e=>{void 0!==e&&((0,RL.isWrapped)(e.acquire)&&this._unwrap(e,"acquire"),(0,RL.isWrapped)(e.release)&&this._unwrap(e,"release"))}}}_getV4AcquireCommand(){const e=this;return t=>function(){const n=this.sessions.length,r=t.call(this),s=this.sessions.length;return n===s?e._connectionsUsage.add(1,{state:"used","pool.name":e._poolName}):n-1===s&&(e._connectionsUsage.add(-1,{state:"idle","pool.name":e._poolName}),e._connectionsUsage.add(1,{state:"used","pool.name":e._poolName})),r}}_getV4ReleaseCommand(){const e=this;return t=>function(n){const r=t.call(this,n);return e._connectionsUsage.add(-1,{state:"used","pool.name":e._poolName}),e._connectionsUsage.add(1,{state:"idle","pool.name":e._poolName}),r}}_getV4ConnectionPoolPatches(){return{v4PatchConnectionPool:e=>{const t=e.ConnectionPool.prototype;return(0,RL.isWrapped)(t.checkOut)&&this._unwrap(t,"checkOut"),this._wrap(t,"checkOut",this._getV4ConnectionPoolCheckOut()),e},v4UnpatchConnectionPool:e=>{void 0!==e&&this._unwrap(e.ConnectionPool.prototype,"checkOut")}}}_getV4ConnectPatches(){return{v4PatchConnect:e=>((0,RL.isWrapped)(e.connect)&&this._unwrap(e,"connect"),this._wrap(e,"connect",this._getV4ConnectCommand()),e),v4UnpatchConnect:e=>{void 0!==e&&this._unwrap(e,"connect")}}}_getV4ConnectionPoolCheckOut(){return e=>function(t){const n=bL.context.bind(bL.context.active(),t);return e.call(this,n)}}_getV4ConnectCommand(){const e=this;return t=>function(n,r){if(1===t.length){const r=t.call(this,n);return r&&"function"==typeof r.then&&r.then(()=>e.setPoolName(n),()=>{}),r}return t.call(this,n,function(t,s){!t&&s?(e.setPoolName(n),r(t,s)):r(t,s)})}}_getV4ConnectionPatches(){return{v4PatchConnectionCallback:e=>((0,RL.isWrapped)(e.Connection.prototype.command)&&this._unwrap(e.Connection.prototype,"command"),this._wrap(e.Connection.prototype,"command",this._getV4PatchCommandCallback()),e),v4PatchConnectionPromise:e=>((0,RL.isWrapped)(e.Connection.prototype.command)&&this._unwrap(e.Connection.prototype,"command"),this._wrap(e.Connection.prototype,"command",this._getV4PatchCommandPromise()),e),v4UnpatchConnection:e=>{void 0!==e&&this._unwrap(e.Connection.prototype,"command")}}}_getV3PatchOperation(e){const t=this;return n=>function(r,s,o,i,a){const c=bL.trace.getSpan(bL.context.active()),u="function"==typeof i?i:a;if(t._checkSkipInstrumentation(c)||"function"!=typeof u||"object"!=typeof o)return"function"==typeof i?n.call(this,r,s,o,i):n.call(this,r,s,o,i,a);const l=t.tracer.startSpan(`mongodb.${e}`,{kind:bL.SpanKind.CLIENT});t._populateV3Attributes(l,s,r,o[0],e);const p=t._patchEnd(l,u);return"function"==typeof i?n.call(this,r,s,o,p):n.call(this,r,s,o,i,p)}}_getV3PatchCommand(){const e=this;return t=>function(n,r,s,o,i){const a=bL.trace.getSpan(bL.context.active()),c="function"==typeof o?o:i;if(e._checkSkipInstrumentation(a)||"function"!=typeof c||"object"!=typeof s)return"function"==typeof o?t.call(this,n,r,s,o):t.call(this,n,r,s,o,i);const u=PL._getCommandType(s),l=u===NL.MongodbCommandType.UNKNOWN?"command":u,p=e.tracer.startSpan(`mongodb.${l}`,{kind:bL.SpanKind.CLIENT}),d=u===NL.MongodbCommandType.UNKNOWN?void 0:u;e._populateV3Attributes(p,r,n,s,d);const h=e._patchEnd(p,c);return"function"==typeof o?t.call(this,n,r,s,h):t.call(this,n,r,s,o,h)}}_getV4PatchCommandCallback(){const e=this;return t=>function(n,r,s,o){const i=bL.trace.getSpan(bL.context.active()),a=e._checkSkipInstrumentation(i),c=o,u=Object.keys(r)[0];if("object"!=typeof r||r.ismaster||r.hello)return t.call(this,n,r,s,o);let l;a||(l=e.tracer.startSpan(`mongodb.${u}`,{kind:bL.SpanKind.CLIENT}),e._populateV4Attributes(l,this,n,r,u));const p=e._patchEnd(l,c,this.id,u);return t.call(this,n,r,s,p)}}_getV4PatchCommandPromise(){const e=this;return t=>function(...n){const[r,s]=n,o=bL.trace.getSpan(bL.context.active()),i=e._checkSkipInstrumentation(o),a=Object.keys(s)[0];if("object"!=typeof s||s.ismaster||s.hello)return t.apply(this,n);let c;i||(c=e.tracer.startSpan(`mongodb.${a}`,{kind:bL.SpanKind.CLIENT}),e._populateV4Attributes(c,this,r,s,a));const u=e._patchEnd(c,()=>{},this.id,a),l=t.apply(this,n);return l.then(e=>u(null,e),e=>u(e)),l}}_getV3PatchFind(){const e=this;return t=>function(n,r,s,o,i,a){const c=bL.trace.getSpan(bL.context.active()),u="function"==typeof i?i:a;if(e._checkSkipInstrumentation(c)||"function"!=typeof u||"object"!=typeof s)return"function"==typeof i?t.call(this,n,r,s,o,i):t.call(this,n,r,s,o,i,a);const l=e.tracer.startSpan("mongodb.find",{kind:bL.SpanKind.CLIENT});e._populateV3Attributes(l,r,n,s,"find");const p=e._patchEnd(l,u);return"function"==typeof i?t.call(this,n,r,s,o,p):t.call(this,n,r,s,o,i,p)}}_getV3PatchCursor(){const e=this;return t=>function(n,r,s,o,i,a){const c=bL.trace.getSpan(bL.context.active()),u="function"==typeof i?i:a;if(e._checkSkipInstrumentation(c)||"function"!=typeof u)return"function"==typeof i?t.call(this,n,r,s,o,i):t.call(this,n,r,s,o,i,a);const l=e.tracer.startSpan("mongodb.getMore",{kind:bL.SpanKind.CLIENT});e._populateV3Attributes(l,r,n,s.cmd,"getMore");const p=e._patchEnd(l,u);return"function"==typeof i?t.call(this,n,r,s,o,p):t.call(this,n,r,s,o,i,p)}}static _getCommandType(e){return void 0!==e.createIndexes?NL.MongodbCommandType.CREATE_INDEXES:void 0!==e.findandmodify?NL.MongodbCommandType.FIND_AND_MODIFY:void 0!==e.ismaster?NL.MongodbCommandType.IS_MASTER:void 0!==e.count?NL.MongodbCommandType.COUNT:void 0!==e.aggregate?NL.MongodbCommandType.AGGREGATE:NL.MongodbCommandType.UNKNOWN}_populateV4Attributes(e,t,n,r,s){let o,i,a;if(t){const e="string"==typeof t.address?t.address.split(":"):"";2===e.length&&(o=e[0],i=e[1])}a=r?.documents&&r.documents[0]?r.documents[0]:r?.cursors?r.cursors:r,this._addAllSpanAttributes(e,n.db,n.collection,o,i,a,s)}_populateV3Attributes(e,t,n,r,s){let o,i;if(n&&n.s&&(o=n.s.options?.host??n.s.host,i=(n.s.options?.port??n.s.port)?.toString(),null==o||null==i)){const e=n.description?.address;if(e){const t=e.split(":");o=t[0],i=t[1]}}const[a,c]=t.toString().split("."),u=r?.query??r?.q??r;this._addAllSpanAttributes(e,a,c,o,i,u,s)}_addAllSpanAttributes(e,t,n,r,s,o,i){if(e.setAttributes({[OL.SEMATTRS_DB_SYSTEM]:OL.DBSYSTEMVALUES_MONGODB,[OL.SEMATTRS_DB_NAME]:t,[OL.SEMATTRS_DB_MONGODB_COLLECTION]:n,[OL.SEMATTRS_DB_OPERATION]:i,[OL.SEMATTRS_DB_CONNECTION_STRING]:`mongodb://${r}:${s}/${t}`}),r&&s){e.setAttribute(OL.SEMATTRS_NET_PEER_NAME,r);const t=parseInt(s,10);isNaN(t)||e.setAttribute(OL.SEMATTRS_NET_PEER_PORT,t)}if(!o)return;const{dbStatementSerializer:a}=this.getConfig(),c="function"==typeof a?a:this._defaultDbStatementSerializer.bind(this);(0,RL.safeExecuteInTheMiddle)(()=>{const t=c(o);e.setAttribute(OL.SEMATTRS_DB_STATEMENT,t)},e=>{e&&this._diag.error("Error running dbStatementSerializer hook",e)},!0)}_defaultDbStatementSerializer(e){const{enhancedDatabaseReporting:t}=this.getConfig(),n=t?e:this._scrubStatement(e);return JSON.stringify(n)}_scrubStatement(e){return Array.isArray(e)?e.map(e=>this._scrubStatement(e)):"object"==typeof e&&null!==e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,this._scrubStatement(t)])):"?"}_handleExecutionResult(e,t){const{responseHook:n}=this.getConfig();"function"==typeof n&&(0,RL.safeExecuteInTheMiddle)(()=>{n(e,{data:t})},e=>{e&&this._diag.error("Error running response hook",e)},!0)}_patchEnd(e,t,n,r){const s=bL.context.active(),o=this;return function(...n){const i=n[0];if(e){if(i instanceof Error)e?.setStatus({code:bL.SpanStatusCode.ERROR,message:i.message});else{const t=n[1];o._handleExecutionResult(e,t)}e.end()}return bL.context.with(s,()=>("endSessions"===r&&o._connectionsUsage.add(-1,{state:"idle","pool.name":o._poolName}),t.apply(this,n)))}}setPoolName(e){const t=e.hostAddress?.host,n=e.hostAddress?.port,r=`mongodb://${t}:${n}/${e.dbName}`;this._poolName=r}_checkSkipInstrumentation(e){return!0===this.getConfig().requireParentSpan&&void 0===e}}yL.MongoDBInstrumentation=PL;var ML={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(t=e.MongodbCommandType||(e.MongodbCommandType={})).CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.UNKNOWN="unknown"}(ML),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=e.MongoDBInstrumentation=void 0;var t=yL;Object.defineProperty(e,"MongoDBInstrumentation",{enumerable:!0,get:function(){return t.MongoDBInstrumentation}});var n=ML;Object.defineProperty(e,"MongodbCommandType",{enumerable:!0,get:function(){return n.MongodbCommandType}})}(TL);const wL="Mongo",LL=dO(wL,()=>new TL.MongoDBInstrumentation({dbStatementSerializer:xL,responseHook(e){VI(e,"auto.db.otel.mongo")}}));function xL(e){const t=DL(e);return JSON.stringify(t)}function DL(e){if(Array.isArray(e))return e.map(e=>DL(e));if(function(e){return"object"==typeof e&&null!==e&&!function(e){let t=!1;"undefined"!=typeof Buffer&&(t=Buffer.isBuffer(e));return t}(e)}(e)){const t={};return Object.entries(e).map(([e,t])=>[e,DL(t)]).reduce((e,t)=>(function(e){return Array.isArray(e)}(t)&&(e[t[0]]=t[1]),e),t)}return"?"}const kL=()=>({name:wL,setupOnce(){LL()}});var UL={},$L={},GL={};Object.defineProperty(GL,"__esModule",{value:!0}),GL.handleCallbackResponse=GL.handlePromiseResponse=GL.getAttributesFromCollection=void 0;const jL=qt,VL=DS,HL=kS;function BL(e,t={}){e.recordException(t),e.setStatus({code:jL.SpanStatusCode.ERROR,message:`${t.message} ${t.code?`\nMongoose Error Code: ${t.code}`:""}`})}function FL(e,t,n,r=void 0){n&&(0,VL.safeExecuteInTheMiddle)(()=>n(e,{moduleVersion:r,response:t}),e=>{e&&jL.diag.error("mongoose instrumentation: responseHook error",e)},!0)}GL.getAttributesFromCollection=function(e){return{[HL.SEMATTRS_DB_MONGODB_COLLECTION]:e.name,[HL.SEMATTRS_DB_NAME]:e.conn.name,[HL.SEMATTRS_DB_USER]:e.conn.user,[HL.SEMATTRS_NET_PEER_NAME]:e.conn.host,[HL.SEMATTRS_NET_PEER_PORT]:e.conn.port}},GL.handlePromiseResponse=function(e,t,n,r=void 0){return e instanceof Promise?e.then(e=>(FL(t,e,n,r),e)).catch(e=>{throw BL(t,e),e}).finally(()=>t.end()):(FL(t,e,n,r),t.end(),e)},GL.handleCallbackResponse=function(e,t,n,r,s,o,i=void 0){let a=0;return 2===s.length?a=1:3===s.length&&(a=2),s[a]=(t,n)=>(t?BL(r,t):FL(r,n,o,i),r.end(),e(t,n)),t.apply(n,s)};var YL={};Object.defineProperty(YL,"__esModule",{value:!0}),YL.PACKAGE_NAME=YL.PACKAGE_VERSION=void 0,YL.PACKAGE_VERSION="0.50.0",YL.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose",function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=e._STORED_PARENT_SPAN=void 0;const t=qt,n=Qm,r=GL,s=DS,o=YL,i=kS,a=["deleteOne","deleteMany","find","findOne","estimatedDocumentCount","countDocuments","distinct","where","$where","findOneAndUpdate","findOneAndDelete","findOneAndReplace"],c=["remove","count","findOneAndRemove",...a],u=["count","findOneAndRemove",...a],l=[...a];function p(e){return e?e.startsWith("6.")||e.startsWith("5.")?c:e.startsWith("7.")?u:l:a}function d(e){return e&&(e.startsWith("5.")||e.startsWith("6."))||!1}e._STORED_PARENT_SPAN=Symbol("stored-parent-span");class h extends s.InstrumentationBase{constructor(e={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,e)}init(){return new s.InstrumentationNodeModuleDefinition("mongoose",[">=5.9.7 <9"],this.patch.bind(this),this.unpatch.bind(this))}patch(e,t){const n="Module"===e[Symbol.toStringTag]?e.default:e;this._wrap(n.Model.prototype,"save",this.patchOnModelMethods("save",t)),n.Model.prototype.$save=n.Model.prototype.save,d(t)&&this._wrap(n.Model.prototype,"remove",this.patchOnModelMethods("remove",t)),this._wrap(n.Query.prototype,"exec",this.patchQueryExec(t)),this._wrap(n.Aggregate.prototype,"exec",this.patchAggregateExec(t));return p(t).forEach(e=>{this._wrap(n.Query.prototype,e,this.patchAndCaptureSpanContext(e))}),this._wrap(n.Model,"aggregate",this.patchModelAggregate()),this._wrap(n.Model,"insertMany",this.patchModelStatic("insertMany",t)),this._wrap(n.Model,"bulkWrite",this.patchModelStatic("bulkWrite",t)),n}unpatch(e,t){const n="Module"===e[Symbol.toStringTag]?e.default:e,r=p(t);this._unwrap(n.Model.prototype,"save"),n.Model.prototype.$save=n.Model.prototype.save,d(t)&&this._unwrap(n.Model.prototype,"remove"),this._unwrap(n.Query.prototype,"exec"),this._unwrap(n.Aggregate.prototype,"exec"),r.forEach(e=>{this._unwrap(n.Query.prototype,e)}),this._unwrap(n.Model,"aggregate"),this._unwrap(n.Model,"insertMany"),this._unwrap(n.Model,"bulkWrite")}patchAggregateExec(n){const r=this;return s=>function(o){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const a=this[e._STORED_PARENT_SPAN],c={},{dbStatementSerializer:u}=r.getConfig();u&&(c[i.SEMATTRS_DB_STATEMENT]=u("aggregate",{options:this.options,aggregatePipeline:this._pipeline}));const l=r._startSpan(this._model.collection,this._model?.modelName,"aggregate",c,a);return r._handleResponse(l,s,this,arguments,o,n)}}patchQueryExec(n){const r=this;return s=>function(o){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const a=this[e._STORED_PARENT_SPAN],c={},{dbStatementSerializer:u}=r.getConfig();u&&(c[i.SEMATTRS_DB_STATEMENT]=u(this.op,{condition:this._conditions,updates:this._update,options:this.options,fields:this._fields}));const l=r._startSpan(this.mongooseCollection,this.model.modelName,this.op,c,a);return r._handleResponse(l,s,this,arguments,o,n)}}patchOnModelMethods(e,n){const r=this;return s=>function(o,a){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const c={document:this};!o||o instanceof Function||(c.options=o);const u={},{dbStatementSerializer:l}=r.getConfig();l&&(u[i.SEMATTRS_DB_STATEMENT]=l(e,c));const p=r._startSpan(this.constructor.collection,this.constructor.modelName,e,u);return o instanceof Function&&(a=o,o=void 0),r._handleResponse(p,s,this,arguments,a,n)}}patchModelStatic(e,n){const r=this;return s=>function(o,a,c){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);"function"==typeof a&&(c=a,a=void 0);const u={};switch(e){case"insertMany":u.documents=o;break;case"bulkWrite":u.operations=o;break;default:u.document=o}void 0!==a&&(u.options=a);const l={},{dbStatementSerializer:p}=r.getConfig();p&&(l[i.SEMATTRS_DB_STATEMENT]=p(e,u));const d=r._startSpan(this.collection,this.modelName,e,l);return r._handleResponse(d,s,this,arguments,c,n)}}patchModelAggregate(){const n=this;return r=>function(){const s=t.trace.getSpan(t.context.active()),o=n._callOriginalFunction(()=>r.apply(this,arguments));return o&&(o[e._STORED_PARENT_SPAN]=s),o}}patchAndCaptureSpanContext(n){const r=this;return n=>function(){return this[e._STORED_PARENT_SPAN]=t.trace.getSpan(t.context.active()),r._callOriginalFunction(()=>n.apply(this,arguments))}}_startSpan(e,n,s,o,a){return this.tracer.startSpan(`mongoose.${n}.${s}`,{kind:t.SpanKind.CLIENT,attributes:{...o,...(0,r.getAttributesFromCollection)(e),[i.SEMATTRS_DB_OPERATION]:s,[i.SEMATTRS_DB_SYSTEM]:"mongoose"}},a?t.trace.setSpan(t.context.active(),a):void 0)}_handleResponse(e,t,n,s,o,i=void 0){const a=this;if(o instanceof Function)return a._callOriginalFunction(()=>(0,r.handleCallbackResponse)(o,t,n,e,s,a.getConfig().responseHook,i));{const o=a._callOriginalFunction(()=>t.apply(n,s));return(0,r.handlePromiseResponse)(o,e,a.getConfig().responseHook,i)}}_callOriginalFunction(e){return this.getConfig().suppressInternalInstrumentation?t.context.with((0,n.suppressTracing)(t.context.active()),e):e()}}e.MongooseInstrumentation=h}($L),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=void 0;var t=$L;Object.defineProperty(e,"MongooseInstrumentation",{enumerable:!0,get:function(){return t.MongooseInstrumentation}})}(UL);const qL="Mongoose",KL=dO(qL,()=>new UL.MongooseInstrumentation({responseHook(e){VI(e,"auto.db.otel.mongoose")}})),WL=()=>({name:qL,setupOnce(){KL()}});var ZL={},XL={},zL={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.MYSQL_VALUES="db.mysql.values"}(e.AttributeNames||(e.AttributeNames={}))}(zL);var QL={};Object.defineProperty(QL,"__esModule",{value:!0}),QL.getPoolName=QL.arrayStringifyHelper=QL.getSpanName=QL.getDbValues=QL.getDbStatement=QL.getConnectionAttributes=void 0;const JL=kS;function ex(e,t,n){let r=`jdbc:mysql://${e||"localhost"}`;return"number"==typeof t&&(r+=`:${t}`),"string"==typeof n&&(r+=`/${n}`),r}function tx(e){return e?`[${e.toString()}]`:""}QL.getConnectionAttributes=function(e){const{host:t,port:n,database:r,user:s}=function(e){const{host:t,port:n,database:r,user:s}=e&&e.connectionConfig||e||{};return{host:t,port:n,database:r,user:s}}(e),o=parseInt(n,10);return isNaN(o)?{[JL.SEMATTRS_NET_PEER_NAME]:t,[JL.SEMATTRS_DB_CONNECTION_STRING]:ex(t,n,r),[JL.SEMATTRS_DB_NAME]:r,[JL.SEMATTRS_DB_USER]:s}:{[JL.SEMATTRS_NET_PEER_NAME]:t,[JL.SEMATTRS_NET_PEER_PORT]:o,[JL.SEMATTRS_DB_CONNECTION_STRING]:ex(t,n,r),[JL.SEMATTRS_DB_NAME]:r,[JL.SEMATTRS_DB_USER]:s}},QL.getDbStatement=function(e){return"string"==typeof e?e:e.sql},QL.getDbValues=function(e,t){return tx("string"==typeof e?t:t||e.values)},QL.getSpanName=function(e){const t="object"==typeof e?e.sql:e,n=t?.indexOf(" ");return"number"==typeof n&&-1!==n?t?.substring(0,n):t},QL.arrayStringifyHelper=tx,QL.getPoolName=function(e){const t=e.config.connectionConfig;let n="";return n+=t.host?`host: '${t.host}', `:"",n+=t.port?`port: ${t.port}, `:"",n+=t.database?`database: '${t.database}', `:"",n+=t.user?`user: '${t.user}'`:"",t.user||(n=n.substring(0,n.length-2)),n.trim()};var nx={};Object.defineProperty(nx,"__esModule",{value:!0}),nx.PACKAGE_NAME=nx.PACKAGE_VERSION=void 0,nx.PACKAGE_VERSION="0.49.0",nx.PACKAGE_NAME="@opentelemetry/instrumentation-mysql",Object.defineProperty(XL,"__esModule",{value:!0}),XL.MySQLInstrumentation=void 0;const rx=qt,sx=DS,ox=kS,ix=zL,ax=QL,cx=nx;class ux extends sx.InstrumentationBase{static COMMON_ATTRIBUTES={[ox.SEMATTRS_DB_SYSTEM]:ox.DBSYSTEMVALUES_MYSQL};constructor(e={}){super(cx.PACKAGE_NAME,cx.PACKAGE_VERSION,e),this._setMetricInstruments()}setMeterProvider(e){super.setMeterProvider(e),this._setMetricInstruments()}_setMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter("db.client.connections.usage",{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){return[new sx.InstrumentationNodeModuleDefinition("mysql",[">=2.0.0 <3"],e=>((0,sx.isWrapped)(e.createConnection)&&this._unwrap(e,"createConnection"),this._wrap(e,"createConnection",this._patchCreateConnection()),(0,sx.isWrapped)(e.createPool)&&this._unwrap(e,"createPool"),this._wrap(e,"createPool",this._patchCreatePool()),(0,sx.isWrapped)(e.createPoolCluster)&&this._unwrap(e,"createPoolCluster"),this._wrap(e,"createPoolCluster",this._patchCreatePoolCluster()),e),e=>{void 0!==e&&(this._unwrap(e,"createConnection"),this._unwrap(e,"createPool"),this._unwrap(e,"createPoolCluster"))})]}_patchCreateConnection(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"query",t._patchQuery(r)),r}}}_patchCreatePool(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"query",t._patchQuery(r)),t._wrap(r,"getConnection",t._patchGetConnection(r)),t._wrap(r,"end",t._patchPoolEnd(r)),t._setPoolcallbacks(r,t,""),r}}}_patchPoolEnd(e){return t=>{const n=this;return function(r){const s=e._allConnections.length,o=e._freeConnections.length,i=s-o,a=(0,ax.getPoolName)(e);n._connectionsUsage.add(-i,{state:"used",name:a}),n._connectionsUsage.add(-o,{state:"idle",name:a}),t.apply(e,arguments)}}}_patchCreatePoolCluster(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"getConnection",t._patchGetConnection(r)),t._wrap(r,"add",t._patchAdd(r)),r}}}_patchAdd(e){return t=>{const n=this;return function(r,s){if(!n._enabled)return n._unwrap(e,"add"),t.apply(e,arguments);t.apply(e,arguments);const o=e._nodes;if(o){const t=o["object"==typeof r?"CLUSTER::"+e._lastId:String(r)].pool;n._setPoolcallbacks(t,n,r)}}}}_patchGetConnection(e){return t=>{const n=this;return function(r,s,o){if(!n._enabled)return n._unwrap(e,"getConnection"),t.apply(e,arguments);if(1===arguments.length&&"function"==typeof r){const s=n._getConnectionCallbackPatchFn(r);return t.call(e,s)}if(2===arguments.length&&"function"==typeof s){const o=n._getConnectionCallbackPatchFn(s);return t.call(e,r,o)}if(3===arguments.length&&"function"==typeof o){const i=n._getConnectionCallbackPatchFn(o);return t.call(e,r,s,i)}return t.apply(e,arguments)}}}_getConnectionCallbackPatchFn(e){const t=this,n=rx.context.active();return function(r,s){s&&((0,sx.isWrapped)(s.query)||t._wrap(s,"query",t._patchQuery(s))),"function"==typeof e&&rx.context.with(n,e,this,r,s)}}_patchQuery(e){return t=>{const n=this;return function(r,s,o){if(!n._enabled)return n._unwrap(e,"query"),t.apply(e,arguments);const i=n.tracer.startSpan((0,ax.getSpanName)(r),{kind:rx.SpanKind.CLIENT,attributes:{...ux.COMMON_ATTRIBUTES,...(0,ax.getConnectionAttributes)(e.config)}});if(i.setAttribute(ox.SEMATTRS_DB_STATEMENT,(0,ax.getDbStatement)(r)),n.getConfig().enhancedDatabaseReporting){let e;Array.isArray(s)?e=s:arguments[2]&&(e=[s]),i.setAttribute(ix.AttributeNames.MYSQL_VALUES,(0,ax.getDbValues)(r,e))}const a=Array.from(arguments).findIndex(e=>"function"==typeof e),c=rx.context.active();if(-1===a){const n=rx.context.with(rx.trace.setSpan(rx.context.active(),i),()=>t.apply(e,arguments));return rx.context.bind(c,n),n.on("error",e=>i.setStatus({code:rx.SpanStatusCode.ERROR,message:e.message})).on("end",()=>{i.end()})}return n._wrap(arguments,a,n._patchCallbackQuery(i,c)),rx.context.with(rx.trace.setSpan(rx.context.active(),i),()=>t.apply(e,arguments))}}}_patchCallbackQuery(e,t){return n=>function(r,s,o){return r&&e.setStatus({code:rx.SpanStatusCode.ERROR,message:r.message}),e.end(),rx.context.with(t,()=>n(...arguments))}}_setPoolcallbacks(e,t,n){const r=n||(0,ax.getPoolName)(e);e.on("connection",e=>{t._connectionsUsage.add(1,{state:"idle",name:r})}),e.on("acquire",e=>{t._connectionsUsage.add(-1,{state:"idle",name:r}),t._connectionsUsage.add(1,{state:"used",name:r})}),e.on("release",e=>{t._connectionsUsage.add(-1,{state:"used",name:r}),t._connectionsUsage.add(1,{state:"idle",name:r})})}}XL.MySQLInstrumentation=ux,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQLInstrumentation=void 0;var t=XL;Object.defineProperty(e,"MySQLInstrumentation",{enumerable:!0,get:function(){return t.MySQLInstrumentation}})}(ZL);const lx="Mysql",px=dO(lx,()=>new ZL.MySQLInstrumentation({})),dx=()=>({name:lx,setupOnce(){px()}});var hx={},fx={},_x={};Object.defineProperty(_x,"__esModule",{value:!0}),_x.addSqlCommenterComment=void 0;const mx=qt,gx=Qm;_x.addSqlCommenterComment=function(e,t){if("string"!=typeof t||0===t.length)return t;if(function(e){const t=e.indexOf("--");return t>=0||!(e.indexOf("/*")<0)&&t<e.indexOf("*/")}(t))return t;const n=new gx.W3CTraceContextPropagator,r={};n.inject(mx.trace.setSpan(mx.ROOT_CONTEXT,e),r,mx.defaultTextMapSetter);const s=Object.keys(r).sort();return 0===s.length?t:`${t} /*${s.map(e=>`${e}='${encodeURIComponent(r[e]).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}'`).join(",")}*/`};var Ex={};Object.defineProperty(Ex,"__esModule",{value:!0}),Ex.getConnectionPrototypeToInstrument=Ex.once=Ex.getSpanName=Ex.getDbStatement=Ex.getConnectionAttributes=void 0;const Sx=kS;function Tx(e,t,n){let r=`jdbc:mysql://${e||"localhost"}`;return"number"==typeof t&&(r+=`:${t}`),"string"==typeof n&&(r+=`/${n}`),r}function yx(e){return e.replace(/\b\d+\b/g,"?").replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,"?")}Ex.getConnectionAttributes=function(e){const{host:t,port:n,database:r,user:s}=function(e){const{host:t,port:n,database:r,user:s}=e&&e.connectionConfig||e||{};return{host:t,port:n,database:r,user:s}}(e),o=parseInt(n,10);return isNaN(o)?{[Sx.SEMATTRS_NET_PEER_NAME]:t,[Sx.SEMATTRS_DB_CONNECTION_STRING]:Tx(t,n,r),[Sx.SEMATTRS_DB_NAME]:r,[Sx.SEMATTRS_DB_USER]:s}:{[Sx.SEMATTRS_NET_PEER_NAME]:t,[Sx.SEMATTRS_NET_PEER_PORT]:o,[Sx.SEMATTRS_DB_CONNECTION_STRING]:Tx(t,n,r),[Sx.SEMATTRS_DB_NAME]:r,[Sx.SEMATTRS_DB_USER]:s}},Ex.getDbStatement=function(e,t,n,r=!1,s=yx){const[o,i]="string"==typeof e?[e,n]:[e.sql,(a=e,"values"in a?n||e.values:n)];var a;try{return r?s(o):t&&i?t(o,i):o}catch(e){return"Could not determine the query due to an error in masking or formatting"}},Ex.getSpanName=function(e){const t="object"==typeof e?e.sql:e,n=t?.indexOf(" ");return"number"==typeof n&&-1!==n?t?.substring(0,n):t};Ex.once=e=>{let t=!1;return(...n)=>{if(!t)return t=!0,e(...n)}},Ex.getConnectionPrototypeToInstrument=function(e){const t=e.prototype,n=Object.getPrototypeOf(t);return"function"==typeof n?.query&&"function"==typeof n?.execute?n:t};var Ax={};Object.defineProperty(Ax,"__esModule",{value:!0}),Ax.PACKAGE_NAME=Ax.PACKAGE_VERSION=void 0,Ax.PACKAGE_VERSION="0.50.0",Ax.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2",Object.defineProperty(fx,"__esModule",{value:!0}),fx.MySQL2Instrumentation=void 0;const vx=qt,bx=DS,Rx=kS,Ox=_x,Nx=Ex,Cx=Ax,Ix=[">=1.4.2 <4"];class Px extends bx.InstrumentationBase{static COMMON_ATTRIBUTES={[Rx.SEMATTRS_DB_SYSTEM]:Rx.DBSYSTEMVALUES_MYSQL};constructor(e={}){super(Cx.PACKAGE_NAME,Cx.PACKAGE_VERSION,e)}init(){let e;function t(t){!e&&t.format&&(e=t.format)}const n=t=>{(0,bx.isWrapped)(t.query)&&this._unwrap(t,"query"),this._wrap(t,"query",this._patchQuery(e,!1)),(0,bx.isWrapped)(t.execute)&&this._unwrap(t,"execute"),this._wrap(t,"execute",this._patchQuery(e,!0))},r=e=>{this._unwrap(e,"query"),this._unwrap(e,"execute")};return[new bx.InstrumentationNodeModuleDefinition("mysql2",Ix,e=>(t(e),e),()=>{},[new bx.InstrumentationNodeModuleFile("mysql2/promise.js",Ix,e=>(t(e),e),()=>{}),new bx.InstrumentationNodeModuleFile("mysql2/lib/connection.js",Ix,e=>{const t=(0,Nx.getConnectionPrototypeToInstrument)(e);return n(t),e},e=>{if(void 0===e)return;const t=(0,Nx.getConnectionPrototypeToInstrument)(e);r(t)})])]}_patchQuery(e,t){return n=>{const r=this;return function(s,o,i){let a;Array.isArray(o)?a=o:arguments[2]&&(a=[o]);const{maskStatement:c,maskStatementHook:u,responseHook:l}=r.getConfig(),p=r.tracer.startSpan((0,Nx.getSpanName)(s),{kind:vx.SpanKind.CLIENT,attributes:{...Px.COMMON_ATTRIBUTES,...(0,Nx.getConnectionAttributes)(this.config),[Rx.SEMATTRS_DB_STATEMENT]:(0,Nx.getDbStatement)(s,e,a,c,u)}});!t&&r.getConfig().addSqlCommenterCommentToQueries&&(arguments[0]=s="string"==typeof s?(0,Ox.addSqlCommenterComment)(p,s):Object.assign(s,{sql:(0,Ox.addSqlCommenterComment)(p,s.sql)}));const d=(0,Nx.once)((e,t)=>{e?p.setStatus({code:vx.SpanStatusCode.ERROR,message:e.message}):"function"==typeof l&&(0,bx.safeExecuteInTheMiddle)(()=>{l(p,{queryResults:t})},e=>{e&&r._diag.warn("Failed executing responseHook",e)},!0),p.end()});if(1===arguments.length){"function"==typeof s.onResult&&r._wrap(s,"onResult",r._patchCallbackQuery(d));const e=n.apply(this,arguments);return e.once("error",e=>{d(e)}).once("result",e=>{d(void 0,e)}),e}return"function"==typeof arguments[1]?r._wrap(arguments,1,r._patchCallbackQuery(d)):"function"==typeof arguments[2]&&r._wrap(arguments,2,r._patchCallbackQuery(d)),n.apply(this,arguments)}}}_patchCallbackQuery(e){return t=>function(n,r,s){return e(n,r),t(...arguments)}}}fx.MySQL2Instrumentation=Px,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQL2Instrumentation=void 0;var t=fx;Object.defineProperty(e,"MySQL2Instrumentation",{enumerable:!0,get:function(){return t.MySQL2Instrumentation}})}(hx);const Mx="Mysql2",wx=dO(Mx,()=>new hx.MySQL2Instrumentation({responseHook(e){VI(e,"auto.db.otel.mysql2")}})),Lx=()=>({name:Mx,setupOnce(){wx()}});var xx={},Dx={},kx={};Object.defineProperty(kx,"__esModule",{value:!0}),kx.endSpan=void 0;const Ux=qt;kx.endSpan=(e,t)=>{t&&(e.recordException(t),e.setStatus({code:Ux.SpanStatusCode.ERROR,message:t.message})),e.end()};var $x={};Object.defineProperty($x,"__esModule",{value:!0}),$x.defaultDbStatementSerializer=void 0;const Gx=[{regex:/^ECHO/i,args:0},{regex:/^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,args:1},{regex:/^(HSET|HMSET|LSET|LINSERT)/i,args:2},{regex:/^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,args:-1}];$x.defaultDbStatementSerializer=(e,t)=>{if(Array.isArray(t)&&t.length){const n=Gx.find(({regex:t})=>t.test(e))?.args??0,r=n>=0?t.slice(0,n):t;return t.length>r.length&&r.push(`[${t.length-n} other arguments]`),`${e} ${r.join(" ")}`}return e};var jx={};Object.defineProperty(jx,"__esModule",{value:!0}),jx.PACKAGE_NAME=jx.PACKAGE_VERSION=void 0,jx.PACKAGE_VERSION="0.51.0",jx.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis",Object.defineProperty(Dx,"__esModule",{value:!0}),Dx.IORedisInstrumentation=void 0;const Vx=qt,Hx=DS,Bx=kS,Fx=DS,Yx=kx,qx=$x,Kx=jx,Wx={requireParentSpan:!0};class Zx extends Hx.InstrumentationBase{constructor(e={}){super(Kx.PACKAGE_NAME,Kx.PACKAGE_VERSION,{...Wx,...e})}setConfig(e={}){super.setConfig({...Wx,...e})}init(){return[new Hx.InstrumentationNodeModuleDefinition("ioredis",[">=2.0.0 <6"],(e,t)=>{const n="Module"===e[Symbol.toStringTag]?e.default:e;return(0,Hx.isWrapped)(n.prototype.sendCommand)&&this._unwrap(n.prototype,"sendCommand"),this._wrap(n.prototype,"sendCommand",this._patchSendCommand(t)),(0,Hx.isWrapped)(n.prototype.connect)&&this._unwrap(n.prototype,"connect"),this._wrap(n.prototype,"connect",this._patchConnection()),e},e=>{if(void 0===e)return;const t="Module"===e[Symbol.toStringTag]?e.default:e;this._unwrap(t.prototype,"sendCommand"),this._unwrap(t.prototype,"connect")})]}_patchSendCommand(e){return t=>this._traceSendCommand(t,e)}_patchConnection(){return e=>this._traceConnection(e)}_traceSendCommand(e,t){const n=this;return function(r){if(arguments.length<1||"object"!=typeof r)return e.apply(this,arguments);const s=n.getConfig(),o=s.dbStatementSerializer||qx.defaultDbStatementSerializer,i=void 0===Vx.trace.getSpan(Vx.context.active());if(!0===s.requireParentSpan&&i)return e.apply(this,arguments);const a=n.tracer.startSpan(r.name,{kind:Vx.SpanKind.CLIENT,attributes:{[Bx.SEMATTRS_DB_SYSTEM]:Bx.DBSYSTEMVALUES_REDIS,[Bx.SEMATTRS_DB_STATEMENT]:o(r.name,r.args)}}),{requestHook:c}=s;c&&(0,Fx.safeExecuteInTheMiddle)(()=>c(a,{moduleVersion:t,cmdName:r.name,cmdArgs:r.args}),e=>{e&&Vx.diag.error("ioredis instrumentation: request hook failed",e)},!0);const{host:u,port:l}=this.options;a.setAttributes({[Bx.SEMATTRS_NET_PEER_NAME]:u,[Bx.SEMATTRS_NET_PEER_PORT]:l,[Bx.SEMATTRS_DB_CONNECTION_STRING]:`redis://${u}:${l}`});try{const t=e.apply(this,arguments),n=r.resolve;r.resolve=function(e){(0,Fx.safeExecuteInTheMiddle)(()=>s.responseHook?.(a,r.name,r.args,e),e=>{e&&Vx.diag.error("ioredis instrumentation: response hook failed",e)},!0),(0,Yx.endSpan)(a,null),n(e)};const o=r.reject;return r.reject=function(e){(0,Yx.endSpan)(a,e),o(e)},t}catch(e){throw(0,Yx.endSpan)(a,e),e}}}_traceConnection(e){const t=this;return function(){const n=void 0===Vx.trace.getSpan(Vx.context.active());if(!0===t.getConfig().requireParentSpan&&n)return e.apply(this,arguments);const r=t.tracer.startSpan("connect",{kind:Vx.SpanKind.CLIENT,attributes:{[Bx.SEMATTRS_DB_SYSTEM]:Bx.DBSYSTEMVALUES_REDIS,[Bx.SEMATTRS_DB_STATEMENT]:"connect"}}),{host:s,port:o}=this.options;r.setAttributes({[Bx.SEMATTRS_NET_PEER_NAME]:s,[Bx.SEMATTRS_NET_PEER_PORT]:o,[Bx.SEMATTRS_DB_CONNECTION_STRING]:`redis://${s}:${o}`});try{const t=e.apply(this,arguments);return(0,Yx.endSpan)(r,null),t}catch(e){throw(0,Yx.endSpan)(r,e),e}}}}Dx.IORedisInstrumentation=Zx,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IORedisInstrumentation=void 0;var t=Dx;Object.defineProperty(e,"IORedisInstrumentation",{enumerable:!0,get:function(){return t.IORedisInstrumentation}})}(xx);var Xx={},zx={},Qx={};Object.defineProperty(Qx,"__esModule",{value:!0}),Qx.PACKAGE_NAME=Qx.PACKAGE_VERSION=void 0,Qx.PACKAGE_VERSION="0.51.0",Qx.PACKAGE_NAME="@opentelemetry/instrumentation-redis";var Jx={},eD={};Object.defineProperty(eD,"__esModule",{value:!0}),eD.getTracedCreateStreamTrace=eD.getTracedCreateClient=eD.endSpan=void 0;const tD=qt;eD.endSpan=(e,t)=>{t&&e.setStatus({code:tD.SpanStatusCode.ERROR,message:t.message}),e.end()};eD.getTracedCreateClient=e=>function(){const t=e.apply(this,arguments);return tD.context.bind(tD.context.active(),t)};eD.getTracedCreateStreamTrace=e=>function(){return Object.prototype.hasOwnProperty.call(this,"stream")||Object.defineProperty(this,"stream",{get(){return this._patched_redis_stream},set(e){tD.context.bind(tD.context.active(),e),this._patched_redis_stream=e}}),e.apply(this,arguments)},Object.defineProperty(Jx,"__esModule",{value:!0}),Jx.RedisInstrumentationV2_V3=void 0;const nD=DS,rD=eD,sD=Qx,oD=qt,iD=kS,aD=$x;class cD extends nD.InstrumentationBase{static COMPONENT="redis";constructor(e={}){super(sD.PACKAGE_NAME,sD.PACKAGE_VERSION,e)}init(){return[new nD.InstrumentationNodeModuleDefinition("redis",[">=2.6.0 <4"],e=>((0,nD.isWrapped)(e.RedisClient.prototype.internal_send_command)&&this._unwrap(e.RedisClient.prototype,"internal_send_command"),this._wrap(e.RedisClient.prototype,"internal_send_command",this._getPatchInternalSendCommand()),(0,nD.isWrapped)(e.RedisClient.prototype.create_stream)&&this._unwrap(e.RedisClient.prototype,"create_stream"),this._wrap(e.RedisClient.prototype,"create_stream",this._getPatchCreateStream()),(0,nD.isWrapped)(e.createClient)&&this._unwrap(e,"createClient"),this._wrap(e,"createClient",this._getPatchCreateClient()),e),e=>{void 0!==e&&(this._unwrap(e.RedisClient.prototype,"internal_send_command"),this._unwrap(e.RedisClient.prototype,"create_stream"),this._unwrap(e,"createClient"))})]}_getPatchInternalSendCommand(){const e=this;return function(t){return function(n){if(1!==arguments.length||"object"!=typeof n)return t.apply(this,arguments);const r=e.getConfig(),s=void 0===oD.trace.getSpan(oD.context.active());if(!0===r.requireParentSpan&&s)return t.apply(this,arguments);const o=r?.dbStatementSerializer||aD.defaultDbStatementSerializer,i=e.tracer.startSpan(`${cD.COMPONENT}-${n.command}`,{kind:oD.SpanKind.CLIENT,attributes:{[iD.SEMATTRS_DB_SYSTEM]:iD.DBSYSTEMVALUES_REDIS,[iD.SEMATTRS_DB_STATEMENT]:o(n.command,n.args)}});this.connection_options&&i.setAttributes({[iD.SEMATTRS_NET_PEER_NAME]:this.connection_options.host,[iD.SEMATTRS_NET_PEER_PORT]:this.connection_options.port}),this.address&&i.setAttribute(iD.SEMATTRS_DB_CONNECTION_STRING,`redis://${this.address}`);const a=arguments[0].callback;if(a){const t=oD.context.active();arguments[0].callback=function(s,o){if(r?.responseHook){const t=r.responseHook;(0,nD.safeExecuteInTheMiddle)(()=>{t(i,n.command,n.args,o)},t=>{t&&e._diag.error("Error executing responseHook",t)},!0)}return(0,rD.endSpan)(i,s),oD.context.with(t,a,this,...arguments)}}try{return t.apply(this,arguments)}catch(e){throw(0,rD.endSpan)(i,e),e}}}}_getPatchCreateClient(){return function(e){return(0,rD.getTracedCreateClient)(e)}}_getPatchCreateStream(){return function(e){return(0,rD.getTracedCreateStreamTrace)(e)}}}Jx.RedisInstrumentationV2_V3=cD;var uD={},lD={};Object.defineProperty(lD,"__esModule",{value:!0}),lD.getClientAttributes=void 0;const pD=kS;function dD(e,t){if("string"==typeof t&&t)try{const e=new URL(t);return e.searchParams.delete("user_pwd"),e.username="",e.password="",e.href}catch(t){e.error("failed to sanitize redis connection url",t)}}lD.getClientAttributes=function(e,t){return{[pD.SEMATTRS_DB_SYSTEM]:pD.DBSYSTEMVALUES_REDIS,[pD.SEMATTRS_NET_PEER_NAME]:t?.socket?.host,[pD.SEMATTRS_NET_PEER_PORT]:t?.socket?.port,[pD.SEMATTRS_DB_CONNECTION_STRING]:dD(e,t?.url)}},Object.defineProperty(uD,"__esModule",{value:!0}),uD.RedisInstrumentationV4=void 0;const hD=qt,fD=DS,_D=lD,mD=$x,gD=Qx,ED=kS,SD=Symbol("opentelemetry.instrumentation.redis.open_spans"),TD=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class yD extends fD.InstrumentationBase{static COMPONENT="redis";constructor(e={}){super(gD.PACKAGE_NAME,gD.PACKAGE_VERSION,e)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(e){const t=new fD.InstrumentationNodeModuleFile(`${e}/dist/lib/commander.js`,["^1.0.0"],(e,t)=>{const n=e.transformCommandArguments;if(!n)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),e;const r=t?.startsWith("1.0.")?"extendWithCommands":"attachCommands";return(0,fD.isWrapped)(e?.[r])&&this._unwrap(e,r),this._wrap(e,r,this._getPatchExtendWithCommands(n)),e},e=>{(0,fD.isWrapped)(e?.extendWithCommands)&&this._unwrap(e,"extendWithCommands"),(0,fD.isWrapped)(e?.attachCommands)&&this._unwrap(e,"attachCommands")}),n=new fD.InstrumentationNodeModuleFile(`${e}/dist/lib/client/multi-command.js`,["^1.0.0"],e=>{const t=e?.default?.prototype;return(0,fD.isWrapped)(t?.exec)&&this._unwrap(t,"exec"),this._wrap(t,"exec",this._getPatchMultiCommandsExec()),(0,fD.isWrapped)(t?.addCommand)&&this._unwrap(t,"addCommand"),this._wrap(t,"addCommand",this._getPatchMultiCommandsAddCommand()),e},e=>{const t=e?.default?.prototype;(0,fD.isWrapped)(t?.exec)&&this._unwrap(t,"exec"),(0,fD.isWrapped)(t?.addCommand)&&this._unwrap(t,"addCommand")}),r=new fD.InstrumentationNodeModuleFile(`${e}/dist/lib/client/index.js`,["^1.0.0"],e=>{const t=e?.default?.prototype;return t?.multi&&((0,fD.isWrapped)(t?.multi)&&this._unwrap(t,"multi"),this._wrap(t,"multi",this._getPatchRedisClientMulti())),t?.MULTI&&((0,fD.isWrapped)(t?.MULTI)&&this._unwrap(t,"MULTI"),this._wrap(t,"MULTI",this._getPatchRedisClientMulti())),(0,fD.isWrapped)(t?.sendCommand)&&this._unwrap(t,"sendCommand"),this._wrap(t,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(t,"connect",this._getPatchedClientConnect()),e},e=>{const t=e?.default?.prototype;(0,fD.isWrapped)(t?.multi)&&this._unwrap(t,"multi"),(0,fD.isWrapped)(t?.MULTI)&&this._unwrap(t,"MULTI"),(0,fD.isWrapped)(t?.sendCommand)&&this._unwrap(t,"sendCommand")});return new fD.InstrumentationNodeModuleDefinition(e,["^1.0.0"],e=>e,()=>{},[t,n,r])}_getPatchExtendWithCommands(e){const t=this;return function(n){return function(r){if("RedisClient"!==r?.BaseClass?.name)return n.apply(this,arguments);const s=r.executor;return r.executor=function(n,r){const o=e(n,r).args;return t._traceClientCommand(s,this,arguments,o)},n.apply(this,arguments)}}}_getPatchMultiCommandsExec(){const e=this;return function(t){return function(){const n=t.apply(this,arguments);return"function"!=typeof n?.then?(e._diag.error("got non promise result when patching RedisClientMultiCommand.exec"),n):n.then(t=>{const n=this[SD];return e._endSpansWithRedisReplies(n,t),t}).catch(t=>{const n=this[SD];if(n){const r="MultiErrorReply"===t.constructor.name?t.replies:new Array(n.length).fill(t);e._endSpansWithRedisReplies(n,r)}else e._diag.error("cannot find open spans to end for redis multi command");return Promise.reject(t)})}}}_getPatchMultiCommandsAddCommand(){const e=this;return function(t){return function(n){return e._traceClientCommand(t,this,arguments,n)}}}_getPatchRedisClientMulti(){return function(e){return function(){const t=e.apply(this,arguments);return t[TD]=this.options,t}}}_getPatchRedisClientSendCommand(){const e=this;return function(t){return function(n){return e._traceClientCommand(t,this,arguments,n)}}}_getPatchedClientConnect(){const e=this;return function(t){return function(){const n=this.options,r=(0,_D.getClientAttributes)(e._diag,n),s=e.tracer.startSpan(`${yD.COMPONENT}-connect`,{kind:hD.SpanKind.CLIENT,attributes:r});return hD.context.with(hD.trace.setSpan(hD.context.active(),s),()=>t.apply(this)).then(e=>(s.end(),e)).catch(e=>(s.recordException(e),s.setStatus({code:hD.SpanStatusCode.ERROR,message:e.message}),s.end(),Promise.reject(e)))}}}_traceClientCommand(e,t,n,r){if(void 0===hD.trace.getSpan(hD.context.active())&&this.getConfig().requireParentSpan)return e.apply(t,n);const s=t.options||t[TD],o=r[0],i=r.slice(1),a=this.getConfig().dbStatementSerializer||mD.defaultDbStatementSerializer,c=(0,_D.getClientAttributes)(this._diag,s);try{const e=a(o,i);null!=e&&(c[ED.SEMATTRS_DB_STATEMENT]=e)}catch(e){this._diag.error("dbStatementSerializer throw an exception",e,{commandName:o})}const u=this.tracer.startSpan(`${yD.COMPONENT}-${o}`,{kind:hD.SpanKind.CLIENT,attributes:c}),l=hD.context.with(hD.trace.setSpan(hD.context.active(),u),()=>e.apply(t,n));if("function"==typeof l?.then)l.then(e=>{this._endSpanWithResponse(u,o,i,e,void 0)},e=>{this._endSpanWithResponse(u,o,i,null,e)});else{const e=l;e[SD]=e[SD]||[],e[SD].push({span:u,commandName:o,commandArgs:i})}return l}_endSpansWithRedisReplies(e,t){if(!e)return this._diag.error("cannot find open spans to end for redis multi command");if(t.length!==e.length)return this._diag.error("number of multi command spans does not match response from redis");for(let n=0;n<e.length;n++){const{span:r,commandName:s,commandArgs:o}=e[n],i=t[n],[a,c]=i instanceof Error?[null,i]:[i,void 0];this._endSpanWithResponse(r,s,o,a,c)}}_endSpanWithResponse(e,t,n,r,s){const{responseHook:o}=this.getConfig();if(!s&&o)try{o(e,t,n,r)}catch(e){this._diag.error("responseHook throw an exception",e)}s&&(e.recordException(s),e.setStatus({code:hD.SpanStatusCode.ERROR,message:s?.message})),e.end()}}uD.RedisInstrumentationV4=yD,Object.defineProperty(zx,"__esModule",{value:!0}),zx.RedisInstrumentation=void 0;const AD=DS,vD=Qx,bD=Jx,RD=uD,OD={requireParentSpan:!1};class ND extends AD.InstrumentationBase{instrumentationV2_V3;instrumentationV4;initialized=!1;constructor(e={}){const t={...OD,...e};super(vD.PACKAGE_NAME,vD.PACKAGE_VERSION,t),this.instrumentationV2_V3=new bD.RedisInstrumentationV2_V3(this.getConfig()),this.instrumentationV4=new RD.RedisInstrumentationV4(this.getConfig()),this.initialized=!0}setConfig(e={}){const t={...OD,...e};super.setConfig(t),this.initialized&&(this.instrumentationV2_V3.setConfig(t),this.instrumentationV4.setConfig(t))}init(){}setTracerProvider(e){super.setTracerProvider(e),this.initialized&&(this.instrumentationV2_V3.setTracerProvider(e),this.instrumentationV4.setTracerProvider(e))}enable(){super.enable(),this.initialized&&(this.instrumentationV2_V3.enable(),this.instrumentationV4.enable())}disable(){super.disable(),this.initialized&&(this.instrumentationV2_V3.disable(),this.instrumentationV4.disable())}}zx.RedisInstrumentation=ND,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RedisInstrumentation=void 0;var t=zx;Object.defineProperty(e,"RedisInstrumentation",{enumerable:!0,get:function(){return t.RedisInstrumentation}})}(Xx);const CD=["get","set","setex"],ID=["get","mget"],PD=["set","setex"];function MD(e,t){return e.includes(t.toLowerCase())}function wD(e){return MD(ID,e)?"cache.get":MD(PD,e)?"cache.put":void 0}function LD(e,t){return t.some(t=>e.startsWith(t))}function xD(e){const t=[],n=e=>{e.forEach(e=>{Array.isArray(e)?n(e):t.push(e)})};return n(e),t}const DD="Redis";let kD={};const UD=(e,t,n,r)=>{e.setAttribute($y,"auto.db.otel.redis");const s=function(e,t){try{if(0===t.length)return;const n=e=>"string"==typeof e||"number"==typeof e||Buffer.isBuffer(e)?[e.toString()]:Array.isArray(e)?xD(e.map(e=>n(e))):["<unknown>"],r=t[0];return MD(CD,e)&&null!=r?n(r):xD(t.map(e=>n(e)))}catch{return}}(t,n),o=wD(t);if(!(s&&o&&kD.cachePrefixes&&function(e,t,n){if(!wD(e))return!1;for(const e of t)if(LD(e,n))return!0;return!1}(t,s,kD.cachePrefixes)))return;const i=mA(e).data["net.peer.name"],a=mA(e).data["net.peer.port"];a&&i&&e.setAttributes({"network.peer.address":i,"network.peer.port":a});const c=function(e){const t=e=>{try{return Buffer.isBuffer(e)?e.byteLength:"string"==typeof e?e.length:"number"==typeof e?e.toString().length:null==e?0:JSON.stringify(e).length}catch{return}};return Array.isArray(e)?e.reduce((e,n)=>{const r=t(n);return"number"==typeof r?void 0!==e?e+r:r:e},0):t(e)}(r);c&&e.setAttribute("cache.item_size",c),MD(ID,t)&&void 0!==c&&e.setAttribute("cache.hit",c>0),e.setAttributes({[Uy]:o,[Hy]:s});const u=s.join(", ");e.updateName(ZT(u,1024))},$D=dO(`${DD}.IORedis`,()=>new xx.IORedisInstrumentation({responseHook:UD})),GD=dO(`${DD}.Redis`,()=>new Xx.RedisInstrumentation({responseHook:UD})),jD=Object.assign(()=>{$D(),GD()},{id:DD}),VD=(e={})=>({name:DD,setupOnce(){kD=e,jD()}});var HD={},BD={},FD={};Object.defineProperty(FD,"__esModule",{value:!0}),FD.EVENT_LISTENERS_SET=void 0,FD.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet");var YD={},qD={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.PG_VALUES="db.postgresql.values",e.PG_PLAN="db.postgresql.plan",e.IDLE_TIMEOUT_MILLIS="db.postgresql.idle.timeout.millis",e.MAX_CLIENT="db.postgresql.max.client"}(e.AttributeNames||(e.AttributeNames={}))}(qD);var KD={};Object.defineProperty(KD,"__esModule",{value:!0}),KD.METRIC_DB_CLIENT_OPERATION_DURATION=KD.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS=KD.METRIC_DB_CLIENT_CONNECTION_COUNT=KD.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE=KD.DB_CLIENT_CONNECTION_STATE_VALUE_USED=KD.ATTR_DB_OPERATION_NAME=KD.ATTR_DB_NAMESPACE=KD.ATTR_DB_CLIENT_CONNECTION_STATE=KD.ATTR_DB_CLIENT_CONNECTION_POOL_NAME=void 0,KD.ATTR_DB_CLIENT_CONNECTION_POOL_NAME="db.client.connection.pool.name",KD.ATTR_DB_CLIENT_CONNECTION_STATE="db.client.connection.state",KD.ATTR_DB_NAMESPACE="db.namespace",KD.ATTR_DB_OPERATION_NAME="db.operation.name",KD.DB_CLIENT_CONNECTION_STATE_VALUE_USED="used",KD.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE="idle",KD.METRIC_DB_CLIENT_CONNECTION_COUNT="db.client.connection.count",KD.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS="db.client.connection.pending_requests",KD.METRIC_DB_CLIENT_OPERATION_DURATION="db.client.operation.duration";var WD={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=void 0,function(e){e.QUERY_PREFIX="pg.query",e.CONNECT="pg.connect",e.POOL_CONNECT="pg-pool.connect"}(e.SpanNames||(e.SpanNames={}))}(WD),Object.defineProperty(YD,"__esModule",{value:!0}),YD.isObjectWithTextString=YD.getErrorMessage=YD.patchClientConnectCallback=YD.patchCallbackPGPool=YD.updateCounter=YD.getPoolName=YD.patchCallback=YD.handleExecutionResult=YD.handleConfigQuery=YD.shouldSkipInstrumentation=YD.getSemanticAttributesFromPool=YD.getSemanticAttributesFromConnection=YD.getConnectionString=YD.parseAndMaskConnectionString=YD.parseNormalizedOperationName=YD.getQuerySpanName=void 0;const ZD=qt,XD=qD,zD=kS,QD=KD,JD=DS,ek=WD;function tk(e,t){if(!t)return ek.SpanNames.QUERY_PREFIX;const n="string"==typeof t.name&&t.name?t.name:nk(t.text);return`${ek.SpanNames.QUERY_PREFIX}:${n}${e?` ${e}`:""}`}function nk(e){const t=e.indexOf(" ");let n=-1===t?e:e.slice(0,t);return n=n.toUpperCase(),n.endsWith(";")?n.slice(0,-1):n}function rk(e){try{const t=new URL(e);return t.username="",t.password="",t.toString()}catch(e){return"postgresql://localhost:5432/"}}function sk(e){if("connectionString"in e&&e.connectionString)return rk(e.connectionString);return`postgresql://${e.host||"localhost"}:${e.port||5432}/${e.database||""}`}function ok(e){if(Number.isInteger(e))return e}function ik(e){return{[zD.SEMATTRS_DB_SYSTEM]:zD.DBSYSTEMVALUES_POSTGRESQL,[zD.SEMATTRS_DB_NAME]:e.database,[zD.SEMATTRS_DB_CONNECTION_STRING]:sk(e),[zD.SEMATTRS_NET_PEER_NAME]:e.host,[zD.SEMATTRS_NET_PEER_PORT]:ok(e.port),[zD.SEMATTRS_DB_USER]:e.user}}function ak(e,t,n){"function"==typeof e.responseHook&&(0,JD.safeExecuteInTheMiddle)(()=>{e.responseHook(t,{data:n})},e=>{e&&ZD.diag.error("Error running response hook",e)},!0)}YD.getQuerySpanName=tk,YD.parseNormalizedOperationName=nk,YD.parseAndMaskConnectionString=rk,YD.getConnectionString=sk,YD.getSemanticAttributesFromConnection=ik,YD.getSemanticAttributesFromPool=function(e){let t;try{t=e.connectionString?new URL(e.connectionString):void 0}catch(e){t=void 0}return{[zD.SEMATTRS_DB_SYSTEM]:zD.DBSYSTEMVALUES_POSTGRESQL,[zD.SEMATTRS_DB_NAME]:t?.pathname.slice(1)??e.database,[zD.SEMATTRS_DB_CONNECTION_STRING]:sk(e),[zD.SEMATTRS_NET_PEER_NAME]:t?.hostname??e.host,[zD.SEMATTRS_NET_PEER_PORT]:Number(t?.port)||ok(e.port),[zD.SEMATTRS_DB_USER]:t?.username??e.user,[XD.AttributeNames.IDLE_TIMEOUT_MILLIS]:e.idleTimeoutMillis,[XD.AttributeNames.MAX_CLIENT]:e.maxClient}},YD.shouldSkipInstrumentation=function(e){return!0===e.requireParentSpan&&void 0===ZD.trace.getSpan(ZD.context.active())},YD.handleConfigQuery=function(e,t,n){const{connectionParameters:r}=this,s=tk(r.database,n),o=e.startSpan(s,{kind:ZD.SpanKind.CLIENT,attributes:ik(r)});if(!n)return o;if(n.text&&o.setAttribute(zD.SEMATTRS_DB_STATEMENT,n.text),t.enhancedDatabaseReporting&&Array.isArray(n.values))try{const e=n.values.map(e=>null==e?"null":e instanceof Buffer?e.toString():"object"==typeof e?"function"==typeof e.toPostgres?e.toPostgres():JSON.stringify(e):e.toString());o.setAttribute(XD.AttributeNames.PG_VALUES,e)}catch(e){ZD.diag.error("failed to stringify ",n.values,e)}return"string"==typeof n.name&&o.setAttribute(XD.AttributeNames.PG_PLAN,n.name),o},YD.handleExecutionResult=ak,YD.patchCallback=function(e,t,n,r,s){return function(o,i){o?(Object.prototype.hasOwnProperty.call(o,"code")&&(r[zD.ATTR_ERROR_TYPE]=o.code),t.setStatus({code:ZD.SpanStatusCode.ERROR,message:o.message})):ak(e,t,i),s(),t.end(),n.call(this,o,i)}},YD.getPoolName=function(e){let t="";return t+=(e?.host?`${e.host}`:"unknown_host")+":",t+=(e?.port?`${e.port}`:"unknown_port")+"/",t+=e?.database?`${e.database}`:"unknown_database",t.trim()},YD.updateCounter=function(e,t,n,r,s){const o=t.totalCount,i=t.waitingCount,a=t.idleCount,c=o-a;return n.add(c-s.used,{[QD.ATTR_DB_CLIENT_CONNECTION_STATE]:QD.DB_CLIENT_CONNECTION_STATE_VALUE_USED,[QD.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),n.add(a-s.idle,{[QD.ATTR_DB_CLIENT_CONNECTION_STATE]:QD.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE,[QD.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),r.add(i-s.pending,{[QD.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),{used:c,idle:a,pending:i}},YD.patchCallbackPGPool=function(e,t){return function(n,r,s){n&&e.setStatus({code:ZD.SpanStatusCode.ERROR,message:n.message}),e.end(),t.call(this,n,r,s)}},YD.patchClientConnectCallback=function(e,t){return function(n){n&&e.setStatus({code:ZD.SpanStatusCode.ERROR,message:n.message}),e.end(),t.apply(this,arguments)}},YD.getErrorMessage=function(e){return"object"==typeof e&&null!==e&&"message"in e?String(e.message):void 0},YD.isObjectWithTextString=function(e){return"object"==typeof e&&"string"==typeof e?.text};var ck={};Object.defineProperty(ck,"__esModule",{value:!0}),ck.PACKAGE_NAME=ck.PACKAGE_VERSION=void 0,ck.PACKAGE_VERSION="0.55.0",ck.PACKAGE_NAME="@opentelemetry/instrumentation-pg",Object.defineProperty(BD,"__esModule",{value:!0}),BD.PgInstrumentation=void 0;const uk=DS,lk=qt,pk=FD,dk=YD,hk=_x,fk=ck,_k=WD,mk=Qm,gk=kS,Ek=KD;function Sk(e){return"Module"===e[Symbol.toStringTag]?e.default:e}class Tk extends uk.InstrumentationBase{_connectionsCounter={used:0,idle:0,pending:0};constructor(e={}){super(fk.PACKAGE_NAME,fk.PACKAGE_VERSION,e)}_updateMetricInstruments(){this._operationDuration=this.meter.createHistogram(Ek.METRIC_DB_CLIENT_OPERATION_DURATION,{description:"Duration of database client operations.",unit:"s",valueType:lk.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.001,.005,.01,.05,.1,.5,1,5,10]}}),this._connectionsCounter={idle:0,pending:0,used:0},this._connectionsCount=this.meter.createUpDownCounter(Ek.METRIC_DB_CLIENT_CONNECTION_COUNT,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"}),this._connectionPendingRequests=this.meter.createUpDownCounter(Ek.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS,{description:"The number of current pending requests for an open connection.",unit:"{connection}"})}init(){const e=[">=8.0.3 <9"],t=new uk.InstrumentationNodeModuleFile("pg/lib/native/client.js",e,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),n=new uk.InstrumentationNodeModuleFile("pg/lib/client.js",e,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this));return[new uk.InstrumentationNodeModuleDefinition("pg",e,e=>{const t=Sk(e);return this._patchPgClient(t.Client),e},e=>{const t=Sk(e);return this._unpatchPgClient(t.Client),e},[n,t]),new uk.InstrumentationNodeModuleDefinition("pg-pool",[">=2.0.0 <4"],e=>{const t=Sk(e);return(0,uk.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),this._wrap(t.prototype,"connect",this._getPoolConnectPatch()),t},e=>{const t=Sk(e);(0,uk.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect")})]}_patchPgClient(e){if(!e)return;const t=Sk(e);return(0,uk.isWrapped)(t.prototype.query)&&this._unwrap(t.prototype,"query"),(0,uk.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),this._wrap(t.prototype,"query",this._getClientQueryPatch()),this._wrap(t.prototype,"connect",this._getClientConnectPatch()),e}_unpatchPgClient(e){const t=Sk(e);return(0,uk.isWrapped)(t.prototype.query)&&this._unwrap(t.prototype,"query"),(0,uk.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),e}_getClientConnectPatch(){const e=this;return t=>function(n){if(dk.shouldSkipInstrumentation(e.getConfig()))return t.call(this,n);const r=e.tracer.startSpan(_k.SpanNames.CONNECT,{kind:lk.SpanKind.CLIENT,attributes:dk.getSemanticAttributesFromConnection(this)});if(n){const e=lk.trace.getSpan(lk.context.active());n=dk.patchClientConnectCallback(r,n),e&&(n=lk.context.bind(lk.context.active(),n))}return yk(r,lk.context.with(lk.trace.setSpan(lk.context.active(),r),()=>t.call(this,n)))}}recordOperationDuration(e,t){const n={};[gk.SEMATTRS_DB_SYSTEM,Ek.ATTR_DB_NAMESPACE,gk.ATTR_ERROR_TYPE,gk.ATTR_SERVER_PORT,gk.ATTR_SERVER_ADDRESS,Ek.ATTR_DB_OPERATION_NAME].forEach(t=>{t in e&&(n[t]=e[t])});const r=(0,mk.hrTimeToMilliseconds)((0,mk.hrTimeDuration)(t,(0,mk.hrTime)()))/1e3;this._operationDuration.record(r,n)}_getClientQueryPatch(){const e=this;return t=>(this._diag.debug("Patching pg.Client.prototype.query"),function(...n){if(dk.shouldSkipInstrumentation(e.getConfig()))return t.apply(this,n);const r=(0,mk.hrTime)(),s=n[0],o="string"==typeof s,i=dk.isObjectWithTextString(s),a=o?{text:s,values:Array.isArray(n[1])?n[1]:void 0}:i?s:void 0,c={[gk.SEMATTRS_DB_SYSTEM]:gk.DBSYSTEMVALUES_POSTGRESQL,[Ek.ATTR_DB_NAMESPACE]:this.database,[gk.ATTR_SERVER_PORT]:this.connectionParameters.port,[gk.ATTR_SERVER_ADDRESS]:this.connectionParameters.host};a?.text&&(c[Ek.ATTR_DB_OPERATION_NAME]=dk.parseNormalizedOperationName(a?.text));const u=()=>{e.recordOperationDuration(c,r)},l=e.getConfig(),p=dk.handleConfigQuery.call(this,e.tracer,l,a);if(l.addSqlCommenterCommentToQueries&&(o?n[0]=(0,hk.addSqlCommenterComment)(p,s):i&&!("name"in s)&&(n[0]={...s,text:(0,hk.addSqlCommenterComment)(p,s.text)})),n.length>0){const t=lk.trace.getSpan(lk.context.active());if("function"==typeof n[n.length-1])n[n.length-1]=dk.patchCallback(l,p,n[n.length-1],c,u),t&&(n[n.length-1]=lk.context.bind(lk.context.active(),n[n.length-1]));else if("function"==typeof a?.callback){let r=dk.patchCallback(e.getConfig(),p,a.callback,c,u);t&&(r=lk.context.bind(lk.context.active(),r)),n[0].callback=r}}const{requestHook:d}=l;let h;"function"==typeof d&&a&&(0,uk.safeExecuteInTheMiddle)(()=>{const{database:e,host:t,port:n,user:r}=this.connectionParameters;d(p,{connection:{database:e,host:t,port:n,user:r},query:{text:a.text,values:a.values,name:a.name}})},t=>{t&&e._diag.error("Error running query hook",t)},!0);try{h=t.apply(this,n)}catch(e){throw p.setStatus({code:lk.SpanStatusCode.ERROR,message:dk.getErrorMessage(e)}),p.end(),e}return h instanceof Promise?h.then(t=>new Promise(n=>{dk.handleExecutionResult(e.getConfig(),p,t),u(),p.end(),n(t)})).catch(e=>new Promise((t,n)=>{p.setStatus({code:lk.SpanStatusCode.ERROR,message:e.message}),u(),p.end(),n(e)})):h})}_setPoolConnectEventListeners(e){if(e[pk.EVENT_LISTENERS_SET])return;const t=dk.getPoolName(e.options);e.on("connect",()=>{this._connectionsCounter=dk.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("acquire",()=>{this._connectionsCounter=dk.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("remove",()=>{this._connectionsCounter=dk.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("release",()=>{this._connectionsCounter=dk.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e[pk.EVENT_LISTENERS_SET]=!0}_getPoolConnectPatch(){const e=this;return t=>function(n){if(dk.shouldSkipInstrumentation(e.getConfig()))return t.call(this,n);const r=e.tracer.startSpan(_k.SpanNames.POOL_CONNECT,{kind:lk.SpanKind.CLIENT,attributes:dk.getSemanticAttributesFromPool(this.options)});if(e._setPoolConnectEventListeners(this),n){const e=lk.trace.getSpan(lk.context.active());n=dk.patchCallbackPGPool(r,n),e&&(n=lk.context.bind(lk.context.active(),n))}return yk(r,lk.context.with(lk.trace.setSpan(lk.context.active(),r),()=>t.call(this,n)))}}}function yk(e,t){if(!(t instanceof Promise))return t;const n=t;return lk.context.bind(lk.context.active(),n.then(t=>(e.end(),t)).catch(t=>(e.setStatus({code:lk.SpanStatusCode.ERROR,message:dk.getErrorMessage(t)}),e.end(),Promise.reject(t))))}BD.PgInstrumentation=Tk,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.PgInstrumentation=void 0;var t=BD;Object.defineProperty(e,"PgInstrumentation",{enumerable:!0,get:function(){return t.PgInstrumentation}});var n=qD;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})}(HD);const Ak="Postgres",vk=dO(Ak,()=>new HD.PgInstrumentation({requireParentSpan:!0,requestHook(e){VI(e,"auto.db.otel.postgres")}})),bk=()=>({name:Ak,setupOnce(){vk()}}),Rk="PostgresJs",Ok=[">=3.0.0 <4"],Nk=dO(Rk,e=>new Ck({requireParentSpan:e?.requireParentSpan??!0,requestHook:e?.requestHook}));class Ck extends IS{constructor(e){super("sentry-postgres-js",lT,e)}init(){const e=new MS("postgres",Ok);return["src","cf/src","cjs/src"].forEach(t=>{e.files.push(new wS(`postgres/${t}/connection.js`,["*"],this._patchConnection.bind(this),this._unwrap.bind(this))),e.files.push(new wS(`postgres/${t}/query.js`,Ok,this._patchQuery.bind(this),this._unwrap.bind(this)))}),[e]}_shouldCreateSpans(){const e=this.getConfig();return void 0!==jt.getSpan(At.active())||!e.requireParentSpan}_patchReject(e,t){return new Proxy(e,{apply:(e,n,r)=>{t.setStatus({code:2,message:r?.[0]?.message||"unknown_error"});const s=Reflect.apply(e,n,r);return t.setAttribute($_,r?.[0]?.code||"Unknown error"),t.setAttribute(j_,r?.[0]?.name||"Unknown error"),t.end(),s}})}_patchResolve(e,t){return new Proxy(e,{apply:(e,n,r)=>{const s=Reflect.apply(e,n,r),o=r?.[0]?.command;return o&&t.setAttribute(k_,o),t.end(),s}})}_patchQuery(e){return e.Query.prototype.handle=new Proxy(e.Query.prototype.handle,{apply:async(e,t,n)=>{if(!this._shouldCreateSpans())return Reflect.apply(e,t,n);const r=this._sanitizeSqlQuery(t.strings?.[0]);return cv({name:r||"postgresjs.query",op:"db"},s=>{const o=Py().getScopeData().contexts.postgresjsConnection;VI(s,"auto.db.otel.postgres");const{requestHook:i}=this.getConfig();i&&NS(()=>i(s,r,o),e=>{e&&TT.error(`Error in requestHook for ${Rk} integration:`,e)});const a=o?.ATTR_DB_NAMESPACE||"<unknown database>",c=o?.ATTR_SERVER_ADDRESS||"<unknown host>",u=o?.ATTR_SERVER_PORT||"<unknown port>";s.setAttribute(G_,"postgres"),s.setAttribute(D_,a),s.setAttribute(K_,c),s.setAttribute(W_,u),s.setAttribute(U_,r),t.resolve=this._patchResolve(t.resolve,s),t.reject=this._patchReject(t.reject,s);try{return Reflect.apply(e,t,n)}catch(e){throw s.setStatus({code:2}),s.end(),e}})}}),e}_patchConnection(e){return new Proxy(e,{apply:(e,t,n)=>{const r=n[0]?.database||"<unknown database>",s=n[0]?.host?.[0]||"<unknown host>",o=n[0]?.port?.[0]||"<unknown port>";return Py().setContext("postgresjsConnection",{ATTR_DB_NAMESPACE:r,ATTR_SERVER_ADDRESS:s,ATTR_SERVER_PORT:o}),Reflect.apply(e,t,n)}})}_sanitizeSqlQuery(e){return e?e.replace(/\s+/g," ").trim().substring(0,1024).replace(/--.*?(\r?\n|$)/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/;\s*$/,"").replace(/\b\d+\b/g,"?").replace(/\s+/g," ").replace(/\bIN\b\s*\(\s*\?(?:\s*,\s*\?)*\s*\)/g,"IN (?)"):"Unknown SQL Query"}}const Ik=()=>({name:Rk,setupOnce(){Nk()}});var Pk;!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRACE=1]="TRACE",e[e.TRACE2=2]="TRACE2",e[e.TRACE3=3]="TRACE3",e[e.TRACE4=4]="TRACE4",e[e.DEBUG=5]="DEBUG",e[e.DEBUG2=6]="DEBUG2",e[e.DEBUG3=7]="DEBUG3",e[e.DEBUG4=8]="DEBUG4",e[e.INFO=9]="INFO",e[e.INFO2=10]="INFO2",e[e.INFO3=11]="INFO3",e[e.INFO4=12]="INFO4",e[e.WARN=13]="WARN",e[e.WARN2=14]="WARN2",e[e.WARN3=15]="WARN3",e[e.WARN4=16]="WARN4",e[e.ERROR=17]="ERROR",e[e.ERROR2=18]="ERROR2",e[e.ERROR3=19]="ERROR3",e[e.ERROR4=20]="ERROR4",e[e.FATAL=21]="FATAL",e[e.FATAL2=22]="FATAL2",e[e.FATAL3=23]="FATAL3",e[e.FATAL4=24]="FATAL4"}(Pk||(Pk={}));var Mk=function(){function e(){}return e.prototype.emit=function(e){},e}(),wk=new Mk,Lk=new(function(){function e(){}return e.prototype.getLogger=function(e,t,n){return new Mk},e}()),xk=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.emit=function(e){this._getLogger().emit(e)},e.prototype._getLogger=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateLogger(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):wk},e}(),Dk=function(){function e(){}return e.prototype.getLogger=function(e,t,n){var r;return null!==(r=this.getDelegateLogger(e,t,n))&&void 0!==r?r:new xk(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Lk},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateLogger=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(e,t,n)},e}(),kk="object"==typeof globalThis?globalThis:global,Uk=Symbol.for("io.opentelemetry.js.api.logs"),$k=kk;var Gk=function(){function e(){this._proxyLoggerProvider=new Dk}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalLoggerProvider=function(e){return $k[Uk]?this.getLoggerProvider():($k[Uk]=(t=1,n=e,r=Lk,function(e){return e===t?n:r}),this._proxyLoggerProvider.setDelegate(e),e);var t,n,r},e.prototype.getLoggerProvider=function(){var e,t;return null!==(t=null===(e=$k[Uk])||void 0===e?void 0:e.call($k,1))&&void 0!==t?t:this._proxyLoggerProvider},e.prototype.getLogger=function(e,t,n){return this.getLoggerProvider().getLogger(e,t,n)},e.prototype.disable=function(){delete $k[Uk],this._proxyLoggerProvider=new Dk},e}(),jk=Gk.getInstance(),Vk={exports:{}};var Hk={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var Bk="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=Hk,o=Bk,i=(t=e.exports={}).re=[],a=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],l=t.t={};let p=0;const d="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[d,r]],f=(e,t,n)=>{const r=(e=>{for(const[t,n]of h)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),s=p++;o(e,s,t),l[e]=s,c[s]=t,u[s]=r,i[s]=new RegExp(t,n?"g":void 0),a[s]=new RegExp(r,n?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),f("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${d}+`),f("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),f("FULL",`^${c[l.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),f("LOOSE",`^${c[l.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),f("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),f("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?`+`(?:${c[l.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",c[l.COERCE],!0),f("COERCERTLFULL",c[l.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",f("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",f("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Vk,Vk.exports);var Fk=Vk.exports;const Yk=Object.freeze({loose:!0}),qk=Object.freeze({});var Kk=e=>e?"object"!=typeof e?Yk:e:qk;const Wk=/^[0-9]+$/,Zk=(e,t)=>{const n=Wk.test(e),r=Wk.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var Xk={compareIdentifiers:Zk,rcompareIdentifiers:(e,t)=>Zk(t,e)};const zk=Bk,{MAX_LENGTH:Qk,MAX_SAFE_INTEGER:Jk}=Hk,{safeRe:eU,t:tU}=Fk,nU=Kk,{compareIdentifiers:rU}=Xk;var sU=class e{constructor(t,n){if(n=nU(n),t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Qk)throw new TypeError(`version is longer than ${Qk} characters`);zk("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?eU[tU.LOOSE]:eU[tU.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Jk||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Jk||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Jk||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Jk)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(zk("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),rU(this.major,t.major)||rU(this.minor,t.minor)||rU(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const e=this.prerelease[n],r=t.prerelease[n];if(zk("prerelease compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return rU(e,r)}while(++n)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let n=0;do{const e=this.build[n],r=t.build[n];if(zk("build compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return rU(e,r)}while(++n)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?eU[tU.PRERELEASELOOSE]:eU[tU.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===rU(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const oU=sU;var iU=(e,t,n=!1)=>{if(e instanceof oU)return e;try{return new oU(e,t)}catch(e){if(!n)return null;throw e}};const aU=iU;var cU=(e,t)=>{const n=aU(e,t);return n?n.version:null};const uU=iU;var lU=(e,t)=>{const n=uU(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};const pU=sU;var dU=(e,t,n,r,s)=>{"string"==typeof n&&(s=r,r=n,n=void 0);try{return new pU(e instanceof pU?e.version:e,n).inc(t,r,s).version}catch(e){return null}};const hU=iU;var fU=(e,t)=>{const n=hU(e,null,!0),r=hU(t,null,!0),s=n.compare(r);if(0===s)return null;const o=s>0,i=o?n:r,a=o?r:n,c=!!i.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(0===a.compareMain(i))return a.minor&&!a.patch?"minor":"patch"}const u=c?"pre":"";return n.major!==r.major?u+"major":n.minor!==r.minor?u+"minor":n.patch!==r.patch?u+"patch":"prerelease"};const _U=sU;var mU=(e,t)=>new _U(e,t).major;const gU=sU;var EU=(e,t)=>new gU(e,t).minor;const SU=sU;var TU=(e,t)=>new SU(e,t).patch;const yU=iU;var AU=(e,t)=>{const n=yU(e,t);return n&&n.prerelease.length?n.prerelease:null};const vU=sU;var bU=(e,t,n)=>new vU(e,n).compare(new vU(t,n));const RU=bU;var OU=(e,t,n)=>RU(t,e,n);const NU=bU;var CU=(e,t)=>NU(e,t,!0);const IU=sU;var PU=(e,t,n)=>{const r=new IU(e,n),s=new IU(t,n);return r.compare(s)||r.compareBuild(s)};const MU=PU;var wU=(e,t)=>e.sort((e,n)=>MU(e,n,t));const LU=PU;var xU=(e,t)=>e.sort((e,n)=>LU(n,e,t));const DU=bU;var kU=(e,t,n)=>DU(e,t,n)>0;const UU=bU;var $U=(e,t,n)=>UU(e,t,n)<0;const GU=bU;var jU=(e,t,n)=>0===GU(e,t,n);const VU=bU;var HU=(e,t,n)=>0!==VU(e,t,n);const BU=bU;var FU=(e,t,n)=>BU(e,t,n)>=0;const YU=bU;var qU=(e,t,n)=>YU(e,t,n)<=0;const KU=jU,WU=HU,ZU=kU,XU=FU,zU=$U,QU=qU;var JU=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return KU(e,n,r);case"!=":return WU(e,n,r);case">":return ZU(e,n,r);case">=":return XU(e,n,r);case"<":return zU(e,n,r);case"<=":return QU(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const e$=sU,t$=iU,{safeRe:n$,t:r$}=Fk;var s$=(e,t)=>{if(e instanceof e$)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){const r=t.includePrerelease?n$[r$.COERCERTLFULL]:n$[r$.COERCERTL];let s;for(;(s=r.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&s.index+s[0].length===n.index+n[0].length||(n=s),r.lastIndex=s.index+s[1].length+s[2].length;r.lastIndex=-1}else n=e.match(t.includePrerelease?n$[r$.COERCEFULL]:n$[r$.COERCE]);if(null===n)return null;const r=n[2],s=n[3]||"0",o=n[4]||"0",i=t.includePrerelease&&n[5]?`-${n[5]}`:"",a=t.includePrerelease&&n[6]?`+${n[6]}`:"";return t$(`${r}.${s}.${o}${i}${a}`,t)};var o$,i$,a$,c$,u$=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};function l$(){if(i$)return o$;i$=1;const e=/\s+/g;class t{constructor(n,o){if(o=r(o),n instanceof t)return n.loose===!!o.loose&&n.includePrerelease===!!o.includePrerelease?n:new t(n.raw,o);if(n instanceof s)return this.raw=n.value,this.set=[[n]],this.formatted=void 0,this;if(this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease,this.raw=n.trim().replace(e," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!f(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&_(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&d)|(this.options.loose&&h))+":"+e,r=n.get(t);if(r)return r;const i=this.options.loose,_=i?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];e=e.replace(_,N(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(a[c.COMPARATORTRIM],u),o("comparator trim",e),e=e.replace(a[c.TILDETRIM],l),o("tilde trim",e),e=e.replace(a[c.CARETTRIM],p),o("caret trim",e);let m=e.split(" ").map(e=>g(e,this.options)).join(" ").split(/\s+/).map(e=>O(e,this.options));i&&(m=m.filter(e=>(o("loose invalid filter",e,this.options),!!e.match(a[c.COMPARATORLOOSE])))),o("range list",m);const E=new Map,S=m.map(e=>new s(e,this.options));for(const e of S){if(f(e))return[e];E.set(e.value,e)}E.size>1&&E.has("")&&E.delete("");const T=[...E.values()];return n.set(t,T),T}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(t=>m(t,n)&&e.set.some(e=>m(e,n)&&t.every(t=>e.every(e=>t.intersects(e,n)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new i(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}o$=t;const n=new u$,r=Kk,s=p$(),o=Bk,i=sU,{safeRe:a,t:c,comparatorTrimReplace:u,tildeTrimReplace:l,caretTrimReplace:p}=Fk,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:h}=Hk,f=e=>"<0.0.0-0"===e.value,_=e=>""===e.value,m=(e,t)=>{let n=!0;const r=e.slice();let s=r.pop();for(;n&&r.length;)n=r.every(e=>s.intersects(e,t)),s=r.pop();return n},g=(e,t)=>(o("comp",e,t),e=y(e,t),o("caret",e),e=S(e,t),o("tildes",e),e=v(e,t),o("xrange",e),e=R(e,t),o("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,S=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{const n=t.loose?a[c.TILDELOOSE]:a[c.TILDE];return e.replace(n,(t,n,r,s,i)=>{let a;return o("tilde",e,t,n,r,s,i),E(n)?a="":E(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:E(s)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:i?(o("replaceTilde pr",i),a=`>=${n}.${r}.${s}-${i} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${s} <${n}.${+r+1}.0-0`,o("tilde return",a),a})},y=(e,t)=>e.trim().split(/\s+/).map(e=>A(e,t)).join(" "),A=(e,t)=>{o("caret",e,t);const n=t.loose?a[c.CARETLOOSE]:a[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(t,n,s,i,a)=>{let c;return o("caret",e,t,n,s,i,a),E(n)?c="":E(s)?c=`>=${n}.0.0${r} <${+n+1}.0.0-0`:E(i)?c="0"===n?`>=${n}.${s}.0${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.0${r} <${+n+1}.0.0-0`:a?(o("replaceCaret pr",a),c="0"===n?"0"===s?`>=${n}.${s}.${i}-${a} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}-${a} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i}-${a} <${+n+1}.0.0-0`):(o("no pr"),c="0"===n?"0"===s?`>=${n}.${s}.${i}${r} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i} <${+n+1}.0.0-0`),o("caret return",c),c})},v=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map(e=>b(e,t)).join(" ")),b=(e,t)=>{e=e.trim();const n=t.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return e.replace(n,(n,r,s,i,a,c)=>{o("xRange",e,n,r,s,i,a,c);const u=E(s),l=u||E(i),p=l||E(a),d=p;return"="===r&&d&&(r=""),c=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(l&&(i=0),a=0,">"===r?(r=">=",l?(s=+s+1,i=0,a=0):(i=+i+1,a=0)):"<="===r&&(r="<",l?s=+s+1:i=+i+1),"<"===r&&(c="-0"),n=`${r+s}.${i}.${a}${c}`):l?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:p&&(n=`>=${s}.${i}.0${c} <${s}.${+i+1}.0-0`),o("xRange return",n),n})},R=(e,t)=>(o("replaceStars",e,t),e.trim().replace(a[c.STAR],"")),O=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(a[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),N=e=>(t,n,r,s,o,i,a,c,u,l,p,d)=>`${n=E(r)?"":E(s)?`>=${r}.0.0${e?"-0":""}`:E(o)?`>=${r}.${s}.0${e?"-0":""}`:i?`>=${n}`:`>=${n}${e?"-0":""}`} ${c=E(u)?"":E(l)?`<${+u+1}.0.0-0`:E(p)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${p}-${d}`:e?`<${u}.${l}.${+p+1}-0`:`<=${c}`}`.trim(),C=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(o(e[n].semver),e[n].semver!==s.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0};return o$}function p$(){if(c$)return a$;c$=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(r,s){if(s=n(s),r instanceof t){if(r.loose===!!s.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),i("comparator",r,s),this.options=s,this.loose=!!s.loose,this.parse(r),this.semver===e?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(t){const n=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],o=t.match(n);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==o[1]?o[1]:"","="===this.operator&&(this.operator=""),o[2]?this.semver=new a(o[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(i("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new a(t,this.options)}catch(e){return!1}return o(t,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,r).test(this.value):""===e.operator?""===e.value||new c(this.value,r).test(e.semver):(!(r=n(r)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(o(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(o(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}a$=t;const n=Kk,{safeRe:r,t:s}=Fk,o=JU,i=Bk,a=sU,c=l$();return a$}const d$=l$();var h$=(e,t,n)=>{try{t=new d$(t,n)}catch(e){return!1}return t.test(e)};const f$=l$();var _$=(e,t)=>new f$(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "));const m$=sU,g$=l$();var E$=(e,t,n)=>{let r=null,s=null,o=null;try{o=new g$(t,n)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(r&&-1!==s.compare(e)||(r=e,s=new m$(r,n)))}),r};const S$=sU,T$=l$();var y$=(e,t,n)=>{let r=null,s=null,o=null;try{o=new T$(t,n)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(r&&1!==s.compare(e)||(r=e,s=new S$(r,n)))}),r};const A$=sU,v$=l$(),b$=kU;var R$=(e,t)=>{e=new v$(e,t);let n=new A$("0.0.0");if(e.test(n))return n;if(n=new A$("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let s=null;r.forEach(e=>{const t=new A$(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!b$(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),!s||n&&!b$(n,s)||(n=s)}return n&&e.test(n)?n:null};const O$=l$();var N$=(e,t)=>{try{return new O$(e,t).range||"*"}catch(e){return null}};const C$=sU,I$=p$(),{ANY:P$}=I$,M$=l$(),w$=h$,L$=kU,x$=$U,D$=qU,k$=FU;var U$=(e,t,n,r)=>{let s,o,i,a,c;switch(e=new C$(e,r),t=new M$(t,r),n){case">":s=L$,o=D$,i=x$,a=">",c=">=";break;case"<":s=x$,o=k$,i=L$,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(w$(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let l=null,p=null;if(u.forEach(e=>{e.semver===P$&&(e=new I$(">=0.0.0")),l=l||e,p=p||e,s(e.semver,l.semver,r)?l=e:i(e.semver,p.semver,r)&&(p=e)}),l.operator===a||l.operator===c)return!1;if((!p.operator||p.operator===a)&&o(e,p.semver))return!1;if(p.operator===c&&i(e,p.semver))return!1}return!0};const $$=U$;var G$=(e,t,n)=>$$(e,t,">",n);const j$=U$;var V$=(e,t,n)=>j$(e,t,"<",n);const H$=l$();var B$=(e,t,n)=>(e=new H$(e,n),t=new H$(t,n),e.intersects(t,n));const F$=h$,Y$=bU;const q$=l$(),K$=p$(),{ANY:W$}=K$,Z$=h$,X$=bU,z$=[new K$(">=0.0.0-0")],Q$=[new K$(">=0.0.0")],J$=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===W$){if(1===t.length&&t[0].semver===W$)return!0;e=n.includePrerelease?z$:Q$}if(1===t.length&&t[0].semver===W$){if(n.includePrerelease)return!0;t=Q$}const r=new Set;let s,o,i,a,c,u,l;for(const t of e)">"===t.operator||">="===t.operator?s=eG(s,t,n):"<"===t.operator||"<="===t.operator?o=tG(o,t,n):r.add(t.semver);if(r.size>1)return null;if(s&&o){if(i=X$(s.semver,o.semver,n),i>0)return null;if(0===i&&(">="!==s.operator||"<="!==o.operator))return null}for(const e of r){if(s&&!Z$(e,String(s),n))return null;if(o&&!Z$(e,String(o),n))return null;for(const r of t)if(!Z$(e,String(r),n))return!1;return!0}let p=!(!o||n.includePrerelease||!o.semver.prerelease.length)&&o.semver,d=!(!s||n.includePrerelease||!s.semver.prerelease.length)&&s.semver;p&&1===p.prerelease.length&&"<"===o.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(l=l||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,s)if(d&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===d.major&&e.semver.minor===d.minor&&e.semver.patch===d.patch&&(d=!1),">"===e.operator||">="===e.operator){if(a=eG(s,e,n),a===e&&a!==s)return!1}else if(">="===s.operator&&!Z$(s.semver,String(e),n))return!1;if(o)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(c=tG(o,e,n),c===e&&c!==o)return!1}else if("<="===o.operator&&!Z$(o.semver,String(e),n))return!1;if(!e.operator&&(o||s)&&0!==i)return!1}return!(s&&u&&!o&&0!==i)&&(!(o&&l&&!s&&0!==i)&&(!d&&!p))},eG=(e,t,n)=>{if(!e)return t;const r=X$(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},tG=(e,t,n)=>{if(!e)return t;const r=X$(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var nG=(e,t,n={})=>{if(e===t)return!0;e=new q$(e,n),t=new q$(t,n);let r=!1;e:for(const s of e.set){for(const e of t.set){const t=J$(s,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0};const rG=Fk,sG=Hk,oG=sU,iG=Xk,aG=(e,t,n)=>{const r=[];let s=null,o=null;const i=e.sort((e,t)=>Y$(e,t,n));for(const e of i){F$(e,t,n)?(o=e,s||(s=e)):(o&&r.push([s,o]),o=null,s=null)}s&&r.push([s,null]);const a=[];for(const[e,t]of r)e===t?a.push(e):t||e!==i[0]?t?e===i[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const c=a.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return c.length<u.length?c:t};var cG={parse:iU,valid:cU,clean:lU,inc:dU,diff:fU,major:mU,minor:EU,patch:TU,prerelease:AU,compare:bU,rcompare:OU,compareLoose:CU,compareBuild:PU,sort:wU,rsort:xU,gt:kU,lt:$U,eq:jU,neq:HU,gte:FU,lte:qU,cmp:JU,coerce:s$,Comparator:p$(),Range:l$(),satisfies:h$,toComparators:_$,maxSatisfying:E$,minSatisfying:y$,minVersion:R$,validRange:N$,outside:U$,gtr:G$,ltr:V$,intersects:B$,simplifyRange:aG,subset:nG,SemVer:oG,re:rG.re,src:rG.src,tokens:rG.t,SEMVER_SPEC_VERSION:sG.SEMVER_SPEC_VERSION,RELEASE_TYPES:sG.RELEASE_TYPES,compareIdentifiers:iG.compareIdentifiers,rcompareIdentifiers:iG.rcompareIdentifiers};function uG(e){return"function"==typeof e}var lG=console.error.bind(console);function pG(e,t,n){var r=!!e[t]&&e.propertyIsEnumerable(t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}function dG(e){e&&e.logger&&(uG(e.logger)?lG=e.logger:lG("new logger isn't a function, not replacing"))}function hG(e,t,n){if(e&&e[t]){if(!n)return lG("no wrapper function"),void lG((new Error).stack);if(uG(e[t])&&uG(n)){var r=e[t],s=n(r,t);return pG(s,"__original",r),pG(s,"__unwrap",function(){e[t]===s&&pG(e,t,r)}),pG(s,"__wrapped",!0),pG(e,t,s),s}lG("original object and wrapper must be functions")}else lG("no original function "+t+" to wrap")}function fG(e,t){return e&&e[t]?e[t].__unwrap?e[t].__unwrap():void lG("no original to unwrap to -- has "+t+" already been unwrapped?"):(lG("no function to unwrap."),void lG((new Error).stack))}dG.wrap=hG,dG.massWrap=function(e,t,n){if(!e)return lG("must provide one or more modules to patch"),void lG((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){hG(e,t,n)})}):lG("must provide one or more functions to wrap on modules")},dG.unwrap=fG,dG.massUnwrap=function(e,t){if(!e)return lG("must provide one or more modules to patch"),void lG((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){fG(e,t)})}):lG("must provide one or more functions to unwrap on modules")};var _G=dG,mG=function(){return mG=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},mG.apply(this,arguments)},gG=function(){function e(e,t,n){this.instrumentationName=e,this.instrumentationVersion=t,this._config={},this._wrap=_G.wrap,this._unwrap=_G.unwrap,this._massWrap=_G.massWrap,this._massUnwrap=_G.massUnwrap,this.setConfig(n),this._diag=vt.createComponentLogger({namespace:e}),this._tracer=jt.getTracer(e,t),this._meter=Nt.getMeter(e,t),this._logger=jk.getLogger(e,t),this._updateMetricInstruments()}return Object.defineProperty(e.prototype,"meter",{get:function(){return this._meter},enumerable:!1,configurable:!0}),e.prototype.setMeterProvider=function(e){this._meter=e.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()},Object.defineProperty(e.prototype,"logger",{get:function(){return this._logger},enumerable:!1,configurable:!0}),e.prototype.setLoggerProvider=function(e){this._logger=e.getLogger(this.instrumentationName,this.instrumentationVersion)},e.prototype.getModuleDefinitions=function(){var e,t=null!==(e=this.init())&&void 0!==e?e:[];return Array.isArray(t)?t:[t]},e.prototype._updateMetricInstruments=function(){},e.prototype.getConfig=function(){return this._config},e.prototype.setConfig=function(e){this._config=mG({enabled:!0},e)},e.prototype.setTracerProvider=function(e){this._tracer=e.getTracer(this.instrumentationName,this.instrumentationVersion)},Object.defineProperty(e.prototype,"tracer",{get:function(){return this._tracer},enumerable:!1,configurable:!0}),e.prototype._runSpanCustomizationHook=function(e,t,n,r){if(e)try{e(n,r)}catch(e){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:t},e)}},e}(),EG=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},SG=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},TG=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},yG="/",AG=function(){this.hooks=[],this.children=new Map},vG=function(){function e(){this._trie=new AG,this._counter=0}return e.prototype.insert=function(e){var t,n,r=this._trie;try{for(var s=EG(e.moduleName.split(yG)),o=s.next();!o.done;o=s.next()){var i=o.value,a=r.children.get(i);a||(a=new AG,r.children.set(i,a)),r=a}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}r.hooks.push({hook:e,insertedId:this._counter++})},e.prototype.search=function(e,t){var n,r,s=void 0===t?{}:t,o=s.maintainInsertionOrder,i=s.fullOnly,a=this._trie,c=[],u=!0;try{for(var l=EG(e.split(yG)),p=l.next();!p.done;p=l.next()){var d=p.value,h=a.children.get(d);if(!h){u=!1;break}i||c.push.apply(c,TG([],SG(h.hooks),!1)),a=h}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return i&&u&&c.push.apply(c,TG([],SG(a.hooks),!1)),0===c.length?[]:1===c.length?[c[0].hook]:(o&&c.sort(function(e,t){return e.insertedId-t.insertedId}),c.map(function(e){return e.hook}))},e}(),bG=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},RG=["afterEach","after","beforeEach","before","describe","it"].every(function(e){return"function"==typeof global[e]}),OG=function(){function e(){this._moduleNameTrie=new vG,this._initialize()}return e.prototype._initialize=function(){var e=this;new YE(null,{internals:!0},function(t,n,r){var s,o,i,a=(i=n,C.sep!==yG?i.split(C.sep).join(yG):i),c=e._moduleNameTrie.search(a,{maintainInsertionOrder:!0,fullOnly:void 0===r});try{for(var u=bG(c),l=u.next();!l.done;l=u.next()){t=(0,l.value.onRequire)(t,n,r)}}catch(e){s={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}return t})},e.prototype.register=function(e,t){var n={moduleName:e,onRequire:t};return this._moduleNameTrie.insert(n),n},e.getInstance=function(){var t;return RG?new e:this._instance=null!==(t=this._instance)&&void 0!==t?t:new e},e}();var NG=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),CG=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},IG=function(t){function n(e,n,r){var o=t.call(this,e,n,r)||this;o._hooks=[],o._requireInTheMiddleSingleton=OG.getInstance(),o._enabled=!1,o._wrap=function(e,t,n){var r;if("function"==typeof(r=e[t])&&"function"==typeof r.__original&&"function"==typeof r.__unwrap&&!0===r.__wrapped&&o._unwrap(e,t),s.types.isProxy(e)){var i=_G.wrap(Object.assign({},e),t,n);return Object.defineProperty(e,t,{value:i}),i}return _G.wrap(e,t,n)},o._unwrap=function(e,t){return s.types.isProxy(e)?Object.defineProperty(e,t,{value:e[t]}):_G.unwrap(e,t)},o._massWrap=function(e,t,n){e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){o._wrap(e,t,n)})}):vt.error("must provide one or more functions to wrap on modules")):vt.error("must provide one or more modules to patch")},o._massUnwrap=function(e,t){e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){o._unwrap(e,t)})}):vt.error("must provide one or more functions to wrap on modules")):vt.error("must provide one or more modules to patch")};var i=o.init();return i&&!Array.isArray(i)&&(i=[i]),o._modules=i||[],o._config.enabled&&o.enable(),o}return NG(n,t),n.prototype._warnOnPreloadedModules=function(){var e=this;this._modules.forEach(function(t){var n=t.name;try{var r=require.resolve(n);require.cache[r]&&e._diag.warn("Module "+n+" has been loaded before "+e.instrumentationName+" so it might not work, please initialize it before requiring "+n)}catch(e){}})},n.prototype._extractPackageVersion=function(t){try{var n=e.readFileSync(C.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return"string"==typeof r?r:void 0}catch(e){vt.warn("Failed extracting version",t)}},n.prototype._onRequire=function(e,t,n,r){var s,o=this;if(!r)return"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:e.name}),e.patch(t)):t;var i=this._extractPackageVersion(r);if(e.moduleVersion=i,e.name===n)return PG(e.supportedVersions,i,e.includePrerelease)&&"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:e.name,version:e.moduleVersion,baseDir:r}),e.patch(t,e.moduleVersion)):t;var a=null!==(s=e.files)&&void 0!==s?s:[],c=C.normalize(n);return a.filter(function(e){return e.name===c}).filter(function(t){return PG(t.supportedVersions,i,e.includePrerelease)}).reduce(function(t,n){return n.moduleExports=t,o._enabled?(o._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:e.name,version:e.moduleVersion,fileName:n.name,baseDir:r}),n.patch(t,e.moduleVersion)):t},t)},n.prototype.enable=function(){var e,t,n,r,s,o,i=this;if(!this._enabled)if(this._enabled=!0,this._hooks.length>0)try{for(var a=CG(this._modules),c=a.next();!c.done;c=a.next()){var u=c.value;"function"==typeof u.patch&&u.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:u.name,version:u.moduleVersion}),u.patch(u.moduleExports,u.moduleVersion));try{for(var l=(n=void 0,CG(u.files)),p=l.next();!p.done;p=l.next()){var d=p.value;d.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:u.name,version:u.moduleVersion,fileName:d.name}),d.patch(d.moduleExports,u.moduleVersion))}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else{this._warnOnPreloadedModules();var h=function(e){var t=function(t,n,r){return i._onRequire(e,t,n,r)},n=C.isAbsolute(e.name)?new YE([e.name],{internals:!0},t):f._requireInTheMiddleSingleton.register(e.name,t);f._hooks.push(n);var r=new RS([e.name],{internals:!1},function(t,n,r){if(!r&&C.isAbsolute(n)){var s=C.parse(n);n=s.name,r=s.dir}return i._onRequire(e,t,n,r)});f._hooks.push(r)},f=this;try{for(var _=CG(this._modules),m=_.next();!m.done;m=_.next()){h(m.value)}}catch(e){s={error:e}}finally{try{m&&!m.done&&(o=_.return)&&o.call(_)}finally{if(s)throw s.error}}}},n.prototype.disable=function(){var e,t,n,r;if(this._enabled){this._enabled=!1;try{for(var s=CG(this._modules),o=s.next();!o.done;o=s.next()){var i=o.value;"function"==typeof i.unpatch&&i.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:i.name,version:i.moduleVersion}),i.unpatch(i.moduleExports,i.moduleVersion));try{for(var a=(n=void 0,CG(i.files)),c=a.next();!c.done;c=a.next()){var u=c.value;u.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:i.name,version:i.moduleVersion,fileName:u.name}),u.unpatch(u.moduleExports,i.moduleVersion))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}},n.prototype.isEnabled=function(){return this._enabled},n}(gG);function PG(e,t,n){return void 0===t?e.includes("*"):e.some(function(e){return cG.satisfies(t,e,{includePrerelease:n})})}var MG=function(e,t,n,r,s){this.name=e,this.supportedVersions=t,this.patch=n,this.unpatch=r,this.files=s||[]},wG="true"===process.env.PRISMA_SHOW_ALL_TRACES;var LG=class{tracerProvider;ignoreSpanTypes;constructor({tracerProvider:e,ignoreSpanTypes:t}){this.tracerProvider=e,this.ignoreSpanTypes=t}isEnabled(){return!0}getTraceParent(e){const t=jt.getSpanContext(e??At.active());return t?`00-${t.traceId}-${t.spanId}-0${t.traceFlags}`:"00-10-10-00"}dispatchEngineSpans(e){const t=this.tracerProvider.getTracer("prisma"),n=new Map,r=e.filter(e=>null===e.parentId);for(const s of r)xG(t,s,e,n,this.ignoreSpanTypes)}getActiveContext(){return At.active()}runInChildSpan(e,t){if("string"==typeof e&&(e={name:e}),e.internal&&!wG)return t();const n=this.tracerProvider.getTracer("prisma"),r=e.context??this.getActiveContext(),s=`prisma:client:${e.name}`;if(kG(s,this.ignoreSpanTypes))return t();if(!1===e.active){const o=n.startSpan(s,e,r);return DG(o,t(o,r))}return n.startActiveSpan(s,e,e=>DG(e,t(e,r)))}};function xG(e,t,n,r,s){if(kG(t.name,s))return;const o={attributes:t.attributes,kind:(i=t.kind,"client"===i?pt.CLIENT:pt.INTERNAL),startTime:t.startTime};var i;e.startActiveSpan(t.name,o,o=>{r.set(t.id,o.spanContext().spanId),t.links&&o.addLinks(t.links.flatMap(e=>{const t=r.get(e);return t?{context:{spanId:t,traceId:o.spanContext().traceId,traceFlags:o.spanContext().traceFlags}}:[]}));const i=n.filter(e=>e.parentId===t.id);for(const t of i)xG(e,t,n,r,s);o.end(t.endTime)})}function DG(e,t){return null!=(n=t)&&"function"==typeof n.then?t.then(t=>(e.end(),t),t=>{throw e.end(),t}):(e.end(),t);var n}function kG(e,t){return t.some(t=>"string"==typeof t?t===e:t.test(e))}var UG="@prisma/instrumentation",$G="6.14.0",GG=$G.split(".")[0],jG="PRISMA_INSTRUMENTATION",VG=`V${GG}_PRISMA_INSTRUMENTATION`,HG=UG,BG=class extends IG{tracerProvider;constructor(e={}){super(HG,$G,e)}setTracerProvider(e){this.tracerProvider=e}init(){return[new MG("@prisma/client",[$G])]}enable(){const e=this._config,t={helper:new LG({tracerProvider:this.tracerProvider??jt.getTracerProvider(),ignoreSpanTypes:e.ignoreSpanTypes??[]})};global[jG]=t,global[VG]=t}disable(){delete global[jG],delete global[VG]}isEnabled(){return Boolean(global[VG])}};const FG="Prisma";function YG(){const e=globalThis.PRISMA_INSTRUMENTATION;return e&&"object"==typeof e&&"helper"in e?e.helper:void 0}class qG extends BG{constructor(){super()}enable(){super.enable();const e=YG();let t=!1;var n;(n=e)&&"object"==typeof n&&"dispatchEngineSpans"in n&&(e.createEngineSpan=()=>{mT(()=>{t||(t=!0,console.warn("[Sentry] The Sentry SDK supports tracing with Prisma version 5 only with limited capabilities. For full tracing capabilities pass `prismaInstrumentation` for version 5 to the Sentry `prismaIntegration`. Read more: https://docs.sentry.io/platforms/javascript/guides/node/configuration/integrations/prisma/"))})})}}const KG=dO(FG,e=>e?.prismaInstrumentation?e.prismaInstrumentation:new qG),WG=({prismaInstrumentation:e}={})=>({name:FG,setupOnce(){KG({prismaInstrumentation:e})},setup(e){YG()&&e.on("spanStart",e=>{const t=mA(e);t.description?.startsWith("prisma:")&&e.setAttribute($y,"auto.db.otel.prisma"),"prisma:engine:db_query"===t.description&&t.data["db.query.text"]&&e.updateName(t.data["db.query.text"]),"prisma:engine:db_query"!==t.description||t.data["db.system"]||e.setAttribute("db.system","prisma")})}});var ZG={},XG={},zG={};Object.defineProperty(zG,"__esModule",{value:!0}),zG.PACKAGE_NAME=zG.PACKAGE_VERSION=void 0,zG.PACKAGE_VERSION="0.50.0",zG.PACKAGE_NAME="@opentelemetry/instrumentation-hapi";var QG={};Object.defineProperty(QG,"__esModule",{value:!0}),QG.HapiLifecycleMethodNames=QG.HapiLayerType=QG.handlerPatched=QG.HapiComponentName=void 0,QG.HapiComponentName="@hapi/hapi",QG.handlerPatched=Symbol("hapi-handler-patched"),QG.HapiLayerType={ROUTER:"router",PLUGIN:"plugin",EXT:"server.ext"},QG.HapiLifecycleMethodNames=new Set(["onPreAuth","onCredentials","onPostAuth","onPreHandler","onPostHandler","onPreResponse","onRequest"]);var JG={},ej={};Object.defineProperty(ej,"__esModule",{value:!0}),ej.ATTR_HTTP_METHOD=void 0,ej.ATTR_HTTP_METHOD="http.method";var tj={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.HAPI_TYPE="hapi.type",e.PLUGIN_NAME="hapi.plugin.name",e.EXT_TYPE="server.ext.type"}(e.AttributeNames||(e.AttributeNames={}))}(tj),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPluginFromInput=e.getExtMetadata=e.getRouteMetadata=e.isPatchableExtMethod=e.isDirectExtInput=e.isLifecycleExtEventObj=e.isLifecycleExtType=e.getPluginName=void 0;const t=kS,n=ej,r=QG,s=tj,o=DS;e.getPluginName=function(e){return e.name?e.name:e.pkg.name};e.isLifecycleExtType=e=>"string"==typeof e&&r.HapiLifecycleMethodNames.has(e);e.isLifecycleExtEventObj=t=>{const n=t?.type;return void 0!==n&&(0,e.isLifecycleExtType)(n)};e.isDirectExtInput=t=>Array.isArray(t)&&t.length<=3&&(0,e.isLifecycleExtType)(t[0])&&"function"==typeof t[1];e.isPatchableExtMethod=e=>!Array.isArray(e);e.getRouteMetadata=(e,i,a)=>{const c={[t.ATTR_HTTP_ROUTE]:e.path};let u;return i&o.SemconvStability.OLD&&(c[n.ATTR_HTTP_METHOD]=e.method),i&o.SemconvStability.STABLE&&(c[t.ATTR_HTTP_REQUEST_METHOD]=e.method),a?(c[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.PLUGIN,c[s.AttributeNames.PLUGIN_NAME]=a,u=`${a}: route - ${e.path}`):(c[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.ROUTER,u=`route - ${e.path}`),{attributes:c,name:u}};e.getExtMetadata=(e,t)=>t?{attributes:{[s.AttributeNames.EXT_TYPE]:e,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT,[s.AttributeNames.PLUGIN_NAME]:t},name:`${t}: ext - ${e}`}:{attributes:{[s.AttributeNames.EXT_TYPE]:e,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT},name:`ext - ${e}`};e.getPluginFromInput=e=>"plugin"in e?"plugin"in e.plugin?e.plugin.plugin:e.plugin:e}(JG),Object.defineProperty(XG,"__esModule",{value:!0}),XG.HapiInstrumentation=void 0;const nj=qt,rj=Qm,sj=DS,oj=zG,ij=QG,aj=JG;class cj extends sj.InstrumentationBase{_semconvStability;constructor(e={}){super(oj.PACKAGE_NAME,oj.PACKAGE_VERSION,e),this._semconvStability=(0,sj.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return new sj.InstrumentationNodeModuleDefinition(ij.HapiComponentName,[">=17.0.0 <22"],e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;return(0,sj.isWrapped)(t.server)||this._wrap(t,"server",this._getServerPatch.bind(this)),(0,sj.isWrapped)(t.Server)||this._wrap(t,"Server",this._getServerPatch.bind(this)),t},e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;this._massUnwrap([t],["server","Server"])})}_getServerPatch(e){const t=this,n=this;return function(r){const s=e.apply(this,[r]);return n._wrap(s,"route",e=>t._getServerRoutePatch.bind(t)(e)),n._wrap(s,"ext",e=>t._getServerExtPatch.bind(t)(e)),n._wrap(s,"register",t._getServerRegisterPatch.bind(t)),s}}_getServerRegisterPatch(e){const t=this;return function(n,r){if(Array.isArray(n))for(const e of n){const n=(0,aj.getPluginFromInput)(e);t._wrapRegisterHandler(n)}else{const e=(0,aj.getPluginFromInput)(n);t._wrapRegisterHandler(e)}return e.apply(this,[n,r])}}_getServerExtPatch(e,t){const n=this;return function(...r){if(Array.isArray(r[0])){const s=r[0];for(let e=0;e<s.length;e++){const r=s[e];if((0,aj.isLifecycleExtType)(r.type)){const o=r,i=n._wrapExtMethods(o.method,r.type,t);o.method=i,s[e]=o}}return e.apply(this,r)}if((0,aj.isDirectExtInput)(r)){const s=r,o=s[1],i=n._wrapExtMethods(o,s[0],t);return e.apply(this,[s[0],i,s[2]])}if((0,aj.isLifecycleExtEventObj)(r[0])){const s=r[0],o=n._wrapExtMethods(s.method,s.type,t);return s.method=o,e.call(this,s)}return e.apply(this,r)}}_getServerRoutePatch(e,t){const n=this;return function(r){if(Array.isArray(r))for(let e=0;e<r.length;e++){const s=n._wrapRouteHandler.call(n,r[e],t);r[e]=s}else r=n._wrapRouteHandler.call(n,r,t);return e.apply(this,[r])}}_wrapRegisterHandler(e){const t=this,n=(0,aj.getPluginName)(e),r=e.register,s=this;e.register=function(e,o){return s._wrap(e,"route",e=>t._getServerRoutePatch.bind(t)(e,n)),s._wrap(e,"ext",e=>t._getServerExtPatch.bind(t)(e,n)),r.call(this,e,o)}}_wrapExtMethods(e,t,n){const r=this;if(e instanceof Array){for(let n=0;n<e.length;n++)e[n]=r._wrapExtMethods(e[n],t);return e}if((0,aj.isPatchableExtMethod)(e)){if(!0===e[ij.handlerPatched])return e;e[ij.handlerPatched]=!0;return async function(...s){if(void 0===nj.trace.getSpan(nj.context.active()))return await e.apply(this,s);const o=(0,aj.getExtMetadata)(t,n),i=r.tracer.startSpan(o.name,{attributes:o.attributes});try{return await nj.context.with(nj.trace.setSpan(nj.context.active(),i),e,void 0,...s)}catch(e){throw i.recordException(e),i.setStatus({code:nj.SpanStatusCode.ERROR,message:e.message}),e}finally{i.end()}}}return e}_wrapRouteHandler(e,t){const n=this;if(!0===e[ij.handlerPatched])return e;e[ij.handlerPatched]=!0;const r=r=>async function(...s){if(void 0===nj.trace.getSpan(nj.context.active()))return await r.call(this,...s);const o=(0,rj.getRPCMetadata)(nj.context.active());o?.type===rj.RPCType.HTTP&&(o.route=e.path);const i=(0,aj.getRouteMetadata)(e,n._semconvStability,t),a=n.tracer.startSpan(i.name,{attributes:i.attributes});try{return await nj.context.with(nj.trace.setSpan(nj.context.active(),a),()=>r.call(this,...s))}catch(e){throw a.recordException(e),a.setStatus({code:nj.SpanStatusCode.ERROR,message:e.message}),e}finally{a.end()}};if("function"==typeof e.handler)e.handler=r(e.handler);else if("function"==typeof e.options){const t=e.options;e.options=function(e){const n=t(e);return"function"==typeof n.handler&&(n.handler=r(n.handler)),n}}else"function"==typeof e.options?.handler&&(e.options.handler=r(e.options.handler));return e}}XG.HapiInstrumentation=cj,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.HapiInstrumentation=void 0;var t=XG;Object.defineProperty(e,"HapiInstrumentation",{enumerable:!0,get:function(){return t.HapiInstrumentation}});var n=tj;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})}(ZG);const uj="Hapi",lj=dO(uj,()=>new ZG.HapiInstrumentation),pj=()=>({name:uj,setupOnce(){lj()}});var dj={},hj={},fj={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=void 0,(t=e.KoaLayerType||(e.KoaLayerType={})).ROUTER="router",t.MIDDLEWARE="middleware"}(fj);var _j={};Object.defineProperty(_j,"__esModule",{value:!0}),_j.PACKAGE_NAME=_j.PACKAGE_VERSION=void 0,_j.PACKAGE_VERSION="0.51.0",_j.PACKAGE_NAME="@opentelemetry/instrumentation-koa";var mj={},gj={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.KOA_TYPE="koa.type",e.KOA_NAME="koa.name"}(e.AttributeNames||(e.AttributeNames={}))}(gj),Object.defineProperty(mj,"__esModule",{value:!0}),mj.isLayerIgnored=mj.getMiddlewareMetadata=void 0;const Ej=fj,Sj=gj,Tj=kS;mj.getMiddlewareMetadata=(e,t,n,r)=>n?{attributes:{[Sj.AttributeNames.KOA_NAME]:r?.toString(),[Sj.AttributeNames.KOA_TYPE]:Ej.KoaLayerType.ROUTER,[Tj.SEMATTRS_HTTP_ROUTE]:r?.toString()},name:e._matchedRouteName||`router - ${r}`}:{attributes:{[Sj.AttributeNames.KOA_NAME]:t.name??"middleware",[Sj.AttributeNames.KOA_TYPE]:Ej.KoaLayerType.MIDDLEWARE},name:`middleware - ${t.name}`};mj.isLayerIgnored=(e,t)=>!(!Array.isArray(t?.ignoreLayersType)||!t?.ignoreLayersType?.includes(e));var yj={};Object.defineProperty(yj,"__esModule",{value:!0}),yj.kLayerPatched=void 0,yj.kLayerPatched=Symbol("koa-layer-patched"),Object.defineProperty(hj,"__esModule",{value:!0}),hj.KoaInstrumentation=void 0;const Aj=qt,vj=DS,bj=fj,Rj=_j,Oj=mj,Nj=Qm,Cj=yj;class Ij extends vj.InstrumentationBase{constructor(e={}){super(Rj.PACKAGE_NAME,Rj.PACKAGE_VERSION,e)}init(){return new vj.InstrumentationNodeModuleDefinition("koa",[">=2.0.0 <3"],e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;return null==t?t:((0,vj.isWrapped)(t.prototype.use)&&this._unwrap(t.prototype,"use"),this._wrap(t.prototype,"use",this._getKoaUsePatch.bind(this)),e)},e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;(0,vj.isWrapped)(t.prototype.use)&&this._unwrap(t.prototype,"use")})}_getKoaUsePatch(e){const t=this;return function(n){let r;return r=n.router?t._patchRouterDispatch(n):t._patchLayer(n,!1),e.apply(this,[r])}}_patchRouterDispatch(e){Aj.diag.debug("Patching @koa/router dispatch");const t=e.router,n=t?.stack??[];for(const e of n){const t=e.path,n=e.stack;for(let e=0;e<n.length;e++){const r=n[e];n[e]=this._patchLayer(r,!0,t)}}return e}_patchLayer(e,t,n){const r=t?bj.KoaLayerType.ROUTER:bj.KoaLayerType.MIDDLEWARE;return!0===e[Cj.kLayerPatched]||(0,Oj.isLayerIgnored)(r,this.getConfig())?e:"GeneratorFunction"===e.constructor.name||"AsyncGeneratorFunction"===e.constructor.name?(Aj.diag.debug("ignoring generator-based Koa middleware layer"),e):(e[Cj.kLayerPatched]=!0,Aj.diag.debug("patching Koa middleware layer"),async(s,o)=>{if(void 0===Aj.trace.getSpan(Aj.context.active()))return e(s,o);const i=(0,Oj.getMiddlewareMetadata)(s,e,t,n),a=this.tracer.startSpan(i.name,{attributes:i.attributes}),c=(0,Nj.getRPCMetadata)(Aj.context.active());c?.type===Nj.RPCType.HTTP&&s._matchedRoute&&(c.route=s._matchedRoute.toString());const{requestHook:u}=this.getConfig();u&&(0,vj.safeExecuteInTheMiddle)(()=>u(a,{context:s,middlewareLayer:e,layerType:r}),e=>{e&&Aj.diag.error("koa instrumentation: request hook failed",e)},!0);const l=Aj.trace.setSpan(Aj.context.active(),a);return Aj.context.with(l,async()=>{try{return await e(s,o)}catch(e){throw a.recordException(e),e}finally{a.end()}})})}}hj.KoaInstrumentation=Ij,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=e.AttributeNames=e.KoaInstrumentation=void 0;var t=hj;Object.defineProperty(e,"KoaInstrumentation",{enumerable:!0,get:function(){return t.KoaInstrumentation}});var n=gj;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}});var r=fj;Object.defineProperty(e,"KoaLayerType",{enumerable:!0,get:function(){return r.KoaLayerType}})}(dj);const Pj=dO("Koa",dj.KoaInstrumentation,(e={})=>({ignoreLayersType:e.ignoreLayersType,requestHook(e,t){VI(e,"auto.http.otel.koa");const n=mA(e).data,r=n["koa.type"];r&&e.setAttribute(Uy,`${r}.koa`);const s=n["koa.name"];if("string"==typeof s&&e.updateName(s||"< unknown >"),My()===vy())return void(OP&&TT.warn("Isolation scope is default isolation scope - skipping setting transactionName"));const o=n[q_],i=t.context?.request?.method?.toUpperCase()||"GET";o&&My().setTransactionName(`${i} ${o}`)}})),Mj=(e={})=>({name:"Koa",setupOnce(){Pj(e)}});var wj={},Lj={},xj={};!function(e){var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectNames=e.ConnectTypes=e.AttributeNames=void 0,function(e){e.CONNECT_TYPE="connect.type",e.CONNECT_NAME="connect.name"}(e.AttributeNames||(e.AttributeNames={})),(t=e.ConnectTypes||(e.ConnectTypes={})).MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler",(n=e.ConnectNames||(e.ConnectNames={})).MIDDLEWARE="middleware",n.REQUEST_HANDLER="request handler"}(xj);var Dj={};Object.defineProperty(Dj,"__esModule",{value:!0}),Dj.PACKAGE_NAME=Dj.PACKAGE_VERSION=void 0,Dj.PACKAGE_VERSION="0.47.0",Dj.PACKAGE_NAME="@opentelemetry/instrumentation-connect";var kj={},Uj={};Object.defineProperty(Uj,"__esModule",{value:!0}),Uj._LAYERS_STORE_PROPERTY=void 0,Uj._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack"),Object.defineProperty(kj,"__esModule",{value:!0}),kj.generateRoute=kj.replaceCurrentStackRoute=kj.addNewStackLayer=void 0;const $j=qt,Gj=Uj;kj.addNewStackLayer=e=>{!1===Array.isArray(e[Gj._LAYERS_STORE_PROPERTY])&&Object.defineProperty(e,Gj._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),e[Gj._LAYERS_STORE_PROPERTY].push("/");const t=e[Gj._LAYERS_STORE_PROPERTY].length;return()=>{t===e[Gj._LAYERS_STORE_PROPERTY].length?e[Gj._LAYERS_STORE_PROPERTY].pop():$j.diag.warn("Connect: Trying to pop the stack multiple time")}};kj.replaceCurrentStackRoute=(e,t)=>{t&&e[Gj._LAYERS_STORE_PROPERTY].splice(-1,1,t)};kj.generateRoute=e=>e[Gj._LAYERS_STORE_PROPERTY].reduce((e,t)=>e.replace(/\/+$/,"")+t),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectInstrumentation=e.ANONYMOUS_NAME=void 0;const t=qt,n=Qm,r=xj,s=Dj,o=DS,i=kS,a=kj;e.ANONYMOUS_NAME="anonymous";class c extends o.InstrumentationBase{constructor(e={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,e)}init(){return[new o.InstrumentationNodeModuleDefinition("connect",[">=3.0.0 <4"],e=>this._patchConstructor(e))]}_patchApp(e){(0,o.isWrapped)(e.use)||this._wrap(e,"use",this._patchUse.bind(this)),(0,o.isWrapped)(e.handle)||this._wrap(e,"handle",this._patchHandle.bind(this))}_patchConstructor(e){const t=this;return function(...n){const r=e.apply(this,n);return t._patchApp(r),r}}_patchNext(e,t){return function(n){const r=e.apply(this,[n]);return t(),r}}_startSpan(t,n){let s,o,a;t?(s=r.ConnectTypes.REQUEST_HANDLER,a=r.ConnectNames.REQUEST_HANDLER,o=t):(s=r.ConnectTypes.MIDDLEWARE,a=r.ConnectNames.MIDDLEWARE,o=n.name||e.ANONYMOUS_NAME);const c=`${a} - ${o}`,u={attributes:{[i.ATTR_HTTP_ROUTE]:t.length>0?t:"/",[r.AttributeNames.CONNECT_TYPE]:s,[r.AttributeNames.CONNECT_NAME]:o}};return this.tracer.startSpan(c,u)}_patchMiddleware(r,s){const o=this,i=4===s.length;function c(){if(!o.isEnabled())return s.apply(this,arguments);const[c,u,l]=i?[1,2,3]:[0,1,2],p=arguments[c],d=arguments[u],h=arguments[l];(0,a.replaceCurrentStackRoute)(p,r);const f=(0,n.getRPCMetadata)(t.context.active());r&&f?.type===n.RPCType.HTTP&&(f.route=(0,a.generateRoute)(p));let _="";_=r?`request handler - ${r}`:`middleware - ${s.name||e.ANONYMOUS_NAME}`;const m=o._startSpan(r,s);o._diag.debug("start span",_);let g=!1;function E(){g?o._diag.debug(`span ${m.name} - already finished`):(g=!0,o._diag.debug(`finishing span ${m.name}`),m.end()),d.removeListener("close",E)}return d.addListener("close",E),arguments[l]=o._patchNext(h,E),s.apply(this,arguments)}return Object.defineProperty(c,"length",{value:s.length,writable:!1,configurable:!0}),c}_patchUse(e){const t=this;return function(...n){const r=n[n.length-1],s=n[n.length-2]||"";return n[n.length-1]=t._patchMiddleware(s,r),e.apply(this,n)}}_patchHandle(e){const t=this;return function(){const[n,r]=[0,2],s=arguments[n],o=arguments[r],i=(0,a.addNewStackLayer)(s);return"function"==typeof o&&(arguments[r]=t._patchOut(o,i)),e.apply(this,arguments)}}_patchOut(e,t){return function(...n){return t(),Reflect.apply(e,this,n)}}}e.ConnectInstrumentation=c}(Lj),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectTypes=e.ConnectNames=e.AttributeNames=e.ANONYMOUS_NAME=e.ConnectInstrumentation=void 0;var t=Lj;Object.defineProperty(e,"ConnectInstrumentation",{enumerable:!0,get:function(){return t.ConnectInstrumentation}}),Object.defineProperty(e,"ANONYMOUS_NAME",{enumerable:!0,get:function(){return t.ANONYMOUS_NAME}});var n=xj;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}}),Object.defineProperty(e,"ConnectNames",{enumerable:!0,get:function(){return n.ConnectNames}}),Object.defineProperty(e,"ConnectTypes",{enumerable:!0,get:function(){return n.ConnectTypes}})}(wj);const jj="Connect",Vj=dO(jj,()=>new wj.ConnectInstrumentation),Hj=()=>({name:jj,setupOnce(){Vj()}});var Bj={},Fj={},Yj={};Object.defineProperty(Yj,"__esModule",{value:!0}),Yj.once=Yj.getSpanName=void 0,Yj.getSpanName=function(e,t,n,r){return"execBulkLoad"===e&&r&&t?`${e} ${r} ${t}`:"callProcedure"===e?t?`${e} ${n} ${t}`:`${e} ${n}`:t?`${e} ${t}`:`${e}`};Yj.once=e=>{let t=!1;return(...n)=>{if(!t)return t=!0,e(...n)}};var qj={};Object.defineProperty(qj,"__esModule",{value:!0}),qj.PACKAGE_NAME=qj.PACKAGE_VERSION=void 0,qj.PACKAGE_VERSION="0.22.0",qj.PACKAGE_NAME="@opentelemetry/instrumentation-tedious",Object.defineProperty(Fj,"__esModule",{value:!0}),Fj.TediousInstrumentation=void 0;const Kj=qt,Wj=l,Zj=DS,Xj=kS,zj=Yj,Qj=qj,Jj=Symbol("opentelemetry.instrumentation-tedious.current-database"),eV=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function tV(e){Object.defineProperty(this,Jj,{value:e,writable:!0})}class nV extends Zj.InstrumentationBase{static COMPONENT="tedious";constructor(e={}){super(Qj.PACKAGE_NAME,Qj.PACKAGE_VERSION,e)}init(){return[new Zj.InstrumentationNodeModuleDefinition(nV.COMPONENT,[">=1.11.0 <20"],e=>{const t=e.Connection.prototype;for(const e of eV)(0,Zj.isWrapped)(t[e])&&this._unwrap(t,e),this._wrap(t,e,this._patchQuery(e));return(0,Zj.isWrapped)(t.connect)&&this._unwrap(t,"connect"),this._wrap(t,"connect",this._patchConnect),e},e=>{if(void 0===e)return;const t=e.Connection.prototype;for(const e of eV)this._unwrap(t,e);this._unwrap(t,"connect")})]}_patchConnect(e){return function(){return tV.call(this,this.config?.options?.database),this.removeListener("databaseChange",tV),this.on("databaseChange",tV),this.once("end",()=>{this.removeListener("databaseChange",tV)}),e.apply(this,arguments)}}_patchQuery(e){return t=>{const n=this;function r(r){if(!(r instanceof Wj.EventEmitter))return n._diag.warn(`Unexpected invocation of patched ${e} method. Span not recorded`),t.apply(this,arguments);let s=0,o=0;const i=()=>o++,a=()=>s++,c=this[Jj],u=(e=>"sp_prepare"===e.sqlTextOrProcedure&&e.parametersByName?.stmt?.value?e.parametersByName.stmt.value:e.sqlTextOrProcedure)(r),l=n.tracer.startSpan((0,zj.getSpanName)(e,c,u,r.table),{kind:Kj.SpanKind.CLIENT,attributes:{[Xj.SEMATTRS_DB_SYSTEM]:Xj.DBSYSTEMVALUES_MSSQL,[Xj.SEMATTRS_DB_NAME]:c,[Xj.SEMATTRS_NET_PEER_PORT]:this.config?.options?.port,[Xj.SEMATTRS_NET_PEER_NAME]:this.config?.server,[Xj.SEMATTRS_DB_USER]:this.config?.userName??this.config?.authentication?.options?.userName,[Xj.SEMATTRS_DB_STATEMENT]:u,[Xj.SEMATTRS_DB_SQL_TABLE]:r.table}}),p=(0,zj.once)(e=>{r.removeListener("done",i),r.removeListener("doneInProc",i),r.removeListener("doneProc",a),r.removeListener("error",p),this.removeListener("end",p),l.setAttribute("tedious.procedure_count",s),l.setAttribute("tedious.statement_count",o),e&&l.setStatus({code:Kj.SpanStatusCode.ERROR,message:e.message}),l.end()});return r.on("done",i),r.on("doneInProc",i),r.on("doneProc",a),r.once("error",p),this.on("end",p),"function"==typeof r.callback?n._wrap(r,"callback",n._patchCallbackQuery(p)):n._diag.error("Expected request.callback to be a function"),Kj.context.with(Kj.trace.setSpan(Kj.context.active(),l),t,this,...arguments)}return Object.defineProperty(r,"length",{value:t.length,writable:!1}),r}}_patchCallbackQuery(e){return t=>function(n,r,s){return e(n),t.apply(this,arguments)}}}Fj.TediousInstrumentation=nV,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=void 0;var t=Fj;Object.defineProperty(e,"TediousInstrumentation",{enumerable:!0,get:function(){return t.TediousInstrumentation}})}(Bj);const rV=new Set(["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"]),sV="Tedious",oV=dO(sV,()=>new Bj.TediousInstrumentation({})),iV=()=>{let e;return{name:sV,setupOnce(){const t=oV();e=hO(t)},setup(t){e?.(()=>t.on("spanStart",e=>{const{description:t,data:n}=mA(e);if(!t||"mssql"!==n["db.system"])return;const r=t.split(" ")[0]||"";rV.has(r)&&e.setAttribute($y,"auto.db.otel.tedious")}))}}};var aV={},cV={},uV={};Object.defineProperty(uV,"__esModule",{value:!0}),uV.PACKAGE_NAME=uV.PACKAGE_VERSION=void 0,uV.PACKAGE_VERSION="0.47.0",uV.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool",Object.defineProperty(cV,"__esModule",{value:!0}),cV.GenericPoolInstrumentation=void 0;const lV=qt,pV=DS,dV=uV,hV="generic-pool";class fV extends pV.InstrumentationBase{_isDisabled=!1;constructor(e={}){super(dV.PACKAGE_NAME,dV.PACKAGE_VERSION,e)}init(){return[new pV.InstrumentationNodeModuleDefinition(hV,[">=3.0.0 <4"],e=>{const t=e.Pool;return(0,pV.isWrapped)(t.prototype.acquire)&&this._unwrap(t.prototype,"acquire"),this._wrap(t.prototype,"acquire",this._acquirePatcher.bind(this)),e},e=>{const t=e.Pool;return this._unwrap(t.prototype,"acquire"),e}),new pV.InstrumentationNodeModuleDefinition(hV,[">=2.4.0 <3"],e=>{const t=e.Pool;return(0,pV.isWrapped)(t.prototype.acquire)&&this._unwrap(t.prototype,"acquire"),this._wrap(t.prototype,"acquire",this._acquireWithCallbacksPatcher.bind(this)),e},e=>{const t=e.Pool;return this._unwrap(t.prototype,"acquire"),e}),new pV.InstrumentationNodeModuleDefinition(hV,[">=2.0.0 <2.4"],e=>(this._isDisabled=!1,(0,pV.isWrapped)(e.Pool)&&this._unwrap(e,"Pool"),this._wrap(e,"Pool",this._poolWrapper.bind(this)),e),e=>(this._isDisabled=!0,e))]}_acquirePatcher(e){const t=this;return function(...n){const r=lV.context.active(),s=t.tracer.startSpan("generic-pool.acquire",{},r);return lV.context.with(lV.trace.setSpan(r,s),()=>e.call(this,...n).then(e=>(s.end(),e),e=>{throw s.recordException(e),s.end(),e}))}}_poolWrapper(e){const t=this;return function(){const n=e.apply(this,arguments);return t._wrap(n,"acquire",t._acquireWithCallbacksPatcher.bind(t)),n}}_acquireWithCallbacksPatcher(e){const t=this;return function(n,r){if(t._isDisabled)return e.call(this,n,r);const s=lV.context.active(),o=t.tracer.startSpan("generic-pool.acquire",{},s);return lV.context.with(lV.trace.setSpan(s,o),()=>{e.call(this,(e,t)=>{if(o.end(),n)return n(e,t)},r)})}}}cV.GenericPoolInstrumentation=fV,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenericPoolInstrumentation=void 0;var t=cV;Object.defineProperty(e,"GenericPoolInstrumentation",{enumerable:!0,get:function(){return t.GenericPoolInstrumentation}})}(aV);const _V="GenericPool",mV=dO(_V,()=>new aV.GenericPoolInstrumentation({})),gV=()=>{let e;return{name:_V,setupOnce(){const t=mV();e=hO(t)},setup(t){e?.(()=>t.on("spanStart",e=>{const t=mA(e).description;("generic-pool.aquire"===t||"generic-pool.acquire"===t)&&e.setAttribute($y,"auto.db.otel.generic_pool")}))}}};var EV={},SV={},TV={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CONFIG=e.EndOperation=void 0,(t=e.EndOperation||(e.EndOperation={})).AutoAck="auto ack",t.Ack="ack",t.AckAll="ackAll",t.Reject="reject",t.Nack="nack",t.NackAll="nackAll",t.ChannelClosed="channel closed",t.ChannelError="channel error",t.InstrumentationTimeout="instrumentation timeout",e.DEFAULT_CONFIG={consumeTimeoutMs:6e4,useLinksForConsume:!1}}(TV);var yV={};Object.defineProperty(yV,"__esModule",{value:!0}),yV.isConfirmChannelTracing=yV.unmarkConfirmChannelTracing=yV.markConfirmChannelTracing=yV.getConnectionAttributesFromUrl=yV.getConnectionAttributesFromServer=yV.normalizeExchange=yV.CONNECTION_ATTRIBUTES=yV.CHANNEL_CONSUME_TIMEOUT_TIMER=yV.CHANNEL_SPANS_NOT_ENDED=yV.MESSAGE_STORED_SPAN=void 0;const AV=qt,vV=kS;yV.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span"),yV.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended"),yV.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer"),yV.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");const bV=(0,AV.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel");yV.normalizeExchange=e=>""!==e?e:"<default>";const RV=(e,t)=>e||("AMQP"===t?5672:5671),OV=e=>{const t=e||"amqp";return(t.endsWith(":")?t.substring(0,t.length-1):t).toUpperCase()},NV=e=>e||"localhost",CV=(e,t,n,r)=>n?{[t]:n}:(AV.diag.error(`amqplib instrumentation: could not extract connection attribute ${r} from user supplied url`,{url:e}),{});yV.getConnectionAttributesFromServer=e=>{const t=e.serverProperties.product?.toLowerCase?.();return t?{[vV.SEMATTRS_MESSAGING_SYSTEM]:t}:{}};yV.getConnectionAttributesFromUrl=e=>{const t={[vV.SEMATTRS_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if("object"==typeof(e=e||"amqp://localhost")){const n=e,r=OV(n?.protocol);Object.assign(t,{...CV(e,vV.SEMATTRS_MESSAGING_PROTOCOL,r,"protocol")});const s=NV(n?.hostname);Object.assign(t,{...CV(e,vV.SEMATTRS_NET_PEER_NAME,s,"hostname")});const o=RV(n.port,r);Object.assign(t,{...CV(e,vV.SEMATTRS_NET_PEER_PORT,o,"port")})}else{const n=(e=>e.replace(/:[^:@/]*@/,":***@"))(e);t[vV.SEMATTRS_MESSAGING_URL]=n;try{const e=new URL(n),r=OV(e.protocol);Object.assign(t,{...CV(n,vV.SEMATTRS_MESSAGING_PROTOCOL,r,"protocol")});const s=NV(e.hostname);Object.assign(t,{...CV(n,vV.SEMATTRS_NET_PEER_NAME,s,"hostname")});const o=RV(e.port?parseInt(e.port):void 0,r);Object.assign(t,{...CV(n,vV.SEMATTRS_NET_PEER_PORT,o,"port")})}catch(e){AV.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:n,err:e})}}return t};yV.markConfirmChannelTracing=e=>e.setValue(bV,!0);yV.unmarkConfirmChannelTracing=e=>e.deleteValue(bV);yV.isConfirmChannelTracing=e=>!0===e.getValue(bV);var IV={};Object.defineProperty(IV,"__esModule",{value:!0}),IV.PACKAGE_NAME=IV.PACKAGE_VERSION=void 0,IV.PACKAGE_VERSION="0.50.0",IV.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib",Object.defineProperty(SV,"__esModule",{value:!0}),SV.AmqplibInstrumentation=void 0;const PV=qt,MV=Qm,wV=DS,LV=kS,xV=TV,DV=yV,kV=IV,UV=[">=0.5.5 <1"];class $V extends wV.InstrumentationBase{constructor(e={}){super(kV.PACKAGE_NAME,kV.PACKAGE_VERSION,{...xV.DEFAULT_CONFIG,...e})}setConfig(e={}){super.setConfig({...xV.DEFAULT_CONFIG,...e})}init(){const e=new wV.InstrumentationNodeModuleFile("amqplib/lib/channel_model.js",UV,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),t=new wV.InstrumentationNodeModuleFile("amqplib/lib/callback_model.js",UV,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),n=new wV.InstrumentationNodeModuleFile("amqplib/lib/connect.js",UV,this.patchConnect.bind(this),this.unpatchConnect.bind(this));return new wV.InstrumentationNodeModuleDefinition("amqplib",UV,void 0,void 0,[e,n,t])}patchConnect(e){return e=this.unpatchConnect(e),(0,wV.isWrapped)(e.connect)||this._wrap(e,"connect",this.getConnectPatch.bind(this)),e}unpatchConnect(e){return(0,wV.isWrapped)(e.connect)&&this._unwrap(e,"connect"),e}patchChannelModel(e,t){return(0,wV.isWrapped)(e.Channel.prototype.publish)||this._wrap(e.Channel.prototype,"publish",this.getPublishPatch.bind(this,t)),(0,wV.isWrapped)(e.Channel.prototype.consume)||this._wrap(e.Channel.prototype,"consume",this.getConsumePatch.bind(this,t)),(0,wV.isWrapped)(e.Channel.prototype.ack)||this._wrap(e.Channel.prototype,"ack",this.getAckPatch.bind(this,!1,xV.EndOperation.Ack)),(0,wV.isWrapped)(e.Channel.prototype.nack)||this._wrap(e.Channel.prototype,"nack",this.getAckPatch.bind(this,!0,xV.EndOperation.Nack)),(0,wV.isWrapped)(e.Channel.prototype.reject)||this._wrap(e.Channel.prototype,"reject",this.getAckPatch.bind(this,!0,xV.EndOperation.Reject)),(0,wV.isWrapped)(e.Channel.prototype.ackAll)||this._wrap(e.Channel.prototype,"ackAll",this.getAckAllPatch.bind(this,!1,xV.EndOperation.AckAll)),(0,wV.isWrapped)(e.Channel.prototype.nackAll)||this._wrap(e.Channel.prototype,"nackAll",this.getAckAllPatch.bind(this,!0,xV.EndOperation.NackAll)),(0,wV.isWrapped)(e.Channel.prototype.emit)||this._wrap(e.Channel.prototype,"emit",this.getChannelEmitPatch.bind(this)),(0,wV.isWrapped)(e.ConfirmChannel.prototype.publish)||this._wrap(e.ConfirmChannel.prototype,"publish",this.getConfirmedPublishPatch.bind(this,t)),e}unpatchChannelModel(e){return(0,wV.isWrapped)(e.Channel.prototype.publish)&&this._unwrap(e.Channel.prototype,"publish"),(0,wV.isWrapped)(e.Channel.prototype.consume)&&this._unwrap(e.Channel.prototype,"consume"),(0,wV.isWrapped)(e.Channel.prototype.ack)&&this._unwrap(e.Channel.prototype,"ack"),(0,wV.isWrapped)(e.Channel.prototype.nack)&&this._unwrap(e.Channel.prototype,"nack"),(0,wV.isWrapped)(e.Channel.prototype.reject)&&this._unwrap(e.Channel.prototype,"reject"),(0,wV.isWrapped)(e.Channel.prototype.ackAll)&&this._unwrap(e.Channel.prototype,"ackAll"),(0,wV.isWrapped)(e.Channel.prototype.nackAll)&&this._unwrap(e.Channel.prototype,"nackAll"),(0,wV.isWrapped)(e.Channel.prototype.emit)&&this._unwrap(e.Channel.prototype,"emit"),(0,wV.isWrapped)(e.ConfirmChannel.prototype.publish)&&this._unwrap(e.ConfirmChannel.prototype,"publish"),e}getConnectPatch(e){return function(t,n,r){return e.call(this,t,n,function(e,n){if(null==e){const e=(0,DV.getConnectionAttributesFromUrl)(t),r=(0,DV.getConnectionAttributesFromServer)(n);n[DV.CONNECTION_ATTRIBUTES]={...e,...r}}r.apply(this,arguments)})}}getChannelEmitPatch(e){const t=this;return function(n){if("close"===n){t.endAllSpansOnChannel(this,!0,xV.EndOperation.ChannelClosed,void 0);const e=this[DV.CHANNEL_CONSUME_TIMEOUT_TIMER];e&&clearInterval(e),this[DV.CHANNEL_CONSUME_TIMEOUT_TIMER]=void 0}else"error"===n&&t.endAllSpansOnChannel(this,!0,xV.EndOperation.ChannelError,void 0);return e.apply(this,arguments)}}getAckAllPatch(e,t,n){const r=this;return function(s){return r.endAllSpansOnChannel(this,e,t,s),n.apply(this,arguments)}}getAckPatch(e,t,n){const r=this;return function(s,o,i){const a=t===xV.EndOperation.Reject?o:i,c=this[DV.CHANNEL_SPANS_NOT_ENDED]??[],u=c.findIndex(e=>e.msg===s);if(u<0)r.endConsumerSpan(s,e,t,a);else if(t!==xV.EndOperation.Reject&&o){for(let n=0;n<=u;n++)r.endConsumerSpan(c[n].msg,e,t,a);c.splice(0,u+1)}else r.endConsumerSpan(s,e,t,a),c.splice(u,1);return n.apply(this,arguments)}}getConsumePatch(e,t){const n=this;return function(r,s,o){const i=this;if(!Object.prototype.hasOwnProperty.call(i,DV.CHANNEL_SPANS_NOT_ENDED)){const{consumeTimeoutMs:e}=n.getConfig();if(e){const t=setInterval(()=>{n.checkConsumeTimeoutOnChannel(i)},e);t.unref(),i[DV.CHANNEL_CONSUME_TIMEOUT_TIMER]=t}i[DV.CHANNEL_SPANS_NOT_ENDED]=[]}return arguments[1]=function(t){if(!t)return s.call(this,t);const a=t.properties.headers??{};let c=PV.propagation.extract(PV.ROOT_CONTEXT,a);const u=t.fields?.exchange;let l;if(n._config.useLinksForConsume){const e=c?PV.trace.getSpan(c)?.spanContext():void 0;c=void 0,e&&(l=[{context:e}])}const p=n.tracer.startSpan(`${r} process`,{kind:PV.SpanKind.CONSUMER,attributes:{...i?.connection?.[DV.CONNECTION_ATTRIBUTES],[LV.SEMATTRS_MESSAGING_DESTINATION]:u,[LV.SEMATTRS_MESSAGING_DESTINATION_KIND]:LV.MESSAGINGDESTINATIONKINDVALUES_TOPIC,[LV.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY]:t.fields?.routingKey,[LV.SEMATTRS_MESSAGING_OPERATION]:LV.MESSAGINGOPERATIONVALUES_PROCESS,[LV.SEMATTRS_MESSAGING_MESSAGE_ID]:t?.properties.messageId,[LV.SEMATTRS_MESSAGING_CONVERSATION_ID]:t?.properties.correlationId},links:l},c),{consumeHook:d}=n.getConfig();d&&(0,wV.safeExecuteInTheMiddle)(()=>d(p,{moduleVersion:e,msg:t}),e=>{e&&PV.diag.error("amqplib instrumentation: consumerHook error",e)},!0),o?.noAck||(i[DV.CHANNEL_SPANS_NOT_ENDED].push({msg:t,timeOfConsume:(0,MV.hrTime)()}),t[DV.MESSAGE_STORED_SPAN]=p);const h=c||PV.ROOT_CONTEXT;PV.context.with(PV.trace.setSpan(h,p),()=>{s.call(this,t)}),o?.noAck&&(n.callConsumeEndHook(p,t,!1,xV.EndOperation.AutoAck),p.end())},t.apply(this,arguments)}}getConfirmedPublishPatch(e,t){const n=this;return function(r,s,o,i,a){const{span:c,modifiedOptions:u}=n.createPublishSpan(n,r,s,this,i),{publishHook:l}=n.getConfig();l&&(0,wV.safeExecuteInTheMiddle)(()=>l(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:u,isConfirmChannel:!0}),e=>{e&&PV.diag.error("amqplib instrumentation: publishHook error",e)},!0);const p=(0,DV.markConfirmChannelTracing)(PV.context.active()),d=[...arguments];return d[3]=u,d[4]=PV.context.bind((0,DV.unmarkConfirmChannelTracing)(PV.trace.setSpan(p,c)),function(t,u){try{a?.call(this,t,u)}finally{const{publishConfirmHook:a}=n.getConfig();a&&(0,wV.safeExecuteInTheMiddle)(()=>a(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:i,isConfirmChannel:!0,confirmError:t}),e=>{e&&PV.diag.error("amqplib instrumentation: publishConfirmHook error",e)},!0),t&&c.setStatus({code:PV.SpanStatusCode.ERROR,message:"message confirmation has been nack'ed"}),c.end()}}),PV.context.with(p,t.bind(this,...d))}}getPublishPatch(e,t){const n=this;return function(r,s,o,i){if((0,DV.isConfirmChannelTracing)(PV.context.active()))return t.apply(this,arguments);{const a=this,{span:c,modifiedOptions:u}=n.createPublishSpan(n,r,s,a,i),{publishHook:l}=n.getConfig();l&&(0,wV.safeExecuteInTheMiddle)(()=>l(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:u,isConfirmChannel:!1}),e=>{e&&PV.diag.error("amqplib instrumentation: publishHook error",e)},!0);const p=[...arguments];p[3]=u;const d=t.apply(this,p);return c.end(),d}}}createPublishSpan(e,t,n,r,s){const o=(0,DV.normalizeExchange)(t),i=e.tracer.startSpan(`publish ${o}`,{kind:PV.SpanKind.PRODUCER,attributes:{...r.connection[DV.CONNECTION_ATTRIBUTES],[LV.SEMATTRS_MESSAGING_DESTINATION]:t,[LV.SEMATTRS_MESSAGING_DESTINATION_KIND]:LV.MESSAGINGDESTINATIONKINDVALUES_TOPIC,[LV.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY]:n,[LV.SEMATTRS_MESSAGING_MESSAGE_ID]:s?.messageId,[LV.SEMATTRS_MESSAGING_CONVERSATION_ID]:s?.correlationId}}),a=s??{};return a.headers=a.headers??{},PV.propagation.inject(PV.trace.setSpan(PV.context.active(),i),a.headers),{span:i,modifiedOptions:a}}endConsumerSpan(e,t,n,r){const s=e[DV.MESSAGE_STORED_SPAN];s&&(!1!==t&&s.setStatus({code:PV.SpanStatusCode.ERROR,message:n!==xV.EndOperation.ChannelClosed&&n!==xV.EndOperation.ChannelError?`${n} called on message${!0===r?" with requeue":!1===r?" without requeue":""}`:n}),this.callConsumeEndHook(s,e,t,n),s.end(),e[DV.MESSAGE_STORED_SPAN]=void 0)}endAllSpansOnChannel(e,t,n,r){(e[DV.CHANNEL_SPANS_NOT_ENDED]??[]).forEach(e=>{this.endConsumerSpan(e.msg,t,n,r)}),e[DV.CHANNEL_SPANS_NOT_ENDED]=[]}callConsumeEndHook(e,t,n,r){const{consumeEndHook:s}=this.getConfig();s&&(0,wV.safeExecuteInTheMiddle)(()=>s(e,{msg:t,rejected:n,endOperation:r}),e=>{e&&PV.diag.error("amqplib instrumentation: consumerEndHook error",e)},!0)}checkConsumeTimeoutOnChannel(e){const t=(0,MV.hrTime)(),n=e[DV.CHANNEL_SPANS_NOT_ENDED]??[];let r;const{consumeTimeoutMs:s}=this.getConfig();for(r=0;r<n.length;r++){const e=n[r],o=(0,MV.hrTimeDuration)(e.timeOfConsume,t);if((0,MV.hrTimeToMilliseconds)(o)<s)break;this.endConsumerSpan(e.msg,null,xV.EndOperation.InstrumentationTimeout,!0)}n.splice(0,r)}}SV.AmqplibInstrumentation=$V,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOperation=e.DEFAULT_CONFIG=e.AmqplibInstrumentation=void 0;var t=SV;Object.defineProperty(e,"AmqplibInstrumentation",{enumerable:!0,get:function(){return t.AmqplibInstrumentation}});var n=TV;Object.defineProperty(e,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_CONFIG}}),Object.defineProperty(e,"EndOperation",{enumerable:!0,get:function(){return n.EndOperation}})}(EV);const GV="Amqplib",jV={consumeEndHook:e=>{VI(e,"auto.amqplib.otel.consumer")},publishHook:e=>{VI(e,"auto.amqplib.otel.publisher")}},VV=dO(GV,()=>new EV.AmqplibInstrumentation(jV)),HV=()=>({name:GV,setupOnce(){VV()}}),BV="VercelAI",FV=["generateText","streamText","generateObject","streamObject","embed","embedMany"];function YV(e){if("object"!=typeof e||null===e)return!1;const t=e;return"type"in t&&"error"in t&&"toolName"in t&&"toolCallId"in t&&"tool-error"===t.type&&t.error instanceof Error}class qV extends IS{__init(){this._isPatched=!1}__init2(){this._callbacks=[]}constructor(e={}){super("@sentry/instrumentation-vercel-ai",lT,e),qV.prototype.__init.call(this),qV.prototype.__init2.call(this)}init(){return new MS("ai",[">=3.0.0 <6"],this._patch.bind(this))}callWhenPatched(e){this._isPatched?e():this._callbacks.push(e)}_patch(e){function t(e){return(...t)=>{const n=t[0].experimental_telemetry||{},r=n.isEnabled,s=Py().getClient(),o=s?.getIntegrationByName(BV),i=o?.options,a=!!o&&Boolean(s?.getOptions().sendDefaultPii),{recordInputs:c,recordOutputs:u}=(l=i,p=n,d=r,h=a,{recordInputs:void 0!==l?.recordInputs?l.recordInputs:void 0!==p.recordInputs?p.recordInputs:!0===d||h,recordOutputs:void 0!==l?.recordOutputs?l.recordOutputs:void 0!==p.recordOutputs?p.recordOutputs:!0===d||h});var l,p,d,h;return t[0].experimental_telemetry={...n,isEnabled:void 0===r||r,recordInputs:c,recordOutputs:u},sv(async()=>{const n=await e.apply(this,t);return function(e){if("object"!=typeof e||null===e||!("content"in e))return;const t=e;if(Array.isArray(t.content))for(const e of t.content)if(YV(e)){const t=gR(e.toolCallId);if(t){const n=t.spanContext();wy(t=>{t.setContext("trace",{trace_id:n.traceId,span_id:n.spanId}),t.setTag("vercel.ai.tool.name",e.toolName),t.setTag("vercel.ai.tool.callId",e.toolCallId),t.setLevel("error"),Pv(e.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})}),ER(e.toolCallId)}else wy(t=>{t.setTag("vercel.ai.tool.name",e.toolName),t.setTag("vercel.ai.tool.callId",e.toolCallId),t.setLevel("error"),Pv(e.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})})}}(n),n},e=>{e&&"object"==typeof e&&JT(e,"_sentry_active_span",vA())})}}if(this._isPatched=!0,this._callbacks.forEach(e=>e()),this._callbacks=[],"[object Module]"===Object.prototype.toString.call(e)){for(const n of FV)e[n]=t(e[n]);return e}{const n=FV.reduce((n,r)=>(n[r]=t(e[r]),n),{});return{...e,...n}}}}const KV=dO(BV,()=>new qV({}));const WV=(e={})=>{let t;return{name:BV,options:e,setupOnce(){t=KV()},afterAllSetup(n){const r=e.force??function(e){const t=e.getIntegrationByName("Modules");return!!t?.getModules?.()?.ai}(n);r?LR(n):t?.callWhenPatched(()=>LR(n))}}},ZV=[">=4.0.0 <6"];class XV extends IS{constructor(e={}){super("@sentry/instrumentation-openai",lT,e)}init(){return new MS("openai",ZV,this._patch.bind(this))}_patch(e){const t=e.OpenAI,n=function(...e){const n=Reflect.construct(t,e),r=Py().getClient(),s=r?.getIntegrationByName(DR),o=s?.options,i=Boolean(r?.getOptions().sendDefaultPii),{recordInputs:a,recordOutputs:c}=(u=o,l=i,{recordInputs:u?.recordInputs??l,recordOutputs:u?.recordOutputs??l});var u,l;return XR(n,"",{recordInputs:a,recordOutputs:c})};Object.setPrototypeOf(n,t),Object.setPrototypeOf(n.prototype,t.prototype);for(const e of Object.getOwnPropertyNames(t))if(!["length","name","prototype"].includes(e)){const r=Object.getOwnPropertyDescriptor(t,e);r&&Object.defineProperty(n,e,r)}try{e.OpenAI=n}catch(t){Object.defineProperty(e,"OpenAI",{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===t)try{e.default=n}catch(t){Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}return e}}const zV=dO(DR,()=>new XV({})),QV=(e={})=>({name:DR,options:e,setupOnce(){zV()}}),JV=[">=0.19.2 <1.0.0"];class eH extends IS{constructor(e={}){super("@sentry/instrumentation-anthropic-ai",lT,e)}init(){return new MS("@anthropic-ai/sdk",JV,this._patch.bind(this))}_patch(e){const t=e.Anthropic,n=function(...e){const n=Reflect.construct(t,e),r=Py().getClient(),s=r?.getIntegrationByName(eO),o=s?.options,i=Boolean(r?.getOptions().sendDefaultPii),{recordInputs:a,recordOutputs:c}=(u=o,l=i,{recordInputs:u?.recordInputs??l,recordOutputs:u?.recordOutputs??l});var u,l;return oO(n,"",{recordInputs:a,recordOutputs:c})};Object.setPrototypeOf(n,t),Object.setPrototypeOf(n.prototype,t.prototype);for(const e of Object.getOwnPropertyNames(t))if(!["length","name","prototype"].includes(e)){const r=Object.getOwnPropertyDescriptor(t,e);r&&Object.defineProperty(n,e,r)}try{e.Anthropic=n}catch(t){Object.defineProperty(e,"Anthropic",{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===t)try{e.default=n}catch(t){Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}return e}}const tH=dO(eO,()=>new eH({})),nH=(e={})=>({name:eO,options:e,setupOnce(){tH()}});function rH(e,t,n,r,s){return sH(e,n),t(e,"addDoc",function(e,t){return function(n){return function(r,s){const o=iH(e,"addDoc",r);return t(o),oH(o,()=>n(r,s))}}}(r,s)),t(e,"getDocs",function(e,t){return function(n){return function(r){const s=iH(e,"getDocs",r);return t(s),oH(s,()=>n(r))}}}(r,s)),t(e,"setDoc",function(e,t){return function(n){return function(r,s,o){const i=iH(e,"setDoc",r.parent||r);return t(i),oH(i,()=>void 0!==o?n(r,s,o):n(r,s))}}}(r,s)),t(e,"deleteDoc",function(e,t){return function(n){return function(r){const s=iH(e,"deleteDoc",r.parent||r);return t(s),oH(s,()=>n(r))}}}(r,s)),e}function sH(e,t){for(const n of["addDoc","getDocs","setDoc","deleteDoc"])CS(e[n])&&t(e,n);return e}function oH(e,t){return At.with(jt.setSpan(At.active(),e),()=>NS(()=>t(),t=>{t&&e.recordException(t),e.end()},!0))}function iH(e,t,n){const r=e.startSpan(`${t} ${n.path}`,{kind:pt.CLIENT});return function(e,t){const n=t.firestore.app,r=n.options,s=t.firestore.toJSON()||{},o=s.settings||{},i={[x_]:t.path,[D_]:n.name,[G_]:"firebase.firestore","firebase.firestore.type":t.type,"firebase.firestore.options.projectId":r.projectId,"firebase.firestore.options.appId":r.appId,"firebase.firestore.options.messagingSenderId":r.messagingSenderId,"firebase.firestore.options.storageBucket":r.storageBucket},{address:a,port:c}=function(e){let t,n;if("string"==typeof e.host)if(e.host.startsWith("[")){if(e.host.endsWith("]"))t=e.host.replace(/^\[|\]$/g,"");else if(e.host.includes("]:")){const r=e.host.lastIndexOf(":");-1!==r&&(t=e.host.slice(1,r).replace(/^\[|\]$/g,""),n=e.host.slice(r+1))}}else if(M.isIPv6(e.host))t=e.host;else{const r=e.host.lastIndexOf(":");-1!==r?(t=e.host.slice(0,r),n=e.host.slice(r+1)):t=e.host}return{address:t,port:n?parseInt(n,10):void 0}}(o);a&&(i[K_]=a);c&&(i[W_]=c);e.setAttributes(i)}(r,n),r.setAttribute(k_,t),r}const aH={},cH=[">=3.0.0 <5"];class uH extends IS{constructor(e=aH){super("@sentry/instrumentation-firebase",lT,e)}setConfig(e={}){super.setConfig({...aH,...e})}init(){const e=[];return e.push(function(e,t,n,r,s){let o=()=>{};const i=s.firestoreSpanCreationHook;"function"==typeof i&&(o=e=>{NS(()=>i(e),e=>{e&&vt.error(e?.message)},!0)});const a=new MS("@firebase/firestore",t,t=>rH(t,n,r,e,o)),c=["@firebase/firestore/dist/lite/index.node.cjs.js","@firebase/firestore/dist/lite/index.node.mjs.js","@firebase/firestore/dist/lite/index.rn.esm2017.js","@firebase/firestore/dist/lite/index.cjs.js"];for(const s of c)a.files.push(new wS(s,t,t=>rH(t,n,r,e,o),e=>sH(e,r)));return a}(this.tracer,cH,this._wrap,this._unwrap,this.getConfig())),e}}const lH="Firebase",pH={firestoreSpanCreationHook:e=>{VI(e,"auto.firebase.otel.firestore"),e.setAttribute(Uy,"db.query")}},dH=dO(lH,()=>new uH(pH)),hH=()=>({name:lH,setupOnce(){dH()}});const fH=1e6;function _H(e,t={}){e.getOptions().debug&&(vt.disable(),vt.setLogger({error:TT.error,warn:TT.warn,info:TT.log,debug:TT.log,verbose:TT.log},K.DEBUG));const n=function(e,t={}){const n=new VO({sampler:new qN(e),resource:vO().merge(AO({[Z_]:"node",[$h]:"sentry",[X_]:lT})),forceFlushTimeoutMillis:500,spanProcessors:[new YN({timeout:mH(e.getOptions().maxSpanWaitDuration)}),...t.spanProcessors||[]]});return jt.setGlobalTracerProvider(n),Ut.setGlobalPropagator(new _N),At.setGlobalContextManager(new SI),n}(e,t);e.traceProvider=n}function mH(e){if(null!=e){if(e>fH)return OP&&TT.warn("`maxSpanWaitDuration` is too high, using the maximum value of 1000000"),fH;if(!(e<=0||Number.isNaN(e)))return e;OP&&TT.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.")}}function gH(e){return[...$I().filter(e=>"Http"!==e.name&&"NodeFetch"!==e.name).concat(qI(),cP()),...NA(e)?[IP(),Ew(),Hw(),kL(),WL(),dx(),Lx(),VD(),bk(),WG(),pj(),Mj(),Hj(),iV(),gV(),uL(),HV(),SL(),WV(),QV(),Ik(),hH(),nH()]:[]]}var EH={exports:{}};const SH=e,TH=t,yH=n,AH=r,vH={name:"dotenv",version:"17.2.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}.version,bH=["🔐 encrypt with Dotenvx: https://dotenvx.com","🔐 prevent committing .env to code: https://dotenvx.com/precommit","🔐 prevent building .env in docker: https://dotenvx.com/prebuild","📡 observe env with Radar: https://dotenvx.com/radar","📡 auto-backup env with Radar: https://dotenvx.com/radar","📡 version env with Radar: https://dotenvx.com/radar","🛠️  run anywhere with `dotenvx run -- yourcommand`","⚙️  specify custom .env file path with { path: '/custom/path/.env' }","⚙️  enable debug logging with { debug: true }","⚙️  override existing env vars with { override: true }","⚙️  suppress all logs with { quiet: true }","⚙️  write to custom object with { processEnv: myObject }","⚙️  load multiple .env files with { path: ['.env.local', '.env'] }"];function RH(e){return"string"==typeof e?!["false","0","no","off",""].includes(e.toLowerCase()):Boolean(e)}function OH(e){return process.stdout.isTTY?`[2m${e}[0m`:e}const NH=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function CH(e){console.log(`[dotenv@${vH}][DEBUG] ${e}`)}function IH(e){console.log(`[dotenv@${vH}] ${e}`)}function PH(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function MH(e,t){let n;try{n=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const r=n.password;if(!r){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const s=n.searchParams.get("environment");if(!s){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const o=`DOTENV_VAULT_${s.toUpperCase()}`,i=e.parsed[o];if(!i){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${o} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:i,key:r}}function wH(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const n of e.path)SH.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=TH.resolve(process.cwd(),".env.vault");return SH.existsSync(t)?t:null}function LH(e){return"~"===e[0]?TH.join(yH.homedir(),e.slice(1)):e}const xH={configDotenv:function(e){const t=TH.resolve(process.cwd(),".env");let n="utf8",r=process.env;e&&null!=e.processEnv&&(r=e.processEnv);let s=RH(r.DOTENV_CONFIG_DEBUG||e&&e.debug),o=RH(r.DOTENV_CONFIG_QUIET||e&&e.quiet);e&&e.encoding?n=e.encoding:s&&CH("No encoding is specified. UTF-8 is used by default");let i,a=[t];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const t of e.path)a.push(LH(t))}else a=[LH(e.path)];const c={};for(const t of a)try{const r=xH.parse(SH.readFileSync(t,{encoding:n}));xH.populate(c,r,e)}catch(e){s&&CH(`Failed to load ${t} ${e.message}`),i=e}const u=xH.populate(r,c,e);if(s=RH(r.DOTENV_CONFIG_DEBUG||s),o=RH(r.DOTENV_CONFIG_QUIET||o),s||!o){const e=Object.keys(u).length,t=[];for(const e of a)try{const n=TH.relative(process.cwd(),e);t.push(n)}catch(t){s&&CH(`Failed to load ${e} ${t.message}`),i=t}IH(`injecting env (${e}) from ${t.join(",")} ${OH(`-- tip: ${bH[Math.floor(Math.random()*bH.length)]}`)}`)}return i?{parsed:c,error:i}:{parsed:c}},_configVault:function(e){const t=RH(process.env.DOTENV_CONFIG_DEBUG||e&&e.debug),n=RH(process.env.DOTENV_CONFIG_QUIET||e&&e.quiet);!t&&n||IH("Loading env from encrypted .env.vault");const r=xH._parseVault(e);let s=process.env;return e&&null!=e.processEnv&&(s=e.processEnv),xH.populate(s,r,e),{parsed:r}},_parseVault:function(e){const t=wH(e=e||{});e.path=t;const n=xH.configDotenv(e);if(!n.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const r=PH(e).split(","),s=r.length;let o;for(let e=0;e<s;e++)try{const t=MH(n,r[e].trim());o=xH.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=s)throw t}return xH.parse(o)},config:function(e){if(0===PH(e).length)return xH.configDotenv(e);const t=wH(e);return t?xH._configVault(e):(n=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.error(`[dotenv@${vH}][WARN] ${n}`),xH.configDotenv(e));var n},decrypt:function(e,t){const n=Buffer.from(t.slice(-64),"hex");let r=Buffer.from(e,"base64");const s=r.subarray(0,12),o=r.subarray(-16);r=r.subarray(12,-16);try{const e=AH.createDecipheriv("aes-256-gcm",n,s);return e.setAuthTag(o),`${e.update(r)}${e.final()}`}catch(e){const t=e instanceof RangeError,n="Invalid key length"===e.message,r="Unsupported state or unable to authenticate data"===e.message;if(t||n){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let n,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(n=NH.exec(r));){const e=n[1];let r=n[2]||"";r=r.trim();const s=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===s&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),t[e]=r}return t},populate:function(e,t,n={}){const r=Boolean(n&&n.debug),s=Boolean(n&&n.override),o={};if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const n of Object.keys(t))Object.prototype.hasOwnProperty.call(e,n)?(!0===s&&(e[n]=t[n],o[n]=t[n]),r&&CH(!0===s?`"${n}" is already defined and WAS overwritten`:`"${n}" is already defined and was NOT overwritten`)):(e[n]=t[n],o[n]=t[n]);return o}};EH.exports.configDotenv=xH.configDotenv,EH.exports._configVault=xH._configVault,EH.exports._parseVault=xH._parseVault;var DH,kH,UH,$H=EH.exports.config=xH.config;EH.exports.decrypt=xH.decrypt,EH.exports.parse=xH.parse,EH.exports.populate=xH.populate,EH.exports=xH,$H(),function(e={}){(function(e={},t){db(e,"node");const n=GI({...e,defaultIntegrations:e.defaultIntegrations??t(e)});n&&!e.skipOpenTelemetrySetup&&(_H(n,{spanProcessors:e.openTelemetrySpanProcessors}),jI())})(e,gH)}({dsn:process.env.SENTRY_DSN,sendDefaultPii:!0}),function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.REVERT="revert",e.COMMENT="comment",e.UPLOAD="upload",e.LOGIN="login",e.RUN="run"}(DH||(DH={})),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(kH||(kH={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(UH||(UH={}));const GH=kH.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),jH=e=>{switch(typeof e){case"undefined":return GH.undefined;case"string":return GH.string;case"number":return isNaN(e)?GH.nan:GH.number;case"boolean":return GH.boolean;case"function":return GH.function;case"bigint":return GH.bigint;case"symbol":return GH.symbol;case"object":return Array.isArray(e)?GH.array:null===e?GH.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?GH.promise:"undefined"!=typeof Map&&e instanceof Map?GH.map:"undefined"!=typeof Set&&e instanceof Set?GH.set:"undefined"!=typeof Date&&e instanceof Date?GH.date:GH.object;default:return GH.unknown}},VH=kH.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class HH extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,r=0;for(;r<s.path.length;){const n=s.path[r];r===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,kH.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}HH.create=e=>new HH(e);const BH=(e,t)=>{let n;switch(e.code){case VH.invalid_type:n=e.received===GH.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case VH.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,kH.jsonStringifyReplacer)}`;break;case VH.unrecognized_keys:n=`Unrecognized key(s) in object: ${kH.joinValues(e.keys,", ")}`;break;case VH.invalid_union:n="Invalid input";break;case VH.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${kH.joinValues(e.options)}`;break;case VH.invalid_enum_value:n=`Invalid enum value. Expected ${kH.joinValues(e.options)}, received '${e.received}'`;break;case VH.invalid_arguments:n="Invalid function arguments";break;case VH.invalid_return_type:n="Invalid function return type";break;case VH.invalid_date:n="Invalid date";break;case VH.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:kH.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case VH.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case VH.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case VH.custom:n="Invalid input";break;case VH.invalid_intersection_types:n="Intersection results could not be merged";break;case VH.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case VH.not_finite:n="Number must be finite";break;default:n=t.defaultError,kH.assertNever(e)}return{message:n}};let FH=BH;function YH(){return FH}const qH=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,o=[...n,...s.path||[]],i={...s,path:o};let a="";const c=r.filter(e=>!!e).slice().reverse();for(const e of c)a=e(i,{data:t,defaultError:a}).message;return{...s,path:o,message:s.message||a}};function KH(e,t){const n=qH({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,YH(),BH].filter(e=>!!e)});e.common.issues.push(n)}class WH{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return ZH;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t)n.push({key:await e.key,value:await e.value});return WH.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:s}=r;if("aborted"===t.status)return ZH;if("aborted"===s.status)return ZH;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),(void 0!==s.value||r.alwaysSet)&&(n[t.value]=s.value)}return{status:e.value,value:n}}}const ZH=Object.freeze({status:"aborted"}),XH=e=>({status:"dirty",value:e}),zH=e=>({status:"valid",value:e}),QH=e=>"aborted"===e.status,JH=e=>"dirty"===e.status,eB=e=>"valid"===e.status,tB=e=>"undefined"!=typeof Promise&&e instanceof Promise;var nB;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(nB||(nB={}));class rB{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const sB=(e,t)=>{if(eB(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new HH(e.common.issues);return this._error=t,this._error}}};function oB(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=r?r:t.defaultError}:{message:null!=n?n:t.defaultError},description:s}}class iB{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return jH(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:jH(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new WH,ctx:{common:e.parent.common,data:e.data,parsedType:jH(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(tB(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jH(e)},s=this._parseSync({data:e,path:r.path,parent:r});return sB(r,s)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jH(e)},r=this._parse({data:e,path:n.path,parent:n}),s=await(tB(r)?r:Promise.resolve(r));return sB(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const s=e(t),o=()=>r.addIssue({code:VH.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(o(),!1)):!!s||(o(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1))}_refinement(e){return new ZB({schema:this,typeName:iF.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return XB.create(this,this._def)}nullable(){return zB.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return PB.create(this,this._def)}promise(){return WB.create(this,this._def)}or(e){return LB.create([this,e],this._def)}and(e){return UB.create(this,e,this._def)}transform(e){return new ZB({...oB(this._def),schema:this,typeName:iF.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new QB({...oB(this._def),innerType:this,defaultValue:t,typeName:iF.ZodDefault})}brand(){return new nF({typeName:iF.ZodBranded,type:this,...oB(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new JB({...oB(this._def),innerType:this,catchValue:t,typeName:iF.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return rF.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const aB=/^c[^\s-]{8,}$/i,cB=/^[a-z][a-z0-9]*$/,uB=/[0-9A-HJKMNP-TV-Z]{26}/,lB=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,pB=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,dB=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,hB=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,fB=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,_B=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function mB(e,t){return!("v4"!==t&&t||!hB.test(e))||!("v6"!==t&&t||!fB.test(e))}class gB extends iB{constructor(){super(...arguments),this._regex=(e,t,n)=>this.refinement(t=>e.test(t),{validation:t,code:VH.invalid_string,...nB.errToObj(n)}),this.nonempty=e=>this.min(1,nB.errToObj(e)),this.trim=()=>new gB({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new gB({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new gB({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==GH.string){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.string,received:t.parsedType}),ZH}const t=new WH;let n;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const s=e.data.length>r.value,o=e.data.length<r.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?KH(n,{code:VH.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):o&&KH(n,{code:VH.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)pB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"email",code:VH.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)dB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"emoji",code:VH.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)lB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"uuid",code:VH.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)aB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"cuid",code:VH.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)cB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"cuid2",code:VH.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)uB.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"ulid",code:VH.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(s){n=this._getOrReturnCtx(e,n),KH(n,{validation:"url",code:VH.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"regex",code:VH.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){_B(r).test(e.data)||(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else"ip"===r.kind?mB(e.data,r.version)||(n=this._getOrReturnCtx(e,n),KH(n,{validation:"ip",code:VH.invalid_string,message:r.message}),t.dirty()):kH.assertNever(r);return{status:t.value,value:e.data}}_addCheck(e){return new gB({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...nB.errToObj(e)})}url(e){return this._addCheck({kind:"url",...nB.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...nB.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...nB.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...nB.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...nB.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...nB.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...nB.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...nB.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...nB.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...nB.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...nB.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...nB.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...nB.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...nB.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...nB.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function EB(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}gB.create=e=>{var t;return new gB({checks:[],typeName:iF.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...oB(e)})};class SB extends iB{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==GH.number){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.number,received:t.parsedType}),ZH}let t;const n=new WH;for(const r of this._def.checks)if("int"===r.kind)kH.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else"multipleOf"===r.kind?0!==EB(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.not_finite,message:r.message}),n.dirty()):kH.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,nB.toString(t))}gt(e,t){return this.setLimit("min",e,!1,nB.toString(t))}lte(e,t){return this.setLimit("max",e,!0,nB.toString(t))}lt(e,t){return this.setLimit("max",e,!1,nB.toString(t))}setLimit(e,t,n,r){return new SB({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:nB.toString(r)}]})}_addCheck(e){return new SB({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:nB.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:nB.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:nB.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:nB.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:nB.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:nB.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:nB.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:nB.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:nB.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&kH.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}SB.create=e=>new SB({checks:[],typeName:iF.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...oB(e)});class TB extends iB{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==GH.bigint){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.bigint,received:t.parsedType}),ZH}let t;const n=new WH;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),KH(t,{code:VH.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):kH.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,nB.toString(t))}gt(e,t){return this.setLimit("min",e,!1,nB.toString(t))}lte(e,t){return this.setLimit("max",e,!0,nB.toString(t))}lt(e,t){return this.setLimit("max",e,!1,nB.toString(t))}setLimit(e,t,n,r){return new TB({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:nB.toString(r)}]})}_addCheck(e){return new TB({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:nB.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:nB.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:nB.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:nB.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:nB.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}TB.create=e=>{var t;return new TB({checks:[],typeName:iF.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...oB(e)})};class yB extends iB{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==GH.boolean){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.boolean,received:t.parsedType}),ZH}return zH(e.data)}}yB.create=e=>new yB({typeName:iF.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...oB(e)});class AB extends iB{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==GH.date){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.date,received:t.parsedType}),ZH}if(isNaN(e.data.getTime())){return KH(this._getOrReturnCtx(e),{code:VH.invalid_date}),ZH}const t=new WH;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),KH(n,{code:VH.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):kH.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new AB({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:nB.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:nB.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}AB.create=e=>new AB({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:iF.ZodDate,...oB(e)});class vB extends iB{_parse(e){if(this._getType(e)!==GH.symbol){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.symbol,received:t.parsedType}),ZH}return zH(e.data)}}vB.create=e=>new vB({typeName:iF.ZodSymbol,...oB(e)});class bB extends iB{_parse(e){if(this._getType(e)!==GH.undefined){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.undefined,received:t.parsedType}),ZH}return zH(e.data)}}bB.create=e=>new bB({typeName:iF.ZodUndefined,...oB(e)});class RB extends iB{_parse(e){if(this._getType(e)!==GH.null){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.null,received:t.parsedType}),ZH}return zH(e.data)}}RB.create=e=>new RB({typeName:iF.ZodNull,...oB(e)});class OB extends iB{constructor(){super(...arguments),this._any=!0}_parse(e){return zH(e.data)}}OB.create=e=>new OB({typeName:iF.ZodAny,...oB(e)});class NB extends iB{constructor(){super(...arguments),this._unknown=!0}_parse(e){return zH(e.data)}}NB.create=e=>new NB({typeName:iF.ZodUnknown,...oB(e)});class CB extends iB{_parse(e){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.never,received:t.parsedType}),ZH}}CB.create=e=>new CB({typeName:iF.ZodNever,...oB(e)});class IB extends iB{_parse(e){if(this._getType(e)!==GH.undefined){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.void,received:t.parsedType}),ZH}return zH(e.data)}}IB.create=e=>new IB({typeName:iF.ZodVoid,...oB(e)});class PB extends iB{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==GH.array)return KH(t,{code:VH.invalid_type,expected:GH.array,received:t.parsedType}),ZH;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(KH(t,{code:e?VH.too_big:VH.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(KH(t,{code:VH.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(KH(t,{code:VH.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new rB(t,e,t.path,n)))).then(e=>WH.mergeArray(n,e));const s=[...t.data].map((e,n)=>r.type._parseSync(new rB(t,e,t.path,n)));return WH.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new PB({...this._def,minLength:{value:e,message:nB.toString(t)}})}max(e,t){return new PB({...this._def,maxLength:{value:e,message:nB.toString(t)}})}length(e,t){return new PB({...this._def,exactLength:{value:e,message:nB.toString(t)}})}nonempty(e){return this.min(1,e)}}function MB(e){if(e instanceof wB){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=XB.create(MB(r))}return new wB({...e._def,shape:()=>t})}return e instanceof PB?new PB({...e._def,type:MB(e.element)}):e instanceof XB?XB.create(MB(e.unwrap())):e instanceof zB?zB.create(MB(e.unwrap())):e instanceof $B?$B.create(e.items.map(e=>MB(e))):e}PB.create=(e,t)=>new PB({type:e,minLength:null,maxLength:null,exactLength:null,typeName:iF.ZodArray,...oB(t)});class wB extends iB{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=kH.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==GH.object){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.object,received:t.parsedType}),ZH}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof CB&&"strip"===this._def.unknownKeys))for(const e in n.data)s.includes(e)||o.push(e);const i=[];for(const e of s){const t=r[e],s=n.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new rB(n,s,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof CB){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of o)i.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)o.length>0&&(KH(n,{code:VH.unrecognized_keys,keys:o}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of o){const r=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new rB(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key;e.push({key:n,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>WH.mergeObjectSync(t,e)):WH.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return nB.errToObj,new wB({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,s,o,i;const a=null!==(o=null===(s=(r=this._def).errorMap)||void 0===s?void 0:s.call(r,t,n).message)&&void 0!==o?o:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=nB.errToObj(e).message)&&void 0!==i?i:a}:{message:a}}}:{}})}strip(){return new wB({...this._def,unknownKeys:"strip"})}passthrough(){return new wB({...this._def,unknownKeys:"passthrough"})}extend(e){return new wB({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new wB({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:iF.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new wB({...this._def,catchall:e})}pick(e){const t={};return kH.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new wB({...this._def,shape:()=>t})}omit(e){const t={};return kH.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new wB({...this._def,shape:()=>t})}deepPartial(){return MB(this)}partial(e){const t={};return kH.objectKeys(this.shape).forEach(n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}),new wB({...this._def,shape:()=>t})}required(e){const t={};return kH.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof XB;)e=e._def.innerType;t[n]=e}}),new wB({...this._def,shape:()=>t})}keyof(){return YB(kH.objectKeys(this.shape))}}wB.create=(e,t)=>new wB({shape:()=>e,unknownKeys:"strip",catchall:CB.create(),typeName:iF.ZodObject,...oB(t)}),wB.strictCreate=(e,t)=>new wB({shape:()=>e,unknownKeys:"strict",catchall:CB.create(),typeName:iF.ZodObject,...oB(t)}),wB.lazycreate=(e,t)=>new wB({shape:e,unknownKeys:"strip",catchall:CB.create(),typeName:iF.ZodObject,...oB(t)});class LB extends iB{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new HH(e.ctx.common.issues));return KH(t,{code:VH.invalid_union,unionErrors:n}),ZH});{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},o=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===o.status)return o;"dirty"!==o.status||e||(e={result:o,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=r.map(e=>new HH(e));return KH(t,{code:VH.invalid_union,unionErrors:s}),ZH}}get options(){return this._def.options}}LB.create=(e,t)=>new LB({options:e,typeName:iF.ZodUnion,...oB(t)});const xB=e=>e instanceof BB?xB(e.schema):e instanceof ZB?xB(e.innerType()):e instanceof FB?[e.value]:e instanceof qB?e.options:e instanceof KB?Object.keys(e.enum):e instanceof QB?xB(e._def.innerType):e instanceof bB?[void 0]:e instanceof RB?[null]:null;class DB extends iB{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==GH.object)return KH(t,{code:VH.invalid_type,expected:GH.object,received:t.parsedType}),ZH;const n=this.discriminator,r=t.data[n],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(KH(t,{code:VH.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ZH)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=xB(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,n)}}return new DB({typeName:iF.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...oB(n)})}}function kB(e,t){const n=jH(e),r=jH(t);if(e===t)return{valid:!0,data:e};if(n===GH.object&&r===GH.object){const n=kH.objectKeys(t),r=kH.objectKeys(e).filter(e=>-1!==n.indexOf(e)),s={...e,...t};for(const n of r){const r=kB(e[n],t[n]);if(!r.valid)return{valid:!1};s[n]=r.data}return{valid:!0,data:s}}if(n===GH.array&&r===GH.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const s=kB(e[r],t[r]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===GH.date&&r===GH.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class UB extends iB{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(QH(e)||QH(r))return ZH;const s=kB(e.value,r.value);return s.valid?((JH(e)||JH(r))&&t.dirty(),{status:t.value,value:s.data}):(KH(n,{code:VH.invalid_intersection_types}),ZH)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}UB.create=(e,t,n)=>new UB({left:e,right:t,typeName:iF.ZodIntersection,...oB(n)});class $B extends iB{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==GH.array)return KH(n,{code:VH.invalid_type,expected:GH.array,received:n.parsedType}),ZH;if(n.data.length<this._def.items.length)return KH(n,{code:VH.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ZH;!this._def.rest&&n.data.length>this._def.items.length&&(KH(n,{code:VH.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new rB(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>WH.mergeArray(t,e)):WH.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new $B({...this._def,rest:e})}}$B.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $B({items:e,typeName:iF.ZodTuple,rest:null,...oB(t)})};class GB extends iB{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==GH.object)return KH(n,{code:VH.invalid_type,expected:GH.object,received:n.parsedType}),ZH;const r=[],s=this._def.keyType,o=this._def.valueType;for(const e in n.data)r.push({key:s._parse(new rB(n,e,n.path,e)),value:o._parse(new rB(n,n.data[e],n.path,e))});return n.common.async?WH.mergeObjectAsync(t,r):WH.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new GB(t instanceof iB?{keyType:e,valueType:t,typeName:iF.ZodRecord,...oB(n)}:{keyType:gB.create(),valueType:e,typeName:iF.ZodRecord,...oB(t)})}}class jB extends iB{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==GH.map)return KH(n,{code:VH.invalid_type,expected:GH.map,received:n.parsedType}),ZH;const r=this._def.keyType,s=this._def.valueType,o=[...n.data.entries()].map(([e,t],o)=>({key:r._parse(new rB(n,e,n.path,[o,"key"])),value:s._parse(new rB(n,t,n.path,[o,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of o){const r=await n.key,s=await n.value;if("aborted"===r.status||"aborted"===s.status)return ZH;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of o){const r=n.key,s=n.value;if("aborted"===r.status||"aborted"===s.status)return ZH;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}jB.create=(e,t,n)=>new jB({valueType:t,keyType:e,typeName:iF.ZodMap,...oB(n)});class VB extends iB{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==GH.set)return KH(n,{code:VH.invalid_type,expected:GH.set,received:n.parsedType}),ZH;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(KH(n,{code:VH.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(KH(n,{code:VH.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function o(e){const n=new Set;for(const r of e){if("aborted"===r.status)return ZH;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>s._parse(new rB(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>o(e)):o(i)}min(e,t){return new VB({...this._def,minSize:{value:e,message:nB.toString(t)}})}max(e,t){return new VB({...this._def,maxSize:{value:e,message:nB.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}VB.create=(e,t)=>new VB({valueType:e,minSize:null,maxSize:null,typeName:iF.ZodSet,...oB(t)});class HB extends iB{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==GH.function)return KH(t,{code:VH.invalid_type,expected:GH.function,received:t.parsedType}),ZH;function n(e,n){return qH({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,YH(),BH].filter(e=>!!e),issueData:{code:VH.invalid_arguments,argumentsError:n}})}function r(e,n){return qH({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,YH(),BH].filter(e=>!!e),issueData:{code:VH.invalid_return_type,returnTypeError:n}})}const s={errorMap:t.common.contextualErrorMap},o=t.data;return this._def.returns instanceof WB?zH(async(...e)=>{const t=new HH([]),i=await this._def.args.parseAsync(e,s).catch(r=>{throw t.addIssue(n(e,r)),t}),a=await o(...i);return await this._def.returns._def.type.parseAsync(a,s).catch(e=>{throw t.addIssue(r(a,e)),t})}):zH((...e)=>{const t=this._def.args.safeParse(e,s);if(!t.success)throw new HH([n(e,t.error)]);const i=o(...t.data),a=this._def.returns.safeParse(i,s);if(!a.success)throw new HH([r(i,a.error)]);return a.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new HB({...this._def,args:$B.create(e).rest(NB.create())})}returns(e){return new HB({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new HB({args:e||$B.create([]).rest(NB.create()),returns:t||NB.create(),typeName:iF.ZodFunction,...oB(n)})}}class BB extends iB{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}BB.create=(e,t)=>new BB({getter:e,typeName:iF.ZodLazy,...oB(t)});class FB extends iB{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return KH(t,{received:t.data,code:VH.invalid_literal,expected:this._def.value}),ZH}return{status:"valid",value:e.data}}get value(){return this._def.value}}function YB(e,t){return new qB({values:e,typeName:iF.ZodEnum,...oB(t)})}FB.create=(e,t)=>new FB({value:e,typeName:iF.ZodLiteral,...oB(t)});class qB extends iB{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return KH(t,{expected:kH.joinValues(n),received:t.parsedType,code:VH.invalid_type}),ZH}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return KH(t,{received:t.data,code:VH.invalid_enum_value,options:n}),ZH}return zH(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return qB.create(e)}exclude(e){return qB.create(this.options.filter(t=>!e.includes(t)))}}qB.create=YB;class KB extends iB{_parse(e){const t=kH.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==GH.string&&n.parsedType!==GH.number){const e=kH.objectValues(t);return KH(n,{expected:kH.joinValues(e),received:n.parsedType,code:VH.invalid_type}),ZH}if(-1===t.indexOf(e.data)){const e=kH.objectValues(t);return KH(n,{received:n.data,code:VH.invalid_enum_value,options:e}),ZH}return zH(e.data)}get enum(){return this._def.values}}KB.create=(e,t)=>new KB({values:e,typeName:iF.ZodNativeEnum,...oB(t)});class WB extends iB{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==GH.promise&&!1===t.common.async)return KH(t,{code:VH.invalid_type,expected:GH.promise,received:t.parsedType}),ZH;const n=t.parsedType===GH.promise?t.data:Promise.resolve(t.data);return zH(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}WB.create=(e,t)=>new WB({type:e,typeName:iF.ZodPromise,...oB(t)});class ZB extends iB{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===iF.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null;if("preprocess"===r.type){const e=r.transform(n.data);return n.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n})):this._def.schema._parseSync({data:e,path:n.path,parent:n})}const s={addIssue:e=>{KH(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"refinement"===r.type){const e=e=>{const t=r.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?ZH:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?ZH:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!eB(e))return e;const o=r.transform(e.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>eB(e)?Promise.resolve(r.transform(e.value,s)).then(e=>({status:t.value,value:e})):e)}kH.assertNever(r)}}ZB.create=(e,t,n)=>new ZB({schema:e,typeName:iF.ZodEffects,effect:t,...oB(n)}),ZB.createWithPreprocess=(e,t,n)=>new ZB({schema:t,effect:{type:"preprocess",transform:e},typeName:iF.ZodEffects,...oB(n)});class XB extends iB{_parse(e){return this._getType(e)===GH.undefined?zH(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}XB.create=(e,t)=>new XB({innerType:e,typeName:iF.ZodOptional,...oB(t)});class zB extends iB{_parse(e){return this._getType(e)===GH.null?zH(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}zB.create=(e,t)=>new zB({innerType:e,typeName:iF.ZodNullable,...oB(t)});class QB extends iB{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===GH.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}QB.create=(e,t)=>new QB({innerType:e,typeName:iF.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...oB(t)});class JB extends iB{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return tB(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new HH(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new HH(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}JB.create=(e,t)=>new JB({innerType:e,typeName:iF.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...oB(t)});class eF extends iB{_parse(e){if(this._getType(e)!==GH.nan){const t=this._getOrReturnCtx(e);return KH(t,{code:VH.invalid_type,expected:GH.nan,received:t.parsedType}),ZH}return{status:"valid",value:e.data}}}eF.create=e=>new eF({typeName:iF.ZodNaN,...oB(e)});const tF=Symbol("zod_brand");class nF extends iB{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class rF extends iB{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?ZH:"dirty"===e.status?(t.dirty(),XH(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?ZH:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new rF({in:e,out:t,typeName:iF.ZodPipeline})}}const sF=(e,t={},n)=>e?OB.create().superRefine((r,s)=>{var o,i;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,a=null===(i=null!==(o=e.fatal)&&void 0!==o?o:n)||void 0===i||i,c="string"==typeof e?{message:e}:e;s.addIssue({code:"custom",...c,fatal:a})}}):OB.create(),oF={object:wB.lazycreate};var iF;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"}(iF||(iF={}));const aF=gB.create,cF=SB.create,uF=eF.create,lF=TB.create,pF=yB.create,dF=AB.create,hF=vB.create,fF=bB.create,_F=RB.create,mF=OB.create,gF=NB.create,EF=CB.create,SF=IB.create,TF=PB.create,yF=wB.create,AF=wB.strictCreate,vF=LB.create,bF=DB.create,RF=UB.create,OF=$B.create,NF=GB.create,CF=jB.create,IF=VB.create,PF=HB.create,MF=BB.create,wF=FB.create,LF=qB.create,xF=KB.create,DF=WB.create,kF=ZB.create,UF=XB.create,$F=zB.create,GF=ZB.createWithPreprocess,jF=rF.create,VF={string:e=>gB.create({...e,coerce:!0}),number:e=>SB.create({...e,coerce:!0}),boolean:e=>yB.create({...e,coerce:!0}),bigint:e=>TB.create({...e,coerce:!0}),date:e=>AB.create({...e,coerce:!0})},HF=ZH;var BF=Object.freeze({__proto__:null,defaultErrorMap:BH,setErrorMap:function(e){FH=e},getErrorMap:YH,makeIssue:qH,EMPTY_PATH:[],addIssueToContext:KH,ParseStatus:WH,INVALID:ZH,DIRTY:XH,OK:zH,isAborted:QH,isDirty:JH,isValid:eB,isAsync:tB,get util(){return kH},get objectUtil(){return UH},ZodParsedType:GH,getParsedType:jH,ZodType:iB,ZodString:gB,ZodNumber:SB,ZodBigInt:TB,ZodBoolean:yB,ZodDate:AB,ZodSymbol:vB,ZodUndefined:bB,ZodNull:RB,ZodAny:OB,ZodUnknown:NB,ZodNever:CB,ZodVoid:IB,ZodArray:PB,ZodObject:wB,ZodUnion:LB,ZodDiscriminatedUnion:DB,ZodIntersection:UB,ZodTuple:$B,ZodRecord:GB,ZodMap:jB,ZodSet:VB,ZodFunction:HB,ZodLazy:BB,ZodLiteral:FB,ZodEnum:qB,ZodNativeEnum:KB,ZodPromise:WB,ZodEffects:ZB,ZodTransformer:ZB,ZodOptional:XB,ZodNullable:zB,ZodDefault:QB,ZodCatch:JB,ZodNaN:eF,BRAND:tF,ZodBranded:nF,ZodPipeline:rF,custom:sF,Schema:iB,ZodSchema:iB,late:oF,get ZodFirstPartyTypeKind(){return iF},coerce:VF,any:mF,array:TF,bigint:lF,boolean:pF,date:dF,discriminatedUnion:bF,effect:kF,enum:LF,function:PF,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>sF(t=>t instanceof e,t),intersection:RF,lazy:MF,literal:wF,map:CF,nan:uF,nativeEnum:xF,never:EF,null:_F,nullable:$F,number:cF,object:yF,oboolean:()=>pF().optional(),onumber:()=>cF().optional(),optional:UF,ostring:()=>aF().optional(),pipeline:jF,preprocess:GF,promise:DF,record:NF,set:IF,strictObject:AF,string:aF,symbol:hF,transformer:kF,tuple:OF,undefined:fF,union:vF,unknown:gF,void:SF,NEVER:HF,ZodIssueCode:VH,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:HH});const FF=["interface","display","layout","module","panel"],YF=["hook","endpoint"],qF=["operation"],KF="directus:extension",WF=BF.object({app:BF.string(),api:BF.string()}),ZF=BF.union([BF.object({type:BF.union([BF.enum(FF),BF.enum(YF)]),name:BF.string(),source:BF.string()}),BF.object({type:BF.enum(qF),name:BF.string(),source:WF})]),XF=BF.object({host:BF.string(),hidden:BF.boolean().optional()}),zF=BF.object({type:BF.union([BF.enum(FF),BF.enum(YF)]),path:BF.string(),source:BF.string()}),QF=BF.object({type:BF.enum(qF),path:WF,source:WF}),JF=BF.object({type:BF.literal("bundle"),path:WF,entries:BF.array(ZF)});BF.array(ZF);const eY=XF.and(BF.union([zF,QF,JF]));var tY,nY;BF.object({name:BF.string(),version:BF.string(),dependencies:BF.record(BF.string()).optional(),[KF]:eY}),function(e){e.NULL="null",e.UNDEFINED="undefined",e.STRING="string",e.INTEGER="integer",e.FLOAT="float",e.BOOLEAN="boolean",e.EMPTY="empty"}(tY||(tY={})),function(e){e[e.TRUE=-1]="TRUE",e[e.FALSE=-2]="FALSE",e[e.NULL=-3]="NULL",e[e.EMPTY=-4]="EMPTY",e[e.UNDEFINED=-5]="UNDEFINED"}(nY||(nY={}));var rY=(0).constructor;rY.isFinite,rY.isInteger,[].constructor.isArray;new(function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var n=this.cachedKeys[this.oldestIndex];void 0!==n&&delete this.map[n],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}())(1e3);var sY,oY,iY,aY,cY,uY,lY,pY={exports:{}};function dY(){return iY||(iY=1,function(e,t){const n=oY?sY:(oY=1,sY=function(...e){try{return JSON.stringify(...e)}catch(e){return"[Cannot display object: "+e.message+"]"}});pY.exports=class extends Error{constructor(e){super(e.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:n(e)).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}}(0,pY.exports)),pY.exports}function hY(){if(cY)return aY;cY=1;const e=dY();return aY=function(t,...n){if(!t){if(1===n.length&&n[0]instanceof Error)throw n[0];throw new e(n)}}}function fY(){if(lY)return uY;lY=1;const e=hY(),t={};return uY=function(n,r,s){if(!1===r||null==r)return n;"string"==typeof(s=s||{})&&(s={separator:s});const o=Array.isArray(r);e(!o||!s.separator,"Separator option is not valid for array-based chain");const i=o?r:r.split(s.separator||".");let a=n;for(let n=0;n<i.length;++n){let o=i[n];const c=s.iterables&&t.iterables(a);if(Array.isArray(a)||"set"===c){const e=Number(o);Number.isInteger(e)&&(o=e<0?a.length+e:e)}if(!a||"function"==typeof a&&!1===s.functions||!c&&void 0===a[o]){e(!s.strict||n+1===i.length,"Missing segment",o,"in reach path ",r),e("object"==typeof a||!0===s.functions||"function"!=typeof a,"Invalid segment",o,"in reach path ",r),a=s.default;break}a=c?"set"===c?[...a][o]:a.get(o):a[o]}return a},t.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0},uY}var _Y,mY={exports:{}};function gY(){return _Y||(_Y=1,function(e,t){const n={};t=mY.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},n.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const r=Object.prototype.toString.call(e);return n.typeMap.get(r)||t.generic}}(0,mY.exports)),mY.exports}var EY,SY,TY,yY={};function AY(){return EY||(EY=1,yY.keys=function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}),yY}function vY(){if(TY)return SY;TY=1;const e=fY(),t=gY(),n=AY(),r={needsProtoHack:new Set([t.set,t.map,t.weakSet,t.weakMap])};return SY=r.clone=function(e,s={},o=null){if("object"!=typeof e||null===e)return e;let i=r.clone,a=o;if(s.shallow){if(!0!==s.shallow)return r.cloneWithShallow(e,s);i=e=>e}else if(a){const t=a.get(e);if(t)return t}else a=new Map;const c=t.getInternalProto(e);if(c===t.buffer)return Buffer&&Buffer.from(e);if(c===t.date)return new Date(e.getTime());if(c===t.regex)return new RegExp(e);const u=r.base(e,c,s);if(u===e)return e;if(a&&a.set(e,u),c===t.set)for(const t of e)u.add(i(t,s,a));else if(c===t.map)for(const[t,n]of e)u.set(t,i(n,s,a));const l=n.keys(e,s);for(const n of l){if("__proto__"===n)continue;if(c===t.array&&"length"===n){u.length=e.length;continue}const r=Object.getOwnPropertyDescriptor(e,n);r?r.get||r.set?Object.defineProperty(u,n,r):r.enumerable?u[n]=i(e[n],s,a):Object.defineProperty(u,n,{enumerable:!1,writable:!0,configurable:!0,value:i(e[n],s,a)}):Object.defineProperty(u,n,{enumerable:!0,writable:!0,configurable:!0,value:i(e[n],s,a)})}return u},r.cloneWithShallow=function(t,n){const s=n.shallow;(n=Object.assign({},n)).shallow=!1;const o=new Map;for(const n of s){const r=e(t,n);"object"!=typeof r&&"function"!=typeof r||o.set(r,r)}return r.clone(t,n,o)},r.base=function(e,n,s){if(!1===s.prototype)return r.needsProtoHack.has(n)?new n.constructor:n===t.array?[]:{};const o=Object.getPrototypeOf(e);if(o&&o.isImmutable)return e;if(n===t.array){const e=[];return o!==n&&Object.setPrototypeOf(e,o),e}if(r.needsProtoHack.has(n)){const e=new o.constructor;return o!==n&&Object.setPrototypeOf(e,o),e}return Object.create(o)},SY}var bY,RY={},OY={},NY={name:"joi",description:"Object schema validation",version:"17.9.1",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.0.0","@hapi/topo":"^5.0.0","@sideway/address":"^4.1.3","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.0.1","@types/node":"^14.18.24",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"},CY={};function IY(){if(bY)return CY;bY=1;const e=YK(),t={};return t.wrap=e.string().min(1).max(2).allow(!1),CY.preferences=e.object({allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),context:e.object(),convert:e.boolean(),dateFormat:e.valid("date","iso","string","time","utc"),debug:e.boolean(),errors:{escapeHtml:e.boolean(),label:e.valid("path","key",!1),language:[e.string(),e.object().ref()],render:e.boolean(),stack:e.boolean(),wrap:{label:t.wrap,array:t.wrap,string:t.wrap}},externals:e.boolean(),messages:e.object(),noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:e.valid("required","optional","forbidden"),skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()}).strict(),t.nameRx=/^[a-zA-Z0-9]\w*$/,t.rule=e.object({alias:e.array().items(e.string().pattern(t.nameRx)).single(),args:e.array().items(e.string(),e.object({name:e.string().pattern(t.nameRx).required(),ref:e.boolean(),assert:e.alternatives([e.function(),e.object().schema()]).conditional("ref",{is:!0,then:e.required()}),normalize:e.function(),message:e.string().when("assert",{is:e.function(),then:e.required()})})),convert:e.boolean(),manifest:e.boolean(),method:e.function().allow(!1),multi:e.boolean(),validate:e.function()}),CY.extension=e.object({type:e.alternatives([e.string(),e.object().regex()]).required(),args:e.function(),cast:e.object().pattern(t.nameRx,e.object({from:e.function().maxArity(1).required(),to:e.function().minArity(1).maxArity(2).required()})),base:e.object().schema().when("type",{is:e.object().regex(),then:e.forbidden()}),coerce:[e.function().maxArity(3),e.object({method:e.function().maxArity(3).required(),from:e.array().items(e.string()).single()})],flags:e.object().pattern(t.nameRx,e.object({setter:e.string(),default:e.any()})),manifest:{build:e.function().arity(2)},messages:[e.object(),e.string()],modifiers:e.object().pattern(t.nameRx,e.function().minArity(1).maxArity(2)),overrides:e.object().pattern(t.nameRx,e.function()),prepare:e.function().maxArity(3),rebuild:e.function().arity(1),rules:e.object().pattern(t.nameRx,t.rule),terms:e.object().pattern(t.nameRx,e.object({init:e.array().allow(null).required(),manifest:e.object().pattern(/.+/,[e.valid("schema","single"),e.object({mapped:e.object({from:e.string().required(),to:e.string().required()}).required()})])})),validate:e.function().maxArity(3)}).strict(),CY.extensions=e.array().items(e.object(),e.function().arity(1)).strict(),t.desc={buffer:e.object({buffer:e.string()}),func:e.object({function:e.function().required(),options:{literal:!0}}),override:e.object({override:!0}),ref:e.object({ref:e.object({type:e.valid("value","global","local"),path:e.array().required(),separator:e.string().length(1).allow(!1),ancestor:e.number().min(0).integer().allow("root"),map:e.array().items(e.array().length(2)).min(1),adjust:e.function(),iterables:e.boolean(),in:e.boolean(),render:e.boolean()}).required()}),regex:e.object({regex:e.string().min(3)}),special:e.object({special:e.valid("deep").required()}),template:e.object({template:e.string().required(),options:e.object()}),value:e.object({value:e.alternatives([e.object(),e.array()]).required()})},t.desc.entity=e.alternatives([e.array().items(e.link("...")),e.boolean(),e.function(),e.number(),e.string(),t.desc.buffer,t.desc.func,t.desc.ref,t.desc.regex,t.desc.special,t.desc.template,t.desc.value,e.link("/")]),t.desc.values=e.array().items(null,e.boolean(),e.function(),e.number().allow(1/0,-1/0),e.string().allow(""),e.symbol(),t.desc.buffer,t.desc.func,t.desc.override,t.desc.ref,t.desc.regex,t.desc.template,t.desc.value),t.desc.messages=e.object().pattern(/.+/,[e.string(),t.desc.template,e.object().pattern(/.+/,[e.string(),t.desc.template])]),CY.description=e.object({type:e.string().required(),flags:e.object({cast:e.string(),default:e.any(),description:e.string(),empty:e.link("/"),failover:t.desc.entity,id:e.string(),label:e.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:e.boolean(),unit:e.string()}).unknown(),preferences:{allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),convert:e.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:e.boolean(),label:["path","key"],language:[e.string(),t.desc.ref],wrap:{label:t.wrap,array:t.wrap}},externals:e.boolean(),messages:t.desc.messages,noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:["required","optional","forbidden"],skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()},allow:t.desc.values,invalid:t.desc.values,rules:e.array().min(1).items({name:e.string().required(),args:e.object().min(1),keep:e.boolean(),message:[e.string(),t.desc.messages],warn:e.boolean()}),keys:e.object().pattern(/.*/,e.link("/")),link:t.desc.ref}).pattern(/^[a-z]\w*$/,e.any()),CY}var PY={},MY={exports:{}};const wY={};var LY=function(e){if(!e)return"";let t="";for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);wY.isSafe(r)?t+=e[n]:t+=wY.escapeHtmlChar(r)}return t};wY.escapeHtmlChar=function(e){const t=wY.namedHtml.get(e);if(t)return t;if(e>=256)return"&#"+e+";";return`&#x${e.toString(16).padStart(2,"0")};`},wY.isSafe=function(e){return wY.safeCharCodes.has(e)},wY.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),wY.safeCharCodes=function(){const e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&e.add(t);return e}();var xY,DY={};var kY,UY,$Y={},GY={};function jY(){if(kY)return GY;kY=1;const e=vY(),t=zY(),n={annotations:Symbol("annotations")};return GY.error=function(r){if(!this._original||"object"!=typeof this._original)return this.details[0].message;const s=r?"":"[31m",o=r?"":"[41m",i=r?"":"[0m",a=e(this._original);for(let e=this.details.length-1;e>=0;--e){const r=e+1,s=this.details[e],o=s.path;let i=a;for(let e=0;;++e){const a=o[e];if(t.isSchema(i)&&(i=i.clone()),!(e+1<o.length&&"string"!=typeof i[a])){const e=i[n.annotations]||{errors:{},missing:{}};i[n.annotations]=e;const t=a||s.context.key;void 0!==i[a]?(e.errors[t]=e.errors[t]||[],e.errors[t].push(r)):e.missing[t]=r;break}i=i[a]}}const c=/_\$key\$_([, \d]+)_\$end\$_"/g,u=/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,l=/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,p=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g;let d=n.safeStringify(a,2).replace(c,(e,t)=>`" ${s}[${t}]${i}`).replace(u,(e,t,n)=>`${o}"${t}"${i}${s} [${n}]: -- missing --${i}`).replace(l,(e,t,n)=>`\n${n} ${s}[${t}]${i}`).replace(p,(e,t)=>t);d=`${d}\n${s}`;for(let e=0;e<this.details.length;++e){d=`${d}\n[${e+1}] ${this.details[e].message}`}return d+=i,d},n.safeStringify=function(e,t){return JSON.stringify(e,n.serializer(),t)},n.serializer=function(){const e=[],t=[],r=(n,r)=>t[0]===r?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(r)).join(".")+"]";return function(s,o){if(t.length>0){const n=t.indexOf(this);~n?(t.length=n+1,e.length=n+1,e[n]=s):(t.push(this),e.push(s)),~t.indexOf(o)&&(o=r.call(this,s,o))}else t.push(o);if(o){const e=o[n.annotations];if(e){if(Array.isArray(o)){const t=[];for(let n=0;n<o.length;++n)e.errors[n]&&t.push(`_$idx$_${e.errors[n].sort().join(", ")}_$end$_`),t.push(o[n]);o=t}else{for(const t in e.errors)o[`${t}_$key$_${e.errors[t].sort().join(", ")}_$end$_`]=o[t],o[t]=void 0;for(const t in e.missing)o[`_$miss$_${t}|${e.missing[t]}_$end$_`]="__missing__"}return o}}return o===1/0||o===-1/0||Number.isNaN(o)||"function"==typeof o||"symbol"==typeof o?"["+o.toString()+"]":o}},GY}function VY(){return UY||(UY=1,function(e){const t=jY(),n=zY(),r=ZY();e.Report=class{constructor(t,n,r,s,o,i,a){if(this.code=t,this.flags=s,this.messages=o,this.path=i.path,this.prefs=a,this.state=i,this.value=n,this.message=null,this.template=null,this.local=r||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;const e=this.code;if(!this.prefs.errors.render)return this.code;const t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===t?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,n){return e.template(this.value,t,n||this.code,this.state,this.prefs)}},e.path=function(e){let t="";for(const n of e)"object"!=typeof n&&("string"==typeof n?(t&&(t+="."),t+=n):t+=`[${n}]`);return t},e.template=function(e,t,s,o,i){if(!t)return;if(r.isTemplate(t))return"root"!==s?t:null;let a=i.errors.language;if(n.isResolvable(a)&&(a=a.resolve(e,o,i)),a&&t[a]){if(void 0!==t[a][s])return t[a][s];if(void 0!==t[a]["*"])return t[a]["*"]}return t[s]?t[s]:t["*"]},e.label=function(t,n,r,s){if(t.label)return t.label;if(!r.errors.label)return"";let o=n.path;"key"===r.errors.label&&n.path.length>1&&(o=n.path.slice(-1));const i=e.path(o);return i||(e.template(null,r.messages,"root",n,r)||s&&e.template(null,s,"root",n,r)||"value")},e.process=function(t,n,r){if(!t)return null;const{override:s,message:o,details:i}=e.details(t);if(s)return s;if(r.errors.stack)return new e.ValidationError(o,i,n);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const c=new e.ValidationError(o,i,n);return Error.stackTraceLimit=a,c},e.details=function(e,t={}){let n=[];const r=[];for(const s of e){if(s instanceof Error){if(!1!==t.override)return{override:s};const e=s.toString();n.push(e),r.push({message:e,type:"override",context:{error:s}});continue}const e=s.toString();n.push(e),r.push({message:e,path:s.path.filter(e=>"object"!=typeof e),type:s.code,context:s.local})}return n.length>1&&(n=[...new Set(n)]),{message:n.join(". "),details:r}},e.ValidationError=class extends Error{constructor(e,t,n){super(e),this._original=n,this.details=t}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=t.error}($Y)),$Y}var HY,BY,FY,YY,qY,KY={};function WY(){return HY||(HY=1,function(e){const t=hY(),n=vY(),r=fY(),s=zY();let o;const i={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(e,n={}){t("string"==typeof e,"Invalid reference key:",e),s.assertOptions(n,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!n.prefix||"object"==typeof n.prefix,"options.prefix must be of type object");const r=Object.assign({},i.defaults,n);delete r.prefix;const o=r.separator,a=i.context(e,o,n.prefix);if(r.type=a.type,e=a.key,"value"===r.type)if(a.root&&(t(!o||e[0]!==o,"Cannot specify relative path with root prefix"),r.ancestor="root",e||(e=null)),o&&o===e)e=null,r.ancestor=0;else if(void 0!==r.ancestor)t(!o||!e||e[0]!==o,"Cannot combine prefix with ancestor option");else{const[t,n]=i.ancestor(e,o);n&&""===(e=e.slice(n))&&(e=null),r.ancestor=t}return r.path=o?null===e?[]:e.split(o):[e],new i.Ref(r)},e.in=function(t,n={}){return e.create(t,{...n,in:!0})},e.isRef=function(e){return!!e&&!!e[s.symbols.ref]},i.Ref=class{constructor(e){t("object"==typeof e,"Invalid reference construction"),s.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),t(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),t(!e.map||Array.isArray(e.map),"options.map must be an array"),t(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,i.defaults,e),t("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,n,r,s,o={}){return t(!this.in||o.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(r.context,n,o):"local"===this.type?this._resolve(s,n,o):this.ancestor?"root"===this.ancestor?this._resolve(n.ancestors[n.ancestors.length-1],n,o):(t(this.ancestor<=n.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(n.ancestors[this.ancestor-1],n,o)):this._resolve(e,n,o)}_resolve(e,t,n){let s;if("value"===this.type&&t.mainstay.shadow&&!1!==n.shadow&&(s=t.mainstay.shadow.get(this.absolute(t))),void 0===s&&(s=r(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(s=this.adjust(s)),this.map){const e=this.map.get(s);void 0!==e&&(s=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,s),s}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new i.Ref(this)}describe(){const e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){const e=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display=`ref:${this.type}:${e}`);if(!this.separator)return void(this.display=`ref:${e}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${e}`);if("root"===this.ancestor)return void(this.display=`ref:root:${e}`);if(1===this.ancestor)return void(this.display=`ref:${e||".."}`);const t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}},i.Ref.prototype[s.symbols.ref]=!0,e.build=function(e){return"value"===(e=Object.assign({},i.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new i.Ref(e)},i.context=function(e,t,n={}){if(e=e.trim(),n){const r=void 0===n.global?"$":n.global;if(r!==t&&e.startsWith(r))return{key:e.slice(r.length),type:"global"};const s=void 0===n.local?"#":n.local;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"local"};const o=void 0===n.root?"/":n.root;if(o!==t&&e.startsWith(o))return{key:e.slice(o.length),type:"value",root:!0}}return{key:e,type:"value"}},i.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let n=2;for(;e[n]===t;)++n;return[n-1,n]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,n){if(t)if(n=void 0===n?e.toParent:n,Array.isArray(t))for(const e of t)this.register(e,n);else if(s.isSchema(t))for(const e of t._refs.refs)e.ancestor-n>=0&&this.refs.push({ancestor:e.ancestor-n,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-n>=0&&this.refs.push({ancestor:t.ancestor-n,root:t.root}),o=o||ZY(),o.isTemplate(t)&&this.register(t.refs(),n)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=n(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}}(KY)),KY}function ZY(){return BY||(BY=1,function(e){const t=hY(),n=vY(),r=LY,s=(xY||(xY=1,function(e){const t={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(e,n={}){if(!n[t.settings]&&n.constants)for(const e in n.constants){const t=n.constants[e];if(null!==t&&!["boolean","number","string"].includes(typeof t))throw new Error(`Formula constant ${e} contains invalid ${typeof t} value type`)}this.settings=n[t.settings]?n:Object.assign({[t.settings]:!0,constants:{},functions:{}},n),this.single=null,this._parts=null,this._parse(e)}_parse(n){let r=[],s="",o=0,i=!1;const a=n=>{if(o)throw new Error("Formula missing closing parenthesis");const a=r.length?r[r.length-1]:null;if(i||s||n){if(a&&"reference"===a.type&&")"===n)return a.type="function",a.value=this._subFormula(s,a.value),void(s="");if(")"===n){const t=new e.Parser(s,this.settings);r.push({type:"segment",value:t})}else if(i){if("]"===i)return r.push({type:"reference",value:s}),void(s="");r.push({type:"literal",value:s})}else if(t.operatorCharacters.includes(s))a&&"operator"===a.type&&t.operators.includes(a.value+s)?a.value+=s:r.push({type:"operator",value:s});else if(s.match(t.numberRx))r.push({type:"constant",value:parseFloat(s)});else if(void 0!==this.settings.constants[s])r.push({type:"constant",value:this.settings.constants[s]});else{if(!s.match(t.tokenRx))throw new Error(`Formula contains invalid token: ${s}`);r.push({type:"reference",value:s})}s=""}};for(const e of n)i?e===i?(a(),i=!1):s+=e:o?"("===e?(s+=e,++o):")"===e?(--o,o?s+=e:a(e)):s+=e:e in t.literals?i=t.literals[e]:"("===e?(a(),++o):t.operatorCharacters.includes(e)?(a(),s=e,a()):" "!==e?s+=e:a();a(),r=r.map((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==r[t-1].type?e:{type:"operator",value:"n"});let c=!1;for(const e of r){if("operator"===e.type){if(t.operatorsPrefix.includes(e.value))continue;if(!c)throw new Error("Formula contains an operator in invalid position");if(!t.operators.includes(e.value))throw new Error(`Formula contains an unknown operator ${e.value}`)}else if(c)throw new Error("Formula missing expected operator");c=!c}if(!c)throw new Error("Formula contains invalid trailing operator");1===r.length&&["reference","literal","constant"].includes(r[0].type)&&(this.single={type:"reference"===r[0].type?"reference":"value",value:r[0].value}),this._parts=r.map(e=>{if("operator"===e.type)return t.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error(`Formula contains invalid reference ${e.value}`);return this.settings.reference?this.settings.reference(e.value):t.reference(e.value)})}_subFormula(n,r){const s=this.settings.functions[r];if("function"!=typeof s)throw new Error(`Formula contains unknown function ${r}`);let o=[];if(n){let e="",s=0,i=!1;const a=()=>{if(!e)throw new Error(`Formula contains function ${r} with invalid arguments ${n}`);o.push(e),e=""};for(let r=0;r<n.length;++r){const o=n[r];i?(e+=o,o===i&&(i=!1)):o in t.literals&&!s?(e+=o,i=t.literals[o]):","!==o||s?(e+=o,"("===o?++s:")"===o&&--s):a()}a()}return o=o.map(t=>new e.Parser(t,this.settings)),function(e){const t=[];for(const n of o)t.push(n.evaluate(e));return s.call(e,...t)}}evaluate(e){const n=this._parts.slice();for(let r=n.length-2;r>=0;--r){const s=n[r];if(s&&"operator"===s.type){const o=n[r+1];n.splice(r+1,1);const i=t.evaluate(o,e);n[r]=t.single(s.value,i)}}return t.operatorsOrder.forEach(r=>{for(let s=1;s<n.length-1;)if(r.includes(n[s])){const r=n[s],o=t.evaluate(n[s-1],e),i=t.evaluate(n[s+1],e);n.splice(s,2);const a=t.calculate(r,o,i);n[s-1]=0===a?0:a}else s+=2}),t.evaluate(n[0],e)}},e.Parser.prototype[t.symbol]=!0,t.reference=function(e){return function(t){return t&&void 0!==t[e]?t[e]:null}},t.evaluate=function(e,n){return null===e?null:"function"==typeof e?e(n):e[t.symbol]?e.evaluate(n):e},t.single=function(e,t){if("!"===e)return!t;const n=-t;return 0===n?0:n},t.calculate=function(e,n,r){if("??"===e)return t.exists(n)?n:r;if("string"==typeof n||"string"==typeof r){if("+"===e)return(n=t.exists(n)?n:"")+(t.exists(r)?r:"")}else switch(e){case"^":return Math.pow(n,r);case"*":return n*r;case"/":return n/r;case"%":return n%r;case"+":return n+r;case"-":return n-r}switch(e){case"<":return n<r;case"<=":return n<=r;case">":return n>r;case">=":return n>=r;case"==":return n===r;case"!=":return n!==r;case"&&":return n&&r;case"||":return n||r}return null},t.exists=function(e){return null!=e}}(DY)),DY),o=zY(),i=VY(),a=WY(),c={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=c.Template=class{constructor(e,r){t("string"==typeof e,"Template source must be a string"),t(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,this._settings=n(r),this._parse()}_parse(){if(!this.source.includes("{"))return;const e=c.encode(this.source),t=c.split(e);let n=!1;const r=[],s=t.shift();s&&r.push(s);for(const e of t){const t="{"!==e[0],s=t?"}":"}}",o=e.indexOf(s);if(-1===o||"{"===e[1]){r.push(`{${c.decode(e)}`);continue}let i=e.slice(t?0:1,o);const a=":"===i[0];a&&(i=i.slice(1));const u=this._ref(c.decode(i),{raw:t,wrapped:a});r.push(u),"string"!=typeof u&&(n=!0);const l=e.slice(o+s.length);l&&r.push(c.decode(l))}n?this._template=r:this.rendered=r.join("")}static date(e,t){return c.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;const t={template:this.source};return this._settings&&(t.options=this._settings),t}static build(e){return new c.Template(e.template,e.options)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[o.symbols.template]}refs(){if(!this._template)return;const e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}resolve(e,t,n,r){return this._template&&1===this._template.length?this._part(this._template[0],e,t,n,r,{}):this.render(e,t,n,r)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,n,s,o={}){if(!this.isDynamic())return this.rendered;const i=[];for(const a of this._template)if("string"==typeof a)i.push(a);else{const u=this._part(a,e,t,n,s,o),l=c.stringify(u,e,t,n,s,o);if(void 0!==l){const e=a.raw||!1===(o.errors&&o.errors.escapeHtml)?l:r(l);i.push(c.wrap(e,a.wrapped&&n.errors.wrap.label))}}return i.join("")}_ref(e,{raw:t,wrapped:n}){const r=[],o=e=>{const t=a.create(e,this._settings);return r.push(t),e=>t.resolve(...e)};try{var i=new s.Parser(e,{reference:o,functions:c.functions,constants:c.constants})}catch(t){throw t.message=`Invalid template variable "${e}" fails due to: ${t.message}`,t}if(i.single){if("reference"===i.single.type){const e=r[0];return{ref:e,raw:t,refs:r,wrapped:n||"local"===e.type&&"label"===e.key}}return c.stringify(i.single.value)}return{formula:i,raw:t,refs:r}}toString(){return this.source}},c.Template.prototype[o.symbols.template]=!0,c.Template.prototype.isImmutable=!0,c.encode=function(e){return e.replace(/\\(\{+)/g,(e,t)=>c.opens.slice(0,t.length)).replace(/\\(\}+)/g,(e,t)=>c.closes.slice(0,t.length))},c.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},c.split=function(e){const t=[];let n="";for(let r=0;r<e.length;++r){const s=e[r];if("{"===s){let s="";for(;r+1<e.length&&"{"===e[r+1];)s+="{",++r;t.push(n),n=s}else n+=s}return t.push(n),t},c.wrap=function(e,t){return t?1===t.length?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e},c.stringify=function(e,t,n,r,s,o={}){const i=typeof e,u=r&&r.errors&&r.errors.wrap||{};let l=!1;if(a.isRef(e)&&e.render&&(l=e.in,e=e.resolve(t,n,r,s,{in:e.in,...o})),null===e)return"null";if("string"===i)return c.wrap(e,o.arrayItems&&u.string);if("number"===i||"function"===i||"symbol"===i)return e.toString();if("object"!==i)return JSON.stringify(e);if(e instanceof Date)return c.Template.date(e,r);if(e instanceof Map){const t=[];for(const[n,r]of e.entries())t.push(`${n.toString()} -> ${r.toString()}`);e=t}if(!Array.isArray(e))return e.toString();const p=[];for(const i of e)p.push(c.stringify(i,t,n,r,s,{arrayItems:!0,...o}));return c.wrap(p.join(", "),!l&&u.array)},c.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},c.functions={if:(e,t,n)=>e?t:n,length:e=>"string"==typeof e?e.length:e&&"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:null,msg(e){const[t,n,r,s,o]=this,a=o.messages;if(!a)return"";const c=i.template(t,a[0],e,n,r)||i.template(t,a[1],e,n,r);return c?c.render(t,n,r,s,o):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}}(MY)),MY.exports}function XY(){return FY||(FY=1,function(e){const t=hY(),n=vY(),r=ZY();e.compile=function(e,s){if("string"==typeof e)return t(!s,"Cannot set single message string"),new r(e);if(r.isTemplate(e))return t(!s,"Cannot set single message template"),e;t("object"==typeof e&&!Array.isArray(e),"Invalid message options"),s=s?n(s):{};for(let n in e){const o=e[n];if("root"===n||r.isTemplate(o)){s[n]=o;continue}if("string"==typeof o){s[n]=new r(o);continue}t("object"==typeof o&&!Array.isArray(o),"Invalid message for",n);const i=n;for(n in s[i]=s[i]||{},o){const e=o[n];"root"===n||r.isTemplate(e)?s[i][n]=e:(t("string"==typeof e,"Invalid message for",n,"in",i),s[i][n]=new r(e))}}return s},e.decompile=function(e){const t={};for(let n in e){const s=e[n];if("root"===n){t.root=s;continue}if(r.isTemplate(s)){t[n]=s.describe({compact:!0});continue}const o=n;for(n in t[o]={},s){const e=s[n];"root"!==n?t[o][n]=e.describe({compact:!0}):t[o].root=e}}return t},e.merge=function(s,o){if(!s)return e.compile(o);if(!o)return s;if("string"==typeof o)return new r(o);if(r.isTemplate(o))return o;const i=n(s);for(let e in o){const n=o[e];if("root"===e||r.isTemplate(n)){i[e]=n;continue}if("string"==typeof n){i[e]=new r(n);continue}t("object"==typeof n&&!Array.isArray(n),"Invalid message for",e);const s=e;for(e in i[s]=i[s]||{},n){const o=n[e];"root"===e||r.isTemplate(o)?i[s][e]=o:(t("string"==typeof o,"Invalid message for",e,"in",s),i[s][e]=new r(o))}}return i}}(PY)),PY}function zY(){return YY||(YY=1,function(e){const t=hY(),n=dY(),r=NY;let s,o;const i={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=r.version,e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},e.assertOptions=function(e,n,r="Options"){t(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");const s=Object.keys(e).filter(e=>!n.includes(e));t(0===s.length,`${r} contain unknown keys: ${s}`)},e.checkPreferences=function(e){o=o||IY();const t=o.preferences.validate(e);if(t.error)throw new n([t.error.details[0].message])},e.compare=function(e,t,n){switch(n){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}},e.default=function(e,t){return void 0===e?t:e},e.isIsoDate=function(e){return i.isoDate.test(e)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(n,r={}){const s=n&&n[e.symbols.any];return!!s&&(t(r.legacy||s.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(e){return Number.isSafeInteger(e)&&e>=0},e.preferences=function(t,n){s=s||XY(),t=t||{},n=n||{};const r=Object.assign({},t,n);return n.errors&&t.errors&&(r.errors=Object.assign({},t.errors,n.errors),r.errors.wrap=Object.assign({},t.errors.wrap,n.errors.wrap)),n.messages&&(r.messages=s.compile(n.messages,t.messages)),delete r[e.symbols.prefs],r},e.tryWithPath=function(e,t,n={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,n.append&&(e.message=`${e.message} (${e.path})`),e}},e.validateArg=function(t,n,{assert:r,message:s}){if(e.isSchema(r)){const e=r.validate(t);if(!e.error)return;return e.error.message}if(!r(t))return n?`${n} ${s}`:s},e.verifyFlat=function(e,n){for(const r of e)t(!Array.isArray(r),"Method no longer accepts array arguments:",n)}}(OY)),OY}function QY(){if(qY)return RY;qY=1;const e=hY(),t=vY(),n=zY(),r={max:1e3,supported:new Set(["undefined","boolean","number","string"])};return RY.provider={provision:e=>new r.Cache(e)},r.Cache=class{constructor(t={}){n.assertOptions(t,["max"]),e(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||r.max,this._map=new Map,this._list=new r.List}get length(){return this._map.size}set(e,t){if(null!==e&&!r.supported.has(typeof e))return;let n=this._map.get(e);if(n)return n.value=t,void this._list.first(n);n=this._list.unshift({key:e,value:t}),this._map.set(e,n),this._compact()}get(e){const n=this._map.get(e);if(n)return this._list.first(n),t(n.value)}_compact(){if(this._map.size>this._max){const e=this._list.pop();this._map.delete(e.key)}}},r.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){const{next:t,prev:n}=e;return t.prev=n,n&&(n.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}},RY}var JY,eq={};function tq(){return JY||(JY=1,function(e){const t=hY(),n=zY(),r=WY(),s={};e.schema=function(e,t,r={}){n.assertOptions(r,["appendPath","override"]);try{return s.schema(e,t,r)}catch(e){throw r.appendPath&&void 0!==e.path&&(e.message=`${e.message} (${e.path})`),e}},s.schema=function(e,r,o){t(void 0!==r,"Invalid undefined schema"),Array.isArray(r)&&(t(r.length,"Invalid empty array schema"),1===r.length&&(r=r[0]));const i=(t,...n)=>!1!==o.override?t.valid(e.override,...n):t.valid(...n);if(s.simple(r))return i(e,r);if("function"==typeof r)return e.custom(r);if(t("object"==typeof r,"Invalid schema content:",typeof r),n.isResolvable(r))return i(e,r);if(n.isSchema(r))return r;if(Array.isArray(r)){for(const t of r)if(!s.simple(t))return e.alternatives().try(...r);return i(e,...r)}return r instanceof RegExp?e.string().regex(r):r instanceof Date?i(e.date(),r):(t(Object.getPrototypeOf(r)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(r))},e.ref=function(e,t){return r.isRef(e)?e:r.create(e,t)},e.compile=function(r,o,i={}){n.assertOptions(i,["legacy"]);const a=o&&o[n.symbols.any];if(a)return t(i.legacy||a.version===n.version,"Cannot mix different versions of joi schemas:",a.version,n.version),o;if("object"!=typeof o||!i.legacy)return e.schema(r,o,{appendPath:!0});const c=s.walk(o);return c?c.compile(c.root,o):e.schema(r,o,{appendPath:!0})},s.walk=function(e){if("object"!=typeof e)return null;if(Array.isArray(e)){for(const t of e){const e=s.walk(t);if(e)return e}return null}const r=e[n.symbols.any];if(r)return{root:e[r.root],compile:r.compile};t(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const t in e){const n=s.walk(e[t]);if(n)return n}return null},s.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},e.when=function(o,i,a){if(void 0===a&&(t(i&&"object"==typeof i,"Missing options"),a=i,i=r.create(".")),Array.isArray(a)&&(a={switch:a}),n.assertOptions(a,["is","not","then","otherwise","switch","break"]),n.isSchema(i))return t(void 0===a.is,'"is" can not be used with a schema condition'),t(void 0===a.not,'"not" can not be used with a schema condition'),t(void 0===a.switch,'"switch" can not be used with a schema condition'),s.condition(o,{is:i,then:a.then,otherwise:a.otherwise,break:a.break});if(t(r.isRef(i)||"string"==typeof i,"Invalid condition:",i),t(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let c=a;void 0!==a.not&&(c={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let u=void 0!==c.is?o.$_compile(c.is):o.$_root.invalid(null,!1,0,"").required();return t(void 0!==c.then||void 0!==c.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),t(void 0===c.break||void 0===c.then||void 0===c.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||r.isRef(a.is)||n.isSchema(a.is)||(u=u.required()),s.condition(o,{ref:e.ref(i),is:u,then:c.then,otherwise:c.otherwise,break:c.break})}t(Array.isArray(a.switch),'"switch" must be an array'),t(void 0===a.is,'Cannot combine "switch" with "is"'),t(void 0===a.not,'Cannot combine "switch" with "not"'),t(void 0===a.then,'Cannot combine "switch" with "then"');const c={ref:e.ref(i),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const s=a.switch[e],i=e===a.switch.length-1;n.assertOptions(s,i?["is","then","otherwise"]:["is","then"]),t(void 0!==s.is,'Switch statement missing "is"'),t(void 0!==s.then,'Switch statement missing "then"');const u={is:o.$_compile(s.is),then:o.$_compile(s.then)};if(r.isRef(s.is)||n.isSchema(s.is)||(u.is=u.is.required()),i){t(void 0===a.otherwise||void 0===s.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:s.otherwise;void 0!==e&&(t(void 0===c.break,"Cannot specify both otherwise and break"),u.otherwise=o.$_compile(e))}c.switch.push(u)}return c},s.condition=function(e,t){for(const n of["then","otherwise"])void 0===t[n]?delete t[n]:t[n]=e.$_compile(t[n]);return t}}(eq)),eq}var nq,rq={};function sq(){if(nq)return rq;nq=1;const e=hY(),t=vY(),n=zY(),r=XY(),s={};return rq.type=function(o,i){const a=Object.getPrototypeOf(o),c=t(a),u=o._assign(Object.create(c)),l=Object.assign({},i);delete l.base,c._definition=l;const p=a._definition||{};l.messages=r.merge(p.messages,l.messages),l.properties=Object.assign({},p.properties,l.properties),u.type=l.type,l.flags=Object.assign({},p.flags,l.flags);const d=Object.assign({},p.terms);if(l.terms)for(const t in l.terms){const n=l.terms[t];e(void 0===u.$_terms[t],"Invalid term override for",l.type,t),u.$_terms[t]=n.init,d[t]=n}l.terms=d,l.args||(l.args=p.args),l.prepare=s.prepare(l.prepare,p.prepare),l.coerce&&("function"==typeof l.coerce&&(l.coerce={method:l.coerce}),l.coerce.from&&!Array.isArray(l.coerce.from)&&(l.coerce={method:l.coerce.method,from:[].concat(l.coerce.from)})),l.coerce=s.coerce(l.coerce,p.coerce),l.validate=s.validate(l.validate,p.validate);const h=Object.assign({},p.rules);if(l.rules)for(const t in l.rules){const r=l.rules[t];e("object"==typeof r,"Invalid rule definition for",l.type,t);let s=r.method;if(void 0===s&&(s=function(){return this.$_addRule(t)}),s&&(e(!c[t],"Rule conflict in",l.type,t),c[t]=s),e(!h[t],"Rule conflict in",l.type,t),h[t]=r,r.alias){const e=[].concat(r.alias);for(const t of e)c[t]=r.method}r.args&&(r.argsByName=new Map,r.args=r.args.map(t=>("string"==typeof t&&(t={name:t}),e(!r.argsByName.has(t.name),"Duplicated argument name",t.name),n.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),r.argsByName.set(t.name,t),t)))}l.rules=h;const f=Object.assign({},p.modifiers);if(l.modifiers)for(const t in l.modifiers){e(!c[t],"Rule conflict in",l.type,t);const n=l.modifiers[t];e("function"==typeof n,"Invalid modifier definition for",l.type,t);const r=function(e){return this.rule({[t]:e})};c[t]=r,f[t]=n}if(l.modifiers=f,l.overrides){c._super=a,u.$_super={};for(const t in l.overrides)e(a[t],"Cannot override missing",t),l.overrides[t][n.symbols.parent]=a[t],u.$_super[t]=a[t].bind(u);Object.assign(c,l.overrides)}l.cast=Object.assign({},p.cast,l.cast);const _=Object.assign({},p.manifest,l.manifest);return _.build=s.build(l.manifest&&l.manifest.build,p.manifest&&p.manifest.build),l.manifest=_,l.rebuild=s.rebuild(l.rebuild,p.rebuild),u},s.build=function(e,t){return e&&t?function(n,r){return t(e(n,r),r)}:e||t},s.coerce=function(e,t){return e&&t?{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(n,r){let s;if((!t.from||t.from.includes(typeof n))&&(s=t.method(n,r),s)){if(s.errors||void 0===s.value)return s;n=s.value}if(!e.from||e.from.includes(typeof n)){const t=e.method(n,r);if(t)return t}return s}}:e||t},s.prepare=function(e,t){return e&&t?function(n,r){const s=e(n,r);if(s){if(s.errors||void 0===s.value)return s;n=s.value}return t(n,r)||s}:e||t},s.rebuild=function(e,t){return e&&t?function(n){t(n),e(n)}:e||t},s.validate=function(e,t){return e&&t?function(n,r){const s=t(n,r);if(s){if(s.errors&&(!Array.isArray(s.errors)||s.errors.length))return s;n=s.value}return e(n,r)||s}:e||t},rq}var oq,iq={};function aq(){if(oq)return iq;oq=1;const e=hY(),t=vY(),n=zY(),r=XY(),s=WY(),o=ZY();let i;const a={};return iq.describe=function(s){const o=s._definition,i={type:s.type,flags:{},rules:[]};for(const e in s._flags)"_"!==e[0]&&(i.flags[e]=a.describe(s._flags[e]));Object.keys(i.flags).length||delete i.flags,s._preferences&&(i.preferences=t(s._preferences,{shallow:["messages"]}),delete i.preferences[n.symbols.prefs],i.preferences.messages&&(i.preferences.messages=r.decompile(i.preferences.messages))),s._valids&&(i.allow=s._valids.describe()),s._invalids&&(i.invalid=s._invalids.describe());for(const e of s._rules){if(!1===o.rules[e.name].manifest)continue;const t={name:e.name};for(const n in o.modifiers)void 0!==e[n]&&(t[n]=a.describe(e[n]));if(e.args){t.args={};for(const n in e.args){const r=e.args[n];("options"!==n||Object.keys(r).length)&&(t.args[n]=a.describe(r,{assign:n}))}Object.keys(t.args).length||delete t.args}i.rules.push(t)}i.rules.length||delete i.rules;for(const t in s.$_terms){if("_"===t[0])continue;e(!i[t],"Cannot describe schema due to internal name conflict with",t);const r=s.$_terms[t];if(!r)continue;if(r instanceof Map){r.size&&(i[t]=[...r.entries()]);continue}if(n.isValues(r)){i[t]=r.describe();continue}e(o.terms[t],"Term",t,"missing configuration");const c=o.terms[t].manifest,u="object"==typeof c;if(!r.length&&!u)continue;const l=[];for(const e of r)l.push(a.describe(e));if(u){const{from:e,to:n}=c.mapped;i[t]={};for(const r of l)i[t][r[n]]=r[e];continue}"single"!==c?i[t]=l:(e(1===l.length,"Term",t,"contains more than one item"),i[t]=l[0])}return a.validate(s.$_root,i),i},a.describe=function(e,r={}){if(Array.isArray(e))return e.map(a.describe);if(e===n.symbols.deepDefault)return{special:"deep"};if("object"!=typeof e||null===e)return e;if("options"===r.assign)return t(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return"regex"===r.assign?e.toString():{regex:e.toString()};if(e[n.symbols.literal])return{function:e.literal};if("function"==typeof e.describe)return"ref"===r.assign?e.describe().ref:e.describe();const s={};for(const t in e){const n=e[t];void 0!==n&&(s[t]=a.describe(n,{assign:t}))}return s},iq.build=function(e,t){return new a.Builder(e).parse(t)},a.Builder=class{constructor(e){this.joi=e}parse(t){a.validate(this.joi,t);let n=this.joi[t.type]()._bare();const r=n._definition;if(t.flags)for(const s in t.flags){const o=r.flags[s]&&r.flags[s].setter||s;e("function"==typeof n[o],"Invalid flag",s,"for type",t.type),n=n[o](this.build(t.flags[s]))}if(t.preferences&&(n=n.preferences(this.build(t.preferences))),t.allow&&(n=n.allow(...this.build(t.allow))),t.invalid&&(n=n.invalid(...this.build(t.invalid))),t.rules)for(const s of t.rules){e("function"==typeof n[s.name],"Invalid rule",s.name,"for type",t.type);const o=[];if(s.args){const n={};for(const e in s.args)n[e]=this.build(s.args[e],{assign:e});const i=Object.keys(n),a=r.rules[s.name].args;if(a){e(i.length<=a.length,"Invalid number of arguments for",t.type,s.name,"(expected up to",a.length,", found",i.length,")");for(const{name:e}of a)o.push(n[e])}else e(1===i.length,"Invalid number of arguments for",t.type,s.name,"(expected up to 1, found",i.length,")"),o.push(n[i[0]])}n=n[s.name](...o);const i={};for(const e in r.modifiers)void 0!==s[e]&&(i[e]=this.build(s[e]));Object.keys(i).length&&(n=n.rule(i))}const s={};for(const n in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(n))continue;e(r.terms[n],"Term",n,"missing configuration");const o=r.terms[n].manifest;if("schema"!==o)if("values"!==o)if("single"!==o)if("object"!=typeof o)s[n]=this.build(t[n]);else{s[n]={};for(const e in t[n]){const r=t[n][e];s[n][e]=this.parse(r)}}else s[n]=this.build(t[n]);else s[n]=t[n].map(e=>this.build(e));else s[n]=t[n].map(e=>this.parse(e))}return t.whens&&(s.whens=t.whens.map(e=>this.build(e))),n=r.manifest.build(n,s),n.$_temp.ruleset=!1,n}build(r,i={}){if(null===r)return null;if(Array.isArray(r))return r.map(e=>this.build(e));if(r instanceof Error)return r;if("options"===i.assign)return t(r);if("regex"===i.assign)return a.regex(r);if("ref"===i.assign)return s.build(r);if("object"!=typeof r)return r;if(1===Object.keys(r).length){if(r.buffer)return e(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(r.buffer,"binary");if(r.function)return{[n.symbols.literal]:!0,literal:r.function};if(r.override)return n.symbols.override;if(r.ref)return s.build(r.ref);if(r.regex)return a.regex(r.regex);if(r.special)return e(["deep"].includes(r.special),"Unknown special value",r.special),n.symbols.deepDefault;if(r.value)return t(r.value)}if(r.type)return this.parse(r);if(r.template)return o.build(r);const c={};for(const e in r)c[e]=this.build(r[e],{assign:e});return c}},a.regex=function(e){const t=e.lastIndexOf("/"),n=e.slice(1,t),r=e.slice(t+1);return new RegExp(n,r)},a.validate=function(e,t){i=i||IY(),e.assert(t,i.description)},iq}var cq={};const uq=gY(),lq={mismatched:null};var pq=function(e,t,n){return n=Object.assign({prototype:!0},n),!!lq.isDeepEqual(e,t,n,[])};lq.isDeepEqual=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;const s=typeof e;if(s!==typeof t)return!1;if(null===e||null===t)return!1;if("function"===s){if(!n.deepFunction||e.toString()!==t.toString())return!1}else if("object"!==s)return e!=e&&t!=t;const o=lq.getSharedType(e,t,!!n.prototype);switch(o){case uq.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case uq.promise:return e===t;case uq.regex:return e.toString()===t.toString();case lq.mismatched:return!1}for(let n=r.length-1;n>=0;--n)if(r[n].isSame(e,t))return!0;r.push(new lq.SeenEntry(e,t));try{return!!lq.isDeepEqualObj(o,e,t,n,r)}finally{r.pop()}},lq.getSharedType=function(e,t,n){if(n)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?lq.mismatched:uq.getInternalProto(e);const r=uq.getInternalProto(e);return r!==uq.getInternalProto(t)?lq.mismatched:r},lq.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},lq.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},lq.isSetSimpleEqual=function(e,t){for(const n of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,n))return!1;return!0},lq.isDeepEqualObj=function(e,t,n,r,s){const{isDeepEqual:o,valueOf:i,hasOwnEnumerableProperty:a}=lq,{keys:c,getOwnPropertySymbols:u}=Object;if(e===uq.array){if(!r.part){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!o(t[e],n[e],r,s))return!1;return!0}for(const e of t)for(const t of n)if(o(e,t,r,s))return!0}else if(e===uq.set){if(t.size!==n.size)return!1;if(!lq.isSetSimpleEqual(t,n)){const e=new Set(Set.prototype.values.call(n));for(const n of Set.prototype.values.call(t)){if(e.delete(n))continue;let t=!1;for(const i of e)if(o(n,i,r,s)){e.delete(i),t=!0;break}if(!t)return!1}}}else if(e===uq.map){if(t.size!==n.size)return!1;for(const[e,i]of Map.prototype.entries.call(t)){if(void 0===i&&!Map.prototype.has.call(n,e))return!1;if(!o(i,Map.prototype.get.call(n,e),r,s))return!1}}else if(e===uq.error&&(t.name!==n.name||t.message!==n.message))return!1;const l=i(t),p=i(n);if((t!==l||n!==p)&&!o(l,p,r,s))return!1;const d=c(t);if(!r.part&&d.length!==c(n).length&&!r.skip)return!1;let h=0;for(const e of d)if(r.skip&&r.skip.includes(e))void 0===n[e]&&++h;else{if(!a(n,e))return!1;if(!o(t[e],n[e],r,s))return!1}if(!r.part&&d.length-h!==c(n).length)return!1;if(!1!==r.symbols){const e=u(t),i=new Set(u(n));for(const c of e){if(!r.skip||!r.skip.includes(c))if(a(t,c)){if(!a(n,c))return!1;if(!o(t[c],n[c],r,s))return!1}else if(a(n,c))return!1;i.delete(c)}for(const e of i)if(a(n,e))return!1}return!0},lq.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}};var dq,hq={};function fq(){if(dq)return cq;dq=1;const e=pq,t=hq,n=VY(),r={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};return cq.setup=function(e){const t=function(){return e._tracer=e._tracer||new r.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}},cq.location=function(e){return e.$_setFlag("_tracerLocation",t.location(2))},r.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){const n=this._schemas.get(e);if(n)return n.store;const s=new r.Store(e),{filename:o,line:i}=e._flags._tracerLocation||t.location(5);return this._schemas.set(e,{filename:o,line:i,store:s}),s}_combine(e,t){for(const{store:n}of this._schemas.values())n._combine(e,t)}report(e){const t=[];for(const{filename:n,line:s,store:o}of this._schemas.values()){if(e&&e!==n)continue;const i=[],a=[];for(const[e,t]of o._sources.entries()){if(r.sub(t.paths,a))continue;if(!t.entry){i.push({status:"never reached",paths:[...t.paths]}),a.push(...t.paths);continue}for(const n of["valid","invalid"]){const r=e[`_${n}s`];if(!r)continue;const s=new Set(r._values),o=new Set(r._refs);for(const{value:e,ref:r}of t[n])s.delete(e),o.delete(r);(s.size||o.size)&&i.push({status:[...s,...[...o].map(e=>e.display)],rule:`${n}s`})}const n=e._rules.map(e=>e.name);for(const t of["default","failover"])void 0!==e._flags[t]&&n.push(t);for(const e of n){const n=r.labels[t.rule[e]||0];if(n){const r={rule:e,status:n};t.paths.size&&(r.paths=[...t.paths]),i.push(r)}}}i.length&&t.push({filename:n,line:s,missing:i,severity:"error",message:`Schema missing tests for ${i.map(r.message).join(", ")}`})}return t.length?t:null}},r.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,n,r){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:n,result:r,path:e.path})}entry(e,t){r.debug(t,{type:"entry"}),this._record(e,e=>{e.entry=!0})}filter(e,t,n,s){r.debug(t,{type:n,...s}),this._record(e,e=>{e[n].add(s)})}log(e,t,n,s,o){r.debug(t,{type:n,name:s,result:"full"===o?"pass":o}),this._record(e,e=>{e[n][s]=e[n][s]||0,e[n][s]|=r.codes[o]})}resolve(e,t,n){if(!e.mainstay.debug)return;const r={type:"resolve",ref:t.display,to:n,path:e.path};e.mainstay.debug.push(r)}value(t,n,r,s,o){if(!t.mainstay.debug||e(r,s))return;const i={type:"value",by:n,from:r,to:s,path:t.path};o&&(i.name=o),t.mainstay.debug.push(i)}_record(e,t){const n=this._sources.get(e);if(n)return void t(n);const r=this._combos.get(e);for(const e of r)this._record(e,t)}_scan(e,t){const n=t||[];let s=this._sources.get(e);s||(s={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,s)),n.length&&s.paths.add(n);e.$_modify({each:(e,t)=>{const s=r.id(e,t);this._scan(e,n.concat(s))},ref:!1})}_combine(e,t){this._combos.set(e,t)}},r.message=function(e){return`${e.paths?n.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`},r.id=function(e,{source:t,name:n,path:r,key:s}){return e._flags.id?e._flags.id:s||(n=`@${n}`,"terms"===t?[n,r[Math.min(r.length-1,1)]]:n)},r.sub=function(t,n){for(const r of t)for(const t of n)if(e(r.slice(0,t.length),t))return!0;return!1},r.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))},cq}hq.location=function(e=0){const t=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const n={};Error.captureStackTrace(n,this);const r=n.stack[e+1];return Error.prepareStackTrace=t,{filename:r.getFileName(),line:r.getLineNumber()}};const _q=hY(),mq=vY(),gq=AY(),Eq={};var Sq,Tq=Eq.merge=function(e,t,n){if(_q(e&&"object"==typeof e,"Invalid target value: must be an object"),_q(null==t||"object"==typeof t,"Invalid source value: must be null, undefined, or an object"),!t)return e;if(n=Object.assign({nullOverride:!0,mergeArrays:!0},n),Array.isArray(t)){_q(Array.isArray(e),"Cannot merge array onto an object"),n.mergeArrays||(e.length=0);for(let r=0;r<t.length;++r)e.push(mq(t[r],{symbols:n.symbols}));return e}const r=gq.keys(t,n);for(let s=0;s<r.length;++s){const o=r[s];if("__proto__"===o||!Object.prototype.propertyIsEnumerable.call(t,o))continue;const i=t[o];if(i&&"object"==typeof i){if(e[o]===i)continue;!e[o]||"object"!=typeof e[o]||Array.isArray(e[o])!==Array.isArray(i)||i instanceof Date||Buffer&&Buffer.isBuffer(i)||i instanceof RegExp?e[o]=mq(i,{symbols:n.symbols}):Eq.merge(e[o],i,n)}else(null!=i||n.nullOverride)&&(e[o]=i)}return e},yq={};var Aq,vq,bq,Rq,Oq,Nq,Cq,Iq,Pq,Mq,wq,Lq,xq,Dq,kq,Uq,$q,Gq={},jq=function(){};function Vq(){return bq||(bq=1,function(e){const t=hY(),n=vY(),r=jq,s=fY(),o=zY(),i=VY(),a=function(){if(vq)return Aq;vq=1;const e=vY(),t=fY(),n=zY(),r={value:Symbol("value")};return Aq=r.State=class{constructor(e,t,n){this.path=e,this.ancestors=t,this.mainstay=n.mainstay,this.schemas=n.schemas,this.debug=null}localize(e,t=null,n=null){const s=new r.State(e,t,this);return n&&s.schemas&&(s.schemas=[r.schemas(n),...s.schemas]),s}nest(e,t){const n=new r.State(this.path,this.ancestors,this);return n.schemas=n.schemas&&[r.schemas(e),...n.schemas],n.debug=t,n}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new r.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=e(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}},r.schemas=function(e){return n.isSchema(e)?{schema:e}:e},r.Shadow=class{constructor(){this._values=null}set(e,t,n){if(!e.length)return;if("strip"===n&&"number"==typeof e[e.length-1])return;this._values=this._values||new Map;let s=this._values;for(let t=0;t<e.length;++t){const n=e[t];let r=s.get(n);r||(r=new Map,s.set(n,r)),s=r}s[r.value]=t}get(e){const t=this.node(e);if(t)return t[r.value]}node(e){if(this._values)return t(this._values,e,{iterables:!0})}override(e,n){if(!this._values)return;const r=e.slice(0,-1),s=e[e.length-1],o=t(this._values,r,{iterables:!0});n?o.set(s,n):o&&o.delete(s)}},Aq}(),c={result:Symbol("result")};e.entry=function(e,n,r){let s=o.defaults;r&&(t(void 0===r.warnings,"Cannot override warnings preference in synchronous validation"),t(void 0===r.artifacts,"Cannot override artifacts preference in synchronous validation"),s=o.preferences(o.defaults,r));const a=c.entry(e,n,s);t(!a.mainstay.externals.length,"Schema with external rules must use validateAsync()");const u={value:a.value};return a.error&&(u.error=a.error),a.mainstay.warnings.length&&(u.warning=i.details(a.mainstay.warnings)),a.mainstay.debug&&(u.debug=a.mainstay.debug),a.mainstay.artifacts&&(u.artifacts=a.mainstay.artifacts),u},e.entryAsync=async function(e,t,n){let r=o.defaults;n&&(r=o.preferences(o.defaults,n));const a=c.entry(e,t,r),u=a.mainstay;if(a.error)throw u.debug&&(a.error.debug=u.debug),a.error;if(u.externals.length){let t=a.value;const l=[];for(const a of u.externals){const p=a.state.path,d="link"===a.schema.type?u.links.get(a.schema):null;let h,f,_=t;const m=p.length?[t]:[],g=p.length?s(e,p):e;if(p.length){h=p[p.length-1];let e=t;for(const t of p.slice(0,-1))e=e[t],m.unshift(e);f=m[0],_=f[h]}try{const e=(e,t)=>(d||a.schema).$_createError(e,_,t,a.state,r),s=await a.method(_,{schema:a.schema,linked:d,state:a.state,prefs:n,original:g,error:e,errorsArray:c.errorsArray,warn:(e,t)=>u.warnings.push((d||a.schema).$_createError(e,_,t,a.state,r)),message:(e,t)=>(d||a.schema).$_createError("external",_,t,a.state,r,{messages:e})});if(void 0===s||s===_)continue;if(s instanceof i.Report){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(s),r.abortEarly)break;continue}if(Array.isArray(s)&&s[o.symbols.errors]){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(...s),r.abortEarly)break;continue}f?(u.tracer.value(a.state,"rule",_,s,"external"),f[h]=s):(u.tracer.value(a.state,"rule",t,s,"external"),t=s)}catch(e){throw r.errors.label&&(e.message+=` (${a.label})`),e}}if(a.value=t,l.length)throw a.error=i.process(l,e,r),u.debug&&(a.error.debug=u.debug),a.error}if(!r.warnings&&!r.debug&&!r.artifacts)return a.value;const l={value:a.value};return u.warnings.length&&(l.warning=i.details(u.warnings)),u.debug&&(l.debug=u.debug),u.artifacts&&(l.artifacts=u.artifacts),l},c.Mainstay=class{constructor(e,t,n){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=n,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}},c.entry=function(t,n,r){const{tracer:s,cleanup:o}=c.tracer(n,r),u=r.debug?[]:null,l=n._ids._schemaChain?new Map:null,p=new c.Mainstay(s,u,l),d=n._ids._schemaChain?[{schema:n}]:null,h=new a([],[],{mainstay:p,schemas:d}),f=e.validate(t,n,h,r);o&&n.$_root.untrace();const _=i.process(f.errors,t,r);return{value:f.value,error:_,mainstay:p}},c.tracer=function(e,n){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:n.debug?(t(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:c.ignore}},e.validate=function(e,t,n,r,s={}){if(t.$_terms.whens&&(t=t._generate(e,n,r).schema),t._preferences&&(r=c.prefs(t,r)),t._cache&&r.cache){const r=t._cache.get(e);if(n.mainstay.tracer.debug(n,"validate","cached",!!r),r)return r}const i=(s,o,i)=>t.$_createError(s,e,o,i||n,r),a={original:e,prefs:r,schema:t,state:n,error:i,errorsArray:c.errorsArray,warn:(e,t,r)=>n.mainstay.warnings.push(i(e,t,r)),message:(s,o)=>t.$_createError("custom",e,o,n,r,{messages:s})};n.mainstay.tracer.entry(t,n);const u=t._definition;if(u.prepare&&void 0!==e&&r.convert){const t=u.prepare(e,a);if(t){if(n.mainstay.tracer.value(n,"prepare",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}if(u.coerce&&void 0!==e&&r.convert&&(!u.coerce.from||u.coerce.from.includes(typeof e))){const t=u.coerce.method(e,a);if(t){if(n.mainstay.tracer.value(n,"coerced",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}const l=t._flags.empty;l&&l.$_match(c.trim(e,t),n.nest(l),o.defaults)&&(n.mainstay.tracer.value(n,"empty",e,void 0),e=void 0);const p=s.presence||t._flags.presence||(t._flags._endedSwitch?null:r.presence);if(void 0===e){if("forbidden"===p)return c.finalize(e,null,a);if("required"===p)return c.finalize(e,[t.$_createError("any.required",e,null,n,r)],a);if("optional"===p){if(t._flags.default!==o.symbols.deepDefault)return c.finalize(e,null,a);n.mainstay.tracer.value(n,"default",e,{}),e={}}}else if("forbidden"===p)return c.finalize(e,[t.$_createError("any.unknown",e,null,n,r)],a);const d=[];if(t._valids){const s=t._valids.get(e,n,r,t._flags.insensitive);if(s)return r.convert&&(n.mainstay.tracer.value(n,"valids",e,s.value),e=s.value),n.mainstay.tracer.filter(t,n,"valid",s),c.finalize(e,null,a);if(t._flags.only){const s=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},n,r);if(r.abortEarly)return c.finalize(e,[s],a);d.push(s)}}if(t._invalids){const s=t._invalids.get(e,n,r,t._flags.insensitive);if(s){n.mainstay.tracer.filter(t,n,"invalid",s);const o=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},n,r);if(r.abortEarly)return c.finalize(e,[o],a);d.push(o)}}if(u.validate){const t=u.validate(e,a);if(t&&(n.mainstay.tracer.value(n,"base",e,t.value),e=t.value,t.errors)){if(!Array.isArray(t.errors))return d.push(t.errors),c.finalize(e,d,a);if(t.errors.length)return d.push(...t.errors),c.finalize(e,d,a)}}return t._rules.length?c.rules(e,d,a):c.finalize(e,d,a)},c.rules=function(e,t,n){const{schema:r,state:s,prefs:i}=n;for(const a of r._rules){const u=r._definition.rules[a.method];if(u.convert&&i.convert){s.mainstay.tracer.log(r,s,"rule",a.name,"full");continue}let l,p=a.args;if(a._resolve.length){p=Object.assign({},p);for(const t of a._resolve){const n=u.argsByName.get(t),a=p[t].resolve(e,s,i),c=n.normalize?n.normalize(a):a,d=o.validateArg(c,null,n);if(d){l=r.$_createError("any.ref",a,{arg:t,ref:p[t],reason:d},s,i);break}p[t]=c}}l=l||u.validate(e,n,p,a);const d=c.rule(l,a);if(d.errors){if(s.mainstay.tracer.log(r,s,"rule",a.name,"error"),a.warn){s.mainstay.warnings.push(...d.errors);continue}if(i.abortEarly)return c.finalize(e,d.errors,n);t.push(...d.errors)}else s.mainstay.tracer.log(r,s,"rule",a.name,"pass"),s.mainstay.tracer.value(s,"rule",e,d.value,a.name),e=d.value}return c.finalize(e,t,n)},c.rule=function(e,t){return e instanceof i.Report?(c.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[o.symbols.errors]?(e.forEach(e=>c.error(e,t)),{errors:e,value:null}):{errors:null,value:e}},c.error=function(e,t){return t.message&&e._setTemplate(t.message),e},c.finalize=function(e,n,r){n=n||[];const{schema:s,state:o,prefs:a}=r;if(n.length){const t=c.default("failover",void 0,n,r);void 0!==t&&(o.mainstay.tracer.value(o,"failover",e,t),e=t,n=[])}if(n.length&&s._flags.error)if("function"==typeof s._flags.error){n=s._flags.error(n),Array.isArray(n)||(n=[n]);for(const e of n)t(e instanceof Error||e instanceof i.Report,"error() must return an Error object")}else n=[s._flags.error];if(void 0===e){const t=c.default("default",e,n,r);o.mainstay.tracer.value(o,"default",e,t),e=t}if(s._flags.cast&&void 0!==e){const t=s._definition.cast[s._flags.cast];if(t.from(e)){const n=t.to(e,r);o.mainstay.tracer.value(o,"cast",e,n,s._flags.cast),e=n}}if(s.$_terms.externals&&a.externals&&!1!==a._externals)for(const{method:e}of s.$_terms.externals)o.mainstay.externals.push({method:e,schema:s,state:o,label:i.label(s._flags,o,a)});const u={value:e,errors:n.length?n:null};return s._flags.result&&(u.value="strip"===s._flags.result?void 0:r.original,o.mainstay.tracer.value(o,s._flags.result,e,u.value),o.shadow(e,s._flags.result)),s._cache&&!1!==a.cache&&!s._refs.length&&s._cache.set(r.original,u),void 0===e||u.errors||void 0===s._flags.artifact||(o.mainstay.artifacts=o.mainstay.artifacts||new Map,o.mainstay.artifacts.has(s._flags.artifact)||o.mainstay.artifacts.set(s._flags.artifact,[]),o.mainstay.artifacts.get(s._flags.artifact).push(o.path)),u},c.prefs=function(e,t){const n=t===o.defaults;return n&&e._preferences[o.symbols.prefs]?e._preferences[o.symbols.prefs]:(t=o.preferences(t,e._preferences),n&&(e._preferences[o.symbols.prefs]=t),t)},c.default=function(e,t,r,s){const{schema:i,state:a,prefs:c}=s,u=i._flags[e];if(c.noDefaults||void 0===u)return t;if(a.mainstay.tracer.log(i,a,"rule",e,"full"),!u)return u;if("function"==typeof u){const t=u.length?[n(a.ancestors[0]),s]:[];try{return u(...t)}catch(t){return void r.push(i.$_createError(`any.${e}`,null,{error:t},a,c))}}return"object"!=typeof u?u:u[o.symbols.literal]?u.literal:o.isResolvable(u)?u.resolve(t,a,c):n(u)},c.trim=function(e,t){if("string"!=typeof e)return e;const n=t.$_getRule("trim");return n&&n.args.enabled?e.trim():e},c.ignore={active:!1,debug:r,entry:r,filter:r,log:r,resolve:r,value:r},c.errorsArray=function(){const e=[];return e[o.symbols.errors]=!0,e}}(Gq)),Gq}function Hq(){if(Oq)return Rq;Oq=1;const e=hY(),t=pq,n=zY(),r={};return Rq=r.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=r.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){n.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,n){if(e=e||new r.Values,t){if(t._override)return t.clone();for(const n of[...t._values,...t._refs])e.add(n)}if(n)for(const t of[...n._values,...n._refs])e.remove(t);return e.length?e:null}remove(e){n.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,n,r){return!!this.get(e,t,n,r)}get(e,n,r,s){if(!this.length)return!1;if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&s){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(!this._refs.size&&"object"!=typeof e)return!1;if("object"==typeof e)for(const n of this._values)if(t(n,e))return{value:n};if(n)for(const o of this._refs){const i=o.resolve(e,n,r,null,{in:!0});if(void 0===i)continue;const a=o.in&&"object"==typeof i?Array.isArray(i)?i:Object.keys(i):[i];for(const n of a)if(typeof n==typeof e)if(s&&e&&"string"==typeof e){if(n.toLowerCase()===e.toLowerCase())return{value:n,ref:o}}else if(t(n,e))return{value:n,ref:o}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){const e=new r.Values(this._values,this._refs);return e._override=this._override,e}concat(t){e(!t._override,"Cannot concat override set of values");const n=new r.Values([...this._values,...t._values],[...this._refs,...t._refs]);return n._override=this._override,n}describe(){const e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const t of this._refs.values())e.push(t.describe());return e}},r.Values.prototype[n.symbols.values]=!0,r.Values.prototype.slice=r.Values.prototype.clone,r.lowercases=function(e){const t=new Map;if(e)for(const n of e)"string"==typeof n&&t.set(n.toLowerCase(),n);return t},Rq}function Bq(){if(Cq)return Nq;Cq=1;const e=hY(),t=vY(),n=pq,r=Tq,s=QY(),o=zY(),i=tq(),a=VY(),c=sq(),u=aq(),l=XY(),p=(Sq||(Sq=1,function(e){const t=hY(),n=zY(),r=WY(),s={};e.Ids=s.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const e=new s.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(const[n,r]of e._byId.entries())t(!this._byKey.has(n),"Schema id conflicts with existing key:",n),this._byId.set(n,r);for(const[n,r]of e._byKey.entries())t(!this._byId.has(n),"Schema key conflicts with existing id:",n),this._byKey.set(n,r)}fork(e,r,o){const i=this._collect(e);i.push({schema:o});const a=i.shift();let c={id:a.id,schema:r(a.schema)};t(n.isSchema(c.schema),"adjuster function failed to return a joi schema type");for(const e of i)c={id:e.id,schema:s.fork(e.schema,c.id,c.schema)};return c.schema}labels(e,t=[]){const n=e[0],r=this._get(n);if(!r)return[...t,...e].join(".");const s=e.slice(1);return t=[...t,r.schema._flags.label||n],s.length?r.schema._ids.labels(s,t):t.join(".")}reach(e,n=[]){const r=e[0],s=this._get(r);t(s,"Schema does not contain path",[...n,...e].join("."));const o=e.slice(1);return o.length?s.schema._ids.reach(o,[...n,r]):s.schema}register(e,{key:r}={}){if(!e||!n.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);const s=e._flags.id;if(s){const n=this._byId.get(s);t(!n||n.schema===e,"Cannot add different schemas with the same id:",s),t(!this._byKey.has(s),"Schema id conflicts with existing key:",s),this._byId.set(s,{schema:e,id:s})}r&&(t(!this._byKey.has(r),"Schema already contains key:",r),t(!this._byId.has(r),"Schema key conflicts with existing id:",r),this._byKey.set(r,{schema:e,id:r}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,n=[],r=[]){const s=e[0],o=this._get(s);t(o,"Schema does not contain path",[...n,...e].join(".")),r=[o,...r];const i=e.slice(1);return i.length?o.schema._ids._collect(i,[...n,s],r):r}_get(e){return this._byId.get(e)||this._byKey.get(e)}},s.fork=function(t,n,r){const s=e.schema(t,{each:(e,{key:t})=>{if(n===(e._flags.id||t))return r},ref:!1});return s?s.$_mutateRebuild():t},e.schema=function(e,t){let n;for(const r in e._flags){if("_"===r[0])continue;const o=s.scan(e._flags[r],{source:"flags",name:r},t);void 0!==o&&(n=n||e.clone(),n._flags[r]=o)}for(let r=0;r<e._rules.length;++r){const o=e._rules[r],i=s.scan(o.args,{source:"rules",name:o.name},t);if(void 0!==i){n=n||e.clone();const t=Object.assign({},o);t.args=i,n._rules[r]=t,n._singleRules.get(o.name)===o&&n._singleRules.set(o.name,t)}}for(const r in e.$_terms){if("_"===r[0])continue;const o=s.scan(e.$_terms[r],{source:"terms",name:r},t);void 0!==o&&(n=n||e.clone(),n.$_terms[r]=o)}return n},s.scan=function(e,t,o,i,a){const c=i||[];if(null===e||"object"!=typeof e)return;let u;if(Array.isArray(e)){for(let n=0;n<e.length;++n){const r="terms"===t.source&&"keys"===t.name&&e[n].key,i=s.scan(e[n],t,o,[n,...c],r);void 0!==i&&(u=u||e.slice(),u[n]=i)}return u}if(!1!==o.schema&&n.isSchema(e)||!1!==o.ref&&r.isRef(e)){const n=o.each(e,{...t,path:c,key:a});if(n===e)return;return n}for(const n in e){if("_"===n[0])continue;const r=s.scan(e[n],t,o,[n,...c],a);void 0!==r&&(u=u||Object.assign({},e),u[n]=r)}return u}}(yq)),yq),d=WY(),h=fq(),f=Vq(),_=Hq(),m={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new p.Ids,this._preferences=null,this._refs=new d.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return e("function"==typeof u.describe,"Manifest functionality disabled"),u.describe(this)}allow(...e){return o.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(t){e(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),e(!this._inRuleset(),"Cannot set alterations inside a ruleset");const n=this.clone();n.$_terms.alterations=n.$_terms.alterations||[];for(const r in t){const s=t[r];e("function"==typeof s,"Alteration adjuster for",r,"must be a function"),n.$_terms.alterations.push({target:r,adjuster:s})}return n.$_temp.ruleset=!1,n}artifact(t){return e(void 0!==t,"Artifact cannot be undefined"),e(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return e(!1===t||"string"==typeof t,"Invalid to value"),e(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(e,t){return this._default("default",e,t)}description(t){return e(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(e){const t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(t){return e(t,"Missing error"),e(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,n={}){return e(void 0!==t,"Missing example"),o.assertOptions(n,["override"]),this._inner("examples",t,{single:!0,override:n.override})}external(t,n){return"object"==typeof t&&(e(!n,"Cannot combine options with description"),n=t.description,t=t.method),e("function"==typeof t,"Method must be a function"),e(void 0===n||n&&"string"==typeof n,"Description must be a non-empty string"),this._inner("externals",{method:t,description:n},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(t){return t?(e("string"==typeof t,"id must be a non-empty string"),e(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(t){return e(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return e(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){e(t.length,"Missing notes");for(const n of t)e(n&&"string"==typeof n,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return e("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){e(t,"Missing preferences"),e(void 0===t.context,"Cannot override context"),e(void 0===t.externals,"Cannot override externals"),e(void 0===t.warnings,"Cannot override warnings"),e(void 0===t.debug,"Cannot override debug"),o.checkPreferences(t);const n=this.clone();return n._preferences=o.preferences(n._preferences,t),n}presence(t){return e(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(t){return e(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(e){const t=this.clone(),n=void 0!==e&&!e;return t._preferences=o.preferences(t._preferences,{convert:n}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...t){e(t.length,"Missing tags");for(const n of t)e(n&&"string"==typeof n,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return e(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...e){o.verifyFlat(e,"valid");const t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(t,n){const r=this.clone();r.$_terms.whens||(r.$_terms.whens=[]);const s=i.when(r,t,n);if(!["any","link"].includes(r.type)){const t=s.is?[s]:s.switch;for(const n of t)e(!n.then||"any"===n.then.type||n.then.type===r.type,"Cannot combine",r.type,"with",n.then&&n.then.type),e(!n.otherwise||"any"===n.otherwise.type||n.otherwise.type===r.type,"Cannot combine",r.type,"with",n.otherwise&&n.otherwise.type)}return r.$_terms.whens.push(s),r.$_mutateRebuild()}cache(t){e(!this._inRuleset(),"Cannot set caching inside a ruleset"),e(!this._cache,"Cannot override schema cache"),e(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");const n=this.clone();return n._cache=t||s.provider.provision(),n.$_temp.ruleset=!1,n}clone(){const e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(t){e(o.isSchema(t),"Invalid schema object"),e("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),e(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),e(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let n=this.clone();if("any"===this.type&&"any"!==t.type){const e=t.clone();for(const t of Object.keys(n))"type"!==t&&(e[t]=n[t]);n=e}n._ids.concat(t._ids),n._refs.register(t,d.toSibling),n._preferences=n._preferences?o.preferences(n._preferences,t._preferences):t._preferences,n._valids=_.merge(n._valids,t._valids,t._invalids),n._invalids=_.merge(n._invalids,t._invalids,t._valids);for(const e of t._singleRules.keys())n._singleRules.has(e)&&(n._rules=n._rules.filter(t=>t.keep||t.name!==e),n._singleRules.delete(e));for(const e of t._rules)t._definition.rules[e.method].multi||n._singleRules.set(e.name,e),n._rules.push(e);if(n._flags.empty&&t._flags.empty){n._flags.empty=n._flags.empty.concat(t._flags.empty);const e=Object.assign({},t._flags);delete e.empty,r(n._flags,e)}else if(t._flags.empty){n._flags.empty=t._flags.empty;const e=Object.assign({},t._flags);delete e.empty,r(n._flags,e)}else r(n._flags,t._flags);for(const e in t.$_terms){const r=t.$_terms[e];r?n.$_terms[e]?n.$_terms[e]=n.$_terms[e].concat(r):n.$_terms[e]=r.slice():n.$_terms[e]||(n.$_terms[e]=r)}return this.$_root._tracer&&this.$_root._tracer._combine(n,[this,t]),n.$_mutateRebuild()}extend(t){return e(!t.base,"Cannot extend type with another base"),c.type(this,t)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(t,n){e(!this._inRuleset(),"Cannot fork inside a ruleset");let r=this;for(let e of[].concat(t))e=Array.isArray(e)?e:e.split("."),r=r._ids.fork(e,n,r);return r.$_temp.ruleset=!1,r}rule(n){const r=this._definition;o.assertOptions(n,Object.keys(r.modifiers)),e(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const s=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;e(s>=0&&s<this._rules.length,"Cannot apply rules to empty ruleset");const i=this.clone();for(let o=s;o<i._rules.length;++o){const s=i._rules[o],a=t(s);for(const t in n)r.modifiers[t](a,n[t]),e(a.name===s.name,"Cannot change rule name");i._rules[o]=a,i._singleRules.get(a.name)===s&&i._singleRules.set(a.name,a)}return i.$_temp.ruleset=!1,i.$_mutateRebuild()}get ruleset(){e(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),e(!this._inRuleset(),"Cannot tailor inside a ruleset");let n=this;if(this.$_terms.alterations)for(const{target:r,adjuster:s}of this.$_terms.alterations)t.includes(r)&&(n=s(n),e(o.isSchema(n),"Alteration adjuster for",r,"failed to return a schema object"));return n=n.$_modify({each:e=>e.tailor(t),ref:!1}),n.$_temp.ruleset=!1,n.$_mutateRebuild()}tracer(){return h.location?h.location(this):this}validate(e,t){return f.entry(e,this,t)}validateAsync(e,t){return f.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),e(t&&"object"==typeof t,"Invalid options"),e(t.name&&"string"==typeof t.name,"Invalid rule name");for(const n in t)e("_"!==n[0],"Cannot set private rule properties");const n=Object.assign({},t);n._resolve=[],n.method=n.method||n.name;const r=this._definition.rules[n.method],s=n.args;e(r,"Unknown rule",n.method);const i=this.clone();if(s){e(1===Object.keys(s).length||Object.keys(s).length===this._definition.rules[n.name].args.length,"Invalid rule definition for",this.type,n.name);for(const t in s){let a=s[t];if(r.argsByName){const c=r.argsByName.get(t);if(c.ref&&o.isResolvable(a))n._resolve.push(t),i.$_mutateRegister(a);else if(c.normalize&&(a=c.normalize(a),s[t]=a),c.assert){const n=o.validateArg(a,t,c);e(!n,n,"or reference")}}void 0!==a?s[t]=a:delete s[t]}}return r.multi||(i._ruleRemove(n.name,{clone:!1}),i._singleRules.set(n.name,n)),!1===i.$_temp.ruleset&&(i.$_temp.ruleset=null),r.priority?i._rules.unshift(n):i._rules.push(n),i}$_compile(e,t){return i.schema(this.$_root,e,t)}$_createError(e,t,n,r,s,o={}){const i=!1!==o.flags?this._flags:{},c=o.messages?l.merge(this._definition.messages,o.messages):this._definition.messages;return new a.Report(e,t,n,i,c,r,s)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,n,r){(n=Object.assign({},n)).abortEarly=!0,n._externals=!1,t.snapshot();const s=!f.validate(e,this,t,n,r).errors;return t.restore(),s}$_modify(e){return o.assertOptions(e,["each","once","ref","schema"]),p.schema(this,e)||this}$_mutateRebuild(){e(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();return this.$_modify({each:(e,{source:t,name:n,path:r,key:s})=>{const o=this._definition[t][n]&&this._definition[t][n].register;!1!==o&&this.$_mutateRegister(e,{family:o,key:s})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:n}={}){this._refs.register(e,t),this._ids.register(e,{key:n})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,r,s={}){e("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const o=this._definition.flags[t]||{};if(n(r,o.default)&&(r=void 0),n(r,this._flags[t]))return this;const i=!1!==s.clone?this.clone():this;return void 0!==r?(i._flags[t]=r,i.$_mutateRegister(r)):delete i._flags[t],"_"!==t[0]&&(i.$_temp.ruleset=!1),i}$_parent(e,...t){return this[e][o.symbols.parent].call(this,...t)}$_validate(e,t,n){return f.validate(e,this,t,n)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=t(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){const e=this.clone();e._reset();const t=e._definition.terms;for(const n in t){const r=t[n];e.$_terms[n]=r.init}return e.$_mutateRebuild()}_default(t,n,r={}){o.assertOptions(r,"literal"),e(void 0!==n,"Missing",t,"value"),e("function"==typeof n||!r.literal,"Only function value supports literal option"),"function"==typeof n&&r.literal&&(n={[o.symbols.literal]:!0,literal:n});return this.$_setFlag(t,n)}_generate(e,t,n){if(!this.$_terms.whens)return{schema:this};const r=[],s=[];for(let o=0;o<this.$_terms.whens.length;++o){const i=this.$_terms.whens[o];if(i.concat){r.push(i.concat),s.push(`${o}.concat`);continue}const a=i.ref?i.ref.resolve(e,t,n):e,c=i.is?[i]:i.switch,u=s.length;for(let u=0;u<c.length;++u){const{is:l,then:p,otherwise:d}=c[u],h=`${o}${i.switch?"."+u:""}`;if(l.$_match(a,t.nest(l,`${h}.is`),n)){if(p){const o=t.localize([...t.path,`${h}.then`],t.ancestors,t.schemas),{schema:i,id:a}=p._generate(e,o,n);r.push(i),s.push(`${h}.then${a?`(${a})`:""}`);break}}else if(d){const o=t.localize([...t.path,`${h}.otherwise`],t.ancestors,t.schemas),{schema:i,id:a}=d._generate(e,o,n);r.push(i),s.push(`${h}.otherwise${a?`(${a})`:""}`);break}}if(i.break&&s.length>u)break}const o=s.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",o),!o)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[o])return{schema:this.$_temp.whens[o],id:o};let i=this;this._definition.generate&&(i=this._definition.generate(this,e,t,n));for(const e of r)i=i.concat(e);return this.$_root._tracer&&this.$_root._tracer._combine(i,[this,...r]),this.$_temp.whens[o]=i,{schema:i,id:o}}_inner(t,n,r={}){e(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);const s=this.clone();return s.$_terms[t]&&!r.override||(s.$_terms[t]=[]),r.single?s.$_terms[t].push(n):s.$_terms[t].push(...n),s.$_temp.ruleset=!1,s}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;const n=!1!==t.clone?this.clone():this;n._singleRules.delete(e);const r=[];for(let t=0;t<n._rules.length;++t){const s=n._rules[t];s.name!==e||s.keep?r.push(s):n._inRuleset()&&t<n.$_temp.ruleset&&--n.$_temp.ruleset}return n._rules=r,n}_values(t,n){o.verifyFlat(t,n.slice(1,-1));const r=this.clone(),s=t[0]===o.symbols.override;if(s&&(t=t.slice(1)),!r[n]&&t.length?r[n]=new _:s&&(r[n]=t.length?new _:null,r.$_mutateRebuild()),!r[n])return r;s&&r[n].override();for(const s of t){e(void 0!==s,"Cannot call allow/valid/invalid with undefined"),e(s!==o.symbols.override,"Override must be the first value");const t="_invalids"===n?"_valids":"_invalids";r[t]&&(r[t].remove(s),r[t].length||(e("_valids"===n||!r._flags.only,"Setting invalid value",s,"leaves schema rejecting all values due to previous valid rule"),r[t]=null)),r[n].add(s,r._refs)}return r}}};return m.Base.prototype[o.symbols.any]={version:o.version,compile:i.compile,root:"$_root"},m.Base.prototype.isImmutable=!0,m.Base.prototype.deny=m.Base.prototype.invalid,m.Base.prototype.disallow=m.Base.prototype.invalid,m.Base.prototype.equal=m.Base.prototype.valid,m.Base.prototype.exist=m.Base.prototype.required,m.Base.prototype.not=m.Base.prototype.invalid,m.Base.prototype.options=m.Base.prototype.prefs,m.Base.prototype.preferences=m.Base.prototype.prefs,Nq=new m.Base}function Fq(){if(Pq)return Iq;Pq=1;const e=hY(),t=Bq(),n=zY(),r=XY();return Iq=t.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,n){return e("function"==typeof t,"Method must be a function"),e(void 0===n||n&&"string"==typeof n,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:n}})},validate(e,t,{method:n}){try{return n(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(t){e(n.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const r=this.clone();return r.$_terms.shared=r.$_terms.shared||[],r.$_terms.shared.push(t),r.$_mutateRegister(t),r}},warning:{method(t,n){return e(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:n},warn:!0})},validate:(e,t,{code:n,local:r})=>t.error(n,r),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=r.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const n in t){const r=t[n];if(["examples","externals","metas","notes","tags"].includes(n))for(const t of r)e=e[n.slice(0,-1)](t);else{if("alterations"===n){const t={};for(const{target:e,adjuster:n}of r)t[e]=n;e=e.alter(t);continue}if("whens"!==n){if("shared"===n)for(const t of r)e=e.shared(t)}else for(const t of r){const{ref:n,is:r,not:s,then:o,otherwise:i,concat:a}=t;e=a?e.concat(a):n?e.when(n,{is:r,not:s,then:o,otherwise:i,switch:t.switch,break:t.break}):e.when(r,{then:o,otherwise:i,break:t.break})}}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}}),Iq}function Yq(){if(wq)return Mq;wq=1;const e=hY(),t=Tq,n=Fq(),r=zY(),s=tq(),o=VY(),i=WY(),a={};return Mq=n.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:i.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(e,n){const{schema:r,error:s,state:i,prefs:c}=n;if(r._flags.match){const n=[],a=[];for(let t=0;t<r.$_terms.matches.length;++t){const s=r.$_terms.matches[t],o=i.nest(s.schema,`match.${t}`);o.snapshot();const u=s.schema.$_validate(e,o,c);u.errors?(a.push(u.errors),o.restore()):n.push(u.value)}if(0===n.length){return{errors:s("alternatives.any",{details:a.map(e=>o.details(e,{override:!1}))})}}if("one"===r._flags.match)return 1===n.length?{value:n[0]}:{errors:s("alternatives.one")};if(n.length!==r.$_terms.matches.length){return{errors:s("alternatives.all",{details:a.map(e=>o.details(e,{override:!1}))})}}const u=e=>e.$_terms.matches.some(e=>"object"===e.schema.type||"alternatives"===e.schema.type&&u(e.schema));return u(r)?{value:n.reduce((e,n)=>t(e,n,{mergeArrays:!1}))}:{value:n[n.length-1]}}const u=[];for(let t=0;t<r.$_terms.matches.length;++t){const n=r.$_terms.matches[t];if(n.schema){const r=i.nest(n.schema,`match.${t}`);r.snapshot();const s=n.schema.$_validate(e,r,c);if(!s.errors)return s;r.restore(),u.push({schema:n.schema,reports:s.errors});continue}const s=n.ref?n.ref.resolve(e,i,c):e,o=n.is?[n]:n.switch;for(let r=0;r<o.length;++r){const a=o[r],{is:u,then:l,otherwise:p}=a,d=`match.${t}${n.switch?"."+r:""}`;if(u.$_match(s,i.nest(u,`${d}.is`),c)){if(l)return l.$_validate(e,i.nest(l,`${d}.then`),c)}else if(p)return p.$_validate(e,i.nest(p,`${d}.otherwise`),c)}}return a.errors(u,n)},rules:{conditional:{method(t,n){e(!this._flags._endedSwitch,"Unreachable condition"),e(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),e(void 0===n.break,"Cannot use break option with alternatives conditional");const r=this.clone(),o=s.when(r,t,n),i=o.is?[o]:o.switch;for(const e of i)if(e.then&&e.otherwise){r.$_setFlag("_endedSwitch",!0,{clone:!1});break}return r.$_terms.matches.push(o),r.$_mutateRebuild()}},match:{method(t){if(e(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const n of this.$_terms.matches)e(n.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){e(t.length,"Missing alternative schemas"),r.verifyFlat(t,"try"),e(!this._flags._endedSwitch,"Unreachable condition");const n=this.clone();for(const e of t)n.$_terms.matches.push({schema:n.$_compile(e)});return n.$_mutateRebuild()}}},overrides:{label(e){return this.$_parent("label",e).$_modify({each:(t,n)=>"is"!==n.path[0]?t.label(e):void 0,ref:!1})}},rebuild(e){e.$_modify({each:t=>{r.isSchema(t)&&"array"===t.type&&e.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const n of t.matches){const{schema:t,ref:r,is:s,not:o,then:i,otherwise:a}=n;e=t?e.try(t):r?e.conditional(r,{is:s,then:i,not:o,otherwise:a,switch:n.switch}):e.conditional(s,{then:i,otherwise:a})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),a.errors=function(e,{error:t,state:n}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};const r=new Set,s=[];for(const{reports:i,schema:c}of e){if(i.length>1)return a.unmatched(e,t);const u=i[0];if(u instanceof o.Report==!1)return a.unmatched(e,t);if(u.state.path.length!==n.path.length){s.push({type:c.type,report:u});continue}if("any.only"===u.code){for(const e of u.local.valids)r.add(e);continue}const[l,p]=u.code.split(".");"base"===p?r.add(l):s.push({type:c.type,report:u})}return s.length?1===s.length?{errors:s[0].report}:a.unmatched(e,t):{errors:t("alternatives.types",{types:[...r]})}},a.unmatched=function(e,t){const n=[];for(const t of e)n.push(...t.reports);return{errors:t("alternatives.match",o.details(n,{override:!1}))}},Mq}function qq(){if(xq)return Lq;xq=1;const e=hY(),t=pq,n=fY(),r=Fq(),s=zY(),o=tq(),i={};return Lq=r.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:n,prefs:r}){if(!Array.isArray(e))return;const s=t.$_getRule("sort");return s?i.sort(t,e,s.args.options,n,r):void 0}},validate(e,{schema:t,error:n}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[s.symbols.arraySingle]=!0,{value:t}}return{errors:n("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});const t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:n,error:r},{schema:s}){const o=[e,...t.ancestors];for(let r=0;r<e.length;++r){const i=t.localize([...t.path,r],o,s);if(s.$_match(e[r],i,n))return e}const i=s._flags.label;return i?r("array.hasKnown",{patternLabel:i}):r("array.hasUnknown",null)},multi:!0},items:{method(...e){s.verifyFlat(e,"items");const t=this.$_addRule("items");for(let n=0;n<e.length;++n){const r=s.tryWithPath(()=>this.$_compile(e[n]),n,{append:!0});t.$_terms.items.push(r)}return t.$_mutateRebuild()},validate(e,{schema:t,error:n,state:r,prefs:o,errorsArray:a}){const c=t.$_terms._requireds.slice(),u=t.$_terms.ordered.slice(),l=[...t.$_terms._inclusions,...c],p=!e[s.symbols.arraySingle];delete e[s.symbols.arraySingle];const d=a();let h=e.length;for(let s=0;s<h;++s){const a=e[s];let f=!1,_=!1;const m=p?s:new Number(s),g=[...r.path,m];if(!t._flags.sparse&&void 0===a){if(d.push(n("array.sparse",{key:m,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly)return d;u.shift();continue}const E=[e,...r.ancestors];for(const e of t.$_terms._exclusions)if(e.$_match(a,r.localize(g,E,e),o,{presence:"ignore"})){if(d.push(n("array.excludes",{pos:s,value:a},r.localize(g))),o.abortEarly)return d;f=!0,u.shift();break}if(f)continue;if(t.$_terms.ordered.length){if(u.length){const c=u.shift(),l=c.$_validate(a,r.localize(g,E,c),o);if(l.errors){if(d.push(...l.errors),o.abortEarly)return d}else if("strip"===c._flags.result)i.fastSplice(e,s),--s,--h;else{if(!t._flags.sparse&&void 0===l.value){if(d.push(n("array.sparse",{key:m,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly)return d;continue}e[s]=l.value}continue}if(!t.$_terms.items.length){if(d.push(n("array.orderedLength",{pos:s,limit:t.$_terms.ordered.length})),o.abortEarly)return d;break}}const S=[];let T=c.length;for(let u=0;u<T;++u){const l=r.localize(g,E,c[u]);l.snapshot();const p=c[u].$_validate(a,l,o);if(S[u]=p,!p.errors){if(e[s]=p.value,_=!0,i.fastSplice(c,u),--u,--T,!t._flags.sparse&&void 0===p.value&&(d.push(n("array.sparse",{key:m,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly))return d;break}l.restore()}if(_)continue;const y=o.stripUnknown&&!!o.stripUnknown.arrays||!1;T=l.length;for(const u of l){let l;const p=c.indexOf(u);if(-1!==p)l=S[p];else{const c=r.localize(g,E,u);if(c.snapshot(),l=u.$_validate(a,c,o),!l.errors){"strip"===u._flags.result?(i.fastSplice(e,s),--s,--h):t._flags.sparse||void 0!==l.value?e[s]=l.value:(d.push(n("array.sparse",{key:m,path:g,pos:s,value:void 0},r.localize(g))),f=!0),_=!0;break}c.restore()}if(1===T){if(y){i.fastSplice(e,s),--s,--h,_=!0;break}if(d.push(...l.errors),o.abortEarly)return d;f=!0;break}}if(!f&&((t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!_)){if(y){i.fastSplice(e,s),--s,--h;continue}if(d.push(n("array.includes",{pos:s,value:a},r.localize(g))),o.abortEarly)return d}}return c.length&&i.fillMissedErrors(t,d,c,e,r,o),u.length&&(i.fillOrderedErrors(t,d,u,e,r,o),d.length||i.fillDefault(u,e,r,o)),d.length?d:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:r,operator:o,args:i})=>s.compare(e.length,n,o)?e:t.error("array."+r,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:s.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){s.verifyFlat(e,"ordered");const t=this.$_addRule("items");for(let n=0;n<e.length;++n){const r=s.tryWithPath(()=>this.$_compile(e[n]),n,{append:!0});i.validateSingle(r,t),t.$_mutateRegister(r),t.$_terms.ordered.push(r)}return t.$_mutateRebuild()}},single:{method(t){const n=void 0===t||!!t;return e(!n||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",n)}},sort:{method(t={}){s.assertOptions(t,["by","order"]);const n={order:t.order||"ascending"};return t.by&&(n.by=o.ref(t.by,{ancestor:0}),e(!n.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:n}})},validate(e,{error:t,state:n,prefs:r,schema:s},{options:o}){const{value:a,errors:c}=i.sort(s,e,o,n,r);if(c)return c;for(let n=0;n<e.length;++n)if(e[n]!==a[n])return t("array.sort",{order:o.order,by:o.by?o.by.key:"value"});return e},convert:!0},sparse:{method(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;return(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(t,n={}){e(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),s.assertOptions(n,["ignoreUndefined","separator"]);const r={name:"unique",args:{options:n,comparator:t}};if(t)if("string"==typeof t){const e=s.default(n.separator,".");r.path=e?t.split(e):[t]}else r.comparator=t;return this.$_addRule(r)},validate(r,{state:s,error:o,schema:i},{comparator:a,options:c},{comparator:u,path:l}){const p={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},d=u||t,h=c.ignoreUndefined;for(let t=0;t<r.length;++t){const i=l?n(r[t],l):r[t],c=u?p.custom:p[typeof i];if(e(c,"Failed to find unique map container for type",typeof i),c instanceof Map){const e=c.entries();let n;for(;!(n=e.next()).done;)if(d(n.value[0],i)){const e=s.localize([...s.path,t],[r,...s.ancestors]),i={pos:t,value:r[t],dupePos:n.value[1],dupeValue:r[n.value[1]]};return l&&(i.path=a),o("array.unique",i,e)}c.set(i,t)}else{if((!h||void 0!==i)&&void 0!==c[i]){const e={pos:t,value:r[t],dupePos:c[i],dupeValue:r[c[i]]};l&&(e.path=a);return o("array.unique",e,s.localize([...s.path,t],[r,...s.ancestors]))}c[i]=t}}return r},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)i.validateSingle(t,e),"required"===t._flags.presence?e.$_terms._requireds.push(t):"forbidden"===t._flags.presence?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(const t of e.$_terms.ordered)i.validateSingle(t,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),i.fillMissedErrors=function(e,t,n,r,s,o){const i=[];let a=0;for(const e of n){const t=e._flags.label;t?i.push(t):++a}i.length?a?t.push(e.$_createError("array.includesRequiredBoth",r,{knownMisses:i,unknownMisses:a},s,o)):t.push(e.$_createError("array.includesRequiredKnowns",r,{knownMisses:i},s,o)):t.push(e.$_createError("array.includesRequiredUnknowns",r,{unknownMisses:a},s,o))},i.fillOrderedErrors=function(e,t,n,r,s,o){const a=[];for(const e of n)"required"===e._flags.presence&&a.push(e);a.length&&i.fillMissedErrors(e,t,a,r,s,o)},i.fillDefault=function(e,t,n,r){const s=[];let o=!0;for(let i=e.length-1;i>=0;--i){const a=e[i],c=[t,...n.ancestors],u=a.$_validate(void 0,n.localize(n.path,c,a),r).value;if(o){if(void 0===u)continue;o=!1}s.unshift(u)}s.length&&t.push(...s)},i.fastSplice=function(e,t){let n=t;for(;n<e.length;)e[n++]=e[n];--e.length},i.validateSingle=function(t,n){("array"===t.type||t._flags._arrayItems)&&(e(!n._flags.single,"Cannot specify array item with single rule enabled"),n.$_setFlag("_arrayItems",!0,{clone:!1}))},i.sort=function(e,t,n,r,s){const o="ascending"===n.order?1:-1,a=-1*o,c=o,u=(u,l)=>{let p=i.compare(u,l,a,c);if(null!==p)return p;if(n.by&&(u=n.by.resolve(u,r,s),l=n.by.resolve(l,r,s)),p=i.compare(u,l,a,c),null!==p)return p;const d=typeof u;if(d!==typeof l)throw e.$_createError("array.sort.mismatching",t,null,r,s);if("number"!==d&&"string"!==d)throw e.$_createError("array.sort.unsupported",t,{type:d},r,s);return"number"===d?(u-l)*o:u<l?a:c};try{return{value:t.slice().sort(u)}}catch(e){return{errors:e}}},i.compare=function(e,t,n,r){return e===t?0:void 0===e?1:void 0===t?-1:null===e?r:null===t?n:null},Lq}function Kq(){if(kq)return Dq;kq=1;const e=hY(),t=Fq(),n=zY(),r=Hq(),s={isBool:function(e){return"boolean"==typeof e}};return Dq=t.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if("boolean"!=typeof e){if("string"==typeof e){const n=t._flags.sensitive?e:e.toLowerCase();e="true"===n||"false"!==n&&e}return"boolean"!=typeof e&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e),{value:e}}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){n.verifyFlat(t,"truthy");const s=this.clone();s.$_terms.truthy=s.$_terms.truthy||new r;for(let n=0;n<t.length;++n){const r=t[n];e(void 0!==r,"Cannot call truthy with undefined"),s.$_terms.truthy.add(r)}return s}},falsy:{method(...t){n.verifyFlat(t,"falsy");const s=this.clone();s.$_terms.falsy=s.$_terms.falsy||new r;for(let n=0;n<t.length;++n){const r=t[n];e(void 0!==r,"Cannot call falsy with undefined"),s.$_terms.falsy.add(r)}return s}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:s.isBool,to:(e,t)=>e?1:0},string:{from:s.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e)},messages:{"boolean.base":"{{#label}} must be a boolean"}}),Dq}function Wq(){if($q)return Uq;$q=1;const e=hY(),t=Fq(),n=zY(),r=ZY(),s={isDate:function(e){return e instanceof Date}};return Uq=t.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:s.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:n,prefs:r}){if(e instanceof Date&&!isNaN(e.getTime()))return;const s=t._flags.format;return r.convert&&s&&"string"==typeof e?{value:e,errors:n("date.format",{format:s})}:{value:e,errors:n("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:r},{name:s,operator:o,args:i}){const a="now"===r?Date.now():r.getTime();return n.compare(e.getTime(),a,o)?e:t.error("date."+s,{limit:i.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:s.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(t){return e(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(t="javascript"){return e(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:s.isDate,to:(e,t)=>e.getTime()},string:{from:s.isDate,to:(e,{prefs:t})=>r.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),s.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return n.isIsoDate(e)?s.date(e.toString()):null;const r=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return s.date(1*e);if("unix"===t)return s.date(1e3*e);if("string"==typeof r)return null}return s.date(e)},s.date=function(e){const t=new Date(e);return isNaN(t.getTime())?null:t},Uq}const Zq=hY(),Xq=vY(),zq=Tq,Qq=fY(),Jq={};var eK=function(e,t,n={}){if(Zq(e&&"object"==typeof e,"Invalid defaults value: must be an object"),Zq(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),Zq("object"==typeof n,"Invalid options: must be an object"),!t)return null;if(n.shallow)return Jq.applyToDefaultsWithShallow(e,t,n);const r=Xq(e);if(!0===t)return r;const s=void 0!==n.nullOverride&&n.nullOverride;return zq(r,t,{nullOverride:s,mergeArrays:!1})};Jq.applyToDefaultsWithShallow=function(e,t,n){const r=n.shallow;Zq(Array.isArray(r),"Invalid keys");const s=new Map,o=!0===t?null:new Set;for(let n of r){n=Array.isArray(n)?n:n.split(".");const r=Qq(e,n);r&&"object"==typeof r?s.set(r,o&&Qq(t,n)||r):o&&o.add(n)}const i=Xq(e,{},s);if(!o)return i;for(const e of o)Jq.reachCopy(i,t,e);const a=void 0!==n.nullOverride&&n.nullOverride;return zq(i,t,{nullOverride:a,mergeArrays:!1})},Jq.reachCopy=function(e,t,n){for(const e of n){if(!(e in t))return;const n=t[e];if("object"!=typeof n||null===n)return;t=n}const r=t;let s=e;for(let e=0;e<n.length-1;++e){const t=n[e];"object"!=typeof s[t]&&(s[t]={}),s=s[t]}s[n[n.length-1]]=r};var tK={};const nK=hY(),rK={};var sK,oK,iK,aK,cK,uK,lK,pK,dK,hK;function fK(){if(oK)return sK;oK=1;const e=eK,t=hY(),n=vY(),r=tK,s=Fq(),o=zY(),i=tq(),a=VY(),c=WY(),u=ZY(),l={renameDefaults:{alias:!1,multiple:!1,override:!1}};return sK=s.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:n,state:r,prefs:s}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:n("object.base",{type:t.$_property("typeof")})};if(!(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals))return;e=l.clone(e,s);const o=[];if(t.$_terms.renames&&!l.rename(t,e,r,s,o))return{value:e,errors:o};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:o};const i=new Set(Object.keys(e));if(t.$_terms.keys){const n=[e,...r.ancestors];for(const a of t.$_terms.keys){const t=a.key,c=e[t];i.delete(t);const u=r.localize([...r.path,t],n,a),l=a.schema.$_validate(c,u,s);if(l.errors){if(s.abortEarly)return{value:e,errors:l.errors};void 0!==l.value&&(e[t]=l.value),o.push(...l.errors)}else"strip"===a.schema._flags.result||void 0===l.value&&void 0!==c?delete e[t]:void 0!==l.value&&(e[t]=l.value)}}if(i.size||t._flags._hasPatternMatch){const n=l.unknown(t,e,i,o,r,s);if(n)return n}if(t.$_terms.dependencies)for(const n of t.$_terms.dependencies){if(null!==n.key&&!1===l.isPresent(n.options)(n.key.resolve(e,r,s,null,{shadow:!1})))continue;const i=l.dependencies[n.rel](t,n,e,r,s);if(i){const n=t.$_createError(i.code,e,i.context,r,s);if(s.abortEarly)return{value:e,errors:n};o.push(n)}}return{value:e,errors:o}},rules:{and:{method(...e){return o.verifyFlat(e,"and"),l.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,n,r){u.isTemplate(e)||(e=i.ref(e)),t(void 0===r||"string"==typeof r,"Message must be a string"),n=this.$_compile(n,{appendPath:!0});const s=this.$_addRule({name:"assert",args:{subject:e,schema:n,message:r}});return s.$_mutateRegister(e),s.$_mutateRegister(n),s},validate(e,{error:t,prefs:n,state:r},{subject:s,schema:o,message:i}){const a=s.resolve(e,r,n),u=c.isRef(s)?s.absolute(r):[];return o.$_match(a,r.localize(u,[e,...r.ancestors],o),n)?e:t("object.assert",{subject:s,message:i})},args:["subject","schema","message"],multi:!0},instance:{method(e,n){return t("function"==typeof e,"constructor must be a function"),n=n||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:n}})},validate:(e,t,{constructor:n,name:r})=>e instanceof n?e:t.error("object.instance",{type:r,value:e}),args:["constructor","name"]},keys:{method(e){t(void 0===e||"object"==typeof e,"Object schema must be a valid object"),t(!o.isSchema(e),"Object schema cannot be a joi schema");const n=this.clone();if(e)if(Object.keys(e).length){n.$_terms.keys=n.$_terms.keys?n.$_terms.keys.filter(t=>!e.hasOwnProperty(t.key)):new l.Keys;for(const t in e)o.tryWithPath(()=>n.$_terms.keys.push({key:t,schema:this.$_compile(e[t])}),t)}else n.$_terms.keys=new l.Keys;else n.$_terms.keys=null;return n.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:r,operator:s,args:i})=>o.compare(Object.keys(e).length,n,s)?e:t.error("object."+r,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:o.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return o.verifyFlat(e,"nand"),l.dependency(this,"nand",null,e)}},or:{method(...e){return o.verifyFlat(e,"or"),l.dependency(this,"or",null,e)}},oxor:{method(...e){return l.dependency(this,"oxor",null,e)}},pattern:{method(e,n,r={}){const s=e instanceof RegExp;s||(e=this.$_compile(e,{appendPath:!0})),t(void 0!==n,"Invalid rule"),o.assertOptions(r,["fallthrough","matches"]),s&&t(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),n=this.$_compile(n,{appendPath:!0});const i=this.clone();i.$_terms.patterns=i.$_terms.patterns||[];const a={[s?"regex":"schema"]:e,rule:n};return r.matches&&(a.matches=this.$_compile(r.matches),"array"!==a.matches.type&&(a.matches=a.matches.$_root.array().items(a.matches)),i.$_mutateRegister(a.matches),i.$_setFlag("_hasPatternMatch",!0,{clone:!1})),r.fallthrough&&(a.fallthrough=!0),i.$_terms.patterns.push(a),i.$_mutateRegister(n),i}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>c.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(n,r,s={}){t("string"==typeof n||n instanceof RegExp,"Rename missing the from argument"),t("string"==typeof r||r instanceof u,"Invalid rename to argument"),t(r!==n,"Cannot rename key to same name:",n),o.assertOptions(s,["alias","ignoreUndefined","override","multiple"]);const i=this.clone();i.$_terms.renames=i.$_terms.renames||[];for(const e of i.$_terms.renames)t(e.from!==n,"Cannot rename the same key multiple times");return r instanceof u&&i.$_mutateRegister(r),i.$_terms.renames.push({from:n,to:r,options:e(l.renameDefaults,s)}),i}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:n})=>!o.isSchema(e)||"any"!==n&&e.type!==n?t.error("object.schema",{type:n}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,n={}){return l.dependency(this,"with",e,t,n)}},without:{method(e,t,n={}){return l.dependency(this,"without",e,t,n)}},xor:{method(...e){return o.verifyFlat(e,"xor"),l.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=o.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){const t=new r.Sorter;for(const n of e.$_terms.keys)o.tryWithPath(()=>t.add(n,{after:n.schema.$_rootReferences(),group:n.key}),n.key);e.$_terms.keys=new l.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(const{rel:n,key:r=null,peers:s,options:o}of t.dependencies)e=l.dependency(e,n,r,s,o);if(t.patterns)for(const{regex:n,schema:r,rule:s,fallthrough:o,matches:i}of t.patterns)e=e.pattern(n||r,s,{fallthrough:o,matches:i});if(t.renames)for(const{from:n,to:r,options:s}of t.renames)e=e.rename(n,r,s);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),l.clone=function(e,t){if("object"==typeof e){if(t.nonEnumerables)return n(e,{shallow:!0});const r=Object.create(Object.getPrototypeOf(e));return Object.assign(r,e),r}const r=function(...t){return e.apply(this,t)};return r.prototype=n(e.prototype),Object.defineProperty(r,"name",{value:e.name,writable:!1}),Object.defineProperty(r,"length",{value:e.length,writable:!1}),Object.assign(r,e),r},l.dependency=function(e,n,r,s,a){t(null===r||"string"==typeof r,n,"key must be a strings"),a||(a=s.length>1&&"object"==typeof s[s.length-1]?s.pop():{}),o.assertOptions(a,["separator","isPresent"]),s=[].concat(s);const c=o.default(a.separator,"."),u=[];for(const e of s)t("string"==typeof e,n,"peers must be strings"),u.push(i.ref(e,{separator:c,ancestor:0,prefix:!1}));null!==r&&(r=i.ref(r,{separator:c,ancestor:0,prefix:!1}));const p=e.clone();return p.$_terms.dependencies=p.$_terms.dependencies||[],p.$_terms.dependencies.push(new l.Dependency(n,r,u,s,a)),p},l.dependencies={and(e,t,n,r,s){const o=[],i=[],a=t.peers.length,c=l.isPresent(t.options);for(const e of t.peers)!1===c(e.resolve(n,r,s,null,{shadow:!1}))?o.push(e.key):i.push(e.key);if(o.length!==a&&i.length!==a)return{code:"object.and",context:{present:i,presentWithLabels:l.keysToLabels(e,i),missing:o,missingWithLabels:l.keysToLabels(e,o)}}},nand(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(o.length!==t.peers.length)return;const a=t.paths[0],c=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:l.keysToLabels(e,a),peers:c,peersWithLabels:l.keysToLabels(e,c)}}},or(e,t,n,r,s){const o=l.isPresent(t.options);for(const e of t.peers)if(o(e.resolve(n,r,s,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)}}},oxor(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(!o.length||1===o.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return a.present=o,a.presentWithLabels=l.keysToLabels(e,o),{code:"object.oxor",context:a}},with(e,t,n,r,s){const o=l.isPresent(t.options);for(const i of t.peers)if(!1===o(i.resolve(n,r,s,null,{shadow:!1})))return{code:"object.with",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:i.key,peerWithLabel:l.keysToLabels(e,i.key)}}},without(e,t,n,r,s){const o=l.isPresent(t.options);for(const i of t.peers)if(o(i.resolve(n,r,s,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:i.key,peerWithLabel:l.keysToLabels(e,i.key)}}},xor(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(1===o.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return 0===o.length?{code:"object.missing",context:a}:(a.present=o,a.presentWithLabels=l.keysToLabels(e,o),{code:"object.xor",context:a})}},l.keysToLabels=function(e,t){return Array.isArray(t)?t.map(t=>e.$_mapLabels(t)):e.$_mapLabels(t)},l.isPresent=function(e){return"function"==typeof e.isPresent?e.isPresent:e=>void 0!==e},l.rename=function(e,t,n,r,s){const o={};for(const i of e.$_terms.renames){const a=[],c="string"!=typeof i.from;if(c)for(const e in t){if(void 0===t[e]&&i.options.ignoreUndefined)continue;if(e===i.to)continue;const n=i.from.exec(e);n&&a.push({from:e,to:i.to,match:n})}else!Object.prototype.hasOwnProperty.call(t,i.from)||void 0===t[i.from]&&i.options.ignoreUndefined||a.push(i);for(const l of a){const a=l.from;let p=l.to;if(p instanceof u&&(p=p.render(t,n,r,l.match)),a!==p){if(!i.options.multiple&&o[p]&&(s.push(e.$_createError("object.rename.multiple",t,{from:a,to:p,pattern:c},n,r)),r.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(t,p)&&!i.options.override&&!o[p]&&(s.push(e.$_createError("object.rename.override",t,{from:a,to:p,pattern:c},n,r)),r.abortEarly))return!1;void 0===t[a]?delete t[p]:t[p]=t[a],o[p]=!0,i.options.alias||delete t[a]}}}return!0},l.unknown=function(e,t,n,r,s,i){if(e.$_terms.patterns){let o=!1;const c=e.$_terms.patterns.map(e=>{if(e.matches)return o=!0,[]}),u=[t,...s.ancestors];for(const o of n){const a=t[o],l=[...s.path,o];for(let p=0;p<e.$_terms.patterns.length;++p){const d=e.$_terms.patterns[p];if(d.regex){const e=d.regex.test(o);if(s.mainstay.tracer.debug(s,"rule",`pattern.${p}`,e?"pass":"error"),!e)continue}else if(!d.schema.$_match(o,s.nest(d.schema,`pattern.${p}`),i))continue;n.delete(o);const h=s.localize(l,u,{schema:d.rule,key:o}),f=d.rule.$_validate(a,h,i);if(f.errors){if(i.abortEarly)return{value:t,errors:f.errors};r.push(...f.errors)}if(d.matches&&c[p].push(o),t[o]=f.value,!d.fallthrough)break}}if(o)for(let n=0;n<c.length;++n){const o=c[n];if(!o)continue;const l=e.$_terms.patterns[n].matches,p=s.localize(s.path,u,l),d=l.$_validate(o,p,i);if(d.errors){const n=a.details(d.errors,{override:!1});n.matches=o;const c=e.$_createError("object.pattern.match",t,n,s,i);if(i.abortEarly)return{value:t,errors:c};r.push(c)}}}if(!n.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(i.stripUnknown&&!e._flags.unknown||i.skipFunctions){const e=!!i.stripUnknown&&(!0===i.stripUnknown||!!i.stripUnknown.objects);for(const r of n)e?(delete t[r],n.delete(r)):"function"==typeof t[r]&&n.delete(r)}if(!o.default(e._flags.unknown,i.allowUnknown))for(const o of n){const n=s.localize([...s.path,o],[]),a=e.$_createError("object.unknown",t[o],{child:o},n,i,{flags:!1});if(i.abortEarly)return{value:t,errors:a};r.push(a)}},l.Dependency=class{constructor(e,t,n,r,s){this.rel=e,this.key=t,this.peers=n,this.paths=r,this.options=s}describe(){const e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}},l.Keys=class extends Array{concat(e){const t=this.slice(),n=new Map;for(let e=0;e<t.length;++e)n.set(t[e].key,e);for(const r of e){const e=r.key,s=n.get(e);void 0!==s?t[s]={key:e,schema:t[s].schema.concat(r.schema)}:t.push(r)}return t}},sK}function _K(){if(aK)return iK;aK=1;const e=hY(),t=fK();return iK=t.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(e,t,{n:n})=>e.length===n?e:t.error("function.arity",{n:n})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(t){return e(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(e,t,{n:n})=>e.length>=n?e:t.error("function.minArity",{n:n})},maxArity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(e,t,{n:n})=>e.length<=n?e:t.error("function.maxArity",{n:n})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})}function mK(){if(uK)return cK;uK=1;const e=hY(),t=Fq(),n=zY(),r=tq(),s=VY(),o={};return cK=t.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(t,{schema:n,state:r,prefs:s}){e(n.$_terms.link,"Uninitialized link schema");const i=o.generate(n,t,r,s),a=n.$_terms.link[0].ref;return i.$_validate(t,r.nest(i,`link:${a.display}:${i.type}`),s)},generate:(e,t,n,r)=>o.generate(e,t,n,r),rules:{ref:{method(t){e(!this.$_terms.link,"Cannot reinitialize schema"),t=r.ref(t),e("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),e("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const n=this.clone();return n.$_terms.link=[{ref:t}],n}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(t){e(this.$_terms.link,"Uninitialized link schema"),e(n.isSchema(t),"Invalid schema object"),e("link"!==t.type,"Cannot merge type link with another link");const r=this.clone();return r.$_terms.whens||(r.$_terms.whens=[]),r.$_terms.whens.push({concat:t}),r.$_mutateRebuild()}},manifest:{build:(t,n)=>(e(n.link,"Invalid link description missing link"),t.ref(n.link))}}),o.generate=function(e,t,n,r){let s=n.mainstay.links.get(e);if(s)return s._generate(t,n,r).schema;const i=e.$_terms.link[0].ref,{perspective:a,path:c}=o.perspective(i,n);o.assert(a,"which is outside of schema boundaries",i,e,n,r);try{s=c.length?a.$_reach(c):a}catch(t){o.assert(!1,"to non-existing schema",i,e,n,r)}return o.assert("link"!==s.type,"which is another link",i,e,n,r),e._flags.relative||n.mainstay.links.set(e,s),s._generate(t,n,r).schema},o.perspective=function(e,t){if("local"===e.type){for(const{schema:n,key:r}of t.schemas){if((n._flags.id||r)===e.path[0])return{perspective:n,path:e.path.slice(1)};if(n.$_terms.shared)for(const t of n.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}}return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}},o.assert=function(t,n,r,o,i,a){t||e(!1,`"${s.label(o._flags,i,a)}" contains link reference "${r.display}" ${n}`)},cK}function gK(){if(pK)return lK;pK=1;const e=hY(),t=Fq(),n=zY(),r={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/};return lK=t.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:n}){if(!e.match(r.numberRx))return;e=e.trim();const s={value:parseFloat(e)};if(0===s.value&&(s.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(r.extractSignificantDigits(e)!==r.extractSignificantDigits(String(s.value)))return s.errors=n("number.unsafe"),s}else{const t=s.value.toString();if(t.match(/e/i))return s;if(t!==r.normalizeDecimal(e))return s.errors=n("number.unsafe"),s}return s}},validate(e,{schema:t,error:r,prefs:s}){if(e===1/0||e===-1/0)return{value:e,errors:r("number.infinity")};if(!n.isNumber(e))return{value:e,errors:r("number.base")};const o={value:e};if(s.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);o.value=Math.round(o.value*t)/t}}return 0===o.value&&(o.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(o.errors=r("number.unsafe")),o},rules:{compare:{method:!1,validate:(e,t,{limit:r},{name:s,operator:o,args:i})=>n.compare(e,r,o)?e:t.error("number."+s,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:n.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e===0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){return this.$_addRule({name:"multiple",args:{base:e}})},validate:(e,t,{base:n},r)=>e*(1/n)%1==0?e:t.error("number.multiple",{multiple:r.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&e>0,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return e(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(e,t,{limit:n}){const s=e.toString().match(r.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=n?e:t.error("number.precision",{limit:n,value:e})},convert:!0},sign:{method(t){return e(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(e,t,{sign:n})=>"negative"===n&&e<0||"positive"===n&&e>0?e:t.error(`number.${n}`)},unsafe:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),r.extractSignificantDigits=function(e){return e.replace(r.exponentialPartRegex,"").replace(r.dotRegex,"").replace(r.trailingZerosRegex,"").replace(r.leadingSignAndZerosRegex,"")},r.normalizeDecimal=function(e){return(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),"-0"===e?"0":e},lK}function EK(){if(hK)return dK;hK=1;const e=fK();return dK=e.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}})}tK.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){const n=[].concat((t=t||{}).before||[]),r=[].concat(t.after||[]),s=t.group||"?",o=t.sort||0;nK(!n.includes(s),`Item cannot come before itself: ${s}`),nK(!n.includes("?"),"Item cannot come before unassociated items"),nK(!r.includes(s),`Item cannot come after itself: ${s}`),nK(!r.includes("?"),"Item cannot come after unassociated items"),Array.isArray(e)||(e=[e]);for(const t of e){const e={seq:this._items.length,sort:o,before:n,after:r,group:s,node:t};this._items.push(e)}if(!t.manual){const e=this._sort();nK(e,"item","?"!==s?`added into group ${s}`:"","created a dependencies error")}return this.nodes}merge(e){Array.isArray(e)||(e=[e]);for(const t of e)if(t)for(const e of t._items)this._items.push(Object.assign({},e));this._items.sort(rK.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return nK(t,"merge created a dependencies error"),this.nodes}sort(){const e=this._sort();return nK(e,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),n=Object.create(null);for(const r of this._items){const s=r.seq,o=r.group;n[o]=n[o]||[],n[o].push(s),e[s]=r.before;for(const e of r.after)t[e]=t[e]||[],t[e].push(s)}for(const t in e){const r=[];for(const s in e[t]){const o=e[t][s];n[o]=n[o]||[],r.push(...n[o])}e[t]=r}for(const r in t)if(n[r])for(const s of n[r])e[s].push(...t[r]);const r={};for(const t in e){const n=e[t];for(const e of n)r[e]=r[e]||[],r[e].push(t)}const s={},o=[];for(let e=0;e<this._items.length;++e){let t=e;if(r[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===s[e])continue;r[e]||(r[e]=[]);const n=r[e].length;let o=0;for(let t=0;t<n;++t)s[r[e][t]]&&++o;if(o===n){t=e;break}}}null!==t&&(s[t]=!0,o.push(t))}if(o.length!==this._items.length)return!1;const i={};for(const e of this._items)i[e.seq]=e;this._items=[],this.nodes=[];for(const e of o){const t=i[e];this.nodes.push(t.node),this._items.push(t)}return!0}},rK.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1;var SK={},TK={};!function(e){e.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},e.code=function(t){return{code:t,error:e.codes[t]}}}(TK),function(e){const t=TK,n={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:i.URL||URL};e.analyze=function(e,r={}){if(!e)return t.code("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(e.length>256)return t.code("DOMAIN_TOO_LONG");if(!!n.nonAsciiRx.test(e)){if(!1===r.allowUnicode)return t.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(n.domainControlRx.test(e))return t.code("DOMAIN_INVALID_CHARS");e=n.punycode(e),r.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));const s=r.minDomainSegments||n.minDomainSegments,o=e.split(".");if(o.length<s)return t.code("DOMAIN_SEGMENTS_COUNT");if(r.maxDomainSegments&&o.length>r.maxDomainSegments)return t.code("DOMAIN_SEGMENTS_COUNT_MAX");const i=r.tlds;if(i){const e=o[o.length-1].toLowerCase();if(i.deny&&i.deny.has(e)||i.allow&&!i.allow.has(e))return t.code("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<o.length;++e){const r=o[e];if(!r.length)return t.code("DOMAIN_EMPTY_SEGMENT");if(r.length>63)return t.code("DOMAIN_LONG_SEGMENT");if(e<o.length-1){if(!n.domainSegmentRx.test(r))return t.code("DOMAIN_INVALID_CHARS")}else if(!n.tldSegmentRx.test(r))return t.code("DOMAIN_INVALID_TLDS_CHARS")}return null},e.isValid=function(t,n){return!e.analyze(t,n)},n.punycode=function(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new n.URL(`http://${e}`).host}catch(t){return e}}}(SK);var yK={};const AK=SK,vK=TK,bK={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(s.TextEncoder||TextEncoder)};yK.analyze=function(e,t){return bK.email(e,t)},yK.isValid=function(e,t){return!bK.email(e,t)},bK.email=function(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return vK.code("EMPTY_STRING");const n=!bK.nonAsciiRx.test(e);if(!n){if(!1===t.allowUnicode)return vK.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}const r=e.split("@");if(2!==r.length)return r.length>2?vK.code("MULTIPLE_AT_CHAR"):vK.code("MISSING_AT_CHAR");const[s,o]=r;if(!s)return vK.code("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return vK.code("ADDRESS_TOO_LONG");if(bK.encoder.encode(s).length>64)return vK.code("LOCAL_TOO_LONG")}return bK.local(s,n)||AK.analyze(o,t)},bK.local=function(e,t){const n=e.split(".");for(const e of n){if(!e.length)return vK.code("EMPTY_LOCAL_SEGMENT");if(t){if(!bK.atextRx.test(e))return vK.code("INVALID_LOCAL_CHARS")}else for(const t of e){if(bK.atextRx.test(t))continue;const e=bK.binary(t);if(!bK.atomRx.test(e))return vK.code("INVALID_LOCAL_CHARS")}}},bK.binary=function(e){return Array.from(bK.encoder.encode(e)).map(e=>String.fromCharCode(e)).join("")},bK.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,bK.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"));var RK={},OK={},NK=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};const CK=hY(),IK=NK,PK={generate:function(){const e={},t="\\dA-Fa-f",n="["+t+"]",r="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",o="%"+t,i=r+o+s+":@",a="["+i+"]",c="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+c+"\\.){3}"+c;const u=n+"{1,4}",l="(?:"+u+":"+u+"|"+e.ipv4address+")",p="(?:"+u+":){6}"+l,d="::(?:"+u+":){5}"+l,h="(?:"+u+")?::(?:"+u+":){4}"+l,f="(?:(?:"+u+":){0,1}"+u+")?::(?:"+u+":){3}"+l,_="(?:(?:"+u+":){0,2}"+u+")?::(?:"+u+":){2}"+l,m="(?:(?:"+u+":){0,3}"+u+")?::"+u+":"+l,g="(?:(?:"+u+":){0,4}"+u+")?::"+l,E="(?:(?:"+u+":){0,5}"+u+")?::"+u,S="(?:(?:"+u+":){0,6}"+u+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+p+"|"+d+"|"+h+"|"+f+"|"+_+"|"+m+"|"+g+"|"+E+"|"+S+")",e.ipvFuture="v"+n+"+\\.["+r+s+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);const T="["+r+o+s+":]*",y="["+r+o+s+"]{1,255}",A="(?:"+("\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]")+"|"+e.ipv4address+"|"+y+")",v="(?:"+T+"@)?"+A+"(?::\\d*)?",b="(?:"+T+"@)?("+A+")(?::\\d*)?",R=a+"*",O=a+"+",N="(?:\\/"+R+")*",C="\\/(?:"+O+N+")?",I=O+N,P="["+r+o+s+"@]+"+N,M="(?:\\/\\/\\/"+R+N+")";return e.hierPart="(?:(?:\\/\\/"+v+N+")|"+C+"|"+I+"|"+M+")",e.hierPartCapture="(?:(?:\\/\\/"+b+N+")|"+C+"|"+I+")",e.relativeRef="(?:(?:\\/\\/"+v+N+")|"+C+"|"+P+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+b+N+")|"+C+"|"+P+"|)",e.query="["+i+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+i+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+i+"\\/\\?]*",e}};PK.rfc3986=PK.generate(),OK.ip={v4Cidr:PK.rfc3986.ipv4Cidr,v6Cidr:PK.rfc3986.ipv6Cidr,ipv4:PK.rfc3986.ipv4address,ipv6:PK.rfc3986.ipv6address,ipvfuture:PK.rfc3986.ipvFuture},PK.createRegex=function(e){const t=PK.rfc3986,n="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",r=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return PK.wrap(r+n);let s="";if(e.scheme){CK(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const n=[].concat(e.scheme);CK(n.length>=1,"scheme must have at least 1 scheme specified");const r=[];for(let e=0;e<n.length;++e){const s=n[e];CK(s instanceof RegExp||"string"==typeof s,"scheme at position "+e+" must be a RegExp or String"),s instanceof RegExp?r.push(s.source.toString()):(CK(t.schemeRegex.test(s),"scheme at position "+e+" must be a valid scheme"),r.push(IK(s)))}s=r.join("|")}const o="(?:"+(s?"(?:"+s+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",i=e.allowRelative?"(?:"+o+"|"+r+")":o;return PK.wrap(i+n,s)},PK.wrap=function(e,t){return{raw:e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,regex:new RegExp(`^${e}$`),scheme:t}},PK.uriRegex=PK.createRegex({}),OK.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?PK.createRegex(e):PK.uriRegex};const MK=hY(),wK=OK;RK.regex=function(e={}){MK(void 0===e.cidr||"string"==typeof e.cidr,"options.cidr must be a string");const t=e.cidr?e.cidr.toLowerCase():"optional";MK(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),MK(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let n=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(n)||(n=[n]),MK(n.length>=1,"options.version must have at least 1 version specified");for(let e=0;e<n.length;++e)MK("string"==typeof n[e],"options.version must only contain strings"),n[e]=n[e].toLowerCase(),MK(["ipv4","ipv6","ipvfuture"].includes(n[e]),"options.version contains unknown version "+n[e]+" - must be one of ipv4, ipv6, ipvfuture");n=Array.from(new Set(n));const r=n.map(e=>{if("forbidden"===t)return wK.ip[e];const n=`\\/${"ipv4"===e?wK.ip.v4Cidr:wK.ip.v6Cidr}`;return"required"===t?`${wK.ip[e]}${n}`:`${wK.ip[e]}(?:${n})?`}),s=`(?:${r.join("|")})`,o=new RegExp(`^${s}$`);return{cidr:t,versions:n,regex:o,raw:s}};const LK={tlds:["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"]};var xK,DK,kK,UK,$K,GK,jK,VK,HK=new Set(LK.tlds.map(e=>e.toLowerCase()));function BK(){if(DK)return xK;DK=1;const e=hY(),t=SK,n=yK,r=RK,s=NK,o=HK,i=OK,a=Fq(),c=zY(),u={tlds:o instanceof Set&&{tlds:{allow:o,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:r.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};return xK=a.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:n,prefs:r}){const s=t.$_getRule("normalize");s&&(e=e.normalize(s.args.form));const o=t.$_getRule("case");o&&(e="upper"===o.args.direction?e.toLocaleUpperCase():e.toLocaleLowerCase());const i=t.$_getRule("trim");if(i&&i.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(const n of t.$_terms.replacements)e=e.replace(n.pattern,n.replacement);const a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!=0&&(e=`0${e}`),t.$_getRule("isoDate")){const t=u.isoDate(e);t&&(e=t)}if(t._flags.truncate){const s=t.$_getRule("max");if(s){let o=s.args.limit;if(c.isResolvable(o)&&(o=o.resolve(e,n,r),!c.limit(o)))return{value:e,errors:t.$_createError("any.ref",o,{ref:s.args.limit,arg:"limit",reason:"must be a positive integer"},n,r)};e=e.slice(0,o)}}return{value:e}}},validate(e,{schema:t,error:n}){if("string"!=typeof e)return{value:e,errors:n("string.base")};if(""===e){const r=t.$_getRule("min");if(r&&0===r.args.limit)return;return{value:e,errors:n("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(t={}){return c.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),e("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(e,t,{options:n})=>u.base64Regex[n.paddingRequired][n.urlSafe].test(e)?e:t.error("string.base64")},case:{method(t){return e(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(e,t,{direction:n})=>"lower"===n&&e===e.toLocaleLowerCase()||"upper"===n&&e===e.toLocaleUpperCase()?e:t.error(`string.${n}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let n=e.length,r=0,s=1;for(;n--;){const t=e.charAt(n)*s;r+=t-9*(t>9),s^=3}return r>0&&r%10==0?e:t.error("string.creditCard")}},dataUri:{method(t={}){return c.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(e,t,{options:n}){const r=e.match(u.dataUriRegex);if(r){if(!r[2])return e;if("base64"!==r[2])return e;if(u.base64Regex[n.paddingRequired].false.test(r[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&c.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const t=u.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,n,r,{address:s})=>t.isValid(e,s)?e:n.error("string.domain")},email:{method(t={}){c.assertOptions(t,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),e(void 0===t.multiple||"boolean"==typeof t.multiple,"multiple option must be an boolean");const n=u.addressOptions(t),r=new RegExp(`\\s*[${t.separator?s(t.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:t},regex:r,address:n})},validate(e,t,{options:r},{regex:s,address:o}){const i=r.multiple?e.split(s):[e],a=[];for(const e of i)n.isValid(e,o)||a.push(e);return a.length?t.error("string.email",{value:e,invalids:a}):e}},guid:{alias:"uuid",method(t={}){c.assertOptions(t,["version","separator"]);let n="";if(t.version){const r=[].concat(t.version);e(r.length>=1,"version must have at least 1 valid version specified");const s=new Set;for(let t=0;t<r.length;++t){const o=r[t];e("string"==typeof o,"version at position "+t+" must be a string");const i=u.guidVersions[o.toLowerCase()];e(i,"version at position "+t+" must be one of "+Object.keys(u.guidVersions).join(", ")),e(!s.has(i),"version at position "+t+" must not be a duplicate"),n+=i,s.add(i)}}e(u.guidSeparators.has(t.separator),'separator must be one of true, false, "-", or ":"');const r=void 0===t.separator?"[:-]?":!0===t.separator?"[:-]":!1===t.separator?"[]?":`\\${t.separator}`,s=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${r})[0-9A-F]{4}\\2?[${n||"0-9A-F"}][0-9A-F]{3}\\2?[${n?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:t},regex:s})},validate(e,t,n,{regex:r}){const s=r.exec(e);return s?u.guidBrackets[s[1]]!==s[s.length-1]?t.error("string.guid"):e:t.error("string.guid")}},hex:{method(t={}){return c.assertOptions(t,["byteAligned"]),t={byteAligned:!1,...t},e("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:t}})},validate:(e,t,{options:n})=>u.hexRegex.test(e)?n.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,n)=>t.isValid(e,{minDomainSegments:1})||u.ipRegex.test(e)?e:n.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){c.assertOptions(e,["cidr","version"]);const{cidr:t,versions:n,regex:s}=r.regex(e),o=e.version?n:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:o}},regex:s})},validate:(e,t,{options:n},{regex:r})=>r.test(e)?e:n.version?t.error("string.ipVersion",{value:e,cidr:n.cidr,version:n.version}):t.error("string.ip",{value:e,cidr:n.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>u.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>u.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return u.length(this,"length",e,"=",t)},validate(e,t,{limit:n,encoding:r},{name:s,operator:o,args:i}){const a=r?Buffer&&Buffer.byteLength(e,r):e.length;return c.compare(a,n,o)?e:t.error("string."+s,{limit:i.limit,value:e,encoding:r})},args:[{name:"limit",ref:!0,assert:c.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return u.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return u.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(t="NFC"){return e(u.normalizationForms.includes(t),"normalization form must be one of "+u.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(e,{error:t},{form:n})=>e===e.normalize(n)?e:t("string.normalize",{value:e,form:n}),convert:!0},pattern:{alias:"regex",method(t,n={}){e(t instanceof RegExp,"regex must be a RegExp"),e(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof n&&(n={name:n}),c.assertOptions(n,["invert","name"]);const r=["string.pattern",n.invert?".invert":"",n.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:n},errorCode:r})},validate:(e,t,{regex:n,options:r},{errorCode:s})=>n.test(e)^r.invert?e:t.error(s,{name:r.name,regex:n,value:e}),args:["regex","options"],multi:!0},replace:{method(t,n){"string"==typeof t&&(t=new RegExp(s(t),"g")),e(t instanceof RegExp,"pattern must be a RegExp"),e("string"==typeof n,"replacement must be a String");const r=this.clone();return r.$_terms.replacements||(r.$_terms.replacements=[]),r.$_terms.replacements.push({pattern:t,replacement:n}),r}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(e,t,{enabled:n})=>n&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){c.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),e.domain&&c.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:t,scheme:n}=i.regex(e),r=e.domain?u.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:r,scheme:n})},validate(e,n,{options:r},{regex:s,domain:o,scheme:i}){if(["http:/","https:/"].includes(e))return n.error("string.uri");const a=s.exec(e);if(a){const s=a[1]||a[2];return!o||r.allowRelative&&!s||t.isValid(s,o)?e:n.error("string.domain",{value:s})}return r.relativeOnly?n.error("string.uriRelativeOnly"):r.scheme?n.error("string.uriCustomScheme",{scheme:i,value:e}):n.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(const{pattern:n,replacement:r}of t.replacements)e=e.replace(n,r);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),u.addressOptions=function(t){if(!t)return t;if(e(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),e(void 0===t.maxDomainSegments||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds);e("object"==typeof t.tlds,"tlds must be true, false, or an object");const n=t.tlds.deny;if(n)return Array.isArray(n)&&(t=Object.assign({},t,{tlds:{deny:new Set(n)}})),e(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),e(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),u.validateTlds(t.tlds.deny,"tlds.deny"),t;const r=t.tlds.allow;return r?!0===r?(e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds)):(Array.isArray(r)&&(t=Object.assign({},t,{tlds:{allow:new Set(r)}})),e(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),u.validateTlds(t.tlds.allow,"tlds.allow"),t):t},u.validateTlds=function(n,r){for(const s of n)e(t.isValid(s,{minDomainSegments:1,maxDomainSegments:1}),`${r} must contain valid top level domain names`)},u.isoDate=function(e){if(!c.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()},u.length=function(t,n,r,s,o){return e(!o||Buffer&&Buffer.isEncoding(o),"Invalid encoding:",o),t.$_addRule({name:n,method:"length",args:{limit:r,encoding:o},operator:s})},xK}function FK(){if(UK)return kK;UK=1;const e=hY(),t=Fq(),n={};return n.Map=class extends Map{slice(){return new n.Map(this)}},kK=t.extend({type:"symbol",terms:{map:{init:new n.Map}},coerce:{method(e,{schema:t,error:n}){const r=t.$_terms.map.get(e);return r&&(e=r),t._flags.only&&"symbol"!=typeof e?{value:e,errors:n("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),e(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const n=this.clone(),r=[];for(const s of t){e(s&&s[Symbol.iterator],"Entry must be an iterable");const[t,o]=s;e("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),e("symbol"==typeof o,"Value must be a Symbol"),n.$_terms.map.set(t,o),r.push(o)}return n.valid(...r)}}},manifest:{build:(e,t)=>(t.map&&(e=e.map(t.map)),e)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}}),kK}function YK(){if(VK)return jK;VK=1;const e=hY(),t=vY(),n=QY(),r=zY(),s=tq(),o=VY(),i=sq(),a=aq(),c=WY(),u=ZY(),l=fq();let p;const d={types:{alternatives:Yq(),any:Fq(),array:qq(),boolean:Kq(),date:Wq(),function:_K(),link:mK(),number:gK(),object:EK(),string:BK(),symbol:FK()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};return Buffer&&(d.types.binary=function(){if(GK)return $K;GK=1;const e=hY(),t=Fq(),n=zY();return $K=t.extend({type:"binary",coerce:{from:"string",method(e,{schema:t}){try{return{value:Buffer.from(e,t._flags.encoding)}}catch(e){}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(t){return e(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:s,operator:o,args:i})=>n.compare(e.length,r,o)?e:t.error("binary."+s,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:n.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to:(e,t)=>e.toString()}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}}),$K}()),d.root=function(){const t={_types:new Set(Object.keys(d.types))};for(const n of t._types)t[n]=function(...t){return e(!t.length||["alternatives","link","object"].includes(n),"The",n,"type does not allow arguments"),d.generate(this,d.types[n],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,d.methods);for(const e in d.aliases){const n=d.aliases[e];t[e]=t[n]}return t.x=t.expression,l.setup&&l.setup(t),t},d.methods={ValidationError:o.ValidationError,version:r.version,cache:n.provider,assert(e,t,...n){d.assert(e,t,!0,n)},attempt:(e,t,...n)=>d.assert(e,t,!1,n),build(t){return e("function"==typeof a.build,"Manifest functionality disabled"),a.build(this,t)},checkPreferences(e){r.checkPreferences(e)},compile(e,t){return s.compile(this,e,t)},defaults(t){e("function"==typeof t,"modifier must be a function");const n=Object.assign({},this);for(const s of n._types){const o=t(n[s]());e(r.isSchema(o),"modifier must return a valid schema object"),n[s]=function(...e){return d.generate(this,o,e)}}return n},expression:(...e)=>new u(...e),extend(...t){r.verifyFlat(t,"extend"),p=p||IY(),e(t.length,"You need to provide at least one extension"),this.assert(t,p.extensions);const n=Object.assign({},this);n._types=new Set(n._types);for(let r of t){"function"==typeof r&&(r=r(n)),this.assert(r,p.extension);const t=d.expandExtension(r,n);for(const r of t){e(void 0===n[r.type]||n._types.has(r.type),"Cannot override name",r.type);const t=r.base||this.any(),s=i.type(t,r);n._types.add(r.type),n[r.type]=function(...e){return d.generate(this,s,e)}}}return n},isError:o.ValidationError.isError,isExpression:u.isTemplate,isRef:c.isRef,isSchema:r.isSchema,in:(...e)=>c.in(...e),override:r.symbols.override,ref:(...e)=>c.create(...e),types(){const e={};for(const t of this._types)e[t]=this[t]();for(const t in d.aliases)e[t]=this[t]();return e}},d.assert=function(e,n,s,i){const a=i[0]instanceof Error||"string"==typeof i[0]?i[0]:null,c=null!==a?i[1]:i[0],u=n.validate(e,r.preferences({errors:{stack:!0}},c||{}));let l=u.error;if(!l)return u.value;if(a instanceof Error)throw a;const p=s&&"function"==typeof l.annotate?l.annotate():l.message;throw l instanceof o.ValidationError==!1&&(l=t(l)),l.message=a?`${a} ${p}`:p,l},d.generate=function(t,n,r){return e(t,"Must be invoked on a Joi instance."),n.$_root=t,n._definition.args&&r.length?n._definition.args(n,...r):n},d.expandExtension=function(e,t){if("string"==typeof e.type)return[e];const n=[];for(const r of t._types)if(e.type.test(r)){const s=Object.assign({},e);s.type=r,s.base=t[r](),n.push(s)}return n},jK=d.root()}var qK=Ht(YK());qK.extend({type:"string",base:qK.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate:(e,t,{substring:n})=>!1===e.includes(n)?t.error("string.contains",{substring:n}):e},ncontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate:(e,t,{substring:n})=>!0===e.includes(n)?t.error("string.ncontains",{substring:n}):e}}});var KK=e=>{e.post("/",(e,t)=>{try{switch(e.body.level||(e.body.level="log"),e.body.level){case"fatal":case"error":console.error(e.body.message);break;case"warning":console.warn(e.body.message);break;case"log":case"info":console.log(e.body.message);break;case"debug":console.debug(e.body.message)}!function(e,t){const n="string"==typeof t?t:void 0,r="string"!=typeof t?{captureContext:t}:void 0;Py().captureMessage(e,n,r)}(e.body.message,e.body.level),t.status(202).send()}catch(e){const n=`Error occurred when logging: ${e}`;console.error(n),Pv(n),t.status(400).send()}})};module.exports=KK;
