"use strict";var e=require("fs"),t=require("path"),n=require("os"),r=require("crypto"),s=require("util"),o=require("perf_hooks"),i=require("url"),a=require("module"),c=require("tty"),u=require("worker_threads"),l=require("events"),p=require("node:diagnostics_channel"),d=require("diagnostics_channel"),h=require("node:net"),m=require("async_hooks"),f=require("node:child_process"),_=require("node:fs"),g=require("node:os"),E=require("node:path"),S=require("node:util"),y=require("node:readline"),T=require("node:worker_threads"),b=require("node:http"),A=require("node:https"),R=require("node:stream"),v=require("node:zlib"),N=require("node:tls");function C(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}require("axios");var O=C(t),I=C(p),P=C(d),L=C(h),w=C(g),M=C(S),x=C(b),k=C(A),G=C(N),D="object"==typeof globalThis?globalThis:global,V="1.9.0",U=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var H=function(e){var t=new Set([e]),n=new Set,r=e.match(U);if(!r)return function(){return!1};var s=+r[1],o=+r[2],i=+r[3];if(null!=r[4])return function(t){return t===e};function a(e){return n.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(U);if(!r)return a(e);var u=+r[1],l=+r[2],p=+r[3];return null!=r[4]||s!==u?a(e):0===s?o===l&&i<=p?c(e):a(e):o<=l?c(e):a(e)}}(V),j=V.split(".")[0],Z=Symbol.for("opentelemetry.js.api."+j),W=D;function X(e,t,n,r){var s;void 0===r&&(r=!1);var o=W[Z]=null!==(s=W[Z])&&void 0!==s?s:{version:V};if(!r&&o[e]){var i=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(i.stack||i.message),!1}if(o.version!==V){i=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+V);return n.error(i.stack||i.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+V+"."),!0}function $(e){var t,n,r=null===(t=W[Z])||void 0===t?void 0:t.version;if(r&&H(r))return null===(n=W[Z])||void 0===n?void 0:n[e]}function F(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+V+".");var n=W[Z];n&&delete n[e]}var Y,B=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},K=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},J=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return z("verbose",this._namespace,e)},e}();function z(e,t,n){var r=$("diag");if(r)return n.unshift(t),r[e].apply(r,K([],B(n),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(Y||(Y={}));var Q=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},q=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},ee=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=$("diag");if(r)return r[e].apply(r,q([],Q(t),!1))}}var t=this;t.setLogger=function(e,n){var r,s,o;if(void 0===n&&(n={logLevel:Y.INFO}),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}"number"==typeof n&&(n={logLevel:n});var a=$("diag"),c=function(e,t){function n(n,r){var s=t[n];return"function"==typeof s&&e>=r?s.bind(t):function(){}}return e<Y.NONE?e=Y.NONE:e>Y.ALL&&(e=Y.ALL),t=t||{},{error:n("error",Y.ERROR),warn:n("warn",Y.WARN),info:n("info",Y.INFO),debug:n("debug",Y.DEBUG),verbose:n("verbose",Y.VERBOSE)}}(null!==(s=n.logLevel)&&void 0!==s?s:Y.INFO,e);if(a&&!n.suppressOverrideMessage){var u=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+u),c.warn("Current logger will overwrite one already registered from "+u)}return X("diag",c,t,!0)},t.disable=function(){F("diag",t)},t.createComponentLogger=function(e){return new J(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),te=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},ne=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},re=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=te(e,2);return[t[0],t[1]]})},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=new e(this._entries);try{for(var i=ne(r),a=i.next();!a.done;a=i.next()){var c=a.value;o._entries.delete(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},e.prototype.clear=function(){return new e},e}(),se=Symbol("BaggageEntryMetadata"),oe=ee.instance();function ie(e){return void 0===e&&(e={}),new re(new Map(Object.entries(e)))}function ae(e){return"string"!=typeof e&&(oe.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:se,toString:function(){return e}}}function ce(e){return Symbol.for(e)}var ue,le,pe=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var s=new e(n._currentContext);return s._currentContext.set(t,r),s},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},de=new pe,he=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],me=function(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(console){var r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}for(var t=0;t<he.length;t++)this[he[t].n]=e(he[t].c)},fe=(ue=function(e,t){return ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ue(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ue(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_e=function(){function e(){}return e.prototype.createGauge=function(e,t){return Oe},e.prototype.createHistogram=function(e,t){return Ie},e.prototype.createCounter=function(e,t){return Ce},e.prototype.createUpDownCounter=function(e,t){return Pe},e.prototype.createObservableGauge=function(e,t){return we},e.prototype.createObservableCounter=function(e,t){return Le},e.prototype.createObservableUpDownCounter=function(e,t){return Me},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),ge=function(){},Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t.prototype.add=function(e,t){},t}(ge),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t.prototype.add=function(e,t){},t}(ge),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t.prototype.record=function(e,t){},t}(ge),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t.prototype.record=function(e,t){},t}(ge),be=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t}(be),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t}(be),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fe(t,e),t}(be),Ne=new _e,Ce=new Ee,Oe=new ye,Ie=new Te,Pe=new Se,Le=new Ae,we=new Re,Me=new ve;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(le||(le={}));var xe,ke={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},Ge={set:function(e,t,n){null!=e&&(e[t]=n)}},De=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},Ve=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},Ue=function(){function e(){}return e.prototype.active=function(){return de},e.prototype.with=function(e,t,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];return t.call.apply(t,Ve([n],De(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),He=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},je=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},Ze="context",We=new Ue,Xe=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return X(Ze,e,ee.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,je([e,t,n],He(s),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return $(Ze)||We},e.prototype.disable=function(){this._getContextManager().disable(),F(Ze,ee.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(xe||(xe={}));var $e="0000000000000000",Fe="00000000000000000000000000000000",Ye={traceId:Fe,spanId:$e,traceFlags:xe.NONE},Be=function(){function e(e){void 0===e&&(e=Ye),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),Ke=ce("OpenTelemetry Context Key SPAN");function Je(e){return e.getValue(Ke)||void 0}function ze(){return Je(Xe.getInstance().active())}function Qe(e,t){return e.setValue(Ke,t)}function qe(e){return e.deleteValue(Ke)}function et(e,t){return Qe(e,new Be(t))}function tt(e){var t;return null===(t=Je(e))||void 0===t?void 0:t.spanContext()}var nt=/^([0-9a-f]{32})$/i,rt=/^[0-9a-f]{16}$/i;function st(e){return nt.test(e)&&e!==Fe}function ot(e){return rt.test(e)&&e!==$e}function it(e){return st(e.traceId)&&ot(e.spanId)}function at(e){return new Be(e)}var ct=Xe.getInstance(),ut=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(void 0===n&&(n=ct.active()),Boolean(null==t?void 0:t.root))return new Be;var r,s=n&&tt(n);return"object"==typeof(r=s)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&it(s)?new Be(s):new Be},e.prototype.startActiveSpan=function(e,t,n,r){var s,o,i;if(!(arguments.length<2)){2===arguments.length?i=t:3===arguments.length?(s=t,i=n):(s=t,o=n,i=r);var a=null!=o?o:ct.active(),c=this.startSpan(e,s,a),u=Qe(a,c);return ct.with(u,i,void 0,c)}},e}();var lt,pt,dt,ht=new ut,mt=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):ht},e}(),ft=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new ut},e}()),_t=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new mt(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:ft},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(lt||(lt={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(pt||(pt={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(dt||(dt={}));var gt="[_0-9a-z-*/]",Et=new RegExp("^(?:"+("[a-z]"+gt+"{0,255}")+"|"+("[a-z0-9]"+gt+"{0,240}@[a-z]"+gt+"{0,13}")+")$"),St=/^[ -~]{0,255}[!-~]$/,yt=/,|=/;var Tt=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,n){return t.push(n+"="+e.get(n)),t},[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce(function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var s=n.slice(0,r),o=n.slice(r+1,t.length);(function(e){return Et.test(e)})(s)&&function(e){return St.test(e)&&!yt.test(e)}(o)&&e.set(s,o)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var bt=Xe.getInstance(),At=ee.instance(),Rt=new(function(){function e(){}return e.prototype.getMeter=function(e,t,n){return Ne},e}()),vt="metrics",Nt=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return X(vt,e,ee.instance())},e.prototype.getMeterProvider=function(){return $(vt)||Rt},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){F(vt,ee.instance())},e}(),Ct=Nt.getInstance(),Ot=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),It=ce("OpenTelemetry Baggage Key");function Pt(e){return e.getValue(It)||void 0}function Lt(){return Pt(Xe.getInstance().active())}function wt(e,t){return e.setValue(It,t)}function Mt(e){return e.deleteValue(It)}var xt="propagation",kt=new Ot,Gt=function(){function e(){this.createBaggage=ie,this.getBaggage=Pt,this.getActiveBaggage=Lt,this.setBaggage=wt,this.deleteBaggage=Mt}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return X(xt,e,ee.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=Ge),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=ke),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){F(xt,ee.instance())},e.prototype._getGlobalPropagator=function(){return $(xt)||kt},e}(),Dt=Gt.getInstance(),Vt="trace",Ut=function(){function e(){this._proxyTracerProvider=new _t,this.wrapSpanContext=at,this.isSpanContextValid=it,this.deleteSpan=qe,this.getSpan=Je,this.getActiveSpan=ze,this.getSpanContext=tt,this.setSpan=Qe,this.setSpanContext=et}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=X(Vt,this._proxyTracerProvider,ee.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return $(Vt)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){F(Vt,ee.instance()),this._proxyTracerProvider=new _t},e}(),Ht=Ut.getInstance(),jt={context:bt,diag:At,metrics:Ct,propagation:Dt,trace:Ht};function Zt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Wt(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),n}var Xt={},$t={},Ft=Wt(Object.freeze({__proto__:null,DiagConsoleLogger:me,get DiagLogLevel(){return Y},INVALID_SPANID:$e,INVALID_SPAN_CONTEXT:Ye,INVALID_TRACEID:Fe,ProxyTracer:mt,ProxyTracerProvider:_t,ROOT_CONTEXT:de,get SamplingDecision(){return lt},get SpanKind(){return pt},get SpanStatusCode(){return dt},get TraceFlags(){return xe},get ValueType(){return le},baggageEntryMetadataFromString:ae,context:bt,createContextKey:ce,createNoopMeter:function(){return Ne},createTraceState:function(e){return new Tt(e)},default:jt,defaultTextMapGetter:ke,defaultTextMapSetter:Ge,diag:At,isSpanContextValid:it,isValidSpanId:ot,isValidTraceId:st,metrics:Ct,propagation:Dt,trace:Ht}));const Yt=ce("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Bt(e){return e.setValue(Yt,!0)}function Kt(e){return!0===e.getValue(Yt)}const Jt=",",zt="baggage";function Qt(e){const t=e.split(";");if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const s=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim());let i;return t.length>0&&(i=ae(t.join(";"))),{key:s,value:o,metadata:i}}class qt{inject(e,t,n){const r=Dt.getBaggage(e);if(!r||Kt(e))return;const s=function(e){return e.getAllEntries().map(([e,t])=>{let n=`${encodeURIComponent(e)}=${encodeURIComponent(t.value)}`;return void 0!==t.metadata&&(n+=";"+t.metadata.toString()),n})}(r).filter(e=>e.length<=4096).slice(0,180),o=function(e){return e.reduce((e,t)=>{const n=`${e}${""!==e?Jt:""}${t}`;return n.length>8192?e:n},"")}(s);o.length>0&&n.set(t,zt,o)}extract(e,t,n){const r=n.get(t,zt),s=Array.isArray(r)?r.join(Jt):r;if(!s)return e;const o={};if(0===s.length)return e;return s.split(Jt).forEach(e=>{const t=Qt(e);if(t){const e={value:t.value};t.metadata&&(e.metadata=t.metadata),o[t.key]=e}}),0===Object.entries(o).length?e:Dt.setBaggage(e,Dt.createBaggage(o))}fields(){return[zt]}}function en(e){const t={};if("object"!=typeof e||null==e)return t;for(const[n,r]of Object.entries(e))tn(n)?nn(r)?Array.isArray(r)?t[n]=r.slice():t[n]=r:At.warn(`Invalid attribute value set for key: ${n}`):At.warn(`Invalid attribute key: ${n}`);return t}function tn(e){return"string"==typeof e&&e.length>0}function nn(e){return null==e||(Array.isArray(e)?function(e){let t;for(const n of e)if(null!=n){if(!t){if(rn(n)){t=typeof n;continue}return!1}if(typeof n!==t)return!1}return!0}(e):rn(e))}function rn(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function sn(){return e=>{At.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){const t={};let n=e;for(;null!==n;)Object.getOwnPropertyNames(n).forEach(e=>{if(t[e])return;const r=n[e];r&&(t[e]=String(r))}),n=Object.getPrototypeOf(n);return t}(e))}(e))}}let on=sn();function an(e){try{on(e)}catch{}}function cn(e){const t=process.env[e];if(null==t||""===t.trim())return;const n=Number(t);if(!isNaN(n))return n;At.warn(`Unknown value ${s.inspect(t)} for ${e}, expected a number, using defaults`)}function un(e){const t=process.env[e];if(null!=t&&""!==t.trim())return t}const ln="object"==typeof globalThis?globalThis:global,pn=o.performance;function dn(e){let t={};const n=e.length;for(let r=0;r<n;r++){const n=e[r];n&&(t[String(n).toUpperCase().replace(/[-.]/g,"_")]=n)}return t}const hn="aws.lambda.invoked_arn",mn="db.system",fn="db.connection_string",_n="db.user",gn="db.jdbc.driver_classname",En="db.name",Sn="db.statement",yn="db.operation",Tn="db.mssql.instance_name",bn="db.cassandra.keyspace",An="db.cassandra.page_size",Rn="db.cassandra.consistency_level",vn="db.cassandra.table",Nn="db.cassandra.idempotence",Cn="db.cassandra.speculative_execution_count",On="db.cassandra.coordinator.id",In="db.cassandra.coordinator.dc",Pn="db.hbase.namespace",Ln="db.redis.database_index",wn="db.mongodb.collection",Mn="db.sql.table",xn="exception.type",kn="exception.message",Gn="exception.stacktrace",Dn="exception.escaped",Vn="faas.trigger",Un="faas.execution",Hn="faas.document.collection",jn="faas.document.operation",Zn="faas.document.time",Wn="faas.document.name",Xn="faas.time",$n="faas.cron",Fn="faas.coldstart",Yn="faas.invoked_name",Bn="faas.invoked_provider",Kn="faas.invoked_region",Jn="net.transport",zn="net.peer.ip",Qn="net.peer.port",qn="net.peer.name",er="net.host.ip",tr="net.host.port",nr="net.host.name",rr="net.host.connection.type",sr="net.host.connection.subtype",or="net.host.carrier.name",ir="net.host.carrier.mcc",ar="net.host.carrier.mnc",cr="net.host.carrier.icc",ur="peer.service",lr="enduser.id",pr="enduser.role",dr="enduser.scope",hr="thread.id",mr="thread.name",fr="code.function",_r="code.namespace",gr="code.filepath",Er="code.lineno",Sr="http.method",yr="http.url",Tr="http.target",br="http.host",Ar="http.scheme",Rr="http.status_code",vr="http.flavor",Nr="http.user_agent",Cr="http.request_content_length",Or="http.request_content_length_uncompressed",Ir="http.response_content_length",Pr="http.response_content_length_uncompressed",Lr="http.server_name",wr="http.route",Mr="http.client_ip",xr="aws.dynamodb.table_names",kr="aws.dynamodb.consumed_capacity",Gr="aws.dynamodb.item_collection_metrics",Dr="aws.dynamodb.provisioned_read_capacity",Vr="aws.dynamodb.provisioned_write_capacity",Ur="aws.dynamodb.consistent_read",Hr="aws.dynamodb.projection",jr="aws.dynamodb.limit",Zr="aws.dynamodb.attributes_to_get",Wr="aws.dynamodb.index_name",Xr="aws.dynamodb.select",$r="aws.dynamodb.global_secondary_indexes",Fr="aws.dynamodb.local_secondary_indexes",Yr="aws.dynamodb.exclusive_start_table",Br="aws.dynamodb.table_count",Kr="aws.dynamodb.scan_forward",Jr="aws.dynamodb.segment",zr="aws.dynamodb.total_segments",Qr="aws.dynamodb.count",qr="aws.dynamodb.scanned_count",es="aws.dynamodb.attribute_definitions",ts="aws.dynamodb.global_secondary_index_updates",ns="messaging.system",rs="messaging.destination",ss="messaging.destination_kind",os="messaging.temp_destination",is="messaging.protocol",as="messaging.protocol_version",cs="messaging.url",us="messaging.message_id",ls="messaging.conversation_id",ps="messaging.message_payload_size_bytes",ds="messaging.message_payload_compressed_size_bytes",hs="messaging.operation",ms="messaging.consumer_id",fs="messaging.rabbitmq.routing_key",_s="messaging.kafka.message_key",gs="messaging.kafka.consumer_group",Es="messaging.kafka.client_id",Ss="messaging.kafka.partition",ys="messaging.kafka.tombstone",Ts="rpc.system",bs="rpc.service",As="rpc.method",Rs="rpc.grpc.status_code",vs="rpc.jsonrpc.version",Ns="rpc.jsonrpc.request_id",Cs="rpc.jsonrpc.error_code",Os="rpc.jsonrpc.error_message",Is="message.type",Ps="message.id",Ls="message.compressed_size",ws="message.uncompressed_size",Ms=hn,xs=mn,ks=fn,Gs=_n,Ds=gn,Vs=En,Us=Sn,Hs=yn,js=Tn,Zs=bn,Ws=An,Xs=Rn,$s=vn,Fs=Nn,Ys=Cn,Bs=On,Ks=In,Js=Pn,zs=Ln,Qs=wn,qs=Mn,eo=xn,to=kn,no=Gn,ro=Dn,so=Vn,oo=Un,io=Hn,ao=jn,co=Zn,uo=Wn,lo=Xn,po=$n,ho=Fn,mo=Yn,fo=Bn,_o=Kn,go=Jn,Eo=zn,So=Qn,yo=qn,To=er,bo=tr,Ao=nr,Ro=rr,vo=sr,No=or,Co=ir,Oo=ar,Io=cr,Po=ur,Lo=lr,wo=pr,Mo=dr,xo=hr,ko=mr,Go=fr,Do=_r,Vo=gr,Uo=Er,Ho=Sr,jo=yr,Zo=Tr,Wo=br,Xo=Ar,$o=Rr,Fo=vr,Yo=Nr,Bo=Cr,Ko=Or,Jo=Ir,zo=Pr,Qo=Lr,qo=wr,ei=Mr,ti=xr,ni=kr,ri=Gr,si=Dr,oi=Vr,ii=Ur,ai=Hr,ci=jr,ui=Zr,li=Wr,pi=Xr,di=$r,hi=Fr,mi=Yr,fi=Br,_i=Kr,gi=Jr,Ei=zr,Si=Qr,yi=qr,Ti=es,bi=ts,Ai=ns,Ri=rs,vi=ss,Ni=os,Ci=is,Oi=as,Ii=cs,Pi=us,Li=ls,wi=ps,Mi=ds,xi=hs,ki=ms,Gi=fs,Di=_s,Vi=gs,Ui=Es,Hi=Ss,ji=ys,Zi=Ts,Wi=bs,Xi=As,$i=Rs,Fi=vs,Yi=Ns,Bi=Cs,Ki=Os,Ji=Is,zi=Ps,Qi=Ls,qi=ws,ea=dn([hn,mn,fn,_n,gn,En,Sn,yn,Tn,bn,An,Rn,vn,Nn,Cn,On,In,Pn,Ln,wn,Mn,xn,kn,Gn,Dn,Vn,Un,Hn,jn,Zn,Wn,Xn,$n,Fn,Yn,Bn,Kn,Jn,zn,Qn,qn,er,tr,nr,rr,sr,or,ir,ar,cr,ur,lr,pr,dr,hr,mr,fr,_r,gr,Er,Sr,yr,Tr,br,Ar,Rr,vr,Nr,Cr,Or,Ir,Pr,Lr,wr,Mr,xr,kr,Gr,Dr,Vr,Ur,Hr,jr,Zr,Wr,Xr,$r,Fr,Yr,Br,Kr,Jr,zr,Qr,qr,es,ts,ns,rs,ss,os,is,as,cs,us,ls,ps,ds,hs,ms,fs,_s,gs,Es,Ss,ys,Ts,bs,As,Rs,vs,Ns,Cs,Os,Is,Ps,Ls,ws]),ta="other_sql",na="mssql",ra="mysql",sa="oracle",oa="postgresql",ia="redshift",aa="hive",ca="cloudscape",ua="hsqldb",la="progress",pa="maxdb",da="hanadb",ha="ingres",ma="firstsql",fa="cache",_a="adabas",ga="firebird",Ea="derby",Sa="filemaker",ya="informix",Ta="instantdb",ba="interbase",Aa="mariadb",Ra="netezza",va="pervasive",Na="pointbase",Ca="sqlite",Oa="sybase",Ia="teradata",Pa="vertica",La="coldfusion",wa="cassandra",Ma="hbase",xa="mongodb",ka="redis",Ga="couchbase",Da="couchdb",Va="cosmosdb",Ua="dynamodb",Ha="neo4j",ja="geode",Za="elasticsearch",Wa="memcached",Xa="cockroachdb",$a=ta,Fa=na,Ya=ra,Ba=sa,Ka=oa,Ja=ia,za=aa,Qa=ca,qa=ua,ec=la,tc=pa,nc=da,rc=ha,sc=ma,oc=fa,ic=_a,ac=ga,cc=Ea,uc=Sa,lc=ya,pc=Ta,dc=ba,hc=Aa,mc=Ra,fc=va,_c=Na,gc=Ca,Ec=Oa,Sc=Ia,yc=Pa,Tc=La,bc=wa,Ac=Ma,Rc=xa,vc=ka,Nc=Ga,Cc=Da,Oc=Va,Ic=Ua,Pc=Ha,Lc=ja,wc=Za,Mc=Wa,xc=Xa,kc=dn([ta,na,ra,sa,"db2",oa,ia,aa,ca,ua,la,pa,da,ha,ma,"edb",fa,_a,ga,Ea,Sa,ya,Ta,ba,Aa,Ra,va,Na,Ca,Oa,Ia,Pa,"h2",La,wa,Ma,xa,ka,Ga,Da,Va,Ua,Ha,ja,Za,Wa,Xa]),Gc="each_quorum",Dc="quorum",Vc="local_quorum",Uc="three",Hc="local_one",jc="serial",Zc="local_serial",Wc=Gc,Xc=Dc,$c=Vc,Fc=Uc,Yc=Hc,Bc=jc,Kc=Zc,Jc=dn(["all",Gc,Dc,Vc,"one","two",Uc,Hc,"any",jc,Zc]),zc="datasource",Qc="http",qc="pubsub",eu="timer",tu="other",nu=zc,ru=Qc,su=qc,ou=eu,iu=tu,au=dn([zc,Qc,qc,eu,tu]),cu="insert",uu="edit",lu="delete",pu=cu,du=uu,hu=lu,mu=dn([cu,uu,lu]),fu="alibaba_cloud",_u="azure",gu=fu,Eu=_u,Su=dn([fu,"aws",_u,"gcp"]),yu="ip_tcp",Tu="ip_udp",bu="unix",Au="pipe",Ru="inproc",vu="other",Nu=yu,Cu=Tu,Ou=bu,Iu=Au,Pu=Ru,Lu=vu,wu=dn([yu,Tu,"ip",bu,Au,Ru,vu]),Mu="wifi",xu="wired",ku="cell",Gu="unavailable",Du="unknown",Vu=Mu,Uu=xu,Hu=ku,ju=Gu,Zu=Du,Wu=dn([Mu,xu,ku,Gu,Du]),Xu="gprs",$u="edge",Fu="umts",Yu="cdma",Bu="evdo_0",Ku="evdo_a",Ju="cdma2000_1xrtt",zu="hsdpa",Qu="hsupa",qu="hspa",el="iden",tl="evdo_b",nl="ehrpd",rl="hspap",sl="td_scdma",ol="iwlan",il="nrnsa",al="lte_ca",cl=Xu,ul=$u,ll=Fu,pl=Yu,dl=Bu,hl=Ku,ml=Ju,fl=zu,_l=Qu,gl=qu,El=el,Sl=tl,yl=nl,Tl=rl,bl=sl,Al=ol,Rl=il,vl=al,Nl=dn([Xu,$u,Fu,Yu,Bu,Ku,Ju,zu,Qu,qu,el,tl,"lte",nl,rl,"gsm",sl,ol,"nr",il,al]),Cl="SPDY",Ol="QUIC",Il=Cl,Pl=Ol,Ll={HTTP_1_0:"1.0",HTTP_1_1:"1.1",HTTP_2_0:"2.0",SPDY:Cl,QUIC:Ol},wl="queue",Ml="topic",xl=wl,kl=Ml,Gl=dn([wl,Ml]),Dl="receive",Vl="process",Ul=Dl,Hl=Vl,jl=dn([Dl,Vl]),Zl={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16},Wl="SENT",Xl="RECEIVED",$l=Wl,Fl=Xl,Yl=dn([Wl,Xl]),Bl="cloud.provider",Kl="cloud.account.id",Jl="cloud.region",zl="cloud.availability_zone",Ql="cloud.platform",ql="aws.ecs.container.arn",ep="aws.ecs.cluster.arn",tp="aws.ecs.launchtype",np="aws.ecs.task.arn",rp="aws.ecs.task.family",sp="aws.ecs.task.revision",op="aws.eks.cluster.arn",ip="aws.log.group.names",ap="aws.log.group.arns",cp="aws.log.stream.names",up="aws.log.stream.arns",lp="container.name",pp="container.id",dp="container.runtime",hp="container.image.name",mp="container.image.tag",fp="deployment.environment",_p="device.id",gp="device.model.identifier",Ep="device.model.name",Sp="faas.name",yp="faas.id",Tp="faas.version",bp="faas.instance",Ap="faas.max_memory",Rp="host.id",vp="host.name",Np="host.type",Cp="host.arch",Op="host.image.name",Ip="host.image.id",Pp="host.image.version",Lp="k8s.cluster.name",wp="k8s.node.name",Mp="k8s.node.uid",xp="k8s.namespace.name",kp="k8s.pod.uid",Gp="k8s.pod.name",Dp="k8s.container.name",Vp="k8s.replicaset.uid",Up="k8s.replicaset.name",Hp="k8s.deployment.uid",jp="k8s.deployment.name",Zp="k8s.statefulset.uid",Wp="k8s.statefulset.name",Xp="k8s.daemonset.uid",$p="k8s.daemonset.name",Fp="k8s.job.uid",Yp="k8s.job.name",Bp="k8s.cronjob.uid",Kp="k8s.cronjob.name",Jp="os.type",zp="os.description",Qp="os.name",qp="os.version",ed="process.pid",td="process.executable.name",nd="process.executable.path",rd="process.command",sd="process.command_line",od="process.command_args",id="process.owner",ad="process.runtime.name",cd="process.runtime.version",ud="process.runtime.description",ld="service.name",pd="service.namespace",dd="service.instance.id",hd="service.version",md="telemetry.sdk.name",fd="telemetry.sdk.language",_d="telemetry.sdk.version",gd="telemetry.auto.version",Ed="webengine.name",Sd="webengine.version",yd="webengine.description",Td=Bl,bd=Kl,Ad=Jl,Rd=zl,vd=Ql,Nd=ql,Cd=ep,Od=tp,Id=np,Pd=rp,Ld=sp,wd=op,Md=ip,xd=ap,kd=cp,Gd=up,Dd=lp,Vd=pp,Ud=dp,Hd=hp,jd=mp,Zd=fp,Wd=_p,Xd=gp,$d=Ep,Fd=Sp,Yd=yp,Bd=Tp,Kd=bp,Jd=Ap,zd=Rp,Qd=vp,qd=Np,eh=Cp,th=Op,nh=Ip,rh=Pp,sh=Lp,oh=wp,ih=Mp,ah=xp,ch=kp,uh=Gp,lh=Dp,ph=Vp,dh=Up,hh=Hp,mh=jp,fh=Zp,_h=Wp,gh=Xp,Eh=$p,Sh=Fp,yh=Yp,Th=Bp,bh=Kp,Ah=Jp,Rh=zp,vh=Qp,Nh=qp,Ch=ed,Oh=td,Ih=nd,Ph=rd,Lh=sd,wh=od,Mh=id,xh=ad,kh=cd,Gh=ud,Dh=ld,Vh=pd,Uh=dd,Hh=hd,jh=md,Zh=fd,Wh=_d,Xh=gd,$h=Ed,Fh=Sd,Yh=yd,Bh=dn([Bl,Kl,Jl,zl,Ql,ql,ep,tp,np,rp,sp,op,ip,ap,cp,up,lp,pp,dp,hp,mp,fp,_p,gp,Ep,Sp,yp,Tp,bp,Ap,Rp,vp,Np,Cp,Op,Ip,Pp,Lp,wp,Mp,xp,kp,Gp,Dp,Vp,Up,Hp,jp,Zp,Wp,Xp,$p,Fp,Yp,Bp,Kp,Jp,zp,Qp,qp,ed,td,nd,rd,sd,od,id,ad,cd,ud,ld,pd,dd,hd,md,fd,_d,gd,Ed,Sd,yd]),Kh="alibaba_cloud",Jh="azure",zh=Kh,Qh=Jh,qh=dn([Kh,"aws",Jh,"gcp"]),em="alibaba_cloud_ecs",tm="alibaba_cloud_fc",nm="aws_ec2",rm="aws_ecs",sm="aws_eks",om="aws_lambda",im="aws_elastic_beanstalk",am="azure_vm",cm="azure_container_instances",um="azure_aks",lm="azure_functions",pm="azure_app_service",dm="gcp_compute_engine",hm="gcp_cloud_run",mm="gcp_kubernetes_engine",fm="gcp_cloud_functions",_m="gcp_app_engine",gm=em,Em=tm,Sm=nm,ym=rm,Tm=sm,bm=om,Am=im,Rm=am,vm=cm,Nm=um,Cm=lm,Om=pm,Im=dm,Pm=hm,Lm=mm,wm=fm,Mm=_m,xm=dn([em,tm,nm,rm,sm,om,im,am,cm,um,lm,pm,dm,hm,mm,fm,_m]),km="fargate",Gm=km,Dm=dn(["ec2",km]),Vm="amd64",Um="arm32",Hm="arm64",jm="ia64",Zm="ppc32",Wm="ppc64",Xm=Vm,$m=Um,Fm=Hm,Ym=jm,Bm=Zm,Km=Wm,Jm=dn([Vm,Um,Hm,jm,Zm,Wm,"x86"]),zm="windows",Qm="linux",qm="darwin",ef="freebsd",tf="netbsd",nf="openbsd",rf="dragonflybsd",sf="hpux",of="solaris",af="z_os",cf=zm,uf=Qm,lf=qm,pf=ef,df=tf,hf=nf,mf=rf,ff=sf,_f=of,gf=af,Ef=dn([zm,Qm,qm,ef,tf,nf,rf,sf,"aix",of,af]),Sf="dotnet",yf="erlang",Tf="java",bf="nodejs",Af="python",Rf="ruby",vf="webjs",Nf=Sf,Cf=yf,Of=Tf,If=bf,Pf=Af,Lf=Rf,wf=vf,Mf=dn(["cpp",Sf,yf,"go",Tf,bf,"php",Af,Rf,vf]),xf="db.collection.name",kf="db.namespace",Gf="db.operation.name",Df="db.query.text",Vf="db.response.status_code",Uf="db.system.name",Hf="error.type",jf="exception.message",Zf="exception.stacktrace",Wf="exception.type",Xf="http.request.method",$f="http.response.status_code",Ff="http.route",Yf="server.address",Bf="server.port",Kf="service.name",Jf="service.version",zf="telemetry.sdk.language",Qf="nodejs",qf="telemetry.sdk.name",e_="telemetry.sdk.version",t_="url.full";var n_=Object.freeze({__proto__:null,ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED:"aborted",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED:"handled",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED:"skipped",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED:"unhandled",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED:"acquired",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER:"endpoint_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER:"global_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED:"request_canceled",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE:"failure",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS:"success",ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT:"aspnetcore.diagnostics.exception.result",ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE:"aspnetcore.diagnostics.handler.type",ATTR_ASPNETCORE_RATE_LIMITING_POLICY:"aspnetcore.rate_limiting.policy",ATTR_ASPNETCORE_RATE_LIMITING_RESULT:"aspnetcore.rate_limiting.result",ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED:"aspnetcore.request.is_unhandled",ATTR_ASPNETCORE_ROUTING_IS_FALLBACK:"aspnetcore.routing.is_fallback",ATTR_ASPNETCORE_ROUTING_MATCH_STATUS:"aspnetcore.routing.match_status",ATTR_CLIENT_ADDRESS:"client.address",ATTR_CLIENT_PORT:"client.port",ATTR_CODE_COLUMN_NUMBER:"code.column.number",ATTR_CODE_FILE_PATH:"code.file.path",ATTR_CODE_FUNCTION_NAME:"code.function.name",ATTR_CODE_LINE_NUMBER:"code.line.number",ATTR_CODE_STACKTRACE:"code.stacktrace",ATTR_DB_COLLECTION_NAME:xf,ATTR_DB_NAMESPACE:kf,ATTR_DB_OPERATION_BATCH_SIZE:"db.operation.batch.size",ATTR_DB_OPERATION_NAME:Gf,ATTR_DB_QUERY_SUMMARY:"db.query.summary",ATTR_DB_QUERY_TEXT:Df,ATTR_DB_RESPONSE_STATUS_CODE:Vf,ATTR_DB_STORED_PROCEDURE_NAME:"db.stored_procedure.name",ATTR_DB_SYSTEM_NAME:Uf,ATTR_DOTNET_GC_HEAP_GENERATION:"dotnet.gc.heap.generation",ATTR_ERROR_TYPE:Hf,ATTR_EXCEPTION_ESCAPED:"exception.escaped",ATTR_EXCEPTION_MESSAGE:jf,ATTR_EXCEPTION_STACKTRACE:Zf,ATTR_EXCEPTION_TYPE:Wf,ATTR_HTTP_REQUEST_HEADER:e=>`http.request.header.${e}`,ATTR_HTTP_REQUEST_METHOD:Xf,ATTR_HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",ATTR_HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",ATTR_HTTP_RESPONSE_HEADER:e=>`http.response.header.${e}`,ATTR_HTTP_RESPONSE_STATUS_CODE:$f,ATTR_HTTP_ROUTE:Ff,ATTR_JVM_GC_ACTION:"jvm.gc.action",ATTR_JVM_GC_NAME:"jvm.gc.name",ATTR_JVM_MEMORY_POOL_NAME:"jvm.memory.pool.name",ATTR_JVM_MEMORY_TYPE:"jvm.memory.type",ATTR_JVM_THREAD_DAEMON:"jvm.thread.daemon",ATTR_JVM_THREAD_STATE:"jvm.thread.state",ATTR_NETWORK_LOCAL_ADDRESS:"network.local.address",ATTR_NETWORK_LOCAL_PORT:"network.local.port",ATTR_NETWORK_PEER_ADDRESS:"network.peer.address",ATTR_NETWORK_PEER_PORT:"network.peer.port",ATTR_NETWORK_PROTOCOL_NAME:"network.protocol.name",ATTR_NETWORK_PROTOCOL_VERSION:"network.protocol.version",ATTR_NETWORK_TRANSPORT:"network.transport",ATTR_NETWORK_TYPE:"network.type",ATTR_OTEL_SCOPE_NAME:"otel.scope.name",ATTR_OTEL_SCOPE_VERSION:"otel.scope.version",ATTR_OTEL_STATUS_CODE:"otel.status_code",ATTR_OTEL_STATUS_DESCRIPTION:"otel.status_description",ATTR_SERVER_ADDRESS:Yf,ATTR_SERVER_PORT:Bf,ATTR_SERVICE_NAME:Kf,ATTR_SERVICE_VERSION:Jf,ATTR_SIGNALR_CONNECTION_STATUS:"signalr.connection.status",ATTR_SIGNALR_TRANSPORT:"signalr.transport",ATTR_TELEMETRY_SDK_LANGUAGE:zf,ATTR_TELEMETRY_SDK_NAME:qf,ATTR_TELEMETRY_SDK_VERSION:e_,ATTR_URL_FRAGMENT:"url.fragment",ATTR_URL_FULL:t_,ATTR_URL_PATH:"url.path",ATTR_URL_QUERY:"url.query",ATTR_URL_SCHEME:"url.scheme",ATTR_USER_AGENT_ORIGINAL:"user_agent.original",AWSECSLAUNCHTYPEVALUES_EC2:"ec2",AWSECSLAUNCHTYPEVALUES_FARGATE:Gm,AwsEcsLaunchtypeValues:Dm,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS:gm,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC:Em,CLOUDPLATFORMVALUES_AWS_EC2:Sm,CLOUDPLATFORMVALUES_AWS_ECS:ym,CLOUDPLATFORMVALUES_AWS_EKS:Tm,CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK:Am,CLOUDPLATFORMVALUES_AWS_LAMBDA:bm,CLOUDPLATFORMVALUES_AZURE_AKS:Nm,CLOUDPLATFORMVALUES_AZURE_APP_SERVICE:Om,CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES:vm,CLOUDPLATFORMVALUES_AZURE_FUNCTIONS:Cm,CLOUDPLATFORMVALUES_AZURE_VM:Rm,CLOUDPLATFORMVALUES_GCP_APP_ENGINE:Mm,CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS:wm,CLOUDPLATFORMVALUES_GCP_CLOUD_RUN:Pm,CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE:Im,CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE:Lm,CLOUDPROVIDERVALUES_ALIBABA_CLOUD:zh,CLOUDPROVIDERVALUES_AWS:"aws",CLOUDPROVIDERVALUES_AZURE:Qh,CLOUDPROVIDERVALUES_GCP:"gcp",CloudPlatformValues:xm,CloudProviderValues:qh,DBCASSANDRACONSISTENCYLEVELVALUES_ALL:"all",DBCASSANDRACONSISTENCYLEVELVALUES_ANY:"any",DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM:Wc,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE:Yc,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM:$c,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL:Kc,DBCASSANDRACONSISTENCYLEVELVALUES_ONE:"one",DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM:Xc,DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL:Bc,DBCASSANDRACONSISTENCYLEVELVALUES_THREE:Fc,DBCASSANDRACONSISTENCYLEVELVALUES_TWO:"two",DBSYSTEMVALUES_ADABAS:ic,DBSYSTEMVALUES_CACHE:oc,DBSYSTEMVALUES_CASSANDRA:bc,DBSYSTEMVALUES_CLOUDSCAPE:Qa,DBSYSTEMVALUES_COCKROACHDB:xc,DBSYSTEMVALUES_COLDFUSION:Tc,DBSYSTEMVALUES_COSMOSDB:Oc,DBSYSTEMVALUES_COUCHBASE:Nc,DBSYSTEMVALUES_COUCHDB:Cc,DBSYSTEMVALUES_DB2:"db2",DBSYSTEMVALUES_DERBY:cc,DBSYSTEMVALUES_DYNAMODB:Ic,DBSYSTEMVALUES_EDB:"edb",DBSYSTEMVALUES_ELASTICSEARCH:wc,DBSYSTEMVALUES_FILEMAKER:uc,DBSYSTEMVALUES_FIREBIRD:ac,DBSYSTEMVALUES_FIRSTSQL:sc,DBSYSTEMVALUES_GEODE:Lc,DBSYSTEMVALUES_H2:"h2",DBSYSTEMVALUES_HANADB:nc,DBSYSTEMVALUES_HBASE:Ac,DBSYSTEMVALUES_HIVE:za,DBSYSTEMVALUES_HSQLDB:qa,DBSYSTEMVALUES_INFORMIX:lc,DBSYSTEMVALUES_INGRES:rc,DBSYSTEMVALUES_INSTANTDB:pc,DBSYSTEMVALUES_INTERBASE:dc,DBSYSTEMVALUES_MARIADB:hc,DBSYSTEMVALUES_MAXDB:tc,DBSYSTEMVALUES_MEMCACHED:Mc,DBSYSTEMVALUES_MONGODB:Rc,DBSYSTEMVALUES_MSSQL:Fa,DBSYSTEMVALUES_MYSQL:Ya,DBSYSTEMVALUES_NEO4J:Pc,DBSYSTEMVALUES_NETEZZA:mc,DBSYSTEMVALUES_ORACLE:Ba,DBSYSTEMVALUES_OTHER_SQL:$a,DBSYSTEMVALUES_PERVASIVE:fc,DBSYSTEMVALUES_POINTBASE:_c,DBSYSTEMVALUES_POSTGRESQL:Ka,DBSYSTEMVALUES_PROGRESS:ec,DBSYSTEMVALUES_REDIS:vc,DBSYSTEMVALUES_REDSHIFT:Ja,DBSYSTEMVALUES_SQLITE:gc,DBSYSTEMVALUES_SYBASE:Ec,DBSYSTEMVALUES_TERADATA:Sc,DBSYSTEMVALUES_VERTICA:yc,DB_SYSTEM_NAME_VALUE_MARIADB:"mariadb",DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER:"microsoft.sql_server",DB_SYSTEM_NAME_VALUE_MYSQL:"mysql",DB_SYSTEM_NAME_VALUE_POSTGRESQL:"postgresql",DOTNET_GC_HEAP_GENERATION_VALUE_GEN0:"gen0",DOTNET_GC_HEAP_GENERATION_VALUE_GEN1:"gen1",DOTNET_GC_HEAP_GENERATION_VALUE_GEN2:"gen2",DOTNET_GC_HEAP_GENERATION_VALUE_LOH:"loh",DOTNET_GC_HEAP_GENERATION_VALUE_POH:"poh",DbCassandraConsistencyLevelValues:Jc,DbSystemValues:kc,ERROR_TYPE_VALUE_OTHER:"_OTHER",FAASDOCUMENTOPERATIONVALUES_DELETE:hu,FAASDOCUMENTOPERATIONVALUES_EDIT:du,FAASDOCUMENTOPERATIONVALUES_INSERT:pu,FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD:gu,FAASINVOKEDPROVIDERVALUES_AWS:"aws",FAASINVOKEDPROVIDERVALUES_AZURE:Eu,FAASINVOKEDPROVIDERVALUES_GCP:"gcp",FAASTRIGGERVALUES_DATASOURCE:nu,FAASTRIGGERVALUES_HTTP:ru,FAASTRIGGERVALUES_OTHER:iu,FAASTRIGGERVALUES_PUBSUB:su,FAASTRIGGERVALUES_TIMER:ou,FaasDocumentOperationValues:mu,FaasInvokedProviderValues:Su,FaasTriggerValues:au,HOSTARCHVALUES_AMD64:Xm,HOSTARCHVALUES_ARM32:$m,HOSTARCHVALUES_ARM64:Fm,HOSTARCHVALUES_IA64:Ym,HOSTARCHVALUES_PPC32:Bm,HOSTARCHVALUES_PPC64:Km,HOSTARCHVALUES_X86:"x86",HTTPFLAVORVALUES_HTTP_1_0:"1.0",HTTPFLAVORVALUES_HTTP_1_1:"1.1",HTTPFLAVORVALUES_HTTP_2_0:"2.0",HTTPFLAVORVALUES_QUIC:Pl,HTTPFLAVORVALUES_SPDY:Il,HTTP_REQUEST_METHOD_VALUE_CONNECT:"CONNECT",HTTP_REQUEST_METHOD_VALUE_DELETE:"DELETE",HTTP_REQUEST_METHOD_VALUE_GET:"GET",HTTP_REQUEST_METHOD_VALUE_HEAD:"HEAD",HTTP_REQUEST_METHOD_VALUE_OPTIONS:"OPTIONS",HTTP_REQUEST_METHOD_VALUE_OTHER:"_OTHER",HTTP_REQUEST_METHOD_VALUE_PATCH:"PATCH",HTTP_REQUEST_METHOD_VALUE_POST:"POST",HTTP_REQUEST_METHOD_VALUE_PUT:"PUT",HTTP_REQUEST_METHOD_VALUE_TRACE:"TRACE",HostArchValues:Jm,HttpFlavorValues:Ll,JVM_MEMORY_TYPE_VALUE_HEAP:"heap",JVM_MEMORY_TYPE_VALUE_NON_HEAP:"non_heap",JVM_THREAD_STATE_VALUE_BLOCKED:"blocked",JVM_THREAD_STATE_VALUE_NEW:"new",JVM_THREAD_STATE_VALUE_RUNNABLE:"runnable",JVM_THREAD_STATE_VALUE_TERMINATED:"terminated",JVM_THREAD_STATE_VALUE_TIMED_WAITING:"timed_waiting",JVM_THREAD_STATE_VALUE_WAITING:"waiting",MESSAGETYPEVALUES_RECEIVED:Fl,MESSAGETYPEVALUES_SENT:$l,MESSAGINGDESTINATIONKINDVALUES_QUEUE:xl,MESSAGINGDESTINATIONKINDVALUES_TOPIC:kl,MESSAGINGOPERATIONVALUES_PROCESS:Hl,MESSAGINGOPERATIONVALUES_RECEIVE:Ul,METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS:"aspnetcore.diagnostics.exceptions",METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES:"aspnetcore.rate_limiting.active_request_leases",METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS:"aspnetcore.rate_limiting.queued_requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS:"aspnetcore.rate_limiting.requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION:"aspnetcore.rate_limiting.request_lease.duration",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE:"aspnetcore.rate_limiting.request.time_in_queue",METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS:"aspnetcore.routing.match_attempts",METRIC_DB_CLIENT_OPERATION_DURATION:"db.client.operation.duration",METRIC_DOTNET_ASSEMBLY_COUNT:"dotnet.assembly.count",METRIC_DOTNET_EXCEPTIONS:"dotnet.exceptions",METRIC_DOTNET_GC_COLLECTIONS:"dotnet.gc.collections",METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED:"dotnet.gc.heap.total_allocated",METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE:"dotnet.gc.last_collection.heap.fragmentation.size",METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE:"dotnet.gc.last_collection.heap.size",METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE:"dotnet.gc.last_collection.memory.committed_size",METRIC_DOTNET_GC_PAUSE_TIME:"dotnet.gc.pause.time",METRIC_DOTNET_JIT_COMPILATION_TIME:"dotnet.jit.compilation.time",METRIC_DOTNET_JIT_COMPILED_IL_SIZE:"dotnet.jit.compiled_il.size",METRIC_DOTNET_JIT_COMPILED_METHODS:"dotnet.jit.compiled_methods",METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS:"dotnet.monitor.lock_contentions",METRIC_DOTNET_PROCESS_CPU_COUNT:"dotnet.process.cpu.count",METRIC_DOTNET_PROCESS_CPU_TIME:"dotnet.process.cpu.time",METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET:"dotnet.process.memory.working_set",METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH:"dotnet.thread_pool.queue.length",METRIC_DOTNET_THREAD_POOL_THREAD_COUNT:"dotnet.thread_pool.thread.count",METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT:"dotnet.thread_pool.work_item.count",METRIC_DOTNET_TIMER_COUNT:"dotnet.timer.count",METRIC_HTTP_CLIENT_REQUEST_DURATION:"http.client.request.duration",METRIC_HTTP_SERVER_REQUEST_DURATION:"http.server.request.duration",METRIC_JVM_CLASS_COUNT:"jvm.class.count",METRIC_JVM_CLASS_LOADED:"jvm.class.loaded",METRIC_JVM_CLASS_UNLOADED:"jvm.class.unloaded",METRIC_JVM_CPU_COUNT:"jvm.cpu.count",METRIC_JVM_CPU_RECENT_UTILIZATION:"jvm.cpu.recent_utilization",METRIC_JVM_CPU_TIME:"jvm.cpu.time",METRIC_JVM_GC_DURATION:"jvm.gc.duration",METRIC_JVM_MEMORY_COMMITTED:"jvm.memory.committed",METRIC_JVM_MEMORY_LIMIT:"jvm.memory.limit",METRIC_JVM_MEMORY_USED:"jvm.memory.used",METRIC_JVM_MEMORY_USED_AFTER_LAST_GC:"jvm.memory.used_after_last_gc",METRIC_JVM_THREAD_COUNT:"jvm.thread.count",METRIC_KESTREL_ACTIVE_CONNECTIONS:"kestrel.active_connections",METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES:"kestrel.active_tls_handshakes",METRIC_KESTREL_CONNECTION_DURATION:"kestrel.connection.duration",METRIC_KESTREL_QUEUED_CONNECTIONS:"kestrel.queued_connections",METRIC_KESTREL_QUEUED_REQUESTS:"kestrel.queued_requests",METRIC_KESTREL_REJECTED_CONNECTIONS:"kestrel.rejected_connections",METRIC_KESTREL_TLS_HANDSHAKE_DURATION:"kestrel.tls_handshake.duration",METRIC_KESTREL_UPGRADED_CONNECTIONS:"kestrel.upgraded_connections",METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS:"signalr.server.active_connections",METRIC_SIGNALR_SERVER_CONNECTION_DURATION:"signalr.server.connection.duration",MessageTypeValues:Yl,MessagingDestinationKindValues:Gl,MessagingOperationValues:jl,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA:pl,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT:ml,NETHOSTCONNECTIONSUBTYPEVALUES_EDGE:ul,NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD:yl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0:dl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A:hl,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B:Sl,NETHOSTCONNECTIONSUBTYPEVALUES_GPRS:cl,NETHOSTCONNECTIONSUBTYPEVALUES_GSM:"gsm",NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA:fl,NETHOSTCONNECTIONSUBTYPEVALUES_HSPA:gl,NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP:Tl,NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA:_l,NETHOSTCONNECTIONSUBTYPEVALUES_IDEN:El,NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN:Al,NETHOSTCONNECTIONSUBTYPEVALUES_LTE:"lte",NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA:vl,NETHOSTCONNECTIONSUBTYPEVALUES_NR:"nr",NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA:Rl,NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA:bl,NETHOSTCONNECTIONSUBTYPEVALUES_UMTS:ll,NETHOSTCONNECTIONTYPEVALUES_CELL:Hu,NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE:ju,NETHOSTCONNECTIONTYPEVALUES_UNKNOWN:Zu,NETHOSTCONNECTIONTYPEVALUES_WIFI:Vu,NETHOSTCONNECTIONTYPEVALUES_WIRED:Uu,NETTRANSPORTVALUES_INPROC:Pu,NETTRANSPORTVALUES_IP:"ip",NETTRANSPORTVALUES_IP_TCP:Nu,NETTRANSPORTVALUES_IP_UDP:Cu,NETTRANSPORTVALUES_OTHER:Lu,NETTRANSPORTVALUES_PIPE:Iu,NETTRANSPORTVALUES_UNIX:Ou,NETWORK_TRANSPORT_VALUE_PIPE:"pipe",NETWORK_TRANSPORT_VALUE_QUIC:"quic",NETWORK_TRANSPORT_VALUE_TCP:"tcp",NETWORK_TRANSPORT_VALUE_UDP:"udp",NETWORK_TRANSPORT_VALUE_UNIX:"unix",NETWORK_TYPE_VALUE_IPV4:"ipv4",NETWORK_TYPE_VALUE_IPV6:"ipv6",NetHostConnectionSubtypeValues:Nl,NetHostConnectionTypeValues:Wu,NetTransportValues:wu,OSTYPEVALUES_AIX:"aix",OSTYPEVALUES_DARWIN:lf,OSTYPEVALUES_DRAGONFLYBSD:mf,OSTYPEVALUES_FREEBSD:pf,OSTYPEVALUES_HPUX:ff,OSTYPEVALUES_LINUX:uf,OSTYPEVALUES_NETBSD:df,OSTYPEVALUES_OPENBSD:hf,OSTYPEVALUES_SOLARIS:_f,OSTYPEVALUES_WINDOWS:cf,OSTYPEVALUES_Z_OS:gf,OTEL_STATUS_CODE_VALUE_ERROR:"ERROR",OTEL_STATUS_CODE_VALUE_OK:"OK",OsTypeValues:Ef,RPCGRPCSTATUSCODEVALUES_ABORTED:10,RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS:6,RPCGRPCSTATUSCODEVALUES_CANCELLED:1,RPCGRPCSTATUSCODEVALUES_DATA_LOSS:15,RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED:4,RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION:9,RPCGRPCSTATUSCODEVALUES_INTERNAL:13,RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT:3,RPCGRPCSTATUSCODEVALUES_NOT_FOUND:5,RPCGRPCSTATUSCODEVALUES_OK:0,RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE:11,RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED:7,RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED:8,RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED:16,RPCGRPCSTATUSCODEVALUES_UNAVAILABLE:14,RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED:12,RPCGRPCSTATUSCODEVALUES_UNKNOWN:2,RpcGrpcStatusCodeValues:Zl,SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET:ui,SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:Ti,SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ:ii,SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY:ni,SEMATTRS_AWS_DYNAMODB_COUNT:Si,SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE:mi,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:di,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:bi,SEMATTRS_AWS_DYNAMODB_INDEX_NAME:li,SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS:ri,SEMATTRS_AWS_DYNAMODB_LIMIT:ci,SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:hi,SEMATTRS_AWS_DYNAMODB_PROJECTION:ai,SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:si,SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:oi,SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT:yi,SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD:_i,SEMATTRS_AWS_DYNAMODB_SEGMENT:gi,SEMATTRS_AWS_DYNAMODB_SELECT:pi,SEMATTRS_AWS_DYNAMODB_TABLE_COUNT:fi,SEMATTRS_AWS_DYNAMODB_TABLE_NAMES:ti,SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS:Ei,SEMATTRS_AWS_LAMBDA_INVOKED_ARN:Ms,SEMATTRS_CODE_FILEPATH:Vo,SEMATTRS_CODE_FUNCTION:Go,SEMATTRS_CODE_LINENO:Uo,SEMATTRS_CODE_NAMESPACE:Do,SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL:Xs,SEMATTRS_DB_CASSANDRA_COORDINATOR_DC:Ks,SEMATTRS_DB_CASSANDRA_COORDINATOR_ID:Bs,SEMATTRS_DB_CASSANDRA_IDEMPOTENCE:Fs,SEMATTRS_DB_CASSANDRA_KEYSPACE:Zs,SEMATTRS_DB_CASSANDRA_PAGE_SIZE:Ws,SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:Ys,SEMATTRS_DB_CASSANDRA_TABLE:$s,SEMATTRS_DB_CONNECTION_STRING:ks,SEMATTRS_DB_HBASE_NAMESPACE:Js,SEMATTRS_DB_JDBC_DRIVER_CLASSNAME:Ds,SEMATTRS_DB_MONGODB_COLLECTION:Qs,SEMATTRS_DB_MSSQL_INSTANCE_NAME:js,SEMATTRS_DB_NAME:Vs,SEMATTRS_DB_OPERATION:Hs,SEMATTRS_DB_REDIS_DATABASE_INDEX:zs,SEMATTRS_DB_SQL_TABLE:qs,SEMATTRS_DB_STATEMENT:Us,SEMATTRS_DB_SYSTEM:xs,SEMATTRS_DB_USER:Gs,SEMATTRS_ENDUSER_ID:Lo,SEMATTRS_ENDUSER_ROLE:wo,SEMATTRS_ENDUSER_SCOPE:Mo,SEMATTRS_EXCEPTION_ESCAPED:ro,SEMATTRS_EXCEPTION_MESSAGE:to,SEMATTRS_EXCEPTION_STACKTRACE:no,SEMATTRS_EXCEPTION_TYPE:eo,SEMATTRS_FAAS_COLDSTART:ho,SEMATTRS_FAAS_CRON:po,SEMATTRS_FAAS_DOCUMENT_COLLECTION:io,SEMATTRS_FAAS_DOCUMENT_NAME:uo,SEMATTRS_FAAS_DOCUMENT_OPERATION:ao,SEMATTRS_FAAS_DOCUMENT_TIME:co,SEMATTRS_FAAS_EXECUTION:oo,SEMATTRS_FAAS_INVOKED_NAME:mo,SEMATTRS_FAAS_INVOKED_PROVIDER:fo,SEMATTRS_FAAS_INVOKED_REGION:_o,SEMATTRS_FAAS_TIME:lo,SEMATTRS_FAAS_TRIGGER:so,SEMATTRS_HTTP_CLIENT_IP:ei,SEMATTRS_HTTP_FLAVOR:Fo,SEMATTRS_HTTP_HOST:Wo,SEMATTRS_HTTP_METHOD:Ho,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH:Bo,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:Ko,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH:Jo,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:zo,SEMATTRS_HTTP_ROUTE:qo,SEMATTRS_HTTP_SCHEME:Xo,SEMATTRS_HTTP_SERVER_NAME:Qo,SEMATTRS_HTTP_STATUS_CODE:$o,SEMATTRS_HTTP_TARGET:Zo,SEMATTRS_HTTP_URL:jo,SEMATTRS_HTTP_USER_AGENT:Yo,SEMATTRS_MESSAGE_COMPRESSED_SIZE:Qi,SEMATTRS_MESSAGE_ID:zi,SEMATTRS_MESSAGE_TYPE:Ji,SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE:qi,SEMATTRS_MESSAGING_CONSUMER_ID:ki,SEMATTRS_MESSAGING_CONVERSATION_ID:Li,SEMATTRS_MESSAGING_DESTINATION:Ri,SEMATTRS_MESSAGING_DESTINATION_KIND:vi,SEMATTRS_MESSAGING_KAFKA_CLIENT_ID:Ui,SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP:Vi,SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY:Di,SEMATTRS_MESSAGING_KAFKA_PARTITION:Hi,SEMATTRS_MESSAGING_KAFKA_TOMBSTONE:ji,SEMATTRS_MESSAGING_MESSAGE_ID:Pi,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:Mi,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:wi,SEMATTRS_MESSAGING_OPERATION:xi,SEMATTRS_MESSAGING_PROTOCOL:Ci,SEMATTRS_MESSAGING_PROTOCOL_VERSION:Oi,SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY:Gi,SEMATTRS_MESSAGING_SYSTEM:Ai,SEMATTRS_MESSAGING_TEMP_DESTINATION:Ni,SEMATTRS_MESSAGING_URL:Ii,SEMATTRS_NET_HOST_CARRIER_ICC:Io,SEMATTRS_NET_HOST_CARRIER_MCC:Co,SEMATTRS_NET_HOST_CARRIER_MNC:Oo,SEMATTRS_NET_HOST_CARRIER_NAME:No,SEMATTRS_NET_HOST_CONNECTION_SUBTYPE:vo,SEMATTRS_NET_HOST_CONNECTION_TYPE:Ro,SEMATTRS_NET_HOST_IP:To,SEMATTRS_NET_HOST_NAME:Ao,SEMATTRS_NET_HOST_PORT:bo,SEMATTRS_NET_PEER_IP:Eo,SEMATTRS_NET_PEER_NAME:yo,SEMATTRS_NET_PEER_PORT:So,SEMATTRS_NET_TRANSPORT:go,SEMATTRS_PEER_SERVICE:Po,SEMATTRS_RPC_GRPC_STATUS_CODE:$i,SEMATTRS_RPC_JSONRPC_ERROR_CODE:Bi,SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE:Ki,SEMATTRS_RPC_JSONRPC_REQUEST_ID:Yi,SEMATTRS_RPC_JSONRPC_VERSION:Fi,SEMATTRS_RPC_METHOD:Xi,SEMATTRS_RPC_SERVICE:Wi,SEMATTRS_RPC_SYSTEM:Zi,SEMATTRS_THREAD_ID:xo,SEMATTRS_THREAD_NAME:ko,SEMRESATTRS_AWS_ECS_CLUSTER_ARN:Cd,SEMRESATTRS_AWS_ECS_CONTAINER_ARN:Nd,SEMRESATTRS_AWS_ECS_LAUNCHTYPE:Od,SEMRESATTRS_AWS_ECS_TASK_ARN:Id,SEMRESATTRS_AWS_ECS_TASK_FAMILY:Pd,SEMRESATTRS_AWS_ECS_TASK_REVISION:Ld,SEMRESATTRS_AWS_EKS_CLUSTER_ARN:wd,SEMRESATTRS_AWS_LOG_GROUP_ARNS:xd,SEMRESATTRS_AWS_LOG_GROUP_NAMES:Md,SEMRESATTRS_AWS_LOG_STREAM_ARNS:Gd,SEMRESATTRS_AWS_LOG_STREAM_NAMES:kd,SEMRESATTRS_CLOUD_ACCOUNT_ID:bd,SEMRESATTRS_CLOUD_AVAILABILITY_ZONE:Rd,SEMRESATTRS_CLOUD_PLATFORM:vd,SEMRESATTRS_CLOUD_PROVIDER:Td,SEMRESATTRS_CLOUD_REGION:Ad,SEMRESATTRS_CONTAINER_ID:Vd,SEMRESATTRS_CONTAINER_IMAGE_NAME:Hd,SEMRESATTRS_CONTAINER_IMAGE_TAG:jd,SEMRESATTRS_CONTAINER_NAME:Dd,SEMRESATTRS_CONTAINER_RUNTIME:Ud,SEMRESATTRS_DEPLOYMENT_ENVIRONMENT:Zd,SEMRESATTRS_DEVICE_ID:Wd,SEMRESATTRS_DEVICE_MODEL_IDENTIFIER:Xd,SEMRESATTRS_DEVICE_MODEL_NAME:$d,SEMRESATTRS_FAAS_ID:Yd,SEMRESATTRS_FAAS_INSTANCE:Kd,SEMRESATTRS_FAAS_MAX_MEMORY:Jd,SEMRESATTRS_FAAS_NAME:Fd,SEMRESATTRS_FAAS_VERSION:Bd,SEMRESATTRS_HOST_ARCH:eh,SEMRESATTRS_HOST_ID:zd,SEMRESATTRS_HOST_IMAGE_ID:nh,SEMRESATTRS_HOST_IMAGE_NAME:th,SEMRESATTRS_HOST_IMAGE_VERSION:rh,SEMRESATTRS_HOST_NAME:Qd,SEMRESATTRS_HOST_TYPE:qd,SEMRESATTRS_K8S_CLUSTER_NAME:sh,SEMRESATTRS_K8S_CONTAINER_NAME:lh,SEMRESATTRS_K8S_CRONJOB_NAME:bh,SEMRESATTRS_K8S_CRONJOB_UID:Th,SEMRESATTRS_K8S_DAEMONSET_NAME:Eh,SEMRESATTRS_K8S_DAEMONSET_UID:gh,SEMRESATTRS_K8S_DEPLOYMENT_NAME:mh,SEMRESATTRS_K8S_DEPLOYMENT_UID:hh,SEMRESATTRS_K8S_JOB_NAME:yh,SEMRESATTRS_K8S_JOB_UID:Sh,SEMRESATTRS_K8S_NAMESPACE_NAME:ah,SEMRESATTRS_K8S_NODE_NAME:oh,SEMRESATTRS_K8S_NODE_UID:ih,SEMRESATTRS_K8S_POD_NAME:uh,SEMRESATTRS_K8S_POD_UID:ch,SEMRESATTRS_K8S_REPLICASET_NAME:dh,SEMRESATTRS_K8S_REPLICASET_UID:ph,SEMRESATTRS_K8S_STATEFULSET_NAME:_h,SEMRESATTRS_K8S_STATEFULSET_UID:fh,SEMRESATTRS_OS_DESCRIPTION:Rh,SEMRESATTRS_OS_NAME:vh,SEMRESATTRS_OS_TYPE:Ah,SEMRESATTRS_OS_VERSION:Nh,SEMRESATTRS_PROCESS_COMMAND:Ph,SEMRESATTRS_PROCESS_COMMAND_ARGS:wh,SEMRESATTRS_PROCESS_COMMAND_LINE:Lh,SEMRESATTRS_PROCESS_EXECUTABLE_NAME:Oh,SEMRESATTRS_PROCESS_EXECUTABLE_PATH:Ih,SEMRESATTRS_PROCESS_OWNER:Mh,SEMRESATTRS_PROCESS_PID:Ch,SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION:Gh,SEMRESATTRS_PROCESS_RUNTIME_NAME:xh,SEMRESATTRS_PROCESS_RUNTIME_VERSION:kh,SEMRESATTRS_SERVICE_INSTANCE_ID:Uh,SEMRESATTRS_SERVICE_NAME:Dh,SEMRESATTRS_SERVICE_NAMESPACE:Vh,SEMRESATTRS_SERVICE_VERSION:Hh,SEMRESATTRS_TELEMETRY_AUTO_VERSION:Xh,SEMRESATTRS_TELEMETRY_SDK_LANGUAGE:Zh,SEMRESATTRS_TELEMETRY_SDK_NAME:jh,SEMRESATTRS_TELEMETRY_SDK_VERSION:Wh,SEMRESATTRS_WEBENGINE_DESCRIPTION:Yh,SEMRESATTRS_WEBENGINE_NAME:$h,SEMRESATTRS_WEBENGINE_VERSION:Fh,SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN:"app_shutdown",SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE:"normal_closure",SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT:"timeout",SIGNALR_TRANSPORT_VALUE_LONG_POLLING:"long_polling",SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS:"server_sent_events",SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS:"web_sockets",SemanticAttributes:ea,SemanticResourceAttributes:Bh,TELEMETRYSDKLANGUAGEVALUES_CPP:"cpp",TELEMETRYSDKLANGUAGEVALUES_DOTNET:Nf,TELEMETRYSDKLANGUAGEVALUES_ERLANG:Cf,TELEMETRYSDKLANGUAGEVALUES_GO:"go",TELEMETRYSDKLANGUAGEVALUES_JAVA:Of,TELEMETRYSDKLANGUAGEVALUES_NODEJS:If,TELEMETRYSDKLANGUAGEVALUES_PHP:"php",TELEMETRYSDKLANGUAGEVALUES_PYTHON:Pf,TELEMETRYSDKLANGUAGEVALUES_RUBY:Lf,TELEMETRYSDKLANGUAGEVALUES_WEBJS:wf,TELEMETRY_SDK_LANGUAGE_VALUE_CPP:"cpp",TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET:"dotnet",TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG:"erlang",TELEMETRY_SDK_LANGUAGE_VALUE_GO:"go",TELEMETRY_SDK_LANGUAGE_VALUE_JAVA:"java",TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS:Qf,TELEMETRY_SDK_LANGUAGE_VALUE_PHP:"php",TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON:"python",TELEMETRY_SDK_LANGUAGE_VALUE_RUBY:"ruby",TELEMETRY_SDK_LANGUAGE_VALUE_RUST:"rust",TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT:"swift",TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS:"webjs",TelemetrySdkLanguageValues:Mf});const r_="process.runtime.name",s_={[qf]:"opentelemetry",[r_]:"node",[zf]:Qf,[e_]:"2.0.1"};const o_=Math.pow(10,6),i_=Math.pow(10,9);function a_(e){const t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*o_)]}function c_(){let e=pn.timeOrigin;if("number"!=typeof e){const t=pn;e=t.timing&&t.timing.fetchStart}return e}function u_(e){return h_(a_(c_()),a_("number"==typeof e?e:pn.now()))}function l_(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=i_),[n,r]}function p_(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function d_(e){return p_(e)||"number"==typeof e||e instanceof Date}function h_(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=i_&&(n[1]-=i_,n[0]+=1),n}var m_;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(m_||(m_={}));const f_="[_0-9a-z-*/]",__=new RegExp(`^(?:${`[a-z]${f_}{0,255}`}|${`[a-z0-9]${f_}{0,240}@[a-z]${f_}{0,13}`})$`),g_=/^[ -~]{0,255}[!-~]$/,E_=/,|=/;class S_{_internalState=new Map;constructor(e){e&&this._parse(e)}set(e,t){const n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n}unset(e){const t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((e,t)=>{const n=t.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),o=n.slice(r+1,t.length);(function(e){return __.test(e)})(s)&&function(e){return g_.test(e)&&!E_.test(e)}(o)&&e.set(s,o)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new S_;return e._internalState=new Map(this._internalState),e}}const y_="traceparent",T_="tracestate",b_=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");function A_(e){const t=b_.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}const R_=ce("OpenTelemetry SDK Context Key RPC_METADATA");var v_;function N_(e){return e.getValue(R_)}!function(e){e.HTTP="http"}(v_||(v_={}));const C_="[object Null]",O_="[object Undefined]",I_=Function.prototype.toString,P_=I_.call(Object),L_=Object.getPrototypeOf,w_=Object.prototype,M_=w_.hasOwnProperty,x_=Symbol?Symbol.toStringTag:void 0,k_=w_.toString;function G_(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?O_:C_;return x_&&x_ in Object(e)?function(e){const t=M_.call(e,x_),n=e[x_];let r=!1;try{e[x_]=void 0,r=!0}catch(e){}const s=k_.call(e);r&&(t?e[x_]=n:delete e[x_]);return s}(e):function(e){return k_.call(e)}(e)}(e))return!1;const t=L_(e);if(null===t)return!0;const n=M_.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&I_.call(n)===P_}function D_(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=U_(t,e.shift(),0,n);return t}function V_(e){return j_(e)?e.slice():e}function U_(e,t,n=0,r){let s;if(!(n>20)){if(n++,X_(e)||X_(t)||Z_(t))s=V_(t);else if(j_(e)){if(s=e.slice(),j_(t))for(let e=0,n=t.length;e<n;e++)s.push(V_(t[e]));else if(W_(t)){const e=Object.keys(t);for(let n=0,r=e.length;n<r;n++){const r=e[n];s[r]=V_(t[r])}}}else if(W_(e))if(W_(t)){if(!function(e,t){if(!G_(e)||!G_(t))return!1;return!0}(e,t))return t;s=Object.assign({},e);const o=Object.keys(t);for(let i=0,a=o.length;i<a;i++){const a=o[i],c=t[a];if(X_(c))void 0===c?delete s[a]:s[a]=c;else{const o=s[a],i=c;if(H_(e,a,r)||H_(t,a,r))delete s[a];else{if(W_(o)&&W_(i)){const n=r.get(o)||[],s=r.get(i)||[];n.push({obj:e,key:a}),s.push({obj:t,key:a}),r.set(o,n),r.set(i,s)}s[a]=U_(s[a],c,n,r)}}}}else s=t;return s}}function H_(e,t,n){const r=n.get(e[t])||[];for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.key===t&&s.obj===e)return!0}return!1}function j_(e){return Array.isArray(e)}function Z_(e){return"function"==typeof e}function W_(e){return!X_(e)&&!j_(e)&&!Z_(e)&&"object"==typeof e}function X_(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}class $_ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$_.prototype)}}function F_(e,t){return"string"==typeof t?e===t:!!e.match(t)}class Y_{_promise;_resolve;_reject;constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const B_={ALL:Y.ALL,VERBOSE:Y.VERBOSE,DEBUG:Y.DEBUG,INFO:Y.INFO,WARN:Y.WARN,ERROR:Y.ERROR,NONE:Y.NONE};const K_={_export:function(e,t){return new Promise(n=>{bt.with(Bt(bt.active()),()=>{e.export(t,e=>{n(e)})})})}};var J_,z_=Object.freeze({__proto__:null,AnchoredClock:class{_monotonicClock;_epochMillis;_performanceMillis;constructor(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}now(){const e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}},BindOnceFuture:class{_callback;_that;_isCalled=!1;_deferred=new Y_;constructor(e,t){this._callback=e,this._that=t}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(e=>this._deferred.resolve(e),e=>this._deferred.reject(e))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}},CompositePropagator:class{_propagators;_fields;constructor(e={}){this._propagators=e.propagators??[],this._fields=Array.from(new Set(this._propagators.map(e=>"function"==typeof e.fields?e.fields():[]).reduce((e,t)=>e.concat(t),[])))}inject(e,t,n){for(const r of this._propagators)try{r.inject(e,t,n)}catch(e){At.warn(`Failed to inject with ${r.constructor.name}. Err: ${e.message}`)}}extract(e,t,n){return this._propagators.reduce((e,r)=>{try{return r.extract(e,t,n)}catch(e){At.warn(`Failed to extract with ${r.constructor.name}. Err: ${e.message}`)}return e},e)}fields(){return this._fields.slice()}},get ExportResultCode(){return m_},get RPCType(){return v_},SDK_INFO:s_,TRACE_PARENT_HEADER:y_,TRACE_STATE_HEADER:T_,TimeoutError:$_,TraceState:S_,W3CBaggagePropagator:qt,W3CTraceContextPropagator:class{inject(e,t,n){const r=Ht.getSpanContext(e);if(!r||Kt(e)||!it(r))return;const s=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||xe.NONE).toString(16)}`;n.set(t,y_,s),r.traceState&&n.set(t,T_,r.traceState.serialize())}extract(e,t,n){const r=n.get(t,y_);if(!r)return e;const s=Array.isArray(r)?r[0]:r;if("string"!=typeof s)return e;const o=A_(s);if(!o)return e;o.isRemote=!0;const i=n.get(t,T_);if(i){const e=Array.isArray(i)?i.join(","):i;o.traceState=new S_("string"==typeof e?e:void 0)}return Ht.setSpanContext(e,o)}fields(){return[y_,T_]}},_globalThis:ln,addHrTimes:h_,callWithTimeout:function(e,t){let n;const r=new Promise(function(e,r){n=setTimeout(function(){r(new $_("Operation timed out."))},t)});return Promise.race([e,r]).then(e=>(clearTimeout(n),e),e=>{throw clearTimeout(n),e})},deleteRPCMetadata:function(e){return e.deleteValue(R_)},diagLogLevelFromString:function(e){if(null==e)return;const t=B_[e.toUpperCase()];return null==t?(At.warn(`Unknown log level "${e}", expected one of ${Object.keys(B_)}, using default`),Y.INFO):t},getBooleanFromEnv:function(e){const t=process.env[e]?.trim().toLowerCase();return null!=t&&""!==t&&("true"===t||("false"===t||At.warn(`Unknown value ${s.inspect(t)} for ${e}, expected 'true' or 'false', falling back to 'false' (default)`),!1))},getNumberFromEnv:cn,getRPCMetadata:N_,getStringFromEnv:un,getStringListFromEnv:function(e){return un(e)?.split(",").map(e=>e.trim()).filter(e=>""!==e)},getTimeOrigin:c_,globalErrorHandler:an,hrTime:u_,hrTimeDuration:l_,hrTimeToMicroseconds:function(e){return 1e6*e[0]+e[1]/1e3},hrTimeToMilliseconds:function(e){return 1e3*e[0]+e[1]/1e6},hrTimeToNanoseconds:function(e){return e[0]*i_+e[1]},hrTimeToTimeStamp:function(e){const t=`${"0".repeat(9)}${e[1]}Z`,n=t.substring(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",n)},internal:K_,isAttributeValue:nn,isTimeInput:d_,isTimeInputHrTime:p_,isTracingSuppressed:Kt,isUrlIgnored:function(e,t){if(!t)return!1;for(const n of t)if(F_(e,n))return!0;return!1},loggingErrorHandler:sn,merge:D_,millisToHrTime:a_,otperformance:pn,parseKeyPairsIntoRecord:function(e){const t={};return"string"==typeof e&&e.length>0&&e.split(Jt).forEach(e=>{const n=Qt(e);void 0!==n&&n.value.length>0&&(t[n.key]=n.value)}),t},parseTraceParent:A_,sanitizeAttributes:en,setGlobalErrorHandler:function(e){on=e},setRPCMetadata:function(e,t){return e.setValue(R_,t)},suppressTracing:Bt,timeInputToHrTime:function(e){if(p_(e))return e;if("number"==typeof e)return e<c_()?u_(e):a_(e);if(e instanceof Date)return a_(e.getTime());throw TypeError("Invalid input type")},unrefTimer:function(e){e.unref()},unsuppressTracing:function(e){return e.deleteValue(Yt)},urlMatches:F_}),Q_=Wt(z_),q_={};Object.defineProperty(q_,"__esModule",{value:!0}),q_.VERSION=void 0,q_.VERSION="0.203.0",function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRACE=1]="TRACE",e[e.TRACE2=2]="TRACE2",e[e.TRACE3=3]="TRACE3",e[e.TRACE4=4]="TRACE4",e[e.DEBUG=5]="DEBUG",e[e.DEBUG2=6]="DEBUG2",e[e.DEBUG3=7]="DEBUG3",e[e.DEBUG4=8]="DEBUG4",e[e.INFO=9]="INFO",e[e.INFO2=10]="INFO2",e[e.INFO3=11]="INFO3",e[e.INFO4=12]="INFO4",e[e.WARN=13]="WARN",e[e.WARN2=14]="WARN2",e[e.WARN3=15]="WARN3",e[e.WARN4=16]="WARN4",e[e.ERROR=17]="ERROR",e[e.ERROR2=18]="ERROR2",e[e.ERROR3=19]="ERROR3",e[e.ERROR4=20]="ERROR4",e[e.FATAL=21]="FATAL",e[e.FATAL2=22]="FATAL2",e[e.FATAL3=23]="FATAL3",e[e.FATAL4=24]="FATAL4"}(J_||(J_={}));let eg=class{emit(e){}};const tg=new eg;const ng=new class{getLogger(e,t,n){return new eg}};let rg=class{constructor(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}emit(e){this._getLogger().emit(e)}_getLogger(){if(this._delegate)return this._delegate;const e=this._provider.getDelegateLogger(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):tg}},sg=class{getLogger(e,t,n){var r;return null!==(r=this.getDelegateLogger(e,t,n))&&void 0!==r?r:new rg(this,e,t,n)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:ng}setDelegate(e){this._delegate=e}getDelegateLogger(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(e,t,n)}};const og="object"==typeof globalThis?globalThis:global,ig=Symbol.for("io.opentelemetry.js.api.logs"),ag=og;const cg=class e{constructor(){this._proxyLoggerProvider=new sg}static getInstance(){return this._instance||(this._instance=new e),this._instance}setGlobalLoggerProvider(e){return ag[ig]?this.getLoggerProvider():(ag[ig]=(t=1,n=e,r=ng,e=>e===t?n:r),this._proxyLoggerProvider.setDelegate(e),e);var t,n,r}getLoggerProvider(){var e,t;return null!==(t=null===(e=ag[ig])||void 0===e?void 0:e.call(ag,1))&&void 0!==t?t:this._proxyLoggerProvider}getLogger(e,t,n){return this.getLoggerProvider().getLogger(e,t,n)}disable(){delete ag[ig],this._proxyLoggerProvider=new sg}}.getInstance();function ug(e){const t=e.tracerProvider||Ht.getTracerProvider(),n=e.meterProvider||Ct.getMeterProvider(),r=e.loggerProvider||cg.getLoggerProvider(),s=e.instrumentations?.flat()??[];return function(e,t,n,r){for(let s=0,o=e.length;s<o;s++){const o=e[s];t&&o.setTracerProvider(t),n&&o.setMeterProvider(n),r&&o.setLoggerProvider&&o.setLoggerProvider(r),o.getConfig().enabled||o.enable()}}(s,t,n,r),()=>{!function(e){e.forEach(e=>e.disable())}(s)}}const lg=/^(?:v)?(?<version>(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*))(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,pg=/^(?<op><|>|=|==|<=|>=|~|\^|~>)?\s*(?:v)?(?<version>(?<major>x|X|\*|0|[1-9]\d*)(?:\.(?<minor>x|X|\*|0|[1-9]\d*))?(?:\.(?<patch>x|X|\*|0|[1-9]\d*))?)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,dg={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]};function hg(e,t,n){if(!function(e){return"string"==typeof e&&lg.test(e)}(e))return At.error(`Invalid version: ${e}`),!1;if(!t)return!0;t=t.replace(/([<>=~^]+)\s+/g,"$1");const r=function(e){const t=e.match(lg);if(!t)return void At.error(`Invalid version: ${e}`);const n=t.groups.version,r=t.groups.prerelease,s=t.groups.build,o=n.split("."),i=r?.split(".");return{op:void 0,version:n,versionSegments:o,versionSegmentCount:o.length,prerelease:r,prereleaseSegments:i,prereleaseSegmentCount:i?i.length:0,build:s}}(e);if(!r)return!1;const s=[],o=mg(r,t,s,n);return o&&!n?.includePrerelease?function(e,t){if(e.prerelease)return t.some(t=>t.prerelease&&t.version===e.version);return!0}(r,s):o}function mg(e,t,n,r){if(t.includes("||")){const s=t.trim().split("||");for(const t of s)if(fg(e,t,n,r))return!0;return!1}if(t.includes(" - "))t=function(e,t){const n=Og;return e.replace(n,(e,n,r,s,o,i,a,c,u,l,p,d)=>`${n=_g(r)?"":_g(s)?`>=${r}.0.0${t?.includePrerelease?"-0":""}`:_g(o)?`>=${r}.${s}.0${t?.includePrerelease?"-0":""}`:i?`>=${n}`:`>=${n}${t?.includePrerelease?"-0":""}`} ${c=_g(u)?"":_g(l)?`<${+u+1}.0.0-0`:_g(p)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${p}-${d}`:t?.includePrerelease?`<${u}.${l}.${+p+1}-0`:`<=${c}`}`.trim())}(t,r);else if(t.includes(" ")){const s=t.trim().replace(/\s{2,}/g," ").split(" ");for(const t of s)if(!fg(e,t,n,r))return!1;return!0}return fg(e,t,n,r)}function fg(e,t,n,r){if(t=function(e,t){return e=e.trim(),e=function(e,t){const n=Pg,r=t?.includePrerelease?"-0":"";return e.replace(n,(e,t,n,s,o)=>{let i;return i=_g(t)?"":_g(n)?`>=${t}.0.0${r} <${+t+1}.0.0-0`:_g(s)?"0"===t?`>=${t}.${n}.0${r} <${t}.${+n+1}.0-0`:`>=${t}.${n}.0${r} <${+t+1}.0.0-0`:o?"0"===t?"0"===n?`>=${t}.${n}.${s}-${o} <${t}.${n}.${+s+1}-0`:`>=${t}.${n}.${s}-${o} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${s}-${o} <${+t+1}.0.0-0`:"0"===t?"0"===n?`>=${t}.${n}.${s}${r} <${t}.${n}.${+s+1}-0`:`>=${t}.${n}.${s}${r} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${s} <${+t+1}.0.0-0`,i})}(e,t),e=function(e){const t=Ig;return e.replace(t,(e,t,n,r,s)=>{let o;return o=_g(t)?"":_g(n)?`>=${t}.0.0 <${+t+1}.0.0-0`:_g(r)?`>=${t}.${n}.0 <${t}.${+n+1}.0-0`:s?`>=${t}.${n}.${r}-${s} <${t}.${+n+1}.0-0`:`>=${t}.${n}.${r} <${t}.${+n+1}.0-0`,o})}(e),e=function(e,t){const n=Cg;return e.replace(n,(e,n,r,s,o,i)=>{const a=_g(r),c=a||_g(s),u=c||_g(o),l=u;return"="===n&&l&&(n=""),i=t?.includePrerelease?"-0":"",a?e=">"===n||"<"===n?"<0.0.0-0":"*":n&&l?(c&&(s=0),o=0,">"===n?(n=">=",c?(r=+r+1,s=0,o=0):(s=+s+1,o=0)):"<="===n&&(n="<",c?r=+r+1:s=+s+1),"<"===n&&(i="-0"),e=`${n+r}.${s}.${o}${i}`):c?e=`>=${r}.0.0${i} <${+r+1}.0.0-0`:u&&(e=`>=${r}.${s}.0${i} <${r}.${+s+1}.0-0`),e})}(e,t),e=e.trim(),e}(t,r),t.includes(" "))return mg(e,t,n,r);{const r=function(e){if(!e)return{};const t=e.match(pg);if(!t)return At.error(`Invalid range: ${e}`),{invalid:!0};let n=t.groups.op;const r=t.groups.version,s=t.groups.prerelease,o=t.groups.build,i=r.split("."),a=s?.split(".");"=="===n&&(n="=");return{op:n||"=",version:r,versionSegments:i,versionSegmentCount:i.length,prerelease:s,prereleaseSegments:a,prereleaseSegmentCount:a?a.length:0,build:o}}(t);return n.push(r),function(e,t){if(t.invalid)return!1;if(!t.version||gg(t.version))return!0;let n=yg(e.versionSegments||[],t.versionSegments||[]);if(0===n){const r=e.prereleaseSegments||[],s=t.prereleaseSegments||[];n=r.length||s.length?!r.length&&s.length?1:r.length&&!s.length?-1:yg(r,s):0}return dg[t.op]?.includes(n)}(e,r)}}function _g(e){return!e||"x"===e.toLowerCase()||"*"===e}function gg(e){return"*"===e||"x"===e||"X"===e}function Eg(e){const t=parseInt(e,10);return isNaN(t)?e:t}function Sg(e,t){if(gg(e)||gg(t))return 0;const[n,r]=function(e,t){if(typeof e==typeof t){if("number"==typeof e)return[e,t];if("string"==typeof e)return[e,t];throw new Error("Version segments can only be strings or numbers")}return[String(e),String(t)]}(Eg(e),Eg(t));return n>r?1:n<r?-1:0}function yg(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const r=Sg(e[n]||"0",t[n]||"0");if(0!==r)return r}return 0}const Tg="[a-zA-Z0-9-]",bg="0|[1-9]\\d*",Ag=`(?:${bg}|${`\\d*[a-zA-Z-]${Tg}*`})`,Rg=`${Tg}+`,vg=`${bg}|x|X|\\*`,Ng=`[v=\\s]*(${vg})(?:\\.(${vg})(?:\\.(${vg})(?:${`(?:-(${Ag}(?:\\.${Ag})*))`})?${`(?:\\+(${Rg}(?:\\.${Rg})*))`}?)?)?`,Cg=new RegExp(`^((?:<|>)?=?)\\s*${Ng}$`),Og=new RegExp(`^\\s*(${Ng})\\s+-\\s+(${Ng})\\s*$`),Ig=new RegExp(`^(?:~>?)${Ng}$`),Pg=new RegExp(`^(?:\\^)${Ng}$`);let Lg=console.error.bind(console);function wg(e,t,n){const r=!!e[t]&&Object.prototype.propertyIsEnumerable.call(e,t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}const Mg=(e,t,n)=>{if(!e||!e[t])return void Lg("no original function "+String(t)+" to wrap");if(!n)return Lg("no wrapper function"),void Lg((new Error).stack);const r=e[t];if("function"!=typeof r||"function"!=typeof n)return void Lg("original object and wrapper must be functions");const s=n(r,t);return wg(s,"__original",r),wg(s,"__unwrap",()=>{e[t]===s&&wg(e,t,r)}),wg(s,"__wrapped",!0),wg(e,t,s),s},xg=(e,t,n)=>{if(!e)return Lg("must provide one or more modules to patch"),void Lg((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{Mg(e,t,n)})}):Lg("must provide one or more functions to wrap on modules")},kg=(e,t)=>{if(!e||!e[t])return Lg("no function to unwrap."),void Lg((new Error).stack);const n=e[t];n.__unwrap?n.__unwrap():Lg("no original to unwrap to -- has "+String(t)+" already been unwrapped?")},Gg=(e,t)=>{if(!e)return Lg("must provide one or more modules to patch"),void Lg((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{kg(e,t)})}):Lg("must provide one or more functions to unwrap on modules")};let Dg=class{instrumentationName;instrumentationVersion;_config={};_tracer;_meter;_logger;_diag;constructor(e,t,n){this.instrumentationName=e,this.instrumentationVersion=t,this.setConfig(n),this._diag=At.createComponentLogger({namespace:e}),this._tracer=Ht.getTracer(e,t),this._meter=Ct.getMeter(e,t),this._logger=cg.getLogger(e,t),this._updateMetricInstruments()}_wrap=Mg;_unwrap=kg;_massWrap=xg;_massUnwrap=Gg;get meter(){return this._meter}setMeterProvider(e){this._meter=e.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(e){this._logger=e.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){const e=this.init()??[];return Array.isArray(e)?e:[e]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(e){this._config={enabled:!0,...e}}setTracerProvider(e){this._tracer=e.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(e,t,n,r){if(e)try{e(n,r)}catch(e){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:t},e)}}};var Vg,Ug,Hg,jg,Zg,Wg={exports:{}},Xg={exports:{}},$g={exports:{}};function Fg(){if(Ug)return Vg;Ug=1;var e=1e3,t=60*e,n=60*t,r=24*n,s=7*r,o=365.25*r;function i(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}return Vg=function(a,c){c=c||{};var u=typeof a;if("string"===u&&a.length>0)return function(i){if((i=String(i)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(a);if("number"===u&&isFinite(a))return c.long?function(s){var o=Math.abs(s);if(o>=r)return i(s,o,r,"day");if(o>=n)return i(s,o,n,"hour");if(o>=t)return i(s,o,t,"minute");if(o>=e)return i(s,o,e,"second");return s+" ms"}(a):function(s){var o=Math.abs(s);if(o>=r)return Math.round(s/r)+"d";if(o>=n)return Math.round(s/n)+"h";if(o>=t)return Math.round(s/t)+"m";if(o>=e)return Math.round(s/e)+"s";return s+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},Vg}function Yg(){if(jg)return Hg;return jg=1,Hg=function(e){function t(e){let r,s,o,i=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),o=s-(r||s);n.diff=o,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return"%";i++;const o=t.formatters[s];if("function"==typeof o){const t=e[i];r=o.call(n,t),e.splice(i,1),i--}return r}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(s!==t.namespaces&&(s=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e,t){let n=0,r=0,s=-1,o=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(s=r,o=n,r++):(n++,r++);else{if(-1===s)return!1;r=s+1,o++,n=o}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=Fg(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Hg}var Bg,Kg={exports:{}};"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?Xg.exports=(Zg||(Zg=1,function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Yg()(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}($g,$g.exports)),$g.exports):Xg.exports=(Bg||(Bg=1,function(e,t){const n=c,r=s;t.init=function(e){e.inspectOpts={};const n=Object.keys(t.inspectOpts);for(let r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(n){const{namespace:r,useColors:s}=this;if(s){const t=this.color,s="[3"+(t<8?t:"8;5;"+t),o=`  ${s};1m${r} [0m`;n[0]=o+n[0].split("\n").join("\n"+o),n.push(s+"m+"+e.exports.humanize(this.diff)+"[0m")}else n[0]=(t.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+r+" "+n[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=require("supports-color");e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{}),e.exports=Yg()(t);const{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}}(Kg,Kg.exports)),Kg.exports);var Jg,zg,Qg,qg,eE=Xg.exports,tE=t.sep,nE=function(e){var t=e.split(tE),n=t.lastIndexOf("node_modules");if(-1!==n&&t[n+1]){for(var r="@"===t[n+1][0],s=r?t[n+1]+"/"+t[n+2]:t[n+1],o=r?3:2,i="",a=n+o-1,c=0;c<=a;c++)i+=c===a?t[c]:t[c]+tE;for(var u="",l=t.length-1,p=n+o;p<=l;p++)u+=p===l?t[p]:t[p]+tE;return{name:s,basedir:i,path:u}}};function rE(){return zg?Jg:(zg=1,Jg=n.homedir||function(){var e=process.env.HOME,t=process.env.LOGNAME||process.env.USER||process.env.LNAME||process.env.USERNAME;return"win32"===process.platform?process.env.USERPROFILE||process.env.HOMEDRIVE+process.env.HOMEPATH||e||null:"darwin"===process.platform?e||(t?"/Users/"+t:null):"linux"===process.platform?e||(0===process.getuid()?"/root":t?"/home/"+t:null):e||null})}function sE(){return qg?Qg:(qg=1,Qg=function(){var e=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t};var t=(new Error).stack;return Error.prepareStackTrace=e,t[2].getFileName()})}var oE,iE,aE,cE,uE,lE,pE,dE,hE,mE,fE,_E={exports:{}};function gE(){if(oE)return _E.exports;oE=1;var e="win32"===process.platform,t=/^(((?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?[\\\/]?)(?:[^\\\/]*[\\\/])*)((\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))[\\\/]*$/,n={};n.parse=function(e){if("string"!=typeof e)throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var n,r=(n=e,t.exec(n).slice(1));if(!r||5!==r.length)throw new TypeError("Invalid path '"+e+"'");return{root:r[1],dir:r[0]===r[1]?r[0]:r[0].slice(0,-1),base:r[2],ext:r[4],name:r[3]}};var r=/^((\/?)(?:[^\/]*\/)*)((\.{1,2}|[^\/]+?|)(\.[^.\/]*|))[\/]*$/,s={};return s.parse=function(e){if("string"!=typeof e)throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t,n=(t=e,r.exec(t).slice(1));if(!n||5!==n.length)throw new TypeError("Invalid path '"+e+"'");return{root:n[1],dir:n[0].slice(0,-1),base:n[2],ext:n[4],name:n[3]}},_E.exports=e?n.parse:s.parse,_E.exports.posix=s.parse,_E.exports.win32=n.parse,_E.exports}function EE(){if(aE)return iE;aE=1;var e=t,n=e.parse||gE(),r=function(t,r){var s="/";/^([A-Za-z]:)/.test(t)?s="":/^\\\\/.test(t)&&(s="\\\\");for(var o=[t],i=n(t);i.dir!==o[o.length-1];)o.push(i.dir),i=n(i.dir);return o.reduce(function(t,n){return t.concat(r.map(function(t){return e.resolve(s,n,t)}))},[])};return iE=function(e,t,n){var s=t&&t.moduleDirectory?[].concat(t.moduleDirectory):["node_modules"];if(t&&"function"==typeof t.paths)return t.paths(n,e,function(){return r(e,s)},t);var o=r(e,s);return t&&t.paths?o.concat(t.paths):o}}function SE(){return uE?cE:(uE=1,cE=function(e,t){return t||{}})}function yE(){if(pE)return lE;pE=1;var e=Object.prototype.toString,t=Math.max,n=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var s=0;s<t.length;s+=1)n[s+e.length]=t[s];return n};return lE=function(r){var s=this;if("function"!=typeof s||"[object Function]"!==e.apply(s))throw new TypeError("Function.prototype.bind called on incompatible "+s);for(var o,i=function(e,t){for(var n=[],r=t||0,s=0;r<e.length;r+=1,s+=1)n[s]=e[r];return n}(arguments,1),a=t(0,s.length-i.length),c=[],u=0;u<a;u++)c[u]="$"+u;if(o=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(c,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var e=s.apply(this,n(i,arguments));return Object(e)===e?e:this}return s.apply(r,n(i,arguments))}),s.prototype){var l=function(){};l.prototype=s.prototype,o.prototype=new l,l.prototype=null}return o},lE}function TE(){if(fE)return mE;fE=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,n=function(){if(hE)return dE;hE=1;var e=yE();return dE=Function.prototype.bind||e}();return mE=n.call(e,t)}var bE,AE,RE,vE,NE={assert:!0,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:">= 8","node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:">= 0.5 && < 0.9.7",buffer:!0,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:!0,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:">= 0.5","node:cluster":[">= 14.18 && < 15",">= 16"],console:!0,"node:console":[">= 14.18 && < 15",">= 16"],constants:!0,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:!0,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:">= 1 && < 8",_debugger:"< 8",dgram:!0,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:[">= 14.17 && < 15",">= 15.1"],"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:!0,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:">= 0.7.12","node:domain":[">= 14.18 && < 15",">= 16"],events:!0,"node:events":[">= 14.18 && < 15",">= 16"],freelist:"< 6",fs:!0,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:">= 0.11.1","node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:">= 0.11.1","node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:">= 0.11.1","node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:">= 0.11.1","node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:">= 0.11.1","node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:">= 0.11.1","node:_http_server":[">= 14.18 && < 15",">= 16"],http:!0,"node:http":[">= 14.18 && < 15",">= 16"],http2:">= 8.8","node:http2":[">= 14.18 && < 15",">= 16"],https:!0,"node:https":[">= 14.18 && < 15",">= 16"],inspector:">= 8","node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:"< 8",module:!0,"node:module":[">= 14.18 && < 15",">= 16"],net:!0,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:!0,"node:os":[">= 14.18 && < 15",">= 16"],path:!0,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:">= 8.5","node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:">= 1","node:process":[">= 14.18 && < 15",">= 16"],punycode:">= 0.5","node:punycode":[">= 14.18 && < 15",">= 16"],querystring:!0,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:!0,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:!0,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:">= 0.11.5 && < 3","node:sqlite":[">= 22.13 && < 23",">= 23.4"],_stream_duplex:">= 0.9.4","node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:">= 0.9.4","node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:">= 1.4.1","node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:">= 0.9.4","node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:">= 0.9.4","node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:">= 0.9.4","node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:!0,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:!0,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:[">= 0.4 && < 0.7",">= 0.8"],"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:!0,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:">= 0.11.13","node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:">= 0.11.3 && < 10",_tls_wrap:">= 0.11.3","node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:!0,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:">= 10","node:trace_events":[">= 14.18 && < 15",">= 16"],tty:!0,"node:tty":[">= 14.18 && < 15",">= 16"],url:!0,"node:url":[">= 14.18 && < 15",">= 16"],util:!0,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:">= 1","node:v8":[">= 14.18 && < 15",">= 16"],vm:!0,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:">= 11.7","node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:">= 0.5","node:zlib":[">= 14.18 && < 15",">= 16"]};function CE(){if(AE)return bE;AE=1;var e=TE();function t(e,t){for(var n=e.split("."),r=t.split(" "),s=r.length>1?r[0]:"=",o=(r.length>1?r[1]:r[0]).split("."),i=0;i<3;++i){var a=parseInt(n[i]||0,10),c=parseInt(o[i]||0,10);if(a!==c)return"<"===s?a<c:">="===s&&a>=c}return">="===s}function n(e,n){var r=n.split(/ ?&& ?/);if(0===r.length)return!1;for(var s=0;s<r.length;++s)if(!t(e,r[s]))return!1;return!0}var r=NE;return bE=function(t,s){return e(r,t)&&function(e,t){if("boolean"==typeof t)return t;var r=void 0===e?process.versions&&process.versions.node:e;if("string"!=typeof r)throw new TypeError(void 0===e?"Unable to determine current node version":"If provided, a valid node version is required");if(t&&"object"==typeof t){for(var s=0;s<t.length;++s)if(n(r,t[s]))return!0;return!1}return n(r,t)}(s,r[t])}}function OE(){if(vE)return RE;vE=1;var n=e,r=rE(),s=t,o=sE(),i=EE(),a=SE(),c=CE(),u="win32"!==process.platform&&n.realpath&&"function"==typeof n.realpath.native?n.realpath.native:n.realpath,l=r(),p=function(e,t){n.stat(e,function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?t(null,!1):t(e):t(null,n.isFile()||n.isFIFO())})},d=function(e,t){n.stat(e,function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?t(null,!1):t(e):t(null,n.isDirectory())})},h=function(e,t){u(e,function(n,r){n&&"ENOENT"!==n.code?t(n):t(null,n?e:r)})},m=function(e,t,n,r){n&&!1===n.preserveSymlinks?e(t,r):r(null,t)},f=function(e,t,n){e(t,function(e,t){if(e)n(e);else try{var r=JSON.parse(t);n(null,r)}catch(e){n(null)}})};return RE=function(e,t,r){var u=r,_=t;if("function"==typeof t&&(u=_,_={}),"string"!=typeof e){var g=new TypeError("Path must be a string.");return process.nextTick(function(){u(g)})}var E=(_=a(e,_)).isFile||p,S=_.isDirectory||d,y=_.readFile||n.readFile,T=_.realpath||h,b=_.readPackage||f;if(_.readFile&&_.readPackage){var A=new TypeError("`readFile` and `readPackage` are mutually exclusive.");return process.nextTick(function(){u(A)})}var R=_.packageIterator,v=_.extensions||[".js"],N=!1!==_.includeCoreModules,C=_.basedir||s.dirname(o()),O=_.filename||C;_.paths=_.paths||[s.join(l,".node_modules"),s.join(l,".node_libraries")];var I,P=s.resolve(C);function L(t,n,r){t?u(t):n?u(null,n,r):x(I,function(t,n,r){if(t)u(t);else if(n)m(T,n,_,function(e,t){e?u(e):u(null,t,r)});else{var s=new Error("Cannot find module '"+e+"' from '"+O+"'");s.code="MODULE_NOT_FOUND",u(s)}})}function w(e,t,n){var r=t,o=n;"function"==typeof r&&(o=r,r=void 0),function e(t,n,r){if(0===t.length)return o(null,void 0,r);var i=n+t[0],a=r;a?c(null,a):M(s.dirname(i),c);function c(r,c,l){if(a=c,r)return o(r);if(l&&a&&_.pathFilter){var p=s.relative(l,i),d=p.slice(0,p.length-t[0].length),h=_.pathFilter(a,n,d);if(h)return e([""].concat(v.slice()),s.resolve(l,h),a)}E(i,u)}function u(r,s){return r?o(r):s?o(null,i,a):void e(t.slice(1),n,a)}}([""].concat(v),e,r)}function M(e,t){return""===e||"/"===e||"win32"===process.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e)?t(null):void m(T,e,_,function(n,r){if(n)return M(s.dirname(e),t);var o=s.join(r,"package.json");E(o,function(n,r){if(!r)return M(s.dirname(e),t);b(y,o,function(n,r){n&&t(n);var s=r;s&&_.packageFilter&&(s=_.packageFilter(s,o)),t(null,s,e)})})})}function x(e,t,n){var r=n,o=t;"function"==typeof o&&(r=o,o=_.package),m(T,e,_,function(t,n){if(t)return r(t);var i=s.join(n,"package.json");E(i,function(t,n){return t?r(t):n?void b(y,i,function(t,n){if(t)return r(t);var o=n;if(o&&_.packageFilter&&(o=_.packageFilter(o,i)),o&&o.main){if("string"!=typeof o.main){var a=new TypeError("package “"+o.name+"” `main` must be a string");return a.code="INVALID_PACKAGE_MAIN",r(a)}return"."!==o.main&&"./"!==o.main||(o.main="index"),void w(s.resolve(e,o.main),o,function(t,n,o){return t?r(t):n?r(null,n,o):o?void x(s.resolve(e,o.main),o,function(t,n,o){return t?r(t):n?r(null,n,o):void w(s.join(e,"index"),o,r)}):w(s.join(e,"index"),o,r)})}w(s.join(e,"/index"),o,r)}):w(s.join(e,"index"),o,r)})})}function k(e,t){if(0===t.length)return e(null,void 0);var n=t[0];function r(t,r,s){return t?e(t):r?e(null,r,s):void x(n,_.package,o)}function o(n,r,s){return n?e(n):r?e(null,r,s):void k(e,t.slice(1))}S(s.dirname(n),function(s,o){if(s)return e(s);if(!o)return k(e,t.slice(1));w(n,_.package,r)})}m(T,P,_,function(t,n){t?u(t):function(t){if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e))I=s.resolve(t,e),"."!==e&&".."!==e&&"/"!==e.slice(-1)||(I+="/"),/\/$/.test(e)&&I===t?x(I,_.package,L):w(I,_.package,L);else{if(N&&c(e))return u(null,e);!function(e,t,n){var r=function(){return function(e,t,n){for(var r=i(t,n,e),o=0;o<r.length;o++)r[o]=s.join(r[o],e);return r}(e,t,_)};k(n,R?R(e,t,r,_):r())}(e,t,function(t,n,r){if(t)u(t);else{if(n)return m(T,n,_,function(e,t){e?u(e):u(null,t,r)});var s=new Error("Cannot find module '"+e+"' from '"+O+"'");s.code="MODULE_NOT_FOUND",u(s)}})}}(n)})}}var IE,PE,LE,wE,ME,xE,kE,GE,DE={assert:!0,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:">= 8","node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:">= 0.5 && < 0.9.7",buffer:!0,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:!0,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:">= 0.5","node:cluster":[">= 14.18 && < 15",">= 16"],console:!0,"node:console":[">= 14.18 && < 15",">= 16"],constants:!0,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:!0,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:">= 1 && < 8",_debugger:"< 8",dgram:!0,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:[">= 14.17 && < 15",">= 15.1"],"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:!0,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:">= 0.7.12","node:domain":[">= 14.18 && < 15",">= 16"],events:!0,"node:events":[">= 14.18 && < 15",">= 16"],freelist:"< 6",fs:!0,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:">= 0.11.1","node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:">= 0.11.1","node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:">= 0.11.1","node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:">= 0.11.1","node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:">= 0.11.1","node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:">= 0.11.1","node:_http_server":[">= 14.18 && < 15",">= 16"],http:!0,"node:http":[">= 14.18 && < 15",">= 16"],http2:">= 8.8","node:http2":[">= 14.18 && < 15",">= 16"],https:!0,"node:https":[">= 14.18 && < 15",">= 16"],inspector:">= 8","node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:"< 8",module:!0,"node:module":[">= 14.18 && < 15",">= 16"],net:!0,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:!0,"node:os":[">= 14.18 && < 15",">= 16"],path:!0,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:">= 8.5","node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:">= 1","node:process":[">= 14.18 && < 15",">= 16"],punycode:">= 0.5","node:punycode":[">= 14.18 && < 15",">= 16"],querystring:!0,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:!0,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:!0,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:">= 0.11.5 && < 3","node:sqlite":">= 23.4",_stream_duplex:">= 0.9.4","node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:">= 0.9.4","node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:">= 1.4.1","node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:">= 0.9.4","node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:">= 0.9.4","node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:">= 0.9.4","node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:!0,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:!0,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:[">= 0.4 && < 0.7",">= 0.8"],"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:!0,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:">= 0.11.13","node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:">= 0.11.3 && < 10",_tls_wrap:">= 0.11.3","node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:!0,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:">= 10","node:trace_events":[">= 14.18 && < 15",">= 16"],tty:!0,"node:tty":[">= 14.18 && < 15",">= 16"],url:!0,"node:url":[">= 14.18 && < 15",">= 16"],util:!0,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:">= 1","node:v8":[">= 14.18 && < 15",">= 16"],vm:!0,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:">= 11.7","node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:">= 0.5","node:zlib":[">= 14.18 && < 15",">= 16"]};function VE(){if(xE)return ME;xE=1;var n=CE(),r=e,s=t,o=rE(),i=sE(),a=EE(),c=SE(),u="win32"!==process.platform&&r.realpathSync&&"function"==typeof r.realpathSync.native?r.realpathSync.native:r.realpathSync,l=o(),p=function(e){try{var t=r.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!t&&(t.isFile()||t.isFIFO())},d=function(e){try{var t=r.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!t&&t.isDirectory()},h=function(e){try{return u(e)}catch(e){if("ENOENT"!==e.code)throw e}return e},m=function(e,t,n){return n&&!1===n.preserveSymlinks?e(t):t},f=function(e,t){var n=e(t);try{return JSON.parse(n)}catch(e){}};return ME=function(e,t){if("string"!=typeof e)throw new TypeError("Path must be a string.");var o=c(e,t),u=o.isFile||p,_=o.readFileSync||r.readFileSync,g=o.isDirectory||d,E=o.realpathSync||h,S=o.readPackageSync||f;if(o.readFileSync&&o.readPackageSync)throw new TypeError("`readFileSync` and `readPackageSync` are mutually exclusive.");var y=o.packageIterator,T=o.extensions||[".js"],b=!1!==o.includeCoreModules,A=o.basedir||s.dirname(i()),R=o.filename||A;o.paths=o.paths||[s.join(l,".node_modules"),s.join(l,".node_libraries")];var v=m(E,s.resolve(A),o);if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e)){var N=s.resolve(v,e);"."!==e&&".."!==e&&"/"!==e.slice(-1)||(N+="/");var C=P(N)||w(N);if(C)return m(E,C,o)}else{if(b&&n(e))return e;var O=function(e,t){for(var n=function(){return function(e,t,n){for(var r=a(t,n,e),o=0;o<r.length;o++)r[o]=s.join(r[o],e);return r}(e,t,o)},r=y?y(e,t,n,o):n(),i=0;i<r.length;i++){var c=r[i];if(g(s.dirname(c))){var u=P(c);if(u)return u;var l=w(c);if(l)return l}}}(e,v);if(O)return m(E,O,o)}var I=new Error("Cannot find module '"+e+"' from '"+R+"'");throw I.code="MODULE_NOT_FOUND",I;function P(e){var t=L(s.dirname(e));if(t&&t.dir&&t.pkg&&o.pathFilter){var n=s.relative(t.dir,e),r=o.pathFilter(t.pkg,e,n);r&&(e=s.resolve(t.dir,r))}if(u(e))return e;for(var i=0;i<T.length;i++){var a=e+T[i];if(u(a))return a}}function L(e){if(""!==e&&"/"!==e&&!("win32"===process.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e))){var t=s.join(m(E,e,o),"package.json");if(!u(t))return L(s.dirname(e));var n=S(_,t);return n&&o.packageFilter&&(n=o.packageFilter(n,e)),{pkg:n,dir:e}}}function w(e){var t=s.join(m(E,e,o),"/package.json");if(u(t)){try{var n=S(_,t)}catch(e){}if(n&&o.packageFilter&&(n=o.packageFilter(n,e)),n&&n.main){if("string"!=typeof n.main){var r=new TypeError("package “"+n.name+"” `main` must be a string");throw r.code="INVALID_PACKAGE_MAIN",r}"."!==n.main&&"./"!==n.main||(n.main="index");try{var i=P(s.resolve(e,n.main));if(i)return i;var a=w(s.resolve(e,n.main));if(a)return a}catch(e){}}}return P(s.join(e,"/index"))}}}function UE(){if(GE)return kE;GE=1;var e=OE();return e.core=function(){if(PE)return IE;PE=1;var e=CE(),t=DE,n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=e(r));return IE=n}(),e.isCore=function(){if(wE)return LE;wE=1;var e=CE();return LE=function(t){return e(t)}}(),e.sync=VE(),kE=e}var HE={url:"https://github.com/nodejs/require-in-the-middle/issues"};const jE=t,ZE=a,WE=eE("require-in-the-middle"),XE=nE;Wg.exports=zE;var $E=Wg.exports.Hook=zE;let FE,YE,BE;if(ZE.isBuiltin)YE=ZE.isBuiltin;else if(ZE.builtinModules)YE=e=>!!e.startsWith("node:")||(void 0===FE&&(FE=new Set(ZE.builtinModules)),FE.has(e));else{const e=UE(),[t,n]=process.versions.node.split(".").map(Number);YE=8===t&&n<8?t=>"http2"===t||!!e.core[t]:t=>!!e.core[t]}const KE=/([/\\]index)?(\.js)?$/;class JE{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(e,t){if(this._localCache.has(e))return!0;if(t)return!1;{const t=require.cache[e];return!(!t||!(this._kRitmExports in t))}}get(e,t){const n=this._localCache.get(e);if(void 0!==n)return n;if(!t){const t=require.cache[e];return t&&t[this._kRitmExports]}}set(e,t,n){n?this._localCache.set(e,t):e in require.cache?require.cache[e][this._kRitmExports]=t:(WE('non-core module is unexpectedly not in require.cache: "%s"',e),this._localCache.set(e,t))}}function zE(e,t,n){if(this instanceof zE==!1)return new zE(e,t,n);if("function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),"function"!=typeof ZE._resolveFilename)return console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof ZE._resolveFilename),void console.error("Please report this error as an issue related to Node.js %s at %s",process.version,HE.url);this._cache=new JE,this._unhooked=!1,this._origRequire=ZE.prototype.require;const r=this,s=new Set,o=!!t&&!0===t.internals,i=Array.isArray(e);function a(t,a){const c=t[0],u=YE(c);let l,p,d;if(u){if(l=c,c.startsWith("node:")){const e=c.slice(5);YE(e)&&(l=e)}}else{if(a)return WE("call to process.getBuiltinModule with unknown built-in id"),r._origGetBuiltinModule.apply(this,t);try{l=ZE._resolveFilename(c,this)}catch(e){return WE('Module._resolveFilename("%s") threw %j, calling original Module.require',c,e.message),r._origRequire.apply(this,t)}}if(WE("processing %s module require('%s'): %s",!0===u?"core":"non-core",c,l),!0===r._cache.has(l,u))return WE("returning already patched cached module: %s",l),r._cache.get(l,u);const h=s.has(l);!1===h&&s.add(l);const m=a?r._origGetBuiltinModule.apply(this,t):r._origRequire.apply(this,t);if(!0===h)return WE("module is in the process of being patched already - ignoring: %s",l),m;if(s.delete(l),!0===u){if(!0===i&&!1===e.includes(l))return WE("ignoring core module not on whitelist: %s",l),m;p=l}else if(!0===i&&e.includes(l)){const e=jE.parse(l);p=e.name,d=e.dir}else{const t=XE(l);if(void 0===t)return WE("could not parse filename: %s",l),m;p=t.name,d=t.basedir;const n=function(e){const t="/"!==jE.sep?e.path.split(jE.sep).join("/"):e.path;return jE.posix.join(e.name,t).replace(KE,"")}(t);WE("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",p,c,n,d);let s=!1;if(i){if(!c.startsWith(".")&&e.includes(c)&&(p=c,s=!0),!e.includes(p)&&!e.includes(n))return m;e.includes(n)&&n!==p&&(p=n,s=!0)}if(!s){let e;try{e=function(e,t){if(!BE)if(require.resolve&&require.resolve.paths)BE=function(e,t){return require.resolve(e,{paths:[t]})};else{const e=UE();BE=function(t,n){return e.sync(t,{basedir:n})}}return BE(e,t)}(p,d)}catch(e){return WE("could not resolve module: %s",p),r._cache.set(l,m,u),m}if(e!==l){if(!0!==o)return WE("ignoring require of non-main module file: %s",e),r._cache.set(l,m,u),m;p=p+jE.sep+jE.relative(d,l),WE("preparing to process require of internal file: %s",p)}}}r._cache.set(l,m,u),WE("calling require hook: %s",p);const f=n(m,p,d);return r._cache.set(l,f,u),WE("returning module: %s",p),f}WE("registering require hook"),this._require=ZE.prototype.require=function(e){return!0===r._unhooked?(WE("ignoring require call - module is soft-unhooked"),r._origRequire.apply(this,arguments)):a.call(this,arguments,!1)},"function"==typeof process.getBuiltinModule&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(e){return!0===r._unhooked?(WE("ignoring process.getBuiltinModule call - module is soft-unhooked"),r._origGetBuiltinModule.apply(this,arguments)):a.call(this,arguments,!0)})}zE.prototype.unhook=function(){this._unhooked=!0,this._require===ZE.prototype.require?(ZE.prototype.require=this._origRequire,WE("require unhook successful")):WE("require unhook unsuccessful"),void 0!==process.getBuiltinModule&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,WE("process.getBuiltinModule unhook successful")):WE("process.getBuiltinModule unhook unsuccessful"))};const QE="/";let qE=class{hooks=[];children=new Map},eS=class{_trie=new qE;_counter=0;insert(e){let t=this._trie;for(const n of e.moduleName.split(QE)){let e=t.children.get(n);e||(e=new qE,t.children.set(n,e)),t=e}t.hooks.push({hook:e,insertedId:this._counter++})}search(e,{maintainInsertionOrder:t,fullOnly:n}={}){let r=this._trie;const s=[];let o=!0;for(const t of e.split(QE)){const e=r.children.get(t);if(!e){o=!1;break}n||s.push(...e.hooks),r=e}return n&&o&&s.push(...r.hooks),0===s.length?[]:1===s.length?[s[0].hook]:(t&&s.sort((e,t)=>e.insertedId-t.insertedId),s.map(({hook:e})=>e))}};const tS=["afterEach","after","beforeEach","before","describe","it"].every(e=>"function"==typeof global[e]);let nS=class e{_moduleNameTrie=new eS;static _instance;constructor(){this._initialize()}_initialize(){new $E(null,{internals:!0},(e,t,n)=>{const r=(s=t,O.sep!==QE?s.split(O.sep).join(QE):s);var s;const o=this._moduleNameTrie.search(r,{maintainInsertionOrder:!0,fullOnly:void 0===n});for(const{onRequire:r}of o)e=r(e,t,n);return e})}register(e,t){const n={moduleName:e,onRequire:t};return this._moduleNameTrie.insert(n),n}static getInstance(){return tS?new e:this._instance=this._instance??new e}};var rS={exports:{}},sS={};const oS=[],iS=new WeakMap,aS=new WeakMap,cS=new Map,uS=[],lS={set:(e,t,n)=>iS.get(e)[t](n),get(e,t){if(t===Symbol.toStringTag)return"Module";const n=aS.get(e)[t];return"function"==typeof n?n():void 0},defineProperty(e,t,n){if(!("value"in n))throw new Error("Getters/setters are not supported for exports property descriptors.");return iS.get(e)[t](n.value)}};let pS=!1;sS.register=function(e,t,n,r,s){cS.set(e,s),iS.set(t,n),aS.set(t,r);const o=new Proxy(t,lS);oS.forEach(t=>t(e,o)),uS.push([e,o])},sS.importHooks=oS,sS.specifiers=cS,sS.toHook=uS,sS.getExperimentalPatchInternals=function(){return pS},sS.setExperimentalPatchInternals=function(e){pS=e};const dS=t,hS=nE,{fileURLToPath:mS}=i,{MessageChannel:fS}=u,{importHooks:_S,specifiers:gS,toHook:ES,getExperimentalPatchInternals:SS}=sS;function yS(e){_S.push(e),ES.forEach(([t,n])=>e(t,n))}function TS(e){const t=_S.indexOf(e);t>-1&&_S.splice(t,1)}function bS(e,t,n,r){const s=e(t,n,r);s&&s!==t&&(t.default=s)}let AS;function RS(e,t,n){if(this instanceof RS==!1)return new RS(e,t,n);"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null);const r=!!t&&!0===t.internals;AS&&Array.isArray(e)&&AS(e),this._iitmHook=(t,s)=>{const o=t;let i;if(t.startsWith("node:"))t=t.replace(/^node:/,"");else{if(t.startsWith("file://"))try{t=mS(t)}catch(e){}const e=hS(t);e&&(t=e.name,i=e.basedir)}if(e){for(const a of e)if(a===t){if(i)if(r)t=t+dS.sep+dS.relative(i,mS(o));else if(!SS()&&!i.endsWith(gS.get(o)))continue;bS(n,s,t,i)}}else bS(n,s,t,i)},yS(this._iitmHook)}RS.prototype.unhook=function(){TS(this._iitmHook)},rS.exports=RS;var vS=rS.exports.Hook=RS;rS.exports.addHook=yS,rS.exports.removeHook=TS;var NS=rS.exports.createAddHookMessageChannel=function(){const{port1:e,port2:t}=new fS;let n,r=0;return AS=t=>{r++,e.postMessage(t)},e.on("message",()=>{r--,n&&r<=0&&n()}).unref(),{registerOptions:{data:{addHookMessagePort:t,include:[]},transferList:[t]},addHookMessagePort:t,waitForAllMessagesAcknowledged:function(){const e=setInterval(()=>{},1e3),t=new Promise(e=>{n=e}).then(()=>{clearInterval(e)});return 0===r&&n(),t}}};function CS(e,t,n){let r,s;try{s=e()}catch(e){r=e}finally{if(t(r,s),r&&!n)throw r;return s}}function OS(e){return"function"==typeof e&&"function"==typeof e.__original&&"function"==typeof e.__unwrap&&!0===e.__wrapped}let IS=class extends Dg{_modules;_hooks=[];_requireInTheMiddleSingleton=nS.getInstance();_enabled=!1;constructor(e,t,n){super(e,t,n);let r=this.init();r&&!Array.isArray(r)&&(r=[r]),this._modules=r||[],this._config.enabled&&this.enable()}_wrap=(e,t,n)=>{if(OS(e[t])&&this._unwrap(e,t),s.types.isProxy(e)){const r=Mg(Object.assign({},e),t,n);return Object.defineProperty(e,t,{value:r}),r}return Mg(e,t,n)};_unwrap=(e,t)=>s.types.isProxy(e)?Object.defineProperty(e,t,{value:e[t]}):kg(e,t);_massWrap=(e,t,n)=>{e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{this._wrap(e,t,n)})}):At.error("must provide one or more functions to wrap on modules")):At.error("must provide one or more modules to patch")};_massUnwrap=(e,t)=>{e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(e=>{t.forEach(t=>{this._unwrap(e,t)})}):At.error("must provide one or more functions to wrap on modules")):At.error("must provide one or more modules to patch")};_warnOnPreloadedModules(){this._modules.forEach(e=>{const{name:t}=e;try{const e=require.resolve(t);require.cache[e]&&this._diag.warn(`Module ${t} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${t}`)}catch{}})}_extractPackageVersion(t){try{const n=e.readFileSync(O.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return"string"==typeof r?r:void 0}catch{At.warn("Failed extracting version",t)}}_onRequire(e,t,n,r){if(!r)return"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:e.name}),e.patch(t)):t;const s=this._extractPackageVersion(r);if(e.moduleVersion=s,e.name===n)return PS(e.supportedVersions,s,e.includePrerelease)&&"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:e.name,version:e.moduleVersion,baseDir:r}),e.patch(t,e.moduleVersion)):t;const o=e.files??[],i=O.normalize(n);return o.filter(e=>e.name===i).filter(t=>PS(t.supportedVersions,s,e.includePrerelease)).reduce((t,n)=>(n.moduleExports=t,this._enabled?(this._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:e.name,version:e.moduleVersion,fileName:n.name,baseDir:r}),n.patch(t,e.moduleVersion)):t),t)}enable(){if(!this._enabled)if(this._enabled=!0,this._hooks.length>0)for(const e of this._modules){"function"==typeof e.patch&&e.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:e.name,version:e.moduleVersion}),e.patch(e.moduleExports,e.moduleVersion));for(const t of e.files)t.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:e.name,version:e.moduleVersion,fileName:t.name}),t.patch(t.moduleExports,e.moduleVersion))}else{this._warnOnPreloadedModules();for(const e of this._modules){const t=(t,n,r)=>{if(!r&&O.isAbsolute(n)){const e=O.parse(n);n=e.name,r=e.dir}return this._onRequire(e,t,n,r)},n=(t,n,r)=>this._onRequire(e,t,n,r),r=O.isAbsolute(e.name)?new $E([e.name],{internals:!0},n):this._requireInTheMiddleSingleton.register(e.name,n);this._hooks.push(r);const s=new vS([e.name],{internals:!1},t);this._hooks.push(s)}}}disable(){if(this._enabled){this._enabled=!1;for(const e of this._modules){"function"==typeof e.unpatch&&e.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:e.name,version:e.moduleVersion}),e.unpatch(e.moduleExports,e.moduleVersion));for(const t of e.files)t.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:e.name,version:e.moduleVersion,fileName:t.name}),t.unpatch(t.moduleExports,e.moduleVersion))}}}isEnabled(){return this._enabled}};function PS(e,t,n){return void 0===t?e.includes("*"):e.some(e=>hg(t,e,{includePrerelease:n}))}let LS=class{name;supportedVersions;patch;unpatch;files;constructor(e,t,n,r,s){this.name=e,this.supportedVersions=t,this.patch=n,this.unpatch=r,this.files=s||[]}};class wS{supportedVersions;patch;unpatch;name;constructor(e,n,r,s){this.supportedVersions=n,this.patch=r,this.unpatch=s,this.name=t.normalize(e)}}var MS;!function(e){e[e.STABLE=1]="STABLE",e[e.OLD=2]="OLD",e[e.DUPLICATE=3]="DUPLICATE"}(MS||(MS={}));var xS=Object.freeze({__proto__:null,InstrumentationBase:IS,InstrumentationNodeModuleDefinition:LS,InstrumentationNodeModuleFile:wS,get SemconvStability(){return MS},isWrapped:OS,registerInstrumentations:ug,safeExecuteInTheMiddle:CS,safeExecuteInTheMiddleAsync:async function(e,t,n){let r,s;try{s=await e()}catch(e){r=e}finally{if(t(r,s),r&&!n)throw r;return s}},semconvStabilityFromStr:function(e,t){let n=MS.OLD;const r=t?.split(",").map(e=>e.trim()).filter(e=>""!==e);for(const t of r??[]){if(t.toLowerCase()===e+"/dup"){n=MS.DUPLICATE;break}t.toLowerCase()===e&&(n=MS.STABLE)}return n}}),kS=Wt(xS),GS=Wt(n_),DS={},VS={};Object.defineProperty(VS,"__esModule",{value:!0}),VS.HTTP_FLAVOR_VALUE_HTTP_1_1=VS.NET_TRANSPORT_VALUE_IP_UDP=VS.NET_TRANSPORT_VALUE_IP_TCP=VS.ATTR_NET_TRANSPORT=VS.ATTR_NET_PEER_PORT=VS.ATTR_NET_PEER_NAME=VS.ATTR_NET_PEER_IP=VS.ATTR_NET_HOST_PORT=VS.ATTR_NET_HOST_NAME=VS.ATTR_NET_HOST_IP=VS.ATTR_HTTP_USER_AGENT=VS.ATTR_HTTP_URL=VS.ATTR_HTTP_TARGET=VS.ATTR_HTTP_STATUS_CODE=VS.ATTR_HTTP_SERVER_NAME=VS.ATTR_HTTP_SCHEME=VS.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=VS.ATTR_HTTP_RESPONSE_CONTENT_LENGTH=VS.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=VS.ATTR_HTTP_REQUEST_CONTENT_LENGTH=VS.ATTR_HTTP_METHOD=VS.ATTR_HTTP_HOST=VS.ATTR_HTTP_FLAVOR=VS.ATTR_HTTP_CLIENT_IP=VS.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST=VS.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT=VS.ATTR_USER_AGENT_SYNTHETIC_TYPE=void 0,VS.ATTR_USER_AGENT_SYNTHETIC_TYPE="user_agent.synthetic.type",VS.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT="bot",VS.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST="test",VS.ATTR_HTTP_CLIENT_IP="http.client_ip",VS.ATTR_HTTP_FLAVOR="http.flavor",VS.ATTR_HTTP_HOST="http.host",VS.ATTR_HTTP_METHOD="http.method",VS.ATTR_HTTP_REQUEST_CONTENT_LENGTH="http.request_content_length",VS.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED="http.request_content_length_uncompressed",VS.ATTR_HTTP_RESPONSE_CONTENT_LENGTH="http.response_content_length",VS.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED="http.response_content_length_uncompressed",VS.ATTR_HTTP_SCHEME="http.scheme",VS.ATTR_HTTP_SERVER_NAME="http.server_name",VS.ATTR_HTTP_STATUS_CODE="http.status_code",VS.ATTR_HTTP_TARGET="http.target",VS.ATTR_HTTP_URL="http.url",VS.ATTR_HTTP_USER_AGENT="http.user_agent",VS.ATTR_NET_HOST_IP="net.host.ip",VS.ATTR_NET_HOST_NAME="net.host.name",VS.ATTR_NET_HOST_PORT="net.host.port",VS.ATTR_NET_PEER_IP="net.peer.ip",VS.ATTR_NET_PEER_NAME="net.peer.name",VS.ATTR_NET_PEER_PORT="net.peer.port",VS.ATTR_NET_TRANSPORT="net.transport",VS.NET_TRANSPORT_VALUE_IP_TCP="ip_tcp",VS.NET_TRANSPORT_VALUE_IP_UDP="ip_udp",VS.HTTP_FLAVOR_VALUE_HTTP_1_1="1.1";var US,HS={};US=HS,Object.defineProperty(US,"__esModule",{value:!0}),US.AttributeNames=void 0,function(e){e.HTTP_ERROR_NAME="http.error_name",e.HTTP_ERROR_MESSAGE="http.error_message",e.HTTP_STATUS_TEXT="http.status_text"}(US.AttributeNames||(US.AttributeNames={}));var jS={};function ZS(e,t){Error.captureStackTrace(this,ZS),this.name=this.constructor.name,this.message=e,this.input=t}Object.defineProperty(jS,"__esModule",{value:!0}),jS.SYNTHETIC_BOT_NAMES=jS.SYNTHETIC_TEST_NAMES=void 0,jS.SYNTHETIC_TEST_NAMES=["alwayson"],jS.SYNTHETIC_BOT_NAMES=["googlebot","bingbot"],s.inherits(ZS,Error);var WS={isDelimiter:function(e){return 34===e||40===e||41===e||44===e||47===e||e>=58&&e<=64||e>=91&&e<=93||123===e||125===e},isTokenChar:function(e){return 33===e||e>=35&&e<=39||42===e||43===e||45===e||46===e||e>=48&&e<=57||e>=65&&e<=90||e>=94&&e<=122||124===e||126===e},isExtended:function(e){return e>=128&&e<=255},isPrint:function(e){return e>=32&&e<=126}},XS=s,$S=ZS,FS=WS.isDelimiter,YS=WS.isTokenChar,BS=WS.isExtended,KS=WS.isPrint;function JS(e){return e.replace(/\\(.)/g,"$1")}function zS(e,t){return XS.format("Unexpected character '%s' at index %d",e.charAt(t),t)}var QS=function(e){for(var t,n,r=!1,s=!1,o=!1,i={},a=[],c=-1,u=-1,l=0;l<e.length;l++)if(n=e.charCodeAt(l),void 0===t){if(0!==l&&-1===c&&(32===n||9===n))continue;if(YS(n))-1===c&&(c=l);else{if(61!==n||-1===c)throw new $S(zS(e,l),e);t=e.slice(c,l).toLowerCase(),c=-1}}else if(s&&(9===n||KS(n)||BS(n)))s=!1;else if(YS(n)){if(-1!==u)throw new $S(zS(e,l),e);-1===c&&(c=l)}else if(FS(n)||BS(n))if(o)34===n?(o=!1,u=l):92===n?(-1===c&&(c=l),s=r=!0):-1===c&&(c=l);else if(34===n&&61===e.charCodeAt(l-1))o=!0;else{if(44!==n&&59!==n||-1===c&&-1===u)throw new $S(zS(e,l),e);-1!==c?(-1===u&&(u=l),i[t]=r?JS(e.slice(c,u)):e.slice(c,u)):i[t]="",44===n&&(a.push(i),i={}),t=void 0,c=u=-1}else{if(32!==n&&9!==n)throw new $S(zS(e,l),e);if(-1!==u)continue;if(o)-1===c&&(c=l);else{if(-1===c)throw new $S(zS(e,l),e);u=l}}if(void 0===t||o||-1===c&&-1===u||32===n||9===n)throw new $S("Unexpected end of input",e);return-1!==c?(-1===u&&(u=l),i[t]=r?JS(e.slice(c,u)):e.slice(c,u)):i[t]="",a.push(i),a};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.headerCapture=e.getIncomingStableRequestMetricAttributesOnResponse=e.getIncomingRequestMetricAttributesOnResponse=e.getIncomingRequestAttributesOnResponse=e.getIncomingRequestMetricAttributes=e.getIncomingRequestAttributes=e.getRemoteClientAddress=e.getOutgoingStableRequestMetricAttributesOnResponse=e.getOutgoingRequestMetricAttributesOnResponse=e.getOutgoingRequestAttributesOnResponse=e.setAttributesFromHttpKind=e.getOutgoingRequestMetricAttributes=e.getOutgoingRequestAttributes=e.extractHostnameAndPort=e.isValidOptionsType=e.getRequestInfo=e.isCompressed=e.setResponseContentLengthAttribute=e.setRequestContentLengthAttribute=e.setSpanWithError=e.satisfiesPattern=e.parseResponseStatus=e.getAbsoluteUrl=void 0;const t=Ft,n=GS,r=VS,s=Q_,o=kS,a=i,c=HS,u=jS,l=QS;e.getAbsoluteUrl=(e,t,n="http:")=>{const r=e||{},s=r.protocol||n,o=(r.port||"").toString(),i=r.path||"/";let a=r.host||r.hostname||t.host||"localhost";return-1===a.indexOf(":")&&o&&"80"!==o&&"443"!==o&&(a+=`:${o}`),`${s}//${a}${i}`};e.parseResponseStatus=(e,n)=>{const r=e===t.SpanKind.CLIENT?400:500;return n&&n>=100&&n<r?t.SpanStatusCode.UNSET:t.SpanStatusCode.ERROR};e.satisfiesPattern=(e,t)=>{if("string"==typeof t)return t===e;if(t instanceof RegExp)return t.test(e);if("function"==typeof t)return t(e);throw new TypeError("Pattern is in unsupported datatype")};e.setSpanWithError=(e,r,s)=>{const i=r.message;s&o.SemconvStability.OLD&&(e.setAttribute(c.AttributeNames.HTTP_ERROR_NAME,r.name),e.setAttribute(c.AttributeNames.HTTP_ERROR_MESSAGE,i)),s&o.SemconvStability.STABLE&&e.setAttribute(n.ATTR_ERROR_TYPE,r.name),e.setStatus({code:t.SpanStatusCode.ERROR,message:i}),e.recordException(r)};e.setRequestContentLengthAttribute=(t,n)=>{const s=p(t.headers);null!==s&&((0,e.isCompressed)(t.headers)?n[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH]=s:n[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED]=s)};function p(e){const t=e["content-length"];if(void 0===t)return null;const n=parseInt(t,10);return isNaN(n)?null:n}e.setResponseContentLengthAttribute=(t,n)=>{const s=p(t.headers);null!==s&&((0,e.isCompressed)(t.headers)?n[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH]=s:n[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED]=s)};e.isCompressed=e=>{const t=e["content-encoding"];return!!t&&"identity"!==t};e.getRequestInfo=(e,t,n)=>{let r,s,o,i=!1;if("string"==typeof t){try{const e=function(e){const{hostname:t,pathname:n,port:r,username:s,password:o,search:i,protocol:a,hash:c,href:u,origin:l,host:p}=new URL(e),d={protocol:a,hostname:t&&"["===t[0]?t.slice(1,-1):t,hash:c,search:i,pathname:n,path:`${n||""}${i||""}`,href:u,origin:l,host:p};return""!==r&&(d.port=Number(r)),(s||o)&&(d.auth=`${decodeURIComponent(s)}:${decodeURIComponent(o)}`),d}(t);o=e,r=e.pathname||"/"}catch(n){i=!0,e.verbose("Unable to parse URL provided to HTTP request, using fallback to determine path. Original error:",n),o={path:t},r=o.path||"/"}s=`${o.protocol||"http:"}//${o.host}`,void 0!==n&&Object.assign(o,n)}else if(t instanceof a.URL)o={protocol:t.protocol,hostname:"string"==typeof t.hostname&&t.hostname.startsWith("[")?t.hostname.slice(1,-1):t.hostname,path:`${t.pathname||""}${t.search||""}`},""!==t.port&&(o.port=Number(t.port)),(t.username||t.password)&&(o.auth=`${t.username}:${t.password}`),r=t.pathname,s=t.origin,void 0!==n&&Object.assign(o,n);else{o=Object.assign({protocol:t.host?"http:":void 0},t);const e=o.host||(null!=o.port?`${o.hostname}${o.port}`:o.hostname);if(s=`${o.protocol||"http:"}//${e}`,r=t.pathname,!r&&o.path)try{r=new URL(o.path,s).pathname||"/"}catch{r="/"}}return{origin:s,pathname:r,method:o.method?o.method.toUpperCase():"GET",optionsParsed:o,invalidUrl:i}};e.isValidOptionsType=e=>{if(!e)return!1;const t=typeof e;return"string"===t||"object"===t&&!Array.isArray(e)};e.extractHostnameAndPort=e=>{if(e.hostname&&e.port)return{hostname:e.hostname,port:e.port};const t=e.host?.match(/^([^:/ ]+)(:\d{1,5})?/)||null,n=e.hostname||(null===t?"localhost":t[1]);let r=e.port;return r||(r=t&&t[2]?t[2].substring(1):"https:"===e.protocol?"443":"80"),{hostname:n,port:r}};e.getOutgoingRequestAttributes=(t,s,i,a)=>{const c=s.hostname,u=s.port,l=t.method??"GET",p=_(l),h=t.headers||{},m=h["user-agent"],f=(0,e.getAbsoluteUrl)(t,h,`${s.component}:`),g={[r.ATTR_HTTP_URL]:f,[r.ATTR_HTTP_METHOD]:l,[r.ATTR_HTTP_TARGET]:t.path||"/",[r.ATTR_NET_PEER_NAME]:c,[r.ATTR_HTTP_HOST]:h.host??`${c}:${u}`},E={[n.ATTR_HTTP_REQUEST_METHOD]:p,[n.ATTR_SERVER_ADDRESS]:c,[n.ATTR_SERVER_PORT]:Number(u),[n.ATTR_URL_FULL]:f,[n.ATTR_USER_AGENT_ORIGINAL]:m};switch(l!==p&&(E[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=l),a&&m&&(E[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=d(m)),void 0!==m&&(g[r.ATTR_HTTP_USER_AGENT]=m),i){case o.SemconvStability.STABLE:return Object.assign(E,s.hookAttributes);case o.SemconvStability.OLD:return Object.assign(g,s.hookAttributes)}return Object.assign(g,E,s.hookAttributes)};e.getOutgoingRequestMetricAttributes=e=>{const t={};return t[r.ATTR_HTTP_METHOD]=e[r.ATTR_HTTP_METHOD],t[r.ATTR_NET_PEER_NAME]=e[r.ATTR_NET_PEER_NAME],t};e.setAttributesFromHttpKind=(e,t)=>{e&&(t[r.ATTR_HTTP_FLAVOR]=e,"QUIC"!==e.toUpperCase()?t[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_TCP:t[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_UDP)};const d=e=>{const t=String(e).toLowerCase();for(const e of u.SYNTHETIC_TEST_NAMES)if(t.includes(e))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST;for(const e of u.SYNTHETIC_BOT_NAMES)if(t.includes(e))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT};e.getOutgoingRequestAttributesOnResponse=(t,s)=>{const{statusCode:i,statusMessage:a,httpVersion:u,socket:l}=t,p={},d={};if(null!=i&&(d[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=i),l){const{remoteAddress:e,remotePort:s}=l;p[r.ATTR_NET_PEER_IP]=e,p[r.ATTR_NET_PEER_PORT]=s,d[n.ATTR_NETWORK_PEER_ADDRESS]=e,d[n.ATTR_NETWORK_PEER_PORT]=s,d[n.ATTR_NETWORK_PROTOCOL_VERSION]=t.httpVersion}switch((0,e.setResponseContentLengthAttribute)(t,p),i&&(p[r.ATTR_HTTP_STATUS_CODE]=i,p[c.AttributeNames.HTTP_STATUS_TEXT]=(a||"").toUpperCase()),(0,e.setAttributesFromHttpKind)(u,p),s){case o.SemconvStability.STABLE:return d;case o.SemconvStability.OLD:return p}return Object.assign(p,d)};e.getOutgoingRequestMetricAttributesOnResponse=e=>{const t={};return t[r.ATTR_NET_PEER_PORT]=e[r.ATTR_NET_PEER_PORT],t[r.ATTR_HTTP_STATUS_CODE]=e[r.ATTR_HTTP_STATUS_CODE],t[r.ATTR_HTTP_FLAVOR]=e[r.ATTR_HTTP_FLAVOR],t};function h(e,t){const n=e.split(":");if(1===n.length)return"http"===t?{host:n[0],port:"80"}:"https"===t?{host:n[0],port:"443"}:{host:n[0]};if(2===n.length)return{host:n[0],port:n[1]};if(n[0].startsWith("["))if(n[n.length-1].endsWith("]")){if("http"===t)return{host:e,port:"80"};if("https"===t)return{host:e,port:"443"}}else if(n[n.length-2].endsWith("]"))return{host:n.slice(0,-1).join(":"),port:n[n.length-1]};return{host:e}}function m(e){const t=e.headers.forwarded;if(t)for(const e of g(t))if(e.for)return e.for;const n=e.headers["x-forwarded-for"];if("string"==typeof n)return n;if(Array.isArray(n))return n[0];const r=e.socket.remoteAddress;return r||null}e.getOutgoingStableRequestMetricAttributesOnResponse=e=>{const t={};return e[n.ATTR_NETWORK_PROTOCOL_VERSION]&&(t[n.ATTR_NETWORK_PROTOCOL_VERSION]=e[n.ATTR_NETWORK_PROTOCOL_VERSION]),e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(t[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),t},e.getRemoteClientAddress=m;e.getIncomingRequestAttributes=(t,s,i)=>{const a=t.headers,c=a["user-agent"],u=a["x-forwarded-for"],l=t.httpVersion,p=a.host,f=p?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",E=t.method,S=_(E),y=function(e,t){const n=e.headers.forwarded;if(n)for(const e of g(n))if(e.host)return h(e.host,e.proto);const r=e.headers["x-forwarded-host"];if("string"==typeof r)return"string"==typeof e.headers["x-forwarded-proto"]?h(r,e.headers["x-forwarded-proto"]):Array.isArray(e.headers["x-forwarded-proto"])?h(r,e.headers["x-forwarded-proto"][0]):h(r);if(Array.isArray(r)&&"string"==typeof r[0]&&r[0].length>0)return"string"==typeof e.headers["x-forwarded-proto"]?h(r[0],e.headers["x-forwarded-proto"]):Array.isArray(e.headers["x-forwarded-proto"])?h(r[0],e.headers["x-forwarded-proto"][0]):h(r[0]);const s=e.headers.host;return"string"==typeof s&&s.length>0?h(s,t):null}(t,s.component),T=s.serverName,b=m(t),A={[n.ATTR_HTTP_REQUEST_METHOD]:S,[n.ATTR_URL_SCHEME]:s.component,[n.ATTR_SERVER_ADDRESS]:y?.host,[n.ATTR_NETWORK_PEER_ADDRESS]:t.socket.remoteAddress,[n.ATTR_NETWORK_PEER_PORT]:t.socket.remotePort,[n.ATTR_NETWORK_PROTOCOL_VERSION]:t.httpVersion,[n.ATTR_USER_AGENT_ORIGINAL]:c},R=function(e,t,n){try{if(t.headers.host)return new URL(t.url??"/",`${e}://${t.headers.host}`);{const n=new URL(t.url??"/",`${e}://localhost`);return{pathname:n.pathname,search:n.search,toString:function(){return n.pathname+n.search}}}}catch(e){return n.verbose("Unable to get URL from request",e),{}}}(s.component,t,i);null!=R?.pathname&&(A[n.ATTR_URL_PATH]=R.pathname),R.search&&(A[n.ATTR_URL_QUERY]=R.search.slice(1)),null!=b&&(A[n.ATTR_CLIENT_ADDRESS]=b.split(",")[0]),null!=y?.port&&(A[n.ATTR_SERVER_PORT]=Number(y.port)),E!==S&&(A[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=E),s.enableSyntheticSourceDetection&&c&&(A[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=d(c));const v={[r.ATTR_HTTP_URL]:R.toString(),[r.ATTR_HTTP_HOST]:p,[r.ATTR_NET_HOST_NAME]:f,[r.ATTR_HTTP_METHOD]:E,[r.ATTR_HTTP_SCHEME]:s.component};switch("string"==typeof u&&(v[r.ATTR_HTTP_CLIENT_IP]=u.split(",")[0]),"string"==typeof T&&(v[r.ATTR_HTTP_SERVER_NAME]=T),R?.pathname&&(v[r.ATTR_HTTP_TARGET]=R?.pathname+R?.search||"/"),void 0!==c&&(v[r.ATTR_HTTP_USER_AGENT]=c),(0,e.setRequestContentLengthAttribute)(t,v),(0,e.setAttributesFromHttpKind)(l,v),s.semconvStability){case o.SemconvStability.STABLE:return Object.assign(A,s.hookAttributes);case o.SemconvStability.OLD:return Object.assign(v,s.hookAttributes)}return Object.assign(v,A,s.hookAttributes)};e.getIncomingRequestMetricAttributes=e=>{const t={};return t[r.ATTR_HTTP_SCHEME]=e[r.ATTR_HTTP_SCHEME],t[r.ATTR_HTTP_METHOD]=e[r.ATTR_HTTP_METHOD],t[r.ATTR_NET_HOST_NAME]=e[r.ATTR_NET_HOST_NAME],t[r.ATTR_HTTP_FLAVOR]=e[r.ATTR_HTTP_FLAVOR],t};e.getIncomingRequestAttributesOnResponse=(e,i,a)=>{const{socket:u}=e,{statusCode:l,statusMessage:p}=i,d={[n.ATTR_HTTP_RESPONSE_STATUS_CODE]:l},h=(0,s.getRPCMetadata)(t.context.active()),m={};if(u){const{localAddress:e,localPort:t,remoteAddress:n,remotePort:s}=u;m[r.ATTR_NET_HOST_IP]=e,m[r.ATTR_NET_HOST_PORT]=t,m[r.ATTR_NET_PEER_IP]=n,m[r.ATTR_NET_PEER_PORT]=s}switch(m[r.ATTR_HTTP_STATUS_CODE]=l,m[c.AttributeNames.HTTP_STATUS_TEXT]=(p||"").toUpperCase(),h?.type===s.RPCType.HTTP&&void 0!==h.route&&(m[n.ATTR_HTTP_ROUTE]=h.route,d[n.ATTR_HTTP_ROUTE]=h.route),a){case o.SemconvStability.STABLE:return d;case o.SemconvStability.OLD:return m}return Object.assign(m,d)};e.getIncomingRequestMetricAttributesOnResponse=e=>{const t={};return t[r.ATTR_HTTP_STATUS_CODE]=e[r.ATTR_HTTP_STATUS_CODE],t[r.ATTR_NET_HOST_PORT]=e[r.ATTR_NET_HOST_PORT],void 0!==e[n.ATTR_HTTP_ROUTE]&&(t[n.ATTR_HTTP_ROUTE]=e[n.ATTR_HTTP_ROUTE]),t};e.getIncomingStableRequestMetricAttributesOnResponse=e=>{const t={};return void 0!==e[n.ATTR_HTTP_ROUTE]&&(t[n.ATTR_HTTP_ROUTE]=e[n.ATTR_HTTP_ROUTE]),e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(t[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=e[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),t},e.headerCapture=function(e,t){const n=new Map;for(let e=0,r=t.length;e<r;e++){const r=t[e].toLowerCase();n.set(r,r.replace(/-/g,"_"))}return(t,r)=>{for(const s of n.keys()){const o=r(s);if(void 0===o)continue;const i=n.get(s),a=`http.${e}.header.${i}`;"string"==typeof o?t.setAttribute(a,[o]):Array.isArray(o)?t.setAttribute(a,o):t.setAttribute(a,[o])}}};const f=new Set(["GET","HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","TRACE","PATCH"]);function _(e){if(null==e)return"GET";const t=e.toUpperCase();return f.has(t)?t:"_OTHER"}function g(e){try{return l(e)}catch{return[]}}}(DS),Object.defineProperty($t,"__esModule",{value:!0}),$t.HttpInstrumentation=void 0;const qS=Ft,ey=Q_,ty=i,ny=q_,ry=kS,sy=l,oy=GS,iy=DS;class ay extends ry.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=ry.SemconvStability.OLD;constructor(e={}){super("@opentelemetry/instrumentation-http",ny.VERSION,e),this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,ry.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:qS.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:qS.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(oy.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:qS.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(oy.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:qS.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}_recordServerDuration(e,t,n){this._semconvStability&ry.SemconvStability.OLD&&this._oldHttpServerDurationHistogram.record(e,t),this._semconvStability&ry.SemconvStability.STABLE&&this._stableHttpServerDurationHistogram.record(e/1e3,n)}_recordClientDuration(e,t,n){this._semconvStability&ry.SemconvStability.OLD&&this._oldHttpClientDurationHistogram.record(e,t),this._semconvStability&ry.SemconvStability.STABLE&&this._stableHttpClientDurationHistogram.record(e/1e3,n)}setConfig(e={}){super.setConfig(e),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new ry.InstrumentationNodeModuleDefinition("http",["*"],e=>{const t="Module"===e[Symbol.toStringTag];if(!this.getConfig().disableOutgoingRequestInstrumentation){const n=this._wrap(e,"request",this._getPatchOutgoingRequestFunction("http")),r=this._wrap(e,"get",this._getPatchOutgoingGetFunction(n));t&&(e.default.request=n,e.default.get=r)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(e.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http")),e},e=>{void 0!==e&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(e,"request"),this._unwrap(e,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(e.Server.prototype,"emit"))})}_getHttpsInstrumentation(){return new ry.InstrumentationNodeModuleDefinition("https",["*"],e=>{const t="Module"===e[Symbol.toStringTag];if(!this.getConfig().disableOutgoingRequestInstrumentation){const n=this._wrap(e,"request",this._getPatchHttpsOutgoingRequestFunction("https")),r=this._wrap(e,"get",this._getPatchHttpsOutgoingGetFunction(n));t&&(e.default.request=n,e.default.get=r)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(e.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https")),e},e=>{void 0!==e&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(e,"request"),this._unwrap(e,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(e.Server.prototype,"emit"))})}_getPatchIncomingRequestFunction(e){return t=>this._incomingRequestFunction(e,t)}_getPatchOutgoingRequestFunction(e){return t=>this._outgoingRequestFunction(e,t)}_getPatchOutgoingGetFunction(e){return t=>function(t,...n){const r=e(t,...n);return r.end(),r}}_getPatchHttpsOutgoingRequestFunction(e){return t=>{const n=this;return function(r,...s){return"https"===e&&"object"==typeof r&&"URL"!==r?.constructor?.name&&(r=Object.assign({},r),n._setDefaultOptions(r)),n._getPatchOutgoingRequestFunction(e)(t)(r,...s)}}}_setDefaultOptions(e){e.protocol=e.protocol||"https:",e.port=e.port||443}_getPatchHttpsOutgoingGetFunction(e){return t=>{const n=this;return function(r,...s){return n._getPatchOutgoingGetFunction(e)(t)(r,...s)}}}_traceClientRequest(e,t,n,r,s){this.getConfig().requestHook&&this._callRequestHook(t,e);let o=!1;return e.prependListener("response",i=>{this._diag.debug("outgoingRequest on response()"),e.listenerCount("response")<=1&&i.resume();const a=(0,iy.getOutgoingRequestAttributesOnResponse)(i,this._semconvStability);t.setAttributes(a),r=Object.assign(r,(0,iy.getOutgoingRequestMetricAttributesOnResponse)(a)),s=Object.assign(s,(0,iy.getOutgoingStableRequestMetricAttributesOnResponse)(a)),this.getConfig().responseHook&&this._callResponseHook(t,i),this._headerCapture.client.captureRequestHeaders(t,t=>e.getHeader(t)),this._headerCapture.client.captureResponseHeaders(t,e=>i.headers[e]),qS.context.bind(qS.context.active(),i);i.on("end",()=>{if(this._diag.debug("outgoingRequest on end()"),o)return;let a;o=!0,a=i.aborted&&!i.complete?{code:qS.SpanStatusCode.ERROR}:{code:(0,iy.parseResponseStatus)(qS.SpanKind.CLIENT,i.statusCode)},t.setStatus(a),this.getConfig().applyCustomAttributesOnSpan&&(0,ry.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(t,e,i),()=>{},!0),this._closeHttpSpan(t,qS.SpanKind.CLIENT,n,r,s)}),i.on(sy.errorMonitor,e=>{this._diag.debug("outgoingRequest on error()",e),o||(o=!0,(0,iy.setSpanWithError)(t,e,this._semconvStability),t.setStatus({code:qS.SpanStatusCode.ERROR,message:e.message}),this._closeHttpSpan(t,qS.SpanKind.CLIENT,n,r,s))})}),e.on("close",()=>{this._diag.debug("outgoingRequest on request close()"),e.aborted||o||(o=!0,this._closeHttpSpan(t,qS.SpanKind.CLIENT,n,r,s))}),e.on(sy.errorMonitor,e=>{this._diag.debug("outgoingRequest on request error()",e),o||(o=!0,(0,iy.setSpanWithError)(t,e,this._semconvStability),this._closeHttpSpan(t,qS.SpanKind.CLIENT,n,r,s))}),this._diag.debug("http.ClientRequest return request"),e}_incomingRequestFunction(e,t){const n=this;return function(r,...s){if("request"!==r)return t.apply(this,[r,...s]);const o=s[0],i=s[1],a=o.method||"GET";if(n._diag.debug(`${e} instrumentation incomingRequest`),(0,ry.safeExecuteInTheMiddle)(()=>n.getConfig().ignoreIncomingRequestHook?.(o),e=>{null!=e&&n._diag.error("caught ignoreIncomingRequestHook error: ",e)},!0))return qS.context.with((0,ey.suppressTracing)(qS.context.active()),()=>(qS.context.bind(qS.context.active(),o),qS.context.bind(qS.context.active(),i),t.apply(this,[r,...s])));const c=o.headers,u=(0,iy.getIncomingRequestAttributes)(o,{component:e,serverName:n.getConfig().serverName,hookAttributes:n._callStartSpanHook(o,n.getConfig().startIncomingSpanHook),semconvStability:n._semconvStability,enableSyntheticSourceDetection:n.getConfig().enableSyntheticSourceDetection||!1},n._diag),l={kind:qS.SpanKind.SERVER,attributes:u},p=(0,ey.hrTime)(),d=(0,iy.getIncomingRequestMetricAttributes)(u),h={[oy.ATTR_HTTP_REQUEST_METHOD]:u[oy.ATTR_HTTP_REQUEST_METHOD],[oy.ATTR_URL_SCHEME]:u[oy.ATTR_URL_SCHEME]};u[oy.ATTR_NETWORK_PROTOCOL_VERSION]&&(h[oy.ATTR_NETWORK_PROTOCOL_VERSION]=u[oy.ATTR_NETWORK_PROTOCOL_VERSION]);const m=qS.propagation.extract(qS.ROOT_CONTEXT,c),f=n._startHttpSpan(a,l,m),_={type:ey.RPCType.HTTP,span:f};return qS.context.with((0,ey.setRPCMetadata)(qS.trace.setSpan(m,f),_),()=>{qS.context.bind(qS.context.active(),o),qS.context.bind(qS.context.active(),i),n.getConfig().requestHook&&n._callRequestHook(f,o),n.getConfig().responseHook&&n._callResponseHook(f,i),n._headerCapture.server.captureRequestHeaders(f,e=>o.headers[e]);let e=!1;return i.on("close",()=>{e||n._onServerResponseFinish(o,i,f,d,h,p)}),i.on(sy.errorMonitor,t=>{e=!0,n._onServerResponseError(f,d,h,p,t)}),(0,ry.safeExecuteInTheMiddle)(()=>t.apply(this,[r,...s]),e=>{if(e)throw(0,iy.setSpanWithError)(f,e,n._semconvStability),n._closeHttpSpan(f,qS.SpanKind.SERVER,p,d,h),e})})}}_outgoingRequestFunction(e,t){const n=this;return function(r,...s){if(!(0,iy.isValidOptionsType)(r))return t.apply(this,[r,...s]);const o="object"==typeof s[0]&&("string"==typeof r||r instanceof ty.URL)?s.shift():void 0,{method:i,invalidUrl:a,optionsParsed:c}=(0,iy.getRequestInfo)(n._diag,r,o);if((0,ry.safeExecuteInTheMiddle)(()=>n.getConfig().ignoreOutgoingRequestHook?.(c),e=>{null!=e&&n._diag.error("caught ignoreOutgoingRequestHook error: ",e)},!0))return t.apply(this,[c,...s]);const{hostname:u,port:l}=(0,iy.extractHostnameAndPort)(c),p=(0,iy.getOutgoingRequestAttributes)(c,{component:e,port:l,hostname:u,hookAttributes:n._callStartSpanHook(c,n.getConfig().startOutgoingSpanHook)},n._semconvStability,n.getConfig().enableSyntheticSourceDetection||!1),d=(0,ey.hrTime)(),h=(0,iy.getOutgoingRequestMetricAttributes)(p),m={[oy.ATTR_HTTP_REQUEST_METHOD]:p[oy.ATTR_HTTP_REQUEST_METHOD],[oy.ATTR_SERVER_ADDRESS]:p[oy.ATTR_SERVER_ADDRESS],[oy.ATTR_SERVER_PORT]:p[oy.ATTR_SERVER_PORT]};p[oy.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(m[oy.ATTR_HTTP_RESPONSE_STATUS_CODE]=p[oy.ATTR_HTTP_RESPONSE_STATUS_CODE]),p[oy.ATTR_NETWORK_PROTOCOL_VERSION]&&(m[oy.ATTR_NETWORK_PROTOCOL_VERSION]=p[oy.ATTR_NETWORK_PROTOCOL_VERSION]);const f={kind:qS.SpanKind.CLIENT,attributes:p},_=n._startHttpSpan(i,f),g=qS.context.active(),E=qS.trace.setSpan(g,_);return c.headers?c.headers=Object.assign({},c.headers):c.headers={},qS.propagation.inject(E,c.headers),qS.context.with(E,()=>{const o=s[s.length-1];"function"==typeof o&&(s[s.length-1]=qS.context.bind(g,o));const i=(0,ry.safeExecuteInTheMiddle)(()=>a?t.apply(this,[r,...s]):t.apply(this,[c,...s]),e=>{if(e)throw(0,iy.setSpanWithError)(_,e,n._semconvStability),n._closeHttpSpan(_,qS.SpanKind.CLIENT,d,h,m),e});return n._diag.debug(`${e} instrumentation outgoingRequest`),qS.context.bind(g,i),n._traceClientRequest(i,_,d,h,m)})}}_onServerResponseFinish(e,t,n,r,s,o){const i=(0,iy.getIncomingRequestAttributesOnResponse)(e,t,this._semconvStability);r=Object.assign(r,(0,iy.getIncomingRequestMetricAttributesOnResponse)(i)),s=Object.assign(s,(0,iy.getIncomingStableRequestMetricAttributesOnResponse)(i)),this._headerCapture.server.captureResponseHeaders(n,e=>t.getHeader(e)),n.setAttributes(i).setStatus({code:(0,iy.parseResponseStatus)(qS.SpanKind.SERVER,t.statusCode)});const a=i[oy.ATTR_HTTP_ROUTE];a&&n.updateName(`${e.method||"GET"} ${a}`),this.getConfig().applyCustomAttributesOnSpan&&(0,ry.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(n,e,t),()=>{},!0),this._closeHttpSpan(n,qS.SpanKind.SERVER,o,r,s)}_onServerResponseError(e,t,n,r,s){(0,iy.setSpanWithError)(e,s,this._semconvStability),this._closeHttpSpan(e,qS.SpanKind.SERVER,r,t,n)}_startHttpSpan(e,t,n=qS.context.active()){const r=t.kind===qS.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans;let s;const o=qS.trace.getSpan(n);return s=!0===r&&void 0===o?qS.trace.wrapSpanContext(qS.INVALID_SPAN_CONTEXT):!0===r&&o?.spanContext().isRemote?o:this.tracer.startSpan(e,t,n),this._spanNotEnded.add(s),s}_closeHttpSpan(e,t,n,r,s){if(!this._spanNotEnded.has(e))return;e.end(),this._spanNotEnded.delete(e);const o=(0,ey.hrTimeToMilliseconds)((0,ey.hrTimeDuration)(n,(0,ey.hrTime)()));t===qS.SpanKind.SERVER?this._recordServerDuration(o,r,s):t===qS.SpanKind.CLIENT&&this._recordClientDuration(o,r,s)}_callResponseHook(e,t){(0,ry.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(e,t),()=>{},!0)}_callRequestHook(e,t){(0,ry.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(e,t),()=>{},!0)}_callStartSpanHook(e,t){if("function"==typeof t)return(0,ry.safeExecuteInTheMiddle)(()=>t(e),()=>{},!0)}_createHeaderCapture(){const e=this.getConfig();return{client:{captureRequestHeaders:(0,iy.headerCapture)("request",e.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,iy.headerCapture)("response",e.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,iy.headerCapture)("request",e.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,iy.headerCapture)("response",e.headersToSpanAttributes?.server?.responseHeaders??[])}}}}$t.HttpInstrumentation=ay,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpInstrumentation=void 0;var t=$t;Object.defineProperty(e,"HttpInstrumentation",{enumerable:!0,get:function(){return t.HttpInstrumentation}})}(Xt);const cy="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,uy=globalThis,ly="10.8.0";function py(){return dy(uy),uy}function dy(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||ly,t[ly]=t[ly]||{}}function hy(e,t,n=uy){const r=n.__SENTRY__=n.__SENTRY__||{},s=r[ly]=r[ly]||{};return s[e]||(s[e]=t())}const my=["debug","info","warn","error","log","assert","trace"],fy={};function _y(e){if(!("console"in uy))return e();const t=uy.console,n={},r=Object.keys(fy);r.forEach(e=>{const r=fy[e];n[e]=t[e],t[e]=r});try{return e()}finally{r.forEach(e=>{t[e]=n[e]})}}function gy(){return Sy().enabled}function Ey(e,...t){cy&&gy()&&_y(()=>{uy.console[e](`Sentry Logger [${e}]:`,...t)})}function Sy(){return cy?hy("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const yy={enable:function(){Sy().enabled=!0},disable:function(){Sy().enabled=!1},isEnabled:gy,log:function(...e){Ey("log",...e)},warn:function(...e){Ey("warn",...e)},error:function(...e){Ey("error",...e)}},Ty=/\(error: (.*)\)/,by=/captureMessage|captureException/;function Ay(...e){const t=e.sort((e,t)=>e[0]-t[0]).map(e=>e[1]);return(e,n=0,r=0)=>{const s=[],o=e.split("\n");for(let e=n;e<o.length;e++){let n=o[e];n.length>1024&&(n=n.slice(0,1024));const i=Ty.test(n)?n.replace(Ty,"$1"):n;if(!i.match(/\S*Error: /)){for(const e of t){const t=e(i);if(t){s.push(t);break}}if(s.length>=50+r)break}}return function(e){if(!e.length)return[];const t=Array.from(e);/sentryWrapped/.test(vy(t).function||"")&&t.pop();t.reverse(),by.test(vy(t).function||"")&&(t.pop(),by.test(vy(t).function||"")&&t.pop());return t.slice(0,50).map(e=>({...e,filename:e.filename||vy(t).filename,function:e.function||"?"}))}(s.slice(r))}}function Ry(e){return Array.isArray(e)?Ay(...e):e}function vy(e){return e[e.length-1]||{}}const Ny="<anonymous>";function Cy(e){try{return e&&"function"==typeof e&&e.name||Ny}catch{return Ny}}function Oy(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach(t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)}),e}catch{return}}}const Iy={},Py={};function Ly(e,t){Iy[e]=Iy[e]||[],Iy[e].push(t)}function wy(e,t){if(!Py[e]){Py[e]=!0;try{t()}catch(t){cy&&yy.error(`Error while instrumenting ${e}`,t)}}}function My(e,t){const n=e&&Iy[e];if(n)for(const r of n)try{r(t)}catch(t){cy&&yy.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Cy(r)}\nError:`,t)}}let xy=null;function ky(){xy=uy.onerror,uy.onerror=function(e,t,n,r,s){return My("error",{column:r,error:s,line:n,msg:e,url:t}),!!xy&&xy.apply(this,arguments)},uy.onerror.__SENTRY_INSTRUMENTED__=!0}let Gy=null;function Dy(){Gy=uy.onunhandledrejection,uy.onunhandledrejection=function(e){return My("unhandledrejection",e),!Gy||Gy.apply(this,arguments)},uy.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const Vy=Object.prototype.toString;function Uy(e){switch(Vy.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Fy(e,Error)}}function Hy(e,t){return Vy.call(e)===`[object ${t}]`}function jy(e){return Hy(e,"String")}function Zy(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function Wy(e){return null===e||Zy(e)||"object"!=typeof e&&"function"!=typeof e}function Xy(e){return Hy(e,"Object")}function $y(e){return Boolean(e?.then&&"function"==typeof e.then)}function Fy(e,t){try{return e instanceof t}catch{return!1}}function Yy(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}const By=uy;function Ky(e,t){const n=e,r=[];if(!n?.tagName)return"";if(By.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const s=t?.length?t.filter(e=>n.getAttribute(e)).map(e=>[e,n.getAttribute(e)]):null;if(s?.length)s.forEach(e=>{r.push(`[${e[0]}="${e[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&jy(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const o=["aria-label","type","name","title","alt"];for(const e of o){const t=n.getAttribute(e);t&&r.push(`[${e}="${t}"]`)}return r.join("")}function Jy(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function zy(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{Yy(r)?n.push("[VueViewModel]"):n.push(String(r))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function Qy(e,t,n=!1){return!!jy(e)&&(Hy(t,"RegExp")?t.test(e):!!jy(t)&&(n?e===t:e.includes(t)))}function qy(e,t=[],n=!1){return t.some(t=>Qy(e,t,n))}function eT(e,t,n){if(!(t in e))return;const r=e[t];if("function"!=typeof r)return;const s=n(r);"function"==typeof s&&function(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,tT(e,"__sentry_original__",t)}catch{}}(s,r);try{e[t]=s}catch{cy&&yy.log(`Failed to replace method "${t}" in object`,e)}}function tT(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{cy&&yy.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function nT(e){if(Uy(e))return{message:e.message,name:e.name,stack:e.stack,...sT(e)};if(t=e,"undefined"!=typeof Event&&Fy(t,Event)){const t={type:e.type,target:rT(e.target),currentTarget:rT(e.currentTarget),...sT(e)};return"undefined"!=typeof CustomEvent&&Fy(e,CustomEvent)&&(t.detail=e.detail),t}return e;var t}function rT(e){try{return t=e,"undefined"!=typeof Element&&Fy(t,Element)?function(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,s=[];let o=0,i=0;const a=" > ",c=a.length;let u;const l=Array.isArray(t)?t:t.keyAttrs,p=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&o++<r&&(u=Ky(n,l),!("html"===u||o>1&&i+s.length*c+u.length>=p));)s.push(u),i+=u.length,n=n.parentNode;return s.reverse().join(a)}catch{return"<unknown>"}}(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}var t}function sT(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function oT(e=function(){const e=uy;return e.crypto||e.msCrypto}()){let t=()=>16*Math.random();try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"");e?.getRandomValues&&(t=()=>{const t=new Uint8Array(1);return e.getRandomValues(t),t[0]})}catch{}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,e=>(e^(15&t())>>e/4).toString(16))}function iT(e){return e.exception?.values?.[0]}function aT(e){const{message:t,event_id:n}=e;if(t)return t;const r=iT(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function cT(e,t){const n=iT(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r?.data,...t.data};n.mechanism.data=e}}const uT=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function lT(e){return parseInt(e||"",10)}function pT(e){if(function(e){try{return e.__sentry_captured__}catch{}}(e))return!0;try{tT(e,"__sentry_captured__",!0)}catch{}return!1}function dT(){return Date.now()/1e3}let hT;function mT(){return(hT??(hT=function(){const{performance:e}=uy;if(!e?.now||!e.timeOrigin)return dT;const t=e.timeOrigin;return()=>(t+e.now())/1e3}()))()}function fT(e){const t=mT(),n={sid:oT(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(e){return{sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}(n)};return e&&_T(n,e),n}function _T(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||mT(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:oT()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function gT(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&0===Object.keys(t).length)return e;const r={...e};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=gT(r[e],t[e],n-1));return r}function ET(){return oT()}function ST(){return oT().substring(16)}const yT="_sentrySpan";function TT(e,t){t?tT(e,yT,t):delete e[yT]}function bT(e){return e[yT]}class AT{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:ET(),sampleRand:Math.random()}}clone(){const e=new AT;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,TT(e,bT(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&_T(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,n=t instanceof AT?t.getScopeData():Xy(t)?e:void 0,{tags:r,extra:s,user:o,contexts:i,level:a,fingerprint:c=[],propagationContext:u}=n||{};return this._tags={...this._tags,...r},this._extra={...this._extra,...s},this._contexts={...this._contexts,...i},o&&Object.keys(o).length&&(this._user=o),a&&(this._level=a),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,TT(this,void 0),this._attachments=[],this.setPropagationContext({traceId:ET(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:dT(),...e,message:e.message?Jy(e.message,2048):e.message};return this._breadcrumbs.push(r),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:bT(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=gT(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t?.event_id||oT();if(!this._client)return cy&&yy.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n?.event_id||oT();if(!this._client)return cy&&yy.warn("No client configured on scope - will not capture message!"),r;const s=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:s,...n,event_id:r},this),r}captureEvent(e,t){const n=t?.event_id||oT();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(cy&&yy.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function RT(){return hy("defaultCurrentScope",()=>new AT)}function vT(){return hy("defaultIsolationScope",()=>new AT)}class NT{constructor(e,t){let n,r;n=e||new AT,r=t||new AT,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(e){throw this._popScope(),e}return $y(n)?n.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function CT(){const e=dy(py());return e.stack=e.stack||new NT(RT(),vT())}function OT(e){return CT().withScope(e)}function IT(e,t){const n=CT();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function PT(e){return CT().withScope(()=>e(CT().getIsolationScope()))}function LT(e){const t=dy(e);return t.acs?t.acs:{withIsolationScope:PT,withScope:OT,withSetScope:IT,withSetIsolationScope:(e,t)=>PT(t),getCurrentScope:()=>CT().getScope(),getIsolationScope:()=>CT().getIsolationScope()}}function wT(){return LT(py()).getCurrentScope()}function MT(){return LT(py()).getIsolationScope()}function xT(){return hy("globalScope",()=>new AT)}function kT(...e){const t=LT(py());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function GT(...e){const t=LT(py());if(2===e.length){const[n,r]=e;return n?t.withSetIsolationScope(n,r):t.withIsolationScope(r)}return t.withIsolationScope(e[0])}function DT(){return wT().getClient()}function VT(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:s}=t,o={trace_id:n,span_id:s||ST()};return r&&(o.parent_span_id=r),o}const UT="sentry.source",HT="sentry.sample_rate",jT="sentry.op",ZT="sentry.origin",WT="sentry.measurement_unit",XT="sentry.measurement_value",$T="sentry.custom_span_name",FT="sentry.profile_id",YT="sentry.exclusive_time",BT="cache.key";function KT(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"unknown_error"}}function JT(e,t){e.setAttribute("http.response.status_code",t);const n=KT(t);"unknown_error"!==n.message&&e.setStatus(n)}const zT="_sentryScope",QT="_sentryIsolationScope";function qT(e,t,n){e&&(tT(e,QT,n),tT(e,zT,t))}function eb(e){return{scope:e[zT],isolationScope:e[QT]}}const tb="sentry-",nb=/^sentry-/;function rb(e){const t=ob(e);if(!t)return;const n=Object.entries(t).reduce((e,[t,n])=>{if(t.match(nb)){e[t.slice(7)]=n}return e},{});return Object.keys(n).length>0?n:void 0}function sb(e){if(!e)return;return ab(Object.entries(e).reduce((e,[t,n])=>(n&&(e[`${tb}${t}`]=n),e),{}))}function ob(e){if(e&&(jy(e)||Array.isArray(e)))return Array.isArray(e)?e.reduce((e,t)=>{const n=ib(t);return Object.entries(n).forEach(([t,n])=>{e[t]=n}),e},{}):ib(e)}function ib(e){return e.split(",").map(e=>e.split("=").map(e=>{try{return decodeURIComponent(e.trim())}catch{return}})).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{})}function ab(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce((e,[t,n],r)=>{const s=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,o=0===r?s:`${e},${s}`;return o.length>8192?(cy&&yy.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):o},"")}const cb=/^o(\d+)\./,ub=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function lb(e,t=!1){const{host:n,path:r,pass:s,port:o,projectId:i,protocol:a,publicKey:c}=e;return`${a}://${c}${t&&s?`:${s}`:""}@${n}${o?`:${o}`:""}/${r?`${r}/`:r}${i}`}function pb(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function db(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=function(e){const t=e.match(cb);return t?.[1]}(n)),r}function hb(e){const t="string"==typeof e?function(e){const t=ub.exec(e);if(!t)return void _y(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});const[n,r,s="",o="",i="",a=""]=t.slice(1);let c="",u=a;const l=u.split("/");if(l.length>1&&(c=l.slice(0,-1).join("/"),u=l.pop()),u){const e=u.match(/^\d+/);e&&(u=e[0])}return pb({host:o,pass:s,path:c,projectId:u,port:i,protocol:n,publicKey:r})}(e):pb(e);if(t&&function(e){if(!cy)return!0;const{port:t,projectId:n,protocol:r}=e;return!(["protocol","publicKey","host","projectId"].find(t=>!e[t]&&(yy.error(`Invalid Sentry Dsn: ${t} missing`),!0))||(n.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(r)?t&&isNaN(parseInt(t,10))&&(yy.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(yy.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(yy.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(t))return t}function mb(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;return"number"!=typeof t||isNaN(t)||t<0||t>1?void 0:t}const fb=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function _b(e,t){const n=function(e){if(!e)return;const t=e.match(fb);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}(e),r=rb(t);if(!n?.traceId)return{traceId:ET(),sampleRand:Math.random()};const s=function(e,t){const n=mb(t?.sample_rand);if(void 0!==n)return n;const r=mb(t?.sample_rate);return r&&void 0!==e?.parentSampled?e.parentSampled?Math.random()*r:r+Math.random()*(1-r):Math.random()}(n,r);r&&(r.sample_rand=s.toString());const{traceId:o,parentSpanId:i,parentSampled:a}=n;return{traceId:o,parentSpanId:i,sampled:a,dsc:r||{},sampleRand:s}}function gb(e=ET(),t=ST(),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function Eb(e,t){const n=db(e);if(t&&n&&t!==n)return yy.log(`Won't continue trace because org IDs don't match (incoming baggage: ${t}, SDK options: ${n})`),!1;return!(e.getOptions().strictTraceContinuation||!1)||!(t&&!n||!t&&n)||(yy.log(`Starting a new trace because strict trace continuation is enabled but one org ID is missing (incoming baggage: ${t}, Sentry client: ${n})`),!1)}let Sb=!1;function yb(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:s,parent_span_id:o,status:i,origin:a,links:c}=Nb(e);return{parent_span_id:o,span_id:t,trace_id:n,data:r,op:s,status:i,origin:a,links:c}}function Tb(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),s=r?t:Nb(e).parent_span_id,o=eb(e).scope;return{parent_span_id:s,span_id:r?o?.getPropagationContext().propagationSpanId||ST():t,trace_id:n}}function bb(e){const{traceId:t,spanId:n}=e.spanContext();return gb(t,n,Cb(e))}function Ab(e){return e&&e.length>0?e.map(({context:{spanId:e,traceId:t,traceFlags:n,...r},attributes:s})=>({span_id:e,trace_id:t,sampled:1===n,attributes:s,...r})):void 0}function Rb(e){return"number"==typeof e?vb(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?vb(e.getTime()):mT()}function vb(e){return e>9999999999?e/1e3:e}function Nb(e){if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:r,startTime:s,name:o,endTime:i,status:a,links:c}=e;return{span_id:t,trace_id:n,data:r,description:o,parent_span_id:"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0,start_timestamp:Rb(s),timestamp:Rb(i)||void 0,status:Ob(a),op:r[jT],origin:r[ZT],links:Ab(c)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function Cb(e){const{traceFlags:t}=e.spanContext();return 1===t}function Ob(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"unknown_error"}const Ib="_sentryChildSpans",Pb="_sentryRootSpan";function Lb(e,t){const n=e[Pb]||e;tT(t,Pb,n),e[Ib]?e[Ib].add(t):tT(e,Ib,new Set([t]))}function wb(e){const t=new Set;return function e(n){if(!t.has(n)&&Cb(n)){t.add(n);const r=n[Ib]?Array.from(n[Ib]):[];for(const t of r)e(t)}}(e),Array.from(t)}function Mb(e){return e[Pb]||e}function xb(){const e=LT(py());return e.getActiveSpan?e.getActiveSpan():bT(wT())}function kb(){Sb||(_y(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly.")}),Sb=!0)}let Gb=!1;function Db(){function e(){const e=xb(),t=e&&Mb(e);if(t){const e="internal_error";cy&&yy.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}Gb||(e.tag="sentry_tracingErrorCallback",Gb=!0,function(e){const t="error";Ly(t,e),wy(t,ky)}(e),function(e){const t="unhandledrejection";Ly(t,e),wy(t,Dy)}(e))}function Vb(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=e||DT()?.getOptions();return!(!t||null==t.tracesSampleRate&&!t.tracesSampler)}const Ub="production",Hb="_frozenDsc";function jb(e,t){tT(e,Hb,t)}function Zb(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},s={environment:n.environment||Ub,release:n.release,public_key:r,trace_id:e,org_id:db(t)};return t.emit("createDsc",s),s}function Wb(e,t){const n=t.getPropagationContext();return n.dsc||Zb(n.traceId,e)}function Xb(e){const t=DT();if(!t)return{};const n=Mb(e),r=Nb(n),s=r.data,o=n.spanContext().traceState,i=o?.get("sentry.sample_rate")??s[HT]??s["sentry.previous_trace_sample_rate"];function a(e){return"number"!=typeof i&&"string"!=typeof i||(e.sample_rate=`${i}`),e}const c=n[Hb];if(c)return a(c);const u=o?.get("sentry.dsc"),l=u&&rb(u);if(l)return a(l);const p=Zb(e.spanContext().traceId,t),d=s[UT],h=r.description;return"url"!==d&&h&&(p.transaction=h),Vb()&&(p.sampled=String(Cb(n)),p.sample_rand=o?.get("sentry.sample_rand")??eb(n).scope?.getPropagationContext().sampleRand.toString()),a(p),t.emit("createDsc",p,n),p}class $b{constructor(e={}){this._traceId=e.traceId||ET(),this._spanId=e.spanId||ST()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function Fb(e,t=100,n=1/0){try{return Bb("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function Yb(e,t=3,n=102400){const r=Fb(e,t);return s=r,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(s))>n?Yb(e,t-1,n):r;var s}function Bb(e,t,n=1/0,r=1/0,s=function(){const e=new WeakSet;function t(t){return!!e.has(t)||(e.add(t),!1)}function n(t){e.delete(t)}return[t,n]}()){const[o,i]=s;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const a=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(Yy(t))return"[VueViewModel]";if(Xy(n=t)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${Cy(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const r=function(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(e){return`**non-serializable** (${e})`}var n}(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const c="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===c)return a.replace("object ","");if(o(t))return"[Circular ~]";const u=t;if(u&&"function"==typeof u.toJSON)try{return Bb("",u.toJSON(),c-1,r,s)}catch{}const l=Array.isArray(t)?[]:{};let p=0;const d=nT(t);for(const e in d){if(!Object.prototype.hasOwnProperty.call(d,e))continue;if(p>=r){l[e]="[MaxProperties ~]";break}const t=d[e];l[e]=Bb(e,t,c-1,r,s),p++}return i(t),l}function Kb(e,t=[]){return[e,t]}function Jb(e,t){const[n,r]=e;return[n,[...r,t]]}function zb(e,t){const n=e[1];for(const e of n){if(t(e,e[0].type))return!0}return!1}function Qb(e){const t=dy(uy);return t.encodePolyfill?t.encodePolyfill(e):(new TextEncoder).encode(e)}function qb(e){const[t,n]=e;let r=JSON.stringify(t);function s(e){"string"==typeof r?r="string"==typeof e?r+e:[Qb(r),e]:r.push("string"==typeof e?Qb(e):e)}for(const e of n){const[t,n]=e;if(s(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)s(n);else{let e;try{e=JSON.stringify(n)}catch{e=JSON.stringify(Fb(n))}s(e)}}return"string"==typeof r?r:function(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}(r)}function eA(e){return[{type:"span"},e]}function tA(e){const t="string"==typeof e.data?Qb(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const nA={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item"};function rA(e){return nA[e]}function sA(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function oA(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(aA(n)){if(Qy(e.description,n))return!0;continue}if(!n.name&&!n.op)continue;const t=!n.name||Qy(e.description,n.name),r=!n.op||e.op&&Qy(e.op,n.op);if(t&&r)return!0}return!1}function iA(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const t of e)t.parent_span_id===r&&(t.parent_span_id=n)}function aA(e){return"string"==typeof e||e instanceof RegExp}function cA(e,t,n,r){const s=sA(n),o=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){if(!t)return e;const n=e.sdk||{};e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0}}(e,n?.sdk);const i=function(e,t,n,r){const s=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:lb(r)},...s&&{trace:s}}}(e,s,r,t);delete e.sdkProcessingMetadata;return Kb(i,[[{type:o},e]])}function uA(e){if(!cy)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Nb(e),{spanId:s}=e.spanContext(),o=Cb(e),i=Mb(e),a=i===e,c=`[Tracing] Starting ${o?"sampled":"unsampled"} ${a?"root ":""}span`,u=[`op: ${n}`,`name: ${t}`,`ID: ${s}`];if(r&&u.push(`parent ID: ${r}`),!a){const{op:e,description:t}=Nb(i);u.push(`root ID: ${i.spanContext().spanId}`),e&&u.push(`root op: ${e}`),t&&u.push(`root description: ${t}`)}yy.log(`${c}\n  ${u.join("\n  ")}`)}function lA(e){if(!cy)return;const{description:t="< unknown name >",op:n="< unknown op >"}=Nb(e),{spanId:r}=e.spanContext(),s=`[Tracing] Finishing "${n}" ${Mb(e)===e?"root ":""}span "${t}" with ID ${r}`;yy.log(s)}function pA(e){if(!e||0===e.length)return;const t={};return e.forEach(e=>{const n=e.attributes||{},r=n[WT],s=n[XT];"string"==typeof r&&"number"==typeof s&&(t[e.name]={value:s,unit:r})}),t}class dA{constructor(e={}){this._traceId=e.traceId||ET(),this._spanId=e.spanId||ST(),this._startTime=e.startTimestamp||mT(),this._links=e.links,this._attributes={},this.setAttributes({[ZT]:"manual",[jT]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this._links?this._links.push(e):this._links=[e],this}addLinks(e){return this._links?this._links.push(...e):this._links=e,this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=Rb(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(UT,"custom"),this}end(e){this._endTime||(this._endTime=Rb(e),lA(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[jT],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:Ob(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[ZT],profile_id:this._attributes[FT],exclusive_time:this._attributes[YT],measurements:pA(this._events),is_segment:this._isStandaloneSpan&&Mb(this)===this||void 0,segment_id:this._isStandaloneSpan?Mb(this).spanContext().spanId:void 0,links:Ab(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){cy&&yy.log("[Tracing] Adding an event to span:",e);const r=hA(t)?t:n||mT(),s=hA(t)?{}:t||{},o={name:e,time:Rb(r),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=DT();e&&e.emit("spanEnd",this);if(!(this._isStandaloneSpan||this===Mb(this)))return;if(this._isStandaloneSpan)return void(this._sampled?function(e){const t=DT();if(!t)return;const n=e[1];if(!n||0===n.length)return void t.recordDroppedEvent("before_send","span");t.sendEnvelope(e)}(function(e,t){const n=Xb(e[0]),r=t?.getDsn(),s=t?.getOptions().tunnel,o={sent_at:(new Date).toISOString(),...function(e){return!!e.trace_id&&!!e.public_key}(n)&&{trace:n},...!!s&&r&&{dsn:lb(r)}},{beforeSendSpan:i,ignoreSpans:a}=t?.getOptions()||{},c=a?.length?e.filter(e=>!oA(Nb(e),a)):e,u=e.length-c.length;u&&t?.recordDroppedEvent("before_send","span",u);const l=i?e=>{const t=Nb(e);return i(t)||(kb(),t)}:Nb,p=[];for(const e of c){const t=l(e);t&&p.push(eA(t))}return Kb(o,p)}([this],e)):(cy&&yy.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();if(t){(eb(this).scope||wT()).captureEvent(t)}}_convertSpanToTransaction(){if(!mA(Nb(this)))return;this._name||(cy&&yy.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=eb(this),n=e?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(!0!==this._sampled)return;const r=wb(this).filter(e=>e!==this&&!function(e){return e instanceof dA&&e.isStandaloneSpan()}(e)).map(e=>Nb(e)).filter(mA),s=this._attributes[UT];delete this._attributes[$T],r.forEach(e=>{delete e.data[$T]});const o={contexts:{trace:yb(this)},spans:r.length>1e3?r.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,1e3):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,dynamicSamplingContext:Xb(this)},request:n,...s&&{transaction_info:{source:s}}},i=pA(this._events);return i&&Object.keys(i).length&&(cy&&yy.log("[Measurements] Adding measurements to transaction event",JSON.stringify(i,void 0,2)),o.measurements=i),o}}function hA(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function mA(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function fA(e,t,n=()=>{}){let r;try{r=e()}catch(e){throw t(e),n(),e}return function(e,t,n){if($y(e))return e.then(e=>(n(),e),e=>{throw t(e),n(),e});return n(),e}(r,t,n)}function _A(e,t,n){if(!Vb(e))return[!1];let r,s;"function"==typeof e.tracesSampler?(s=e.tracesSampler({...t,inheritOrSampleWith:e=>"number"==typeof t.parentSampleRate?t.parentSampleRate:"boolean"==typeof t.parentSampled?Number(t.parentSampled):e}),r=!0):void 0!==t.parentSampled?s=t.parentSampled:void 0!==e.tracesSampleRate&&(s=e.tracesSampleRate,r=!0);const o=mb(s);if(void 0===o)return cy&&yy.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(s)} of type ${JSON.stringify(typeof s)}.`),[!1];if(!o)return cy&&yy.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,o,r];const i=n<o;return i||cy&&yy.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(s)})`),[i,o,r]}const gA="__SENTRY_SUPPRESS_TRACING__";function EA(e,t){const n=NA();if(n.startSpan)return n.startSpan(e,t);const r=vA(e),{forceTransaction:s,parentSpan:o,scope:i}=e,a=i?.clone();return kT(a,()=>IA(o)(()=>{const n=wT(),i=OA(n,o),a=e.onlyIfParent&&!i?new $b:RA({parentSpan:i,spanArguments:r,forceTransaction:s,scope:n});return TT(n,a),fA(()=>t(a),()=>{const{status:e}=Nb(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})},()=>{a.end()})}))}function SA(e,t){const n=NA();if(n.startSpanManual)return n.startSpanManual(e,t);const r=vA(e),{forceTransaction:s,parentSpan:o,scope:i}=e,a=i?.clone();return kT(a,()=>IA(o)(()=>{const n=wT(),i=OA(n,o),a=e.onlyIfParent&&!i?new $b:RA({parentSpan:i,spanArguments:r,forceTransaction:s,scope:n});return TT(n,a),fA(()=>t(a,()=>a.end()),()=>{const{status:e}=Nb(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})})}))}function yA(e){const t=NA();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=vA(e),{forceTransaction:r,parentSpan:s}=e;return(e.scope?t=>kT(e.scope,t):void 0!==s?e=>TA(s,e):e=>e())(()=>{const t=wT(),o=OA(t,s);return e.onlyIfParent&&!o?new $b:RA({parentSpan:o,spanArguments:n,forceTransaction:r,scope:t})})}function TA(e,t){const n=NA();return n.withActiveSpan?n.withActiveSpan(e,t):kT(n=>(TT(n,e||void 0),t(n)))}function bA(e){const t=NA();return t.suppressTracing?t.suppressTracing(e):kT(t=>{t.setSDKProcessingMetadata({[gA]:!0});const n=e();return t.setSDKProcessingMetadata({[gA]:void 0}),n})}function AA(e){return kT(t=>(t.setPropagationContext({traceId:ET(),sampleRand:Math.random()}),cy&&yy.log(`Starting a new trace with id ${t.getPropagationContext().traceId}`),TA(null,e)))}function RA({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!Vb()){const r=new $b;if(n||!e){jb(r,{sampled:"false",sample_rate:"0",transaction:t.name,...Xb(r)})}return r}const s=MT();let o;if(e&&!n)o=function(e,t,n){const{spanId:r,traceId:s}=e.spanContext(),o=!t.getScopeData().sdkProcessingMetadata[gA]&&Cb(e),i=o?new dA({...n,parentSpanId:r,traceId:s,sampled:o}):new $b({traceId:s});Lb(e,i);const a=DT();a&&(a.emit("spanStart",i),n.endTimestamp&&a.emit("spanEnd",i));return i}(e,r,t),Lb(e,o);else if(e){const n=Xb(e),{traceId:s,spanId:i}=e.spanContext(),a=Cb(e);o=CA({traceId:s,parentSpanId:i,...t},r,a),jb(o,n)}else{const{traceId:e,dsc:n,parentSpanId:i,sampled:a}={...s.getPropagationContext(),...r.getPropagationContext()};o=CA({traceId:e,parentSpanId:i,...t},r,a),n&&jb(o,n)}return uA(o),qT(o,r,s),o}function vA(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=Rb(e.startTime),delete n.startTime,n}return t}function NA(){return LT(py())}function CA(e,t,n){const r=DT(),s=r?.getOptions()||{},{name:o=""}=e,i={spanAttributes:{...e.attributes},spanName:o,parentSampled:n};r?.emit("beforeSampling",i,{decision:!1});const a=i.parentSampled??n,c=i.spanAttributes,u=t.getPropagationContext(),[l,p,d]=t.getScopeData().sdkProcessingMetadata[gA]?[!1]:_A(s,{name:o,parentSampled:a,attributes:c,parentSampleRate:mb(u.dsc?.sample_rate)},u.sampleRand),h=new dA({...e,attributes:{[UT]:"custom",[HT]:void 0!==p&&d?p:void 0,...c},sampled:l});return!l&&r&&(cy&&yy.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",h),h}function OA(e,t){if(t)return t;if(null===t)return;const n=bT(e);if(!n)return;const r=DT();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?Mb(n):n}function IA(e){return void 0!==e?t=>TA(e,t):e=>e()}function PA(e){return new wA(t=>{t(e)})}function LA(e){return new wA((t,n)=>{n(e)})}class wA{constructor(e){this._state=0,this._handlers=[],this._runExecutor(e)}then(e,t){return new wA((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()})}catch(e){return this.then(e=>e,e)}finally(e){return new wA((t,n)=>{let r,s;return this.then(t=>{s=!1,r=t,e&&e()},t=>{s=!0,r=t,e&&e()}).then(()=>{s?n(r):t(r)})})}_executeHandlers(){if(0===this._state)return;const e=this._handlers.slice();this._handlers=[],e.forEach(e=>{e[0]||(1===this._state&&e[1](this._value),2===this._state&&e[2](this._value),e[0]=!0)})}_runExecutor(e){const t=(e,t)=>{0===this._state&&($y(t)?t.then(n,r):(this._state=e,this._value=t,this._executeHandlers()))},n=e=>{t(1,e)},r=e=>{t(2,e)};try{e(n,r)}catch(e){r(e)}}}function MA(e,t,n,r=0){return new wA((s,o)=>{const i=e[r];if(null===t||"function"!=typeof i)s(t);else{const a=i({...t},n);cy&&i.id&&null===a&&yy.log(`Event processor "${i.id}" dropped event`),$y(a)?a.then(t=>MA(e,t,n,r+1).then(s)).then(null,o):MA(e,a,n,r+1).then(s).then(null,o)}})}function xA(e,t){const{fingerprint:n,span:r,breadcrumbs:s,sdkProcessingMetadata:o}=t;!function(e,t){const{extra:n,tags:r,user:s,contexts:o,level:i,transactionName:a}=t;Object.keys(n).length&&(e.extra={...n,...e.extra});Object.keys(r).length&&(e.tags={...r,...e.tags});Object.keys(s).length&&(e.user={...s,...e.user});Object.keys(o).length&&(e.contexts={...o,...e.contexts});i&&(e.level=i);a&&"transaction"!==e.type&&(e.transaction=a)}(e,t),r&&function(e,t){e.contexts={trace:Tb(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Xb(t),...e.sdkProcessingMetadata};const n=Mb(t),r=Nb(n).description;r&&!e.transaction&&"transaction"===e.type&&(e.transaction=r)}(e,r),function(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t));e.fingerprint.length||delete e.fingerprint}(e,n),function(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}(e,s),function(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}(e,o)}function kA(e,t){const{extra:n,tags:r,user:s,contexts:o,level:i,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:u,eventProcessors:l,attachments:p,propagationContext:d,transactionName:h,span:m}=t;GA(e,"extra",n),GA(e,"tags",r),GA(e,"user",s),GA(e,"contexts",o),e.sdkProcessingMetadata=gT(e.sdkProcessingMetadata,a,2),i&&(e.level=i),h&&(e.transactionName=h),m&&(e.span=m),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),u.length&&(e.fingerprint=[...e.fingerprint,...u]),l.length&&(e.eventProcessors=[...e.eventProcessors,...l]),p.length&&(e.attachments=[...e.attachments,...p]),e.propagationContext={...e.propagationContext,...d}}function GA(e,t,n){e[t]=gT(e[t],n,1)}let DA,VA,UA;function HA(e){const t=uy._sentryDebugIds;if(!t)return{};const n=Object.keys(t);return UA&&n.length===VA||(VA=n.length,UA=n.reduce((n,r)=>{DA||(DA={});const s=DA[r];if(s)n[s[0]]=s[1];else{const s=e(r);for(let e=s.length-1;e>=0;e--){const o=s[e],i=o?.filename,a=t[r];if(i&&a){n[i]=a,DA[r]=[i,a];break}}}return n},{})),UA}function jA(e,t,n,r,s,o){const{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=e,c={...t,event_id:t.event_id||n.event_id||oT(),timestamp:t.timestamp||dT()},u=n.integrations||e.integrations.map(e=>e.name);!function(e,t){const{environment:n,release:r,dist:s,maxValueLength:o=250}=t;e.environment=e.environment||n||Ub,!e.release&&r&&(e.release=r);!e.dist&&s&&(e.dist=s);const i=e.request;i?.url&&(i.url=Jy(i.url,o))}(c,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(c,u),s&&s.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){const n=HA(t);e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.filename&&(e.debug_id=n[e.filename])})})}(c,e.stackParser);const l=function(e,t){if(!t)return e;const n=e?e.clone():new AT;return n.update(t),n}(r,n.captureContext);n.mechanism&&cT(c,n.mechanism);const p=s?s.getEventProcessors():[],d=xT().getScopeData();if(o){kA(d,o.getScopeData())}if(l){kA(d,l.getScopeData())}const h=[...n.attachments||[],...d.attachments];h.length&&(n.attachments=h),xA(c,d);return MA([...p,...d.eventProcessors],c,n).then(e=>(e&&function(e){const t={};if(e.exception?.values?.forEach(e=>{e.stacktrace?.frames?.forEach(e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)})}),0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})})}(e),"number"==typeof i&&i>0?function(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(e=>({...e,...e.data&&{data:Fb(e.data,t,n)}}))},...e.user&&{user:Fb(e.user,t,n)},...e.contexts&&{contexts:Fb(e.contexts,t,n)},...e.extra&&{extra:Fb(e.extra,t,n)}};e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Fb(e.contexts.trace.data,t,n)));e.spans&&(r.spans=e.spans.map(e=>({...e,...e.data&&{data:Fb(e.data,t,n)}})));e.contexts?.flags&&r.contexts&&(r.contexts.flags=Fb(e.contexts.flags,3,n));return r}(e,i,a):e))}function ZA(e){if(e)return function(e){return e instanceof AT||"function"==typeof e}(e)||function(e){return Object.keys(e).some(e=>WA.includes(e))}(e)?{captureContext:e}:e}const WA=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function XA(e,t){return wT().captureException(e,ZA(t))}function $A(e,t){const n="string"==typeof t?t:void 0,r="string"!=typeof t?{captureContext:t}:void 0;return wT().captureMessage(e,n,r)}function FA(e,t){return wT().captureEvent(e,t)}function YA(e,t){const n=wT(),r=DT();if(r){if(r.captureCheckIn)return r.captureCheckIn(e,t,n);cy&&yy.warn("Cannot capture check-in. Client does not support sending check-ins.")}else cy&&yy.warn("Cannot capture check-in. No client defined.");return oT()}function BA(e,t,n){const r=YA({monitorSlug:e,status:"in_progress"},n),s=mT();function o(t){YA({monitorSlug:e,status:t,checkInId:r,duration:mT()-s})}return GT(()=>{let e;try{e=t()}catch(e){throw o("error"),e}return $y(e)?e.then(e=>(o("ok"),e),e=>{throw o("error"),e}):(o("ok"),e)})}function KA(){const e=DT();return!1!==e?.getOptions().enabled&&!!e?.getTransport()}function JA(e){const t=MT(),n=wT(),{userAgent:r}=uy.navigator||{},s=fT({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),o=t.getSession();return"ok"===o?.status&&_T(o,{status:"exited"}),zA(),t.setSession(s),s}function zA(){const e=MT(),t=wT().getSession()||e.getSession();t&&function(e,t){let n={};t?n={status:t}:"ok"===e.status&&(n={status:"exited"}),_T(e,n)}(t),QA(),e.setSession()}function QA(){const e=MT(),t=DT(),n=e.getSession();n&&t&&t.captureSession(n)}function qA(e,t,n){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}(e,n)}`}const eR=[];function tR(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;if(t.forEach(e=>{e.isDefaultInstance=!0}),Array.isArray(n))r=[...t,...n];else if("function"==typeof n){const e=n(t);r=Array.isArray(e)?e:[e]}else r=t;return function(e){const t={};return e.forEach(e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)}),Object.values(t)}(r)}function nR(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function rR(e,t,n){if(n[t.name])cy&&yy.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===eR.indexOf(t.name)&&"function"==typeof t.setupOnce&&(t.setupOnce(),eR.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",(t,r)=>n(t,r,e))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign((t,r)=>n(t,r,e),{id:t.name});e.addEventProcessor(r)}cy&&yy.log(`Integration installed: ${t.name}`)}}function sR(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}const oR="Not capturing exception because it's already been captured.",iR="Discarded session because of missing or non-string release",aR=Symbol.for("SentryInternalError"),cR=Symbol.for("SentryDoNotSendEventError");function uR(e){return{message:e,[aR]:!0}}function lR(e){return{message:e,[cR]:!0}}function pR(e){return!!e&&"object"==typeof e&&aR in e}function dR(e){return!!e&&"object"==typeof e&&cR in e}class hR{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=hb(e.dsn):cy&&yy.warn("No DSN provided, client will not send events."),this._dsn){const t=qA(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,n){const r=oT();if(pT(e))return cy&&yy.log(oR),r;const s={event_id:r,...t};return this._process(this.eventFromException(e,s).then(e=>this._captureEvent(e,s,n))),s.event_id}captureMessage(e,t,n,r){const s={event_id:oT(),...n},o=Zy(e)?e:String(e),i=Wy(e)?this.eventFromMessage(o,t,s):this.eventFromException(e,s);return this._process(i.then(e=>this._captureEvent(e,s,r))),s.event_id}captureEvent(e,t,n){const r=oT();if(t?.originalException&&pT(t.originalException))return cy&&yy.log(oR),r;const s={event_id:r,...t},o=e.sdkProcessingMetadata||{},i=o.capturedSpanScope,a=o.capturedSpanIsolationScope;return this._process(this._captureEvent(e,s,i||n,a)),s.event_id}captureSession(e){this.sendSession(e),_T(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(n=>t.flush(e).then(e=>n&&e))):PA(!0)}close(e){return this.flush(e).then(e=>(this.getOptions().enabled=!1,this.emit("close"),e))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];rR(this,e,this._integrations),t||nR(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=cA(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=Jb(n,tA(e));const r=this.sendEnvelope(n);r&&r.then(t=>this.emit("afterSendEvent",e,t),null)}sendSession(e){const{release:t,environment:n=Ub}=this._options;if("aggregates"in e){const r=e.attrs||{};if(!r.release&&!t)return void(cy&&yy.warn(iR));r.release=r.release||t,r.environment=r.environment||n,e.attrs=r}else{if(!e.release&&!t)return void(cy&&yy.warn(iR));e.release=e.release||t,e.environment=e.environment||n}this.emit("beforeSendSession",e);const r=function(e,t,n,r){const s=sA(n);return Kb({sent_at:(new Date).toISOString(),...s&&{sdk:s},...!!r&&t&&{dsn:lb(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,t,n=1){if(this._options.sendClientReports){const r=`${e}:${t}`;cy&&yy.log(`Recording outcome: "${r}"${n>1?` (${n} times)`:""}`),this._outcomes[r]=(this._outcomes[r]||0)+n}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach(e=>e(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,e=>(cy&&yy.error("Error while sending envelope:",e),e)):(cy&&yy.error("Transport disabled"),PA({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const n={};return t.forEach(t=>{t&&rR(e,t,n)}),n}(this,e),nR(this,e)}_updateSessionFromEvent(e,t){let n="fatal"===t.level,r=!1;const s=t.exception?.values;if(s){r=!0;for(const e of s){const t=e.mechanism;if(!1===t?.handled){n=!0;break}}}const o="ok"===e.status;(o&&0===e.errors||o&&n)&&(_T(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new wA(t=>{let n=0;const r=setInterval(()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))},1)})}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r){const s=this.getOptions(),o=Object.keys(this._integrations);return!t.integrations&&o?.length&&(t.integrations=o),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),jA(s,e,t,n,this,r).then(e=>{if(null===e)return e;this.emit("postprocessEvent",e,t),e.contexts={trace:VT(n),...e.contexts};const r=Wb(this,n);return e.sdkProcessingMetadata={dynamicSamplingContext:r,...e.sdkProcessingMetadata},e})}_captureEvent(e,t={},n=wT(),r=MT()){return cy&&mR(e)&&yy.log(`Captured error event \`${sR(e)[0]||"<unknown>"}\``),this._processEvent(e,t,n,r).then(e=>e.event_id,e=>{cy&&(dR(e)?yy.log(e.message):pR(e)?yy.warn(e.message):yy.warn(e))})}_processEvent(e,t,n,r){const s=this.getOptions(),{sampleRate:o}=s,i=fR(e),a=mR(e),c=e.type||"error",u=`before send for type \`${c}\``,l=void 0===o?void 0:mb(o);if(a&&"number"==typeof l&&Math.random()>l)return this.recordDroppedEvent("sample_rate","error"),LA(lR(`Discarding event because it's not included in the random sample (sampling rate = ${o})`));const p="replay_event"===c?"replay":c;return this._prepareEvent(e,t,n,r).then(e=>{if(null===e)throw this.recordDroppedEvent("event_processor",p),lR("An event processor returned `null`, will not send event.");if(t.data&&!0===t.data.__sentry__)return e;const n=function(e,t,n,r){const{beforeSend:s,beforeSendTransaction:o,beforeSendSpan:i,ignoreSpans:a}=t;let c=n;if(mR(c)&&s)return s(c,r);if(fR(c)){if(i||a){const t=function(e){const{trace_id:t,parent_span_id:n,span_id:r,status:s,origin:o,data:i,op:a}=e.contexts?.trace??{};return{data:i??{},description:e.transaction,op:a,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:s,timestamp:e.timestamp,trace_id:t??"",origin:o,profile_id:i?.[FT],exclusive_time:i?.[YT],measurements:e.measurements,is_segment:!0}}(c);if(a?.length&&oA(t,a))return null;if(i){const e=i(t);e?c=gT(n,{type:"transaction",timestamp:(u=e).timestamp,start_timestamp:u.start_timestamp,transaction:u.description,contexts:{trace:{trace_id:u.trace_id,span_id:u.span_id,parent_span_id:u.parent_span_id,op:u.op,status:u.status,origin:u.origin,data:{...u.data,...u.profile_id&&{[FT]:u.profile_id},...u.exclusive_time&&{[YT]:u.exclusive_time}}}},measurements:u.measurements}):kb()}if(c.spans){const t=[],n=c.spans;for(const e of n)if(a?.length&&oA(e,a))iA(n,e);else if(i){const n=i(e);n?t.push(n):(kb(),t.push(e))}else t.push(e);const r=c.spans.length-t.length;r&&e.recordDroppedEvent("before_send","span",r),c.spans=t}}if(o){if(c.spans){const e=c.spans.length;c.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return o(c,r)}}var u;return c}(this,s,e,t);return function(e,t){const n=`${t} must return \`null\` or a valid event.`;if($y(e))return e.then(e=>{if(!Xy(e)&&null!==e)throw uR(n);return e},e=>{throw uR(`${t} rejected with ${e}`)});if(!Xy(e)&&null!==e)throw uR(n);return e}(n,u)}).then(s=>{if(null===s){if(this.recordDroppedEvent("before_send",p),i){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw lR(`${u} returned \`null\`, will not send event.`)}const o=n.getSession()||r.getSession();if(a&&o&&this._updateSessionFromEvent(o,s),i){const e=(s.sdkProcessingMetadata?.spanCountBeforeProcessing||0)-(s.spans?s.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const c=s.transaction_info;if(i&&c&&s.transaction!==e.transaction){const e="custom";s.transaction_info={...c,source:e}}return this.sendEvent(s,t),s}).then(null,e=>{if(dR(e)||pR(e))throw e;throw this.captureException(e,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:e}),uR(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)})}_process(e){this._numProcessing++,e.then(e=>(this._numProcessing--,e),e=>(this._numProcessing--,e))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}})}_flushOutcomes(){cy&&yy.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(cy&&yy.log("No outcomes to send"));if(!this._dsn)return void(cy&&yy.log("No dsn provided, will not send outcomes"));cy&&yy.log("Sending outcomes:",e);const t=(n=e,Kb((r=this._options.tunnel&&lb(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:s||dT(),discarded_events:n}]]));var n,r,s;this.sendEnvelope(t)}}function mR(e){return void 0===e.type}function fR(e){return"transaction"===e.type}function _R(e,t){return t?kT(t,()=>{const n=xb(),r=n?Tb(n):VT(t);return[n?Xb(n):Wb(e,t),r]}):[void 0,void 0]}const gR={trace:1,debug:5,info:9,warn:13,error:17,fatal:21};function ER(e,t,n,r=!0){!n||e[t]&&!r||(e[t]=n)}function SR(e,t){const n=AR(),r=bR(e);void 0===r?n.set(e,[t]):(n.set(e,[...r,t]),r.length>=100&&TR(e,r))}function yR(e,t=DT(),n=wT(),r=SR){if(!t)return void(cy&&yy.warn("No client available to capture log."));const{release:s,environment:o,enableLogs:i=!1,beforeSendLog:a}=t.getOptions();if(!i)return void(cy&&yy.warn("logging option not enabled, log will not be captured."));const[,c]=_R(t,n),u={...e.attributes},{user:{id:l,email:p,username:d}}=function(e){const t=xT().getScopeData();return kA(t,MT().getScopeData()),kA(t,e.getScopeData()),t}(n);ER(u,"user.id",l,!1),ER(u,"user.email",p,!1),ER(u,"user.name",d,!1),ER(u,"sentry.release",s),ER(u,"sentry.environment",o);const{name:h,version:m}=t.getSdkMetadata()?.sdk??{};ER(u,"sentry.sdk.name",h),ER(u,"sentry.sdk.version",m);const f=e.message;if(Zy(f)){const{__sentry_template_string__:e,__sentry_template_values__:t=[]}=f;u["sentry.message.template"]=e,t.forEach((e,t)=>{u[`sentry.message.parameter.${t}`]=e})}const _=bT(n);ER(u,"sentry.trace.parent_span_id",_?.spanContext().spanId);const g={...e,attributes:u};t.emit("beforeCaptureLog",g);const E=a?_y(()=>a(g)):g;if(!E)return t.recordDroppedEvent("before_send","log_item",1),void(cy&&yy.warn("beforeSendLog returned null, log will not be captured."));const{level:S,message:y,attributes:T={},severityNumber:b}=E;r(t,{timestamp:mT(),level:S,body:y,trace_id:c?.trace_id,severity_number:b??gR[S],attributes:Object.keys(T).reduce((e,t)=>(e[t]=function(e){switch(typeof e){case"number":return Number.isInteger(e)?{value:e,type:"integer"}:{value:e,type:"double"};case"boolean":return{value:e,type:"boolean"};case"string":return{value:e,type:"string"};default:{let t="";try{t=JSON.stringify(e)??""}catch{}return{value:t,type:"string"}}}}(T[t]),e),{})}),t.emit("afterCaptureLog",E)}function TR(e,t){const n=t??bR(e)??[];if(0===n.length)return;const r=e.getOptions(),s=function(e,t,n,r){const s={};return t?.sdk&&(s.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(s.dsn=lb(r)),Kb(s,[(o=e,[{type:"log",item_count:o.length,content_type:"application/vnd.sentry.items.log+json"},{items:o}])]);var o}(n,r._metadata,r.tunnel,e.getDsn());AR().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(s)}function bR(e){return AR().get(e)}function AR(){return hy("clientToLogBufferMap",()=>new WeakMap)}function RR(e,t){return e(t.stack||"",1)}function vR(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=RR(e,t);return r.length&&(n.stacktrace={frames:r}),n}function NR(e){if("name"in e&&"string"==typeof e.name){let t=`'${e.name}' captured as exception`;return"message"in e&&"string"==typeof e.message&&(t+=` with message '${e.message}'`),t}if("message"in e&&"string"==typeof e.message)return e.message;const t=function(e,t=40){const n=Object.keys(nT(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return Jy(r,t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:Jy(r,t)}return""}(e);if(Hy(e,"ErrorEvent"))return`Event \`ErrorEvent\` captured as exception with message \`${e.message}\``;const n=function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}(e);return`${n&&"Object"!==n?`'${n}'`:"Object"} captured as exception with keys: ${t}`}function CR(e,t,n,r){if(Uy(n))return[n,void 0];if(t.synthetic=!0,Xy(n)){const t=e?.getOptions().normalizeDepth,s={__serialized__:Yb(n,t)},o=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}(n);if(o)return[o,s];const i=NR(n),a=r?.syntheticException||new Error(i);return a.message=i,[a,s]}const s=r?.syntheticException||new Error(n);return s.message=`${n}`,[s,void 0]}class OR extends hR{constructor(e){if(Db(),super(e),this._logWeight=0,this._options.enableLogs){const e=this;e.on("flushLogs",()=>{e._logWeight=0,clearTimeout(e._logFlushIdleTimeout)}),e.on("afterCaptureLog",t=>{e._logWeight+=function(e){let t=0;e.message&&(t+=2*e.message.length);e.attributes&&Object.values(e.attributes).forEach(e=>{Array.isArray(e)?t+=e.length*PR(e[0]):Wy(e)?t+=PR(e):t+=100});return t}(t),e._logWeight>=8e5?TR(e):e._logFlushIdleTimeout=setTimeout(()=>{TR(e)},5e3)}),e.on("flush",()=>{TR(e)})}}eventFromException(e,t){const n=function(e,t,n,r){const s=r?.data&&r.data.mechanism||{handled:!0,type:"generic"},[o,i]=CR(e,s,n,r),a={exception:{values:[vR(t,o)]}};return i&&(a.extra=i),function(e,t,n){const r=e.exception=e.exception||{},s=r.values=r.values||[],o=s[0]=s[0]||{};o.value||(o.value=t||""),o.type||(o.type=n||"Error")}(a,void 0,void 0),cT(a,s),{...a,event_id:r?.event_id}}(this,this._options.stackParser,e,t);return n.level="error",PA(n)}eventFromMessage(e,t="info",n){return PA(function(e,t,n="info",r,s){const o={event_id:r?.event_id,level:n};if(s&&r?.syntheticException){const n=RR(e,r.syntheticException);n.length&&(o.exception={values:[{value:t,stacktrace:{frames:n}}]},cT(o,{synthetic:!0}))}if(Zy(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return o.logentry={message:e,params:n},o}return o.message=t,o}(this._options.stackParser,e,t,n,this._options.attachStacktrace))}captureException(e,t,n){return IR(t),super.captureException(e,t,n)}captureEvent(e,t,n){return!e.type&&e.exception?.values&&e.exception.values.length>0&&IR(t),super.captureEvent(e,t,n)}captureCheckIn(e,t,n){const r="checkInId"in e&&e.checkInId?e.checkInId:oT();if(!this._isEnabled())return cy&&yy.warn("SDK not enabled, will not capture check-in."),r;const s=this.getOptions(),{release:o,environment:i,tunnel:a}=s,c={check_in_id:r,monitor_slug:e.monitorSlug,status:e.status,release:o,environment:i};"duration"in e&&(c.duration=e.duration),t&&(c.monitor_config={schedule:t.schedule,checkin_margin:t.checkinMargin,max_runtime:t.maxRuntime,timezone:t.timezone,failure_issue_threshold:t.failureIssueThreshold,recovery_threshold:t.recoveryThreshold});const[u,l]=_R(this,n);l&&(c.contexts={trace:l});const p=function(e,t,n,r,s){const o={sent_at:(new Date).toISOString()};n?.sdk&&(o.sdk={name:n.sdk.name,version:n.sdk.version}),r&&s&&(o.dsn=lb(s)),t&&(o.trace=t);const i=function(e){return[{type:"check_in"},e]}(e);return Kb(o,[i])}(c,u,this.getSdkMetadata(),a,this.getDsn());return cy&&yy.log("Sending checkin:",e.monitorSlug,e.status),this.sendEnvelope(p),r}_prepareEvent(e,t,n,r){return this._options.platform&&(e.platform=e.platform||this._options.platform),this._options.runtime&&(e.contexts={...e.contexts,runtime:e.contexts?.runtime||this._options.runtime}),this._options.serverName&&(e.server_name=e.server_name||this._options.serverName),super._prepareEvent(e,t,n,r)}}function IR(e){const t=MT().getScopeData().sdkProcessingMetadata.requestSession;if(t){const n=e?.mechanism?.handled??!0;n&&"crashed"!==t.status?t.status="errored":n||(t.status="crashed")}}function PR(e){return"string"==typeof e?2*e.length:"number"==typeof e?8:"boolean"==typeof e?4:0}const LR=Symbol.for("SentryBufferFullError");function wR(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]||Promise.resolve(void 0)}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return LA(LR);const s=r();return-1===t.indexOf(s)&&t.push(s),s.then(()=>n(s)).then(null,()=>n(s).then(null,()=>{})),s},drain:function(e){return new wA((n,r)=>{let s=t.length;if(!s)return n(!0);const o=setTimeout(()=>{e&&e>0&&n(!1)},e);t.forEach(e=>{PA(e).then(()=>{--s||(clearTimeout(o),n(!0))},r)})})}}}function MR(e,{statusCode:t,headers:n},r=Date.now()){const s={...e},o=n?.["x-sentry-rate-limits"],i=n?.["retry-after"];if(o)for(const e of o.trim().split(",")){const[t,n,,,o]=e.split(":",5),i=parseInt(t,10),a=1e3*(isNaN(i)?60:i);if(n)for(const e of n.split(";"))"metric_bucket"===e&&o&&!o.split(";").includes("custom")||(s[e]=r+a);else s.all=r+a}else i?s.all=r+function(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?6e4:r-t}(i,r):429===t&&(s.all=r+6e4);return s}function xR(e,t,n=wR(e.bufferSize||64)){let r={};return{send:function(s){const o=[];if(zb(s,(t,n)=>{const s=rA(n);!function(e,t,n=Date.now()){return function(e,t){return e[t]||e.all||0}(e,t)>n}(r,s)?o.push(t):e.recordDroppedEvent("ratelimit_backoff",s)}),0===o.length)return PA({});const i=Kb(s[0],o),a=t=>{zb(i,(n,r)=>{e.recordDroppedEvent(t,rA(r))})};return n.add(()=>t({body:qb(i)}).then(e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&cy&&yy.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=MR(r,e),e),e=>{throw a("network_error"),cy&&yy.error("Encountered error running transport request:",e),e})).then(e=>e,e=>{if(e===LR)return cy&&yy.error("Skipped sending event because buffer is full."),a("queue_overflow"),PA({});throw e})},flush:e=>n.drain(e)}}function kR(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function GR(e){return e.split(/[?#]/,1)[0]}function DR(e){const{protocol:t,host:n,path:r}=e;return`${t?`${t}://`:""}${n?.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||""}${r}`}function VR(e,...t){const n=new String(String.raw(e,...t));return n.__sentry_template_string__=e.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),n.__sentry_template_values__=t,n}const UR=VR;function HR(e,t,n=[t],r="npm"){const s=e._metadata||{};s.sdk||(s.sdk={name:`sentry.javascript.${t}`,packages:n.map(e=>({name:`${r}:@sentry/${e}`,version:ly})),version:ly}),e._metadata=s}function jR(e={}){const t=e.client||DT();if(!KA()||!t)return{};const n=LT(py());if(n.getTraceData)return n.getTraceData(e);const r=e.scope||wT(),s=e.span||xb(),o=s?bb(s):function(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return gb(t,r,n)}(r),i=sb(s?Xb(s):Wb(t,r));return fb.test(o)?{"sentry-trace":o,baggage:i}:(yy.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function ZR(e){const t=Object.create(null);try{Object.entries(e).forEach(([e,n])=>{"string"==typeof n&&(t[e]=n)})}catch{}return t}function WR(e){const t=e.headers||{},n=("string"==typeof t["x-forwarded-host"]?t["x-forwarded-host"]:void 0)||("string"==typeof t.host?t.host:void 0),r=("string"==typeof t["x-forwarded-proto"]?t["x-forwarded-proto"]:void 0)||e.protocol||(e.socket?.encrypted?"https":"http"),s=e.url||"",o=function({url:e,protocol:t,host:n}){if(e?.startsWith("http"))return e;if(e&&n)return`${t}://${n}${e}`;return}({url:s,host:n,protocol:r}),i=e.body||void 0,a=e.cookies;return{url:o,method:e.method,query_string:XR(s),headers:ZR(t),cookies:a,data:i}}function XR(e){if(e)try{const t=new URL(e,"http://s.io").search.slice(1);return t.length?t:void 0}catch{return}}const $R=100;function FR(e,t){const n=DT(),r=MT();if(!n)return;const{beforeBreadcrumb:s=null,maxBreadcrumbs:o=$R}=n.getOptions();if(o<=0)return;const i={timestamp:dT(),...e},a=s?_y(()=>s(i,t)):i;null!==a&&(n.emit&&n.emit("beforeAddBreadcrumb",a,t),r.addBreadcrumb(a,o))}let YR;const BR=new WeakMap,KR=()=>({name:"FunctionToString",setupOnce(){YR=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=this.__sentry_original__;const n=BR.has(DT())&&void 0!==t?t:this;return YR.apply(n,e)}}catch{}},setup(e){BR.set(e,!0)}}),JR=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],zR=(e={})=>{let t;return{name:"EventFilters",setup(n){const r=n.getOptions();t=qR(e,r)},processEvent(n,r,s){if(!t){const n=s.getOptions();t=qR(e,n)}return function(e,t){if(e.type){if("transaction"===e.type&&function(e,t){if(!t?.length)return!1;const n=e.transaction;return!!n&&qy(n,t)}(e,t.ignoreTransactions))return cy&&yy.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${aT(e)}`),!0}else{if(function(e,t){if(!t?.length)return!1;return sR(e).some(e=>qy(e,t))}(e,t.ignoreErrors))return cy&&yy.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${aT(e)}`),!0;if(function(e){if(!e.exception?.values?.length)return!1;return!e.message&&!e.exception.values.some(e=>e.stacktrace||e.type&&"Error"!==e.type||e.value)}(e))return cy&&yy.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${aT(e)}`),!0;if(function(e,t){if(!t?.length)return!1;const n=ev(e);return!!n&&qy(n,t)}(e,t.denyUrls))return cy&&yy.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${aT(e)}.\nUrl: ${ev(e)}`),!0;if(!function(e,t){if(!t?.length)return!0;const n=ev(e);return!n||qy(n,t)}(e,t.allowUrls))return cy&&yy.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${aT(e)}.\nUrl: ${ev(e)}`),!0}return!1}(n,t)?null:n}}},QR=(e={})=>({...zR(e),name:"InboundFilters"});function qR(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:JR],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function ev(e){try{const t=[...e.exception?.values??[]].reverse().find(e=>void 0===e.mechanism?.parent_id&&e.stacktrace?.frames?.length),n=t?.stacktrace?.frames;return n?function(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(n):null}catch{return cy&&yy.error(`Cannot extract url for event ${aT(e)}`),null}}function tv(e,t,n,r,s,o){if(!s.exception?.values||!o||!Fy(o.originalException,Error))return;const i=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;i&&(s.exception.values=nv(e,t,r,o.originalException,n,s.exception.values,i,0))}function nv(e,t,n,r,s,o,i,a){if(o.length>=n+1)return o;let c=[...o];if(Fy(r[s],Error)){rv(i,a);const o=e(t,r[s]),u=c.length;sv(o,s,u,a),c=nv(e,t,n,r[s],s,[o,...c],o,u)}return Array.isArray(r.errors)&&r.errors.forEach((r,o)=>{if(Fy(r,Error)){rv(i,a);const u=e(t,r),l=c.length;sv(u,`errors[${o}]`,l,a),c=nv(e,t,n,r,s,[u,...c],u,l)}}),c}function rv(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function sv(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const ov=(e={})=>{const t=e.limit||5,n=e.key||"cause";return{name:"LinkedErrors",preprocessEvent(e,r,s){tv(vR,s.getOptions().stackParser,n,t,e,r)}}};const iv=["X-Client-IP","X-Forwarded-For","Fly-Client-IP","CF-Connecting-IP","Fastly-Client-Ip","True-Client-Ip","X-Real-IP","X-Cluster-Client-IP","X-Forwarded","Forwarded-For","Forwarded","X-Vercel-Forwarded-For"];const av={cookies:!0,data:!0,headers:!0,query_string:!0,url:!0},cv=(e={})=>{const t={...av,...e.include};return{name:"RequestData",processEvent(e,n,r){const{sdkProcessingMetadata:s={}}=e,{normalizedRequest:o,ipAddress:i}=s,a={...t,ip:t.ip??r.getOptions().sendDefaultPii};return o&&function(e,t,n,r){if(e.request={...e.request,...uv(t,r)},r.ip){const r=t.headers&&function(e){const t=iv.map(t=>{const n=e[t],r=Array.isArray(n)?n.join(";"):n;return"Forwarded"===t?function(e){if(!e)return null;for(const t of e.split(";"))if(t.startsWith("for="))return t.slice(4);return null}(r):r?.split(",").map(e=>e.trim())}).reduce((e,t)=>t?e.concat(t):e,[]).find(e=>null!==e&&/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/.test(e));return t||null}(t.headers)||n.ipAddress;r&&(e.user={...e.user,ip_address:r})}}(e,o,{ipAddress:i},a),e}}};function uv(e,t){const n={},r={...e.headers};if(t.headers&&(n.headers=r,t.cookies||delete r.cookie,t.ip||iv.forEach(e=>{delete r[e]})),n.method=e.method,t.url&&(n.url=e.url),t.cookies){const t=e.cookies||(r?.cookie?function(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(-1===r)break;let s=e.indexOf(";",n);if(-1===s)s=e.length;else if(s<r){n=e.lastIndexOf(";",r-1)+1;continue}const o=e.slice(n,r).trim();if(void 0===t[o]){let n=e.slice(r+1,s).trim();34===n.charCodeAt(0)&&(n=n.slice(1,-1));try{t[o]=-1!==n.indexOf("%")?decodeURIComponent(n):n}catch{t[o]=n}}n=s+1}return t}(r.cookie):void 0);n.cookies=t||{}}return t.query_string&&(n.query_string=e.query_string),t.data&&(n.data=e.data),n}function lv(e){const t="console";Ly(t,e),wy(t,pv)}function pv(){"console"in uy&&my.forEach(function(e){e in uy.console&&eT(uy.console,e,function(t){return fy[e]=t,function(...t){My("console",{args:t,level:e});const n=fy[e];n?.apply(uy.console,t)}})})}function dv(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const hv=(e={})=>{const t=e.levels||my,n=e.handled??!0;return{name:"CaptureConsole",setup(e){"console"in uy&&lv(({args:r,level:s})=>{DT()===e&&t.includes(s)&&function(e,t,n){const r={level:dv(t),extra:{arguments:e}};kT(s=>{if(s.addEventProcessor(e=>(e.logger="console",cT(e,{handled:n,type:"console"}),e)),"assert"===t){if(!e[0]){const t=`Assertion failed: ${zy(e.slice(1)," ")||"console.assert"}`;s.setExtra("arguments",e.slice(1)),$A(t,r)}return}const o=e.find(e=>e instanceof Error);if(o)return void XA(o,r);$A(zy(e," "),r)})}(r,s,n)})}}};const mv=()=>{let e;return{name:"Dedupe",processEvent(t){if(t.type)return t;try{if(function(e,t){if(!t)return!1;if(function(e,t){const n=e.message,r=t.message;if(!n&&!r)return!1;if(n&&!r||!n&&r)return!1;if(n!==r)return!1;if(!_v(e,t))return!1;if(!fv(e,t))return!1;return!0}(e,t))return!0;if(function(e,t){const n=gv(t),r=gv(e);if(!n||!r)return!1;if(n.type!==r.type||n.value!==r.value)return!1;if(!_v(e,t))return!1;if(!fv(e,t))return!1;return!0}(e,t))return!0;return!1}(t,e))return cy&&yy.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}};function fv(e,t){let n=Oy(e),r=Oy(t);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],s=n[e];if(t.filename!==s.filename||t.lineno!==s.lineno||t.colno!==s.colno||t.function!==s.function)return!1}return!0}function _v(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch{return!1}}function gv(e){return e.exception?.values?.[0]}const Ev=(e={})=>{const{depth:t=3,captureErrorCause:n=!0}=e;return{name:"ExtraErrorData",processEvent(e,r,s){const{maxValueLength:o=250}=s.getOptions();return function(e,t={},n,r,s){if(!t.originalException||!Uy(t.originalException))return e;const o=t.originalException.name||t.originalException.constructor.name,i=Sv(t.originalException,r,s);if(i){const t={...e.contexts},r=Fb(i,n);return Xy(r)&&(tT(r,"__sentry_skip_normalization__",!0),t[o]=r),{...e,contexts:t}}return e}(e,r,t,n,o)}}};function Sv(e,t,n){try{const r=["name","message","stack","line","column","fileName","lineNumber","columnNumber","toJSON"],s={};for(const t of Object.keys(e)){if(-1!==r.indexOf(t))continue;const o=e[t];s[t]=Uy(o)||"string"==typeof o?Jy(`${o}`,n):o}if(t&&void 0!==e.cause)if(Uy(e.cause)){const t=e.cause.name||e.cause.constructor.name;s.cause={[t]:Sv(e.cause,!1,n)}}else s.cause=e.cause;if("function"==typeof e.toJSON){const t=e.toJSON();for(const e of Object.keys(t)){const n=t[e];s[e]=Uy(n)?n.toString():n}}return s}catch(e){cy&&yy.error("Unable to extract extra data from the Error object:",e)}return null}const yv=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function Tv(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=yv.exec(t);return n?n.slice(1):[]}function bv(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const s=r>=0?e[r]:"/";s&&(t=`${s}/${t}`,n="/"===s.charAt(0))}return t=function(e,t){let n=0;for(let t=e.length-1;t>=0;t--){const r=e[t];"."===r?e.splice(t,1):".."===r?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}(t.split("/").filter(e=>!!e),!n).join("/"),(n?"/":"")+t||"."}function Av(e){let t=0;for(;t<e.length&&""===e[t];t++);let n=e.length-1;for(;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}const Rv=(e={})=>{const t=e.root,n=e.prefix||"app:///",r="window"in uy&&!!uy.window,s=e.iteratee||function({isBrowser:e,root:t,prefix:n}){return r=>{if(!r.filename)return r;const s=/^[a-zA-Z]:\\/.test(r.filename)||r.filename.includes("\\")&&!r.filename.includes("/"),o=/^\//.test(r.filename);if(e){if(t){const e=r.filename;0===e.indexOf(t)&&(r.filename=e.replace(t,n))}}else if(s||o){const e=s?r.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):r.filename,o=t?function(e,t){e=bv(e).slice(1),t=bv(t).slice(1);const n=Av(e.split("/")),r=Av(t.split("/")),s=Math.min(n.length,r.length);let o=s;for(let e=0;e<s;e++)if(n[e]!==r[e]){o=e;break}let i=[];for(let e=o;e<n.length;e++)i.push("..");return i=i.concat(r.slice(o)),i.join("/")}(t,e):function(e,t){let n=Tv(e)[2]||"";return t&&n.slice(-1*t.length)===t&&(n=n.slice(0,n.length-t.length)),n}(e);r.filename=`${n}${o}`}return r}}({isBrowser:r,root:t,prefix:n});return{name:"RewriteFrames",processEvent(e){let t=e;return e.exception&&Array.isArray(e.exception.values)&&(t=function(e){try{return{...e,exception:{...e.exception,values:e.exception.values.map(e=>{return{...e,...e.stacktrace&&{stacktrace:(t=e.stacktrace,{...t,frames:t?.frames?.map(e=>s(e))})}};var t})}}}catch{return e}}(t)),t}}};const vv=["reauthenticate","signInAnonymously","signInWithOAuth","signInWithIdToken","signInWithOtp","signInWithPassword","signInWithSSO","signOut","signUp","verifyOtp"],Nv=["createUser","deleteUser","listUsers","getUserById","updateUserById","inviteUserByEmail"],Cv={eq:"eq",neq:"neq",gt:"gt",gte:"gte",lt:"lt",lte:"lte",like:"like","like(all)":"likeAllOf","like(any)":"likeAnyOf",ilike:"ilike","ilike(all)":"ilikeAllOf","ilike(any)":"ilikeAnyOf",is:"is",in:"in",cs:"contains",cd:"containedBy",sr:"rangeGt",nxl:"rangeGte",sl:"rangeLt",nxr:"rangeLte",adj:"rangeAdjacent",ov:"overlaps",fts:"",plfts:"plain",phfts:"phrase",wfts:"websearch",not:"not"},Ov=["select","insert","upsert","update","delete"];function Iv(e){try{e.__SENTRY_INSTRUMENTED__=!0}catch{}}function Pv(e){try{return e.__SENTRY_INSTRUMENTED__}catch{return!1}}function Lv(e,t){if(""===t||"*"===t)return"select(*)";if("select"===e)return`select(${t})`;if("or"===e||e.endsWith(".or"))return`${e}${t}`;const[n,...r]=t.split(".");let s;return s=n?.startsWith("fts")?"textSearch":n?.startsWith("plfts")?"textSearch[plain]":n?.startsWith("phfts")?"textSearch[phrase]":n?.startsWith("wfts")?"textSearch[websearch]":n&&Cv[n]||"filter",`${s}(${e}, ${r.join(".")})`}function wv(e,t=!1){return new Proxy(e,{apply:(n,r,s)=>EA({name:`auth ${t?"(admin) ":""}${e.name}`,attributes:{[ZT]:"auto.db.supabase",[jT]:"db","db.system":"postgresql","db.operation":`auth.${t?"admin.":""}${e.name}`}},e=>Reflect.apply(n,r,s).then(t=>(t&&"object"==typeof t&&"error"in t&&t.error?(e.setStatus({code:2}),XA(t.error,{mechanism:{handled:!1,type:"auto.db.supabase.auth"}})):e.setStatus({code:1}),e.end(),t)).catch(t=>{throw e.setStatus({code:2}),e.end(),XA(t,{mechanism:{handled:!1,type:"auto.db.supabase.auth"}}),t}).then(...s))})}function Mv(e){Pv(e.prototype.from)||(e.prototype.from=new Proxy(e.prototype.from,{apply(e,t,n){const r=Reflect.apply(e,t,n);return function(e){for(const t of Ov)Pv(e.prototype[t])||(e.prototype[t]=new Proxy(e.prototype[t],{apply(e,n,r){const s=Reflect.apply(e,n,r),o=s.constructor;return cy&&yy.log(`Instrumenting ${t} operation's PostgRESTFilterBuilder`),xv(o),s}}),Iv(e.prototype[t]))}(r.constructor),r}}),Iv(e.prototype.from))}function xv(e){Pv(e.prototype.then)||(e.prototype.then=new Proxy(e.prototype.then,{apply(e,t,n){const r=Ov,s=t,o=function(e,t={}){switch(e){case"GET":return"select";case"POST":return t.Prefer?.includes("resolution=")?"upsert":"insert";case"PATCH":return"update";case"DELETE":return"delete";default:return"<unknown-op>"}}(s.method,s.headers);if(!r.includes(o))return Reflect.apply(e,t,n);if(!s?.url?.pathname||"string"!=typeof s.url.pathname)return Reflect.apply(e,t,n);const i=s.url.pathname.split("/"),a=i.length>0?i[i.length-1]:"",c=[];for(const[e,t]of s.url.searchParams.entries())c.push(Lv(e,t));const u=Object.create(null);if(Xy(s.body))for(const[e,t]of Object.entries(s.body))u[e]=t;const l=`${"select"===o?"":`${o}${u?"(...) ":""}`}${c.join(" ")} from(${a})`,p={"db.table":a,"db.schema":s.schema,"db.url":s.url.origin,"db.sdk":s.headers["X-Client-Info"],"db.system":"postgresql","db.operation":o,[ZT]:"auto.db.supabase",[jT]:"db"};return c.length&&(p["db.query"]=c),Object.keys(u).length&&(p["db.body"]=u),EA({name:l,attributes:p},r=>Reflect.apply(e,t,[]).then(e=>{if(r&&(e&&"object"==typeof e&&"status"in e&&JT(r,e.status||500),r.end()),e.error){const t=new Error(e.error.message);e.error.code&&(t.code=e.error.code),e.error.details&&(t.details=e.error.details);const n={};c.length&&(n.query=c),Object.keys(u).length&&(n.body=u),XA(t,e=>(e.addEventProcessor(e=>(cT(e,{handled:!1,type:"auto.db.supabase.postgres"}),e)),e.setContext("supabase",n),e))}const t={type:"supabase",category:`db.${o}`,message:l},n={};return c.length&&(n.query=c),Object.keys(u).length&&(n.body=u),Object.keys(n).length&&(t.data=n),FR(t),e},e=>{throw r&&(JT(r,500),r.end()),e}).then(...n))}}),Iv(e.prototype.then))}const kv=e=>{if(!e)return void(cy&&yy.warn("Supabase integration was not installed because no Supabase client was provided."));Mv(e.constructor===Function?e:e.constructor),function(e){const t=e.auth;if(t&&!Pv(e.auth)){for(const n of vv){const r=t[n];r&&"function"==typeof e.auth[n]&&(e.auth[n]=wv(r))}for(const n of Nv){const r=t.admin[n];r&&"function"==typeof e.auth.admin[n]&&(e.auth.admin[n]=wv(r,!0))}Iv(e.auth)}}(e)},Gv=e=>{return t=e.supabaseClient,{setupOnce(){kv(t)},name:"Supabase"};var t};function Dv(e){return{...e,path:"path"in e&&Array.isArray(e.path)?e.path.join("."):void 0,keys:"keys"in e?JSON.stringify(e.keys):void 0,unionErrors:"unionErrors"in e?JSON.stringify(e.unionErrors):void 0}}function Vv(e){return e.map(e=>"number"==typeof e?"<array>":e).join(".")}function Uv(e){const t=new Set;for(const n of e.issues){const e=Vv(n.path);e.length>0&&t.add(e)}const n=Array.from(t);if(0===n.length){let t="variable";if(e.issues.length>0){const n=e.issues[0];void 0!==n&&"expected"in n&&"string"==typeof n.expected&&(t=n.expected)}return`Failed to validate ${t}`}return`Failed to validate keys: ${Jy(n.join(", "),100)}`}function Hv(e,t=!1,n,r){if(!(n.exception?.values&&r.originalException&&(s=r.originalException,Uy(s)&&"ZodError"===s.name&&Array.isArray(s.issues))&&0!==r.originalException.issues.length))return n;var s;try{const s=(t?r.originalException.issues:r.originalException.issues.slice(0,e)).map(Dv);return t&&(Array.isArray(r.attachments)||(r.attachments=[]),r.attachments.push({filename:"zod_issues.json",data:JSON.stringify({issues:s})})),{...n,exception:{...n.exception,values:[{...n.exception.values[0],value:Uv(r.originalException)},...n.exception.values.slice(1)]},extra:{...n.extra,"zoderror.issues":s.slice(0,e)}}}catch(e){return{...n,extra:{...n.extra,"zoderrors sentry integration parse error":{message:"an exception was thrown while processing ZodError within applyZodErrorsToEvent()",error:e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:"unknown"}}}}}const jv=(e={})=>{const t=e.limit??10;return{name:"ZodErrors",processEvent:(n,r)=>Hv(t,e.saveZodIssuesAsAttachment,n,r)}},Zv=(e={})=>{const t=new Set(e.levels||my);return{name:"Console",setup(e){lv(({args:n,level:r})=>{DT()===e&&t.has(r)&&function(e,t){const n={category:"console",data:{arguments:t,logger:"console"},level:dv(e),message:Wv(t)};if("assert"===e){if(!1!==t[0])return;{const e=t.slice(1);n.message=e.length>0?`Assertion failed: ${Wv(e)}`:"Assertion failed",n.data.arguments=e}}FR(n,{input:t,level:e})}(r,n)})}}};function Wv(e){return"util"in uy&&"function"==typeof uy.util.format?uy.util.format(...e):zy(e," ")}const Xv="flag.evaluation.";function $v(e,t,n=100){const r=wT().getScopeData().contexts;r.flags||(r.flags={values:[]});!function(e,t,n,r){if("boolean"!=typeof n)return;if(e.length>r)return void(cy&&yy.error(`[Feature Flags] insertToFlagBuffer called on a buffer larger than maxSize=${r}`));const s=e.findIndex(e=>e.flag===t);-1!==s&&e.splice(s,1);e.length===r&&e.shift();e.push({flag:t,result:n})}(r.flags.values,e,t,n)}const Fv=()=>({name:"FeatureFlags",processEvent:(e,t,n)=>function(e){const t=wT().getScopeData().contexts.flags,n=t?t.values:[];return n.length?(void 0===e.contexts&&(e.contexts={}),e.contexts.flags={values:[...n]},e):e}(e),addFeatureFlag(e,t){$v(e,t),function(e,t,n=10){if("boolean"!=typeof t)return;const r=xb();if(!r)return;const s=Nb(r).data;if(`${Xv}${e}`in s)return void r.setAttribute(`${Xv}${e}`,t);Object.keys(s).filter(e=>e.startsWith(Xv)).length<n&&r.setAttribute(`${Xv}${e}`,t)}(e,t)}});function Yv(e){return!!e&&void 0!==e._profiler&&"function"==typeof e._profiler.start&&"function"==typeof e._profiler.stop}const Bv={startProfiler:function(){const e=DT();if(!e)return void(cy&&yy.warn("No Sentry client available, profiling is not started"));const t=e.getIntegrationByName("ProfilingIntegration");t?Yv(t)?t._profiler.start():cy&&yy.warn("Profiler is not available on profiling integration."):cy&&yy.warn("ProfilingIntegration is not available")},stopProfiler:function(){const e=DT();if(!e)return void(cy&&yy.warn("No Sentry client available, profiling is not started"));const t=e.getIntegrationByName("ProfilingIntegration");t?Yv(t)?t._profiler.stop():cy&&yy.warn("Profiler is not available on profiling integration."):cy&&yy.warn("ProfilingIntegration is not available")}},Kv={mechanism:{handled:!1,data:{function:"trpcMiddleware"}}};function Jv(e,t,n){try{if(!DT())return;const r=xb();r?.isRecording()&&r.setStatus({code:2,message:"internal_error"}),XA(e,{mechanism:{type:"mcp_server",handled:!1,data:{error_type:t||"handler_execution",...n}}})}catch{}}function zv(e,t){eT(e,t,e=>function(n,...r){const s=r[r.length-1];if("function"!=typeof s)return e.call(this,n,...r);const o=function(e,t,n){return function(...r){try{return Qv.call(this,e,t,n,r)}catch(t){return cy&&yy.warn("MCP handler wrapping failed:",t),e.apply(this,r)}}}(s,t,n);return e.call(this,n,...r.slice(0,-1),o)})}function Qv(e,t,n,r){try{const s=e.apply(this,r);return s&&"object"==typeof s&&"function"==typeof s.then?Promise.resolve(s).catch(e=>{throw qv(e,t,n),e}):s}catch(e){throw qv(e,t,n),e}}function qv(e,t,n){try{const r={};"tool"===t?(r.tool_name=n,"ProtocolValidationError"===e.name||e.message.includes("validation")||e.message.includes("protocol")?Jv(e,"validation",r):"ServerTimeoutError"===e.name||e.message.includes("timed out")||e.message.includes("timeout")?Jv(e,"timeout",r):Jv(e,"tool_execution",r)):"resource"===t?(r.resource_uri=n,Jv(e,"resource_execution",r)):"prompt"===t&&(r.prompt_name=n,Jv(e,"prompt_execution",r))}catch(e){}}function eN(e){!function(e){zv(e,"tool")}(e),function(e){zv(e,"resource")}(e),function(e){zv(e,"prompt")}(e)}const tN="mcp.method.name",nN="mcp.request.id",rN="mcp.session.id",sN="mcp.transport",oN="mcp.protocol.version",iN="mcp.resource.uri",aN="mcp.tool.result.content_count",cN="mcp.prompt.result.description",uN="mcp.request.argument",lN="mcp.logging.message",pN="network.transport",dN="network.protocol.version",hN="client.address",mN="client.port",fN="mcp.server",_N="auto.mcp.notification",gN=new Set([hN,mN,lN,cN,"mcp.prompt.result.message_content",iN,"mcp.tool.result.content"]);function EN(e,t){return t?e:Object.entries(e).reduce((e,[t,n])=>(function(e){return!!gN.has(e)||!!e.startsWith(`${uN}.`)||!(!e.startsWith("mcp.tool.result.")&&!e.startsWith("mcp.prompt.result.")||e.endsWith("_count")||e.endsWith("_error")||e.endsWith(".is_error"))}(t)||(e[t]=n),e),{})}function SN(e){return"object"==typeof e&&null!==e&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"method"in e&&!("id"in e)}function yN(e){return null!=e&&"object"==typeof e}function TN(e){if(!yN(e))return{};const t=Array.isArray(e.content)?function(e){const t={[aN]:e.length};for(const[n,r]of e.entries()){if(!yN(r))continue;const s=1===e.length?"mcp.tool.result":`mcp.tool.result.${n}`,o=(e,n)=>{"string"==typeof n&&(t[`${s}.${e}`]=n)};o("content_type",r.type),o("mime_type",r.mimeType),o("uri",r.uri),o("name",r.name),"string"==typeof r.text&&(t[`${s}.content`]=r.text),"string"==typeof r.data&&(t[`${s}.data_size`]=r.data.length);const i=r.resource;yN(i)&&(o("resource_uri",i.uri),o("resource_mime_type",i.mimeType))}return t}(e.content):{};return"boolean"==typeof e.isError&&(t["mcp.tool.result.is_error"]=e.isError),t}const bN=new WeakMap;function AN(e){let t=bN.get(e);return t||(t=new Map,bN.set(e,t)),t}function RN(e,t,n){const r=AN(e),s=r.get(t);if(s){const{span:e,method:o}=s;if("tools/call"===o){const t=TN(n),r=DT(),s=EN(t,Boolean(r?.getOptions().sendDefaultPii));e.setAttributes(s)}else if("prompts/get"===o){const t=function(e){const t={};if(!yN(e))return t;if("string"==typeof e.description&&(t[cN]=e.description),Array.isArray(e.messages)){t["mcp.prompt.result.message_count"]=e.messages.length;const n=e.messages;for(const[e,r]of n.entries()){if(!yN(r))continue;const s=1===n.length?"mcp.prompt.result":`mcp.prompt.result.${e}`;if(((e,r)=>{if("string"==typeof r){const o=1===n.length?`${s}.message_${e}`:`${s}.${e}`;t[o]=r}})("role",r.role),yN(r.content)){const e=r.content;if("string"==typeof e.text){const r=1===n.length?`${s}.message_content`:`${s}.content`;t[r]=e.text}}}}return t}(n),r=DT(),s=EN(t,Boolean(r?.getOptions().sendDefaultPii));e.setAttributes(s)}e.end(),r.delete(t)}}const vN=new WeakMap;function NN(e){const t={};return yN(e)&&("string"==typeof e.name&&(t.name=e.name),"string"==typeof e.title&&(t.title=e.title),"string"==typeof e.version&&(t.version=e.version)),t}function CN(e){const t=function(e){return vN.get(e)?.clientInfo}(e),n={};return t?.name&&(n["mcp.client.name"]=t.name),t?.title&&(n["mcp.client.title"]=t.title),t?.version&&(n["mcp.client.version"]=t.version),n}function ON(e){const t=function(e){return vN.get(e)}(e)?.serverInfo,n={};return t?.name&&(n["mcp.server.name"]=t.name),t?.title&&(n["mcp.server.title"]=t.title),t?.version&&(n["mcp.server.version"]=t.version),n}function IN(e,t){const n=e&&"sessionId"in e?e.sessionId:void 0,r=t?function(e){return{address:e?.requestInfo?.remoteAddress||e?.clientAddress||e?.request?.ip||e?.request?.connection?.remoteAddress,port:e?.requestInfo?.remotePort||e?.clientPort||e?.request?.connection?.remotePort}}(t):{},{mcpTransport:s,networkTransport:o}=function(e){if(!e?.constructor)return{mcpTransport:"unknown",networkTransport:"unknown"};const t="string"==typeof e.constructor?.name?e.constructor.name:"unknown";let n="unknown";const r=t.toLowerCase();return r.includes("stdio")?n="pipe":(r.includes("http")||r.includes("sse"))&&(n="tcp"),{mcpTransport:t,networkTransport:n}}(e),i=CN(e),a=ON(e),c=function(e){return vN.get(e)?.protocolVersion}(e);return{...n&&{[rN]:n},...r.address&&{[hN]:r.address},...r.port&&{[mN]:r.port},[sN]:s,[pN]:o,[dN]:"2.0",...c&&{[oN]:c},...i,...a}}const PN={"tools/call":{targetField:"name",targetAttribute:"mcp.tool.name",captureArguments:!0,argumentsField:"arguments"},"resources/read":{targetField:"uri",targetAttribute:iN,captureUri:!0},"resources/subscribe":{targetField:"uri",targetAttribute:iN},"resources/unsubscribe":{targetField:"uri",targetAttribute:iN},"prompts/get":{targetField:"name",targetAttribute:"mcp.prompt.name",captureName:!0,captureArguments:!0,argumentsField:"arguments"}};function LN(e,t){const n=PN[e];if(!n)return{attributes:{}};const r=n.targetField&&"string"==typeof t?.[n.targetField]?t[n.targetField]:void 0;return{target:r,attributes:r&&n.targetAttribute?{[n.targetAttribute]:r}:{}}}function wN(e,t){const n={},r=PN[e];if(!r)return n;if(r.captureArguments&&r.argumentsField&&t?.[r.argumentsField]){const e=t[r.argumentsField];if("object"==typeof e&&null!==e)for(const[t,r]of Object.entries(e))n[`${uN}.${t.toLowerCase()}`]=JSON.stringify(r)}return r.captureUri&&t?.uri&&(n[`${uN}.uri`]=JSON.stringify(t.uri)),r.captureName&&t?.name&&(n[`${uN}.name`]=JSON.stringify(t.name)),n}function MN(e,t){const n={};switch(e){case"notifications/cancelled":t?.requestId&&(n["mcp.cancelled.request_id"]=String(t.requestId)),t?.reason&&(n["mcp.cancelled.reason"]=String(t.reason));break;case"notifications/message":t?.level&&(n["mcp.logging.level"]=String(t.level)),t?.logger&&(n["mcp.logging.logger"]=String(t.logger)),void 0!==t?.data&&(n["mcp.logging.data_type"]=typeof t.data,"string"==typeof t.data?n[lN]=t.data:n[lN]=JSON.stringify(t.data));break;case"notifications/progress":t?.progressToken&&(n["mcp.progress.token"]=String(t.progressToken)),"number"==typeof t?.progress&&(n["mcp.progress.current"]=t.progress),"number"==typeof t?.total&&(n["mcp.progress.total"]=t.total,"number"==typeof t?.progress&&(n["mcp.progress.percentage"]=t.progress/t.total*100)),t?.message&&(n["mcp.progress.message"]=String(t.message));break;case"notifications/resources/updated":if(t?.uri){n[iN]=String(t.uri);const e=function(e,t){const n=e.indexOf("://")<=0&&0!==e.indexOf("//"),r=t??(n?"thismessage:/":void 0);try{if("canParse"in URL&&!URL.canParse(e,r))return;const t=new URL(e,r);return n?{isRelative:n,pathname:t.pathname,search:t.search,hash:t.hash}:t}catch{}}(String(t.uri));e&&!function(e){return"isRelative"in e}(e)&&(n["mcp.resource.protocol"]=e.protocol.replace(":",""))}break;case"notifications/initialized":n["mcp.lifecycle.phase"]="initialization_complete",n["mcp.protocol.ready"]=1}return n}function xN(e,t,n){if("request"===e){const e=t,r=LN(e.method,n||{});return{...void 0!==e.id&&{[nN]:String(e.id)},...r.attributes,...wN(e.method,n||{})}}return MN(t.method,n||{})}function kN(e,t){return t?`${e} ${t}`:e}function GN(e){let t,n;switch(e){case"request":t=fN,n="auto.function.mcp_server";break;case"notification-incoming":t="mcp.notification.client_to_server",n=_N;break;case"notification-outgoing":t="mcp.notification.server_to_client",n=_N}return{[jT]:t,[ZT]:n,[UT]:"route"}}function DN(e){const{type:t,message:n,transport:r,extra:s,callback:o}=e,{method:i}=n,a=n.params;let c;if("request"===t){c=kN(i,LN(i,a||{}).target)}else c=i;const u={...IN(r,s),[tN]:i,...xN(t,n,a),...GN(t)},l=DT();return EA({name:c,forceTransaction:!0,attributes:EN(u,Boolean(l?.getOptions().sendDefaultPii))},o)}function VN(e){e.onmessage&&eT(e,"onmessage",e=>function(t,n){if(function(e){return"object"==typeof e&&null!==e&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"method"in e&&"id"in e}(t)){if("initialize"===t.method)try{!function(e,t){e.sessionId&&vN.set(e,t)}(this,function(e){const t={};return yN(e.params)&&("string"==typeof e.params.protocolVersion&&(t.protocolVersion=e.params.protocolVersion),e.params.clientInfo&&(t.clientInfo=NN(e.params.clientInfo))),t}(t))}catch{}return GT(MT().clone(),()=>{const r=function(e,t,n){const{method:r}=e,s=e.params,o=kN(r,LN(r,s||{}).target),i={...IN(t,n),[tN]:r,...xN("request",e,s),...GN("request")},a=DT(),c=EN(i,Boolean(a?.getOptions().sendDefaultPii));return{name:o,op:fN,forceTransaction:!0,attributes:c}}(t,this,n),s=yA(r);return function(e,t,n,r){AN(e).set(t,{span:n,method:r,startTime:Date.now()})}(this,t.id,s,t.method),TA(s,()=>e.call(this,t,n))})}return SN(t)?function(e,t,n,r){return DN({type:"notification-incoming",message:e,transport:t,extra:n,callback:r})}(t,this,n,()=>e.call(this,t,n)):e.call(this,t,n)})}function UN(e){e.send&&eT(e,"send",e=>async function(...t){const[n]=t;if(SN(n))return function(e,t,n){return DN({type:"notification-outgoing",message:e,transport:t,callback:n})}(n,this,()=>e.call(this,...t));if(function(e){return"object"==typeof e&&null!==e&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"id"in e&&("result"in e||"error"in e)}(n)&&null!==n.id&&void 0!==n.id){if(n.error&&function(e){try{if(e&&"object"==typeof e&&"code"in e&&"message"in e){const t=e;if(-32603===t.code||t.code>=-32099&&t.code<=-32e3){const e=new Error(t.message);e.name=`JsonRpcError_${t.code}`,Jv(e,"protocol")}}}catch{}}(n.error),yN(n.result)&&(n.result.protocolVersion||n.result.serverInfo))try{!function(e,t){if(e.sessionId){const n=vN.get(e)||{};vN.set(e,{...n,...t})}}(this,function(e){const t={};return yN(e)&&("string"==typeof e.protocolVersion&&(t.protocolVersion=e.protocolVersion),e.serverInfo&&(t.serverInfo=NN(e.serverInfo))),t}(n.result))}catch{}RN(this,n.id,n.result)}return e.call(this,...t)})}function HN(e){e.onclose&&eT(e,"onclose",e=>function(...t){return function(e){const t=bN.get(e);if(t){for(const[,e]of t)e.span.setStatus({code:2,message:"cancelled"}),e.span.end();t.clear()}}(this),function(e){vN.delete(e)}(this),e.call(this,...t)})}function jN(e){e.onerror&&eT(e,"onerror",e=>function(t){return function(e){try{Jv(e,"transport")}catch{}}(t),e.call(this,t)})}const ZN=new WeakSet;const WN={[ZT]:"auto.console.logging"},XN=(e={})=>{const t=e.levels||my;return{name:"ConsoleLogs",setup(e){const{enableLogs:n,normalizeDepth:r=3,normalizeMaxBreadth:s=1e3}=e.getOptions();n?lv(({args:n,level:o})=>{if(DT()!==e||!t.includes(o))return;if("assert"===o){if(!n[0]){const e=n.slice(1);yR({level:"error",message:e.length>0?`Assertion failed: ${$N(e,r,s)}`:"Assertion failed",attributes:WN})}return}const i="log"===o;yR({level:i?"info":o,message:$N(n,r,s),severityNumber:i?10:void 0,attributes:WN})}):cy&&yy.warn("`enableLogs` is not enabled, ConsoleLogs integration disabled")}}};function $N(e,t,n){return"util"in uy&&"function"==typeof uy.util.format?uy.util.format(...e):function(e,t,n){return e.map(e=>Wy(e)?String(e):JSON.stringify(Fb(e,t,n))).join(" ")}(e,t,n)}const FN=new Map,YN="gen_ai.prompt",BN="gen_ai.system",KN="gen_ai.request.model",JN="gen_ai.request.stream",zN="gen_ai.request.temperature",QN="gen_ai.request.frequency_penalty",qN="gen_ai.request.top_p",eC="gen_ai.response.finish_reasons",tC="gen_ai.response.model",nC="gen_ai.response.id",rC="gen_ai.usage.input_tokens",sC="gen_ai.usage.output_tokens",oC="gen_ai.usage.total_tokens",iC="gen_ai.operation.name",aC="gen_ai.request.messages",cC="gen_ai.response.text",uC="gen_ai.response.streaming",lC="gen_ai.response.tool_calls",pC="openai.response.id",dC="openai.response.model",hC="openai.response.timestamp",mC="openai.usage.completion_tokens",fC="openai.usage.prompt_tokens",_C="chat",gC="responses",EC="anthropic.response.timestamp";function SC(e,t){const n=e.parent_span_id;if(!n)return;const r=e.data[rC],s=e.data[sC];if("number"==typeof r||"number"==typeof s){const e=t.get(n)||{inputTokens:0,outputTokens:0};"number"==typeof r&&(e.inputTokens+=r),"number"==typeof s&&(e.outputTokens+=s),t.set(n,e)}}function yC(e,t){const n=t.get(e.span_id);n&&e.data&&(n.inputTokens>0&&(e.data[rC]=n.inputTokens),n.outputTokens>0&&(e.data[sC]=n.outputTokens),(n.inputTokens>0||n.outputTokens>0)&&(e.data["gen_ai.usage.total_tokens"]=n.inputTokens+n.outputTokens))}function TC(e){return FN.get(e)}function bC(e){FN.delete(e)}const AC="ai.prompt",RC="ai.model.id",vC="ai.response.providerMetadata",NC="ai.telemetry.functionId",CC="gen_ai.response.model",OC="gen_ai.usage.input_tokens",IC="gen_ai.usage.output_tokens",PC="ai.toolCall.name",LC="ai.toolCall.id";function wC(e,t){e.setAttribute(ZT,t)}function MC(e){const{data:t,description:n}=Nb(e);if(!n)return;if(t[PC]&&t[LC]&&"ai.toolCall"===n)return void function(e,t){wC(e,"auto.vercelai.otel"),e.setAttribute(jT,"gen_ai.execute_tool"),GC(t,PC,"gen_ai.tool.name"),GC(t,LC,"gen_ai.tool.call.id");const n=t["gen_ai.tool.call.id"];"string"==typeof n&&FN.set(n,e);t["gen_ai.tool.type"]||e.setAttribute("gen_ai.tool.type","function");const r=t["gen_ai.tool.name"];r&&e.updateName(`execute_tool ${r}`)}(e,t);const r=t[RC],s=t["ai.model.provider"];"string"==typeof r&&"string"==typeof s&&r&&s&&function(e,t,n){wC(e,"auto.vercelai.otel");const r=t.replace("ai.","");e.setAttribute("ai.pipeline.name",r),e.updateName(r);const s=n[NC];s&&"string"==typeof s&&t.split(".").length-1==1&&(e.updateName(`${r} ${s}`),e.setAttribute("gen_ai.function_id",s));n[AC]&&e.setAttribute("gen_ai.prompt",n[AC]);n[RC]&&!n[CC]&&e.setAttribute(CC,n[RC]);if(e.setAttribute("ai.streaming",t.includes("stream")),"ai.generateText"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.generateText.doGenerate"===t)return e.setAttribute(jT,"gen_ai.generate_text"),void e.updateName(`generate_text ${n[RC]}`);if("ai.streamText"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.streamText.doStream"===t)return e.setAttribute(jT,"gen_ai.stream_text"),void e.updateName(`stream_text ${n[RC]}`);if("ai.generateObject"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.generateObject.doGenerate"===t)return e.setAttribute(jT,"gen_ai.generate_object"),void e.updateName(`generate_object ${n[RC]}`);if("ai.streamObject"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.streamObject.doStream"===t)return e.setAttribute(jT,"gen_ai.stream_object"),void e.updateName(`stream_object ${n[RC]}`);if("ai.embed"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.embed.doEmbed"===t)return e.setAttribute(jT,"gen_ai.embed"),void e.updateName(`embed ${n[RC]}`);if("ai.embedMany"===t)return void e.setAttribute(jT,"gen_ai.invoke_agent");if("ai.embedMany.doEmbed"===t)return e.setAttribute(jT,"gen_ai.embed_many"),void e.updateName(`embed_many ${n[RC]}`);if(t.startsWith("ai.stream"))e.setAttribute(jT,"ai.run")}(e,n,t)}function xC(e){if("transaction"===e.type&&e.spans){const t=new Map;for(const n of e.spans)kC(n),SC(n,t);for(const n of e.spans)"gen_ai.invoke_agent"===n.op&&yC(n,t);const n=e.contexts?.trace;n&&"gen_ai.invoke_agent"===n.op&&yC(n,t)}return e}function kC(e){const{data:t,origin:n}=e;if("auto.vercelai.otel"===n){GC(t,"ai.usage.completionTokens",IC),GC(t,"ai.usage.promptTokens",OC),"number"==typeof t[IC]&&"number"==typeof t[OC]&&(t["gen_ai.usage.total_tokens"]=t[IC]+t[OC]),GC(t,"ai.prompt.messages","gen_ai.request.messages"),GC(t,"ai.response.text","gen_ai.response.text"),GC(t,"ai.response.toolCalls","gen_ai.response.tool_calls"),GC(t,"ai.response.object","gen_ai.response.object"),GC(t,"ai.prompt.tools","gen_ai.request.available_tools"),GC(t,"ai.toolCall.args","gen_ai.tool.input"),GC(t,"ai.toolCall.result","gen_ai.tool.output"),function(e){const t=e[vC];if(t)try{const n=JSON.parse(t);n.openai&&(VC(e,"gen_ai.usage.input_tokens.cached",n.openai.cachedPromptTokens),VC(e,"gen_ai.usage.output_tokens.reasoning",n.openai.reasoningTokens),VC(e,"gen_ai.usage.output_tokens.prediction_accepted",n.openai.acceptedPredictionTokens),VC(e,"gen_ai.usage.output_tokens.prediction_rejected",n.openai.rejectedPredictionTokens),VC(e,"gen_ai.conversation.id",n.openai.responseId)),n.anthropic&&(VC(e,"gen_ai.usage.input_tokens.cached",n.anthropic.cacheReadInputTokens),VC(e,"gen_ai.usage.input_tokens.cache_write",n.anthropic.cacheCreationInputTokens)),n.bedrock?.usage&&(VC(e,"gen_ai.usage.input_tokens.cached",n.bedrock.usage.cacheReadInputTokens),VC(e,"gen_ai.usage.input_tokens.cache_write",n.bedrock.usage.cacheWriteInputTokens)),n.deepseek&&(VC(e,"gen_ai.usage.input_tokens.cached",n.deepseek.promptCacheHitTokens),VC(e,"gen_ai.usage.input_tokens.cache_miss",n.deepseek.promptCacheMissTokens))}catch{}}(t);for(const e of Object.keys(t))e.startsWith("ai.")&&GC(t,e,`vercel.${e}`)}}function GC(e,t,n){null!=e[t]&&(e[n]=e[t],delete e[t])}function DC(e){e.on("spanStart",MC),e.addEventProcessor(Object.assign(xC,{id:"VercelAiEventProcessor"}))}function VC(e,t,n){null!=n&&(e[t]=n)}const UC="OpenAI",HC=["responses.create","chat.completions.create"],jC=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta","response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"];function ZC(e){return e.includes("chat.completions")?_C:e.includes("responses")?gC:e.split(".").pop()||"unknown"}function WC(e){return`gen_ai.${ZC(e)}`}function XC(e){return null!==e&&"object"==typeof e&&"type"in e&&"string"==typeof e.type&&e.type.startsWith("response.")}function $C(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion.chunk"===e.object}function FC(e,t,n,r){void 0!==t&&e.setAttributes({[fC]:t,[rC]:t}),void 0!==n&&e.setAttributes({[mC]:n,[sC]:n}),void 0!==r&&e.setAttributes({[oC]:r})}function YC(e,t,n,r){e.setAttributes({[pC]:t,[nC]:t}),e.setAttributes({[dC]:n,[tC]:n}),e.setAttributes({[hC]:new Date(1e3*r).toISOString()})}function BC(e,t){for(const n of e){const e=n.index;if(void 0!==e&&n.function)if(e in t.chatCompletionToolCalls){const r=t.chatCompletionToolCalls[e];n.function.arguments&&r?.function&&(r.function.arguments+=n.function.arguments)}else t.chatCompletionToolCalls[e]={...n,function:{name:n.function.name,arguments:n.function.arguments||""}}}}function KC(e,t,n){t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const r of e.choices??[])n&&(r.delta?.content&&t.responseTexts.push(r.delta.content),r.delta?.tool_calls&&BC(r.delta.tool_calls,t)),r.finish_reason&&t.finishReasons.push(r.finish_reason)}function JC(e,t,n,r){if(!e||"object"!=typeof e)return void t.eventTypes.push("unknown:non-object");if(e instanceof Error)return r.setStatus({code:2,message:"internal_error"}),void XA(e,{mechanism:{handled:!1}});if(!("type"in e))return;const s=e;if(jC.includes(s.type)){if(n&&("response.output_item.done"===s.type&&"item"in s&&t.responsesApiToolCalls.push(s.item),"response.output_text.delta"===s.type&&"delta"in s&&s.delta))t.responseTexts.push(s.delta);else if("response"in s){const{response:e}=s;t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created_at??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.input_tokens,t.completionTokens=e.usage.output_tokens,t.totalTokens=e.usage.total_tokens),e.status&&t.finishReasons.push(e.status),n&&e.output_text&&t.responseTexts.push(e.output_text)}}else t.eventTypes.push(s.type)}function zC(e,t,n){if(!t||"object"!=typeof t)return;const r=t;if(function(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion"===e.object}(r)){if(function(e,t,n){if(YC(e,t.id,t.model,t.created),t.usage&&FC(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map(e=>e.finish_reason).filter(e=>null!==e);if(r.length>0&&e.setAttributes({[eC]:JSON.stringify(r)}),n){const n=t.choices.map(e=>e.message?.tool_calls).filter(e=>Array.isArray(e)&&e.length>0).flat();n.length>0&&e.setAttributes({[lC]:JSON.stringify(n)})}}}(e,r,n),n&&r.choices?.length){const t=r.choices.map(e=>e.message?.content||"");e.setAttributes({[cC]:JSON.stringify(t)})}}else(function(e){return null!==e&&"object"==typeof e&&"object"in e&&"response"===e.object})(r)&&(!function(e,t,n){if(YC(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[eC]:JSON.stringify([t.status])}),t.usage&&FC(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const n=t;if(Array.isArray(n.output)&&n.output.length>0){const t=n.output.filter(e=>"object"==typeof e&&null!==e&&"function_call"===e.type);t.length>0&&e.setAttributes({[lC]:JSON.stringify(t)})}}}(e,r,n),n&&r.output_text&&e.setAttributes({[cC]:r.output_text}))}function QC(e,t){"messages"in t&&e.setAttributes({[aC]:JSON.stringify(t.messages)}),"input"in t&&e.setAttributes({[aC]:JSON.stringify(t.input)})}function qC(e,t,n,r){return async function(...s){const o=r||function(){const e=wT().getClient(),t=e?.getIntegrationByName(UC),n=!!t&&Boolean(e?.getOptions().sendDefaultPii);return{recordInputs:t?.options?.recordInputs??n,recordOutputs:t?.options?.recordOutputs??n}}(),i=function(e,t){const n={[BN]:"openai",[iC]:ZC(t)};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0],r=[...Array.isArray(t.tools)?t.tools:[],...t.web_search_options&&"object"==typeof t.web_search_options?[{type:"web_search_options",...t.web_search_options}]:[]];r.length>0&&(n["gen_ai.request.available_tools"]=JSON.stringify(r))}if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];n[KN]=t.model??"unknown","temperature"in t&&(n[zN]=t.temperature),"top_p"in t&&(n[qN]=t.top_p),"frequency_penalty"in t&&(n[QN]=t.frequency_penalty),"presence_penalty"in t&&(n["gen_ai.request.presence_penalty"]=t.presence_penalty),"stream"in t&&(n[JN]=t.stream)}else n[KN]="unknown";return n}(s,t),a=i[KN]||"unknown",c=ZC(t),u=s[0];return u&&"object"==typeof u&&!0===u.stream?SA({name:`${c} ${a} stream-response`,op:WC(t),attributes:i},async t=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&QC(t,s[0]);return async function*(e,t,n){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{for await(const s of e)$C(s)?KC(s,r,n):XC(s)&&JC(s,r,n,t),yield s}finally{YC(t,r.responseId,r.responseModel,r.responseTimestamp),FC(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[uC]:!0}),r.finishReasons.length&&t.setAttributes({[eC]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[cC]:r.responseTexts.join("")});const e=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];e.length>0&&t.setAttributes({[lC]:JSON.stringify(e)}),t.end()}}(await e.apply(n,s),t,o.recordOutputs??!1)}catch(e){throw t.setStatus({code:2,message:"internal_error"}),XA(e,{mechanism:{handled:!1}}),t.end(),e}}):EA({name:`${c} ${a}`,op:WC(t),attributes:i},async t=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&QC(t,s[0]);const r=await e.apply(n,s);return zC(t,r,o.recordOutputs),r}catch(e){throw XA(e),e}})}}function eO(e,t="",n){return new Proxy(e,{get(e,r){const s=e[r],o=function(e,t){return e?`${e}.${t}`:t}(t,String(r));return"function"==typeof s&&function(e){return HC.includes(e)}(o)?qC(s,o,e,n):"function"==typeof s?s.bind(e):s&&"object"==typeof s?eO(s,o,n):s}})}function tO(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.split(".").pop()||"unknown"}function nO(e){return`gen_ai.${tO(e)}`}function rO(e,t,n,r,s){if(void 0!==t&&e.setAttributes({[rC]:t}),void 0!==n&&e.setAttributes({[sC]:n}),void 0!==t||void 0!==n||void 0!==r||void 0!==s){const o=(t??0)+(n??0)+(r??0)+(s??0);e.setAttributes({[oC]:o})}}const sO="Anthropic_AI",oO=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve"];function iO(e,t,n,r){if(!e||"object"!=typeof e)return;const s=function(e,t,n,r){if("type"in e&&"string"==typeof e.type){if("error"===e.type){const t=e.error?.message??"internal_error";return r.setStatus({code:2,message:t}),XA(new Error(`anthropic_stream_error: ${t}`),{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:"anthropic_stream_error"}},data:{function:"anthropic_stream_error"}}),!0}if(n&&"content_block_delta"===e.type){const n=e.delta?.text;n&&t.responseTexts.push(n)}}return!1}(e,t,n,r);s||function(e,t){if("message_delta"===e.type&&e.usage&&"output_tokens"in e.usage&&"number"==typeof e.usage.output_tokens&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&("number"==typeof n.usage.input_tokens&&(t.promptTokens=n.usage.input_tokens),"number"==typeof n.usage.cache_creation_input_tokens&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),"number"==typeof n.usage.cache_read_input_tokens&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}(e,t)}function aO(e,t){"messages"in t&&e.setAttributes({[aC]:JSON.stringify(t.messages)}),"input"in t&&e.setAttributes({[aC]:JSON.stringify(t.input)}),"prompt"in t&&e.setAttributes({[YN]:JSON.stringify(t.prompt)})}function cO(e,t,n,r){return async function(...s){const o=r||function(){const e=wT().getClient(),t=e?.getIntegrationByName(sO),n=!!t&&Boolean(e?.getOptions().sendDefaultPii);return{recordInputs:t?.options?.recordInputs??n,recordOutputs:t?.options?.recordOutputs??n}}(),i=function(e,t){const n={[BN]:"anthropic",[iC]:tO(t),[ZT]:"auto.ai.anthropic"};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];n[KN]=t.model??"unknown","temperature"in t&&(n[zN]=t.temperature),"top_p"in t&&(n[qN]=t.top_p),"stream"in t&&(n[JN]=t.stream),"top_k"in t&&(n["gen_ai.request.top_k"]=t.top_k),"frequency_penalty"in t&&(n[QN]=t.frequency_penalty),"max_tokens"in t&&(n["gen_ai.request.max_tokens"]=t.max_tokens)}else n[KN]="models.retrieve"===t||"models.get"===t?e[0]:"unknown";return n}(s,t),a=i[KN]??"unknown",c=tO(t),u="object"==typeof s[0]?s[0]:void 0;return Boolean(u?.stream)||"messages.stream"===t?SA({name:`${c} ${a} stream-response`,op:nO(t),attributes:i},async r=>{try{o.recordInputs&&u&&aO(r,u);return async function*(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0};try{for await(const s of e)iO(s,r,n,t),yield s}finally{r.responseId&&t.setAttributes({[nC]:r.responseId}),r.responseModel&&t.setAttributes({[tC]:r.responseModel}),rO(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[uC]:!0}),r.finishReasons.length>0&&t.setAttributes({[eC]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[cC]:r.responseTexts.join("")}),t.end()}}(await e.apply(n,s),r,o.recordOutputs??!1)}catch(e){throw r.setStatus({code:2,message:"internal_error"}),XA(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}}),r.end(),e}}):EA({name:`${c} ${a}`,op:nO(t),attributes:i},async r=>{try{o.recordInputs&&s[0]&&"object"==typeof s[0]&&aO(r,s[0]);const t=await e.apply(n,s);return function(e,t,n){t&&"object"==typeof t&&(n&&("content"in t&&Array.isArray(t.content)&&e.setAttributes({[cC]:t.content.map(e=>e.text).filter(e=>void 0!==e).join("")}),"completion"in t&&e.setAttributes({[cC]:t.completion}),"input_tokens"in t&&e.setAttributes({[cC]:JSON.stringify(t.input_tokens)})),e.setAttributes({[nC]:t.id}),e.setAttributes({[tC]:t.model}),"created"in t&&"number"==typeof t.created&&e.setAttributes({[EC]:new Date(1e3*t.created).toISOString()}),"created_at"in t&&"number"==typeof t.created_at&&e.setAttributes({[EC]:new Date(1e3*t.created_at).toISOString()}),t.usage&&rO(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}(r,t,o.recordOutputs),t}catch(e){throw XA(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}}),e}})}}function uO(e,t="",n){return new Proxy(e,{get(e,r){const s=e[r],o=function(e,t){return e?`${e}.${t}`:t}(t,String(r));return"function"==typeof s&&function(e){return oO.includes(e)}(o)?cO(s,o,e,n):"function"==typeof s?s.bind(e):s&&"object"==typeof s?uO(s,o,n):s}})}function lO(e){return void 0===e?void 0:e>=400&&e<500?"warning":e>=500?"error":void 0}function pO(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function dO(){return"undefined"!=typeof window&&(!pO()||function(){const e=uy.process;return"renderer"===e?.type}())}function hO(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&void 0!==e&&!e.includes("node_modules/")}function mO(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,r=/at (?:async )?(.+?) \(data:(.*?),/;return s=>{const o=s.match(r);if(o)return{filename:`<data:${o[2]}>`,function:o[1]};const i=s.match(n);if(i){let t,n,r,s,o;if(i[1]){r=i[1];let e=r.lastIndexOf(".");if("."===r[e-1]&&e--,e>0){t=r.slice(0,e),n=r.slice(e+1);const s=t.indexOf(".Module");s>0&&(r=r.slice(s+1),t=t.slice(0,s))}s=void 0}n&&(s=t,o=n),"<anonymous>"===n&&(o=void 0,r=void 0),void 0===r&&(o=o||"?",r=s?`${s}.${o}`:o);let a=i[2]?.startsWith("file://")?i[2].slice(7):i[2];const c="native"===i[5];return a?.match(/\/[A-Z]:/)&&(a=a.slice(1)),a||!i[5]||c||(a=i[5]),{filename:a?decodeURI(a):void 0,module:e?e(a):void 0,function:r,lineno:fO(i[3]),colno:fO(i[4]),in_app:hO(a||"",c)}}return s.match(t)?{filename:s}:void 0}}function fO(e){return parseInt(e||"",10)||void 0}class _O{constructor(e){this._maxSize=e,this._cache=new Map}get size(){return this._cache.size}get(e){const t=this._cache.get(e);if(void 0!==t)return this._cache.delete(e),this._cache.set(e,t),t}set(e,t){this._cache.size>=this._maxSize&&this._cache.delete(this._cache.keys().next().value),this._cache.set(e,t)}remove(e){const t=this._cache.get(e);return t&&this._cache.delete(e),t}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const e=[];return this._cache.forEach(t=>e.push(t)),e}}function gO(e,...t){const[n,r,s]=t;if(Array.isArray(r)){const t={...s};t["sentry.message.template"]=n,r.forEach((e,n)=>{t[`sentry.message.parameter.${n}`]=e});yR({level:e,message:S.format(n,...r),attributes:t})}else yR({level:e,message:n,attributes:r})}var EO=Object.freeze({__proto__:null,debug:function(...e){gO("debug",...e)},error:function(...e){gO("error",...e)},fatal:function(...e){gO("fatal",...e)},fmt:UR,info:function(...e){gO("info",...e)},trace:function(...e){gO("trace",...e)},warn:function(...e){gO("warn",...e)}});const SO={};function yO(e,t,n){return n?function(e,t,n){return Object.assign(r=>{const s=n(r),o=SO[e];if(o)return o.setConfig(s),o;const i=new t(s);return SO[e]=i,ug({instrumentations:[i]}),i},{id:e})}(e,t,n):function(e,t){return Object.assign(n=>{const r=SO[e];if(r)return n&&r.setConfig(n),r;const s=t(n);return SO[e]=s,ug({instrumentations:[s]}),s},{id:e})}(e,t)}function TO(e){let t=!1,n=[];if(function(e){return"function"==typeof e._wrap}(e)){const r=e._wrap;e._wrap=(...e)=>(t=!0,n.forEach(e=>e()),n=[],r(...e))}else t=!0;return e=>{t?e():n.push(e)}}const bO="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function AO(e){const t=e.protocol||"",n=e.hostname||e.host||"";return`${t}//${n}${!e.port||80===e.port||443===e.port||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`}${e.path?e.path:"/"}`}const RO="@sentry/instrumentation-http",vO=1048576,NO=new Map;function CO(e,{ignoreIncomingRequestBody:t,maxIncomingRequestBodySize:n="medium",trackIncomingRequestsAsSessions:r=!0,sessionFlushingDelayMS:s}){const o=e.emit;if(o.__sentry_patched__)return;const i=new Proxy(o,{apply(e,o,i){if("request"!==i[0])return e.apply(o,i);bO&&yy.log(RO,"Handling incoming request");const a=MT().clone(),c=i[1],u=i[2],l=WR(c),p=c.ip||c.socket?.remoteAddress,d=c.url||"/";t?.(d,c)||"none"===n||function(e,t,n){let r=0;const s=[];bO&&yy.log(RO,"Patching request.on");const o=new WeakMap,i="small"===n?1e3:"medium"===n?1e4:vO;try{e.on=new Proxy(e.on,{apply:(e,t,n)=>{const[a,c,...u]=n;if("data"===a){bO&&yy.log(RO,`Handling request.on("data") with maximum body size of ${i}b`);const n=new Proxy(c,{apply:(e,t,n)=>{try{const e=n[0],t=Buffer.from(e);r<i?(s.push(t),r+=t.byteLength):bO&&yy.log(RO,`Dropping request body chunk because maximum body length of ${i}b is exceeded.`)}catch(e){bO&&yy.error(RO,"Encountered error while storing body chunk.")}return Reflect.apply(e,t,n)}});return o.set(c,n),Reflect.apply(e,t,[a,n,...u])}return Reflect.apply(e,t,n)}}),e.off=new Proxy(e.off,{apply:(e,t,n)=>{const[,r]=n,s=o.get(r);if(s){o.delete(r);const i=n.slice();return i[1]=s,Reflect.apply(e,t,i)}return Reflect.apply(e,t,n)}}),e.on("end",()=>{try{const e=Buffer.concat(s).toString("utf-8");if(e){const n=Buffer.byteLength(e,"utf-8")>i?`${Buffer.from(e).subarray(0,i-3).toString("utf-8")}...`:e;t.setSDKProcessingMetadata({normalizedRequest:{data:n}})}}catch(e){bO&&yy.error(RO,"Error building captured request body",e)}})}catch(e){bO&&yy.error(RO,"Error patching request to capture body",e)}}(c,a,n),a.setSDKProcessingMetadata({normalizedRequest:l,ipAddress:p});const h=`${(c.method||"GET").toUpperCase()} ${GR(d)}`;return a.setTransactionName(h),!1!==r&&function({requestIsolationScope:e,response:t,sessionFlushingDelayMS:n}){e.setSDKProcessingMetadata({requestSession:{status:"ok"}}),t.once("close",()=>{const t=DT(),r=e.getScopeData().sdkProcessingMetadata.requestSession;if(t&&r){bO&&yy.log(`Recorded request session with status: ${r.status}`);const e=new Date;e.setSeconds(0,0);const s=e.toISOString(),o=NO.get(t),i=o?.[s]||{exited:0,crashed:0,errored:0};if(i[{ok:"exited",crashed:"crashed",errored:"errored"}[r.status]]++,o)o[s]=i;else{bO&&yy.log("Opened new request session aggregate.");const e={[s]:i};NO.set(t,e);const r=()=>{clearTimeout(a),o(),NO.delete(t);const n=Object.entries(e).map(([e,t])=>({started:e,exited:t.exited,errored:t.errored,crashed:t.crashed}));t.sendSession({aggregates:n})},o=t.on("flush",()=>{bO&&yy.log("Sending request session aggregate due to client flush"),r()}),a=setTimeout(()=>{bO&&yy.log("Sending request session aggregate due to flushing schedule"),r()},n).unref()}}})}({requestIsolationScope:a,response:u,sessionFlushingDelayMS:s??6e4}),GT(a,()=>{wT().getPropagationContext().propagationSpanId=ST();const t=Dt.extract(bt.active(),l.headers);return bt.with(t,()=>e.apply(o,i))})}});tT(i,"__sentry_patched__",!0),e.emit=i}const OO=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then;class IO{_rawAttributes;_asyncAttributesPending=!1;_memoizedAttributes;static FromAttributeList(e){const t=new IO({});return t._rawAttributes=wO(e),t._asyncAttributesPending=e.filter(([e,t])=>OO(t)).length>0,t}constructor(e){const t=e.attributes??{};this._rawAttributes=Object.entries(t).map(([e,t])=>(OO(t)&&(this._asyncAttributesPending=!0),[e,t])),this._rawAttributes=wO(this._rawAttributes)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){const[t,n]=this._rawAttributes[e];this._rawAttributes[e]=[t,OO(n)?await n:n]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&At.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const e={};for(const[t,n]of this._rawAttributes)OO(n)?At.debug(`Unsettled resource attribute ${t} skipped`):null!=n&&(e[t]??=n);return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}merge(e){return null==e?this:IO.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()])}}function PO(e){return IO.FromAttributeList(Object.entries(e))}function LO(){return PO({[Kf]:`unknown_service:${process.argv0}`,[zf]:s_[zf],[qf]:s_[qf],[e_]:s_[e_]})}function wO(e){return e.map(([e,t])=>OO(t)?[e,t.catch(t=>{At.debug("promise rejection for resource attribute: %s - %s",e,t)})]:[e,t])}class MO{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:dt.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(e){const t=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=pn.now(),this._performanceOffset=t-(this._performanceStartTime+c_()),this._startTimeProvided=null!=e.startTime,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??t),this.resource=e.resource,this.instrumentationScope=e.scope,null!=e.attributes&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,t){if(null==t||this._isSpanEnded())return this;if(0===e.length)return At.warn(`Invalid attribute key: ${e}`),this;if(!nn(t))return At.warn(`Invalid attribute value set for key: ${e}`),this;const{attributeCountLimit:n}=this._spanLimits;return void 0!==n&&Object.keys(this.attributes).length>=n&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this)}setAttributes(e){for(const[t,n]of Object.entries(e))this.setAttribute(t,n);return this}addEvent(e,t,n){if(this._isSpanEnded())return this;const{eventCountLimit:r}=this._spanLimits;if(0===r)return At.warn("No events allowed."),this._droppedEventsCount++,this;void 0!==r&&this.events.length>=r&&(0===this._droppedEventsCount&&At.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),d_(t)&&(d_(n)||(n=t),t=void 0);const s=en(t);return this.events.push({name:e,attributes:s,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()||(this.status={...e},null!=this.status.message&&"string"!=typeof e.message&&(At.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message)),this}updateName(e){return this._isSpanEnded()||(this.name=e),this}end(e){this._isSpanEnded()?At.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(e),this._duration=l_(this.startTime,this.endTime),this._duration[0]<0&&(At.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&At.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(e){if("number"==typeof e&&e<=pn.now())return u_(e+this._performanceOffset);if("number"==typeof e)return a_(e);if(e instanceof Date)return a_(e.getTime());if(p_(e))return e;if(this._startTimeProvided)return a_(Date.now());const t=pn.now()-this._performanceStartTime;return h_(this.startTime,a_(t))}isRecording(){return!1===this._ended}recordException(e,t){const n={};"string"==typeof e?n[jf]=e:e&&(e.code?n[Wf]=e.code.toString():e.name&&(n[Wf]=e.name),e.message&&(n[jf]=e.message),e.stack&&(n[Zf]=e.stack)),n[Wf]||n[jf]?this.addEvent("exception",n,t):At.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const e=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);At.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,t){return e.length<=t?e:e.substring(0,t)}_truncateToSize(e){const t=this._attributeValueLengthLimit;return t<=0?(At.warn(`Attribute value limit must be positive, got ${t}`),e):"string"==typeof e?this._truncateToLimitUtil(e,t):Array.isArray(e)?e.map(e=>"string"==typeof e?this._truncateToLimitUtil(e,t):e):e}}var xO;!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(xO||(xO={}));class kO{shouldSample(){return{decision:xO.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class GO{shouldSample(){return{decision:xO.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class DO{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(e){this._root=e.root,this._root||(an(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new GO),this._remoteParentSampled=e.remoteParentSampled??new GO,this._remoteParentNotSampled=e.remoteParentNotSampled??new kO,this._localParentSampled=e.localParentSampled??new GO,this._localParentNotSampled=e.localParentNotSampled??new kO}shouldSample(e,t,n,r,s,o){const i=Ht.getSpanContext(e);return i&&it(i)?i.isRemote?i.traceFlags&xe.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,s,o):this._remoteParentNotSampled.shouldSample(e,t,n,r,s,o):i.traceFlags&xe.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,s,o):this._localParentNotSampled.shouldSample(e,t,n,r,s,o):this._root.shouldSample(e,t,n,r,s,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class VO{_ratio;_upperBound;constructor(e=0){this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(e,t){return{decision:st(t)&&this._accumulate(t)<this._upperBound?xO.RECORD_AND_SAMPLED:xO.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let t=0;for(let n=0;n<e.length/8;n++){const r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}function UO(){return{sampler:HO(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:cn("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:cn("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:cn("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:cn("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:cn("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:cn("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:cn("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:cn("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function HO(){const e=un("OTEL_TRACES_SAMPLER")??"parentbased_always_on";switch(e){case"always_on":return new GO;case"always_off":return new kO;case"parentbased_always_on":return new DO({root:new GO});case"parentbased_always_off":return new DO({root:new kO});case"traceidratio":return new VO(jO());case"parentbased_traceidratio":return new DO({root:new VO(jO())});default:return At.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "parentbased_always_on".`),new DO({root:new GO})}}function jO(){const e=cn("OTEL_TRACES_SAMPLER_ARG");return null==e?(At.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1):e<0||e>1?(At.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}const ZO=1/0;class WO{generateTraceId=$O(16);generateSpanId=$O(8)}const XO=Buffer.allocUnsafe(16);function $O(e){return function(){for(let t=0;t<e/4;t++)XO.writeUInt32BE(Math.random()*2**32>>>0,4*t);for(let t=0;t<e&&!(XO[t]>0);t++)t===e-1&&(XO[e-1]=1);return XO.toString("hex",0,e)}}class FO{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(e,t,n,r){const s=function(e){const t={sampler:HO()},n=UO(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}(t);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=t.idGenerator||new WO,this._resource=n,this._spanProcessor=r,this.instrumentationScope=e}startSpan(e,t={},n=bt.active()){t.root&&(n=Ht.deleteSpan(n));const r=Ht.getSpan(n);if(Kt(n)){At.debug("Instrumentation suppressed, returning Noop Span");return Ht.wrapSpanContext(Ye)}const s=r?.spanContext(),o=this._idGenerator.generateSpanId();let i,a,c;s&&Ht.isSpanContextValid(s)?(a=s.traceId,c=s.traceState,i=s):a=this._idGenerator.generateTraceId();const u=t.kind??pt.INTERNAL,l=(t.links??[]).map(e=>({context:e.context,attributes:en(e.attributes)})),p=en(t.attributes),d=this._sampler.shouldSample(n,a,e,u,p,l);c=d.traceState??c;const h={traceId:a,spanId:o,traceFlags:d.decision===lt.RECORD_AND_SAMPLED?xe.SAMPLED:xe.NONE,traceState:c};if(d.decision===lt.NOT_RECORD){At.debug("Recording is off, propagating context in a non-recording span");return Ht.wrapSpanContext(h)}const m=en(Object.assign(p,d.attributes));return new MO({resource:this._resource,scope:this.instrumentationScope,context:n,spanContext:h,name:e,kind:u,links:l,parentSpanContext:i,attributes:m,startTime:t.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,t,n,r){let s,o,i;if(arguments.length<2)return;2===arguments.length?i=t:3===arguments.length?(s=t,i=n):(s=t,o=n,i=r);const a=o??bt.active(),c=this.startSpan(e,s,a),u=Ht.setSpan(a,c);return bt.with(u,i,void 0,c)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class YO{_spanProcessors;constructor(e){this._spanProcessors=e}forceFlush(){const e=[];for(const t of this._spanProcessors)e.push(t.forceFlush());return new Promise(t=>{Promise.all(e).then(()=>{t()}).catch(e=>{an(e||new Error("MultiSpanProcessor: forceFlush failed")),t()})})}onStart(e,t){for(const n of this._spanProcessors)n.onStart(e,t)}onEnd(e){for(const t of this._spanProcessors)t.onEnd(e)}shutdown(){const e=[];for(const t of this._spanProcessors)e.push(t.shutdown());return new Promise((t,n)=>{Promise.all(e).then(()=>{t()},n)})}}var BO;!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(BO||(BO={}));class KO{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(e={}){const t=D_({},UO(),function(e){const t=Object.assign({},e.spanLimits);return t.attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??cn("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??cn("OTEL_ATTRIBUTE_COUNT_LIMIT")??128,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??cn("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??cn("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??ZO,Object.assign({},e,{spanLimits:t})}(e));this._resource=t.resource??LO(),this._config=Object.assign({},t,{resource:this._resource});const n=[];e.spanProcessors?.length&&n.push(...e.spanProcessors),this._activeSpanProcessor=new YO(n)}getTracer(e,t,n){const r=`${e}@${t||""}:${n?.schemaUrl||""}`;return this._tracers.has(r)||this._tracers.set(r,new FO({name:e,version:t,schemaUrl:n?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(r)}forceFlush(){const e=this._config.forceFlushTimeoutMillis,t=this._activeSpanProcessor._spanProcessors.map(t=>new Promise(n=>{let r;const s=setTimeout(()=>{n(new Error(`Span processor did not completed within timeout period of ${e} ms`)),r=BO.timeout},e);t.forceFlush().then(()=>{clearTimeout(s),r!==BO.timeout&&(r=BO.resolved,n(r))}).catch(e=>{clearTimeout(s),r=BO.error,n(e)})}));return new Promise((e,n)=>{Promise.all(t).then(t=>{const r=t.filter(e=>e!==BO.resolved);r.length>0?n(r):e()}).catch(e=>n([e]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}const JO="sentry.parentIsRemote",zO="sentry.graphql.operation";function QO(e){return"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0}function qO(e){const t=e;return!!t.attributes&&"object"==typeof t.attributes}function eI(e){return!!e.name}const tI="sentry-trace",nI="baggage",rI="sentry.dsc",sI="sentry.sampled_not_recording",oI="sentry.url",iI=ce("sentry_scopes"),aI=ce("sentry_fork_isolation_scope"),cI=ce("sentry_fork_set_scope"),uI=ce("sentry_fork_set_isolation_scope"),lI="_scopeContext";function pI(e){return e.getValue(iI)}function dI(e,t){return e.setValue(iI,t)}function hI(e){return e[lI]}function mI(e){const{traceFlags:t,traceState:n}=e,r=!!n&&"1"===n.get(sI);if(t===xe.SAMPLED)return!0;if(r)return!1;const s=n?n.get(rI):void 0,o=s?rb(s):void 0;return"true"===o?.sampled||"false"!==o?.sampled&&void 0}function fI(e,t,n){const r=t[Xf]||t[Ho];if(r)return function({name:e,kind:t,attributes:n},r){const s=["http"];switch(t){case pt.CLIENT:s.push("client");break;case pt.SERVER:s.push("server")}n["sentry.http.prefetch"]&&s.push("prefetch");const{urlPath:o,url:i,query:a,fragment:c,hasRoute:u}=function(e,t){const n=e[Zo],r=e[jo]||e[t_],s=e[Ff],o="string"==typeof r?kR(r):void 0,i=o?DR(o):void 0,a=o?.search||void 0,c=o?.hash||void 0;if("string"==typeof s)return{urlPath:s,url:i,query:a,fragment:c,hasRoute:!0};if(t===pt.SERVER&&"string"==typeof n)return{urlPath:GR(n),url:i,query:a,fragment:c,hasRoute:!1};if(o)return{urlPath:i,url:i,query:a,fragment:c,hasRoute:!1};if("string"==typeof n)return{urlPath:GR(n),url:i,query:a,fragment:c,hasRoute:!1};return{urlPath:void 0,url:i,query:a,fragment:c,hasRoute:!1}}(n,t);if(!o)return{...gI(e,n),op:s.join(".")};const l=n[zO],p=`${r} ${o}`,d=l?`${p} (${function(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}(l)})`:p,h=u||"/"===o?"route":"url",m={};i&&(m.url=i);a&&(m["http.query"]=a);c&&(m["http.fragment"]=c);const f=t===pt.CLIENT||t===pt.SERVER,_=n[ZT]||"manual",g=!`${_}`.startsWith("auto"),E="custom"===n[UT],S=n[$T],y=!E&&null==S&&(f||!g),{description:T,source:b}=y?{description:d,source:h}:gI(e,n);return{op:s.join("."),description:T,source:b,data:m}}({attributes:t,name:e,kind:n},r);const s=t[xs],o="string"==typeof t[jT]&&t[jT].startsWith("cache.");if(s&&!o)return function({attributes:e,name:t}){const n=e[$T];if("string"==typeof n)return{op:"db",description:n,source:e[UT]||"custom"};if("custom"===e[UT])return{op:"db",description:t,source:"custom"};const r=e[Us],s=r?r.toString():t;return{op:"db",description:s,source:"task"}}({attributes:t,name:e});const i="custom"===t[UT]?"custom":"route";if(t[Wi])return{...gI(e,t,"route"),op:"rpc"};if(t[Ai])return{...gI(e,t,i),op:"message"};const a=t[so];return a?{...gI(e,t,i),op:a.toString()}:{op:void 0,description:e,source:"custom"}}function _I(e){const t=qO(e)?e.attributes:{},n=eI(e)?e.name:"<unknown>",r=function(e){return function(e){return"number"==typeof e.kind}(e)?e.kind:pt.INTERNAL}(e);return fI(n,t,r)}function gI(e,t,n="custom"){const r=t[UT]||n,s=t[$T];return s&&"string"==typeof s?{description:s,source:r}:{description:e,source:r}}function EI(){return Ht.getActiveSpan()}const SI="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function yI({dsc:e,sampled:t}){const n=e?sb(e):void 0,r=new S_,s=n?r.set(rI,n):r;return!1===t?s.set(sI,"1"):s}const TI=new Set;function bI(e){TI.add(e)}class AI extends qt{constructor(){super(),bI("SentryPropagator"),this._urlMatchesTargetsMap=new _O(100)}inject(e,t,n){if(Kt(e))return void(SI&&yy.log("[Tracing] Not injecting trace data for url because tracing is suppressed."));const r=Ht.getSpan(e),s=r&&function(e){const t=Nb(e).data,n=t[jo]||t[t_];if("string"==typeof n)return n;const r=e.spanContext().traceState?.get(oI);if(r)return r;return}(r),o=DT()?.getOptions()?.tracePropagationTargets;if(!vI(s,o,this._urlMatchesTargetsMap))return void(SI&&yy.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",s));const i=function(e){try{const t=e[nI];return Array.isArray(t)?t.join(","):t}catch{return}}(t);let a=Dt.getBaggage(e)||Dt.createBaggage({});const{dynamicSamplingContext:c,traceId:u,spanId:l,sampled:p}=NI(e);if(i){const e=ob(i);e&&Object.entries(e).forEach(([e,t])=>{a=a.setEntry(e,{value:t})})}c&&(a=Object.entries(c).reduce((e,[t,n])=>n?e.setEntry(`${tb}${t}`,{value:n}):e,a)),u&&u!==Fe&&n.set(t,tI,gb(u,l,p)),super.inject(Dt.setBaggage(e,a),t,n)}extract(e,t,n){const r=n.get(t,tI),s=n.get(t,nI);return OI(CI(e,{sentryTrace:r?Array.isArray(r)?r[0]:r:void 0,baggage:s}))}fields(){return[tI,nI]}}const RI="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function vI(e,t,n){if("string"!=typeof e||!t)return!0;const r=n?.get(e);if(void 0!==r)return SI&&!r&&yy.log(RI,e),r;const s=qy(e,t);return n?.set(e,s),SI&&!s&&yy.log(RI,e),s}function NI(e,t={}){const n=Ht.getSpan(e);if(n?.spanContext().isRemote){const e=n.spanContext();return{dynamicSamplingContext:Xb(n),traceId:e.traceId,spanId:void 0,sampled:mI(e)}}if(n){const e=n.spanContext();return{dynamicSamplingContext:Xb(n),traceId:e.traceId,spanId:e.spanId,sampled:mI(e)}}const r=t.scope||pI(e)?.scope||wT(),s=t.client||DT(),o=r.getPropagationContext();return{dynamicSamplingContext:s?Wb(s,r):void 0,traceId:o.traceId,spanId:o.propagationSpanId,sampled:o.sampled}}function CI(e,{sentryTrace:t,baggage:n}){const r=_b(t,n),{traceId:s,parentSpanId:o,sampled:i,dsc:a}=r,c=DT(),u=rb(n);if(!o||c&&!Eb(c,u?.org_id))return e;const l=function({spanId:e,traceId:t,sampled:n,dsc:r}){const s=yI({dsc:r,sampled:n}),o={traceId:t,spanId:e,isRemote:!0,traceFlags:n?xe.SAMPLED:xe.NONE,traceState:s};return o}({traceId:s,spanId:o,sampled:i,dsc:a});return Ht.setSpanContext(e,l)}function OI(e){const t=pI(e);return dI(e,{scope:t?t.scope:wT().clone(),isolationScope:t?t.isolationScope:MT()})}function II(e,t){const n=MI(),{name:r,parentSpan:s}=e;return DI(s)(()=>{const s=kI(e.scope,e.forceTransaction),o=e.onlyIfParent&&!Ht.getSpan(s)?Bt(s):s,i=xI(e);return n.startActiveSpan(r,i,o,e=>fA(()=>t(e),()=>{void 0===Nb(e).status&&e.setStatus({code:dt.ERROR})},()=>e.end()))})}function PI(e,t){const n=MI(),{name:r,parentSpan:s}=e;return DI(s)(()=>{const s=kI(e.scope,e.forceTransaction),o=e.onlyIfParent&&!Ht.getSpan(s)?Bt(s):s,i=xI(e);return n.startActiveSpan(r,i,o,e=>fA(()=>t(e,()=>e.end()),()=>{void 0===Nb(e).status&&e.setStatus({code:dt.ERROR})}))})}function LI(e){const t=MI(),{name:n,parentSpan:r}=e;return DI(r)(()=>{const r=kI(e.scope,e.forceTransaction),s=e.onlyIfParent&&!Ht.getSpan(r)?Bt(r):r,o=xI(e);return t.startSpan(n,o,s)})}function wI(e,t){const n=e?Ht.setSpan(bt.active(),e):Ht.deleteSpan(bt.active());return bt.with(n,()=>t(wT()))}function MI(){const e=DT();return e?.tracer||Ht.getTracer("@sentry/opentelemetry",ly)}function xI(e){const{startTime:t,attributes:n,kind:r,op:s,links:o}=e,i="number"==typeof t?(a=t)<9999999999?1e3*a:a:t;var a;return{attributes:s?{[jT]:s,...n}:n,kind:r,links:o,startTime:i}}function kI(e,t){const n=function(e){if(e){const t=hI(e);if(t)return t}return bt.active()}(e),r=Ht.getSpan(n);if(!r)return n;if(!t)return n;const s=Ht.deleteSpan(n),{spanId:o,traceId:i}=r.spanContext(),a=mI(r.spanContext()),c=yI({dsc:Xb(Mb(r)),sampled:a}),u={traceId:i,spanId:o,isRemote:!0,traceFlags:a?xe.SAMPLED:xe.NONE,traceState:c};return Ht.setSpanContext(s,u)}function GI(e,t){return function(e,t,n){const r=OI(CI(e,t));return bt.with(r,n)}(bt.active(),e,t)}function DI(e){return void 0!==e?t=>wI(e,t):e=>e()}function VI(e){const t=Bt(bt.active());return bt.with(t,e)}function UI({span:e,scope:t,client:n}={}){let r=(t&&hI(t))??bt.active();if(e){const{scope:t}=eb(e);r=t&&hI(t)||Ht.setSpan(bt.active(),e)}const{traceId:s,spanId:o,sampled:i,dynamicSamplingContext:a}=NI(r,{scope:t,client:n});return{"sentry-trace":gb(s,o,i),baggage:sb(a)}}function HI(){function e(){const e=pI(bt.active());return e||{scope:RT(),isolationScope:vT()}}function t(){return e().scope}function n(){return e().isolationScope}var r;r={withScope:function(e){const n=bt.active();return bt.with(n,()=>e(t()))},withSetScope:function(e,t){const n=hI(e)||bt.active();return bt.with(n.setValue(cI,e),()=>t(e))},withSetIsolationScope:function(e,t){const r=bt.active();return bt.with(r.setValue(uI,e),()=>t(n()))},withIsolationScope:function(e){const t=bt.active();return bt.with(t.setValue(aI,!0),()=>e(n()))},getCurrentScope:t,getIsolationScope:n,startSpan:II,startSpanManual:PI,startInactiveSpan:LI,getActiveSpan:EI,suppressTracing:VI,getTraceData:UI,continueTrace:GI,withActiveSpan:wI},dy(py()).acs=r}function jI(e){return!0===e.attributes[JO]?void 0:QO(e)}function ZI(e,t){const n=t.spanContext().spanId,r=jI(t);if(!r)return void WI(e,{id:n,span:t,children:[]});const s=function(e,t){const n=e.get(t);if(n)return n;return WI(e,{id:t,children:[]})}(e,r),o=WI(e,{id:n,span:t,parentNode:s,children:[]});s.children.push(o)}function WI(e,t){const n=e.get(t.id);return n?.span?n:n&&!n.span?(n.span=t.span,n.parentNode=t.parentNode,n):(e.set(t.id,t),t)}const XI={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"};function $I(e){const t=qO(e)?e.attributes:{},n=function(e){return!!e.status}(e)?e.status:void 0;if(n){if(n.code===dt.OK)return{code:1};if(n.code===dt.ERROR){if(void 0===n.message){const e=FI(t);if(e)return e}return n.message&&(r=n.message,Object.values(XI).includes(r))?{code:2,message:n.message}:{code:2,message:"unknown_error"}}}var r;const s=FI(t);return s||(n?.code===dt.UNSET?{code:1}:{code:2,message:"unknown_error"})}function FI(e){const t=e[$f]||e[$o],n=e[$i],r="number"==typeof t?t:"string"==typeof t?parseInt(t):void 0;return"number"==typeof r?KT(r):"string"==typeof n?{code:2,message:XI[n]||"unknown_error"}:void 0}class YI{constructor(e){this._finishedSpanBucketSize=e?.timeout||300,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap,this._sentSpans=new Map,this._debouncedFlush=function(e,t,n){let r,s,o;const i=n?.maxWait?Math.max(n.maxWait,t):0,a=n?.setTimeoutImpl||setTimeout;function c(){return u(),r=e(),r}function u(){void 0!==s&&clearTimeout(s),void 0!==o&&clearTimeout(o),s=o=void 0}function l(){return s&&clearTimeout(s),s=a(c,t),i&&void 0===o&&(o=a(c,i)),r}return l.cancel=u,l.flush=function(){return void 0!==s||void 0!==o?c():r},l}(this.flush.bind(this),1,{maxWait:100})}export(e){const t=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==t){let e=0;this._finishedSpanBuckets.forEach((n,r)=>{n&&n.timestampInS<=t-this._finishedSpanBucketSize&&(e+=n.spans.size,this._finishedSpanBuckets[r]=void 0)}),e>0&&SI&&yy.log(`SpanExporter dropped ${e} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=t}const n=t%this._finishedSpanBucketSize,r=this._finishedSpanBuckets[n]||{timestampInS:t,spans:new Set};this._finishedSpanBuckets[n]=r,r.spans.add(e),this._spansToBucketEntry.set(e,r);const s=jI(e);s&&!this._sentSpans.has(s)||this._debouncedFlush()}flush(){const e=this._finishedSpanBuckets.flatMap(e=>e?Array.from(e.spans):[]);this._flushSentSpanCache();const t=this._maybeSend(e),n=t.size,r=e.length-n;SI&&yy.log(`SpanExporter exported ${n} spans, ${r} spans are waiting for their parent spans to finish`);const s=Date.now()+3e5;for(const e of t){this._sentSpans.set(e.spanContext().spanId,s);const t=this._spansToBucketEntry.get(e);t&&t.spans.delete(e)}this._debouncedFlush.cancel()}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._sentSpans.clear(),this._debouncedFlush.cancel()}_maybeSend(e){const t=function(e){const t=new Map;for(const n of e)ZI(t,n);return Array.from(t,function([e,t]){return t})}(e),n=new Set,r=this._getCompletedRootNodes(t);for(const e of r){const t=e.span;n.add(t);const r=BI(t);if(e.parentNode&&this._sentSpans.has(e.parentNode.id)){const e=r.contexts?.trace?.data;e&&(e["sentry.parent_span_already_sent"]=!0)}const s=r.spans||[];for(const t of e.children)KI(t,s,n);r.spans=s.length>1e3?s.sort((e,t)=>e.start_timestamp-t.start_timestamp).slice(0,1e3):s;const o=pA(t.events);o&&(r.measurements=o),FA(r)}return n}_flushSentSpanCache(){const e=Date.now();for(const[t,n]of this._sentSpans.entries())n<=e&&this._sentSpans.delete(t)}_nodeIsCompletedRootNodeOrHasSentParent(e){return!!e.span&&(!e.parentNode||this._sentSpans.has(e.parentNode.id))}_getCompletedRootNodes(e){return e.filter(e=>this._nodeIsCompletedRootNodeOrHasSentParent(e))}}function BI(e){const{op:t,description:n,data:r,origin:s="manual",source:o}=JI(e),i=eb(e),a=e.attributes[HT],c={[UT]:o,[HT]:a,[jT]:t,[ZT]:s,...r,...zI(e.attributes)},{links:u}=e,{traceId:l,spanId:p}=e.spanContext(),d={parent_span_id:QO(e),span_id:p,trace_id:l,data:c,origin:s,op:t,status:Ob($I(e)),links:Ab(u)},h=c[$f],m="number"==typeof h?{response:{status_code:h}}:void 0;return{contexts:{trace:d,otel:{resource:e.resource.attributes},...m},spans:[],start_timestamp:Rb(e.startTime),timestamp:Rb(e.endTime),transaction:n,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:i.scope,capturedSpanIsolationScope:i.isolationScope,sampleRate:a,dynamicSamplingContext:Xb(e)},...o&&{transaction_info:{source:o}}}}function KI(e,t,n){const r=e.span;r&&n.add(r);if(!r)return void e.children.forEach(e=>{KI(e,t,n)});const s=r.spanContext().spanId,o=r.spanContext().traceId,i=QO(r),{attributes:a,startTime:c,endTime:u,links:l}=r,{op:p,description:d,data:h,origin:m="manual"}=JI(r),f={[ZT]:m,[jT]:p,...zI(a),...h},_=$I(r),g={span_id:s,trace_id:o,data:f,description:d,parent_span_id:i,start_timestamp:Rb(c),timestamp:Rb(u)||void 0,status:Ob(_),op:p,origin:m,measurements:pA(r.events),links:Ab(l)};t.push(g),e.children.forEach(e=>{KI(e,t,n)})}function JI(e){const{op:t,source:n,origin:r}=function(e){const t=e.attributes;return{origin:t[ZT],op:t[jT],source:t[UT]}}(e),{op:s,description:o,source:i,data:a}=_I(e);return{op:t||s,description:o,source:n||i,origin:r,data:{...a,...QI(e)}}}function zI(e){const t={...e};return delete t[HT],delete t[JO],delete t[$T],t}function QI(e){const t=e.attributes,n={};e.kind!==pt.INTERNAL&&(n["otel.kind"]=pt[e.kind]);const r=t[$o];r&&(n[$f]=r);const s=function(e){if(!qO(e))return{};const t=e.attributes[t_]||e.attributes[jo],n={url:t,"http.method":e.attributes[Xf]||e.attributes[Ho]};!n["http.method"]&&n.url&&(n["http.method"]="GET");try{if("string"==typeof t){const e=kR(t);n.url=DR(e),e.search&&(n["http.query"]=e.search),e.hash&&(n["http.fragment"]=e.hash)}}catch{}return n}(e);return s.url&&(n.url=s.url),s["http.query"]&&(n["http.query"]=s["http.query"].slice(1)),s["http.fragment"]&&(n["http.fragment"]=s["http.fragment"].slice(1)),n}class qI{constructor(e){bI("SentrySpanProcessor"),this._exporter=new YI(e)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(e,t){!function(e,t){const n=Ht.getSpan(t);let r=pI(t);n&&!n.spanContext().isRemote&&Lb(n,e),n?.spanContext().isRemote&&e.setAttribute(JO,!0),t===de&&(r={scope:RT(),isolationScope:vT()}),r&&qT(e,r.scope,r.isolationScope),uA(e);const s=DT();s?.emit("spanStart",e)}(e,t)}onEnd(e){!function(e){lA(e);const t=DT();t?.emit("spanEnd",e)}(e),this._exporter.export(e)}}class eP{constructor(e){this._client=e,bI("SentrySampler")}shouldSample(e,t,n,r,s,o){const i=this._client.getOptions(),a=function(e){const t=Ht.getSpan(e);return t&&it(t.spanContext())?t:void 0}(e),c=a?.spanContext();if(!Vb(i))return tP({decision:void 0,context:e,spanAttributes:s});const u=s[Ho]||s[Xf];if(r===pt.CLIENT&&u&&(!a||c?.isRemote))return tP({decision:void 0,context:e,spanAttributes:s});const l=a?function(e,t,n){const r=e.spanContext();if(it(r)&&r.traceId===t){if(r.isRemote){const t=mI(e.spanContext());return SI&&yy.log(`[Tracing] Inheriting remote parent's sampled decision for ${n}: ${t}`),t}const t=mI(r);return SI&&yy.log(`[Tracing] Inheriting parent's sampled decision for ${n}: ${t}`),t}return}(a,t,n):void 0;if(!(!a||c?.isRemote))return tP({decision:l?xO.RECORD_AND_SAMPLED:xO.NOT_RECORD,context:e,spanAttributes:s});const{description:p,data:d,op:h}=fI(n,s,r),m={...d,...s};h&&(m[jT]=h);const f={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:m,spanName:p,parentSampled:l,parentContext:c},f),!f.decision)return tP({decision:void 0,context:e,spanAttributes:s});const{isolationScope:_}=pI(e)??{},g=c?.traceState?c.traceState.get(rI):void 0,E=g?rb(g):void 0,S=mb(E?.sample_rand)??Math.random(),[y,T,b]=_A(i,{name:p,attributes:m,normalizedRequest:_?.getScopeData().sdkProcessingMetadata.normalizedRequest,parentSampled:l,parentSampleRate:mb(E?.sample_rate)},S),A=`${u}`.toUpperCase();return"OPTIONS"===A||"HEAD"===A?(SI&&yy.log(`[Tracing] Not sampling span because HTTP method is '${A}' for ${n}`),tP({decision:xO.NOT_RECORD,context:e,spanAttributes:s,sampleRand:S,downstreamTraceSampleRate:0})):(y||void 0!==l||(SI&&yy.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),this._client.recordDroppedEvent("sample_rate","transaction")),{...tP({decision:y?xO.RECORD_AND_SAMPLED:xO.NOT_RECORD,context:e,spanAttributes:s,sampleRand:S,downstreamTraceSampleRate:b?T:void 0}),attributes:{[HT]:b?T:void 0}})}toString(){return"SentrySampler"}}function tP({decision:e,context:t,spanAttributes:n,sampleRand:r,downstreamTraceSampleRate:s}){let o=function(e,t){const n=Ht.getSpan(e),r=n?.spanContext();let s=r?.traceState||new S_;const o=t[jo]||t[t_];o&&"string"==typeof o&&(s=s.set(oI,o));return s}(t,n);return void 0!==s&&(o=o.set("sentry.sample_rate",`${s}`)),void 0!==r&&(o=o.set("sentry.sample_rand",`${r}`)),null==e?{decision:xO.NOT_RECORD,traceState:o}:e===xO.NOT_RECORD?{decision:e,traceState:o.set(sI,"1")}:{decision:e,traceState:o}}function nP(e,t){if(!e)return t;const n=ob(e),r=ob(t);if(!r)return e;const s={...n};return Object.entries(r).forEach(([e,t])=>{s[e]||(s[e]=t)}),ab(s)}function rP(e,t){const n=function(e){try{const t=e.getHeader("host")||e.host,n=kR(new URL(e.path,`${e.protocol}//${t}`).toString()),r={url:DR(n),"http.method":e.method||"GET"};return n.search&&(r["http.query"]=n.search),n.hash&&(r["http.fragment"]=n.hash),r}catch{return{}}}(e),r=t?.statusCode;FR({category:"http",data:{status_code:r,...n},type:"http",level:lO(r)},{event:"response",request:e,response:t})}class sP extends IS{constructor(e={}){super(RO,ly,e),this._propagationDecisionMap=new _O(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){let e=!1;const t=e=>{CO(e.server,{ignoreIncomingRequestBody:this.getConfig().ignoreIncomingRequestBody,maxIncomingRequestBodySize:this.getConfig().maxIncomingRequestBodySize,trackIncomingRequestsAsSessions:this.getConfig().trackIncomingRequestsAsSessions,sessionFlushingDelayMS:this.getConfig().sessionFlushingDelayMS??6e4})},n=e=>{const t=e;this._onOutgoingRequestFinish(t.request,t.response)},r=e=>{const t=e;this._onOutgoingRequestFinish(t.request,void 0)},s=e=>{const t=e;this._onOutgoingRequestCreated(t.request)},o=o=>(e||(e=!0,p.subscribe("http.server.request.start",t),p.subscribe("http.client.response.finish",n),p.subscribe("http.client.request.error",r),this.getConfig().propagateTraceInOutgoingRequests&&p.subscribe("http.client.request.created",s)),o),i=()=>{p.unsubscribe("http.server.request.start",t),p.unsubscribe("http.client.response.finish",n),p.unsubscribe("http.client.request.error",r),p.unsubscribe("http.client.request.created",s)};return[new LS("http",["*"],o,i),new LS("https",["*"],o,i)]}_onOutgoingRequestFinish(e,t){bO&&yy.log(RO,"Handling finished outgoing request");const n=this.getConfig().breadcrumbs,r=void 0===n||n,s=this._ignoreOutgoingRequestsMap.get(e)??this._shouldIgnoreOutgoingRequest(e);this._ignoreOutgoingRequestsMap.set(e,s),r&&!s&&rP(e,t)}_onOutgoingRequestCreated(e){const t=this._ignoreOutgoingRequestsMap.get(e)??this._shouldIgnoreOutgoingRequest(e);this._ignoreOutgoingRequestsMap.set(e,t),t||function(e,t){const n=function(e){const t=e.getHeader("host")||e.host;return`${e.protocol}//${t}${e.path}`}(e),r=DT()?.getOptions().tracePropagationTargets,s=vI(n,r,t)?jR():void 0;if(!s)return;const{"sentry-trace":o,baggage:i}=s;if(o&&!e.getHeader("sentry-trace"))try{e.setHeader("sentry-trace",o),bO&&yy.log(RO,"Added sentry-trace header to outgoing request")}catch(e){bO&&yy.error(RO,"Failed to add sentry-trace header to outgoing request:",Uy(e)?e.message:"Unknown error")}if(i){const t=nP(e.getHeader("baggage"),i);if(t)try{e.setHeader("baggage",t),bO&&yy.log(RO,"Added baggage header to outgoing request")}catch(e){bO&&yy.error(RO,"Failed to add baggage header to outgoing request:",Uy(e)?e.message:"Unknown error")}}}(e,this._propagationDecisionMap)}_shouldIgnoreOutgoingRequest(e){if(Kt(bt.active()))return!0;const t=this.getConfig().ignoreOutgoingRequests;if(!t)return!1;const n=function(e){return{method:e.method,protocol:e.protocol,host:e.host,hostname:e.host,path:e.path,headers:e.getHeaders()}}(e);return t(AO(e),n)}}const oP="Http",iP=yO(`${oP}.sentry`,e=>new sP(e)),aP=(e={})=>{const t=e.dropSpansForIncomingRequestStatusCodes??[[401,404],[300,399]];return{name:oP,setupOnce(){iP({...e,extractIncomingTraceFromHeader:!0,propagateTraceInOutgoingRequests:!0})},processEvent(e){if("transaction"===e.type){const n=e.contexts?.trace?.data?.["http.response.status_code"];if("number"==typeof n&&t.some(e=>{if("number"==typeof e)return e===n;const[t,r]=e;return n>=t&&n<=r}))return null}return e}}},cP=function(e){const t=e.match(uT)||[],n=lT(t[1]),r=lT(t[2]),s=lT(t[3]);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(s)?void 0:s,prerelease:t[4]}}(process.versions.node),uP=cP.major,lP=cP.minor,pP="sentry-trace",dP="baggage",hP=/baggage: (.*)\r\n/;class mP extends IS{constructor(e={}){super("@sentry/instrumentation-node-fetch",ly,e),this._channelSubs=[],this._propagationDecisionMap=new _O(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(e=>e.unsubscribe()),this._channelSubs=[]}enable(){super.enable(),this._channelSubs=this._channelSubs||[],this._channelSubs.length>0||(this._subscribeToChannel("undici:request:create",this._onRequestCreated.bind(this)),this._subscribeToChannel("undici:request:headers",this._onResponseHeaders.bind(this)))}_onRequestCreated({request:e}){if(!(!1!==this.getConfig().enabled))return;const t=this._shouldIgnoreOutgoingRequest(e);if(this._ignoreOutgoingRequestsMap.set(e,t),t)return;const n=fP(e.origin,e.path),r=DT()?.getOptions().tracePropagationTargets,s=vI(n,r,this._propagationDecisionMap)?jR():void 0;if(!s)return;const{"sentry-trace":o,baggage:i}=s;if(Array.isArray(e.headers)){const t=e.headers;o&&!t.includes(pP)&&t.push(pP,o);const n=t.findIndex(e=>e===dP);if(i&&-1===n)t.push(dP,i);else if(i){const e=nP(t[n+1],i);e&&(t[n+1]=e)}}else{const t=e.headers;o&&!t.includes(`${pP}:`)&&(e.headers+=`${pP}: ${o}\r\n`);const n=e.headers.match(hP)?.[1];if(i&&!n)e.headers+=`${dP}: ${i}\r\n`;else if(i){const t=nP(n,i);t&&(e.headers=e.headers.replace(hP,`baggage: ${t}\r\n`))}}}_onResponseHeaders({request:e,response:t}){const n=this.getConfig();if(!(!1!==n.enabled))return;const r=n.breadcrumbs,s=void 0===r||r,o=this._ignoreOutgoingRequestsMap.get(e);s&&!o&&function(e,t){const n=function(e){try{const t=kR(fP(e.origin,e.path)),n={url:DR(t),"http.method":e.method||"GET"};return t.search&&(n["http.query"]=t.search),t.hash&&(n["http.fragment"]=t.hash),n}catch{return{}}}(e),r=t.statusCode,s=lO(r);FR({category:"http",data:{status_code:r,...n},type:"http",level:s},{event:"response",request:e,response:t})}(e,t)}_subscribeToChannel(e,t){let n;if(uP>18||18===uP&&lP>=19)P.subscribe?.(e,t),n=()=>P.unsubscribe?.(e,t);else{const r=P.channel(e);r.subscribe(t),n=()=>r.unsubscribe(t)}this._channelSubs.push({name:e,unsubscribe:n})}_shouldIgnoreOutgoingRequest(e){if(Kt(bt.active()))return!0;const t=fP(e.origin,e.path),n=this.getConfig().ignoreOutgoingRequests;return!("function"!=typeof n||!t)&&n(t)}}function fP(e,t="/"){try{return new URL(t,e).toString()}catch{const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:n.endsWith("/")||t.startsWith("/")?`${n}${t}`:`${n}/${t.slice(1)}`}}const _P=yO("NodeFetch.sentry",mP,e=>e),gP=(e={})=>({name:"NodeFetch",setupOnce(){_P(e)}}),EP=S.promisify(_.readFile),SP=S.promisify(_.readdir),yP=(e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(e){void 0===t&&(t=async function(){const e={};n.os&&(e.os=await async function(){const e=w.platform();switch(e){case"darwin":return async function(){const e={kernel_version:w.release(),name:"Mac OS X",version:"10."+(Number(w.release().split(".")[0])-4)};try{const t=await new Promise((e,t)=>{f.execFile("/usr/bin/sw_vers",(n,r)=>{n?t(n):e(r)})});e.name=RP(/^ProductName:\s+(.*)$/m,t),e.version=RP(/^ProductVersion:\s+(.*)$/m,t),e.build=RP(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}();case"linux":return async function(){const e={kernel_version:w.release(),name:"Linux"};try{const t=await SP("/etc"),n=bP.find(e=>t.includes(e.name));if(!n)return e;const r=E.join("/etc",n.name),s=(await EP(r,{encoding:"utf-8"})).toLowerCase(),{distros:o}=n;e.name=o.find(e=>s.indexOf(vP(e))>=0)||o[0];const i=vP(e.name);e.version=AP[i]?.(s)}catch{}return e}();default:return{name:TP[e]||e,version:w.release()}}}());n.app&&(e.app=function(){const e=process.memoryUsage().rss,t={app_start_time:new Date(Date.now()-1e3*process.uptime()).toISOString(),app_memory:e};if("function"==typeof process.availableMemory){const e=process.availableMemory?.();null!=e&&(t.free_memory=e)}return t}());n.device&&(e.device=function(e){const t={};let n;try{n=w.uptime()}catch{}"number"==typeof n&&(t.boot_time=new Date(Date.now()-1e3*n).toISOString());t.arch=w.arch(),(!0===e||e.memory)&&(t.memory_size=w.totalmem(),t.free_memory=w.freemem());if(!0===e||e.cpu){const e=w.cpus(),n=e?.[0];n&&(t.processor_count=e.length,t.cpu_description=n.model,t.processor_frequency=n.speed)}return t}(n.device));if(n.culture){const t=function(){try{if("string"!=typeof process.versions.icu)return;const e=new Date(9e8);if("enero"===new Intl.DateTimeFormat("es",{month:"long"}).format(e)){const e=Intl.DateTimeFormat().resolvedOptions();return{locale:e.locale,timezone:e.timeZone}}}catch{}return}();t&&(e.culture=t)}n.cloudResource&&(e.cloud_resource=process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0);return e}());const r=function(e){e.app?.app_memory&&(e.app.app_memory=process.memoryUsage().rss);if(e.app?.free_memory&&"function"==typeof process.availableMemory){const t=process.availableMemory?.();null!=t&&(e.app.free_memory=t)}e.device?.free_memory&&(e.device.free_memory=w.freemem());return e}(await t);return e.contexts={...e.contexts,app:{...r.app,...e.contexts?.app},os:{...r.os,...e.contexts?.os},device:{...r.device,...e.contexts?.device},culture:{...r.culture,...e.contexts?.culture},cloud_resource:{...r.cloud_resource,...e.contexts?.cloud_resource}},e}return{name:"Context",processEvent:e=>r(e)}};const TP={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows"},bP=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],AP={alpine:e=>e,arch:e=>RP(/distrib_release=(.*)/,e),centos:e=>RP(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>RP(/release (..)/,e),mint:e=>RP(/distrib_release=(.*)/,e),red:e=>RP(/release ([^ ]+)/,e),suse:e=>RP(/VERSION = (.*)\n/,e),ubuntu:e=>RP(/distrib_release=(.*)/,e)};function RP(e,t){const n=e.exec(t);return n?n[1]:void 0}function vP(e){return e.split(" ")[0].toLowerCase()}const NP=new _O(10),CP=new _O(20);function OP(e,t,n){const r=e.get(t);return void 0===r?(e.set(t,n),n):r}function IP(e){return!!e.startsWith("node:")||(!!e.endsWith(".min.js")||(!!e.endsWith(".min.cjs")||(!!e.endsWith(".min.mjs")||!!e.startsWith("data:"))))}function PP(e){return void 0!==e.lineno&&e.lineno>1e4||void 0!==e.colno&&e.colno>1e3}function LP(e,t){const n=NP.get(e);if(void 0===n)return!1;for(let e=t[0];e<=t[1];e++)if(void 0===n[e])return!1;return!0}function wP(e,t){if(!e.length)return[];let n=0;const r=e[0];if("number"!=typeof r)return[];let s=UP(r,t);const o=[];for(;;){if(n===e.length-1){o.push(s);break}const r=e[n+1];if("number"!=typeof r)break;r<=s[1]?s[1]=r+t:(o.push(s),s=UP(r,t)),n++}return o}function MP(e,t,n){return new Promise((r,s)=>{const o=_.createReadStream(e),i=y.createInterface({input:o});function a(){o.destroy(),r()}let c=0,u=0;const l=t[u];if(void 0===l)return void a();let p=l[0],d=l[1];function h(t){CP.set(e,1),bO&&yy.error(`Failed to read file: ${e}. Error: ${t}`),i.close(),i.removeAllListeners(),a()}o.on("error",h),i.on("error",h),i.on("close",a),i.on("line",e=>{if(c++,!(c<p)&&(n[c]=function(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let s=Math.max(t-60,0);s<5&&(s=0);let o=Math.min(s+140,r);return o>r-5&&(o=r),o===r&&(s=Math.max(o-140,0)),n=n.slice(s,o),s>0&&(n=`'{snip} ${n}`),o<r&&(n+=" {snip}"),n}(e,0),c>=d)){if(u===t.length-1)return i.close(),void i.removeAllListeners();u++;const e=t[u];if(void 0===e)return i.close(),void i.removeAllListeners();p=e[0],d=e[1]}})})}function xP(e,t,n){for(const r of e)if(r.filename&&void 0===r.context_line&&"number"==typeof r.lineno){const e=n.get(r.filename);if(void 0===e)continue;GP(r.lineno,r,t,e)}}function kP(e){delete e.pre_context,delete e.context_line,delete e.post_context}function GP(e,t,n,r){if(void 0===t.lineno||void 0===r)return void(bO&&yy.error("Cannot resolve context for frame with no lineno or file contents"));t.pre_context=[];for(let s=DP(e,n);s<e;s++){const e=r[s];if(void 0===e)return kP(t),void(bO&&yy.error(`Could not find line ${s} in file ${t.filename}`));t.pre_context.push(e)}if(void 0===r[e])return kP(t),void(bO&&yy.error(`Could not find line ${e} in file ${t.filename}`));t.context_line=r[e];const s=VP(e,n);t.post_context=[];for(let n=e+1;n<=s;n++){const e=r[n];if(void 0===e)break;t.post_context.push(e)}}function DP(e,t){return Math.max(1,e-t)}function VP(e,t){return e+t}function UP(e,t){return[DP(e,t),VP(e,t)]}const HP=(e={})=>{const t=void 0!==e.frameContextLines?e.frameContextLines:7;return{name:"ContextLines",processEvent:e=>async function(e,t){const n={};if(t>0&&e.exception?.values)for(const t of e.exception.values)if(t.stacktrace?.frames?.length)for(let e=t.stacktrace.frames.length-1;e>=0;e--){const r=t.stacktrace.frames[e],s=r?.filename;!r||"string"!=typeof s||"number"!=typeof r.lineno||IP(s)||PP(r)||(n[s]||(n[s]=[]),n[s].push(r.lineno))}const r=Object.keys(n);if(0==r.length)return e;const s=[];for(const e of r){if(CP.get(e))continue;const r=n[e];if(!r)continue;r.sort((e,t)=>e-t);const o=wP(r,t);if(o.every(t=>LP(e,t)))continue;const i=OP(NP,e,{});s.push(MP(e,o,i))}if(await Promise.all(s).catch(()=>{bO&&yy.log("Failed to read one or more source files and resolve context lines")}),t>0&&e.exception?.values)for(const n of e.exception.values)n.stacktrace?.frames&&n.stacktrace.frames.length>0&&xP(n.stacktrace.frames,t,NP);return e}(e,t)}};let jP;async function ZP(){if(void 0===jP)try{const e=await import("node:inspector");jP=!!e.url()}catch{jP=!1}return jP}const WP="__SENTRY_ERROR_LOCAL_VARIABLES__";function XP(e){return void 0!==e&&(0===e.length||"?"===e||"<anonymous>"===e)}function $P(e,t){return e===t||`Object.${e}`===t||e===`Object.${t}`||XP(e)&&XP(t)}function FP(...e){yy.log("[LocalVariables]",...e)}const YP=(e={})=>{function t(e,t){const n=(e.stacktrace?.frames||[]).filter(e=>"new Promise"!==e.function);for(let e=0;e<n.length;e++){const r=n.length-e-1,s=t[e],o=n[r];if(!o||!s)break;void 0!==s.vars&&!1!==o.in_app&&$P(o.function,s.function)&&(o.vars=s.vars)}}return{name:"LocalVariablesAsync",async setup(t){if(!t.getOptions().includeLocalVariables)return;if(await ZP())return void yy.warn("Local variables capture has been disabled because the debugger was already enabled");const n={...e,debug:yy.isEnabled()};(async function(){const e=await import("node:inspector");e.url()||e.open(0)})().then(()=>{try{!function(e){const t=new T.Worker(new URL("data:application/javascript;base64,LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjguMCAoYmQ4NDU4ZSkgfCBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0ICovCmltcG9ydHtTZXNzaW9uIGFzIGV9ZnJvbSJub2RlOmluc3BlY3Rvci9wcm9taXNlcyI7aW1wb3J0e3dvcmtlckRhdGEgYXMgdH1mcm9tIm5vZGU6d29ya2VyX3RocmVhZHMiO2NvbnN0IG49Z2xvYmFsVGhpcyxpPXt9O2NvbnN0IG89Il9fU0VOVFJZX0VSUk9SX0xPQ0FMX1ZBUklBQkxFU19fIjtjb25zdCBhPXQ7ZnVuY3Rpb24gcyguLi5lKXthLmRlYnVnJiZmdW5jdGlvbihlKXtpZighKCJjb25zb2xlImluIG4pKXJldHVybiBlKCk7Y29uc3QgdD1uLmNvbnNvbGUsbz17fSxhPU9iamVjdC5rZXlzKGkpO2EuZm9yRWFjaChlPT57Y29uc3Qgbj1pW2VdO29bZV09dFtlXSx0W2VdPW59KTt0cnl7cmV0dXJuIGUoKX1maW5hbGx5e2EuZm9yRWFjaChlPT57dFtlXT1vW2VdfSl9fSgoKT0+Y29uc29sZS5sb2coIltMb2NhbFZhcmlhYmxlcyBXb3JrZXJdIiwuLi5lKSl9YXN5bmMgZnVuY3Rpb24gYyhlLHQsbixpKXtjb25zdCBvPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSk7aVtuXT1vLnJlc3VsdC5maWx0ZXIoZT0+Imxlbmd0aCIhPT1lLm5hbWUmJiFpc05hTihwYXJzZUludChlLm5hbWUsMTApKSkuc29ydCgoZSx0KT0+cGFyc2VJbnQoZS5uYW1lLDEwKS1wYXJzZUludCh0Lm5hbWUsMTApKS5tYXAoZT0+ZS52YWx1ZT8udmFsdWUpfWFzeW5jIGZ1bmN0aW9uIHIoZSx0LG4saSl7Y29uc3Qgbz1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pO2lbbl09by5yZXN1bHQubWFwKGU9PltlLm5hbWUsZS52YWx1ZT8udmFsdWVdKS5yZWR1Y2UoKGUsW3Qsbl0pPT4oZVt0XT1uLGUpLHt9KX1mdW5jdGlvbiB1KGUsdCl7ZS52YWx1ZSYmKCJ2YWx1ZSJpbiBlLnZhbHVlP3ZvaWQgMD09PWUudmFsdWUudmFsdWV8fG51bGw9PT1lLnZhbHVlLnZhbHVlP3RbZS5uYW1lXT1gPCR7ZS52YWx1ZS52YWx1ZX0+YDp0W2UubmFtZV09ZS52YWx1ZS52YWx1ZToiZGVzY3JpcHRpb24iaW4gZS52YWx1ZSYmImZ1bmN0aW9uIiE9PWUudmFsdWUudHlwZT90W2UubmFtZV09YDwke2UudmFsdWUuZGVzY3JpcHRpb259PmA6InVuZGVmaW5lZCI9PT1lLnZhbHVlLnR5cGUmJih0W2UubmFtZV09Ijx1bmRlZmluZWQ+IikpfWFzeW5jIGZ1bmN0aW9uIGwoZSx0KXtjb25zdCBuPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSksaT17fTtmb3IoY29uc3QgdCBvZiBuLnJlc3VsdClpZih0LnZhbHVlPy5vYmplY3RJZCYmIkFycmF5Ij09PXQudmFsdWUuY2xhc3NOYW1lKXtjb25zdCBuPXQudmFsdWUub2JqZWN0SWQ7YXdhaXQgYyhlLG4sdC5uYW1lLGkpfWVsc2UgaWYodC52YWx1ZT8ub2JqZWN0SWQmJiJPYmplY3QiPT09dC52YWx1ZS5jbGFzc05hbWUpe2NvbnN0IG49dC52YWx1ZS5vYmplY3RJZDthd2FpdCByKGUsbix0Lm5hbWUsaSl9ZWxzZSB0LnZhbHVlJiZ1KHQsaSk7cmV0dXJuIGl9bGV0IGY7KGFzeW5jIGZ1bmN0aW9uKCl7Y29uc3QgdD1uZXcgZTt0LmNvbm5lY3RUb01haW5UaHJlYWQoKSxzKCJDb25uZWN0ZWQgdG8gbWFpbiB0aHJlYWQiKTtsZXQgbj0hMTt0Lm9uKCJEZWJ1Z2dlci5yZXN1bWVkIiwoKT0+e249ITF9KSx0Lm9uKCJEZWJ1Z2dlci5wYXVzZWQiLGU9PntuPSEwLGFzeW5jIGZ1bmN0aW9uKGUse3JlYXNvbjp0LGRhdGE6e29iamVjdElkOm59LGNhbGxGcmFtZXM6aX0pe2lmKCJleGNlcHRpb24iIT09dCYmInByb21pc2VSZWplY3Rpb24iIT09dClyZXR1cm47aWYoZj8uKCksbnVsbD09bilyZXR1cm47Y29uc3QgYT1bXTtmb3IobGV0IHQ9MDt0PGkubGVuZ3RoO3QrKyl7Y29uc3R7c2NvcGVDaGFpbjpuLGZ1bmN0aW9uTmFtZTpvLHRoaXM6c309aVt0XSxjPW4uZmluZChlPT4ibG9jYWwiPT09ZS50eXBlKSxyPSJnbG9iYWwiIT09cy5jbGFzc05hbWUmJnMuY2xhc3NOYW1lP2Ake3MuY2xhc3NOYW1lfS4ke299YDpvO2lmKHZvaWQgMD09PWM/Lm9iamVjdC5vYmplY3RJZClhW3RdPXtmdW5jdGlvbjpyfTtlbHNle2NvbnN0IG49YXdhaXQgbChlLGMub2JqZWN0Lm9iamVjdElkKTthW3RdPXtmdW5jdGlvbjpyLHZhcnM6bn19fWF3YWl0IGUucG9zdCgiUnVudGltZS5jYWxsRnVuY3Rpb25PbiIse2Z1bmN0aW9uRGVjbGFyYXRpb246YGZ1bmN0aW9uKCkgeyB0aGlzLiR7b30gPSB0aGlzLiR7b30gfHwgJHtKU09OLnN0cmluZ2lmeShhKX07IH1gLHNpbGVudDohMCxvYmplY3RJZDpufSksYXdhaXQgZS5wb3N0KCJSdW50aW1lLnJlbGVhc2VPYmplY3QiLHtvYmplY3RJZDpufSl9KHQsZS5wYXJhbXMpLnRoZW4oYXN5bmMoKT0+e24mJmF3YWl0IHQucG9zdCgiRGVidWdnZXIucmVzdW1lIil9LGFzeW5jIGU9PntuJiZhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpfSl9KSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLmVuYWJsZSIpO2NvbnN0IGk9ITEhPT1hLmNhcHR1cmVBbGxFeGNlcHRpb25zO2lmKGF3YWl0IHQucG9zdCgiRGVidWdnZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMiLHtzdGF0ZTppPyJhbGwiOiJ1bmNhdWdodCJ9KSxpKXtjb25zdCBlPWEubWF4RXhjZXB0aW9uc1BlclNlY29uZHx8NTA7Zj1mdW5jdGlvbihlLHQsbil7bGV0IGk9MCxvPTUsYT0wO3JldHVybiBzZXRJbnRlcnZhbCgoKT0+ezA9PT1hP2k+ZSYmKG8qPTIsbihvKSxvPjg2NDAwJiYobz04NjQwMCksYT1vKTooYS09MSwwPT09YSYmdCgpKSxpPTB9LDFlMykudW5yZWYoKSwoKT0+e2krPTF9fShlLGFzeW5jKCk9PntzKCJSYXRlLWxpbWl0IGxpZnRlZC4iKSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6ImFsbCJ9KX0sYXN5bmMgZT0+e3MoYFJhdGUtbGltaXQgZXhjZWVkZWQuIERpc2FibGluZyBjYXB0dXJpbmcgb2YgY2F1Z2h0IGV4Y2VwdGlvbnMgZm9yICR7ZX0gc2Vjb25kcy5gKSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6InVuY2F1Z2h0In0pfSl9fSkoKS5jYXRjaChlPT57cygiRmFpbGVkIHRvIHN0YXJ0IGRlYnVnZ2VyIixlKX0pLHNldEludGVydmFsKCgpPT57fSwxZTQpOw=="),{workerData:e,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{t.terminate()}),t.once("error",e=>{FP("Worker error",e)}),t.once("exit",e=>{FP("Worker exit",e)}),t.unref()}(n)}catch(e){yy.error("Failed to start worker",e)}},e=>{yy.error("Failed to start inspector",e)})},processEvent:(e,n)=>function(e,n){if(n.originalException&&"object"==typeof n.originalException&&WP in n.originalException&&Array.isArray(n.originalException[WP])){for(const r of e.exception?.values||[])t(r,n.originalException[WP]);n.originalException[WP]=void 0}return e}(e,n)}};function BP(e){if(void 0!==e)return e.slice(-10).reduce((e,t)=>`${e},${t.function},${t.lineno},${t.colno}`,"")}function KP(e){let t=[],n=!1;function r(r){t=[],n||(n=!0,e(r))}return t.push(r),{add:function(e){t.push(e)},next:function(e){const n=t.pop()||r;try{n(e)}catch{r(e)}}}}class JP{constructor(e){this._session=e}static async create(e){if(e)return e;const t=await import("node:inspector");return new JP(new t.Session)}configureAndConnect(e,t){this._session.connect(),this._session.on("Debugger.paused",t=>{e(t,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}setPauseOnExceptions(e){this._session.post("Debugger.setPauseOnExceptions",{state:e?"all":"uncaught"})}getLocalVariables(e,t){this._getProperties(e,e=>{const{add:n,next:r}=KP(t);for(const t of e)if(t.value?.objectId&&"Array"===t.value.className){const e=t.value.objectId;n(n=>this._unrollArray(e,t.name,n,r))}else if(t.value?.objectId&&"Object"===t.value.className){const e=t.value.objectId;n(n=>this._unrollObject(e,t.name,n,r))}else t.value&&n(e=>this._unrollOther(t,e,r));r({})})}_getProperties(e,t){this._session.post("Runtime.getProperties",{objectId:e,ownProperties:!0},(e,n)=>{t(e?[]:n.result)})}_unrollArray(e,t,n,r){this._getProperties(e,e=>{n[t]=e.filter(e=>"length"!==e.name&&!isNaN(parseInt(e.name,10))).sort((e,t)=>parseInt(e.name,10)-parseInt(t.name,10)).map(e=>e.value?.value),r(n)})}_unrollObject(e,t,n,r){this._getProperties(e,e=>{n[t]=e.map(e=>[e.name,e.value?.value]).reduce((e,[t,n])=>(e[t]=n,e),{}),r(n)})}_unrollOther(e,t,n){e.value&&("value"in e.value?void 0===e.value.value||null===e.value.value?t[e.name]=`<${e.value.value}>`:t[e.name]=e.value.value:"description"in e.value&&"function"!==e.value.type?t[e.name]=`<${e.value.description}>`:"undefined"===e.value.type&&(t[e.name]="<undefined>")),n(t)}}const zP=(e={},t)=>{const n=new _O(20);let r,s=!1;function o(e){const t=BP(e.stacktrace?.frames);if(void 0===t)return;const r=n.remove(t);if(void 0===r)return;const s=(e.stacktrace?.frames||[]).filter(e=>"new Promise"!==e.function);for(let e=0;e<s.length;e++){const t=s.length-e-1,n=r[e],o=s[t];if(!o||!n)break;void 0!==n.vars&&!1!==o.in_app&&$P(o.function,n.function)&&(o.vars=n.vars)}}return{name:"LocalVariables",async setupOnce(){const o=DT(),i=o?.getOptions();if(!i?.includeLocalVariables)return;uP<18?yy.log("The `LocalVariables` integration is only supported on Node >= v18."):await ZP()?yy.warn("Local variables capture has been disabled because the debugger was already enabled"):JP.create(t).then(t=>{function o(e,{params:{reason:s,data:o,callFrames:i}},a){if("exception"!==s&&"promiseRejection"!==s)return void a();r?.();const c=function(e,t){if(void 0!==t)return BP(e(t,1))}(e,o.description);if(null==c)return void a();const{add:u,next:l}=KP(e=>{n.set(c,e),a()});for(let e=0;e<Math.min(i.length,5);e++){const{scopeChain:n,functionName:r,this:s}=i[e],o=n.find(e=>"local"===e.type),a="global"!==s.className&&s.className?`${s.className}.${r}`:r;if(void 0===o?.object.objectId)u(t=>{t[e]={function:a},l(t)});else{const n=o.object.objectId;u(r=>t.getLocalVariables(n,t=>{r[e]={function:a,vars:t},l(r)}))}}l([])}const a=!1!==e.captureAllExceptions;if(t.configureAndConnect((e,t)=>o(i.stackParser,e,t),a),a){const n=e.maxExceptionsPerSecond||50;r=function(e,t,n){let r=0,s=5,o=0;return setInterval(()=>{0===o?r>e&&(s*=2,n(s),s>86400&&(s=86400),o=s):(o-=1,0===o&&t()),r=0},1e3).unref(),()=>{r+=1}}(n,()=>{yy.log("Local variables rate-limit lifted."),t.setPauseOnExceptions(!0)},e=>{yy.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${e} seconds.`),t.setPauseOnExceptions(!1)})}s=!0},e=>{yy.log("The `LocalVariables` integration failed to start.",e)})},processEvent:e=>s?function(e){for(const t of e.exception?.values||[])o(t);return e}(e):e,_getCachedFramesCount:()=>n.size,_getFirstCachedFrame:()=>n.values()[0]}},QP=(e={})=>cP.major<19?zP(e):YP(e);function qP(){try{return"undefined"!=typeof module&&void 0!==module.exports}catch{return!1}}let eL;const tL="undefined"==typeof __SENTRY_SERVER_MODULES__?{}:__SENTRY_SERVER_MODULES__,nL=()=>({name:"Modules",processEvent:e=>(e.modules={...e.modules,...sL()},e),getModules:sL});function rL(){const e=require.main?.paths||[],t=function(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}(),n={},r=new Set;return t.forEach(t=>{let s=t;const o=()=>{const t=s;if(s=E.dirname(t),!s||t===s||r.has(t))return;if(e.indexOf(s)<0)return o();const i=E.join(t,"package.json");if(r.add(t),!_.existsSync(i))return o();try{const e=JSON.parse(_.readFileSync(i,"utf8"));n[e.name]=e.version}catch{}};o()}),n}function sL(){return eL||(eL={...tL,...oL(),...qP()?rL():{}}),eL}function oL(){const e=function(){try{const e=E.join(process.cwd(),"package.json");return JSON.parse(_.readFileSync(e,"utf8"))}catch{return{}}}();return{...e.dependencies,...e.devDependencies}}function iL(e){_y(()=>{console.error(e)});const t=DT();if(void 0===t)return bO&&yy.warn("No NodeClient was defined, we are exiting the process now."),void global.process.exit(1);const n=t.getOptions(),r=n?.shutdownTimeout&&n.shutdownTimeout>0?n.shutdownTimeout:2e3;t.close(r).then(e=>{e||bO&&yy.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},e=>{bO&&yy.error(e)})}const aL=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!1,...e};return{name:"OnUncaughtException",setup(e){global.process.on("uncaughtException",function(e,t){const n=2e3;let r,s=!1,o=!1,i=!1;const a=e.getOptions();return Object.assign(c=>{let u=iL;t.onFatalError?u=t.onFatalError:a.onFatalError&&(u=a.onFatalError);const l=0===global.process.listeners("uncaughtException").filter(e=>"domainUncaughtExceptionClear"!==e.name&&"sentry_tracingErrorCallback"!==e.tag&&!0!==e._errorHandler).length,p=t.exitEvenIfOtherHandlersAreRegistered||l;s?p&&(i?(bO&&yy.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),iL(c)):o||(o=!0,setTimeout(()=>{i||(i=!0,u(r,c))},n))):(r=c,s=!0,DT()===e&&XA(c,{originalException:c,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"onuncaughtexception"}}),!i&&p&&(i=!0,u(c)))},{_errorHandler:!0})}(e,t))}}};const cL=(e={})=>{const t={mode:"warn",...e};return{name:"OnUnhandledRejection",setup(e){global.process.on("unhandledRejection",function(e,t){return function(n,r){if(DT()!==e)return;const s="strict"===t.mode?"fatal":"error",o=n&&"object"==typeof n?n._sentry_active_span:void 0;(o?e=>TA(o,e):e=>e())(()=>{XA(n,{originalException:r,captureContext:{extra:{unhandledPromiseRejection:!0},level:s},mechanism:{handled:!1,type:"onunhandledrejection"}})}),function(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";"warn"===t?_y(()=>{console.warn(n),console.error(e&&"object"==typeof e&&"stack"in e?e.stack:e)}):"strict"===t&&(_y(()=>{console.warn(n)}),iL(e))}(n,t.mode)}}(e,t))}}};const{isPromise:uL}=S.types,lL="LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjguMCAoYmQ4NDU4ZSkgfCBodHRwczovL2dpdGh1Yi5jb20vZ2V0c2VudHJ5L3NlbnRyeS1qYXZhc2NyaXB0ICovCmltcG9ydHtTZXNzaW9uIGFzIHR9ZnJvbSJub2RlOmluc3BlY3RvciI7aW1wb3J0e3dvcmtlckRhdGEgYXMgbixwYXJlbnRQb3J0IGFzIGV9ZnJvbSJub2RlOndvcmtlcl90aHJlYWRzIjtpbXBvcnR7cG9zaXggYXMgcixzZXAgYXMgb31mcm9tIm5vZGU6cGF0aCI7aW1wb3J0KmFzIHMgZnJvbSJub2RlOmh0dHAiO2ltcG9ydCphcyBpIGZyb20ibm9kZTpodHRwcyI7aW1wb3J0e1JlYWRhYmxlIGFzIGN9ZnJvbSJub2RlOnN0cmVhbSI7aW1wb3J0e2NyZWF0ZUd6aXAgYXMgdX1mcm9tIm5vZGU6emxpYiI7aW1wb3J0KmFzIGEgZnJvbSJub2RlOm5ldCI7aW1wb3J0KmFzIGYgZnJvbSJub2RlOnRscyI7Y29uc3QgaD0idW5kZWZpbmVkIj09dHlwZW9mIF9fU0VOVFJZX0RFQlVHX198fF9fU0VOVFJZX0RFQlVHX18scD1nbG9iYWxUaGlzLGw9IjEwLjguMCI7ZnVuY3Rpb24gZCgpe3JldHVybiBtKHApLHB9ZnVuY3Rpb24gbSh0KXtjb25zdCBuPXQuX19TRU5UUllfXz10Ll9fU0VOVFJZX198fHt9O3JldHVybiBuLnZlcnNpb249bi52ZXJzaW9ufHxsLG5bbF09bltsXXx8e319ZnVuY3Rpb24gZyh0LG4sZT1wKXtjb25zdCByPWUuX19TRU5UUllfXz1lLl9fU0VOVFJZX198fHt9LG89cltsXT1yW2xdfHx7fTtyZXR1cm4gb1t0XXx8KG9bdF09bigpKX1jb25zdCB5PXt9O2Z1bmN0aW9uIGIodCl7aWYoISgiY29uc29sZSJpbiBwKSlyZXR1cm4gdCgpO2NvbnN0IG49cC5jb25zb2xlLGU9e30scj1PYmplY3Qua2V5cyh5KTtyLmZvckVhY2godD0+e2NvbnN0IHI9eVt0XTtlW3RdPW5bdF0sblt0XT1yfSk7dHJ5e3JldHVybiB0KCl9ZmluYWxseXtyLmZvckVhY2godD0+e25bdF09ZVt0XX0pfX1mdW5jdGlvbiB2KCl7cmV0dXJuIHcoKS5lbmFibGVkfWZ1bmN0aW9uIF8odCwuLi5uKXtoJiZ2KCkmJmIoKCk9PntwLmNvbnNvbGVbdF0oYFNlbnRyeSBMb2dnZXIgWyR7dH1dOmAsLi4ubil9KX1mdW5jdGlvbiB3KCl7cmV0dXJuIGg/ZygibG9nZ2VyU2V0dGluZ3MiLCgpPT4oe2VuYWJsZWQ6ITF9KSk6e2VuYWJsZWQ6ITF9fWNvbnN0IFM9e2VuYWJsZTpmdW5jdGlvbigpe3coKS5lbmFibGVkPSEwfSxkaXNhYmxlOmZ1bmN0aW9uKCl7dygpLmVuYWJsZWQ9ITF9LGlzRW5hYmxlZDp2LGxvZzpmdW5jdGlvbiguLi50KXtfKCJsb2ciLC4uLnQpfSx3YXJuOmZ1bmN0aW9uKC4uLnQpe18oIndhcm4iLC4uLnQpfSxlcnJvcjpmdW5jdGlvbiguLi50KXtfKCJlcnJvciIsLi4udCl9fSwkPS9jYXB0dXJlTWVzc2FnZXxjYXB0dXJlRXhjZXB0aW9uLztmdW5jdGlvbiBFKHQpe3JldHVybiB0W3QubGVuZ3RoLTFdfHx7fX1jb25zdCB4PSI8YW5vbnltb3VzPiI7Y29uc3QgTj1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO2Z1bmN0aW9uIEModCxuKXtyZXR1cm4gTi5jYWxsKHQpPT09YFtvYmplY3QgJHtufV1gfWZ1bmN0aW9uIGsodCl7cmV0dXJuIEModCwiU3RyaW5nIil9ZnVuY3Rpb24gVCh0KXtyZXR1cm4gQyh0LCJPYmplY3QiKX1mdW5jdGlvbiBqKHQpe3JldHVybiBCb29sZWFuKHQ/LnRoZW4mJiJmdW5jdGlvbiI9PXR5cGVvZiB0LnRoZW4pfWZ1bmN0aW9uIEkodCxuKXt0cnl7cmV0dXJuIHQgaW5zdGFuY2VvZiBufWNhdGNoe3JldHVybiExfX1jb25zdCBPPXA7ZnVuY3Rpb24gUih0LG4pe2NvbnN0IGU9dCxyPVtdO2lmKCFlPy50YWdOYW1lKXJldHVybiIiO2lmKE8uSFRNTEVsZW1lbnQmJmUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCYmZS5kYXRhc2V0KXtpZihlLmRhdGFzZXQuc2VudHJ5Q29tcG9uZW50KXJldHVybiBlLmRhdGFzZXQuc2VudHJ5Q29tcG9uZW50O2lmKGUuZGF0YXNldC5zZW50cnlFbGVtZW50KXJldHVybiBlLmRhdGFzZXQuc2VudHJ5RWxlbWVudH1yLnB1c2goZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkpO2NvbnN0IG89bj8ubGVuZ3RoP24uZmlsdGVyKHQ9PmUuZ2V0QXR0cmlidXRlKHQpKS5tYXAodD0+W3QsZS5nZXRBdHRyaWJ1dGUodCldKTpudWxsO2lmKG8/Lmxlbmd0aClvLmZvckVhY2godD0+e3IucHVzaChgWyR7dFswXX09IiR7dFsxXX0iXWApfSk7ZWxzZXtlLmlkJiZyLnB1c2goYCMke2UuaWR9YCk7Y29uc3QgdD1lLmNsYXNzTmFtZTtpZih0JiZrKHQpKXtjb25zdCBuPXQuc3BsaXQoL1xzKy8pO2Zvcihjb25zdCB0IG9mIG4pci5wdXNoKGAuJHt0fWApfX1jb25zdCBzPVsiYXJpYS1sYWJlbCIsInR5cGUiLCJuYW1lIiwidGl0bGUiLCJhbHQiXTtmb3IoY29uc3QgdCBvZiBzKXtjb25zdCBuPWUuZ2V0QXR0cmlidXRlKHQpO24mJnIucHVzaChgWyR7dH09IiR7bn0iXWApfXJldHVybiByLmpvaW4oIiIpfWZ1bmN0aW9uIEEodCxuPTApe3JldHVybiJzdHJpbmciIT10eXBlb2YgdHx8MD09PW58fHQubGVuZ3RoPD1uP3Q6YCR7dC5zbGljZSgwLG4pfS4uLmB9ZnVuY3Rpb24gRCh0KXtpZihmdW5jdGlvbih0KXtzd2l0Y2goTi5jYWxsKHQpKXtjYXNlIltvYmplY3QgRXJyb3JdIjpjYXNlIltvYmplY3QgRXhjZXB0aW9uXSI6Y2FzZSJbb2JqZWN0IERPTUV4Y2VwdGlvbl0iOmNhc2UiW29iamVjdCBXZWJBc3NlbWJseS5FeGNlcHRpb25dIjpyZXR1cm4hMDtkZWZhdWx0OnJldHVybiBJKHQsRXJyb3IpfX0odCkpcmV0dXJue21lc3NhZ2U6dC5tZXNzYWdlLG5hbWU6dC5uYW1lLHN0YWNrOnQuc3RhY2ssLi4uVSh0KX07aWYobj10LCJ1bmRlZmluZWQiIT10eXBlb2YgRXZlbnQmJkkobixFdmVudCkpe2NvbnN0IG49e3R5cGU6dC50eXBlLHRhcmdldDpQKHQudGFyZ2V0KSxjdXJyZW50VGFyZ2V0OlAodC5jdXJyZW50VGFyZ2V0KSwuLi5VKHQpfTtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIEN1c3RvbUV2ZW50JiZJKHQsQ3VzdG9tRXZlbnQpJiYobi5kZXRhaWw9dC5kZXRhaWwpLG59cmV0dXJuIHQ7dmFyIG59ZnVuY3Rpb24gUCh0KXt0cnl7cmV0dXJuIG49dCwidW5kZWZpbmVkIiE9dHlwZW9mIEVsZW1lbnQmJkkobixFbGVtZW50KT9mdW5jdGlvbih0LG49e30pe2lmKCF0KXJldHVybiI8dW5rbm93bj4iO3RyeXtsZXQgZT10O2NvbnN0IHI9NSxvPVtdO2xldCBzPTAsaT0wO2NvbnN0IGM9IiA+ICIsdT1jLmxlbmd0aDtsZXQgYTtjb25zdCBmPUFycmF5LmlzQXJyYXkobik/bjpuLmtleUF0dHJzLGg9IUFycmF5LmlzQXJyYXkobikmJm4ubWF4U3RyaW5nTGVuZ3RofHw4MDtmb3IoO2UmJnMrKzxyJiYoYT1SKGUsZiksISgiaHRtbCI9PT1hfHxzPjEmJmkrby5sZW5ndGgqdSthLmxlbmd0aD49aCkpOylvLnB1c2goYSksaSs9YS5sZW5ndGgsZT1lLnBhcmVudE5vZGU7cmV0dXJuIG8ucmV2ZXJzZSgpLmpvaW4oYyl9Y2F0Y2h7cmV0dXJuIjx1bmtub3duPiJ9fSh0KTpPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9Y2F0Y2h7cmV0dXJuIjx1bmtub3duPiJ9dmFyIG59ZnVuY3Rpb24gVSh0KXtpZigib2JqZWN0Ij09dHlwZW9mIHQmJm51bGwhPT10KXtjb25zdCBuPXt9O2Zvcihjb25zdCBlIGluIHQpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsZSkmJihuW2VdPXRbZV0pO3JldHVybiBufXJldHVybnt9fWZ1bmN0aW9uIE0odD1mdW5jdGlvbigpe2NvbnN0IHQ9cDtyZXR1cm4gdC5jcnlwdG98fHQubXNDcnlwdG99KCkpe2xldCBuPSgpPT4xNipNYXRoLnJhbmRvbSgpO3RyeXtpZih0Py5yYW5kb21VVUlEKXJldHVybiB0LnJhbmRvbVVVSUQoKS5yZXBsYWNlKC8tL2csIiIpO3Q/LmdldFJhbmRvbVZhbHVlcyYmKG49KCk9Pntjb25zdCBuPW5ldyBVaW50OEFycmF5KDEpO3JldHVybiB0LmdldFJhbmRvbVZhbHVlcyhuKSxuWzBdfSl9Y2F0Y2h7fXJldHVybihbMWU3XSsxZTMrNGUzKzhlMysxZTExKS5yZXBsYWNlKC9bMDE4XS9nLHQ9Pih0XigxNSZuKCkpPj50LzQpLnRvU3RyaW5nKDE2KSl9ZnVuY3Rpb24gTCgpe3JldHVybiBEYXRlLm5vdygpLzFlM31sZXQgQjtmdW5jdGlvbiBHKCl7cmV0dXJuKEI/PyhCPWZ1bmN0aW9uKCl7Y29uc3R7cGVyZm9ybWFuY2U6dH09cDtpZighdD8ubm93fHwhdC50aW1lT3JpZ2luKXJldHVybiBMO2NvbnN0IG49dC50aW1lT3JpZ2luO3JldHVybigpPT4obit0Lm5vdygpKS8xZTN9KCkpKSgpfWZ1bmN0aW9uIEgodCl7Y29uc3Qgbj1HKCksZT17c2lkOk0oKSxpbml0OiEwLHRpbWVzdGFtcDpuLHN0YXJ0ZWQ6bixkdXJhdGlvbjowLHN0YXR1czoib2siLGVycm9yczowLGlnbm9yZUR1cmF0aW9uOiExLHRvSlNPTjooKT0+ZnVuY3Rpb24odCl7cmV0dXJue3NpZDpgJHt0LnNpZH1gLGluaXQ6dC5pbml0LHN0YXJ0ZWQ6bmV3IERhdGUoMWUzKnQuc3RhcnRlZCkudG9JU09TdHJpbmcoKSx0aW1lc3RhbXA6bmV3IERhdGUoMWUzKnQudGltZXN0YW1wKS50b0lTT1N0cmluZygpLHN0YXR1czp0LnN0YXR1cyxlcnJvcnM6dC5lcnJvcnMsZGlkOiJudW1iZXIiPT10eXBlb2YgdC5kaWR8fCJzdHJpbmciPT10eXBlb2YgdC5kaWQ/YCR7dC5kaWR9YDp2b2lkIDAsZHVyYXRpb246dC5kdXJhdGlvbixhYm5vcm1hbF9tZWNoYW5pc206dC5hYm5vcm1hbF9tZWNoYW5pc20sYXR0cnM6e3JlbGVhc2U6dC5yZWxlYXNlLGVudmlyb25tZW50OnQuZW52aXJvbm1lbnQsaXBfYWRkcmVzczp0LmlwQWRkcmVzcyx1c2VyX2FnZW50OnQudXNlckFnZW50fX19KGUpfTtyZXR1cm4gdCYmSihlLHQpLGV9ZnVuY3Rpb24gSih0LG49e30pe2lmKG4udXNlciYmKCF0LmlwQWRkcmVzcyYmbi51c2VyLmlwX2FkZHJlc3MmJih0LmlwQWRkcmVzcz1uLnVzZXIuaXBfYWRkcmVzcyksdC5kaWR8fG4uZGlkfHwodC5kaWQ9bi51c2VyLmlkfHxuLnVzZXIuZW1haWx8fG4udXNlci51c2VybmFtZSkpLHQudGltZXN0YW1wPW4udGltZXN0YW1wfHxHKCksbi5hYm5vcm1hbF9tZWNoYW5pc20mJih0LmFibm9ybWFsX21lY2hhbmlzbT1uLmFibm9ybWFsX21lY2hhbmlzbSksbi5pZ25vcmVEdXJhdGlvbiYmKHQuaWdub3JlRHVyYXRpb249bi5pZ25vcmVEdXJhdGlvbiksbi5zaWQmJih0LnNpZD0zMj09PW4uc2lkLmxlbmd0aD9uLnNpZDpNKCkpLHZvaWQgMCE9PW4uaW5pdCYmKHQuaW5pdD1uLmluaXQpLCF0LmRpZCYmbi5kaWQmJih0LmRpZD1gJHtuLmRpZH1gKSwibnVtYmVyIj09dHlwZW9mIG4uc3RhcnRlZCYmKHQuc3RhcnRlZD1uLnN0YXJ0ZWQpLHQuaWdub3JlRHVyYXRpb24pdC5kdXJhdGlvbj12b2lkIDA7ZWxzZSBpZigibnVtYmVyIj09dHlwZW9mIG4uZHVyYXRpb24pdC5kdXJhdGlvbj1uLmR1cmF0aW9uO2Vsc2V7Y29uc3Qgbj10LnRpbWVzdGFtcC10LnN0YXJ0ZWQ7dC5kdXJhdGlvbj1uPj0wP246MH1uLnJlbGVhc2UmJih0LnJlbGVhc2U9bi5yZWxlYXNlKSxuLmVudmlyb25tZW50JiYodC5lbnZpcm9ubWVudD1uLmVudmlyb25tZW50KSwhdC5pcEFkZHJlc3MmJm4uaXBBZGRyZXNzJiYodC5pcEFkZHJlc3M9bi5pcEFkZHJlc3MpLCF0LnVzZXJBZ2VudCYmbi51c2VyQWdlbnQmJih0LnVzZXJBZ2VudD1uLnVzZXJBZ2VudCksIm51bWJlciI9PXR5cGVvZiBuLmVycm9ycyYmKHQuZXJyb3JzPW4uZXJyb3JzKSxuLnN0YXR1cyYmKHQuc3RhdHVzPW4uc3RhdHVzKX1mdW5jdGlvbiB6KHQsbixlPTIpe2lmKCFufHwib2JqZWN0IiE9dHlwZW9mIG58fGU8PTApcmV0dXJuIG47aWYodCYmMD09PU9iamVjdC5rZXlzKG4pLmxlbmd0aClyZXR1cm4gdDtjb25zdCByPXsuLi50fTtmb3IoY29uc3QgdCBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLHQpJiYoclt0XT16KHJbdF0sblt0XSxlLTEpKTtyZXR1cm4gcn1mdW5jdGlvbiBGKCl7cmV0dXJuIE0oKX1mdW5jdGlvbiBXKCl7cmV0dXJuIE0oKS5zdWJzdHJpbmcoMTYpfWNvbnN0IFk9Il9zZW50cnlTcGFuIjtmdW5jdGlvbiBLKHQsbil7bj9mdW5jdGlvbih0LG4sZSl7dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LG4se3ZhbHVlOmUsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfSl9Y2F0Y2h7aCYmUy5sb2coYEZhaWxlZCB0byBhZGQgbm9uLWVudW1lcmFibGUgcHJvcGVydHkgIiR7bn0iIHRvIG9iamVjdGAsdCl9fSh0LFksbik6ZGVsZXRlIHRbWV19ZnVuY3Rpb24gWih0KXtyZXR1cm4gdFtZXX1jbGFzcyBWe2NvbnN0cnVjdG9yKCl7dGhpcy50PSExLHRoaXMubz1bXSx0aGlzLmk9W10sdGhpcy51PVtdLHRoaXMuaD1bXSx0aGlzLnA9e30sdGhpcy5sPXt9LHRoaXMubT17fSx0aGlzLnY9e30sdGhpcy5fPXt9LHRoaXMuUz17dHJhY2VJZDpGKCksc2FtcGxlUmFuZDpNYXRoLnJhbmRvbSgpfX1jbG9uZSgpe2NvbnN0IHQ9bmV3IFY7cmV0dXJuIHQudT1bLi4udGhpcy51XSx0Lmw9ey4uLnRoaXMubH0sdC5tPXsuLi50aGlzLm19LHQudj17Li4udGhpcy52fSx0aGlzLnYuZmxhZ3MmJih0LnYuZmxhZ3M9e3ZhbHVlczpbLi4udGhpcy52LmZsYWdzLnZhbHVlc119KSx0LnA9dGhpcy5wLHQuTj10aGlzLk4sdC5DPXRoaXMuQyx0Lms9dGhpcy5rLHQuVD10aGlzLlQsdC5pPVsuLi50aGlzLmldLHQuaD1bLi4udGhpcy5oXSx0Ll89ey4uLnRoaXMuX30sdC5TPXsuLi50aGlzLlN9LHQuaj10aGlzLmosdC5JPXRoaXMuSSxLKHQsWih0aGlzKSksdH1zZXRDbGllbnQodCl7dGhpcy5qPXR9c2V0TGFzdEV2ZW50SWQodCl7dGhpcy5JPXR9Z2V0Q2xpZW50KCl7cmV0dXJuIHRoaXMuan1sYXN0RXZlbnRJZCgpe3JldHVybiB0aGlzLkl9YWRkU2NvcGVMaXN0ZW5lcih0KXt0aGlzLm8ucHVzaCh0KX1hZGRFdmVudFByb2Nlc3Nvcih0KXtyZXR1cm4gdGhpcy5pLnB1c2godCksdGhpc31zZXRVc2VyKHQpe3JldHVybiB0aGlzLnA9dHx8e2VtYWlsOnZvaWQgMCxpZDp2b2lkIDAsaXBfYWRkcmVzczp2b2lkIDAsdXNlcm5hbWU6dm9pZCAwfSx0aGlzLkMmJkoodGhpcy5DLHt1c2VyOnR9KSx0aGlzLk8oKSx0aGlzfWdldFVzZXIoKXtyZXR1cm4gdGhpcy5wfXNldFRhZ3ModCl7cmV0dXJuIHRoaXMubD17Li4udGhpcy5sLC4uLnR9LHRoaXMuTygpLHRoaXN9c2V0VGFnKHQsbil7cmV0dXJuIHRoaXMubD17Li4udGhpcy5sLFt0XTpufSx0aGlzLk8oKSx0aGlzfXNldEV4dHJhcyh0KXtyZXR1cm4gdGhpcy5tPXsuLi50aGlzLm0sLi4udH0sdGhpcy5PKCksdGhpc31zZXRFeHRyYSh0LG4pe3JldHVybiB0aGlzLm09ey4uLnRoaXMubSxbdF06bn0sdGhpcy5PKCksdGhpc31zZXRGaW5nZXJwcmludCh0KXtyZXR1cm4gdGhpcy5UPXQsdGhpcy5PKCksdGhpc31zZXRMZXZlbCh0KXtyZXR1cm4gdGhpcy5OPXQsdGhpcy5PKCksdGhpc31zZXRUcmFuc2FjdGlvbk5hbWUodCl7cmV0dXJuIHRoaXMuaz10LHRoaXMuTygpLHRoaXN9c2V0Q29udGV4dCh0LG4pe3JldHVybiBudWxsPT09bj9kZWxldGUgdGhpcy52W3RdOnRoaXMudlt0XT1uLHRoaXMuTygpLHRoaXN9c2V0U2Vzc2lvbih0KXtyZXR1cm4gdD90aGlzLkM9dDpkZWxldGUgdGhpcy5DLHRoaXMuTygpLHRoaXN9Z2V0U2Vzc2lvbigpe3JldHVybiB0aGlzLkN9dXBkYXRlKHQpe2lmKCF0KXJldHVybiB0aGlzO2NvbnN0IG49ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dCh0aGlzKTp0LGU9biBpbnN0YW5jZW9mIFY/bi5nZXRTY29wZURhdGEoKTpUKG4pP3Q6dm9pZCAwLHt0YWdzOnIsZXh0cmE6byx1c2VyOnMsY29udGV4dHM6aSxsZXZlbDpjLGZpbmdlcnByaW50OnU9W10scHJvcGFnYXRpb25Db250ZXh0OmF9PWV8fHt9O3JldHVybiB0aGlzLmw9ey4uLnRoaXMubCwuLi5yfSx0aGlzLm09ey4uLnRoaXMubSwuLi5vfSx0aGlzLnY9ey4uLnRoaXMudiwuLi5pfSxzJiZPYmplY3Qua2V5cyhzKS5sZW5ndGgmJih0aGlzLnA9cyksYyYmKHRoaXMuTj1jKSx1Lmxlbmd0aCYmKHRoaXMuVD11KSxhJiYodGhpcy5TPWEpLHRoaXN9Y2xlYXIoKXtyZXR1cm4gdGhpcy51PVtdLHRoaXMubD17fSx0aGlzLm09e30sdGhpcy5wPXt9LHRoaXMudj17fSx0aGlzLk49dm9pZCAwLHRoaXMuaz12b2lkIDAsdGhpcy5UPXZvaWQgMCx0aGlzLkM9dm9pZCAwLEsodGhpcyx2b2lkIDApLHRoaXMuaD1bXSx0aGlzLnNldFByb3BhZ2F0aW9uQ29udGV4dCh7dHJhY2VJZDpGKCksc2FtcGxlUmFuZDpNYXRoLnJhbmRvbSgpfSksdGhpcy5PKCksdGhpc31hZGRCcmVhZGNydW1iKHQsbil7Y29uc3QgZT0ibnVtYmVyIj09dHlwZW9mIG4/bjoxMDA7aWYoZTw9MClyZXR1cm4gdGhpcztjb25zdCByPXt0aW1lc3RhbXA6TCgpLC4uLnQsbWVzc2FnZTp0Lm1lc3NhZ2U/QSh0Lm1lc3NhZ2UsMjA0OCk6dC5tZXNzYWdlfTtyZXR1cm4gdGhpcy51LnB1c2gociksdGhpcy51Lmxlbmd0aD5lJiYodGhpcy51PXRoaXMudS5zbGljZSgtZSksdGhpcy5qPy5yZWNvcmREcm9wcGVkRXZlbnQoImJ1ZmZlcl9vdmVyZmxvdyIsImxvZ19pdGVtIikpLHRoaXMuTygpLHRoaXN9Z2V0TGFzdEJyZWFkY3J1bWIoKXtyZXR1cm4gdGhpcy51W3RoaXMudS5sZW5ndGgtMV19Y2xlYXJCcmVhZGNydW1icygpe3JldHVybiB0aGlzLnU9W10sdGhpcy5PKCksdGhpc31hZGRBdHRhY2htZW50KHQpe3JldHVybiB0aGlzLmgucHVzaCh0KSx0aGlzfWNsZWFyQXR0YWNobWVudHMoKXtyZXR1cm4gdGhpcy5oPVtdLHRoaXN9Z2V0U2NvcGVEYXRhKCl7cmV0dXJue2JyZWFkY3J1bWJzOnRoaXMudSxhdHRhY2htZW50czp0aGlzLmgsY29udGV4dHM6dGhpcy52LHRhZ3M6dGhpcy5sLGV4dHJhOnRoaXMubSx1c2VyOnRoaXMucCxsZXZlbDp0aGlzLk4sZmluZ2VycHJpbnQ6dGhpcy5UfHxbXSxldmVudFByb2Nlc3NvcnM6dGhpcy5pLHByb3BhZ2F0aW9uQ29udGV4dDp0aGlzLlMsc2RrUHJvY2Vzc2luZ01ldGFkYXRhOnRoaXMuXyx0cmFuc2FjdGlvbk5hbWU6dGhpcy5rLHNwYW46Wih0aGlzKX19c2V0U0RLUHJvY2Vzc2luZ01ldGFkYXRhKHQpe3JldHVybiB0aGlzLl89eih0aGlzLl8sdCwyKSx0aGlzfXNldFByb3BhZ2F0aW9uQ29udGV4dCh0KXtyZXR1cm4gdGhpcy5TPXQsdGhpc31nZXRQcm9wYWdhdGlvbkNvbnRleHQoKXtyZXR1cm4gdGhpcy5TfWNhcHR1cmVFeGNlcHRpb24odCxuKXtjb25zdCBlPW4/LmV2ZW50X2lkfHxNKCk7aWYoIXRoaXMuailyZXR1cm4gaCYmUy53YXJuKCJObyBjbGllbnQgY29uZmlndXJlZCBvbiBzY29wZSAtIHdpbGwgbm90IGNhcHR1cmUgZXhjZXB0aW9uISIpLGU7Y29uc3Qgcj1uZXcgRXJyb3IoIlNlbnRyeSBzeW50aGV0aWNFeGNlcHRpb24iKTtyZXR1cm4gdGhpcy5qLmNhcHR1cmVFeGNlcHRpb24odCx7b3JpZ2luYWxFeGNlcHRpb246dCxzeW50aGV0aWNFeGNlcHRpb246ciwuLi5uLGV2ZW50X2lkOmV9LHRoaXMpLGV9Y2FwdHVyZU1lc3NhZ2UodCxuLGUpe2NvbnN0IHI9ZT8uZXZlbnRfaWR8fE0oKTtpZighdGhpcy5qKXJldHVybiBoJiZTLndhcm4oIk5vIGNsaWVudCBjb25maWd1cmVkIG9uIHNjb3BlIC0gd2lsbCBub3QgY2FwdHVyZSBtZXNzYWdlISIpLHI7Y29uc3Qgbz1uZXcgRXJyb3IodCk7cmV0dXJuIHRoaXMuai5jYXB0dXJlTWVzc2FnZSh0LG4se29yaWdpbmFsRXhjZXB0aW9uOnQsc3ludGhldGljRXhjZXB0aW9uOm8sLi4uZSxldmVudF9pZDpyfSx0aGlzKSxyfWNhcHR1cmVFdmVudCh0LG4pe2NvbnN0IGU9bj8uZXZlbnRfaWR8fE0oKTtyZXR1cm4gdGhpcy5qPyh0aGlzLmouY2FwdHVyZUV2ZW50KHQsey4uLm4sZXZlbnRfaWQ6ZX0sdGhpcyksZSk6KGgmJlMud2FybigiTm8gY2xpZW50IGNvbmZpZ3VyZWQgb24gc2NvcGUgLSB3aWxsIG5vdCBjYXB0dXJlIGV2ZW50ISIpLGUpfU8oKXt0aGlzLnR8fCh0aGlzLnQ9ITAsdGhpcy5vLmZvckVhY2godD0+e3QodGhpcyl9KSx0aGlzLnQ9ITEpfX1jbGFzcyBxe2NvbnN0cnVjdG9yKHQsbil7bGV0IGUscjtlPXR8fG5ldyBWLHI9bnx8bmV3IFYsdGhpcy5SPVt7c2NvcGU6ZX1dLHRoaXMuQT1yfXdpdGhTY29wZSh0KXtjb25zdCBuPXRoaXMuRCgpO2xldCBlO3RyeXtlPXQobil9Y2F0Y2godCl7dGhyb3cgdGhpcy5QKCksdH1yZXR1cm4gaihlKT9lLnRoZW4odD0+KHRoaXMuUCgpLHQpLHQ9Pnt0aHJvdyB0aGlzLlAoKSx0fSk6KHRoaXMuUCgpLGUpfWdldENsaWVudCgpe3JldHVybiB0aGlzLmdldFN0YWNrVG9wKCkuY2xpZW50fWdldFNjb3BlKCl7cmV0dXJuIHRoaXMuZ2V0U3RhY2tUb3AoKS5zY29wZX1nZXRJc29sYXRpb25TY29wZSgpe3JldHVybiB0aGlzLkF9Z2V0U3RhY2tUb3AoKXtyZXR1cm4gdGhpcy5SW3RoaXMuUi5sZW5ndGgtMV19RCgpe2NvbnN0IHQ9dGhpcy5nZXRTY29wZSgpLmNsb25lKCk7cmV0dXJuIHRoaXMuUi5wdXNoKHtjbGllbnQ6dGhpcy5nZXRDbGllbnQoKSxzY29wZTp0fSksdH1QKCl7cmV0dXJuISh0aGlzLlIubGVuZ3RoPD0xKSYmISF0aGlzLlIucG9wKCl9fWZ1bmN0aW9uIFEoKXtjb25zdCB0PW0oZCgpKTtyZXR1cm4gdC5zdGFjaz10LnN0YWNrfHxuZXcgcShnKCJkZWZhdWx0Q3VycmVudFNjb3BlIiwoKT0+bmV3IFYpLGcoImRlZmF1bHRJc29sYXRpb25TY29wZSIsKCk9Pm5ldyBWKSl9ZnVuY3Rpb24gWCh0KXtyZXR1cm4gUSgpLndpdGhTY29wZSh0KX1mdW5jdGlvbiB0dCh0LG4pe2NvbnN0IGU9USgpO3JldHVybiBlLndpdGhTY29wZSgoKT0+KGUuZ2V0U3RhY2tUb3AoKS5zY29wZT10LG4odCkpKX1mdW5jdGlvbiBudCh0KXtyZXR1cm4gUSgpLndpdGhTY29wZSgoKT0+dChRKCkuZ2V0SXNvbGF0aW9uU2NvcGUoKSkpfWZ1bmN0aW9uIGV0KHQpe2NvbnN0IG49bSh0KTtyZXR1cm4gbi5hY3M/bi5hY3M6e3dpdGhJc29sYXRpb25TY29wZTpudCx3aXRoU2NvcGU6WCx3aXRoU2V0U2NvcGU6dHQsd2l0aFNldElzb2xhdGlvblNjb3BlOih0LG4pPT5udChuKSxnZXRDdXJyZW50U2NvcGU6KCk9PlEoKS5nZXRTY29wZSgpLGdldElzb2xhdGlvblNjb3BlOigpPT5RKCkuZ2V0SXNvbGF0aW9uU2NvcGUoKX19ZnVuY3Rpb24gcnQoKXtyZXR1cm4gZXQoZCgpKS5nZXRDdXJyZW50U2NvcGUoKS5nZXRDbGllbnQoKX1mdW5jdGlvbiBvdCh0KXtyZXR1cm57c2NvcGU6dC5fc2VudHJ5U2NvcGUsaXNvbGF0aW9uU2NvcGU6dC5fc2VudHJ5SXNvbGF0aW9uU2NvcGV9fWNvbnN0IHN0PS9ec2VudHJ5LS87ZnVuY3Rpb24gaXQodCl7Y29uc3Qgbj1mdW5jdGlvbih0KXtpZighdHx8IWsodCkmJiFBcnJheS5pc0FycmF5KHQpKXJldHVybjtpZihBcnJheS5pc0FycmF5KHQpKXJldHVybiB0LnJlZHVjZSgodCxuKT0+e2NvbnN0IGU9Y3Qobik7cmV0dXJuIE9iamVjdC5lbnRyaWVzKGUpLmZvckVhY2goKFtuLGVdKT0+e3Rbbl09ZX0pLHR9LHt9KTtyZXR1cm4gY3QodCl9KHQpO2lmKCFuKXJldHVybjtjb25zdCBlPU9iamVjdC5lbnRyaWVzKG4pLnJlZHVjZSgodCxbbixlXSk9PntpZihuLm1hdGNoKHN0KSl7dFtuLnNsaWNlKDcpXT1lfXJldHVybiB0fSx7fSk7cmV0dXJuIE9iamVjdC5rZXlzKGUpLmxlbmd0aD4wP2U6dm9pZCAwfWZ1bmN0aW9uIGN0KHQpe3JldHVybiB0LnNwbGl0KCIsIikubWFwKHQ9PnQuc3BsaXQoIj0iKS5tYXAodD0+e3RyeXtyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHQudHJpbSgpKX1jYXRjaHtyZXR1cm59fSkpLnJlZHVjZSgodCxbbixlXSk9PihuJiZlJiYodFtuXT1lKSx0KSx7fSl9Y29uc3QgdXQ9L15vKFxkKylcLi87ZnVuY3Rpb24gYXQodCxuPSExKXtjb25zdHtob3N0OmUscGF0aDpyLHBhc3M6byxwb3J0OnMscHJvamVjdElkOmkscHJvdG9jb2w6YyxwdWJsaWNLZXk6dX09dDtyZXR1cm5gJHtjfTovLyR7dX0ke24mJm8/YDoke299YDoiIn1AJHtlfSR7cz9gOiR7c31gOiIifS8ke3I/YCR7cn0vYDpyfSR7aX1gfWZ1bmN0aW9uIGZ0KHQpe2NvbnN0IG49dC5nZXRPcHRpb25zKCkse2hvc3Q6ZX09dC5nZXREc24oKXx8e307bGV0IHI7cmV0dXJuIG4ub3JnSWQ/cj1TdHJpbmcobi5vcmdJZCk6ZSYmKHI9ZnVuY3Rpb24odCl7Y29uc3Qgbj10Lm1hdGNoKHV0KTtyZXR1cm4gbj8uWzFdfShlKSkscn1mdW5jdGlvbiBodCh0KXtjb25zdHtzcGFuSWQ6bix0cmFjZUlkOmUsaXNSZW1vdGU6cn09dC5zcGFuQ29udGV4dCgpLG89cj9uOm10KHQpLnBhcmVudF9zcGFuX2lkLHM9b3QodCkuc2NvcGU7cmV0dXJue3BhcmVudF9zcGFuX2lkOm8sc3Bhbl9pZDpyP3M/LmdldFByb3BhZ2F0aW9uQ29udGV4dCgpLnByb3BhZ2F0aW9uU3BhbklkfHxXKCk6bix0cmFjZV9pZDplfX1mdW5jdGlvbiBwdCh0KXtyZXR1cm4gdCYmdC5sZW5ndGg+MD90Lm1hcCgoe2NvbnRleHQ6e3NwYW5JZDp0LHRyYWNlSWQ6bix0cmFjZUZsYWdzOmUsLi4ucn0sYXR0cmlidXRlczpvfSk9Pih7c3Bhbl9pZDp0LHRyYWNlX2lkOm4sc2FtcGxlZDoxPT09ZSxhdHRyaWJ1dGVzOm8sLi4ucn0pKTp2b2lkIDB9ZnVuY3Rpb24gbHQodCl7cmV0dXJuIm51bWJlciI9PXR5cGVvZiB0P2R0KHQpOkFycmF5LmlzQXJyYXkodCk/dFswXSt0WzFdLzFlOTp0IGluc3RhbmNlb2YgRGF0ZT9kdCh0LmdldFRpbWUoKSk6RygpfWZ1bmN0aW9uIGR0KHQpe3JldHVybiB0Pjk5OTk5OTk5OTk/dC8xZTM6dH1mdW5jdGlvbiBtdCh0KXtpZihmdW5jdGlvbih0KXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdC5nZXRTcGFuSlNPTn0odCkpcmV0dXJuIHQuZ2V0U3BhbkpTT04oKTtjb25zdHtzcGFuSWQ6bix0cmFjZUlkOmV9PXQuc3BhbkNvbnRleHQoKTtpZihmdW5jdGlvbih0KXtjb25zdCBuPXQ7cmV0dXJuISEobi5hdHRyaWJ1dGVzJiZuLnN0YXJ0VGltZSYmbi5uYW1lJiZuLmVuZFRpbWUmJm4uc3RhdHVzKX0odCkpe2NvbnN0e2F0dHJpYnV0ZXM6cixzdGFydFRpbWU6byxuYW1lOnMsZW5kVGltZTppLHN0YXR1czpjLGxpbmtzOnV9PXQ7cmV0dXJue3NwYW5faWQ6bix0cmFjZV9pZDplLGRhdGE6cixkZXNjcmlwdGlvbjpzLHBhcmVudF9zcGFuX2lkOiJwYXJlbnRTcGFuSWQiaW4gdD90LnBhcmVudFNwYW5JZDoicGFyZW50U3BhbkNvbnRleHQiaW4gdD90LnBhcmVudFNwYW5Db250ZXh0Py5zcGFuSWQ6dm9pZCAwLHN0YXJ0X3RpbWVzdGFtcDpsdChvKSx0aW1lc3RhbXA6bHQoaSl8fHZvaWQgMCxzdGF0dXM6Z3QoYyksb3A6clsic2VudHJ5Lm9wIl0sb3JpZ2luOnJbInNlbnRyeS5vcmlnaW4iXSxsaW5rczpwdCh1KX19cmV0dXJue3NwYW5faWQ6bix0cmFjZV9pZDplLHN0YXJ0X3RpbWVzdGFtcDowLGRhdGE6e319fWZ1bmN0aW9uIGd0KHQpe2lmKHQmJjAhPT10LmNvZGUpcmV0dXJuIDE9PT10LmNvZGU/Im9rIjp0Lm1lc3NhZ2V8fCJ1bmtub3duX2Vycm9yIn1mdW5jdGlvbiB5dCh0KXtyZXR1cm4gdC5fc2VudHJ5Um9vdFNwYW58fHR9ZnVuY3Rpb24gYnQodCl7Y29uc3Qgbj1ydCgpO2lmKCFuKXJldHVybnt9O2NvbnN0IGU9eXQodCkscj1tdChlKSxvPXIuZGF0YSxzPWUuc3BhbkNvbnRleHQoKS50cmFjZVN0YXRlLGk9cz8uZ2V0KCJzZW50cnkuc2FtcGxlX3JhdGUiKT8/b1sic2VudHJ5LnNhbXBsZV9yYXRlIl0/P29bInNlbnRyeS5wcmV2aW91c190cmFjZV9zYW1wbGVfcmF0ZSJdO2Z1bmN0aW9uIGModCl7cmV0dXJuIm51bWJlciIhPXR5cGVvZiBpJiYic3RyaW5nIiE9dHlwZW9mIGl8fCh0LnNhbXBsZV9yYXRlPWAke2l9YCksdH1jb25zdCB1PWUuX2Zyb3plbkRzYztpZih1KXJldHVybiBjKHUpO2NvbnN0IGE9cz8uZ2V0KCJzZW50cnkuZHNjIiksZj1hJiZpdChhKTtpZihmKXJldHVybiBjKGYpO2NvbnN0IGg9ZnVuY3Rpb24odCxuKXtjb25zdCBlPW4uZ2V0T3B0aW9ucygpLHtwdWJsaWNLZXk6cn09bi5nZXREc24oKXx8e30sbz17ZW52aXJvbm1lbnQ6ZS5lbnZpcm9ubWVudHx8InByb2R1Y3Rpb24iLHJlbGVhc2U6ZS5yZWxlYXNlLHB1YmxpY19rZXk6cix0cmFjZV9pZDp0LG9yZ19pZDpmdChuKX07cmV0dXJuIG4uZW1pdCgiY3JlYXRlRHNjIixvKSxvfSh0LnNwYW5Db250ZXh0KCkudHJhY2VJZCxuKSxwPW9bInNlbnRyeS5zb3VyY2UiXSxsPXIuZGVzY3JpcHRpb247cmV0dXJuInVybCIhPT1wJiZsJiYoaC50cmFuc2FjdGlvbj1sKSxmdW5jdGlvbigpe2lmKCJib29sZWFuIj09dHlwZW9mIF9fU0VOVFJZX1RSQUNJTkdfXyYmIV9fU0VOVFJZX1RSQUNJTkdfXylyZXR1cm4hMTtjb25zdCB0PXJ0KCk/LmdldE9wdGlvbnMoKTtyZXR1cm4hKCF0fHxudWxsPT10LnRyYWNlc1NhbXBsZVJhdGUmJiF0LnRyYWNlc1NhbXBsZXIpfSgpJiYoaC5zYW1wbGVkPVN0cmluZyhmdW5jdGlvbih0KXtjb25zdHt0cmFjZUZsYWdzOm59PXQuc3BhbkNvbnRleHQoKTtyZXR1cm4gMT09PW59KGUpKSxoLnNhbXBsZV9yYW5kPXM/LmdldCgic2VudHJ5LnNhbXBsZV9yYW5kIik/P290KGUpLnNjb3BlPy5nZXRQcm9wYWdhdGlvbkNvbnRleHQoKS5zYW1wbGVSYW5kLnRvU3RyaW5nKCkpLGMoaCksbi5lbWl0KCJjcmVhdGVEc2MiLGgsZSksaH1mdW5jdGlvbiB2dCh0LG49MTAwLGU9MS8wKXt0cnl7cmV0dXJuIF90KCIiLHQsbixlKX1jYXRjaCh0KXtyZXR1cm57RVJST1I6YCoqbm9uLXNlcmlhbGl6YWJsZSoqICgke3R9KWB9fX1mdW5jdGlvbiBfdCh0LG4sZT0xLzAscj0xLzAsbz1mdW5jdGlvbigpe2NvbnN0IHQ9bmV3IFdlYWtTZXQ7ZnVuY3Rpb24gbihuKXtyZXR1cm4hIXQuaGFzKG4pfHwodC5hZGQobiksITEpfWZ1bmN0aW9uIGUobil7dC5kZWxldGUobil9cmV0dXJuW24sZV19KCkpe2NvbnN0W3MsaV09bztpZihudWxsPT1ufHxbImJvb2xlYW4iLCJzdHJpbmciXS5pbmNsdWRlcyh0eXBlb2Ygbil8fCJudW1iZXIiPT10eXBlb2YgbiYmTnVtYmVyLmlzRmluaXRlKG4pKXJldHVybiBuO2NvbnN0IGM9ZnVuY3Rpb24odCxuKXt0cnl7aWYoImRvbWFpbiI9PT10JiZuJiYib2JqZWN0Ij09dHlwZW9mIG4mJm4uVSlyZXR1cm4iW0RvbWFpbl0iO2lmKCJkb21haW5FbWl0dGVyIj09PXQpcmV0dXJuIltEb21haW5FbWl0dGVyXSI7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWwmJm49PT1nbG9iYWwpcmV0dXJuIltHbG9iYWxdIjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmbj09PXdpbmRvdylyZXR1cm4iW1dpbmRvd10iO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQmJm49PT1kb2N1bWVudClyZXR1cm4iW0RvY3VtZW50XSI7aWYoIm9iamVjdCI9PXR5cGVvZihlPW4pJiZudWxsIT09ZSYmKGUuX19pc1Z1ZXx8ZS5NKSlyZXR1cm4iW1Z1ZVZpZXdNb2RlbF0iO2lmKGZ1bmN0aW9uKHQpe3JldHVybiBUKHQpJiYibmF0aXZlRXZlbnQiaW4gdCYmInByZXZlbnREZWZhdWx0ImluIHQmJiJzdG9wUHJvcGFnYXRpb24iaW4gdH0obikpcmV0dXJuIltTeW50aGV0aWNFdmVudF0iO2lmKCJudW1iZXIiPT10eXBlb2YgbiYmIU51bWJlci5pc0Zpbml0ZShuKSlyZXR1cm5gWyR7bn1dYDtpZigiZnVuY3Rpb24iPT10eXBlb2YgbilyZXR1cm5gW0Z1bmN0aW9uOiAke2Z1bmN0aW9uKHQpe3RyeXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQubmFtZXx8eH1jYXRjaHtyZXR1cm4geH19KG4pfV1gO2lmKCJzeW1ib2wiPT10eXBlb2YgbilyZXR1cm5gWyR7U3RyaW5nKG4pfV1gO2lmKCJiaWdpbnQiPT10eXBlb2YgbilyZXR1cm5gW0JpZ0ludDogJHtTdHJpbmcobil9XWA7Y29uc3Qgcj1mdW5jdGlvbih0KXtjb25zdCBuPU9iamVjdC5nZXRQcm90b3R5cGVPZih0KTtyZXR1cm4gbj8uY29uc3RydWN0b3I/bi5jb25zdHJ1Y3Rvci5uYW1lOiJudWxsIHByb3RvdHlwZSJ9KG4pO3JldHVybi9eSFRNTChcdyopRWxlbWVudCQvLnRlc3Qocik/YFtIVE1MRWxlbWVudDogJHtyfV1gOmBbb2JqZWN0ICR7cn1dYH1jYXRjaCh0KXtyZXR1cm5gKipub24tc2VyaWFsaXphYmxlKiogKCR7dH0pYH12YXIgZX0odCxuKTtpZighYy5zdGFydHNXaXRoKCJbb2JqZWN0ICIpKXJldHVybiBjO2lmKG4uX19zZW50cnlfc2tpcF9ub3JtYWxpemF0aW9uX18pcmV0dXJuIG47Y29uc3QgdT0ibnVtYmVyIj09dHlwZW9mIG4uX19zZW50cnlfb3ZlcnJpZGVfbm9ybWFsaXphdGlvbl9kZXB0aF9fP24uX19zZW50cnlfb3ZlcnJpZGVfbm9ybWFsaXphdGlvbl9kZXB0aF9fOmU7aWYoMD09PXUpcmV0dXJuIGMucmVwbGFjZSgib2JqZWN0ICIsIiIpO2lmKHMobikpcmV0dXJuIltDaXJjdWxhciB+XSI7Y29uc3QgYT1uO2lmKGEmJiJmdW5jdGlvbiI9PXR5cGVvZiBhLnRvSlNPTil0cnl7cmV0dXJuIF90KCIiLGEudG9KU09OKCksdS0xLHIsbyl9Y2F0Y2h7fWNvbnN0IGY9QXJyYXkuaXNBcnJheShuKT9bXTp7fTtsZXQgaD0wO2NvbnN0IHA9RChuKTtmb3IoY29uc3QgdCBpbiBwKXtpZighT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHAsdCkpY29udGludWU7aWYoaD49cil7Zlt0XT0iW01heFByb3BlcnRpZXMgfl0iO2JyZWFrfWNvbnN0IG49cFt0XTtmW3RdPV90KHQsbix1LTEscixvKSxoKyt9cmV0dXJuIGkobiksZn1mdW5jdGlvbiB3dCh0LG4pe2NvbnN0IGU9bi5yZXBsYWNlKC9cXC9nLCIvIikucmVwbGFjZSgvW3xcXHt9KClbXF1eJCsqPy5dL2csIlxcJCYiKTtsZXQgcj10O3RyeXtyPWRlY29kZVVSSSh0KX1jYXRjaHt9cmV0dXJuIHIucmVwbGFjZSgvXFwvZywiLyIpLnJlcGxhY2UoL3dlYnBhY2s6XC8/L2csIiIpLnJlcGxhY2UobmV3IFJlZ0V4cChgKGZpbGU6Ly8pPy8qJHtlfS8qYCwiaWciKSwiYXBwOi8vLyIpfWZ1bmN0aW9uIFN0KHQsbj1bXSl7cmV0dXJuW3Qsbl19ZnVuY3Rpb24gJHQodCxuKXtjb25zdCBlPXRbMV07Zm9yKGNvbnN0IHQgb2YgZSl7aWYobih0LHRbMF0udHlwZSkpcmV0dXJuITB9cmV0dXJuITF9ZnVuY3Rpb24gRXQodCl7Y29uc3Qgbj1tKHApO3JldHVybiBuLmVuY29kZVBvbHlmaWxsP24uZW5jb2RlUG9seWZpbGwodCk6KG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHQpfWZ1bmN0aW9uIHh0KHQpe2NvbnN0W24sZV09dDtsZXQgcj1KU09OLnN0cmluZ2lmeShuKTtmdW5jdGlvbiBvKHQpeyJzdHJpbmciPT10eXBlb2Ygcj9yPSJzdHJpbmciPT10eXBlb2YgdD9yK3Q6W0V0KHIpLHRdOnIucHVzaCgic3RyaW5nIj09dHlwZW9mIHQ/RXQodCk6dCl9Zm9yKGNvbnN0IHQgb2YgZSl7Y29uc3RbbixlXT10O2lmKG8oYFxuJHtKU09OLnN0cmluZ2lmeShuKX1cbmApLCJzdHJpbmciPT10eXBlb2YgZXx8ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpbyhlKTtlbHNle2xldCB0O3RyeXt0PUpTT04uc3RyaW5naWZ5KGUpfWNhdGNoe3Q9SlNPTi5zdHJpbmdpZnkodnQoZSkpfW8odCl9fXJldHVybiJzdHJpbmciPT10eXBlb2Ygcj9yOmZ1bmN0aW9uKHQpe2NvbnN0IG49dC5yZWR1Y2UoKHQsbik9PnQrbi5sZW5ndGgsMCksZT1uZXcgVWludDhBcnJheShuKTtsZXQgcj0wO2Zvcihjb25zdCBuIG9mIHQpZS5zZXQobixyKSxyKz1uLmxlbmd0aDtyZXR1cm4gZX0ocil9Y29uc3QgTnQ9e3Nlc3Npb246InNlc3Npb24iLHNlc3Npb25zOiJzZXNzaW9uIixhdHRhY2htZW50OiJhdHRhY2htZW50Iix0cmFuc2FjdGlvbjoidHJhbnNhY3Rpb24iLGV2ZW50OiJlcnJvciIsY2xpZW50X3JlcG9ydDoiaW50ZXJuYWwiLHVzZXJfcmVwb3J0OiJkZWZhdWx0Iixwcm9maWxlOiJwcm9maWxlIixwcm9maWxlX2NodW5rOiJwcm9maWxlIixyZXBsYXlfZXZlbnQ6InJlcGxheSIscmVwbGF5X3JlY29yZGluZzoicmVwbGF5IixjaGVja19pbjoibW9uaXRvciIsZmVlZGJhY2s6ImZlZWRiYWNrIixzcGFuOiJzcGFuIixyYXdfc2VjdXJpdHk6InNlY3VyaXR5Iixsb2c6ImxvZ19pdGVtIn07ZnVuY3Rpb24gQ3QodCl7aWYoIXQ/LnNkaylyZXR1cm47Y29uc3R7bmFtZTpuLHZlcnNpb246ZX09dC5zZGs7cmV0dXJue25hbWU6bix2ZXJzaW9uOmV9fWZ1bmN0aW9uIGt0KHQsbixlLHIpe2NvbnN0IG89Q3QoZSkscz10LnR5cGUmJiJyZXBsYXlfZXZlbnQiIT09dC50eXBlP3QudHlwZToiZXZlbnQiOyFmdW5jdGlvbih0LG4pe2lmKCFuKXJldHVybiB0O2NvbnN0IGU9dC5zZGt8fHt9O3Quc2RrPXsuLi5lLG5hbWU6ZS5uYW1lfHxuLm5hbWUsdmVyc2lvbjplLnZlcnNpb258fG4udmVyc2lvbixpbnRlZ3JhdGlvbnM6Wy4uLnQuc2RrPy5pbnRlZ3JhdGlvbnN8fFtdLC4uLm4uaW50ZWdyYXRpb25zfHxbXV0scGFja2FnZXM6Wy4uLnQuc2RrPy5wYWNrYWdlc3x8W10sLi4ubi5wYWNrYWdlc3x8W11dLHNldHRpbmdzOnQuc2RrPy5zZXR0aW5nc3x8bi5zZXR0aW5ncz97Li4udC5zZGs/LnNldHRpbmdzLC4uLm4uc2V0dGluZ3N9OnZvaWQgMH19KHQsZT8uc2RrKTtjb25zdCBpPWZ1bmN0aW9uKHQsbixlLHIpe2NvbnN0IG89dC5zZGtQcm9jZXNzaW5nTWV0YWRhdGE/LmR5bmFtaWNTYW1wbGluZ0NvbnRleHQ7cmV0dXJue2V2ZW50X2lkOnQuZXZlbnRfaWQsc2VudF9hdDoobmV3IERhdGUpLnRvSVNPU3RyaW5nKCksLi4ubiYme3NkazpufSwuLi4hIWUmJnImJntkc246YXQocil9LC4uLm8mJnt0cmFjZTpvfX19KHQsbyxyLG4pO2RlbGV0ZSB0LnNka1Byb2Nlc3NpbmdNZXRhZGF0YTtyZXR1cm4gU3QoaSxbW3t0eXBlOnN9LHRdXSl9Y29uc3QgVHQ9Il9fU0VOVFJZX1NVUFBSRVNTX1RSQUNJTkdfXyI7ZnVuY3Rpb24ganQodCl7Y29uc3Qgbj1ldChkKCkpO3JldHVybiBuLnN1cHByZXNzVHJhY2luZz9uLnN1cHByZXNzVHJhY2luZyh0KTpmdW5jdGlvbiguLi50KXtjb25zdCBuPWV0KGQoKSk7aWYoMj09PXQubGVuZ3RoKXtjb25zdFtlLHJdPXQ7cmV0dXJuIGU/bi53aXRoU2V0U2NvcGUoZSxyKTpuLndpdGhTY29wZShyKX1yZXR1cm4gbi53aXRoU2NvcGUodFswXSl9KG49PntuLnNldFNES1Byb2Nlc3NpbmdNZXRhZGF0YSh7W1R0XTohMH0pO2NvbnN0IGU9dCgpO3JldHVybiBuLnNldFNES1Byb2Nlc3NpbmdNZXRhZGF0YSh7W1R0XTp2b2lkIDB9KSxlfSl9ZnVuY3Rpb24gSXQodCl7cmV0dXJuIG5ldyBPdChuPT57bih0KX0pfWNsYXNzIE90e2NvbnN0cnVjdG9yKHQpe3RoaXMuTD0wLHRoaXMuQj1bXSx0aGlzLkcodCl9dGhlbih0LG4pe3JldHVybiBuZXcgT3QoKGUscik9Pnt0aGlzLkIucHVzaChbITEsbj0+e2lmKHQpdHJ5e2UodChuKSl9Y2F0Y2godCl7cih0KX1lbHNlIGUobil9LHQ9PntpZihuKXRyeXtlKG4odCkpfWNhdGNoKHQpe3IodCl9ZWxzZSByKHQpfV0pLHRoaXMuSCgpfSl9Y2F0Y2godCl7cmV0dXJuIHRoaXMudGhlbih0PT50LHQpfWZpbmFsbHkodCl7cmV0dXJuIG5ldyBPdCgobixlKT0+e2xldCByLG87cmV0dXJuIHRoaXMudGhlbihuPT57bz0hMSxyPW4sdCYmdCgpfSxuPT57bz0hMCxyPW4sdCYmdCgpfSkudGhlbigoKT0+e28/ZShyKTpuKHIpfSl9KX1IKCl7aWYoMD09PXRoaXMuTClyZXR1cm47Y29uc3QgdD10aGlzLkIuc2xpY2UoKTt0aGlzLkI9W10sdC5mb3JFYWNoKHQ9Pnt0WzBdfHwoMT09PXRoaXMuTCYmdFsxXSh0aGlzLkopLDI9PT10aGlzLkwmJnRbMl0odGhpcy5KKSx0WzBdPSEwKX0pfUcodCl7Y29uc3Qgbj0odCxuKT0+ezA9PT10aGlzLkwmJihqKG4pP24udGhlbihlLHIpOih0aGlzLkw9dCx0aGlzLko9bix0aGlzLkgoKSkpfSxlPXQ9PntuKDEsdCl9LHI9dD0+e24oMix0KX07dHJ5e3QoZSxyKX1jYXRjaCh0KXtyKHQpfX19ZnVuY3Rpb24gUnQodCxuKXtjb25zdHtmaW5nZXJwcmludDplLHNwYW46cixicmVhZGNydW1iczpvLHNka1Byb2Nlc3NpbmdNZXRhZGF0YTpzfT1uOyFmdW5jdGlvbih0LG4pe2NvbnN0e2V4dHJhOmUsdGFnczpyLHVzZXI6byxjb250ZXh0czpzLGxldmVsOmksdHJhbnNhY3Rpb25OYW1lOmN9PW47T2JqZWN0LmtleXMoZSkubGVuZ3RoJiYodC5leHRyYT17Li4uZSwuLi50LmV4dHJhfSk7T2JqZWN0LmtleXMocikubGVuZ3RoJiYodC50YWdzPXsuLi5yLC4uLnQudGFnc30pO09iamVjdC5rZXlzKG8pLmxlbmd0aCYmKHQudXNlcj17Li4ubywuLi50LnVzZXJ9KTtPYmplY3Qua2V5cyhzKS5sZW5ndGgmJih0LmNvbnRleHRzPXsuLi5zLC4uLnQuY29udGV4dHN9KTtpJiYodC5sZXZlbD1pKTtjJiYidHJhbnNhY3Rpb24iIT09dC50eXBlJiYodC50cmFuc2FjdGlvbj1jKX0odCxuKSxyJiZmdW5jdGlvbih0LG4pe3QuY29udGV4dHM9e3RyYWNlOmh0KG4pLC4uLnQuY29udGV4dHN9LHQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhPXtkeW5hbWljU2FtcGxpbmdDb250ZXh0OmJ0KG4pLC4uLnQuc2RrUHJvY2Vzc2luZ01ldGFkYXRhfTtjb25zdCBlPXl0KG4pLHI9bXQoZSkuZGVzY3JpcHRpb247ciYmIXQudHJhbnNhY3Rpb24mJiJ0cmFuc2FjdGlvbiI9PT10LnR5cGUmJih0LnRyYW5zYWN0aW9uPXIpfSh0LHIpLGZ1bmN0aW9uKHQsbil7dC5maW5nZXJwcmludD10LmZpbmdlcnByaW50P0FycmF5LmlzQXJyYXkodC5maW5nZXJwcmludCk/dC5maW5nZXJwcmludDpbdC5maW5nZXJwcmludF06W10sbiYmKHQuZmluZ2VycHJpbnQ9dC5maW5nZXJwcmludC5jb25jYXQobikpO3QuZmluZ2VycHJpbnQubGVuZ3RofHxkZWxldGUgdC5maW5nZXJwcmludH0odCxlKSxmdW5jdGlvbih0LG4pe2NvbnN0IGU9Wy4uLnQuYnJlYWRjcnVtYnN8fFtdLC4uLm5dO3QuYnJlYWRjcnVtYnM9ZS5sZW5ndGg/ZTp2b2lkIDB9KHQsbyksZnVuY3Rpb24odCxuKXt0LnNka1Byb2Nlc3NpbmdNZXRhZGF0YT17Li4udC5zZGtQcm9jZXNzaW5nTWV0YWRhdGEsLi4ubn19KHQscyl9Y29uc3QgQXQ9U3ltYm9sLmZvcigiU2VudHJ5QnVmZmVyRnVsbEVycm9yIik7ZnVuY3Rpb24gRHQodCl7Y29uc3Qgbj1bXTtmdW5jdGlvbiBlKHQpe3JldHVybiBuLnNwbGljZShuLmluZGV4T2YodCksMSlbMF18fFByb21pc2UucmVzb2x2ZSh2b2lkIDApfXJldHVybnskOm4sYWRkOmZ1bmN0aW9uKHIpe2lmKCEodm9pZCAwPT09dHx8bi5sZW5ndGg8dCkpcmV0dXJuIG89QXQsbmV3IE90KCh0LG4pPT57bihvKX0pO3ZhciBvO2NvbnN0IHM9cigpO3JldHVybi0xPT09bi5pbmRleE9mKHMpJiZuLnB1c2gocykscy50aGVuKCgpPT5lKHMpKS50aGVuKG51bGwsKCk9PmUocykudGhlbihudWxsLCgpPT57fSkpLHN9LGRyYWluOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgT3QoKGUscik9PntsZXQgbz1uLmxlbmd0aDtpZighbylyZXR1cm4gZSghMCk7Y29uc3Qgcz1zZXRUaW1lb3V0KCgpPT57dCYmdD4wJiZlKCExKX0sdCk7bi5mb3JFYWNoKHQ9PntJdCh0KS50aGVuKCgpPT57LS1vfHwoY2xlYXJUaW1lb3V0KHMpLGUoITApKX0scil9KX0pfX19ZnVuY3Rpb24gUHQodCx7c3RhdHVzQ29kZTpuLGhlYWRlcnM6ZX0scj1EYXRlLm5vdygpKXtjb25zdCBvPXsuLi50fSxzPWU/LlsieC1zZW50cnktcmF0ZS1saW1pdHMiXSxpPWU/LlsicmV0cnktYWZ0ZXIiXTtpZihzKWZvcihjb25zdCB0IG9mIHMudHJpbSgpLnNwbGl0KCIsIikpe2NvbnN0W24sZSwsLHNdPXQuc3BsaXQoIjoiLDUpLGk9cGFyc2VJbnQobiwxMCksYz0xZTMqKGlzTmFOKGkpPzYwOmkpO2lmKGUpZm9yKGNvbnN0IHQgb2YgZS5zcGxpdCgiOyIpKSJtZXRyaWNfYnVja2V0Ij09PXQmJnMmJiFzLnNwbGl0KCI7IikuaW5jbHVkZXMoImN1c3RvbSIpfHwob1t0XT1yK2MpO2Vsc2Ugby5hbGw9citjfWVsc2UgaT9vLmFsbD1yK2Z1bmN0aW9uKHQsbj1EYXRlLm5vdygpKXtjb25zdCBlPXBhcnNlSW50KGAke3R9YCwxMCk7aWYoIWlzTmFOKGUpKXJldHVybiAxZTMqZTtjb25zdCByPURhdGUucGFyc2UoYCR7dH1gKTtyZXR1cm4gaXNOYU4ocik/NmU0OnItbn0oaSxyKTo0Mjk9PT1uJiYoby5hbGw9cis2ZTQpO3JldHVybiBvfWZ1bmN0aW9uIFV0KHQsbixlPUR0KHQuYnVmZmVyU2l6ZXx8NjQpKXtsZXQgcj17fTtyZXR1cm57c2VuZDpmdW5jdGlvbih0KXtjb25zdCBvPVtdO2lmKCR0KHQsKHQsbik9Pntjb25zdCBlPWZ1bmN0aW9uKHQpe3JldHVybiBOdFt0XX0obik7KGZ1bmN0aW9uKHQsbixlPURhdGUubm93KCkpe3JldHVybiBmdW5jdGlvbih0LG4pe3JldHVybiB0W25dfHx0LmFsbHx8MH0odCxuKT5lfSkocixlKXx8by5wdXNoKHQpfSksMD09PW8ubGVuZ3RoKXJldHVybiBJdCh7fSk7Y29uc3Qgcz1TdCh0WzBdLG8pLGk9dD0+eyR0KHMsKHQsbik9Pnt9KX07cmV0dXJuIGUuYWRkKCgpPT5uKHtib2R5Onh0KHMpfSkudGhlbih0PT4odm9pZCAwIT09dC5zdGF0dXNDb2RlJiYodC5zdGF0dXNDb2RlPDIwMHx8dC5zdGF0dXNDb2RlPj0zMDApJiZoJiZTLndhcm4oYFNlbnRyeSByZXNwb25kZWQgd2l0aCBzdGF0dXMgY29kZSAke3Quc3RhdHVzQ29kZX0gdG8gc2VudCBldmVudC5gKSxyPVB0KHIsdCksdCksdD0+e3Rocm93IGkoKSxoJiZTLmVycm9yKCJFbmNvdW50ZXJlZCBlcnJvciBydW5uaW5nIHRyYW5zcG9ydCByZXF1ZXN0OiIsdCksdH0pKS50aGVuKHQ9PnQsdD0+e2lmKHQ9PT1BdClyZXR1cm4gaCYmUy5lcnJvcigiU2tpcHBlZCBzZW5kaW5nIGV2ZW50IGJlY2F1c2UgYnVmZmVyIGlzIGZ1bGwuIiksaSgpLEl0KHt9KTt0aHJvdyB0fSl9LGZsdXNoOnQ9PmUuZHJhaW4odCl9fWNvbnN0IE10PS9eKFxTKzpcXHxcLz8pKFtcc1xTXSo/KSgoPzpcLnsxLDJ9fFteL1xcXSs/fCkoXC5bXi4vXFxdKnwpKSg/OlsvXFxdKikkLztmdW5jdGlvbiBMdCh0KXtjb25zdCBuPWZ1bmN0aW9uKHQpe2NvbnN0IG49dC5sZW5ndGg+MTAyND9gPHRydW5jYXRlZD4ke3Quc2xpY2UoLTEwMjQpfWA6dCxlPU10LmV4ZWMobik7cmV0dXJuIGU/ZS5zbGljZSgxKTpbXX0odCksZT1uWzBdfHwiIjtsZXQgcj1uWzFdO3JldHVybiBlfHxyPyhyJiYocj1yLnNsaWNlKDAsci5sZW5ndGgtMSkpLGUrcik6Ii4ifWZ1bmN0aW9uIEJ0KHQsbj0hMSl7cmV0dXJuIShufHx0JiYhdC5zdGFydHNXaXRoKCIvIikmJiF0Lm1hdGNoKC9eW0EtWl06LykmJiF0LnN0YXJ0c1dpdGgoIi4iKSYmIXQubWF0Y2goL15bYS16QS1aXShbYS16QS1aMC05LlwtK10pKjpcL1wvLykpJiZ2b2lkIDAhPT10JiYhdC5pbmNsdWRlcygibm9kZV9tb2R1bGVzLyIpfWNvbnN0IEd0PVN5bWJvbCgiQWdlbnRCYXNlSW50ZXJuYWxTdGF0ZSIpO2NsYXNzIEh0IGV4dGVuZHMgcy5BZ2VudHtjb25zdHJ1Y3Rvcih0KXtzdXBlcih0KSx0aGlzW0d0XT17fX1pc1NlY3VyZUVuZHBvaW50KHQpe2lmKHQpe2lmKCJib29sZWFuIj09dHlwZW9mIHQuc2VjdXJlRW5kcG9pbnQpcmV0dXJuIHQuc2VjdXJlRW5kcG9pbnQ7aWYoInN0cmluZyI9PXR5cGVvZiB0LnByb3RvY29sKXJldHVybiJodHRwczoiPT09dC5wcm90b2NvbH1jb25zdHtzdGFjazpufT1uZXcgRXJyb3I7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBuJiZuLnNwbGl0KCJcbiIpLnNvbWUodD0+LTEhPT10LmluZGV4T2YoIihodHRwcy5qczoiKXx8LTEhPT10LmluZGV4T2YoIm5vZGU6aHR0cHM6IikpfWNyZWF0ZVNvY2tldCh0LG4sZSl7Y29uc3Qgcj17Li4ubixzZWN1cmVFbmRwb2ludDp0aGlzLmlzU2VjdXJlRW5kcG9pbnQobil9O1Byb21pc2UucmVzb2x2ZSgpLnRoZW4oKCk9PnRoaXMuY29ubmVjdCh0LHIpKS50aGVuKG89PntpZihvIGluc3RhbmNlb2Ygcy5BZ2VudClyZXR1cm4gby5hZGRSZXF1ZXN0KHQscik7dGhpc1tHdF0uY3VycmVudFNvY2tldD1vLHN1cGVyLmNyZWF0ZVNvY2tldCh0LG4sZSl9LGUpfWNyZWF0ZUNvbm5lY3Rpb24oKXtjb25zdCB0PXRoaXNbR3RdLmN1cnJlbnRTb2NrZXQ7aWYodGhpc1tHdF0uY3VycmVudFNvY2tldD12b2lkIDAsIXQpdGhyb3cgbmV3IEVycm9yKCJObyBzb2NrZXQgd2FzIHJldHVybmVkIGluIHRoZSBgY29ubmVjdCgpYCBmdW5jdGlvbiIpO3JldHVybiB0fWdldCBkZWZhdWx0UG9ydCgpe3JldHVybiB0aGlzW0d0XS5kZWZhdWx0UG9ydD8/KCJodHRwczoiPT09dGhpcy5wcm90b2NvbD80NDM6ODApfXNldCBkZWZhdWx0UG9ydCh0KXt0aGlzW0d0XSYmKHRoaXNbR3RdLmRlZmF1bHRQb3J0PXQpfWdldCBwcm90b2NvbCgpe3JldHVybiB0aGlzW0d0XS5wcm90b2NvbD8/KHRoaXMuaXNTZWN1cmVFbmRwb2ludCgpPyJodHRwczoiOiJodHRwOiIpfXNldCBwcm90b2NvbCh0KXt0aGlzW0d0XSYmKHRoaXNbR3RdLnByb3RvY29sPXQpfX1mdW5jdGlvbiBKdCguLi50KXtTLmxvZygiW2h0dHBzLXByb3h5LWFnZW50OnBhcnNlLXByb3h5LXJlc3BvbnNlXSIsLi4udCl9ZnVuY3Rpb24genQodCl7cmV0dXJuIG5ldyBQcm9taXNlKChuLGUpPT57bGV0IHI9MDtjb25zdCBvPVtdO2Z1bmN0aW9uIHMoKXtjb25zdCBjPXQucmVhZCgpO2M/ZnVuY3Rpb24oYyl7by5wdXNoKGMpLHIrPWMubGVuZ3RoO2NvbnN0IHU9QnVmZmVyLmNvbmNhdChvLHIpLGE9dS5pbmRleE9mKCJcclxuXHJcbiIpO2lmKC0xPT09YSlyZXR1cm4gSnQoImhhdmUgbm90IHJlY2VpdmVkIGVuZCBvZiBIVFRQIGhlYWRlcnMgeWV0Li4uIiksdm9pZCBzKCk7Y29uc3QgZj11LnN1YmFycmF5KDAsYSkudG9TdHJpbmcoImFzY2lpIikuc3BsaXQoIlxyXG4iKSxoPWYuc2hpZnQoKTtpZighaClyZXR1cm4gdC5kZXN0cm95KCksZShuZXcgRXJyb3IoIk5vIGhlYWRlciByZWNlaXZlZCBmcm9tIHByb3h5IENPTk5FQ1QgcmVzcG9uc2UiKSk7Y29uc3QgcD1oLnNwbGl0KCIgIiksbD0rKHBbMV18fDApLGQ9cC5zbGljZSgyKS5qb2luKCIgIiksbT17fTtmb3IoY29uc3QgbiBvZiBmKXtpZighbiljb250aW51ZTtjb25zdCByPW4uaW5kZXhPZigiOiIpO2lmKC0xPT09cilyZXR1cm4gdC5kZXN0cm95KCksZShuZXcgRXJyb3IoYEludmFsaWQgaGVhZGVyIGZyb20gcHJveHkgQ09OTkVDVCByZXNwb25zZTogIiR7bn0iYCkpO2NvbnN0IG89bi5zbGljZSgwLHIpLnRvTG93ZXJDYXNlKCkscz1uLnNsaWNlKHIrMSkudHJpbVN0YXJ0KCksaT1tW29dOyJzdHJpbmciPT10eXBlb2YgaT9tW29dPVtpLHNdOkFycmF5LmlzQXJyYXkoaSk/aS5wdXNoKHMpOm1bb109c31KdCgiZ290IHByb3h5IHNlcnZlciByZXNwb25zZTogJW8gJW8iLGgsbSksaSgpLG4oe2Nvbm5lY3Q6e3N0YXR1c0NvZGU6bCxzdGF0dXNUZXh0OmQsaGVhZGVyczptfSxidWZmZXJlZDp1fSl9KGMpOnQub25jZSgicmVhZGFibGUiLHMpfWZ1bmN0aW9uIGkoKXt0LnJlbW92ZUxpc3RlbmVyKCJlbmQiLGMpLHQucmVtb3ZlTGlzdGVuZXIoImVycm9yIix1KSx0LnJlbW92ZUxpc3RlbmVyKCJyZWFkYWJsZSIscyl9ZnVuY3Rpb24gYygpe2koKSxKdCgib25lbmQiKSxlKG5ldyBFcnJvcigiUHJveHkgY29ubmVjdGlvbiBlbmRlZCBiZWZvcmUgcmVjZWl2aW5nIENPTk5FQ1QgcmVzcG9uc2UiKSl9ZnVuY3Rpb24gdSh0KXtpKCksSnQoIm9uZXJyb3IgJW8iLHQpLGUodCl9dC5vbigiZXJyb3IiLHUpLHQub24oImVuZCIsYykscygpfSl9ZnVuY3Rpb24gRnQoLi4udCl7Uy5sb2coIltodHRwcy1wcm94eS1hZ2VudF0iLC4uLnQpfWNsYXNzIFd0IGV4dGVuZHMgSHR7c3RhdGljIF9faW5pdFN0YXRpYygpe3RoaXMucHJvdG9jb2xzPVsiaHR0cCIsImh0dHBzIl19Y29uc3RydWN0b3IodCxuKXtzdXBlcihuKSx0aGlzLm9wdGlvbnM9e30sdGhpcy5wcm94eT0ic3RyaW5nIj09dHlwZW9mIHQ/bmV3IFVSTCh0KTp0LHRoaXMucHJveHlIZWFkZXJzPW4/LmhlYWRlcnM/P3t9LEZ0KCJDcmVhdGluZyBuZXcgSHR0cHNQcm94eUFnZW50IGluc3RhbmNlOiAlbyIsdGhpcy5wcm94eS5ocmVmKTtjb25zdCBlPSh0aGlzLnByb3h5Lmhvc3RuYW1lfHx0aGlzLnByb3h5Lmhvc3QpLnJlcGxhY2UoL15cW3xcXSQvZywiIikscj10aGlzLnByb3h5LnBvcnQ/cGFyc2VJbnQodGhpcy5wcm94eS5wb3J0LDEwKToiaHR0cHM6Ij09PXRoaXMucHJveHkucHJvdG9jb2w/NDQzOjgwO3RoaXMuY29ubmVjdE9wdHM9e0FMUE5Qcm90b2NvbHM6WyJodHRwLzEuMSJdLC4uLm4/S3QobiwiaGVhZGVycyIpOm51bGwsaG9zdDplLHBvcnQ6cn19YXN5bmMgY29ubmVjdCh0LG4pe2NvbnN0e3Byb3h5OmV9PXRoaXM7aWYoIW4uaG9zdCl0aHJvdyBuZXcgVHlwZUVycm9yKCdObyAiaG9zdCIgcHJvdmlkZWQnKTtsZXQgcjtpZigiaHR0cHM6Ij09PWUucHJvdG9jb2wpe0Z0KCJDcmVhdGluZyBgdGxzLlNvY2tldGA6ICVvIix0aGlzLmNvbm5lY3RPcHRzKTtjb25zdCB0PXRoaXMuY29ubmVjdE9wdHMuc2VydmVybmFtZXx8dGhpcy5jb25uZWN0T3B0cy5ob3N0O3I9Zi5jb25uZWN0KHsuLi50aGlzLmNvbm5lY3RPcHRzLHNlcnZlcm5hbWU6dCYmYS5pc0lQKHQpP3ZvaWQgMDp0fSl9ZWxzZSBGdCgiQ3JlYXRpbmcgYG5ldC5Tb2NrZXRgOiAlbyIsdGhpcy5jb25uZWN0T3B0cykscj1hLmNvbm5lY3QodGhpcy5jb25uZWN0T3B0cyk7Y29uc3Qgbz0iZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5wcm94eUhlYWRlcnM/dGhpcy5wcm94eUhlYWRlcnMoKTp7Li4udGhpcy5wcm94eUhlYWRlcnN9LHM9YS5pc0lQdjYobi5ob3N0KT9gWyR7bi5ob3N0fV1gOm4uaG9zdDtsZXQgaT1gQ09OTkVDVCAke3N9OiR7bi5wb3J0fSBIVFRQLzEuMVxyXG5gO2lmKGUudXNlcm5hbWV8fGUucGFzc3dvcmQpe2NvbnN0IHQ9YCR7ZGVjb2RlVVJJQ29tcG9uZW50KGUudXNlcm5hbWUpfToke2RlY29kZVVSSUNvbXBvbmVudChlLnBhc3N3b3JkKX1gO29bIlByb3h5LUF1dGhvcml6YXRpb24iXT1gQmFzaWMgJHtCdWZmZXIuZnJvbSh0KS50b1N0cmluZygiYmFzZTY0Iil9YH1vLkhvc3Q9YCR7c306JHtuLnBvcnR9YCxvWyJQcm94eS1Db25uZWN0aW9uIl18fChvWyJQcm94eS1Db25uZWN0aW9uIl09dGhpcy5rZWVwQWxpdmU/IktlZXAtQWxpdmUiOiJjbG9zZSIpO2Zvcihjb25zdCB0IG9mIE9iamVjdC5rZXlzKG8pKWkrPWAke3R9OiAke29bdF19XHJcbmA7Y29uc3QgYz16dChyKTtyLndyaXRlKGAke2l9XHJcbmApO2NvbnN0e2Nvbm5lY3Q6dSxidWZmZXJlZDpofT1hd2FpdCBjO2lmKHQuZW1pdCgicHJveHlDb25uZWN0Iix1KSx0aGlzLmVtaXQoInByb3h5Q29ubmVjdCIsdSx0KSwyMDA9PT11LnN0YXR1c0NvZGUpe2lmKHQub25jZSgic29ja2V0IixZdCksbi5zZWN1cmVFbmRwb2ludCl7RnQoIlVwZ3JhZGluZyBzb2NrZXQgY29ubmVjdGlvbiB0byBUTFMiKTtjb25zdCB0PW4uc2VydmVybmFtZXx8bi5ob3N0O3JldHVybiBmLmNvbm5lY3Qoey4uLkt0KG4sImhvc3QiLCJwYXRoIiwicG9ydCIpLHNvY2tldDpyLHNlcnZlcm5hbWU6YS5pc0lQKHQpP3ZvaWQgMDp0fSl9cmV0dXJuIHJ9ci5kZXN0cm95KCk7Y29uc3QgcD1uZXcgYS5Tb2NrZXQoe3dyaXRhYmxlOiExfSk7cmV0dXJuIHAucmVhZGFibGU9ITAsdC5vbmNlKCJzb2NrZXQiLHQ9PntGdCgiUmVwbGF5aW5nIHByb3h5IGJ1ZmZlciBmb3IgZmFpbGVkIHJlcXVlc3QiKSx0LnB1c2goaCksdC5wdXNoKG51bGwpfSkscH19ZnVuY3Rpb24gWXQodCl7dC5yZXN1bWUoKX1mdW5jdGlvbiBLdCh0LC4uLm4pe2NvbnN0IGU9e307bGV0IHI7Zm9yKHIgaW4gdCluLmluY2x1ZGVzKHIpfHwoZVtyXT10W3JdKTtyZXR1cm4gZX1XdC5fX2luaXRTdGF0aWMoKTtmdW5jdGlvbiBadCh0KXtyZXR1cm4gdC5yZXBsYWNlKC9eW0EtWl06LywiIikucmVwbGFjZSgvXFwvZywiLyIpfWNvbnN0IFZ0PW47bGV0IHF0LFF0PTAsWHQ9e307ZnVuY3Rpb24gdG4odCl7VnQuZGVidWcmJmNvbnNvbGUubG9nKGBbQU5SIFdvcmtlcl0gJHt0fWApfXZhciBubixlbixybjtjb25zdCBvbj1mdW5jdGlvbih0KXtsZXQgbjt0cnl7bj1uZXcgVVJMKHQudXJsKX1jYXRjaChuKXtyZXR1cm4gYigoKT0+e2NvbnNvbGUud2FybigiW0BzZW50cnkvbm9kZV06IEludmFsaWQgZHNuIG9yIHR1bm5lbCBvcHRpb24sIHdpbGwgbm90IHNlbmQgYW55IGV2ZW50cy4gVGhlIHR1bm5lbCBvcHRpb24gbXVzdCBiZSBhIGZ1bGwgVVJMIHdoZW4gdXNlZC4iKX0pLFV0KHQsKCk9PlByb21pc2UucmVzb2x2ZSh7fSkpfWNvbnN0IGU9Imh0dHBzOiI9PT1uLnByb3RvY29sLHI9ZnVuY3Rpb24odCxuKXtjb25zdHtub19wcm94eTplfT1wcm9jZXNzLmVudixyPWU/LnNwbGl0KCIsIikuc29tZShuPT50Lmhvc3QuZW5kc1dpdGgobil8fHQuaG9zdG5hbWUuZW5kc1dpdGgobikpO3JldHVybiByP3ZvaWQgMDpufShuLHQucHJveHl8fChlP3Byb2Nlc3MuZW52Lmh0dHBzX3Byb3h5OnZvaWQgMCl8fHByb2Nlc3MuZW52Lmh0dHBfcHJveHkpLG89ZT9pOnMsYT12b2lkIDAhPT10LmtlZXBBbGl2ZSYmdC5rZWVwQWxpdmUsZj1yP25ldyBXdChyKTpuZXcgby5BZ2VudCh7a2VlcEFsaXZlOmEsbWF4U29ja2V0czozMCx0aW1lb3V0OjJlM30pLGg9ZnVuY3Rpb24odCxuLGUpe2NvbnN0e2hvc3RuYW1lOnIscGF0aG5hbWU6byxwb3J0OnMscHJvdG9jb2w6aSxzZWFyY2g6YX09bmV3IFVSTCh0LnVybCk7cmV0dXJuIGZ1bmN0aW9uKGYpe3JldHVybiBuZXcgUHJvbWlzZSgoaCxwKT0+e2p0KCgpPT57bGV0IGw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBjKHtyZWFkKCl7dGhpcy5wdXNoKHQpLHRoaXMucHVzaChudWxsKX19KX0oZi5ib2R5KTtjb25zdCBkPXsuLi50LmhlYWRlcnN9O2YuYm9keS5sZW5ndGg+MzI3NjgmJihkWyJjb250ZW50LWVuY29kaW5nIl09Imd6aXAiLGw9bC5waXBlKHUoKSkpO2NvbnN0IG09bi5yZXF1ZXN0KHttZXRob2Q6IlBPU1QiLGFnZW50OmUsaGVhZGVyczpkLGhvc3RuYW1lOnIscGF0aDpgJHtvfSR7YX1gLHBvcnQ6cyxwcm90b2NvbDppLGNhOnQuY2FDZXJ0c30sdD0+e3Qub24oImRhdGEiLCgpPT57fSksdC5vbigiZW5kIiwoKT0+e30pLHQuc2V0RW5jb2RpbmcoInV0ZjgiKTtjb25zdCBuPXQuaGVhZGVyc1sicmV0cnktYWZ0ZXIiXT8/bnVsbCxlPXQuaGVhZGVyc1sieC1zZW50cnktcmF0ZS1saW1pdHMiXT8/bnVsbDtoKHtzdGF0dXNDb2RlOnQuc3RhdHVzQ29kZSxoZWFkZXJzOnsicmV0cnktYWZ0ZXIiOm4sIngtc2VudHJ5LXJhdGUtbGltaXRzIjpBcnJheS5pc0FycmF5KGUpP2VbMF18fG51bGw6ZX19KX0pO20ub24oImVycm9yIixwKSxsLnBpcGUobSl9KX0pfX0odCx0Lmh0dHBNb2R1bGU/P28sZik7cmV0dXJuIFV0KHQsaCl9KHt1cmw6KG5uPVZ0LmRzbixlbj1WdC50dW5uZWwscm49VnQuc2RrTWV0YWRhdGEuc2RrLGVufHxgJHtmdW5jdGlvbih0KXtyZXR1cm5gJHtmdW5jdGlvbih0KXtjb25zdCBuPXQucHJvdG9jb2w/YCR7dC5wcm90b2NvbH06YDoiIixlPXQucG9ydD9gOiR7dC5wb3J0fWA6IiI7cmV0dXJuYCR7bn0vLyR7dC5ob3N0fSR7ZX0ke3QucGF0aD9gLyR7dC5wYXRofWA6IiJ9L2FwaS9gfSh0KX0ke3QucHJvamVjdElkfS9lbnZlbG9wZS9gfShubil9PyR7ZnVuY3Rpb24odCxuKXtjb25zdCBlPXtzZW50cnlfdmVyc2lvbjoiNyJ9O3JldHVybiB0LnB1YmxpY0tleSYmKGUuc2VudHJ5X2tleT10LnB1YmxpY0tleSksbiYmKGUuc2VudHJ5X2NsaWVudD1gJHtuLm5hbWV9LyR7bi52ZXJzaW9ufWApLG5ldyBVUkxTZWFyY2hQYXJhbXMoZSkudG9TdHJpbmcoKX0obm4scm4pfWApfSk7YXN5bmMgZnVuY3Rpb24gc24oKXtpZihxdCl7dG4oIlNlbmRpbmcgYWJub3JtYWwgc2Vzc2lvbiIpLEoocXQse3N0YXR1czoiYWJub3JtYWwiLGFibm9ybWFsX21lY2hhbmlzbToiYW5yX2ZvcmVncm91bmQiLHJlbGVhc2U6VnQucmVsZWFzZSxlbnZpcm9ubWVudDpWdC5lbnZpcm9ubWVudH0pO2NvbnN0IHQ9ZnVuY3Rpb24odCxuLGUscil7Y29uc3Qgbz1DdChlKTtyZXR1cm4gU3Qoe3NlbnRfYXQ6KG5ldyBEYXRlKS50b0lTT1N0cmluZygpLC4uLm8mJntzZGs6b30sLi4uISFyJiZuJiZ7ZHNuOmF0KG4pfX0sWyJhZ2dyZWdhdGVzImluIHQ/W3t0eXBlOiJzZXNzaW9ucyJ9LHRdOlt7dHlwZToic2Vzc2lvbiJ9LHQudG9KU09OKCldXSl9KHF0LFZ0LmRzbixWdC5zZGtNZXRhZGF0YSxWdC50dW5uZWwpO3RuKEpTT04uc3RyaW5naWZ5KHQpKSxhd2FpdCBvbi5zZW5kKHQpO3RyeXtlPy5wb3N0TWVzc2FnZSgic2Vzc2lvbi1lbmRlZCIpfWNhdGNoe319fWZ1bmN0aW9uIGNuKHQpe2lmKCF0KXJldHVybjtjb25zdCBuPWZ1bmN0aW9uKHQpe2lmKCF0Lmxlbmd0aClyZXR1cm5bXTtjb25zdCBuPUFycmF5LmZyb20odCk7cmV0dXJuL3NlbnRyeVdyYXBwZWQvLnRlc3QoRShuKS5mdW5jdGlvbnx8IiIpJiZuLnBvcCgpLG4ucmV2ZXJzZSgpLCQudGVzdChFKG4pLmZ1bmN0aW9ufHwiIikmJihuLnBvcCgpLCQudGVzdChFKG4pLmZ1bmN0aW9ufHwiIikmJm4ucG9wKCkpLG4uc2xpY2UoMCw1MCkubWFwKHQ9Pih7Li4udCxmaWxlbmFtZTp0LmZpbGVuYW1lfHxFKG4pLmZpbGVuYW1lLGZ1bmN0aW9uOnQuZnVuY3Rpb258fCI/In0pKX0odCk7aWYoVnQuYXBwUm9vdFBhdGgpZm9yKGNvbnN0IHQgb2Ygbil0LmZpbGVuYW1lJiYodC5maWxlbmFtZT13dCh0LmZpbGVuYW1lLFZ0LmFwcFJvb3RQYXRoKSk7cmV0dXJuIG59YXN5bmMgZnVuY3Rpb24gdW4odCxuKXtpZihRdD49VnQubWF4QW5yRXZlbnRzKXJldHVybjtRdCs9MSxhd2FpdCBzbigpLHRuKCJTZW5kaW5nIGV2ZW50Iik7Y29uc3QgZT17ZXZlbnRfaWQ6TSgpLGNvbnRleHRzOlZ0LmNvbnRleHRzLHJlbGVhc2U6VnQucmVsZWFzZSxlbnZpcm9ubWVudDpWdC5lbnZpcm9ubWVudCxkaXN0OlZ0LmRpc3QscGxhdGZvcm06Im5vZGUiLGxldmVsOiJlcnJvciIsZXhjZXB0aW9uOnt2YWx1ZXM6W3t0eXBlOiJBcHBsaWNhdGlvbk5vdFJlc3BvbmRpbmciLHZhbHVlOmBBcHBsaWNhdGlvbiBOb3QgUmVzcG9uZGluZyBmb3IgYXQgbGVhc3QgJHtWdC5hbnJUaHJlc2hvbGR9IG1zYCxzdGFja3RyYWNlOntmcmFtZXM6Y24odCl9LG1lY2hhbmlzbTp7dHlwZToiQU5SIn19XX0sdGFnczpWdC5zdGF0aWNUYWdzfTtuJiZmdW5jdGlvbih0LG4pe2lmKFJ0KHQsbiksIXQuY29udGV4dHM/LnRyYWNlKXtjb25zdHt0cmFjZUlkOmUscGFyZW50U3BhbklkOnIscHJvcGFnYXRpb25TcGFuSWQ6b309bi5wcm9wYWdhdGlvbkNvbnRleHQ7dC5jb250ZXh0cz17dHJhY2U6e3RyYWNlX2lkOmUsc3Bhbl9pZDpvfHxXKCkscGFyZW50X3NwYW5faWQ6cn0sLi4udC5jb250ZXh0c319fShlLG4pLGZ1bmN0aW9uKHQpe2lmKDA9PT1PYmplY3Qua2V5cyhYdCkubGVuZ3RoKXJldHVybjtjb25zdCBuPVZ0LmFwcFJvb3RQYXRoP3t9Olh0O2lmKFZ0LmFwcFJvb3RQYXRoKWZvcihjb25zdFt0LGVdb2YgT2JqZWN0LmVudHJpZXMoWHQpKW5bd3QodCxWdC5hcHBSb290UGF0aCldPWU7Y29uc3QgZT1uZXcgTWFwO2Zvcihjb25zdCByIG9mIHQuZXhjZXB0aW9uPy52YWx1ZXN8fFtdKWZvcihjb25zdCB0IG9mIHIuc3RhY2t0cmFjZT8uZnJhbWVzfHxbXSl7Y29uc3Qgcj10LmFic19wYXRofHx0LmZpbGVuYW1lO3ImJm5bcl0mJmUuc2V0KHIsbltyXSl9aWYoZS5zaXplPjApe2NvbnN0IG49W107Zm9yKGNvbnN0W3Qscl1vZiBlLmVudHJpZXMoKSluLnB1c2goe3R5cGU6InNvdXJjZW1hcCIsY29kZV9maWxlOnQsZGVidWdfaWQ6cn0pO3QuZGVidWdfbWV0YT17aW1hZ2VzOm59fX0oZSk7Y29uc3Qgcj1rdChlLFZ0LmRzbixWdC5zZGtNZXRhZGF0YSxWdC50dW5uZWwpO3RuKEpTT04uc3RyaW5naWZ5KHIpKSxhd2FpdCBvbi5zZW5kKHIpLGF3YWl0IG9uLmZsdXNoKDJlMyksUXQ+PVZ0Lm1heEFuckV2ZW50cyYmc2V0VGltZW91dCgoKT0+e3Byb2Nlc3MuZXhpdCgwKX0sNWUzKX1sZXQgYW47aWYodG4oIlN0YXJ0ZWQiKSxWdC5jYXB0dXJlU3RhY2tUcmFjZSl7dG4oIkNvbm5lY3RpbmcgdG8gZGVidWdnZXIiKTtjb25zdCBuPW5ldyB0O24uY29ubmVjdFRvTWFpblRocmVhZCgpLHRuKCJDb25uZWN0ZWQgdG8gZGVidWdnZXIiKTtjb25zdCBlPW5ldyBNYXA7bi5vbigiRGVidWdnZXIuc2NyaXB0UGFyc2VkIix0PT57ZS5zZXQodC5wYXJhbXMuc2NyaXB0SWQsdC5wYXJhbXMudXJsKX0pLG4ub24oIkRlYnVnZ2VyLnBhdXNlZCIsdD0+e2lmKCJvdGhlciI9PT10LnBhcmFtcy5yZWFzb24pdHJ5e3RuKCJEZWJ1Z2dlciBwYXVzZWQiKTtjb25zdCBzPVsuLi50LnBhcmFtcy5jYWxsRnJhbWVzXSxpPVZ0LmFwcFJvb3RQYXRoP2Z1bmN0aW9uKHQ9KHByb2Nlc3MuYXJndlsxXT9MdChwcm9jZXNzLmFyZ3ZbMV0pOnByb2Nlc3MuY3dkKCkpLG49IlxcIj09PW8pe2NvbnN0IGU9bj9adCh0KTp0O3JldHVybiB0PT57aWYoIXQpcmV0dXJuO2NvbnN0IG89bj9adCh0KTp0O2xldHtkaXI6cyxiYXNlOmksZXh0OmN9PXIucGFyc2Uobyk7Ii5qcyIhPT1jJiYiLm1qcyIhPT1jJiYiLmNqcyIhPT1jfHwoaT1pLnNsaWNlKDAsLTEqYy5sZW5ndGgpKTtjb25zdCB1PWRlY29kZVVSSUNvbXBvbmVudChpKTtzfHwocz0iLiIpO2NvbnN0IGE9cy5sYXN0SW5kZXhPZigiL25vZGVfbW9kdWxlcyIpO2lmKGE+LTEpcmV0dXJuYCR7cy5zbGljZShhKzE0KS5yZXBsYWNlKC9cLy9nLCIuIil9OiR7dX1gO2lmKHMuc3RhcnRzV2l0aChlKSl7Y29uc3QgdD1zLnNsaWNlKGUubGVuZ3RoKzEpLnJlcGxhY2UoL1wvL2csIi4iKTtyZXR1cm4gdD9gJHt0fToke3V9YDp1fXJldHVybiB1fX0oVnQuYXBwUm9vdFBhdGgpOigpPT57fSxjPXMubWFwKHQ9PmZ1bmN0aW9uKHQsbixlKXtjb25zdCByPW4/bi5yZXBsYWNlKC9eZmlsZTpcL1wvLywiIik6dm9pZCAwLG89dC5sb2NhdGlvbi5jb2x1bW5OdW1iZXI/dC5sb2NhdGlvbi5jb2x1bW5OdW1iZXIrMTp2b2lkIDAscz10LmxvY2F0aW9uLmxpbmVOdW1iZXI/dC5sb2NhdGlvbi5saW5lTnVtYmVyKzE6dm9pZCAwO3JldHVybntmaWxlbmFtZTpyLG1vZHVsZTplKHIpLGZ1bmN0aW9uOnQuZnVuY3Rpb25OYW1lfHwiPyIsY29sbm86byxsaW5lbm86cyxpbl9hcHA6cj9CdChyKTp2b2lkIDB9fSh0LGUuZ2V0KHQubG9jYXRpb24uc2NyaXB0SWQpLGkpKSx1PXNldFRpbWVvdXQoKCk9Pnt1bihjKS50aGVuKG51bGwsKCk9Pnt0bigiU2VuZGluZyBBTlIgZXZlbnQgZmFpbGVkLiIpfSl9LDVlMyk7bi5wb3N0KCJSdW50aW1lLmV2YWx1YXRlIix7ZXhwcmVzc2lvbjoiZ2xvYmFsLl9fU0VOVFJZX0dFVF9TQ09QRVNfXygpOyIsc2lsZW50OiEwLHJldHVybkJ5VmFsdWU6ITB9LCh0LGUpPT57dCYmdG4oYEVycm9yIGV4ZWN1dGluZyBzY3JpcHQ6ICcke3QubWVzc2FnZX0nYCksY2xlYXJUaW1lb3V0KHUpO2NvbnN0IHI9ZT8ucmVzdWx0P2UucmVzdWx0LnZhbHVlOnZvaWQgMDtuLnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpLG4ucG9zdCgiRGVidWdnZXIuZGlzYWJsZSIpLHVuKGMscikudGhlbihudWxsLCgpPT57dG4oIlNlbmRpbmcgQU5SIGV2ZW50IGZhaWxlZC4iKX0pfSl9Y2F0Y2godCl7dGhyb3cgbi5wb3N0KCJEZWJ1Z2dlci5yZXN1bWUiKSxuLnBvc3QoIkRlYnVnZ2VyLmRpc2FibGUiKSx0fX0pLGFuPSgpPT57dHJ5e24ucG9zdCgiRGVidWdnZXIuZW5hYmxlIiwoKT0+e24ucG9zdCgiRGVidWdnZXIucGF1c2UiKX0pfWNhdGNoe319fWNvbnN0e3BvbGw6Zm59PWZ1bmN0aW9uKHQsbixlLHIpe2NvbnN0IG89dCgpO2xldCBzPSExLGk9ITA7cmV0dXJuIHNldEludGVydmFsKCgpPT57Y29uc3QgdD1vLmdldFRpbWVNcygpOyExPT09cyYmdD5uK2UmJihzPSEwLGkmJnIoKSksdDxuK2UmJihzPSExKX0sMjApLHtwb2xsOigpPT57by5yZXNldCgpfSxlbmFibGVkOnQ9PntpPXR9fX0oZnVuY3Rpb24oKXtsZXQgdD1wcm9jZXNzLmhydGltZSgpO3JldHVybntnZXRUaW1lTXM6KCk9Pntjb25zdFtuLGVdPXByb2Nlc3MuaHJ0aW1lKHQpO3JldHVybiBNYXRoLmZsb29yKDFlMypuK2UvMWU2KX0scmVzZXQ6KCk9Pnt0PXByb2Nlc3MuaHJ0aW1lKCl9fX0sVnQucG9sbEludGVydmFsLFZ0LmFuclRocmVzaG9sZCxmdW5jdGlvbigpe3RuKCJXYXRjaGRvZyB0aW1lb3V0IiksYW4/KHRuKCJQYXVzaW5nIGRlYnVnZ2VyIHRvIGNhcHR1cmUgc3RhY2sgdHJhY2UiKSxhbigpKToodG4oIkNhcHR1cmluZyBldmVudCB3aXRob3V0IGEgc3RhY2sgdHJhY2UiKSx1bigpLnRoZW4obnVsbCwoKT0+e3RuKCJTZW5kaW5nIEFOUiBldmVudCBmYWlsZWQgb24gd2F0Y2hkb2cgdGltZW91dC4iKX0pKX0pO2U/Lm9uKCJtZXNzYWdlIix0PT57dC5zZXNzaW9uJiYocXQ9SCh0LnNlc3Npb24pKSx0LmRlYnVnSW1hZ2VzJiYoWHQ9dC5kZWJ1Z0ltYWdlcyksZm4oKX0pOw==";function pL(e,...t){yy.log(`[ANR] ${e}`,...t)}function dL(){const e=xT().getScopeData();return kA(e,MT().getScopeData()),kA(e,wT().getScopeData()),e.attachments=[],e.eventProcessors=[],e}const hL=(e={})=>{if(cP.major<16||16===cP.major&&cP.minor<17)throw new Error("ANR detection requires Node 16.17.0 or later");let t,n;return uy.__SENTRY_GET_SCOPES__=dL,{name:"Anr",startWorker:()=>{t||n&&(t=async function(e,t){const n=e.getDsn();if(!n)return()=>{};const r=await async function(e){let t={message:"ANR"};const n={};for(const r of e.getEventProcessors()){if(null===t)break;t=await r(t,n)}return t?.contexts||{}}(e);delete r.app?.app_memory,delete r.device?.free_memory;const s=e.getOptions(),o=e.getSdkMetadata()||{};o.sdk&&(o.sdk.integrations=s.integrations.map(e=>e.name));const i={debug:yy.isEnabled(),dsn:n,tunnel:s.tunnel,environment:s.environment||"production",release:s.release,dist:s.dist,sdkMetadata:o,appRootPath:t.appRootPath,pollInterval:t.pollInterval||50,anrThreshold:t.anrThreshold||5e3,captureStackTrace:!!t.captureStackTrace,maxAnrEvents:t.maxAnrEvents||1,staticTags:t.staticTags||{},contexts:r};if(i.captureStackTrace){const e=await import("node:inspector");e.url()||e.open(0)}const a=new T.Worker(new URL(`data:application/javascript;base64,${lL}`),{workerData:i,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{a.terminate()});const c=setInterval(()=>{try{const e=MT().getSession(),t=e?{...e,toJSON:void 0}:void 0;a.postMessage({session:t,debugImages:HA(s.stackParser)})}catch{}},i.pollInterval);return c.unref(),a.on("message",e=>{"session-ended"===e&&(pL("ANR event sent from ANR worker. Clearing session in this thread."),MT().setSession(void 0))}),a.once("error",e=>{clearInterval(c),pL("ANR worker error",e)}),a.once("exit",e=>{clearInterval(c),pL("ANR worker exit",e)}),a.unref(),()=>{a.terminate(),clearInterval(c)}}(n,e))},stopWorker:()=>{t&&t.then(e=>{e(),t=void 0})},async setup(t){n=t,e.captureStackTrace&&await ZP()&&(yy.warn("ANR captureStackTrace has been disabled because the debugger was already enabled"),e.captureStackTrace=!1),setImmediate(()=>this.startWorker())}}};const mL="Spotlight",fL=(e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:mL,setup(e){try{yy.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?")}catch{}!function(e,t){const n=function(e){try{return new URL(`${e}`)}catch{return void yy.warn(`[Spotlight] Invalid sidecar URL: ${e}`)}}(t.sidecarUrl);if(!n)return;let r=0;e.on("beforeEnvelope",e=>{if(r>3)return void yy.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");const t=qb(e);bA(()=>{const e=x.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},e=>{e.statusCode&&e.statusCode>=200&&e.statusCode<400&&(r=0),e.on("data",()=>{}),e.on("end",()=>{}),e.setEncoding("utf8")});e.on("error",()=>{r++,yy.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),e.write(t),e.end()})})}(e,t)}}};const _L=(e={})=>({name:"NodeSystemError",processEvent:(t,n,r)=>{if(!function(e){return e instanceof Error&&"errno"in e&&"number"==typeof e.errno&&M.getSystemErrorMap().has(e.errno)}(n.originalException))return t;const s=n.originalException,o={...s};r.getOptions().sendDefaultPii||!0===e.includePaths||(delete o.path,delete o.dest),t.contexts={...t.contexts,node_system_error:o};for(const e of t.exception?.values||[])e.value&&(s.path&&e.value.includes(s.path)&&(e.value=e.value.replace(`'${s.path}'`,"").trim()),s.dest&&e.value.includes(s.dest)&&(e.value=e.value.replace(`'${s.dest}'`,"").trim()));return t}}),gL=(e={})=>({name:"ChildProcess",setup(){I.channel("child_process").subscribe(t=>{t&&"object"==typeof t&&"process"in t&&function(e,t){let n,r=!1;e.on("spawn",()=>{"/usr/bin/sw_vers"!==e.spawnfile?(n={spawnfile:e.spawnfile},t.includeChildProcessArgs&&(n.spawnargs=e.spawnargs)):r=!0}).on("exit",e=>{r||(r=!0,null!==e&&0!==e&&FR({category:"child_process",message:`Child process exited with code '${e}'`,level:0===e?"info":"warning",data:n}))}).on("error",e=>{r||(r=!0,FR({category:"child_process",message:`Child process errored with '${e.message}'`,level:"error",data:n}))})}(t.process,e)}),I.channel("worker_threads").subscribe(t=>{t&&"object"==typeof t&&"worker"in t&&function(e,t){let n;e.on("online",()=>{n=e.threadId}).on("error",e=>{!1!==t.captureWorkerErrors?XA(e,{mechanism:{type:"instrument",handled:!1,data:{threadId:String(n)}}}):FR({category:"worker_thread",message:`Worker thread errored with '${e.message}'`,level:"error",data:{threadId:n}})})}(t.worker,e)})}});const EL=["trace","debug","info","warn","error","fatal"],SL=Symbol.for("level"),yL=Symbol.for("message"),TL=Symbol.for("splat");const bL={silly:"trace",debug:"debug",verbose:"debug",http:"debug",info:"info",notice:"info",warn:"warn",warning:"warn",error:"error",emerg:"fatal",alert:"fatal",crit:"fatal"};var AL={},RL={},vL={};Object.defineProperty(vL,"__esModule",{value:!0}),vL.AbstractAsyncHooksContextManager=void 0;const NL=l,CL=["addListener","on","once","prependListener","prependOnceListener"];vL.AbstractAsyncHooksContextManager=class{bind(e,t){return t instanceof NL.EventEmitter?this._bindEventEmitter(e,t):"function"==typeof t?this._bindFunction(e,t):t}_bindFunction(e,t){const n=this,r=function(...r){return n.with(e,()=>t.apply(this,r))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r}_bindEventEmitter(e,t){return void 0!==this._getPatchMap(t)||(this._createPatchMap(t),CL.forEach(n=>{void 0!==t[n]&&(t[n]=this._patchAddListener(t,t[n],e))}),"function"==typeof t.removeListener&&(t.removeListener=this._patchRemoveListener(t,t.removeListener)),"function"==typeof t.off&&(t.off=this._patchRemoveListener(t,t.off)),"function"==typeof t.removeAllListeners&&(t.removeAllListeners=this._patchRemoveAllListeners(t,t.removeAllListeners))),t}_patchRemoveListener(e,t){const n=this;return function(r,s){const o=n._getPatchMap(e)?.[r];if(void 0===o)return t.call(this,r,s);const i=o.get(s);return t.call(this,r,i||s)}}_patchRemoveAllListeners(e,t){const n=this;return function(r){const s=n._getPatchMap(e);return void 0!==s&&(0===arguments.length?n._createPatchMap(e):void 0!==s[r]&&delete s[r]),t.apply(this,arguments)}}_patchAddListener(e,t,n){const r=this;return function(s,o){if(r._wrapped)return t.call(this,s,o);let i=r._getPatchMap(e);void 0===i&&(i=r._createPatchMap(e));let a=i[s];void 0===a&&(a=new WeakMap,i[s]=a);const c=r.bind(n,o);a.set(o,c),r._wrapped=!0;try{return t.call(this,s,c)}finally{r._wrapped=!1}}}_createPatchMap(e){const t=Object.create(null);return e[this._kOtListeners]=t,t}_getPatchMap(e){return e[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1},Object.defineProperty(RL,"__esModule",{value:!0}),RL.AsyncHooksContextManager=void 0;const OL=Ft,IL=m,PL=vL;class LL extends PL.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=IL.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??OL.ROOT_CONTEXT}with(e,t,n,...r){this._enterContext(e);try{return t.call(n,...r)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(e,t){if("TIMERWRAP"===t)return;const n=this._stack[this._stack.length-1];void 0!==n&&this._contexts.set(e,n)}_destroy(e){this._contexts.delete(e)}_before(e){const t=this._contexts.get(e);void 0!==t&&this._enterContext(t)}_after(){this._exitContext()}_enterContext(e){this._stack.push(e)}_exitContext(){this._stack.pop()}}RL.AsyncHooksContextManager=LL;var wL={};Object.defineProperty(wL,"__esModule",{value:!0}),wL.AsyncLocalStorageContextManager=void 0;const ML=Ft,xL=m,kL=vL;class GL extends kL.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new xL.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??ML.ROOT_CONTEXT}with(e,t,n,...r){const s=null==n?t:t.bind(n);return this._asyncLocalStorage.run(e,s,...r)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}}wL.AsyncLocalStorageContextManager=GL,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncLocalStorageContextManager=e.AsyncHooksContextManager=void 0;var t=RL;Object.defineProperty(e,"AsyncHooksContextManager",{enumerable:!0,get:function(){return t.AsyncHooksContextManager}});var n=wL;Object.defineProperty(e,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return n.AsyncLocalStorageContextManager}})}(AL);const DL=(VL=AL.AsyncLocalStorageContextManager,class extends VL{constructor(...e){super(...e),bI("SentryContextManager")}with(e,t,n,...r){const s=pI(e),o=s?.scope||wT(),i=s?.isolationScope||MT(),a=!0===e.getValue(aI),c=e.getValue(cI),u=e.getValue(uI),l=c||o.clone(),p=dI(e,{scope:l,isolationScope:u||(a?i.clone():i)}).deleteValue(aI).deleteValue(cI).deleteValue(uI);return function(e,t){tT(e,lI,t)}(l,p),super.with(p,t,n,...r)}});var VL;const UL=()=>({name:"ProcessSession",setupOnce(){JA(),process.on("beforeExit",()=>{const e=MT().getSession();"ok"!==e?.status&&zA()})}}),HL=Symbol("AgentBaseInternalState");class jL extends x.Agent{constructor(e){super(e),this[HL]={}}isSecureEndpoint(e){if(e){if("boolean"==typeof e.secureEndpoint)return e.secureEndpoint;if("string"==typeof e.protocol)return"https:"===e.protocol}const{stack:t}=new Error;return"string"==typeof t&&t.split("\n").some(e=>-1!==e.indexOf("(https.js:")||-1!==e.indexOf("node:https:"))}createSocket(e,t,n){const r={...t,secureEndpoint:this.isSecureEndpoint(t)};Promise.resolve().then(()=>this.connect(e,r)).then(s=>{if(s instanceof x.Agent)return s.addRequest(e,r);this[HL].currentSocket=s,super.createSocket(e,t,n)},n)}createConnection(){const e=this[HL].currentSocket;if(this[HL].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[HL].defaultPort??("https:"===this.protocol?443:80)}set defaultPort(e){this[HL]&&(this[HL].defaultPort=e)}get protocol(){return this[HL].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[HL]&&(this[HL].protocol=e)}}function ZL(...e){yy.log("[https-proxy-agent:parse-proxy-response]",...e)}function WL(e){return new Promise((t,n)=>{let r=0;const s=[];function o(){const a=e.read();a?function(a){s.push(a),r+=a.length;const c=Buffer.concat(s,r),u=c.indexOf("\r\n\r\n");if(-1===u)return ZL("have not received end of HTTP headers yet..."),void o();const l=c.subarray(0,u).toString("ascii").split("\r\n"),p=l.shift();if(!p)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const d=p.split(" "),h=+(d[1]||0),m=d.slice(2).join(" "),f={};for(const t of l){if(!t)continue;const r=t.indexOf(":");if(-1===r)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${t}"`));const s=t.slice(0,r).toLowerCase(),o=t.slice(r+1).trimStart(),i=f[s];"string"==typeof i?f[s]=[i,o]:Array.isArray(i)?i.push(o):f[s]=o}ZL("got proxy server response: %o %o",p,f),i(),t({connect:{statusCode:h,statusText:m,headers:f},buffered:c})}(a):e.once("readable",o)}function i(){e.removeListener("end",a),e.removeListener("error",c),e.removeListener("readable",o)}function a(){i(),ZL("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function c(e){i(),ZL("onerror %o",e),n(e)}e.on("error",c),e.on("end",a),o()})}function XL(...e){yy.log("[https-proxy-agent]",...e)}class $L extends jL{static __initStatic(){this.protocols=["http","https"]}constructor(e,t){super(t),this.options={},this.proxy="string"==typeof e?new URL(e):e,this.proxyHeaders=t?.headers??{},XL("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),r=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?YL(t,"headers"):null,host:n,port:r}}async connect(e,t){const{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let r;if("https:"===n.protocol){XL("Creating `tls.Socket`: %o",this.connectOpts);const e=this.connectOpts.servername||this.connectOpts.host;r=G.connect({...this.connectOpts,servername:e&&L.isIP(e)?void 0:e})}else XL("Creating `net.Socket`: %o",this.connectOpts),r=L.connect(this.connectOpts);const s="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},o=L.isIPv6(t.host)?`[${t.host}]`:t.host;let i=`CONNECT ${o}:${t.port} HTTP/1.1\r\n`;if(n.username||n.password){const e=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;s["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}s.Host=`${o}:${t.port}`,s["Proxy-Connection"]||(s["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const e of Object.keys(s))i+=`${e}: ${s[e]}\r\n`;const a=WL(r);r.write(`${i}\r\n`);const{connect:c,buffered:u}=await a;if(e.emit("proxyConnect",c),this.emit("proxyConnect",c,e),200===c.statusCode){if(e.once("socket",FL),t.secureEndpoint){XL("Upgrading socket connection to TLS");const e=t.servername||t.host;return G.connect({...YL(t,"host","path","port"),socket:r,servername:L.isIP(e)?void 0:e})}return r}r.destroy();const l=new L.Socket({writable:!1});return l.readable=!0,e.once("socket",e=>{XL("Replaying proxy buffer for failed request"),e.push(u),e.push(null)}),l}}function FL(e){e.resume()}function YL(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}$L.__initStatic();function BL(e){let t;try{t=new URL(e.url)}catch(t){return _y(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),xR(e,()=>Promise.resolve({}))}const n="https:"===t.protocol,r=function(e,t){const{no_proxy:n}=process.env,r=n?.split(",").some(t=>e.host.endsWith(t)||e.hostname.endsWith(t));return r?void 0:t}(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),s=n?k:x,o=void 0!==e.keepAlive&&e.keepAlive,i=r?new $L(r):new s.Agent({keepAlive:o,maxSockets:30,timeout:2e3}),a=function(e,t,n){const{hostname:r,pathname:s,port:o,protocol:i,search:a}=new URL(e.url);return function(c){return new Promise((u,l)=>{bA(()=>{let p=function(e){return new R.Readable({read(){this.push(e),this.push(null)}})}(c.body);const d={...e.headers};c.body.length>32768&&(d["content-encoding"]="gzip",p=p.pipe(v.createGzip()));const h=t.request({method:"POST",agent:n,headers:d,hostname:r,path:`${s}${a}`,port:o,protocol:i,ca:e.caCerts},e=>{e.on("data",()=>{}),e.on("end",()=>{}),e.setEncoding("utf8");const t=e.headers["retry-after"]??null,n=e.headers["x-sentry-rate-limits"]??null;u({statusCode:e.statusCode,headers:{"retry-after":t,"x-sentry-rate-limits":Array.isArray(n)?n[0]||null:n}})});h.on("error",l),p.pipe(h)})})}}(e,e.httpModule??s,i);return xR(e,a)}const KL=new Set(["false","f","n","no","off","0"]),JL=new Set(["true","t","y","yes","on","1"]);function zL(e,t){const n=String(e).toLowerCase();return!KL.has(n)&&(!!JL.has(n)||(t?.strict?null:Boolean(e)))}function QL(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function qL(e=(process.argv[1]?function(e){const t=Tv(e),n=t[0]||"";let r=t[1];return n||r?(r&&(r=r.slice(0,r.length-1)),n+r):"."}(process.argv[1]):process.cwd()),t="\\"===E.sep){const n=t?QL(e):e;return e=>{if(!e)return;const r=t?QL(e):e;let{dir:s,base:o,ext:i}=E.posix.parse(r);".js"!==i&&".mjs"!==i&&".cjs"!==i||(o=o.slice(0,-1*i.length));const a=decodeURIComponent(o);s||(s=".");const c=s.lastIndexOf("/node_modules");if(c>-1)return`${s.slice(c+14).replace(/\//g,".")}:${a}`;if(s.startsWith(n)){const e=s.slice(n.length+1).replace(/\//g,".");return e?`${e}:${a}`:a}return a}}function ew(e){if(process.env.SENTRY_RELEASE)return process.env.SENTRY_RELEASE;if(uy.SENTRY_RELEASE?.id)return uy.SENTRY_RELEASE.id;const t=process.env.GITHUB_SHA||process.env.CI_MERGE_REQUEST_SOURCE_BRANCH_SHA||process.env.CI_BUILD_REF||process.env.CI_COMMIT_SHA||process.env.BITBUCKET_COMMIT,n=process.env.APPVEYOR_PULL_REQUEST_HEAD_COMMIT||process.env.APPVEYOR_REPO_COMMIT||process.env.CODEBUILD_RESOLVED_SOURCE_VERSION||process.env.AWS_COMMIT_ID||process.env.BUILD_SOURCEVERSION||process.env.GIT_CLONE_COMMIT_HASH||process.env.BUDDY_EXECUTION_REVISION||process.env.BUILDKITE_COMMIT||process.env.CIRCLE_SHA1||process.env.CIRRUS_CHANGE_IN_REPO||process.env.CF_REVISION||process.env.CM_COMMIT||process.env.CF_PAGES_COMMIT_SHA||process.env.DRONE_COMMIT_SHA||process.env.FC_GIT_COMMIT_SHA||process.env.HEROKU_TEST_RUN_COMMIT_VERSION||process.env.HEROKU_SLUG_COMMIT||process.env.RAILWAY_GIT_COMMIT_SHA||process.env.RENDER_GIT_COMMIT||process.env.SEMAPHORE_GIT_SHA||process.env.TRAVIS_PULL_REQUEST_SHA||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA,r=process.env.CI_COMMIT_ID||process.env.SOURCE_COMMIT||process.env.SOURCE_VERSION||process.env.GIT_COMMIT||process.env.COMMIT_REF||process.env.BUILD_VCS_NUMBER||process.env.CI_COMMIT_SHA;return t||n||r||e}const tw=Ay([90,mO(qL())]);class nw extends OR{constructor(e){const t=!1===e.includeServerName?void 0:e.serverName||global.process.env.SENTRY_NAME||w.hostname(),n={...e,platform:"node",runtime:{name:"node",version:global.process.version},serverName:t};e.openTelemetryInstrumentations&&ug({instrumentations:e.openTelemetryInstrumentations}),HR(n,"node"),yy.log(`Initializing Sentry: process: ${process.pid}, thread: ${u.isMainThread?"main":`worker-${u.threadId}`}.`),super(n),this.getOptions().enableLogs&&(this._logOnExitFlushListener=()=>{TR(this)},t&&this.on("beforeCaptureLog",e=>{e.attributes={...e.attributes,"server.address":t}}),process.on("beforeExit",this._logOnExitFlushListener))}get tracer(){if(this._tracer)return this._tracer;const e=ly,t=Ht.getTracer("@sentry/node",e);return this._tracer=t,t}async flush(e){const t=this.traceProvider;return await(t?.forceFlush()),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(e)}close(e){return this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),this._logOnExitFlushListener&&process.off("beforeExit",this._logOnExitFlushListener),super.close(e)}startClientReportTracking(){const e=this.getOptions();e.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{bO&&yy.log("Flushing client reports based on interval."),this._flushOutcomes()},e.clientReportFlushInterval??6e4).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_getTraceInfoFromScope(e){return e?function(e,t){const n=hI(t),r=n&&Ht.getSpan(n),s=r?Tb(r):VT(t);return[r?Xb(r):Wb(e,t),s]}(this,e):[void 0,void 0]}}function rw(){return[QR(),KR(),ov(),cv(),_L(),Zv(),aP(),gP(),aL(),cL(),HP(),QP(),yP(),gL(),UL(),nL()]}function sw(e={}){return function(e={},t){const n=function(e,t){const n=function(e){if(void 0!==e)return e;const t=ew();if(void 0!==t)return t;return}(e.release),r=e.spotlight??zL(process.env.SENTRY_SPOTLIGHT,{strict:!0})??process.env.SENTRY_SPOTLIGHT,s=function(e){if(void 0!==e)return e;const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(!t)return;const n=parseFloat(t);return isFinite(n)?n:void 0}(e.tracesSampleRate),o={...e,dsn:e.dsn??process.env.SENTRY_DSN,environment:e.environment??process.env.SENTRY_ENVIRONMENT,sendClientReports:e.sendClientReports??!0,transport:e.transport??BL,stackParser:Ry(e.stackParser||tw),release:n,tracesSampleRate:s,spotlight:r,debug:zL(e.debug??process.env.SENTRY_DEBUG)},i=e.integrations,a=e.defaultIntegrations??t(o);return{...o,integrations:tR({defaultIntegrations:a,integrations:i})}}(e,t);!0===n.debug&&(bO?yy.enable():_y(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")}));qP()||!1===n.registerEsmLoaderHooks||function(){const[e=0,t=0]=process.versions.node.split(".").map(Number);if(e>=21||20===e&&t>=6||18===e&&t>=19){if(!uy._sentryEsmLoaderHookRegistered)try{const{addHookMessagePort:e}=NS();a.register("import-in-the-middle/hook.mjs","undefined"==typeof document?require("url").pathToFileURL(__filename).href:document.currentScript&&document.currentScript.src||new URL("index.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){yy.warn("Failed to register ESM hook",e)}}else _y(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})}();HI();wT().update(n.initialScope),n.spotlight&&!n.integrations.some(({name:e})=>e===mL)&&n.integrations.push(fL({sidecarUrl:"string"==typeof n.spotlight?n.spotlight:void 0}));HR(n,"node-core");const r=new nw(n);return wT().setClient(r),r.init(),yy.log(`Running in ${qP()?"CommonJS":"ESM"} mode.`),r.startClientReportTracking(),function(){if(!1!==zL(process.env.SENTRY_USE_ENVIRONMENT)){const e=_b(process.env.SENTRY_TRACE,process.env.SENTRY_BAGGAGE);wT().setPropagationContext(e)}}(),function(e){e.on("createDsc",(e,t)=>{if(!t)return;const n=Nb(t).data[UT],{description:r}=eI(t)?_I(t):{description:void 0};if("url"!==n&&r&&(e.transaction=r),Vb()){const n=mI(t.spanContext());e.sampled=null==n?void 0:String(n)}})}(r),function(e){e.on("preprocessEvent",e=>{const t=EI();if(!t||"transaction"===e.type)return;e.contexts={trace:Tb(t),...e.contexts};const n=Mb(t);return e.sdkProcessingMetadata={dynamicSamplingContext:Xb(n),...e.sdkProcessingMetadata},e})}(r),r}(e,rw)}function ow(){if(!bO)return;const e=Array.from(TI),t=["SentryContextManager","SentryPropagator"];Vb()&&t.push("SentrySpanProcessor");for(const n of t)e.includes(n)||yy.error(`You have to set up the ${n}. Without this, the OpenTelemetry & Sentry integration will not work properly.`);e.includes("SentrySampler")||yy.warn("You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected. If you use a custom sampler, make sure to use `wrapSamplingDecision`.")}function iw(e,t){e.setAttribute(ZT,t)}function aw(e,t){const n=DT()?.getOptions();!n?.disableInstrumentationWarnings&&!OS(e)&&KA()&&Vb(n)&&(_y(()=>{qP()?console.warn(`[Sentry] ${t} is not instrumented. This is likely because you required/imported ${t} before calling \`Sentry.init()\`.`):console.warn(`[Sentry] ${t} is not instrumented. Please make sure to initialize Sentry in a separate file that you \`--import\` when running node, see: https://docs.sentry.io/platforms/javascript/guides/${t}/install/esm/.`)}),xT().setContext("missing_instrumentation",{package:t,"javascript.is_cjs":qP()}))}const cw=[["january","1"],["february","2"],["march","3"],["april","4"],["may","5"],["june","6"],["july","7"],["august","8"],["september","9"],["october","10"],["november","11"],["december","12"],["jan","1"],["feb","2"],["mar","3"],["apr","4"],["may","5"],["jun","6"],["jul","7"],["aug","8"],["sep","9"],["oct","10"],["nov","11"],["dec","12"],["sunday","0"],["monday","1"],["tuesday","2"],["wednesday","3"],["thursday","4"],["friday","5"],["saturday","6"],["sun","0"],["mon","1"],["tue","2"],["wed","3"],["thu","4"],["fri","5"],["sat","6"]];function uw(e){return cw.reduce((e,[t,n])=>e.replace(new RegExp(t,"gi"),n),e)}const lw="Automatic instrumentation of CronJob only supports crontab string";const pw={instrumentCron:function(e,t){let n=!1;return new Proxy(e,{construct(e,r){const[s,o,i,a,c,...u]=r;if("string"!=typeof s)throw new Error(lw);if(n)throw new Error(`A job named '${t}' has already been scheduled`);n=!0;const l=uw(s);return new e(s,async function(e,n){return BA(t,async()=>{try{await o(e,n)}catch(e){throw XA(e),e}},{schedule:{type:"crontab",value:l},timezone:c||void 0})},i,a,c,...u)},get:(e,r)=>"from"===r?r=>{const{cronTime:s,onTick:o,timeZone:i}=r;if("string"!=typeof s)throw new Error(lw);if(n)throw new Error(`A job named '${t}' has already been scheduled`);n=!0;const a=uw(s);return r.onTick=async(e,n)=>BA(t,async()=>{try{await o(e,n)}catch(e){throw XA(e),e}},{schedule:{type:"crontab",value:a},timezone:i||void 0}),e.from(r)}:e[r]})},instrumentNodeCron:function(e){return new Proxy(e,{get:(e,t)=>"schedule"===t&&e.schedule?new Proxy(e.schedule,{apply(e,t,n){const[r,s,o]=n,i=o?.name,a=o?.timezone;if(!i)throw new Error('Missing "name" for scheduled job. A name is required for Sentry check-in monitoring.');return e.apply(t,[r,async()=>BA(i,async()=>{try{return await s()}catch(e){throw XA(e),e}},{schedule:{type:"crontab",value:uw(r)},timezone:a}),o])}}):e[t]})},instrumentNodeSchedule:function(e){return new Proxy(e,{get:(e,t)=>"scheduleJob"===t?new Proxy(e.scheduleJob,{apply(e,t,n){const[r,s,o]=n;if("string"!=typeof r||"string"!=typeof s||"function"!=typeof o)throw new Error("Automatic instrumentation of 'node-schedule' requires the first parameter of 'scheduleJob' to be a job name string and the second parameter to be a crontab string");const i=r,a=s;return e.apply(t,[i,a,async function(){return BA(i,async()=>{await(o?.())},{schedule:{type:"crontab",value:uw(a)}})}])}}):e[t]})}},dw="Http",hw="@opentelemetry_sentry-patched/instrumentation-http",mw=yO(`${dw}.sentry`,e=>new sP(e)),fw=yO(dw,e=>{const t=new Xt.HttpInstrumentation(e);try{t._diag=At.createComponentLogger({namespace:hw}),t.instrumentationName=hw}catch{}return t});const _w=(e={})=>{const t=e.dropSpansForIncomingRequestStatusCodes??[[401,404],[300,399]];return{name:dw,setupOnce(){const t=function(e,t={}){return"boolean"==typeof e.spans?e.spans:!(t.skipOpenTelemetrySetup||!Vb(t)&&cP.major>=22)}(e,DT()?.getOptions());if(mw({...e,extractIncomingTraceFromHeader:!t,propagateTraceInOutgoingRequests:!t}),t){const t=function(e={}){const t={...e.instrumentation?._experimentalConfig,disableIncomingRequestInstrumentation:e.disableIncomingRequestSpans,ignoreOutgoingRequestHook:t=>{const n=AO(t);if(!n)return!1;const r=e.ignoreOutgoingRequests;return!!r?.(n,t)},ignoreIncomingRequestHook:t=>{const n=t.url,r=t.method?.toUpperCase();if("OPTIONS"===r||"HEAD"===r)return!0;if(!1!==e.ignoreStaticAssets&&"GET"===r&&n&&function(e){const t=GR(e);if(t.match(/\.(ico|png|jpg|jpeg|gif|svg|css|js|woff|woff2|ttf|eot|webp|avif)$/))return!0;if(t.match(/^\/(robots\.txt|sitemap\.xml|manifest\.json|browserconfig\.xml)$/))return!0;return!1}(n))return!0;const s=e.ignoreIncomingRequests;return!(!n||!s?.(n,t))},requireParentforOutgoingSpans:!1,requireParentforIncomingSpans:!1,requestHook:(t,n)=>{iw(t,"auto.http.otel.http"),!function(e){return"outputData"in e&&"outputSize"in e&&!("client"in e)&&!("statusCode"in e)}(n)&&function(e){return"1"===e.headers["next-router-prefetch"]}(n)&&t.setAttribute("sentry.http.prefetch",!0),e.instrumentation?.requestHook?.(t,n)},responseHook:(t,n)=>{e.instrumentation?.responseHook?.(t,n)},applyCustomAttributesOnSpan:(t,n,r)=>{e.instrumentation?.applyCustomAttributesOnSpan?.(t,n,r)}};return t}(e);fw(t)}},processEvent(e){if("transaction"===e.type){const n=e.contexts?.trace?.data?.["http.response.status_code"];if("number"==typeof n&&t.some(e=>{if("number"==typeof e)return e===n;const[t,r]=e;return n>=t&&n<=r}))return null}return e}}};var gw={},Ew={},Sw={};Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.PACKAGE_NAME=Sw.PACKAGE_VERSION=void 0,Sw.PACKAGE_VERSION="0.14.0",Sw.PACKAGE_NAME="@opentelemetry/instrumentation-undici";var yw={};Object.defineProperty(yw,"__esModule",{value:!0}),yw.SemanticAttributes=void 0,yw.SemanticAttributes={HTTP_CONNECTION_STATE:"http.connection.state",ERROR_TYPE:"error.type",HTTP_REQUEST_BODY_SIZE:"http.request.body.size",HTTP_REQUEST_METHOD:"http.request.method",HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",HTTP_RESPONSE_BODY_SIZE:"http.response.body.size",HTTP_RESPONSE_STATUS_CODE:"http.response.status_code",HTTP_ROUTE:"http.route",NETWORK_PEER_ADDRESS:"network.peer.address",NETWORK_PEER_PORT:"network.peer.port",NETWORK_PROTOCOL_NAME:"network.protocol.name",NETWORK_PROTOCOL_VERSION:"network.protocol.version",SERVER_ADDRESS:"server.address",SERVER_PORT:"server.port",URL_FULL:"url.full",URL_PATH:"url.path",URL_QUERY:"url.query",URL_SCHEME:"url.scheme",USER_AGENT_ORIGINAL:"user_agent.original"},Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.UndiciInstrumentation=void 0;const Tw=d,bw=i,Aw=kS,Rw=Ft,vw=Sw,Nw=yw,Cw=Q_;class Ow extends Aw.InstrumentationBase{_recordFromReq=new WeakMap;constructor(e={}){super(vw.PACKAGE_NAME,vw.PACKAGE_VERSION,e)}init(){}disable(){super.disable(),this._channelSubs.forEach(e=>e.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],this._channelSubs.length>0||(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram("http.client.request.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:Rw.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(e,t){const[n,r]=process.version.replace("v","").split(".").map(e=>Number(e));let s;if(n>18||18===n&&r>=19)Tw.subscribe?.(e,t),s=()=>Tw.unsubscribe?.(e,t);else{const n=Tw.channel(e);n.subscribe(t),s=()=>n.unsubscribe(t)}this._channelSubs.push({name:e,unsubscribe:s})}parseRequestHeaders(e){const t=new Map;if(Array.isArray(e.headers))for(let n=0;n<e.headers.length;n+=2){const r=e.headers[n],s=e.headers[n+1];"string"==typeof r&&t.set(r.toLowerCase(),s)}else if("string"==typeof e.headers){const n=e.headers.split("\r\n");for(const e of n){if(!e)continue;const n=e.indexOf(":");if(-1===n)continue;const r=e.substring(0,n).toLowerCase(),s=e.substring(n+1).trim(),o=t.get(r);o&&Array.isArray(o)?o.push(s):o?t.set(r,[o,s]):t.set(r,s)}}return t}onRequestCreated({request:e}){const t=this.getConfig(),n=!1!==t.enabled;if((0,Aw.safeExecuteInTheMiddle)(()=>!n||"CONNECT"===e.method||t.ignoreRequestHook?.(e),e=>e&&this._diag.error("caught ignoreRequestHook error: ",e),!0))return;const r=(0,Cw.hrTime)();let s;try{s=new bw.URL(e.path,e.origin)}catch(e){return void this._diag.warn("could not determine url.full:",e)}const o=s.protocol.replace(":",""),i=this.getRequestMethod(e.method),a={[Nw.SemanticAttributes.HTTP_REQUEST_METHOD]:i,[Nw.SemanticAttributes.HTTP_REQUEST_METHOD_ORIGINAL]:e.method,[Nw.SemanticAttributes.URL_FULL]:s.toString(),[Nw.SemanticAttributes.URL_PATH]:s.pathname,[Nw.SemanticAttributes.URL_QUERY]:s.search,[Nw.SemanticAttributes.URL_SCHEME]:o},c=s.hostname,u=s.port||{https:"443",http:"80"}[o];a[Nw.SemanticAttributes.SERVER_ADDRESS]=c,u&&!isNaN(Number(u))&&(a[Nw.SemanticAttributes.SERVER_PORT]=Number(u));const l=this.parseRequestHeaders(e).get("user-agent");if(l){const e=Array.isArray(l)?l[l.length-1]:l;a[Nw.SemanticAttributes.USER_AGENT_ORIGINAL]=e}const p=(0,Aw.safeExecuteInTheMiddle)(()=>t.startSpanHook?.(e),e=>e&&this._diag.error("caught startSpanHook error: ",e),!0);p&&Object.entries(p).forEach(([e,t])=>{a[e]=t});const d=Rw.context.active(),h=Rw.trace.getSpan(d);let m;m=!t.requireParentforSpans||h&&Rw.trace.isSpanContextValid(h.spanContext())?this.tracer.startSpan("_OTHER"===i?"HTTP":i,{kind:Rw.SpanKind.CLIENT,attributes:a},d):Rw.trace.wrapSpanContext(Rw.INVALID_SPAN_CONTEXT),(0,Aw.safeExecuteInTheMiddle)(()=>t.requestHook?.(m,e),e=>e&&this._diag.error("caught requestHook error: ",e),!0);const f=Rw.trace.setSpan(Rw.context.active(),m),_={};Rw.propagation.inject(f,_);const g=Object.entries(_);for(let t=0;t<g.length;t++){const[n,r]=g[t];"function"==typeof e.addHeader?e.addHeader(n,r):"string"==typeof e.headers?e.headers+=`${n}: ${r}\r\n`:Array.isArray(e.headers)&&e.headers.push(n,r)}this._recordFromReq.set(e,{span:m,attributes:a,startTime:r})}onRequestHeaders({request:e,socket:t}){const n=this._recordFromReq.get(e);if(!n)return;const r=this.getConfig(),{span:s}=n,{remoteAddress:o,remotePort:i}=t,a={[Nw.SemanticAttributes.NETWORK_PEER_ADDRESS]:o,[Nw.SemanticAttributes.NETWORK_PEER_PORT]:i};if(r.headersToSpanAttributes?.requestHeaders){const t=new Set(r.headersToSpanAttributes.requestHeaders.map(e=>e.toLowerCase())),n=this.parseRequestHeaders(e);for(const[e,r]of n.entries())if(t.has(e)){const t=Array.isArray(r)?r.join(", "):r;a[`http.request.header.${e}`]=t}}s.setAttributes(a)}onResponseHeaders({request:e,response:t}){const n=this._recordFromReq.get(e);if(!n)return;const{span:r,attributes:s}=n,o={[Nw.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE]:t.statusCode},i=this.getConfig();(0,Aw.safeExecuteInTheMiddle)(()=>i.responseHook?.(r,{request:e,response:t}),e=>e&&this._diag.error("caught responseHook error: ",e),!0);const a=new Set;i.headersToSpanAttributes?.responseHeaders&&i.headersToSpanAttributes?.responseHeaders.forEach(e=>a.add(e.toLowerCase()));for(let e=0;e<t.headers.length;e+=2){const n=t.headers[e].toString().toLowerCase(),r=t.headers[e+1];if(a.has(n)&&(o[`http.response.header.${n}`]=r.toString()),"content-length"===n){const e=Number(r.toString());isNaN(e)||(o["http.response.header.content-length"]=e)}}r.setAttributes(o),r.setStatus({code:t.statusCode>=400?Rw.SpanStatusCode.ERROR:Rw.SpanStatusCode.UNSET}),n.attributes=Object.assign(s,o)}onDone({request:e}){const t=this._recordFromReq.get(e);if(!t)return;const{span:n,attributes:r,startTime:s}=t;n.end(),this._recordFromReq.delete(e),this.recordRequestDuration(r,s)}onError({request:e,error:t}){const n=this._recordFromReq.get(e);if(!n)return;const{span:r,attributes:s,startTime:o}=n;r.recordException(t),r.setStatus({code:Rw.SpanStatusCode.ERROR,message:t.message}),r.end(),this._recordFromReq.delete(e),s[Nw.SemanticAttributes.ERROR_TYPE]=t.message,this.recordRequestDuration(s,o)}recordRequestDuration(e,t){const n={};[Nw.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE,Nw.SemanticAttributes.HTTP_REQUEST_METHOD,Nw.SemanticAttributes.SERVER_ADDRESS,Nw.SemanticAttributes.SERVER_PORT,Nw.SemanticAttributes.URL_SCHEME,Nw.SemanticAttributes.ERROR_TYPE].forEach(t=>{t in e&&(n[t]=e[t])});const r=(0,Cw.hrTimeToMilliseconds)((0,Cw.hrTimeDuration)(t,(0,Cw.hrTime)()))/1e3;this._httpClientDurationHistogram.record(r,n)}getRequestMethod(e){return e.toUpperCase()in{CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0}?e.toUpperCase():"_OTHER"}}Ew.UndiciInstrumentation=Ow,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UndiciInstrumentation=void 0;var t=Ew;Object.defineProperty(e,"UndiciInstrumentation",{enumerable:!0,get:function(){return t.UndiciInstrumentation}})}(gw);const Iw="NodeFetch",Pw=yO(Iw,gw.UndiciInstrumentation,e=>function(e={}){const t={requireParentforSpans:!1,ignoreRequestHook:t=>{const n=function(e,t="/"){const n=`${e}`;if(n.endsWith("/")&&t.startsWith("/"))return`${n}${t.slice(1)}`;if(!n.endsWith("/")&&!t.startsWith("/"))return`${n}/${t.slice(1)}`;return`${n}${t}`}(t.origin,t.path),r=e.ignoreOutgoingRequests;return!!(r&&n&&r(n))},startSpanHook:()=>({[ZT]:"auto.http.otel.node_fetch"})};return t}(e)),Lw=yO(`${Iw}.sentry`,mP,e=>e),ww=(e={})=>({name:"NodeFetch",setupOnce(){const t=function(e,t={}){return"boolean"==typeof e.spans?e.spans:!t.skipOpenTelemetrySetup&&Vb(t)}(e,DT()?.getOptions());t&&Pw(e),Lw(e)}});var Mw={},xw={},kw={};Object.defineProperty(kw,"__esModule",{value:!0}),kw.PACKAGE_NAME=kw.PACKAGE_VERSION=void 0,kw.PACKAGE_VERSION="0.23.0",kw.PACKAGE_NAME="@opentelemetry/instrumentation-fs";var Gw={};Object.defineProperty(Gw,"__esModule",{value:!0}),Gw.SYNC_FUNCTIONS=Gw.CALLBACK_FUNCTIONS=Gw.PROMISE_FUNCTIONS=void 0,Gw.PROMISE_FUNCTIONS=["access","appendFile","chmod","chown","copyFile","cp","lchown","link","lstat","lutimes","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"],Gw.CALLBACK_FUNCTIONS=["access","appendFile","chmod","chown","copyFile","cp","exists","lchown","link","lstat","lutimes","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","realpath.native","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"],Gw.SYNC_FUNCTIONS=["accessSync","appendFileSync","chmodSync","chownSync","copyFileSync","cpSync","existsSync","lchownSync","linkSync","lstatSync","lutimesSync","mkdirSync","mkdtempSync","opendirSync","openSync","readdirSync","readFileSync","readlinkSync","realpathSync","realpathSync.native","renameSync","rmdirSync","rmSync","statSync","symlinkSync","truncateSync","unlinkSync","utimesSync","writeFileSync"];var Dw={};function Vw(e){const t=e.split(".");if(t.length>1){if(2!==t.length)throw Error(`Invalid member function name ${e}`);return t}return[e]}Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.indexFs=Dw.splitTwoLevels=void 0,Dw.splitTwoLevels=Vw,Dw.indexFs=function(e,t){if(!t)throw new Error(JSON.stringify({member:t}));const n=Vw(t),[r,s]=n;return s?{objectToPatch:e[r],functionNameToPatch:s}:{objectToPatch:e,functionNameToPatch:r}},Object.defineProperty(xw,"__esModule",{value:!0}),xw.FsInstrumentation=void 0;const Uw=Ft,Hw=Q_,jw=kS,Zw=kw,Ww=Gw,Xw=s,$w=Dw;function Fw(e,t){return Object.assign(e,t)}class Yw extends jw.InstrumentationBase{constructor(e={}){super(Zw.PACKAGE_NAME,Zw.PACKAGE_VERSION,e)}init(){return[new jw.InstrumentationNodeModuleDefinition("fs",["*"],e=>{for(const t of Ww.SYNC_FUNCTIONS){const{objectToPatch:n,functionNameToPatch:r}=(0,$w.indexFs)(e,t);(0,jw.isWrapped)(n[r])&&this._unwrap(n,r),this._wrap(n,r,this._patchSyncFunction.bind(this,t))}for(const t of Ww.CALLBACK_FUNCTIONS){const{objectToPatch:n,functionNameToPatch:r}=(0,$w.indexFs)(e,t);(0,jw.isWrapped)(n[r])&&this._unwrap(n,r),"exists"!==t?this._wrap(n,r,this._patchCallbackFunction.bind(this,t)):this._wrap(n,r,this._patchExistsCallbackFunction.bind(this,t))}for(const t of Ww.PROMISE_FUNCTIONS)(0,jw.isWrapped)(e.promises[t])&&this._unwrap(e.promises,t),this._wrap(e.promises,t,this._patchPromiseFunction.bind(this,t));return e},e=>{if(void 0!==e){for(const t of Ww.SYNC_FUNCTIONS){const{objectToPatch:n,functionNameToPatch:r}=(0,$w.indexFs)(e,t);(0,jw.isWrapped)(n[r])&&this._unwrap(n,r)}for(const t of Ww.CALLBACK_FUNCTIONS){const{objectToPatch:n,functionNameToPatch:r}=(0,$w.indexFs)(e,t);(0,jw.isWrapped)(n[r])&&this._unwrap(n,r)}for(const t of Ww.PROMISE_FUNCTIONS)(0,jw.isWrapped)(e.promises[t])&&this._unwrap(e.promises,t)}}),new jw.InstrumentationNodeModuleDefinition("fs/promises",["*"],e=>{for(const t of Ww.PROMISE_FUNCTIONS)(0,jw.isWrapped)(e[t])&&this._unwrap(e,t),this._wrap(e,t,this._patchPromiseFunction.bind(this,t));return e},e=>{if(void 0!==e)for(const t of Ww.PROMISE_FUNCTIONS)(0,jw.isWrapped)(e[t])&&this._unwrap(e,t)})]}_patchSyncFunction(e,t){const n=this;return Fw(function(...r){const s=Uw.context.active();if(!n._shouldTrace(s))return t.apply(this,r);if(!1===n._runCreateHook(e,{args:r}))return Uw.context.with((0,Hw.suppressTracing)(s),t,this,...r);const o=n.tracer.startSpan(`fs ${e}`);try{const i=Uw.context.with((0,Hw.suppressTracing)(Uw.trace.setSpan(s,o)),t,this,...r);return n._runEndHook(e,{args:r,span:o}),i}catch(t){throw o.recordException(t),o.setStatus({message:t.message,code:Uw.SpanStatusCode.ERROR}),n._runEndHook(e,{args:r,span:o,error:t}),t}finally{o.end()}},t)}_patchCallbackFunction(e,t){const n=this;return Fw(function(...r){const s=Uw.context.active();if(!n._shouldTrace(s))return t.apply(this,r);if(!1===n._runCreateHook(e,{args:r}))return Uw.context.with((0,Hw.suppressTracing)(s),t,this,...r);const o=r.length-1,i=r[o];if("function"!=typeof i)return t.apply(this,r);{const a=n.tracer.startSpan(`fs ${e}`);r[o]=Uw.context.bind(s,function(t){return t&&(a.recordException(t),a.setStatus({message:t.message,code:Uw.SpanStatusCode.ERROR})),n._runEndHook(e,{args:r,span:a,error:t}),a.end(),i.apply(this,arguments)});try{return Uw.context.with((0,Hw.suppressTracing)(Uw.trace.setSpan(s,a)),t,this,...r)}catch(t){throw a.recordException(t),a.setStatus({message:t.message,code:Uw.SpanStatusCode.ERROR}),n._runEndHook(e,{args:r,span:a,error:t}),a.end(),t}}},t)}_patchExistsCallbackFunction(e,t){const n=this,r=Fw(function(...r){const s=Uw.context.active();if(!n._shouldTrace(s))return t.apply(this,r);if(!1===n._runCreateHook(e,{args:r}))return Uw.context.with((0,Hw.suppressTracing)(s),t,this,...r);const o=r.length-1,i=r[o];if("function"!=typeof i)return t.apply(this,r);{const a=n.tracer.startSpan(`fs ${e}`);r[o]=Uw.context.bind(s,function(){return n._runEndHook(e,{args:r,span:a}),a.end(),i.apply(this,arguments)});try{return Uw.context.with((0,Hw.suppressTracing)(Uw.trace.setSpan(s,a)),t,this,...r)}catch(t){throw a.recordException(t),a.setStatus({message:t.message,code:Uw.SpanStatusCode.ERROR}),n._runEndHook(e,{args:r,span:a,error:t}),a.end(),t}}},t),s=function(e){return new Promise(t=>r(e,t))};return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(r,Xw.promisify.custom,{value:s}),r}_patchPromiseFunction(e,t){const n=this;return Fw(async function(...r){const s=Uw.context.active();if(!n._shouldTrace(s))return t.apply(this,r);if(!1===n._runCreateHook(e,{args:r}))return Uw.context.with((0,Hw.suppressTracing)(s),t,this,...r);const o=n.tracer.startSpan(`fs ${e}`);try{const i=await Uw.context.with((0,Hw.suppressTracing)(Uw.trace.setSpan(s,o)),t,this,...r);return n._runEndHook(e,{args:r,span:o}),i}catch(t){throw o.recordException(t),o.setStatus({message:t.message,code:Uw.SpanStatusCode.ERROR}),n._runEndHook(e,{args:r,span:o,error:t}),t}finally{o.end()}},t)}_runCreateHook(...e){const{createHook:t}=this.getConfig();if("function"==typeof t)try{return t(...e)}catch(e){this._diag.error("caught createHook error",e)}return!0}_runEndHook(...e){const{endHook:t}=this.getConfig();if("function"==typeof t)try{t(...e)}catch(e){this._diag.error("caught endHook error",e)}}_shouldTrace(e){if((0,Hw.isTracingSuppressed)(e))return!1;const{requireParentSpan:t}=this.getConfig();if(t){if(null==Uw.trace.getSpan(e))return!1}return!0}}xw.FsInstrumentation=Yw,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FsInstrumentation=void 0;var t=xw;Object.defineProperty(e,"FsInstrumentation",{enumerable:!0,get:function(){return t.FsInstrumentation}})}(Mw);const Bw="FileSystem",Kw=(e={})=>({name:Bw,setupOnce(){yO(Bw,()=>new Mw.FsInstrumentation({requireParentSpan:!0,endHook(t,{args:n,span:r,error:s}){r.updateName(`fs.${t}`),r.setAttributes({[jT]:"file",[ZT]:"auto.file.fs"}),e.recordErrorMessagesAsSpanAttributes&&("string"==typeof n[0]&&tM.includes(t)?r.setAttribute("path_argument",n[0]):"string"==typeof n[0]&&"string"==typeof n[1]&&eM.includes(t)?(r.setAttribute("target_argument",n[0]),r.setAttribute("path_argument",n[1])):"string"==typeof n[0]&&qw.includes(t)?r.setAttribute("prefix_argument",n[0]):"string"==typeof n[0]&&"string"==typeof n[1]&&Qw.includes(t)?(r.setAttribute("existing_path_argument",n[0]),r.setAttribute("new_path_argument",n[1])):"string"==typeof n[0]&&"string"==typeof n[1]&&zw.includes(t)?(r.setAttribute("src_argument",n[0]),r.setAttribute("dest_argument",n[1])):"string"==typeof n[0]&&"string"==typeof n[1]&&Jw.includes(t)&&(r.setAttribute("old_path_argument",n[0]),r.setAttribute("new_path_argument",n[1]))),s&&e.recordErrorMessagesAsSpanAttributes&&r.setAttribute("fs_error",s.message)}}))()}}),Jw=["rename","renameSync"],zw=["copyFile","cp","copyFileSync","cpSync"],Qw=["link","linkSync"],qw=["mkdtemp","mkdtempSync"],eM=["symlink","symlinkSync"],tM=["access","appendFile","chmod","chown","exists","mkdir","lchown","lstat","lutimes","open","opendir","readdir","readFile","readlink","realpath","realpath.native","rm","rmdir","stat","truncate","unlink","utimes","writeFile","accessSync","appendFileSync","chmodSync","chownSync","existsSync","lchownSync","lstatSync","lutimesSync","opendirSync","mkdirSync","openSync","readdirSync","readFileSync","readlinkSync","realpathSync","realpathSync.native","rmdirSync","rmSync","statSync","truncateSync","unlinkSync","utimesSync","writeFileSync"];var nM={},rM={},sM={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExpressLayerType=void 0,function(e){e.ROUTER="router",e.MIDDLEWARE="middleware",e.REQUEST_HANDLER="request_handler"}(e.ExpressLayerType||(e.ExpressLayerType={}))}(sM);var oM={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.EXPRESS_TYPE="express.type",e.EXPRESS_NAME="express.name"}(e.AttributeNames||(e.AttributeNames={}))}(oM);var iM={},aM={};Object.defineProperty(aM,"__esModule",{value:!0}),aM._LAYERS_STORE_PROPERTY=aM.kLayerPatched=void 0,aM.kLayerPatched=Symbol("express-layer-patched"),aM._LAYERS_STORE_PROPERTY="__ot_middlewares",function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getActualMatchedRoute=e.getConstructedRoute=e.getLayerPath=e.asErrorAndMessage=e.isLayerIgnored=e.getLayerMetadata=e.getRouterPath=e.storeLayerPath=void 0;const t=sM,n=oM,r=aM;e.storeLayerPath=(e,t)=>(!1===Array.isArray(e[r._LAYERS_STORE_PROPERTY])&&Object.defineProperty(e,r._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),void 0===t?{isLayerPathStored:!1}:(e[r._LAYERS_STORE_PROPERTY].push(t),{isLayerPathStored:!0}));e.getRouterPath=(t,n)=>{const r=n.handle?.stack?.[0];return r?.route?.path?`${t}${r.route.path}`:r?.handle?.stack?(0,e.getRouterPath)(t,r):t};e.getLayerMetadata=(r,s,o)=>{if("router"===s.name){const i=(0,e.getRouterPath)("",s),a=i||(o||r||"/");return{attributes:{[n.AttributeNames.EXPRESS_NAME]:a,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.ROUTER},name:`router - ${a}`}}return"bound dispatch"===s.name||"handle"===s.name?{attributes:{[n.AttributeNames.EXPRESS_NAME]:(r||o)??"request handler",[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.REQUEST_HANDLER},name:"request handler"+(s.path?` - ${r||o}`:"")}:{attributes:{[n.AttributeNames.EXPRESS_NAME]:s.name,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.MIDDLEWARE},name:`middleware - ${s.name}`}};const s=(e,t)=>{if("string"==typeof t)return t===e;if(t instanceof RegExp)return t.test(e);if("function"==typeof t)return t(e);throw new TypeError("Pattern is in unsupported datatype")};e.isLayerIgnored=(e,t,n)=>{if(Array.isArray(n?.ignoreLayersType)&&n?.ignoreLayersType?.includes(t))return!0;if(!1===Array.isArray(n?.ignoreLayers))return!1;try{for(const t of n.ignoreLayers)if(s(e,t))return!0}catch(e){}return!1};e.asErrorAndMessage=e=>e instanceof Error?[e,e.message]:[String(e),String(e)];e.getLayerPath=e=>{const t=e[0];return Array.isArray(t)?t.map(e=>o(e)||"").join(","):o(t)};const o=e=>"string"==typeof e?e:e instanceof RegExp||"number"==typeof e?e.toString():void 0;function i(e){const t=(Array.isArray(e[r._LAYERS_STORE_PROPERTY])?e[r._LAYERS_STORE_PROPERTY]:[]).filter(e=>"/"!==e&&"/*"!==e);return 1===t.length&&"*"===t[0]?"*":t.join("").replace(/\/{2,}/g,"/")}e.getConstructedRoute=i,e.getActualMatchedRoute=function(e){const t=Array.isArray(e[r._LAYERS_STORE_PROPERTY])?e[r._LAYERS_STORE_PROPERTY]:[];if(0===t.length)return;if(t.every(e=>"/"===e))return"/"===e.originalUrl?"/":void 0;const n=i(e);if("*"===n)return n;if(n.includes("/")&&(n.includes(",")||n.includes("\\")||n.includes("*")||n.includes("[")))return n;const s=n.startsWith("/")?n:`/${n}`;var o;return s.length>0&&(e.originalUrl===s||e.originalUrl.startsWith(s)||((o=s).includes(":")||o.includes("*")))?s:void 0}}(iM);var cM={};Object.defineProperty(cM,"__esModule",{value:!0}),cM.PACKAGE_NAME=cM.PACKAGE_VERSION=void 0,cM.PACKAGE_VERSION="0.52.0",cM.PACKAGE_NAME="@opentelemetry/instrumentation-express",Object.defineProperty(rM,"__esModule",{value:!0}),rM.ExpressInstrumentation=void 0;const uM=Q_,lM=Ft,pM=sM,dM=oM,hM=iM,mM=cM,fM=kS,_M=GS,gM=aM;class EM extends fM.InstrumentationBase{constructor(e={}){super(mM.PACKAGE_NAME,mM.PACKAGE_VERSION,e)}init(){return[new fM.InstrumentationNodeModuleDefinition("express",[">=4.0.0 <6"],e=>{const t="function"==typeof e?.Router?.prototype?.route,n=t?e.Router.prototype:e.Router;return(0,fM.isWrapped)(n.route)&&this._unwrap(n,"route"),this._wrap(n,"route",this._getRoutePatch()),(0,fM.isWrapped)(n.use)&&this._unwrap(n,"use"),this._wrap(n,"use",this._getRouterUsePatch()),(0,fM.isWrapped)(e.application.use)&&this._unwrap(e.application,"use"),this._wrap(e.application,"use",this._getAppUsePatch(t)),e},e=>{if(void 0===e)return;const t="function"==typeof e?.Router?.prototype?.route?e.Router.prototype:e.Router;this._unwrap(t,"route"),this._unwrap(t,"use"),this._unwrap(e.application,"use")})]}_getRoutePatch(){const e=this;return function(t){return function(...n){const r=t.apply(this,n),s=this.stack[this.stack.length-1];return e._applyPatch(s,(0,hM.getLayerPath)(n)),r}}}_getRouterUsePatch(){const e=this;return function(t){return function(...n){const r=t.apply(this,n),s=this.stack[this.stack.length-1];return e._applyPatch(s,(0,hM.getLayerPath)(n)),r}}}_getAppUsePatch(e){const t=this;return function(n){return function(...r){const s=e?this.router:this._router,o=n.apply(this,r);if(s){const e=s.stack[s.stack.length-1];t._applyPatch(e,(0,hM.getLayerPath)(r))}return o}}}_applyPatch(e,t){const n=this;!0!==e[gM.kLayerPatched]&&(e[gM.kLayerPatched]=!0,this._wrap(e,"handle",r=>{if(4===r.length)return r;const s=function(s,o){const{isLayerPathStored:i}=(0,hM.storeLayerPath)(s,t),a=(0,hM.getConstructedRoute)(s),c=(0,hM.getActualMatchedRoute)(s),u={[_M.ATTR_HTTP_ROUTE]:c},l=(0,hM.getLayerMetadata)(a,e,t),p=l.attributes[dM.AttributeNames.EXPRESS_TYPE],d=(0,uM.getRPCMetadata)(lM.context.active());if(d?.type===uM.RPCType.HTTP&&(d.route=c),(0,hM.isLayerIgnored)(l.name,p,n.getConfig()))return p===pM.ExpressLayerType.MIDDLEWARE&&s[gM._LAYERS_STORE_PROPERTY].pop(),r.apply(this,arguments);if(void 0===lM.trace.getSpan(lM.context.active()))return r.apply(this,arguments);const h=n._getSpanName({request:s,layerType:p,route:a},l.name),m=n.tracer.startSpan(h,{attributes:Object.assign(u,l.attributes)}),f=lM.context.active();let _=lM.trace.setSpan(f,m);const{requestHook:g}=n.getConfig();g&&(0,fM.safeExecuteInTheMiddle)(()=>g(m,{request:s,layerType:p,route:a}),e=>{e&&lM.diag.error("express instrumentation: request hook failed",e)},!0);let E=!1;l.attributes[dM.AttributeNames.EXPRESS_TYPE]===pM.ExpressLayerType.ROUTER&&(m.end(),E=!0,_=f);const S=()=>{!1===E&&(E=!0,m.end())},y=Array.from(arguments),T=y.findIndex(e=>"function"==typeof e);T>=0&&(arguments[T]=function(){const e=arguments[0],t=![void 0,null,"route","router"].includes(e);if(!E&&t){const[t,n]=(0,hM.asErrorAndMessage)(e);m.recordException(t),m.setStatus({code:lM.SpanStatusCode.ERROR,message:n})}!1===E&&(E=!0,s.res?.removeListener("finish",S),m.end()),s.route&&t||!i||s[gM._LAYERS_STORE_PROPERTY].pop();const n=y[T];return lM.context.bind(f,n).apply(this,arguments)});try{return lM.context.bind(_,r).apply(this,arguments)}catch(e){const[t,n]=(0,hM.asErrorAndMessage)(e);throw m.recordException(t),m.setStatus({code:lM.SpanStatusCode.ERROR,message:n}),e}finally{E||o.once("finish",S)}};for(const e in r)Object.defineProperty(s,e,{get:()=>r[e],set(t){r[e]=t}});return s}))}_getSpanName(e,t){const{spanNameHook:n}=this.getConfig();if(!(n instanceof Function))return t;try{return n(e,t)??t}catch(e){return lM.diag.error("express instrumentation: error calling span name rewrite hook",e),t}}}rM.ExpressInstrumentation=EM,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.ExpressLayerType=e.ExpressInstrumentation=void 0;var t=rM;Object.defineProperty(e,"ExpressInstrumentation",{enumerable:!0,get:function(){return t.ExpressInstrumentation}});var n=sM;Object.defineProperty(e,"ExpressLayerType",{enumerable:!0,get:function(){return n.ExpressLayerType}});var r=oM;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return r.AttributeNames}})}(nM);const SM="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,yM="Express";const TM=yO(yM,()=>new nM.ExpressInstrumentation({requestHook:e=>function(e){iw(e,"auto.http.otel.express");const t=Nb(e).data,n=t["express.type"];n&&e.setAttribute(jT,`${n}.express`);const r=t["express.name"];"string"==typeof r&&e.updateName(r)}(e),spanNameHook:(e,t)=>function(e,t){if(MT()===vT())return SM&&yy.warn("Isolation scope is still default isolation scope - skipping setting transactionName"),t;if("request_handler"===e.layerType){const t=e.request,n=t.method?t.method.toUpperCase():"GET";MT().setTransactionName(`${n} ${e.route}`)}return t}(e,t)})),bM=()=>({name:yM,setupOnce(){TM()}});function AM(e){return function(t,n,r,s){const o=WR(n);MT().setSDKProcessingMetadata({normalizedRequest:o});if((e?.shouldHandleError||RM)(t)){const e=XA(t,{mechanism:{type:"middleware",handled:!1}});r.sentry=e}s(t)}}function RM(e){const t=function(e){const t=e.status||e.statusCode||e.status_code||e.output?.statusCode;return t?parseInt(t,10):500}(e);return t>=500}var vM=NM;function NM(e,t,n){e instanceof RegExp&&(e=CM(e,n)),t instanceof RegExp&&(t=CM(t,n));var r=OM(e,t,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+e.length,r[1]),post:n.slice(r[1]+t.length)}}function CM(e,t){var n=t.match(e);return n?n[0]:null}function OM(e,t,n){var r,s,o,i,a,c=n.indexOf(e),u=n.indexOf(t,c+1),l=c;if(c>=0&&u>0){if(e===t)return[c,u];for(r=[],o=n.length;l>=0&&!a;)l==c?(r.push(l),c=n.indexOf(e,l+1)):1==r.length?a=[r.pop(),u]:((s=r.pop())<o&&(o=s,i=u),u=n.indexOf(t,l+1)),l=c<u&&c>=0?c:u;r.length&&(a=[o,i])}return a}NM.range=OM;var IM=vM,PM=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return WM(function(e){return e.split("\\\\").join(LM).split("\\{").join(wM).split("\\}").join(MM).split("\\,").join(xM).split("\\.").join(kM)}(e),!0).map(DM)},LM="\0SLASH"+Math.random()+"\0",wM="\0OPEN"+Math.random()+"\0",MM="\0CLOSE"+Math.random()+"\0",xM="\0COMMA"+Math.random()+"\0",kM="\0PERIOD"+Math.random()+"\0";function GM(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function DM(e){return e.split(LM).join("\\").split(wM).join("{").split(MM).join("}").split(xM).join(",").split(kM).join(".")}function VM(e){if(!e)return[""];var t=[],n=IM("{","}",e);if(!n)return e.split(",");var r=n.pre,s=n.body,o=n.post,i=r.split(",");i[i.length-1]+="{"+s+"}";var a=VM(o);return o.length&&(i[i.length-1]+=a.shift(),i.push.apply(i,a)),t.push.apply(t,i),t}function UM(e){return"{"+e+"}"}function HM(e){return/^-?0\d/.test(e)}function jM(e,t){return e<=t}function ZM(e,t){return e>=t}function WM(e,t){var n=[],r=IM("{","}",e);if(!r)return[e];var s=r.pre,o=r.post.length?WM(r.post,!1):[""];if(/\$$/.test(r.pre))for(var i=0;i<o.length;i++){var a=s+"{"+r.body+"}"+o[i];n.push(a)}else{var c,u,l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),d=l||p,h=r.body.indexOf(",")>=0;if(!d&&!h)return r.post.match(/,(?!,).*\}/)?WM(e=r.pre+"{"+r.body+MM+r.post):[e];if(d)c=r.body.split(/\.\./);else if(1===(c=VM(r.body)).length&&1===(c=WM(c[0],!1).map(UM)).length)return o.map(function(e){return r.pre+c[0]+e});if(d){var m=GM(c[0]),f=GM(c[1]),_=Math.max(c[0].length,c[1].length),g=3==c.length?Math.abs(GM(c[2])):1,E=jM;f<m&&(g*=-1,E=ZM);var S=c.some(HM);u=[];for(var y=m;E(y,f);y+=g){var T;if(p)"\\"===(T=String.fromCharCode(y))&&(T="");else if(T=String(y),S){var b=_-T.length;if(b>0){var A=new Array(b+1).join("0");T=y<0?"-"+A+T.slice(1):A+T}}u.push(T)}}else{u=[];for(var R=0;R<c.length;R++)u.push.apply(u,WM(c[R],!1))}for(R=0;R<u.length;R++)for(i=0;i<o.length;i++){a=s+u[R]+o[i];(!t||d||a)&&n.push(a)}}return n}var XM=Zt(PM);const $M=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},FM={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},YM=e=>e.replace(/[[\]\\-]/g,"\\$&"),BM=e=>e.join(""),KM=(e,t)=>{const n=t;if("["!==e.charAt(n))throw new Error("not in a brace expression");const r=[],s=[];let o=n+1,i=!1,a=!1,c=!1,u=!1,l=n,p="";e:for(;o<e.length;){const t=e.charAt(o);if("!"!==t&&"^"!==t||o!==n+1){if("]"===t&&i&&!c){l=o+1;break}if(i=!0,"\\"!==t||c){if("["===t&&!c)for(const[t,[i,c,u]]of Object.entries(FM))if(e.startsWith(t,o)){if(p)return["$.",!1,e.length-n,!0];o+=t.length,u?s.push(i):r.push(i),a=a||c;continue e}c=!1,p?(t>p?r.push(YM(p)+"-"+YM(t)):t===p&&r.push(YM(t)),p="",o++):e.startsWith("-]",o+1)?(r.push(YM(t+"-")),o+=2):e.startsWith("-",o+1)?(p=t,o+=2):(r.push(YM(t)),o++)}else c=!0,o++}else u=!0,o++}if(l<o)return["",!1,0,!1];if(!r.length&&!s.length)return["$.",!1,e.length-n,!0];if(0===s.length&&1===r.length&&/^\\?.$/.test(r[0])&&!u){const e=2===r[0].length?r[0].slice(-1):r[0];return[(d=e,d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,l-n,!1]}var d;const h="["+(u?"^":"")+BM(r)+"]",m="["+(u?"":"^")+BM(s)+"]";return[r.length&&s.length?"("+h+"|"+m+")":r.length?h:m,a,l-n,!0]},JM=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),zM=new Set(["!","?","+","*","@"]),QM=e=>zM.has(e),qM="(?!\\.)",ex=new Set(["[","."]),tx=new Set(["..","."]),nx=new Set("().*{}+?[]^$\\!"),rx=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),sx="[^/]",ox=sx+"*?",ix=sx+"+?";class ax{type;#e;#t;#n=!1;#r=[];#s;#o;#i;#a=!1;#c;#u;#l=!1;constructor(e,t,n={}){this.type=e,e&&(this.#t=!0),this.#s=t,this.#e=this.#s?this.#s.#e:this,this.#c=this.#e===this?n:this.#e.#c,this.#i=this.#e===this?[]:this.#e.#i,"!"!==e||this.#e.#a||this.#i.push(this),this.#o=this.#s?this.#s.#r.length:0}get hasMagic(){if(void 0!==this.#t)return this.#t;for(const e of this.#r)if("string"!=typeof e&&(e.type||e.hasMagic))return this.#t=!0;return this.#t}toString(){return void 0!==this.#u?this.#u:this.type?this.#u=this.type+"("+this.#r.map(e=>String(e)).join("|")+")":this.#u=this.#r.map(e=>String(e)).join("")}#p(){if(this!==this.#e)throw new Error("should only call on root");if(this.#a)return this;let e;for(this.toString(),this.#a=!0;e=this.#i.pop();){if("!"!==e.type)continue;let t=e,n=t.#s;for(;n;){for(let r=t.#o+1;!n.type&&r<n.#r.length;r++)for(const t of e.#r){if("string"==typeof t)throw new Error("string part in extglob AST??");t.copyIn(n.#r[r])}t=n,n=t.#s}}return this}push(...e){for(const t of e)if(""!==t){if("string"!=typeof t&&!(t instanceof ax&&t.#s===this))throw new Error("invalid part: "+t);this.#r.push(t)}}toJSON(){const e=null===this.type?this.#r.slice().map(e=>"string"==typeof e?e:e.toJSON()):[this.type,...this.#r.map(e=>e.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#a&&"!"===this.#s?.type)&&e.push({}),e}isStart(){if(this.#e===this)return!0;if(!this.#s?.isStart())return!1;if(0===this.#o)return!0;const e=this.#s;for(let t=0;t<this.#o;t++){const n=e.#r[t];if(!(n instanceof ax&&"!"===n.type))return!1}return!0}isEnd(){if(this.#e===this)return!0;if("!"===this.#s?.type)return!0;if(!this.#s?.isEnd())return!1;if(!this.type)return this.#s?.isEnd();const e=this.#s?this.#s.#r.length:0;return this.#o===e-1}copyIn(e){"string"==typeof e?this.push(e):this.push(e.clone(this))}clone(e){const t=new ax(this.type,e);for(const e of this.#r)t.copyIn(e);return t}static#d(e,t,n,r){let s=!1,o=!1,i=-1,a=!1;if(null===t.type){let c=n,u="";for(;c<e.length;){const n=e.charAt(c++);if(s||"\\"===n)s=!s,u+=n;else if(o)c===i+1?"^"!==n&&"!"!==n||(a=!0):"]"!==n||c===i+2&&a||(o=!1),u+=n;else if("["!==n){if(!r.noext&&QM(n)&&"("===e.charAt(c)){t.push(u),u="";const s=new ax(n,t);c=ax.#d(e,s,c,r),t.push(s);continue}u+=n}else o=!0,i=c,a=!1,u+=n}return t.push(u),c}let c=n+1,u=new ax(null,t);const l=[];let p="";for(;c<e.length;){const n=e.charAt(c++);if(s||"\\"===n)s=!s,p+=n;else if(o)c===i+1?"^"!==n&&"!"!==n||(a=!0):"]"!==n||c===i+2&&a||(o=!1),p+=n;else if("["!==n){if(QM(n)&&"("===e.charAt(c)){u.push(p),p="";const t=new ax(n,u);u.push(t),c=ax.#d(e,t,c,r);continue}if("|"!==n){if(")"===n)return""===p&&0===t.#r.length&&(t.#l=!0),u.push(p),p="",t.push(...l,u),c;p+=n}else u.push(p),p="",l.push(u),u=new ax(null,t)}else o=!0,i=c,a=!1,p+=n}return t.type=null,t.#t=void 0,t.#r=[e.substring(n-1)],c}static fromGlob(e,t={}){const n=new ax(null,void 0,t);return ax.#d(e,n,0,t),n}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();const e=this.toString(),[t,n,r,s]=this.toRegExpSource();if(!(r||this.#t||this.#c.nocase&&!this.#c.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;const o=(this.#c.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${t}$`,o),{_src:t,_glob:e})}get options(){return this.#c}toRegExpSource(e){const t=e??!!this.#c.dot;if(this.#e===this&&this.#p(),!this.type){const n=this.isStart()&&this.isEnd(),r=this.#r.map(t=>{const[r,s,o,i]="string"==typeof t?ax.#h(t,this.#t,n):t.toRegExpSource(e);return this.#t=this.#t||o,this.#n=this.#n||i,r}).join("");let s="";if(this.isStart()&&"string"==typeof this.#r[0]){if(!(1===this.#r.length&&tx.has(this.#r[0]))){const n=ex,o=t&&n.has(r.charAt(0))||r.startsWith("\\.")&&n.has(r.charAt(2))||r.startsWith("\\.\\.")&&n.has(r.charAt(4)),i=!t&&!e&&n.has(r.charAt(0));s=o?"(?!(?:^|/)\\.\\.?(?:$|/))":i?qM:""}}let o="";this.isEnd()&&this.#e.#a&&"!"===this.#s?.type&&(o="(?:$|\\/)");return[s+r+o,JM(r),this.#t=!!this.#t,this.#n]}const n="*"===this.type||"+"===this.type,r="!"===this.type?"(?:(?!(?:":"(?:";let s=this.#m(t);if(this.isStart()&&this.isEnd()&&!s&&"!"!==this.type){const e=this.toString();return this.#r=[e],this.type=null,this.#t=void 0,[e,JM(this.toString()),!1,!1]}let o=!n||e||t?"":this.#m(!0);o===s&&(o=""),o&&(s=`(?:${s})(?:${o})*?`);let i="";if("!"===this.type&&this.#l)i=(this.isStart()&&!t?qM:"")+ix;else{i=r+s+("!"===this.type?"))"+(!this.isStart()||t||e?"":qM)+ox+")":"@"===this.type?")":"?"===this.type?")?":"+"===this.type&&o?")":"*"===this.type&&o?")?":`)${this.type}`)}return[i,JM(s),this.#t=!!this.#t,this.#n]}#m(e){return this.#r.map(t=>{if("string"==typeof t)throw new Error("string type in extglob ast??");const[n,r,s,o]=t.toRegExpSource(e);return this.#n=this.#n||o,n}).filter(e=>!(this.isStart()&&this.isEnd()&&!e)).join("|")}static#h(e,t,n=!1){let r=!1,s="",o=!1;for(let i=0;i<e.length;i++){const a=e.charAt(i);if(r)r=!1,s+=(nx.has(a)?"\\":"")+a;else if("\\"!==a){if("["===a){const[n,r,a,c]=KM(e,i);if(a){s+=n,o=o||r,i+=a-1,t=t||c;continue}}"*"!==a?"?"!==a?s+=rx(a):(s+=sx,t=!0):(s+=n&&"*"===e?ix:ox,t=!0)}else i===e.length-1?s+="\\\\":r=!0}return[s,JM(e),!!t,o]}}const cx=(e,t,n={})=>($M(t),!(!n.nocomment&&"#"===t.charAt(0))&&new xx(t,n).match(e)),ux=/^\*+([^+@!?\*\[\(]*)$/,lx=e=>t=>!t.startsWith(".")&&t.endsWith(e),px=e=>t=>t.endsWith(e),dx=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),hx=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),mx=/^\*+\.\*+$/,fx=e=>!e.startsWith(".")&&e.includes("."),_x=e=>"."!==e&&".."!==e&&e.includes("."),gx=/^\.\*+$/,Ex=e=>"."!==e&&".."!==e&&e.startsWith("."),Sx=/^\*+$/,yx=e=>0!==e.length&&!e.startsWith("."),Tx=e=>0!==e.length&&"."!==e&&".."!==e,bx=/^\?+([^+@!?\*\[\(]*)?$/,Ax=([e,t=""])=>{const n=Cx([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},Rx=([e,t=""])=>{const n=Ox([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},vx=([e,t=""])=>{const n=Ox([e]);return t?e=>n(e)&&e.endsWith(t):n},Nx=([e,t=""])=>{const n=Cx([e]);return t?e=>n(e)&&e.endsWith(t):n},Cx=([e])=>{const t=e.length;return e=>e.length===t&&!e.startsWith(".")},Ox=([e])=>{const t=e.length;return e=>e.length===t&&"."!==e&&".."!==e},Ix="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";cx.sep="win32"===Ix?{sep:"\\"}.sep:{sep:"/"}.sep;const Px=Symbol("globstar **");cx.GLOBSTAR=Px;cx.filter=(e,t={})=>n=>cx(n,e,t);const Lx=(e,t={})=>Object.assign({},e,t);cx.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return cx;const t=cx;return Object.assign((n,r,s={})=>t(n,r,Lx(e,s)),{Minimatch:class extends t.Minimatch{constructor(t,n={}){super(t,Lx(e,n))}static defaults(n){return t.defaults(Lx(e,n)).Minimatch}},AST:class extends t.AST{constructor(t,n,r={}){super(t,n,Lx(e,r))}static fromGlob(n,r={}){return t.AST.fromGlob(n,Lx(e,r))}},unescape:(n,r={})=>t.unescape(n,Lx(e,r)),escape:(n,r={})=>t.escape(n,Lx(e,r)),filter:(n,r={})=>t.filter(n,Lx(e,r)),defaults:n=>t.defaults(Lx(e,n)),makeRe:(n,r={})=>t.makeRe(n,Lx(e,r)),braceExpand:(n,r={})=>t.braceExpand(n,Lx(e,r)),match:(n,r,s={})=>t.match(n,r,Lx(e,s)),sep:t.sep,GLOBSTAR:Px})};const wx=(e,t={})=>($M(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:XM(e));cx.braceExpand=wx;cx.makeRe=(e,t={})=>new xx(e,t).makeRe();cx.match=(e,t,n={})=>{const r=new xx(t,n);return e=e.filter(e=>r.match(e)),r.options.nonull&&!e.length&&e.push(t),e};const Mx=/[?*]|[+@!]\(.*?\)|\[|\]/;class xx{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){$M(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Ix,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||!1===t.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==t.windowsNoMagicRoot?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if("string"!=typeof t)return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,this.globSet);const n=this.globSet.map(e=>this.slashSplit(e));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let r=this.globParts.map((e,t,n)=>{if(this.isWindows&&this.windowsNoMagicRoot){const t=!(""!==e[0]||""!==e[1]||"?"!==e[2]&&Mx.test(e[2])||Mx.test(e[3])),n=/^[a-z]:/i.test(e[0]);if(t)return[...e.slice(0,4),...e.slice(4).map(e=>this.parse(e))];if(n)return[e[0],...e.slice(1).map(e=>this.parse(e))]}return e.map(e=>this.parse(e))});if(this.debug(this.pattern,r),this.set=r.filter(e=>-1===e.indexOf(!1)),this.isWindows)for(let e=0;e<this.set.length;e++){const t=this.set[e];""===t[0]&&""===t[1]&&"?"===this.globParts[e][2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3])&&(t[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++)"**"===e[t][n]&&(e[t][n]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(e=>{let t=-1;for(;-1!==(t=e.indexOf("**",t+1));){let n=t;for(;"**"===e[n+1];)n++;n!==t&&e.splice(t,n-t)}return e})}levelOneOptimize(e){return e.map(e=>0===(e=e.reduce((e,t)=>{const n=e[e.length-1];return"**"===t&&"**"===n?e:".."===t&&n&&".."!==n&&"."!==n&&"**"!==n?(e.pop(),e):(e.push(t),e)},[])).length?[""]:e)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let n=1;n<e.length-1;n++){const r=e[n];1===n&&""===r&&""===e[0]||("."!==r&&""!==r||(t=!0,e.splice(n,1),n--))}"."!==e[0]||2!==e.length||"."!==e[1]&&""!==e[1]||(t=!0,e.pop())}let n=0;for(;-1!==(n=e.indexOf("..",n+1));){const r=e[n-1];r&&"."!==r&&".."!==r&&"**"!==r&&(t=!0,e.splice(n-1,2),n-=2)}}while(t);return 0===e.length?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let n of e){let r=-1;for(;-1!==(r=n.indexOf("**",r+1));){let s=r;for(;"**"===n[s+1];)s++;s>r&&n.splice(r+1,s-r);let o=n[r+1];const i=n[r+2],a=n[r+3];if(".."!==o)continue;if(!i||"."===i||".."===i||!a||"."===a||".."===a)continue;t=!0,n.splice(r,1);const c=n.slice(0);c[r]="**",e.push(c),r--}if(!this.preserveMultipleSlashes){for(let e=1;e<n.length-1;e++){const r=n[e];1===e&&""===r&&""===n[0]||("."!==r&&""!==r||(t=!0,n.splice(e,1),e--))}"."!==n[0]||2!==n.length||"."!==n[1]&&""!==n[1]||(t=!0,n.pop())}let s=0;for(;-1!==(s=n.indexOf("..",s+1));){const e=n[s-1];if(e&&"."!==e&&".."!==e&&"**"!==e){t=!0;const e=1===s&&"**"===n[s+1]?["."]:[];n.splice(s-1,2,...e),0===n.length&&n.push(""),s-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let n=t+1;n<e.length;n++){const r=this.partsMatch(e[t],e[n],!this.preserveMultipleSlashes);if(r){e[t]=[],e[n]=r;break}}return e.filter(e=>e.length)}partsMatch(e,t,n=!1){let r=0,s=0,o=[],i="";for(;r<e.length&&s<t.length;)if(e[r]===t[s])o.push("b"===i?t[s]:e[r]),r++,s++;else if(n&&"**"===e[r]&&t[s]===e[r+1])o.push(e[r]),r++;else if(n&&"**"===t[s]&&e[r]===t[s+1])o.push(t[s]),s++;else if("*"!==e[r]||!t[s]||!this.options.dot&&t[s].startsWith(".")||"**"===t[s]){if("*"!==t[s]||!e[r]||!this.options.dot&&e[r].startsWith(".")||"**"===e[r])return!1;if("a"===i)return!1;i="b",o.push(t[s]),r++,s++}else{if("b"===i)return!1;i="a",o.push(e[r]),r++,s++}return e.length===t.length&&o}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,n=0;for(let r=0;r<e.length&&"!"===e.charAt(r);r++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n=!1){const r=this.options;if(this.isWindows){const n="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),r=!n&&""===e[0]&&""===e[1]&&"?"===e[2]&&/^[a-z]:$/i.test(e[3]),s="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),o=r?3:n?0:void 0,i=!s&&""===t[0]&&""===t[1]&&"?"===t[2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3])?3:s?0:void 0;if("number"==typeof o&&"number"==typeof i){const[n,r]=[e[o],t[i]];n.toLowerCase()===r.toLowerCase()&&(t[i]=n,i>o?t=t.slice(i):o>i&&(e=e.slice(o)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var o=0,i=0,a=e.length,c=t.length;o<a&&i<c;o++,i++){this.debug("matchOne loop");var u=t[i],l=e[o];if(this.debug(t,u,l),!1===u)return!1;if(u===Px){this.debug("GLOBSTAR",[t,u,l]);var p=o,d=i+1;if(d===c){for(this.debug("** at the end");o<a;o++)if("."===e[o]||".."===e[o]||!r.dot&&"."===e[o].charAt(0))return!1;return!0}for(;p<a;){var h=e[p];if(this.debug("\nglobstar while",e,p,t,d,h),this.matchOne(e.slice(p),t.slice(d),n))return this.debug("globstar found match!",p,a,h),!0;if("."===h||".."===h||!r.dot&&"."===h.charAt(0)){this.debug("dot detected!",e,p,t,d);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!n||(this.debug("\n>>> no match, partial?",e,p,t,d),p!==a))}let s;if("string"==typeof u?(s=l===u,this.debug("string match",u,l,s)):(s=u.test(l),this.debug("pattern match",u,l,s)),!s)return!1}if(o===a&&i===c)return!0;if(o===a)return n;if(i===c)return o===a-1&&""===e[o];throw new Error("wtf?")}braceExpand(){return wx(this.pattern,this.options)}parse(e){$M(e);const t=this.options;if("**"===e)return Px;if(""===e)return"";let n,r=null;(n=e.match(Sx))?r=t.dot?Tx:yx:(n=e.match(ux))?r=(t.nocase?t.dot?hx:dx:t.dot?px:lx)(n[1]):(n=e.match(bx))?r=(t.nocase?t.dot?Rx:Ax:t.dot?vx:Nx)(n):(n=e.match(mx))?r=t.dot?_x:fx:(n=e.match(gx))&&(r=Ex);const s=ax.fromGlob(e,this.options).toMMPattern();return r&&"object"==typeof s&&Reflect.defineProperty(s,"test",{value:r}),s}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,n=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=new Set(t.nocase?["i"]:[]);let s=e.map(e=>{const t=e.map(e=>{if(e instanceof RegExp)for(const t of e.flags.split(""))r.add(t);return"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===Px?Px:e._src});return t.forEach((e,r)=>{const s=t[r+1],o=t[r-1];e===Px&&o!==Px&&(void 0===o?void 0!==s&&s!==Px?t[r+1]="(?:\\/|"+n+"\\/)?"+s:t[r]=n:void 0===s?t[r-1]=o+"(?:\\/|"+n+")?":s!==Px&&(t[r-1]=o+"(?:\\/|\\/"+n+"\\/)"+s,t[r+1]=Px))}),t.filter(e=>e!==Px).join("/")}).join("|");const[o,i]=e.length>1?["(?:",")"]:["",""];s="^"+o+s+i+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...r].join(""))}catch(e){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const n=this.options;this.isWindows&&(e=e.split("\\").join("/"));const r=this.slashSplit(e);this.debug(this.pattern,"split",r);const s=this.set;this.debug(this.pattern,"set",s);let o=r[r.length-1];if(!o)for(let e=r.length-2;!o&&e>=0;e--)o=r[e];for(let e=0;e<s.length;e++){const i=s[e];let a=r;n.matchBase&&1===i.length&&(a=[o]);if(this.matchOne(a,i,t))return!!n.flipNegate||!this.negate}return!n.flipNegate&&this.negate}static defaults(e){return cx.defaults(e).Minimatch}}cx.AST=ax,cx.Minimatch=xx,cx.escape=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),cx.unescape=JM;const kx="@fastify/otel",Gx=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],Dx="hook.name",Vx="fastify.type",Ux="hook.callback.name",Hx="fastify.root",jx="route-hook",Zx="hook",Wx="request-handler",Xx="anonymous",$x=Symbol("fastify otel instance"),Fx=Symbol("fastify otel request spans"),Yx=Symbol("fastify otel request context"),Bx=Symbol("fastify otel addhook original"),Kx=Symbol("fastify otel setnotfound original"),Jx=Symbol("fastify otel ignore path");class zx extends IS{constructor(e){if(super(kx,"0.8.0",e),this.servername=e?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[Jx]=null,this._logger=At.createComponentLogger({namespace:kx}),null!=e?.ignorePaths||null!=process.env.OTEL_FASTIFY_IGNORE_PATHS){const t=e?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if(("string"!=typeof t||0===t.length)&&"function"!=typeof t)throw new TypeError("ignorePaths must be a string or a function");const n=cx;this[Jx]=e=>"function"==typeof t?t(e):n(e.url,t)}}enable(){if(void 0===this._handleInitialization&&this.getConfig().registerOnInitialization){const e=this.plugin();this._handleInitialization=t=>{t.fastify.register(e)},p.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){return this._handleInitialization&&(p.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0),super.disable()}init(){return[]}plugin(){const e=this;return t[Symbol.for("skip-override")]=!0,t[Symbol.for("fastify.display-name")]="@fastify/otel",t[Symbol.for("plugin-meta")]={fastify:">=4.0.0 <6",name:"@fastify/otel"},t;function t(t,n,r){function s(e,t,n,r){const s=e[Fx];null!=s&&(t.statusCode<500&&s.setStatus({code:dt.OK,message:"OK"}),s.setAttributes({[$f]:t.statusCode}),s.end()),e[Fx]=null,r(null,n)}function o(e,t,n,r){const s=e[Fx];null!=s&&(s.setStatus({code:dt.ERROR,message:n.message}),s.recordException(n)),r()}function i(e,t={}){return function(...n){const r=this[$x],[s]=n;if(!1===r.isEnabled())return e.call(this,...n);const o=s[Yx]??bt.active(),i=r.tracer.startSpan(`handler - ${e.name?.length>0?e.name:this.pluginName??Xx}`,{attributes:t},o);return bt.with(Ht.setSpan(o,i),function(){try{const t=e.call(this,...n);return"function"==typeof t?.then?t.then(e=>(i.end(),e),e=>(i.setStatus({code:dt.ERROR,message:e.message}),i.recordException(e),i.end(),Promise.reject(e))):(i.end(),t)}catch(e){throw i.setStatus({code:dt.ERROR,message:e.message}),i.recordException(e),i.end(),e}},this)}}t.decorate($x,e),t.decorate(Bx,t.addHook),t.decorate(Kx,t.setNotFoundHandler),t.decorateRequest("opentelemetry",function(){const t=this[Yx];return{span:this[Fx],tracer:e.tracer,context:t,inject:(e,n)=>Dt.inject(t,e,n),extract:(e,n)=>Dt.extract(t,e,n)}}),t.decorateRequest(Fx,null),t.decorateRequest(Yx,null),t.addHook("onRoute",function(n){if(!0!==e[Jx]?.(n)){for(const e of Gx)if(null!=n[e]){const r=n[e];if("function"==typeof r)n[e]=i(r,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - route -> ${e}`,[Vx]:jx,[Ff]:n.url,[Ux]:r.name?.length>0?r.name:Xx});else if(Array.isArray(r)){const s=[];for(const o of r)s.push(i(o,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - route -> ${e}`,[Vx]:jx,[Ff]:n.url,[Ux]:o.name?.length>0?o.name:Xx}));n[e]=s}}null!=n.onSend?n.onSend=Array.isArray(n.onSend)?[...n.onSend,s]:[n.onSend,s]:n.onSend=s,null!=n.onError?n.onError=Array.isArray(n.onError)?[...n.onError,o]:[n.onError,o]:n.onError=o,n.handler=i(n.handler,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - route-handler`,[Vx]:Wx,[Ff]:n.url,[Ux]:n.handler.name.length>0?n.handler.name:Xx})}else e._logger.debug(`Ignoring route instrumentation ${n.method} ${n.url} because it matches the ignore path`)}),t.addHook("onRequest",function(e,n,r){if(!1===this[$x].isEnabled())return r();if(!0===this[$x][Jx]?.({url:e.url,method:e.method}))return this[$x]._logger.debug(`Ignoring request ${e.method} ${e.url} because it matches the ignore path`),r();let s=bt.active();null==Ht.getSpan(s)&&(s=Dt.extract(s,e.headers));const o=N_(s);null!=e.routeOptions.url&&o?.type===v_.HTTP&&(o.route=e.routeOptions.url);const i=this[$x].tracer.startSpan("request",{attributes:{[Kf]:t[$x].servername,[Hx]:"@fastify/otel",[Ff]:e.url,[Xf]:e.method}},s);e[Yx]=Ht.setSpan(s,i),e[Fx]=i,bt.with(e[Yx],()=>{r()})}),t.addHook("onResponse",function(e,t,n){const r=e[Fx];null!=r&&(r.setStatus({code:dt.OK,message:"OK"}),r.setAttributes({[$f]:404}),r.end()),e[Fx]=null,n()}),t.addHook=function(e,n){const r=this[Bx];return Gx.includes(e)?r.call(this,e,i(n,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - ${e}`,[Vx]:Zx,[Ux]:n.name?.length>0?n.name:Xx})):r.call(this,e,n)},t.setNotFoundHandler=function(e,n){const r=this[Kx];"function"==typeof e?(n=i(e,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - not-found-handler`,[Vx]:Zx,[Ux]:e.name?.length>0?e.name:Xx}),r.call(this,n)):(null!=e.preValidation&&(e.preValidation=i(e.preValidation,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - not-found-handler - preValidation`,[Vx]:Zx,[Ux]:e.preValidation.name?.length>0?e.preValidation.name:Xx})),null!=e.preHandler&&(e.preHandler=i(e.preHandler,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - not-found-handler - preHandler`,[Vx]:Zx,[Ux]:e.preHandler.name?.length>0?e.preHandler.name:Xx})),n=i(n,{[Kf]:t[$x].servername,[Dx]:`${this.pluginName} - not-found-handler`,[Vx]:Zx,[Ux]:n.name?.length>0?n.name:Xx}),r.call(this,e,n))},r()}}}var Qx,qx,ek;!function(e){e.FASTIFY_NAME="fastify.name";e.FASTIFY_TYPE="fastify.type";e.HOOK_NAME="hook.name";e.PLUGIN_NAME="plugin.name"}(Qx||(Qx={})),function(e){e.MIDDLEWARE="middleware";e.REQUEST_HANDLER="request_handler"}(qx||(qx={})),function(e){e.MIDDLEWARE="middleware";e.REQUEST_HANDLER="request handler"}(ek||(ek={}));const tk=Symbol("opentelemetry.instrumentation.fastify.request_active_span");function nk(e,t,n,r={}){const s=t.startSpan(n,{attributes:r}),o=e[tk]||[];return o.push(s),Object.defineProperty(e,tk,{enumerable:!1,configurable:!0,value:o}),s}function rk(e,t){const n=e[tk]||[];n.length&&(n.forEach(e=>{t&&(e.setStatus({code:dt.ERROR,message:t.message}),e.recordException(t)),e.end()}),delete e[tk])}function sk(e){return"object"==typeof e&&e&&"function"==typeof Object.getOwnPropertyDescriptor(e,"then")?.value||!1}const ok="anonymous",ik=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);class ak extends IS{constructor(e={}){super("@sentry/instrumentation-fastify-v3","0.1.0",e)}init(){return[new LS("fastify",[">=3.0.0 <4"],e=>this._patchConstructor(e))]}_hookOnRequest(){const e=this;return function(t,n,r){if(!e.isEnabled())return r();e._wrap(n,"send",e._patchSend());const s=t,o=N_(bt.active()),i=s.routeOptions?s.routeOptions.url:t.routerPath;i&&o?.type===v_.HTTP&&(o.route=i);const a=t.method||"GET";MT().setTransactionName(`${a} ${i}`),r()}}_wrapHandler(e,t,n,r){const s=this;return this._diag.debug("Patching fastify route.handler function"),function(...o){if(!s.isEnabled())return n.apply(this,o);const i=n.name||e||ok,a=`${ek.MIDDLEWARE} - ${i}`,c=o[1],u=nk(c,s.tracer,a,{[Qx.FASTIFY_TYPE]:qx.MIDDLEWARE,[Qx.PLUGIN_NAME]:e,[Qx.HOOK_NAME]:t}),l=r&&o[o.length-1];return l&&(o[o.length-1]=function(...e){rk(c),l.apply(this,e)}),bt.with(Ht.setSpan(bt.active(),u),()=>function(e,t){let n,r;try{r=e(),sk(r)&&r.then(e=>t(void 0,e),e=>t(e))}catch(e){n=e}finally{if(!sk(r)&&(t(n,r),n))throw n;return r}}(()=>n.apply(this,o),e=>{e instanceof Error&&(u.setStatus({code:dt.ERROR,message:e.message}),u.recordException(e)),r||rk(c)}))}}_wrapAddHook(){const e=this;return this._diag.debug("Patching fastify server.addHook function"),function(t){return function(...n){const r=n[0],s=n[1],o=this.pluginName;if(!ik.has(r))return t.apply(this,n);const i="function"==typeof n[n.length-1]&&"AsyncFunction"!==s.constructor.name;return t.apply(this,[r,e._wrapHandler(o,r,s,i)])}}}_patchConstructor(e){const t=this;function n(...n){const r=e.fastify.apply(this,n);return r.addHook("onRequest",t._hookOnRequest()),r.addHook("preHandler",t._hookPreHandler()),function(){const e=DT();e&&e.on("spanStart",e=>{ck(e)})}(),t._wrap(r,"addHook",t._wrapAddHook()),r}return void 0!==e.errorCodes&&(n.errorCodes=e.errorCodes),n.fastify=n,n.default=n,n}_patchSend(){const e=this;return this._diag.debug("Patching fastify reply.send function"),function(t){return function(...n){const r=n[0];return e.isEnabled()?CS(()=>t.apply(this,n),e=>{!e&&r instanceof Error&&(e=r),rk(this,e)}):t.apply(this,n)}}}_hookPreHandler(){const e=this;return this._diag.debug("Patching fastify preHandler function"),function(t,n,r){if(!e.isEnabled())return r();const s=t,o=s.routeOptions?.handler||s.context?.handler,i=o?.name.startsWith("bound ")?o.name.substring(6):o?.name,a=`${ek.REQUEST_HANDLER} - ${i||this.pluginName||ok}`,c={[Qx.PLUGIN_NAME]:this.pluginName,[Qx.FASTIFY_TYPE]:qx.REQUEST_HANDLER,[qo]:s.routeOptions?s.routeOptions.url:t.routerPath};i&&(c[Qx.FASTIFY_NAME]=i);const u=nk(n,e.tracer,a,c);ck(u);const{requestHook:l}=e.getConfig();return l&&CS(()=>l(u,{request:t}),t=>{t&&e._diag.error("request hook failed",t)},!0),bt.with(Ht.setSpan(bt.active(),u),()=>{r()})}}}function ck(e){const t=Nb(e).data,n=t["fastify.type"];if(t[jT]||!n)return;e.setAttributes({[ZT]:"auto.http.otel.fastify",[jT]:`${n}.fastify`});const r=t["fastify.name"]||t["plugin.name"]||t["hook.name"];if("string"==typeof r){const t=r.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(t)}}const uk="Fastify",lk=yO(`${uk}.v3`,()=>new ak);function pk(){const e=DT();return e?e.getIntegrationByName(uk):void 0}function dk(e,t,n,r){const s=pk()?.getShouldHandleError()||fk;"diagnostics-channel"===r&&(this.diagnosticsChannelExists=!0),this.diagnosticsChannelExists&&"onError-hook"===r?SM&&yy.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options."):s(e,t,n)&&XA(e,{mechanism:{handled:!1,type:"fastify"}})}const hk=yO(`${uk}.v5`,()=>{const e=new zx,t=e.plugin();return I.subscribe("fastify.initialization",e=>{const n=e.fastify;n?.register(t).after(e=>{e?SM&&yy.error("Failed to setup Fastify instrumentation",e):(!function(){const e=DT();e&&e.on("spanStart",e=>{_k(e)})}(),n&&n.addHook("onRequest",async(e,t)=>{if(e.opentelemetry){const{span:t}=e.opentelemetry();t&&_k(t)}const n=e.routeOptions?.url,r=e.method||"GET";MT().setTransactionName(`${r} ${n}`)}))})}),I.subscribe("tracing:fastify.request.handler:error",e=>{const{error:t,request:n,reply:r}=e;dk.call(dk,t,n,r,"diagnostics-channel")}),e}),mk=(e={})=>(({shouldHandleError:e})=>{let t;return{name:uk,setupOnce(){t=e||fk,lk(),hk()},getShouldHandleError:()=>t,setShouldHandleError(e){t=e}}})(e);function fk(e,t,n){const r=n.statusCode;return r>=500||r<=299}function _k(e){const t=Nb(e),n=t.description,r=t.data,s=r["fastify.type"],o="hook"===s,i=s===n?.startsWith("handler -"),a="request"===n||"request-handler"===s;if(r[jT]||!i&&!a&&!o)return;const c=o?"hook":i?"middleware":a?"request-handler":"<unknown>";e.setAttributes({[ZT]:"auto.http.otel.fastify",[jT]:`${c}.fastify`});const u=r["fastify.name"]||r["plugin.name"]||r["hook.name"];if("string"==typeof u){const t=u.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(t)}}var gk={},Ek={},Sk={};!function(e){var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=e.TokenKind=e.AllowedOperationTypes=void 0,(t=e.AllowedOperationTypes||(e.AllowedOperationTypes={})).QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription",(n=e.TokenKind||(e.TokenKind={})).SOF="<SOF>",n.EOF="<EOF>",n.BANG="!",n.DOLLAR="$",n.AMP="&",n.PAREN_L="(",n.PAREN_R=")",n.SPREAD="...",n.COLON=":",n.EQUALS="=",n.AT="@",n.BRACKET_L="[",n.BRACKET_R="]",n.BRACE_L="{",n.PIPE="|",n.BRACE_R="}",n.NAME="Name",n.INT="Int",n.FLOAT="Float",n.STRING="String",n.BLOCK_STRING="BlockString",n.COMMENT="Comment",function(e){e.EXECUTE="graphql.execute",e.PARSE="graphql.parse",e.RESOLVE="graphql.resolve",e.VALIDATE="graphql.validate",e.SCHEMA_VALIDATE="graphql.validateSchema",e.SCHEMA_PARSE="graphql.parseSchema"}(e.SpanNames||(e.SpanNames={}))}(Sk);var yk={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.SOURCE="graphql.source",e.FIELD_NAME="graphql.field.name",e.FIELD_PATH="graphql.field.path",e.FIELD_TYPE="graphql.field.type",e.OPERATION_TYPE="graphql.operation.type",e.OPERATION_NAME="graphql.operation.name",e.VARIABLES="graphql.variables.",e.ERROR_VALIDATION_NAME="graphql.validation.error"}(e.AttributeNames||(e.AttributeNames={}))}(yk);var Tk={};Object.defineProperty(Tk,"__esModule",{value:!0}),Tk.OTEL_GRAPHQL_DATA_SYMBOL=Tk.OTEL_PATCHED_SYMBOL=void 0,Tk.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched"),Tk.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data");var bk={};Object.defineProperty(bk,"__esModule",{value:!0}),bk.OPERATION_NOT_SUPPORTED=void 0,bk.OPERATION_NOT_SUPPORTED="Operation$operationName$not supported";var Ak={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapFieldResolver=e.wrapFields=e.getSourceFromLocation=e.getOperation=e.endSpan=e.addSpanSource=e.addInputVariableAttributes=e.isPromise=void 0;const t=Ft,n=Sk,r=yk,s=Tk,o=Object.values(n.AllowedOperationTypes);e.isPromise=e=>"function"==typeof e?.then;function i(e,t,n){Array.isArray(n)?n.forEach((n,r)=>{i(e,`${t}.${r}`,n)}):n instanceof Object?Object.entries(n).forEach(([n,r])=>{i(e,`${t}.${n}`,r)}):e.setAttribute(`${r.AttributeNames.VARIABLES}${String(t)}`,n)}function a(e,t,n,s,o){const i=_(t,n,s,o);e.setAttribute(r.AttributeNames.SOURCE,i)}function c(e,t,n,r,o){let i=l(n,o),a=!1;if(!i){a=!0;const c=p(n,o);i={parent:c,span:u(e,t,n,r,o,c.span),error:null},function(e,t,n){e[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[t.join(".")]=n}(n,o,i)}return{spanAdded:a,field:i}}function u(e,o,i,c,u,l){const p={[r.AttributeNames.FIELD_NAME]:c.fieldName,[r.AttributeNames.FIELD_PATH]:u.join("."),[r.AttributeNames.FIELD_TYPE]:c.returnType.toString()},d=e.startSpan(`${n.SpanNames.RESOLVE} ${p[r.AttributeNames.FIELD_PATH]}`,{attributes:p},l?t.trace.setSpan(t.context.active(),l):void 0),h=i[s.OTEL_GRAPHQL_DATA_SYMBOL].source,m=c.fieldNodes.find(e=>"Field"===e.kind);return m&&a(d,h.loc,o().allowValues,m.loc?.start,m.loc?.end),d}function l(e,t){return e[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[t.join(".")]}function p(e,t){for(let n=t.length-1;n>0;n--){const r=l(e,t.slice(0,n));if(r)return r}return{span:e[s.OTEL_GRAPHQL_DATA_SYMBOL].span}}function d(e){return m("\n",e)}function h(e){return m(" ",e)}function m(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}e.addInputVariableAttributes=function(e,t){Object.entries(t).forEach(([t,n])=>{i(e,t,n)})},e.addSpanSource=a,e.endSpan=function(e,t){t&&e.recordException(t),e.end()},e.getOperation=function(e,t){if(e&&Array.isArray(e.definitions))return t?e.definitions.filter(e=>-1!==o.indexOf(e?.operation)).find(e=>t===e?.name?.value):e.definitions.find(e=>-1!==o.indexOf(e?.operation))};const f=[n.TokenKind.FLOAT,n.TokenKind.STRING,n.TokenKind.INT,n.TokenKind.BLOCK_STRING];function _(e,t=!1,r,s){let o="";if(e?.startToken){const i="number"==typeof r?r:e.start,a="number"==typeof s?s:e.end;let c=e.startToken.next,u=1;for(;c;){if(c.start<i){c=c.next,u=c?.line;continue}if(c.end>a){c=c.next,u=c?.line;continue}let e=c.value||c.kind,r="";!t&&f.indexOf(c.kind)>=0&&(e="*"),c.kind===n.TokenKind.STRING&&(e=`"${e}"`),c.kind===n.TokenKind.EOF&&(e=""),c.line>u?(o+=d(c.line-u),u=c.line,r=h(c.column-1)):c.line===c.prev?.line&&(r=h(c.start-(c.prev?.end||0))),o+=r+e,c&&(c=c.next)}}return o}e.getSourceFromLocation=_,e.wrapFields=function e(t,n,r){if(!t||"function"!=typeof t.getFields||t[s.OTEL_PATCHED_SYMBOL])return;const o=t.getFields();t[s.OTEL_PATCHED_SYMBOL]=!0,Object.keys(o).forEach(t=>{const s=o[t];if(s&&(s.resolve&&(s.resolve=S(n,r,s.resolve)),s.type)){let t=s.type;for(;t.ofType;)t=t.ofType;e(t,n,r)}})};const g=(e,n,r)=>{r&&(e.recordException(n),e.setStatus({code:t.SpanStatusCode.ERROR,message:n.message}),e.end())},E=(e,t)=>{t&&e.end()};function S(n,r,o,i=!1){if(a[s.OTEL_PATCHED_SYMBOL]||"function"!=typeof o)return o;function a(a,u,l,d){if(!o)return;const h=r();if(h.ignoreTrivialResolveSpans&&i&&("object"==typeof(m=a)&&null!==m||"function"==typeof a)){if("function"!=typeof a[d.fieldName])return o.call(this,a,u,l,d)}var m;if(!l[s.OTEL_GRAPHQL_DATA_SYMBOL])return o.call(this,a,u,l,d);const f=function(e,t){const n=[];let r=t;for(;r;){let t=r.key;e&&"number"==typeof t&&(t="*"),n.push(String(t)),r=r.prev}return n.reverse()}(h.mergeItems,d&&d.path),_=f.filter(e=>"string"==typeof e).length;let S,y=!1;if(h.depth>=0&&h.depth<_)S=p(l,f);else{const e=c(n,r,l,d,f);S=e.field,y=e.spanAdded}return t.context.with(t.trace.setSpan(t.context.active(),S.span),()=>{try{const t=o.call(this,a,u,l,d);return(0,e.isPromise)(t)?t.then(e=>(E(S.span,y),e),e=>{throw g(S.span,e,y),e}):(E(S.span,y),t)}catch(e){throw g(S.span,e,y),e}})}return a[s.OTEL_PATCHED_SYMBOL]=!0,a}e.wrapFieldResolver=S}(Ak);var Rk={};Object.defineProperty(Rk,"__esModule",{value:!0}),Rk.PACKAGE_NAME=Rk.PACKAGE_VERSION=void 0,Rk.PACKAGE_VERSION="0.51.0",Rk.PACKAGE_NAME="@opentelemetry/instrumentation-graphql",Object.defineProperty(Ek,"__esModule",{value:!0}),Ek.GraphQLInstrumentation=void 0;const vk=Ft,Nk=kS,Ck=Sk,Ok=yk,Ik=Tk,Pk=bk,Lk=Ak,wk=Rk,Mk={mergeItems:!1,depth:-1,allowValues:!1,ignoreResolveSpans:!1},xk=[">=14.0.0 <17"];class kk extends Nk.InstrumentationBase{constructor(e={}){super(wk.PACKAGE_NAME,wk.PACKAGE_VERSION,{...Mk,...e})}setConfig(e={}){super.setConfig({...Mk,...e})}init(){const e=new Nk.InstrumentationNodeModuleDefinition("graphql",xk);return e.files.push(this._addPatchingExecute()),e.files.push(this._addPatchingParser()),e.files.push(this._addPatchingValidate()),e}_addPatchingExecute(){return new Nk.InstrumentationNodeModuleFile("graphql/execution/execute.js",xk,e=>((0,Nk.isWrapped)(e.execute)&&this._unwrap(e,"execute"),this._wrap(e,"execute",this._patchExecute(e.defaultFieldResolver)),e),e=>{e&&this._unwrap(e,"execute")})}_addPatchingParser(){return new Nk.InstrumentationNodeModuleFile("graphql/language/parser.js",xk,e=>((0,Nk.isWrapped)(e.parse)&&this._unwrap(e,"parse"),this._wrap(e,"parse",this._patchParse()),e),e=>{e&&this._unwrap(e,"parse")})}_addPatchingValidate(){return new Nk.InstrumentationNodeModuleFile("graphql/validation/validate.js",xk,e=>((0,Nk.isWrapped)(e.validate)&&this._unwrap(e,"validate"),this._wrap(e,"validate",this._patchValidate()),e),e=>{e&&this._unwrap(e,"validate")})}_patchExecute(e){const t=this;return function(n){return function(){let r;if(arguments.length>=2){const n=arguments;r=t._wrapExecuteArgs(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],e)}else{const n=arguments[0];r=t._wrapExecuteArgs(n.schema,n.document,n.rootValue,n.contextValue,n.variableValues,n.operationName,n.fieldResolver,n.typeResolver,e)}const s=(0,Lk.getOperation)(r.document,r.operationName),o=t._createExecuteSpan(s,r);return r.contextValue[Ik.OTEL_GRAPHQL_DATA_SYMBOL]={source:r.document?r.document||r.document[Ik.OTEL_GRAPHQL_DATA_SYMBOL]:void 0,span:o,fields:{}},vk.context.with(vk.trace.setSpan(vk.context.active(),o),()=>(0,Nk.safeExecuteInTheMiddle)(()=>n.apply(this,[r]),(e,n)=>{t._handleExecutionResult(o,e,n)}))}}}_handleExecutionResult(e,t,n){const r=this.getConfig();if(void 0===n||t)(0,Lk.endSpan)(e,t);else if((0,Lk.isPromise)(n))n.then(t=>{"function"==typeof r.responseHook?this._executeResponseHook(e,t):(0,Lk.endSpan)(e)},t=>{(0,Lk.endSpan)(e,t)});else{if("function"!=typeof r.responseHook)return void(0,Lk.endSpan)(e);this._executeResponseHook(e,n)}}_executeResponseHook(e,t){const{responseHook:n}=this.getConfig();n&&(0,Nk.safeExecuteInTheMiddle)(()=>{n(e,t)},t=>{t&&this._diag.error("Error running response hook",t),(0,Lk.endSpan)(e,void 0)},!0)}_patchParse(){const e=this;return function(t){return function(n,r){return e._parse(this,t,n,r)}}}_patchValidate(){const e=this;return function(t){return function(n,r,s,o,i){return e._validate(this,t,n,r,s,i,o)}}}_parse(e,t,n,r){const s=this.getConfig(),o=this.tracer.startSpan(Ck.SpanNames.PARSE);return vk.context.with(vk.trace.setSpan(vk.context.active(),o),()=>(0,Nk.safeExecuteInTheMiddle)(()=>t.call(e,n,r),(e,t)=>{if(t){(0,Lk.getOperation)(t)?t.loc&&(0,Lk.addSpanSource)(o,t.loc,s.allowValues):o.updateName(Ck.SpanNames.SCHEMA_PARSE)}(0,Lk.endSpan)(o,e)}))}_validate(e,t,n,r,s,o,i){const a=this.tracer.startSpan(Ck.SpanNames.VALIDATE,{});return vk.context.with(vk.trace.setSpan(vk.context.active(),a),()=>(0,Nk.safeExecuteInTheMiddle)(()=>t.call(e,n,r,s,i,o),(e,t)=>{r.loc||a.updateName(Ck.SpanNames.SCHEMA_VALIDATE),t&&t.length&&a.recordException({name:Ok.AttributeNames.ERROR_VALIDATION_NAME,message:JSON.stringify(t)}),(0,Lk.endSpan)(a,e)}))}_createExecuteSpan(e,t){const n=this.getConfig(),r=this.tracer.startSpan(Ck.SpanNames.EXECUTE,{});if(e){const{operation:t,name:n}=e;r.setAttribute(Ok.AttributeNames.OPERATION_TYPE,t);const s=n?.value;s?(r.setAttribute(Ok.AttributeNames.OPERATION_NAME,s),r.updateName(`${t} ${s}`)):r.updateName(t)}else{let e=" ";t.operationName&&(e=` "${t.operationName}" `),e=Pk.OPERATION_NOT_SUPPORTED.replace("$operationName$",e),r.setAttribute(Ok.AttributeNames.OPERATION_NAME,e)}return t.document?.loc&&(0,Lk.addSpanSource)(r,t.document.loc,n.allowValues),t.variableValues&&n.allowValues&&(0,Lk.addInputVariableAttributes)(r,t.variableValues),r}_wrapExecuteArgs(e,t,n,r,s,o,i,a,c){if(r||(r={}),r[Ik.OTEL_GRAPHQL_DATA_SYMBOL]||this.getConfig().ignoreResolveSpans)return{schema:e,document:t,rootValue:n,contextValue:r,variableValues:s,operationName:o,fieldResolver:i,typeResolver:a};const u=null==i,l=i??c;return i=(0,Lk.wrapFieldResolver)(this.tracer,()=>this.getConfig(),l,u),e&&((0,Lk.wrapFields)(e.getQueryType(),this.tracer,()=>this.getConfig()),(0,Lk.wrapFields)(e.getMutationType(),this.tracer,()=>this.getConfig())),{schema:e,document:t,rootValue:n,contextValue:r,variableValues:s,operationName:o,fieldResolver:i,typeResolver:a}}}Ek.GraphQLInstrumentation=kk,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLInstrumentation=void 0;var t=Ek;Object.defineProperty(e,"GraphQLInstrumentation",{enumerable:!0,get:function(){return t.GraphQLInstrumentation}})}(gk);const Gk="Graphql",Dk=yO(Gk,gk.GraphQLInstrumentation,e=>{const t=Uk(e);return{...t,responseHook(e,n){iw(e,"auto.graphql.otel.graphql");const r=n;r.errors?.length&&!Nb(e).status&&e.setStatus({code:dt.ERROR});const s=Nb(e).data,o=s["graphql.operation.type"],i=s["graphql.operation.name"];if(t.useOperationNameForRootSpan&&o){const t=Mb(e),n=Nb(t).data[zO]||[],r=i?`${o} ${i}`:`${o}`;Array.isArray(n)?(n.push(r),t.setAttribute(zO,n)):"string"==typeof n?t.setAttribute(zO,[n,r]):t.setAttribute(zO,r),Nb(t).data["original-description"]||t.setAttribute("original-description",Nb(t).description),t.updateName(`${Nb(t).data["original-description"]} (${function(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}(n)})`)}}}}),Vk=(e={})=>({name:Gk,setupOnce(){Dk(Uk(e))}});function Uk(e){return{ignoreResolveSpans:!0,ignoreTrivialResolveSpans:!0,useOperationNameForRootSpan:!0,...e}}var Hk={},jk={},Zk={};Object.defineProperty(Zk,"__esModule",{value:!0}),Zk.EVENT_LISTENERS_SET=void 0,Zk.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet");var Wk={};Object.defineProperty(Wk,"__esModule",{value:!0}),Wk.bufferTextMapGetter=void 0,Wk.bufferTextMapGetter={get(e,t){if(!e)return;const n=Object.keys(e);for(const r of n)if(r===t||r.toLowerCase()===t)return e[r]?.toString()},keys:e=>e?Object.keys(e):[]};var Xk={};Object.defineProperty(Xk,"__esModule",{value:!0}),Xk.METRIC_MESSAGING_PROCESS_DURATION=Xk.METRIC_MESSAGING_CLIENT_SENT_MESSAGES=Xk.METRIC_MESSAGING_CLIENT_OPERATION_DURATION=Xk.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES=Xk.MESSAGING_SYSTEM_VALUE_KAFKA=Xk.MESSAGING_OPERATION_TYPE_VALUE_SEND=Xk.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE=Xk.MESSAGING_OPERATION_TYPE_VALUE_PROCESS=Xk.ATTR_MESSAGING_SYSTEM=Xk.ATTR_MESSAGING_OPERATION_TYPE=Xk.ATTR_MESSAGING_OPERATION_NAME=Xk.ATTR_MESSAGING_KAFKA_OFFSET=Xk.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE=Xk.ATTR_MESSAGING_KAFKA_MESSAGE_KEY=Xk.ATTR_MESSAGING_DESTINATION_PARTITION_ID=Xk.ATTR_MESSAGING_DESTINATION_NAME=Xk.ATTR_MESSAGING_BATCH_MESSAGE_COUNT=void 0,Xk.ATTR_MESSAGING_BATCH_MESSAGE_COUNT="messaging.batch.message_count",Xk.ATTR_MESSAGING_DESTINATION_NAME="messaging.destination.name",Xk.ATTR_MESSAGING_DESTINATION_PARTITION_ID="messaging.destination.partition.id",Xk.ATTR_MESSAGING_KAFKA_MESSAGE_KEY="messaging.kafka.message.key",Xk.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE="messaging.kafka.message.tombstone",Xk.ATTR_MESSAGING_KAFKA_OFFSET="messaging.kafka.offset",Xk.ATTR_MESSAGING_OPERATION_NAME="messaging.operation.name",Xk.ATTR_MESSAGING_OPERATION_TYPE="messaging.operation.type",Xk.ATTR_MESSAGING_SYSTEM="messaging.system",Xk.MESSAGING_OPERATION_TYPE_VALUE_PROCESS="process",Xk.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE="receive",Xk.MESSAGING_OPERATION_TYPE_VALUE_SEND="send",Xk.MESSAGING_SYSTEM_VALUE_KAFKA="kafka",Xk.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES="messaging.client.consumed.messages",Xk.METRIC_MESSAGING_CLIENT_OPERATION_DURATION="messaging.client.operation.duration",Xk.METRIC_MESSAGING_CLIENT_SENT_MESSAGES="messaging.client.sent.messages",Xk.METRIC_MESSAGING_PROCESS_DURATION="messaging.process.duration";var $k={};Object.defineProperty($k,"__esModule",{value:!0}),$k.PACKAGE_NAME=$k.PACKAGE_VERSION=void 0,$k.PACKAGE_VERSION="0.13.0",$k.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs",Object.defineProperty(jk,"__esModule",{value:!0}),jk.KafkaJsInstrumentation=void 0;const Fk=Ft,Yk=kS,Bk=GS,Kk=Zk,Jk=Wk,zk=Xk,Qk=$k;function qk(e,t,n){return r=>{e.add(t,{...n,...r?{[Bk.ATTR_ERROR_TYPE]:r}:{}})}}function eG(e,t,n){return r=>{e.record((Date.now()-t)/1e3,{...n,...r?{[Bk.ATTR_ERROR_TYPE]:r}:{}})}}const tG=[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10];class nG extends Yk.InstrumentationBase{constructor(e={}){super(Qk.PACKAGE_NAME,Qk.PACKAGE_VERSION,e)}_updateMetricInstruments(){this._clientDuration=this.meter.createHistogram(zk.METRIC_MESSAGING_CLIENT_OPERATION_DURATION,{advice:{explicitBucketBoundaries:tG}}),this._sentMessages=this.meter.createCounter(zk.METRIC_MESSAGING_CLIENT_SENT_MESSAGES),this._consumedMessages=this.meter.createCounter(zk.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES),this._processDuration=this.meter.createHistogram(zk.METRIC_MESSAGING_PROCESS_DURATION,{advice:{explicitBucketBoundaries:tG}})}init(){const e=e=>{(0,Yk.isWrapped)(e?.Kafka?.prototype.producer)&&this._unwrap(e.Kafka.prototype,"producer"),(0,Yk.isWrapped)(e?.Kafka?.prototype.consumer)&&this._unwrap(e.Kafka.prototype,"consumer")};return new Yk.InstrumentationNodeModuleDefinition("kafkajs",[">=0.3.0 <3"],t=>(e(t),this._wrap(t?.Kafka?.prototype,"producer",this._getProducerPatch()),this._wrap(t?.Kafka?.prototype,"consumer",this._getConsumerPatch()),t),e)}_getConsumerPatch(){const e=this;return t=>function(...n){const r=t.apply(this,n);return(0,Yk.isWrapped)(r.run)&&e._unwrap(r,"run"),e._wrap(r,"run",e._getConsumerRunPatch()),e._setKafkaEventListeners(r),r}}_setKafkaEventListeners(e){e[Kk.EVENT_LISTENERS_SET]||(e.events?.REQUEST&&e.on(e.events.REQUEST,this._recordClientDurationMetric.bind(this)),e[Kk.EVENT_LISTENERS_SET]=!0)}_recordClientDurationMetric(e){const[t,n]=e.payload.broker.split(":");this._clientDuration.record(e.payload.duration/1e3,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:`${e.payload.apiName}`,[Bk.ATTR_SERVER_ADDRESS]:t,[Bk.ATTR_SERVER_PORT]:Number.parseInt(n,10)})}_getProducerPatch(){const e=this;return t=>function(...n){const r=t.apply(this,n);return(0,Yk.isWrapped)(r.sendBatch)&&e._unwrap(r,"sendBatch"),e._wrap(r,"sendBatch",e._getSendBatchPatch()),(0,Yk.isWrapped)(r.send)&&e._unwrap(r,"send"),e._wrap(r,"send",e._getSendPatch()),(0,Yk.isWrapped)(r.transaction)&&e._unwrap(r,"transaction"),e._wrap(r,"transaction",e._getProducerTransactionPatch()),e._setKafkaEventListeners(r),r}}_getConsumerRunPatch(){const e=this;return t=>function(...n){const r=n[0];return r?.eachMessage&&((0,Yk.isWrapped)(r.eachMessage)&&e._unwrap(r,"eachMessage"),e._wrap(r,"eachMessage",e._getConsumerEachMessagePatch())),r?.eachBatch&&((0,Yk.isWrapped)(r.eachBatch)&&e._unwrap(r,"eachBatch"),e._wrap(r,"eachBatch",e._getConsumerEachBatchPatch())),t.call(this,r)}}_getConsumerEachMessagePatch(){const e=this;return t=>function(...n){const r=n[0],s=Fk.propagation.extract(Fk.ROOT_CONTEXT,r.message.headers,Jk.bufferTextMapGetter),o=e._startConsumerSpan({topic:r.topic,message:r.message,operationType:zk.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,ctx:s,attributes:{[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)}}),i=[eG(e._processDuration,Date.now(),{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"process",[zk.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)}),qk(e._consumedMessages,1,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"process",[zk.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.partition)})],a=Fk.context.with(Fk.trace.setSpan(s,o),()=>t.apply(this,n));return e._endSpansOnPromise([o],i,a)}}_getConsumerEachBatchPatch(){return e=>{const t=this;return function(...n){const r=n[0],s=t._startConsumerSpan({topic:r.batch.topic,message:void 0,operationType:zk.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE,ctx:Fk.ROOT_CONTEXT,attributes:{[zk.ATTR_MESSAGING_BATCH_MESSAGE_COUNT]:r.batch.messages.length,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}});return Fk.context.with(Fk.trace.setSpan(Fk.context.active(),s),()=>{const o=Date.now(),i=[],a=[qk(t._consumedMessages,r.batch.messages.length,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"process",[zk.ATTR_MESSAGING_DESTINATION_NAME]:r.batch.topic,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)})];r.batch.messages.forEach(e=>{const n=Fk.propagation.extract(Fk.ROOT_CONTEXT,e.headers,Jk.bufferTextMapGetter),s=Fk.trace.getSpan(n)?.spanContext();let c;s&&(c={context:s}),i.push(t._startConsumerSpan({topic:r.batch.topic,message:e,operationType:zk.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,link:c,attributes:{[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}})),a.push(eG(t._processDuration,o,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"process",[zk.ATTR_MESSAGING_DESTINATION_NAME]:r.batch.topic,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(r.batch.partition)}))});const c=e.apply(this,n);return i.unshift(s),t._endSpansOnPromise(i,a,c)})}}}_getProducerTransactionPatch(){const e=this;return t=>function(...n){const r=e.tracer.startSpan("transaction"),s=t.apply(this,n);return s.then(t=>{const n=t.send;t.send=function(...t){return Fk.context.with(Fk.trace.setSpan(Fk.context.active(),r),()=>e._getSendPatch()(n).apply(this,t).catch(e=>{throw r.setStatus({code:Fk.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),e}))};const s=t.sendBatch;t.sendBatch=function(...t){return Fk.context.with(Fk.trace.setSpan(Fk.context.active(),r),()=>e._getSendBatchPatch()(s).apply(this,t).catch(e=>{throw r.setStatus({code:Fk.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),e}))};const o=t.commit;t.commit=function(...t){const n=o.apply(this,t).then(()=>{r.setStatus({code:Fk.SpanStatusCode.OK})});return e._endSpansOnPromise([r],[],n)};const i=t.abort;t.abort=function(...t){const n=i.apply(this,t);return e._endSpansOnPromise([r],[],n)}}).catch(e=>{r.setStatus({code:Fk.SpanStatusCode.ERROR,message:e?.message}),r.recordException(e),r.end()}),s}}_getSendBatchPatch(){const e=this;return t=>function(...n){const r=n[0].topicMessages||[],s=[],o=[];r.forEach(t=>{t.messages.forEach(n=>{s.push(e._startProducerSpan(t.topic,n)),o.push(qk(e._sentMessages,1,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"send",[zk.ATTR_MESSAGING_DESTINATION_NAME]:t.topic,...void 0!==n.partition?{[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(n.partition)}:{}}))})});const i=t.apply(this,n);return e._endSpansOnPromise(s,o,i)}}_getSendPatch(){const e=this;return t=>function(...n){const r=n[0],s=r.messages.map(t=>e._startProducerSpan(r.topic,t)),o=r.messages.map(t=>qk(e._sentMessages,1,{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_OPERATION_NAME]:"send",[zk.ATTR_MESSAGING_DESTINATION_NAME]:r.topic,...void 0!==t.partition?{[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(t.partition)}:{}})),i=t.apply(this,n);return e._endSpansOnPromise(s,o,i)}}_endSpansOnPromise(e,t,n){return Promise.resolve(n).then(e=>(t.forEach(e=>e()),e)).catch(n=>{let r,s=Bk.ERROR_TYPE_VALUE_OTHER;throw"string"==typeof n||void 0===n?r=n:"object"==typeof n&&Object.prototype.hasOwnProperty.call(n,"message")&&(r=n.message,s=n.constructor.name),t.forEach(e=>e(s)),e.forEach(e=>{e.setAttribute(Bk.ATTR_ERROR_TYPE,s),e.setStatus({code:Fk.SpanStatusCode.ERROR,message:r})}),n}).finally(()=>{e.forEach(e=>e.end())})}_startConsumerSpan({topic:e,message:t,operationType:n,ctx:r,link:s,attributes:o}){const i=n===zk.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?"poll":n,a=this.tracer.startSpan(`${i} ${e}`,{kind:n===zk.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?Fk.SpanKind.CLIENT:Fk.SpanKind.CONSUMER,attributes:{...o,[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_DESTINATION_NAME]:e,[zk.ATTR_MESSAGING_OPERATION_TYPE]:n,[zk.ATTR_MESSAGING_OPERATION_NAME]:i,[zk.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:t?.key?String(t.key):void 0,[zk.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:!(!t?.key||null!==t.value)||void 0,[zk.ATTR_MESSAGING_KAFKA_OFFSET]:t?.offset},links:s?[s]:[]},r),{consumerHook:c}=this.getConfig();return c&&t&&(0,Yk.safeExecuteInTheMiddle)(()=>c(a,{topic:e,message:t}),e=>{e&&this._diag.error("consumerHook error",e)},!0),a}_startProducerSpan(e,t){const n=this.tracer.startSpan(`send ${e}`,{kind:Fk.SpanKind.PRODUCER,attributes:{[zk.ATTR_MESSAGING_SYSTEM]:zk.MESSAGING_SYSTEM_VALUE_KAFKA,[zk.ATTR_MESSAGING_DESTINATION_NAME]:e,[zk.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:t.key?String(t.key):void 0,[zk.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:!(!t.key||null!==t.value)||void 0,[zk.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:void 0!==t.partition?String(t.partition):void 0,[zk.ATTR_MESSAGING_OPERATION_NAME]:"send",[zk.ATTR_MESSAGING_OPERATION_TYPE]:zk.MESSAGING_OPERATION_TYPE_VALUE_SEND}});t.headers=t.headers??{},Fk.propagation.inject(Fk.trace.setSpan(Fk.context.active(),n),t.headers);const{producerHook:r}=this.getConfig();return r&&(0,Yk.safeExecuteInTheMiddle)(()=>r(n,{topic:e,message:t}),e=>{e&&this._diag.error("producerHook error",e)},!0),n}}jk.KafkaJsInstrumentation=nG,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KafkaJsInstrumentation=void 0;var t=jk;Object.defineProperty(e,"KafkaJsInstrumentation",{enumerable:!0,get:function(){return t.KafkaJsInstrumentation}})}(Hk);const rG="Kafka",sG=yO(rG,()=>new Hk.KafkaJsInstrumentation({consumerHook(e){iw(e,"auto.kafkajs.otel.consumer")},producerHook(e){iw(e,"auto.kafkajs.otel.producer")}})),oG=()=>({name:rG,setupOnce(){sG()}});var iG={},aG={},cG={};Object.defineProperty(cG,"__esModule",{value:!0}),cG.PACKAGE_NAME=cG.PACKAGE_VERSION=void 0,cG.PACKAGE_VERSION="0.48.0",cG.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer",Object.defineProperty(aG,"__esModule",{value:!0}),aG.LruMemoizerInstrumentation=void 0;const uG=Ft,lG=kS,pG=cG;class dG extends lG.InstrumentationBase{constructor(e={}){super(pG.PACKAGE_NAME,pG.PACKAGE_VERSION,e)}init(){return[new lG.InstrumentationNodeModuleDefinition("lru-memoizer",[">=1.3 <3"],e=>{const t=function(){const t=e.apply(this,arguments);return function(){const e=[...arguments],n=e.pop(),r="function"==typeof n?uG.context.bind(uG.context.active(),n):n;return e.push(r),t.apply(this,e)}};return t.sync=e.sync,t},void 0)]}}aG.LruMemoizerInstrumentation=dG,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LruMemoizerInstrumentation=void 0;var t=aG;Object.defineProperty(e,"LruMemoizerInstrumentation",{enumerable:!0,get:function(){return t.LruMemoizerInstrumentation}})}(iG);const hG="LruMemoizer",mG=yO(hG,()=>new iG.LruMemoizerInstrumentation),fG=()=>({name:hG,setupOnce(){mG()}});var _G={},gG={},EG={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(t=e.MongodbCommandType||(e.MongodbCommandType={})).CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.AGGREGATE="aggregate",t.UNKNOWN="unknown"}(EG);var SG={};Object.defineProperty(SG,"__esModule",{value:!0}),SG.PACKAGE_NAME=SG.PACKAGE_VERSION=void 0,SG.PACKAGE_VERSION="0.56.0",SG.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb",Object.defineProperty(gG,"__esModule",{value:!0}),gG.MongoDBInstrumentation=void 0;const yG=Ft,TG=kS,bG=GS,AG=EG,RG=SG,vG={requireParentSpan:!0};class NG extends TG.InstrumentationBase{constructor(e={}){super(RG.PACKAGE_NAME,RG.PACKAGE_VERSION,{...vG,...e})}setConfig(e={}){super.setConfig({...vG,...e})}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter("db.client.connections.usage",{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){const{v3PatchConnection:e,v3UnpatchConnection:t}=this._getV3ConnectionPatches(),{v4PatchConnect:n,v4UnpatchConnect:r}=this._getV4ConnectPatches(),{v4PatchConnectionCallback:s,v4PatchConnectionPromise:o,v4UnpatchConnection:i}=this._getV4ConnectionPatches(),{v4PatchConnectionPool:a,v4UnpatchConnectionPool:c}=this._getV4ConnectionPoolPatches(),{v4PatchSessions:u,v4UnpatchSessions:l}=this._getV4SessionsPatches();return[new TG.InstrumentationNodeModuleDefinition("mongodb",[">=3.3.0 <4"],void 0,void 0,[new TG.InstrumentationNodeModuleFile("mongodb/lib/core/wireprotocol/index.js",[">=3.3.0 <4"],e,t)]),new TG.InstrumentationNodeModuleDefinition("mongodb",[">=4.0.0 <7"],void 0,void 0,[new TG.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=4.0.0 <6.4"],s,i),new TG.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=6.4.0 <7"],o,i),new TG.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection_pool.js",[">=4.0.0 <6.4"],a,c),new TG.InstrumentationNodeModuleFile("mongodb/lib/cmap/connect.js",[">=4.0.0 <7"],n,r),new TG.InstrumentationNodeModuleFile("mongodb/lib/sessions.js",[">=4.0.0 <7"],u,l)])]}_getV3ConnectionPatches(){return{v3PatchConnection:e=>((0,TG.isWrapped)(e.insert)&&this._unwrap(e,"insert"),this._wrap(e,"insert",this._getV3PatchOperation("insert")),(0,TG.isWrapped)(e.remove)&&this._unwrap(e,"remove"),this._wrap(e,"remove",this._getV3PatchOperation("remove")),(0,TG.isWrapped)(e.update)&&this._unwrap(e,"update"),this._wrap(e,"update",this._getV3PatchOperation("update")),(0,TG.isWrapped)(e.command)&&this._unwrap(e,"command"),this._wrap(e,"command",this._getV3PatchCommand()),(0,TG.isWrapped)(e.query)&&this._unwrap(e,"query"),this._wrap(e,"query",this._getV3PatchFind()),(0,TG.isWrapped)(e.getMore)&&this._unwrap(e,"getMore"),this._wrap(e,"getMore",this._getV3PatchCursor()),e),v3UnpatchConnection:e=>{void 0!==e&&(this._unwrap(e,"insert"),this._unwrap(e,"remove"),this._unwrap(e,"update"),this._unwrap(e,"command"),this._unwrap(e,"query"),this._unwrap(e,"getMore"))}}}_getV4SessionsPatches(){return{v4PatchSessions:e=>((0,TG.isWrapped)(e.acquire)&&this._unwrap(e,"acquire"),this._wrap(e.ServerSessionPool.prototype,"acquire",this._getV4AcquireCommand()),(0,TG.isWrapped)(e.release)&&this._unwrap(e,"release"),this._wrap(e.ServerSessionPool.prototype,"release",this._getV4ReleaseCommand()),e),v4UnpatchSessions:e=>{void 0!==e&&((0,TG.isWrapped)(e.acquire)&&this._unwrap(e,"acquire"),(0,TG.isWrapped)(e.release)&&this._unwrap(e,"release"))}}}_getV4AcquireCommand(){const e=this;return t=>function(){const n=this.sessions.length,r=t.call(this),s=this.sessions.length;return n===s?e._connectionsUsage.add(1,{state:"used","pool.name":e._poolName}):n-1===s&&(e._connectionsUsage.add(-1,{state:"idle","pool.name":e._poolName}),e._connectionsUsage.add(1,{state:"used","pool.name":e._poolName})),r}}_getV4ReleaseCommand(){const e=this;return t=>function(n){const r=t.call(this,n);return e._connectionsUsage.add(-1,{state:"used","pool.name":e._poolName}),e._connectionsUsage.add(1,{state:"idle","pool.name":e._poolName}),r}}_getV4ConnectionPoolPatches(){return{v4PatchConnectionPool:e=>{const t=e.ConnectionPool.prototype;return(0,TG.isWrapped)(t.checkOut)&&this._unwrap(t,"checkOut"),this._wrap(t,"checkOut",this._getV4ConnectionPoolCheckOut()),e},v4UnpatchConnectionPool:e=>{void 0!==e&&this._unwrap(e.ConnectionPool.prototype,"checkOut")}}}_getV4ConnectPatches(){return{v4PatchConnect:e=>((0,TG.isWrapped)(e.connect)&&this._unwrap(e,"connect"),this._wrap(e,"connect",this._getV4ConnectCommand()),e),v4UnpatchConnect:e=>{void 0!==e&&this._unwrap(e,"connect")}}}_getV4ConnectionPoolCheckOut(){return e=>function(t){const n=yG.context.bind(yG.context.active(),t);return e.call(this,n)}}_getV4ConnectCommand(){const e=this;return t=>function(n,r){if(1===t.length){const r=t.call(this,n);return r&&"function"==typeof r.then&&r.then(()=>e.setPoolName(n),()=>{}),r}return t.call(this,n,function(t,s){!t&&s?(e.setPoolName(n),r(t,s)):r(t,s)})}}_getV4ConnectionPatches(){return{v4PatchConnectionCallback:e=>((0,TG.isWrapped)(e.Connection.prototype.command)&&this._unwrap(e.Connection.prototype,"command"),this._wrap(e.Connection.prototype,"command",this._getV4PatchCommandCallback()),e),v4PatchConnectionPromise:e=>((0,TG.isWrapped)(e.Connection.prototype.command)&&this._unwrap(e.Connection.prototype,"command"),this._wrap(e.Connection.prototype,"command",this._getV4PatchCommandPromise()),e),v4UnpatchConnection:e=>{void 0!==e&&this._unwrap(e.Connection.prototype,"command")}}}_getV3PatchOperation(e){const t=this;return n=>function(r,s,o,i,a){const c=yG.trace.getSpan(yG.context.active()),u="function"==typeof i?i:a;if(t._checkSkipInstrumentation(c)||"function"!=typeof u||"object"!=typeof o)return"function"==typeof i?n.call(this,r,s,o,i):n.call(this,r,s,o,i,a);const l=t.tracer.startSpan(`mongodb.${e}`,{kind:yG.SpanKind.CLIENT});t._populateV3Attributes(l,s,r,o[0],e);const p=t._patchEnd(l,u);return"function"==typeof i?n.call(this,r,s,o,p):n.call(this,r,s,o,i,p)}}_getV3PatchCommand(){const e=this;return t=>function(n,r,s,o,i){const a=yG.trace.getSpan(yG.context.active()),c="function"==typeof o?o:i;if(e._checkSkipInstrumentation(a)||"function"!=typeof c||"object"!=typeof s)return"function"==typeof o?t.call(this,n,r,s,o):t.call(this,n,r,s,o,i);const u=NG._getCommandType(s),l=u===AG.MongodbCommandType.UNKNOWN?"command":u,p=e.tracer.startSpan(`mongodb.${l}`,{kind:yG.SpanKind.CLIENT}),d=u===AG.MongodbCommandType.UNKNOWN?void 0:u;e._populateV3Attributes(p,r,n,s,d);const h=e._patchEnd(p,c);return"function"==typeof o?t.call(this,n,r,s,h):t.call(this,n,r,s,o,h)}}_getV4PatchCommandCallback(){const e=this;return t=>function(n,r,s,o){const i=yG.trace.getSpan(yG.context.active()),a=e._checkSkipInstrumentation(i),c=o,u=Object.keys(r)[0];if("object"!=typeof r||r.ismaster||r.hello)return t.call(this,n,r,s,o);let l;a||(l=e.tracer.startSpan(`mongodb.${u}`,{kind:yG.SpanKind.CLIENT}),e._populateV4Attributes(l,this,n,r,u));const p=e._patchEnd(l,c,this.id,u);return t.call(this,n,r,s,p)}}_getV4PatchCommandPromise(){const e=this;return t=>function(...n){const[r,s]=n,o=yG.trace.getSpan(yG.context.active()),i=e._checkSkipInstrumentation(o),a=Object.keys(s)[0];if("object"!=typeof s||s.ismaster||s.hello)return t.apply(this,n);let c;i||(c=e.tracer.startSpan(`mongodb.${a}`,{kind:yG.SpanKind.CLIENT}),e._populateV4Attributes(c,this,r,s,a));const u=e._patchEnd(c,()=>{},this.id,a),l=t.apply(this,n);return l.then(e=>u(null,e),e=>u(e)),l}}_getV3PatchFind(){const e=this;return t=>function(n,r,s,o,i,a){const c=yG.trace.getSpan(yG.context.active()),u="function"==typeof i?i:a;if(e._checkSkipInstrumentation(c)||"function"!=typeof u||"object"!=typeof s)return"function"==typeof i?t.call(this,n,r,s,o,i):t.call(this,n,r,s,o,i,a);const l=e.tracer.startSpan("mongodb.find",{kind:yG.SpanKind.CLIENT});e._populateV3Attributes(l,r,n,s,"find");const p=e._patchEnd(l,u);return"function"==typeof i?t.call(this,n,r,s,o,p):t.call(this,n,r,s,o,i,p)}}_getV3PatchCursor(){const e=this;return t=>function(n,r,s,o,i,a){const c=yG.trace.getSpan(yG.context.active()),u="function"==typeof i?i:a;if(e._checkSkipInstrumentation(c)||"function"!=typeof u)return"function"==typeof i?t.call(this,n,r,s,o,i):t.call(this,n,r,s,o,i,a);const l=e.tracer.startSpan("mongodb.getMore",{kind:yG.SpanKind.CLIENT});e._populateV3Attributes(l,r,n,s.cmd,"getMore");const p=e._patchEnd(l,u);return"function"==typeof i?t.call(this,n,r,s,o,p):t.call(this,n,r,s,o,i,p)}}static _getCommandType(e){return void 0!==e.createIndexes?AG.MongodbCommandType.CREATE_INDEXES:void 0!==e.findandmodify?AG.MongodbCommandType.FIND_AND_MODIFY:void 0!==e.ismaster?AG.MongodbCommandType.IS_MASTER:void 0!==e.count?AG.MongodbCommandType.COUNT:void 0!==e.aggregate?AG.MongodbCommandType.AGGREGATE:AG.MongodbCommandType.UNKNOWN}_populateV4Attributes(e,t,n,r,s){let o,i,a;if(t){const e="string"==typeof t.address?t.address.split(":"):"";2===e.length&&(o=e[0],i=e[1])}a=r?.documents&&r.documents[0]?r.documents[0]:r?.cursors?r.cursors:r,this._addAllSpanAttributes(e,n.db,n.collection,o,i,a,s)}_populateV3Attributes(e,t,n,r,s){let o,i;if(n&&n.s&&(o=n.s.options?.host??n.s.host,i=(n.s.options?.port??n.s.port)?.toString(),null==o||null==i)){const e=n.description?.address;if(e){const t=e.split(":");o=t[0],i=t[1]}}const[a,c]=t.toString().split("."),u=r?.query??r?.q??r;this._addAllSpanAttributes(e,a,c,o,i,u,s)}_addAllSpanAttributes(e,t,n,r,s,o,i){if(e.setAttributes({[bG.SEMATTRS_DB_SYSTEM]:bG.DBSYSTEMVALUES_MONGODB,[bG.SEMATTRS_DB_NAME]:t,[bG.SEMATTRS_DB_MONGODB_COLLECTION]:n,[bG.SEMATTRS_DB_OPERATION]:i,[bG.SEMATTRS_DB_CONNECTION_STRING]:`mongodb://${r}:${s}/${t}`}),r&&s){e.setAttribute(bG.SEMATTRS_NET_PEER_NAME,r);const t=parseInt(s,10);isNaN(t)||e.setAttribute(bG.SEMATTRS_NET_PEER_PORT,t)}if(!o)return;const{dbStatementSerializer:a}=this.getConfig(),c="function"==typeof a?a:this._defaultDbStatementSerializer.bind(this);(0,TG.safeExecuteInTheMiddle)(()=>{const t=c(o);e.setAttribute(bG.SEMATTRS_DB_STATEMENT,t)},e=>{e&&this._diag.error("Error running dbStatementSerializer hook",e)},!0)}_defaultDbStatementSerializer(e){const{enhancedDatabaseReporting:t}=this.getConfig(),n=t?e:this._scrubStatement(e);return JSON.stringify(n)}_scrubStatement(e){return Array.isArray(e)?e.map(e=>this._scrubStatement(e)):"object"==typeof e&&null!==e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,this._scrubStatement(t)])):"?"}_handleExecutionResult(e,t){const{responseHook:n}=this.getConfig();"function"==typeof n&&(0,TG.safeExecuteInTheMiddle)(()=>{n(e,{data:t})},e=>{e&&this._diag.error("Error running response hook",e)},!0)}_patchEnd(e,t,n,r){const s=yG.context.active(),o=this;return function(...n){const i=n[0];if(e){if(i instanceof Error)e?.setStatus({code:yG.SpanStatusCode.ERROR,message:i.message});else{const t=n[1];o._handleExecutionResult(e,t)}e.end()}return yG.context.with(s,()=>("endSessions"===r&&o._connectionsUsage.add(-1,{state:"idle","pool.name":o._poolName}),t.apply(this,n)))}}setPoolName(e){const t=e.hostAddress?.host,n=e.hostAddress?.port,r=`mongodb://${t}:${n}/${e.dbName}`;this._poolName=r}_checkSkipInstrumentation(e){return!0===this.getConfig().requireParentSpan&&void 0===e}}gG.MongoDBInstrumentation=NG;var CG={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(t=e.MongodbCommandType||(e.MongodbCommandType={})).CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.UNKNOWN="unknown"}(CG),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=e.MongoDBInstrumentation=void 0;var t=gG;Object.defineProperty(e,"MongoDBInstrumentation",{enumerable:!0,get:function(){return t.MongoDBInstrumentation}});var n=CG;Object.defineProperty(e,"MongodbCommandType",{enumerable:!0,get:function(){return n.MongodbCommandType}})}(_G);const OG="Mongo",IG=yO(OG,()=>new _G.MongoDBInstrumentation({dbStatementSerializer:PG,responseHook(e){iw(e,"auto.db.otel.mongo")}}));function PG(e){const t=LG(e);return JSON.stringify(t)}function LG(e){if(Array.isArray(e))return e.map(e=>LG(e));if(function(e){return"object"==typeof e&&null!==e&&!function(e){let t=!1;"undefined"!=typeof Buffer&&(t=Buffer.isBuffer(e));return t}(e)}(e)){const t={};return Object.entries(e).map(([e,t])=>[e,LG(t)]).reduce((e,t)=>(function(e){return Array.isArray(e)}(t)&&(e[t[0]]=t[1]),e),t)}return"?"}const wG=()=>({name:OG,setupOnce(){IG()}});var MG={},xG={},kG={};Object.defineProperty(kG,"__esModule",{value:!0}),kG.handleCallbackResponse=kG.handlePromiseResponse=kG.getAttributesFromCollection=void 0;const GG=Ft,DG=kS,VG=GS;function UG(e,t={}){e.recordException(t),e.setStatus({code:GG.SpanStatusCode.ERROR,message:`${t.message} ${t.code?`\nMongoose Error Code: ${t.code}`:""}`})}function HG(e,t,n,r=void 0){n&&(0,DG.safeExecuteInTheMiddle)(()=>n(e,{moduleVersion:r,response:t}),e=>{e&&GG.diag.error("mongoose instrumentation: responseHook error",e)},!0)}kG.getAttributesFromCollection=function(e){return{[VG.SEMATTRS_DB_MONGODB_COLLECTION]:e.name,[VG.SEMATTRS_DB_NAME]:e.conn.name,[VG.SEMATTRS_DB_USER]:e.conn.user,[VG.SEMATTRS_NET_PEER_NAME]:e.conn.host,[VG.SEMATTRS_NET_PEER_PORT]:e.conn.port}},kG.handlePromiseResponse=function(e,t,n,r=void 0){return e instanceof Promise?e.then(e=>(HG(t,e,n,r),e)).catch(e=>{throw UG(t,e),e}).finally(()=>t.end()):(HG(t,e,n,r),t.end(),e)},kG.handleCallbackResponse=function(e,t,n,r,s,o,i=void 0){let a=0;return 2===s.length?a=1:3===s.length&&(a=2),s[a]=(t,n)=>(t?UG(r,t):HG(r,n,o,i),r.end(),e(t,n)),t.apply(n,s)};var jG={};Object.defineProperty(jG,"__esModule",{value:!0}),jG.PACKAGE_NAME=jG.PACKAGE_VERSION=void 0,jG.PACKAGE_VERSION="0.50.0",jG.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose",function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=e._STORED_PARENT_SPAN=void 0;const t=Ft,n=Q_,r=kG,s=kS,o=jG,i=GS,a=["deleteOne","deleteMany","find","findOne","estimatedDocumentCount","countDocuments","distinct","where","$where","findOneAndUpdate","findOneAndDelete","findOneAndReplace"],c=["remove","count","findOneAndRemove",...a],u=["count","findOneAndRemove",...a],l=[...a];function p(e){return e?e.startsWith("6.")||e.startsWith("5.")?c:e.startsWith("7.")?u:l:a}function d(e){return e&&(e.startsWith("5.")||e.startsWith("6."))||!1}e._STORED_PARENT_SPAN=Symbol("stored-parent-span");class h extends s.InstrumentationBase{constructor(e={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,e)}init(){return new s.InstrumentationNodeModuleDefinition("mongoose",[">=5.9.7 <9"],this.patch.bind(this),this.unpatch.bind(this))}patch(e,t){const n="Module"===e[Symbol.toStringTag]?e.default:e;this._wrap(n.Model.prototype,"save",this.patchOnModelMethods("save",t)),n.Model.prototype.$save=n.Model.prototype.save,d(t)&&this._wrap(n.Model.prototype,"remove",this.patchOnModelMethods("remove",t)),this._wrap(n.Query.prototype,"exec",this.patchQueryExec(t)),this._wrap(n.Aggregate.prototype,"exec",this.patchAggregateExec(t));return p(t).forEach(e=>{this._wrap(n.Query.prototype,e,this.patchAndCaptureSpanContext(e))}),this._wrap(n.Model,"aggregate",this.patchModelAggregate()),this._wrap(n.Model,"insertMany",this.patchModelStatic("insertMany",t)),this._wrap(n.Model,"bulkWrite",this.patchModelStatic("bulkWrite",t)),n}unpatch(e,t){const n="Module"===e[Symbol.toStringTag]?e.default:e,r=p(t);this._unwrap(n.Model.prototype,"save"),n.Model.prototype.$save=n.Model.prototype.save,d(t)&&this._unwrap(n.Model.prototype,"remove"),this._unwrap(n.Query.prototype,"exec"),this._unwrap(n.Aggregate.prototype,"exec"),r.forEach(e=>{this._unwrap(n.Query.prototype,e)}),this._unwrap(n.Model,"aggregate"),this._unwrap(n.Model,"insertMany"),this._unwrap(n.Model,"bulkWrite")}patchAggregateExec(n){const r=this;return s=>function(o){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const a=this[e._STORED_PARENT_SPAN],c={},{dbStatementSerializer:u}=r.getConfig();u&&(c[i.SEMATTRS_DB_STATEMENT]=u("aggregate",{options:this.options,aggregatePipeline:this._pipeline}));const l=r._startSpan(this._model.collection,this._model?.modelName,"aggregate",c,a);return r._handleResponse(l,s,this,arguments,o,n)}}patchQueryExec(n){const r=this;return s=>function(o){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const a=this[e._STORED_PARENT_SPAN],c={},{dbStatementSerializer:u}=r.getConfig();u&&(c[i.SEMATTRS_DB_STATEMENT]=u(this.op,{condition:this._conditions,updates:this._update,options:this.options,fields:this._fields}));const l=r._startSpan(this.mongooseCollection,this.model.modelName,this.op,c,a);return r._handleResponse(l,s,this,arguments,o,n)}}patchOnModelMethods(e,n){const r=this;return s=>function(o,a){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);const c={document:this};!o||o instanceof Function||(c.options=o);const u={},{dbStatementSerializer:l}=r.getConfig();l&&(u[i.SEMATTRS_DB_STATEMENT]=l(e,c));const p=r._startSpan(this.constructor.collection,this.constructor.modelName,e,u);return o instanceof Function&&(a=o,o=void 0),r._handleResponse(p,s,this,arguments,a,n)}}patchModelStatic(e,n){const r=this;return s=>function(o,a,c){if(r.getConfig().requireParentSpan&&void 0===t.trace.getSpan(t.context.active()))return s.apply(this,arguments);"function"==typeof a&&(c=a,a=void 0);const u={};switch(e){case"insertMany":u.documents=o;break;case"bulkWrite":u.operations=o;break;default:u.document=o}void 0!==a&&(u.options=a);const l={},{dbStatementSerializer:p}=r.getConfig();p&&(l[i.SEMATTRS_DB_STATEMENT]=p(e,u));const d=r._startSpan(this.collection,this.modelName,e,l);return r._handleResponse(d,s,this,arguments,c,n)}}patchModelAggregate(){const n=this;return r=>function(){const s=t.trace.getSpan(t.context.active()),o=n._callOriginalFunction(()=>r.apply(this,arguments));return o&&(o[e._STORED_PARENT_SPAN]=s),o}}patchAndCaptureSpanContext(n){const r=this;return n=>function(){return this[e._STORED_PARENT_SPAN]=t.trace.getSpan(t.context.active()),r._callOriginalFunction(()=>n.apply(this,arguments))}}_startSpan(e,n,s,o,a){return this.tracer.startSpan(`mongoose.${n}.${s}`,{kind:t.SpanKind.CLIENT,attributes:{...o,...(0,r.getAttributesFromCollection)(e),[i.SEMATTRS_DB_OPERATION]:s,[i.SEMATTRS_DB_SYSTEM]:"mongoose"}},a?t.trace.setSpan(t.context.active(),a):void 0)}_handleResponse(e,t,n,s,o,i=void 0){const a=this;if(o instanceof Function)return a._callOriginalFunction(()=>(0,r.handleCallbackResponse)(o,t,n,e,s,a.getConfig().responseHook,i));{const o=a._callOriginalFunction(()=>t.apply(n,s));return(0,r.handlePromiseResponse)(o,e,a.getConfig().responseHook,i)}}_callOriginalFunction(e){return this.getConfig().suppressInternalInstrumentation?t.context.with((0,n.suppressTracing)(t.context.active()),e):e()}}e.MongooseInstrumentation=h}(xG),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=void 0;var t=xG;Object.defineProperty(e,"MongooseInstrumentation",{enumerable:!0,get:function(){return t.MongooseInstrumentation}})}(MG);const ZG="Mongoose",WG=yO(ZG,()=>new MG.MongooseInstrumentation({responseHook(e){iw(e,"auto.db.otel.mongoose")}})),XG=()=>({name:ZG,setupOnce(){WG()}});var $G={},FG={},YG={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.MYSQL_VALUES="db.mysql.values"}(e.AttributeNames||(e.AttributeNames={}))}(YG);var BG={};Object.defineProperty(BG,"__esModule",{value:!0}),BG.getPoolName=BG.arrayStringifyHelper=BG.getSpanName=BG.getDbValues=BG.getDbStatement=BG.getConnectionAttributes=void 0;const KG=GS;function JG(e,t,n){let r=`jdbc:mysql://${e||"localhost"}`;return"number"==typeof t&&(r+=`:${t}`),"string"==typeof n&&(r+=`/${n}`),r}function zG(e){return e?`[${e.toString()}]`:""}BG.getConnectionAttributes=function(e){const{host:t,port:n,database:r,user:s}=function(e){const{host:t,port:n,database:r,user:s}=e&&e.connectionConfig||e||{};return{host:t,port:n,database:r,user:s}}(e),o=parseInt(n,10);return isNaN(o)?{[KG.SEMATTRS_NET_PEER_NAME]:t,[KG.SEMATTRS_DB_CONNECTION_STRING]:JG(t,n,r),[KG.SEMATTRS_DB_NAME]:r,[KG.SEMATTRS_DB_USER]:s}:{[KG.SEMATTRS_NET_PEER_NAME]:t,[KG.SEMATTRS_NET_PEER_PORT]:o,[KG.SEMATTRS_DB_CONNECTION_STRING]:JG(t,n,r),[KG.SEMATTRS_DB_NAME]:r,[KG.SEMATTRS_DB_USER]:s}},BG.getDbStatement=function(e){return"string"==typeof e?e:e.sql},BG.getDbValues=function(e,t){return zG("string"==typeof e?t:t||e.values)},BG.getSpanName=function(e){const t="object"==typeof e?e.sql:e,n=t?.indexOf(" ");return"number"==typeof n&&-1!==n?t?.substring(0,n):t},BG.arrayStringifyHelper=zG,BG.getPoolName=function(e){const t=e.config.connectionConfig;let n="";return n+=t.host?`host: '${t.host}', `:"",n+=t.port?`port: ${t.port}, `:"",n+=t.database?`database: '${t.database}', `:"",n+=t.user?`user: '${t.user}'`:"",t.user||(n=n.substring(0,n.length-2)),n.trim()};var QG={};Object.defineProperty(QG,"__esModule",{value:!0}),QG.PACKAGE_NAME=QG.PACKAGE_VERSION=void 0,QG.PACKAGE_VERSION="0.49.0",QG.PACKAGE_NAME="@opentelemetry/instrumentation-mysql",Object.defineProperty(FG,"__esModule",{value:!0}),FG.MySQLInstrumentation=void 0;const qG=Ft,eD=kS,tD=GS,nD=YG,rD=BG,sD=QG;class oD extends eD.InstrumentationBase{static COMMON_ATTRIBUTES={[tD.SEMATTRS_DB_SYSTEM]:tD.DBSYSTEMVALUES_MYSQL};constructor(e={}){super(sD.PACKAGE_NAME,sD.PACKAGE_VERSION,e),this._setMetricInstruments()}setMeterProvider(e){super.setMeterProvider(e),this._setMetricInstruments()}_setMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter("db.client.connections.usage",{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){return[new eD.InstrumentationNodeModuleDefinition("mysql",[">=2.0.0 <3"],e=>((0,eD.isWrapped)(e.createConnection)&&this._unwrap(e,"createConnection"),this._wrap(e,"createConnection",this._patchCreateConnection()),(0,eD.isWrapped)(e.createPool)&&this._unwrap(e,"createPool"),this._wrap(e,"createPool",this._patchCreatePool()),(0,eD.isWrapped)(e.createPoolCluster)&&this._unwrap(e,"createPoolCluster"),this._wrap(e,"createPoolCluster",this._patchCreatePoolCluster()),e),e=>{void 0!==e&&(this._unwrap(e,"createConnection"),this._unwrap(e,"createPool"),this._unwrap(e,"createPoolCluster"))})]}_patchCreateConnection(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"query",t._patchQuery(r)),r}}}_patchCreatePool(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"query",t._patchQuery(r)),t._wrap(r,"getConnection",t._patchGetConnection(r)),t._wrap(r,"end",t._patchPoolEnd(r)),t._setPoolcallbacks(r,t,""),r}}}_patchPoolEnd(e){return t=>{const n=this;return function(r){const s=e._allConnections.length,o=e._freeConnections.length,i=s-o,a=(0,rD.getPoolName)(e);n._connectionsUsage.add(-i,{state:"used",name:a}),n._connectionsUsage.add(-o,{state:"idle",name:a}),t.apply(e,arguments)}}}_patchCreatePoolCluster(){return e=>{const t=this;return function(n){const r=e(...arguments);return t._wrap(r,"getConnection",t._patchGetConnection(r)),t._wrap(r,"add",t._patchAdd(r)),r}}}_patchAdd(e){return t=>{const n=this;return function(r,s){if(!n._enabled)return n._unwrap(e,"add"),t.apply(e,arguments);t.apply(e,arguments);const o=e._nodes;if(o){const t=o["object"==typeof r?"CLUSTER::"+e._lastId:String(r)].pool;n._setPoolcallbacks(t,n,r)}}}}_patchGetConnection(e){return t=>{const n=this;return function(r,s,o){if(!n._enabled)return n._unwrap(e,"getConnection"),t.apply(e,arguments);if(1===arguments.length&&"function"==typeof r){const s=n._getConnectionCallbackPatchFn(r);return t.call(e,s)}if(2===arguments.length&&"function"==typeof s){const o=n._getConnectionCallbackPatchFn(s);return t.call(e,r,o)}if(3===arguments.length&&"function"==typeof o){const i=n._getConnectionCallbackPatchFn(o);return t.call(e,r,s,i)}return t.apply(e,arguments)}}}_getConnectionCallbackPatchFn(e){const t=this,n=qG.context.active();return function(r,s){s&&((0,eD.isWrapped)(s.query)||t._wrap(s,"query",t._patchQuery(s))),"function"==typeof e&&qG.context.with(n,e,this,r,s)}}_patchQuery(e){return t=>{const n=this;return function(r,s,o){if(!n._enabled)return n._unwrap(e,"query"),t.apply(e,arguments);const i=n.tracer.startSpan((0,rD.getSpanName)(r),{kind:qG.SpanKind.CLIENT,attributes:{...oD.COMMON_ATTRIBUTES,...(0,rD.getConnectionAttributes)(e.config)}});if(i.setAttribute(tD.SEMATTRS_DB_STATEMENT,(0,rD.getDbStatement)(r)),n.getConfig().enhancedDatabaseReporting){let e;Array.isArray(s)?e=s:arguments[2]&&(e=[s]),i.setAttribute(nD.AttributeNames.MYSQL_VALUES,(0,rD.getDbValues)(r,e))}const a=Array.from(arguments).findIndex(e=>"function"==typeof e),c=qG.context.active();if(-1===a){const n=qG.context.with(qG.trace.setSpan(qG.context.active(),i),()=>t.apply(e,arguments));return qG.context.bind(c,n),n.on("error",e=>i.setStatus({code:qG.SpanStatusCode.ERROR,message:e.message})).on("end",()=>{i.end()})}return n._wrap(arguments,a,n._patchCallbackQuery(i,c)),qG.context.with(qG.trace.setSpan(qG.context.active(),i),()=>t.apply(e,arguments))}}}_patchCallbackQuery(e,t){return n=>function(r,s,o){return r&&e.setStatus({code:qG.SpanStatusCode.ERROR,message:r.message}),e.end(),qG.context.with(t,()=>n(...arguments))}}_setPoolcallbacks(e,t,n){const r=n||(0,rD.getPoolName)(e);e.on("connection",e=>{t._connectionsUsage.add(1,{state:"idle",name:r})}),e.on("acquire",e=>{t._connectionsUsage.add(-1,{state:"idle",name:r}),t._connectionsUsage.add(1,{state:"used",name:r})}),e.on("release",e=>{t._connectionsUsage.add(-1,{state:"used",name:r}),t._connectionsUsage.add(1,{state:"idle",name:r})})}}FG.MySQLInstrumentation=oD,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQLInstrumentation=void 0;var t=FG;Object.defineProperty(e,"MySQLInstrumentation",{enumerable:!0,get:function(){return t.MySQLInstrumentation}})}($G);const iD="Mysql",aD=yO(iD,()=>new $G.MySQLInstrumentation({})),cD=()=>({name:iD,setupOnce(){aD()}});var uD={},lD={},pD={};Object.defineProperty(pD,"__esModule",{value:!0}),pD.addSqlCommenterComment=void 0;const dD=Ft,hD=Q_;pD.addSqlCommenterComment=function(e,t){if("string"!=typeof t||0===t.length)return t;if(function(e){const t=e.indexOf("--");return t>=0||!(e.indexOf("/*")<0)&&t<e.indexOf("*/")}(t))return t;const n=new hD.W3CTraceContextPropagator,r={};n.inject(dD.trace.setSpan(dD.ROOT_CONTEXT,e),r,dD.defaultTextMapSetter);const s=Object.keys(r).sort();return 0===s.length?t:`${t} /*${s.map(e=>`${e}='${encodeURIComponent(r[e]).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}'`).join(",")}*/`};var mD={};Object.defineProperty(mD,"__esModule",{value:!0}),mD.getConnectionPrototypeToInstrument=mD.once=mD.getSpanName=mD.getDbStatement=mD.getConnectionAttributes=void 0;const fD=GS;function _D(e,t,n){let r=`jdbc:mysql://${e||"localhost"}`;return"number"==typeof t&&(r+=`:${t}`),"string"==typeof n&&(r+=`/${n}`),r}function gD(e){return e.replace(/\b\d+\b/g,"?").replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,"?")}mD.getConnectionAttributes=function(e){const{host:t,port:n,database:r,user:s}=function(e){const{host:t,port:n,database:r,user:s}=e&&e.connectionConfig||e||{};return{host:t,port:n,database:r,user:s}}(e),o=parseInt(n,10);return isNaN(o)?{[fD.SEMATTRS_NET_PEER_NAME]:t,[fD.SEMATTRS_DB_CONNECTION_STRING]:_D(t,n,r),[fD.SEMATTRS_DB_NAME]:r,[fD.SEMATTRS_DB_USER]:s}:{[fD.SEMATTRS_NET_PEER_NAME]:t,[fD.SEMATTRS_NET_PEER_PORT]:o,[fD.SEMATTRS_DB_CONNECTION_STRING]:_D(t,n,r),[fD.SEMATTRS_DB_NAME]:r,[fD.SEMATTRS_DB_USER]:s}},mD.getDbStatement=function(e,t,n,r=!1,s=gD){const[o,i]="string"==typeof e?[e,n]:[e.sql,(a=e,"values"in a?n||e.values:n)];var a;try{return r?s(o):t&&i?t(o,i):o}catch(e){return"Could not determine the query due to an error in masking or formatting"}},mD.getSpanName=function(e){const t="object"==typeof e?e.sql:e,n=t?.indexOf(" ");return"number"==typeof n&&-1!==n?t?.substring(0,n):t};mD.once=e=>{let t=!1;return(...n)=>{if(!t)return t=!0,e(...n)}},mD.getConnectionPrototypeToInstrument=function(e){const t=e.prototype,n=Object.getPrototypeOf(t);return"function"==typeof n?.query&&"function"==typeof n?.execute?n:t};var ED={};Object.defineProperty(ED,"__esModule",{value:!0}),ED.PACKAGE_NAME=ED.PACKAGE_VERSION=void 0,ED.PACKAGE_VERSION="0.50.0",ED.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2",Object.defineProperty(lD,"__esModule",{value:!0}),lD.MySQL2Instrumentation=void 0;const SD=Ft,yD=kS,TD=GS,bD=pD,AD=mD,RD=ED,vD=[">=1.4.2 <4"];class ND extends yD.InstrumentationBase{static COMMON_ATTRIBUTES={[TD.SEMATTRS_DB_SYSTEM]:TD.DBSYSTEMVALUES_MYSQL};constructor(e={}){super(RD.PACKAGE_NAME,RD.PACKAGE_VERSION,e)}init(){let e;function t(t){!e&&t.format&&(e=t.format)}const n=t=>{(0,yD.isWrapped)(t.query)&&this._unwrap(t,"query"),this._wrap(t,"query",this._patchQuery(e,!1)),(0,yD.isWrapped)(t.execute)&&this._unwrap(t,"execute"),this._wrap(t,"execute",this._patchQuery(e,!0))},r=e=>{this._unwrap(e,"query"),this._unwrap(e,"execute")};return[new yD.InstrumentationNodeModuleDefinition("mysql2",vD,e=>(t(e),e),()=>{},[new yD.InstrumentationNodeModuleFile("mysql2/promise.js",vD,e=>(t(e),e),()=>{}),new yD.InstrumentationNodeModuleFile("mysql2/lib/connection.js",vD,e=>{const t=(0,AD.getConnectionPrototypeToInstrument)(e);return n(t),e},e=>{if(void 0===e)return;const t=(0,AD.getConnectionPrototypeToInstrument)(e);r(t)})])]}_patchQuery(e,t){return n=>{const r=this;return function(s,o,i){let a;Array.isArray(o)?a=o:arguments[2]&&(a=[o]);const{maskStatement:c,maskStatementHook:u,responseHook:l}=r.getConfig(),p=r.tracer.startSpan((0,AD.getSpanName)(s),{kind:SD.SpanKind.CLIENT,attributes:{...ND.COMMON_ATTRIBUTES,...(0,AD.getConnectionAttributes)(this.config),[TD.SEMATTRS_DB_STATEMENT]:(0,AD.getDbStatement)(s,e,a,c,u)}});!t&&r.getConfig().addSqlCommenterCommentToQueries&&(arguments[0]=s="string"==typeof s?(0,bD.addSqlCommenterComment)(p,s):Object.assign(s,{sql:(0,bD.addSqlCommenterComment)(p,s.sql)}));const d=(0,AD.once)((e,t)=>{e?p.setStatus({code:SD.SpanStatusCode.ERROR,message:e.message}):"function"==typeof l&&(0,yD.safeExecuteInTheMiddle)(()=>{l(p,{queryResults:t})},e=>{e&&r._diag.warn("Failed executing responseHook",e)},!0),p.end()});if(1===arguments.length){"function"==typeof s.onResult&&r._wrap(s,"onResult",r._patchCallbackQuery(d));const e=n.apply(this,arguments);return e.once("error",e=>{d(e)}).once("result",e=>{d(void 0,e)}),e}return"function"==typeof arguments[1]?r._wrap(arguments,1,r._patchCallbackQuery(d)):"function"==typeof arguments[2]&&r._wrap(arguments,2,r._patchCallbackQuery(d)),n.apply(this,arguments)}}}_patchCallbackQuery(e){return t=>function(n,r,s){return e(n,r),t(...arguments)}}}lD.MySQL2Instrumentation=ND,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQL2Instrumentation=void 0;var t=lD;Object.defineProperty(e,"MySQL2Instrumentation",{enumerable:!0,get:function(){return t.MySQL2Instrumentation}})}(uD);const CD="Mysql2",OD=yO(CD,()=>new uD.MySQL2Instrumentation({responseHook(e){iw(e,"auto.db.otel.mysql2")}})),ID=()=>({name:CD,setupOnce(){OD()}});var PD={},LD={},wD={};Object.defineProperty(wD,"__esModule",{value:!0}),wD.endSpan=void 0;const MD=Ft;wD.endSpan=(e,t)=>{t&&(e.recordException(t),e.setStatus({code:MD.SpanStatusCode.ERROR,message:t.message})),e.end()};var xD={};Object.defineProperty(xD,"__esModule",{value:!0}),xD.defaultDbStatementSerializer=void 0;const kD=[{regex:/^ECHO/i,args:0},{regex:/^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,args:1},{regex:/^(HSET|HMSET|LSET|LINSERT)/i,args:2},{regex:/^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,args:-1}];xD.defaultDbStatementSerializer=(e,t)=>{if(Array.isArray(t)&&t.length){const n=kD.find(({regex:t})=>t.test(e))?.args??0,r=n>=0?t.slice(0,n):t;return t.length>r.length&&r.push(`[${t.length-n} other arguments]`),`${e} ${r.join(" ")}`}return e};var GD={};Object.defineProperty(GD,"__esModule",{value:!0}),GD.PACKAGE_NAME=GD.PACKAGE_VERSION=void 0,GD.PACKAGE_VERSION="0.51.0",GD.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis",Object.defineProperty(LD,"__esModule",{value:!0}),LD.IORedisInstrumentation=void 0;const DD=Ft,VD=kS,UD=GS,HD=kS,jD=wD,ZD=xD,WD=GD,XD={requireParentSpan:!0};class $D extends VD.InstrumentationBase{constructor(e={}){super(WD.PACKAGE_NAME,WD.PACKAGE_VERSION,{...XD,...e})}setConfig(e={}){super.setConfig({...XD,...e})}init(){return[new VD.InstrumentationNodeModuleDefinition("ioredis",[">=2.0.0 <6"],(e,t)=>{const n="Module"===e[Symbol.toStringTag]?e.default:e;return(0,VD.isWrapped)(n.prototype.sendCommand)&&this._unwrap(n.prototype,"sendCommand"),this._wrap(n.prototype,"sendCommand",this._patchSendCommand(t)),(0,VD.isWrapped)(n.prototype.connect)&&this._unwrap(n.prototype,"connect"),this._wrap(n.prototype,"connect",this._patchConnection()),e},e=>{if(void 0===e)return;const t="Module"===e[Symbol.toStringTag]?e.default:e;this._unwrap(t.prototype,"sendCommand"),this._unwrap(t.prototype,"connect")})]}_patchSendCommand(e){return t=>this._traceSendCommand(t,e)}_patchConnection(){return e=>this._traceConnection(e)}_traceSendCommand(e,t){const n=this;return function(r){if(arguments.length<1||"object"!=typeof r)return e.apply(this,arguments);const s=n.getConfig(),o=s.dbStatementSerializer||ZD.defaultDbStatementSerializer,i=void 0===DD.trace.getSpan(DD.context.active());if(!0===s.requireParentSpan&&i)return e.apply(this,arguments);const a=n.tracer.startSpan(r.name,{kind:DD.SpanKind.CLIENT,attributes:{[UD.SEMATTRS_DB_SYSTEM]:UD.DBSYSTEMVALUES_REDIS,[UD.SEMATTRS_DB_STATEMENT]:o(r.name,r.args)}}),{requestHook:c}=s;c&&(0,HD.safeExecuteInTheMiddle)(()=>c(a,{moduleVersion:t,cmdName:r.name,cmdArgs:r.args}),e=>{e&&DD.diag.error("ioredis instrumentation: request hook failed",e)},!0);const{host:u,port:l}=this.options;a.setAttributes({[UD.SEMATTRS_NET_PEER_NAME]:u,[UD.SEMATTRS_NET_PEER_PORT]:l,[UD.SEMATTRS_DB_CONNECTION_STRING]:`redis://${u}:${l}`});try{const t=e.apply(this,arguments),n=r.resolve;r.resolve=function(e){(0,HD.safeExecuteInTheMiddle)(()=>s.responseHook?.(a,r.name,r.args,e),e=>{e&&DD.diag.error("ioredis instrumentation: response hook failed",e)},!0),(0,jD.endSpan)(a,null),n(e)};const o=r.reject;return r.reject=function(e){(0,jD.endSpan)(a,e),o(e)},t}catch(e){throw(0,jD.endSpan)(a,e),e}}}_traceConnection(e){const t=this;return function(){const n=void 0===DD.trace.getSpan(DD.context.active());if(!0===t.getConfig().requireParentSpan&&n)return e.apply(this,arguments);const r=t.tracer.startSpan("connect",{kind:DD.SpanKind.CLIENT,attributes:{[UD.SEMATTRS_DB_SYSTEM]:UD.DBSYSTEMVALUES_REDIS,[UD.SEMATTRS_DB_STATEMENT]:"connect"}}),{host:s,port:o}=this.options;r.setAttributes({[UD.SEMATTRS_NET_PEER_NAME]:s,[UD.SEMATTRS_NET_PEER_PORT]:o,[UD.SEMATTRS_DB_CONNECTION_STRING]:`redis://${s}:${o}`});try{const t=e.apply(this,arguments);return(0,jD.endSpan)(r,null),t}catch(e){throw(0,jD.endSpan)(r,e),e}}}}LD.IORedisInstrumentation=$D,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IORedisInstrumentation=void 0;var t=LD;Object.defineProperty(e,"IORedisInstrumentation",{enumerable:!0,get:function(){return t.IORedisInstrumentation}})}(PD);var FD={},YD={},BD={};Object.defineProperty(BD,"__esModule",{value:!0}),BD.PACKAGE_NAME=BD.PACKAGE_VERSION=void 0,BD.PACKAGE_VERSION="0.51.0",BD.PACKAGE_NAME="@opentelemetry/instrumentation-redis";var KD={},JD={};Object.defineProperty(JD,"__esModule",{value:!0}),JD.getTracedCreateStreamTrace=JD.getTracedCreateClient=JD.endSpan=void 0;const zD=Ft;JD.endSpan=(e,t)=>{t&&e.setStatus({code:zD.SpanStatusCode.ERROR,message:t.message}),e.end()};JD.getTracedCreateClient=e=>function(){const t=e.apply(this,arguments);return zD.context.bind(zD.context.active(),t)};JD.getTracedCreateStreamTrace=e=>function(){return Object.prototype.hasOwnProperty.call(this,"stream")||Object.defineProperty(this,"stream",{get(){return this._patched_redis_stream},set(e){zD.context.bind(zD.context.active(),e),this._patched_redis_stream=e}}),e.apply(this,arguments)},Object.defineProperty(KD,"__esModule",{value:!0}),KD.RedisInstrumentationV2_V3=void 0;const QD=kS,qD=JD,eV=BD,tV=Ft,nV=GS,rV=xD;class sV extends QD.InstrumentationBase{static COMPONENT="redis";constructor(e={}){super(eV.PACKAGE_NAME,eV.PACKAGE_VERSION,e)}init(){return[new QD.InstrumentationNodeModuleDefinition("redis",[">=2.6.0 <4"],e=>((0,QD.isWrapped)(e.RedisClient.prototype.internal_send_command)&&this._unwrap(e.RedisClient.prototype,"internal_send_command"),this._wrap(e.RedisClient.prototype,"internal_send_command",this._getPatchInternalSendCommand()),(0,QD.isWrapped)(e.RedisClient.prototype.create_stream)&&this._unwrap(e.RedisClient.prototype,"create_stream"),this._wrap(e.RedisClient.prototype,"create_stream",this._getPatchCreateStream()),(0,QD.isWrapped)(e.createClient)&&this._unwrap(e,"createClient"),this._wrap(e,"createClient",this._getPatchCreateClient()),e),e=>{void 0!==e&&(this._unwrap(e.RedisClient.prototype,"internal_send_command"),this._unwrap(e.RedisClient.prototype,"create_stream"),this._unwrap(e,"createClient"))})]}_getPatchInternalSendCommand(){const e=this;return function(t){return function(n){if(1!==arguments.length||"object"!=typeof n)return t.apply(this,arguments);const r=e.getConfig(),s=void 0===tV.trace.getSpan(tV.context.active());if(!0===r.requireParentSpan&&s)return t.apply(this,arguments);const o=r?.dbStatementSerializer||rV.defaultDbStatementSerializer,i=e.tracer.startSpan(`${sV.COMPONENT}-${n.command}`,{kind:tV.SpanKind.CLIENT,attributes:{[nV.SEMATTRS_DB_SYSTEM]:nV.DBSYSTEMVALUES_REDIS,[nV.SEMATTRS_DB_STATEMENT]:o(n.command,n.args)}});this.connection_options&&i.setAttributes({[nV.SEMATTRS_NET_PEER_NAME]:this.connection_options.host,[nV.SEMATTRS_NET_PEER_PORT]:this.connection_options.port}),this.address&&i.setAttribute(nV.SEMATTRS_DB_CONNECTION_STRING,`redis://${this.address}`);const a=arguments[0].callback;if(a){const t=tV.context.active();arguments[0].callback=function(s,o){if(r?.responseHook){const t=r.responseHook;(0,QD.safeExecuteInTheMiddle)(()=>{t(i,n.command,n.args,o)},t=>{t&&e._diag.error("Error executing responseHook",t)},!0)}return(0,qD.endSpan)(i,s),tV.context.with(t,a,this,...arguments)}}try{return t.apply(this,arguments)}catch(e){throw(0,qD.endSpan)(i,e),e}}}}_getPatchCreateClient(){return function(e){return(0,qD.getTracedCreateClient)(e)}}_getPatchCreateStream(){return function(e){return(0,qD.getTracedCreateStreamTrace)(e)}}}KD.RedisInstrumentationV2_V3=sV;var oV={},iV={};Object.defineProperty(iV,"__esModule",{value:!0}),iV.getClientAttributes=void 0;const aV=GS;function cV(e,t){if("string"==typeof t&&t)try{const e=new URL(t);return e.searchParams.delete("user_pwd"),e.username="",e.password="",e.href}catch(t){e.error("failed to sanitize redis connection url",t)}}iV.getClientAttributes=function(e,t){return{[aV.SEMATTRS_DB_SYSTEM]:aV.DBSYSTEMVALUES_REDIS,[aV.SEMATTRS_NET_PEER_NAME]:t?.socket?.host,[aV.SEMATTRS_NET_PEER_PORT]:t?.socket?.port,[aV.SEMATTRS_DB_CONNECTION_STRING]:cV(e,t?.url)}},Object.defineProperty(oV,"__esModule",{value:!0}),oV.RedisInstrumentationV4=void 0;const uV=Ft,lV=kS,pV=iV,dV=xD,hV=BD,mV=GS,fV=Symbol("opentelemetry.instrumentation.redis.open_spans"),_V=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class gV extends lV.InstrumentationBase{static COMPONENT="redis";constructor(e={}){super(hV.PACKAGE_NAME,hV.PACKAGE_VERSION,e)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(e){const t=new lV.InstrumentationNodeModuleFile(`${e}/dist/lib/commander.js`,["^1.0.0"],(e,t)=>{const n=e.transformCommandArguments;if(!n)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),e;const r=t?.startsWith("1.0.")?"extendWithCommands":"attachCommands";return(0,lV.isWrapped)(e?.[r])&&this._unwrap(e,r),this._wrap(e,r,this._getPatchExtendWithCommands(n)),e},e=>{(0,lV.isWrapped)(e?.extendWithCommands)&&this._unwrap(e,"extendWithCommands"),(0,lV.isWrapped)(e?.attachCommands)&&this._unwrap(e,"attachCommands")}),n=new lV.InstrumentationNodeModuleFile(`${e}/dist/lib/client/multi-command.js`,["^1.0.0"],e=>{const t=e?.default?.prototype;return(0,lV.isWrapped)(t?.exec)&&this._unwrap(t,"exec"),this._wrap(t,"exec",this._getPatchMultiCommandsExec()),(0,lV.isWrapped)(t?.addCommand)&&this._unwrap(t,"addCommand"),this._wrap(t,"addCommand",this._getPatchMultiCommandsAddCommand()),e},e=>{const t=e?.default?.prototype;(0,lV.isWrapped)(t?.exec)&&this._unwrap(t,"exec"),(0,lV.isWrapped)(t?.addCommand)&&this._unwrap(t,"addCommand")}),r=new lV.InstrumentationNodeModuleFile(`${e}/dist/lib/client/index.js`,["^1.0.0"],e=>{const t=e?.default?.prototype;return t?.multi&&((0,lV.isWrapped)(t?.multi)&&this._unwrap(t,"multi"),this._wrap(t,"multi",this._getPatchRedisClientMulti())),t?.MULTI&&((0,lV.isWrapped)(t?.MULTI)&&this._unwrap(t,"MULTI"),this._wrap(t,"MULTI",this._getPatchRedisClientMulti())),(0,lV.isWrapped)(t?.sendCommand)&&this._unwrap(t,"sendCommand"),this._wrap(t,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(t,"connect",this._getPatchedClientConnect()),e},e=>{const t=e?.default?.prototype;(0,lV.isWrapped)(t?.multi)&&this._unwrap(t,"multi"),(0,lV.isWrapped)(t?.MULTI)&&this._unwrap(t,"MULTI"),(0,lV.isWrapped)(t?.sendCommand)&&this._unwrap(t,"sendCommand")});return new lV.InstrumentationNodeModuleDefinition(e,["^1.0.0"],e=>e,()=>{},[t,n,r])}_getPatchExtendWithCommands(e){const t=this;return function(n){return function(r){if("RedisClient"!==r?.BaseClass?.name)return n.apply(this,arguments);const s=r.executor;return r.executor=function(n,r){const o=e(n,r).args;return t._traceClientCommand(s,this,arguments,o)},n.apply(this,arguments)}}}_getPatchMultiCommandsExec(){const e=this;return function(t){return function(){const n=t.apply(this,arguments);return"function"!=typeof n?.then?(e._diag.error("got non promise result when patching RedisClientMultiCommand.exec"),n):n.then(t=>{const n=this[fV];return e._endSpansWithRedisReplies(n,t),t}).catch(t=>{const n=this[fV];if(n){const r="MultiErrorReply"===t.constructor.name?t.replies:new Array(n.length).fill(t);e._endSpansWithRedisReplies(n,r)}else e._diag.error("cannot find open spans to end for redis multi command");return Promise.reject(t)})}}}_getPatchMultiCommandsAddCommand(){const e=this;return function(t){return function(n){return e._traceClientCommand(t,this,arguments,n)}}}_getPatchRedisClientMulti(){return function(e){return function(){const t=e.apply(this,arguments);return t[_V]=this.options,t}}}_getPatchRedisClientSendCommand(){const e=this;return function(t){return function(n){return e._traceClientCommand(t,this,arguments,n)}}}_getPatchedClientConnect(){const e=this;return function(t){return function(){const n=this.options,r=(0,pV.getClientAttributes)(e._diag,n),s=e.tracer.startSpan(`${gV.COMPONENT}-connect`,{kind:uV.SpanKind.CLIENT,attributes:r});return uV.context.with(uV.trace.setSpan(uV.context.active(),s),()=>t.apply(this)).then(e=>(s.end(),e)).catch(e=>(s.recordException(e),s.setStatus({code:uV.SpanStatusCode.ERROR,message:e.message}),s.end(),Promise.reject(e)))}}}_traceClientCommand(e,t,n,r){if(void 0===uV.trace.getSpan(uV.context.active())&&this.getConfig().requireParentSpan)return e.apply(t,n);const s=t.options||t[_V],o=r[0],i=r.slice(1),a=this.getConfig().dbStatementSerializer||dV.defaultDbStatementSerializer,c=(0,pV.getClientAttributes)(this._diag,s);try{const e=a(o,i);null!=e&&(c[mV.SEMATTRS_DB_STATEMENT]=e)}catch(e){this._diag.error("dbStatementSerializer throw an exception",e,{commandName:o})}const u=this.tracer.startSpan(`${gV.COMPONENT}-${o}`,{kind:uV.SpanKind.CLIENT,attributes:c}),l=uV.context.with(uV.trace.setSpan(uV.context.active(),u),()=>e.apply(t,n));if("function"==typeof l?.then)l.then(e=>{this._endSpanWithResponse(u,o,i,e,void 0)},e=>{this._endSpanWithResponse(u,o,i,null,e)});else{const e=l;e[fV]=e[fV]||[],e[fV].push({span:u,commandName:o,commandArgs:i})}return l}_endSpansWithRedisReplies(e,t){if(!e)return this._diag.error("cannot find open spans to end for redis multi command");if(t.length!==e.length)return this._diag.error("number of multi command spans does not match response from redis");for(let n=0;n<e.length;n++){const{span:r,commandName:s,commandArgs:o}=e[n],i=t[n],[a,c]=i instanceof Error?[null,i]:[i,void 0];this._endSpanWithResponse(r,s,o,a,c)}}_endSpanWithResponse(e,t,n,r,s){const{responseHook:o}=this.getConfig();if(!s&&o)try{o(e,t,n,r)}catch(e){this._diag.error("responseHook throw an exception",e)}s&&(e.recordException(s),e.setStatus({code:uV.SpanStatusCode.ERROR,message:s?.message})),e.end()}}oV.RedisInstrumentationV4=gV,Object.defineProperty(YD,"__esModule",{value:!0}),YD.RedisInstrumentation=void 0;const EV=kS,SV=BD,yV=KD,TV=oV,bV={requireParentSpan:!1};class AV extends EV.InstrumentationBase{instrumentationV2_V3;instrumentationV4;initialized=!1;constructor(e={}){const t={...bV,...e};super(SV.PACKAGE_NAME,SV.PACKAGE_VERSION,t),this.instrumentationV2_V3=new yV.RedisInstrumentationV2_V3(this.getConfig()),this.instrumentationV4=new TV.RedisInstrumentationV4(this.getConfig()),this.initialized=!0}setConfig(e={}){const t={...bV,...e};super.setConfig(t),this.initialized&&(this.instrumentationV2_V3.setConfig(t),this.instrumentationV4.setConfig(t))}init(){}setTracerProvider(e){super.setTracerProvider(e),this.initialized&&(this.instrumentationV2_V3.setTracerProvider(e),this.instrumentationV4.setTracerProvider(e))}enable(){super.enable(),this.initialized&&(this.instrumentationV2_V3.enable(),this.instrumentationV4.enable())}disable(){super.disable(),this.initialized&&(this.instrumentationV2_V3.disable(),this.instrumentationV4.disable())}}YD.RedisInstrumentation=AV,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RedisInstrumentation=void 0;var t=YD;Object.defineProperty(e,"RedisInstrumentation",{enumerable:!0,get:function(){return t.RedisInstrumentation}})}(FD);const RV=["get","set","setex"],vV=["get","mget"],NV=["set","setex"];function CV(e,t){return e.includes(t.toLowerCase())}function OV(e){return CV(vV,e)?"cache.get":CV(NV,e)?"cache.put":void 0}function IV(e,t){return t.some(t=>e.startsWith(t))}function PV(e){const t=[],n=e=>{e.forEach(e=>{Array.isArray(e)?n(e):t.push(e)})};return n(e),t}const LV="Redis";let wV={};const MV=(e,t,n,r)=>{e.setAttribute(ZT,"auto.db.otel.redis");const s=function(e,t){try{if(0===t.length)return;const n=e=>"string"==typeof e||"number"==typeof e||Buffer.isBuffer(e)?[e.toString()]:Array.isArray(e)?PV(e.map(e=>n(e))):["<unknown>"],r=t[0];return CV(RV,e)&&null!=r?n(r):PV(t.map(e=>n(e)))}catch{return}}(t,n),o=OV(t);if(!(s&&o&&wV.cachePrefixes&&function(e,t,n){if(!OV(e))return!1;for(const e of t)if(IV(e,n))return!0;return!1}(t,s,wV.cachePrefixes)))return;const i=Nb(e).data["net.peer.name"],a=Nb(e).data["net.peer.port"];a&&i&&e.setAttributes({"network.peer.address":i,"network.peer.port":a});const c=function(e){const t=e=>{try{return Buffer.isBuffer(e)?e.byteLength:"string"==typeof e?e.length:"number"==typeof e?e.toString().length:null==e?0:JSON.stringify(e).length}catch{return}};return Array.isArray(e)?e.reduce((e,n)=>{const r=t(n);return"number"==typeof r?void 0!==e?e+r:r:e},0):t(e)}(r);c&&e.setAttribute("cache.item_size",c),CV(vV,t)&&void 0!==c&&e.setAttribute("cache.hit",c>0),e.setAttributes({[jT]:o,[BT]:s});const u=s.join(", ");e.updateName(Jy(u,1024))},xV=yO(`${LV}.IORedis`,()=>new PD.IORedisInstrumentation({responseHook:MV})),kV=yO(`${LV}.Redis`,()=>new FD.RedisInstrumentation({responseHook:MV})),GV=Object.assign(()=>{xV(),kV()},{id:LV}),DV=(e={})=>({name:LV,setupOnce(){wV=e,GV()}});var VV={},UV={},HV={};Object.defineProperty(HV,"__esModule",{value:!0}),HV.EVENT_LISTENERS_SET=void 0,HV.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet");var jV={},ZV={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.PG_VALUES="db.postgresql.values",e.PG_PLAN="db.postgresql.plan",e.IDLE_TIMEOUT_MILLIS="db.postgresql.idle.timeout.millis",e.MAX_CLIENT="db.postgresql.max.client"}(e.AttributeNames||(e.AttributeNames={}))}(ZV);var WV={};Object.defineProperty(WV,"__esModule",{value:!0}),WV.METRIC_DB_CLIENT_OPERATION_DURATION=WV.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS=WV.METRIC_DB_CLIENT_CONNECTION_COUNT=WV.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE=WV.DB_CLIENT_CONNECTION_STATE_VALUE_USED=WV.ATTR_DB_OPERATION_NAME=WV.ATTR_DB_NAMESPACE=WV.ATTR_DB_CLIENT_CONNECTION_STATE=WV.ATTR_DB_CLIENT_CONNECTION_POOL_NAME=void 0,WV.ATTR_DB_CLIENT_CONNECTION_POOL_NAME="db.client.connection.pool.name",WV.ATTR_DB_CLIENT_CONNECTION_STATE="db.client.connection.state",WV.ATTR_DB_NAMESPACE="db.namespace",WV.ATTR_DB_OPERATION_NAME="db.operation.name",WV.DB_CLIENT_CONNECTION_STATE_VALUE_USED="used",WV.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE="idle",WV.METRIC_DB_CLIENT_CONNECTION_COUNT="db.client.connection.count",WV.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS="db.client.connection.pending_requests",WV.METRIC_DB_CLIENT_OPERATION_DURATION="db.client.operation.duration";var XV={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=void 0,function(e){e.QUERY_PREFIX="pg.query",e.CONNECT="pg.connect",e.POOL_CONNECT="pg-pool.connect"}(e.SpanNames||(e.SpanNames={}))}(XV),Object.defineProperty(jV,"__esModule",{value:!0}),jV.isObjectWithTextString=jV.getErrorMessage=jV.patchClientConnectCallback=jV.patchCallbackPGPool=jV.updateCounter=jV.getPoolName=jV.patchCallback=jV.handleExecutionResult=jV.handleConfigQuery=jV.shouldSkipInstrumentation=jV.getSemanticAttributesFromPool=jV.getSemanticAttributesFromConnection=jV.getConnectionString=jV.parseAndMaskConnectionString=jV.parseNormalizedOperationName=jV.getQuerySpanName=void 0;const $V=Ft,FV=ZV,YV=GS,BV=WV,KV=kS,JV=XV;function zV(e,t){if(!t)return JV.SpanNames.QUERY_PREFIX;const n="string"==typeof t.name&&t.name?t.name:QV(t.text);return`${JV.SpanNames.QUERY_PREFIX}:${n}${e?` ${e}`:""}`}function QV(e){const t=e.indexOf(" ");let n=-1===t?e:e.slice(0,t);return n=n.toUpperCase(),n.endsWith(";")?n.slice(0,-1):n}function qV(e){try{const t=new URL(e);return t.username="",t.password="",t.toString()}catch(e){return"postgresql://localhost:5432/"}}function eU(e){if("connectionString"in e&&e.connectionString)return qV(e.connectionString);return`postgresql://${e.host||"localhost"}:${e.port||5432}/${e.database||""}`}function tU(e){if(Number.isInteger(e))return e}function nU(e){return{[YV.SEMATTRS_DB_SYSTEM]:YV.DBSYSTEMVALUES_POSTGRESQL,[YV.SEMATTRS_DB_NAME]:e.database,[YV.SEMATTRS_DB_CONNECTION_STRING]:eU(e),[YV.SEMATTRS_NET_PEER_NAME]:e.host,[YV.SEMATTRS_NET_PEER_PORT]:tU(e.port),[YV.SEMATTRS_DB_USER]:e.user}}function rU(e,t,n){"function"==typeof e.responseHook&&(0,KV.safeExecuteInTheMiddle)(()=>{e.responseHook(t,{data:n})},e=>{e&&$V.diag.error("Error running response hook",e)},!0)}jV.getQuerySpanName=zV,jV.parseNormalizedOperationName=QV,jV.parseAndMaskConnectionString=qV,jV.getConnectionString=eU,jV.getSemanticAttributesFromConnection=nU,jV.getSemanticAttributesFromPool=function(e){let t;try{t=e.connectionString?new URL(e.connectionString):void 0}catch(e){t=void 0}return{[YV.SEMATTRS_DB_SYSTEM]:YV.DBSYSTEMVALUES_POSTGRESQL,[YV.SEMATTRS_DB_NAME]:t?.pathname.slice(1)??e.database,[YV.SEMATTRS_DB_CONNECTION_STRING]:eU(e),[YV.SEMATTRS_NET_PEER_NAME]:t?.hostname??e.host,[YV.SEMATTRS_NET_PEER_PORT]:Number(t?.port)||tU(e.port),[YV.SEMATTRS_DB_USER]:t?.username??e.user,[FV.AttributeNames.IDLE_TIMEOUT_MILLIS]:e.idleTimeoutMillis,[FV.AttributeNames.MAX_CLIENT]:e.maxClient}},jV.shouldSkipInstrumentation=function(e){return!0===e.requireParentSpan&&void 0===$V.trace.getSpan($V.context.active())},jV.handleConfigQuery=function(e,t,n){const{connectionParameters:r}=this,s=zV(r.database,n),o=e.startSpan(s,{kind:$V.SpanKind.CLIENT,attributes:nU(r)});if(!n)return o;if(n.text&&o.setAttribute(YV.SEMATTRS_DB_STATEMENT,n.text),t.enhancedDatabaseReporting&&Array.isArray(n.values))try{const e=n.values.map(e=>null==e?"null":e instanceof Buffer?e.toString():"object"==typeof e?"function"==typeof e.toPostgres?e.toPostgres():JSON.stringify(e):e.toString());o.setAttribute(FV.AttributeNames.PG_VALUES,e)}catch(e){$V.diag.error("failed to stringify ",n.values,e)}return"string"==typeof n.name&&o.setAttribute(FV.AttributeNames.PG_PLAN,n.name),o},jV.handleExecutionResult=rU,jV.patchCallback=function(e,t,n,r,s){return function(o,i){o?(Object.prototype.hasOwnProperty.call(o,"code")&&(r[YV.ATTR_ERROR_TYPE]=o.code),t.setStatus({code:$V.SpanStatusCode.ERROR,message:o.message})):rU(e,t,i),s(),t.end(),n.call(this,o,i)}},jV.getPoolName=function(e){let t="";return t+=(e?.host?`${e.host}`:"unknown_host")+":",t+=(e?.port?`${e.port}`:"unknown_port")+"/",t+=e?.database?`${e.database}`:"unknown_database",t.trim()},jV.updateCounter=function(e,t,n,r,s){const o=t.totalCount,i=t.waitingCount,a=t.idleCount,c=o-a;return n.add(c-s.used,{[BV.ATTR_DB_CLIENT_CONNECTION_STATE]:BV.DB_CLIENT_CONNECTION_STATE_VALUE_USED,[BV.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),n.add(a-s.idle,{[BV.ATTR_DB_CLIENT_CONNECTION_STATE]:BV.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE,[BV.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),r.add(i-s.pending,{[BV.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:e}),{used:c,idle:a,pending:i}},jV.patchCallbackPGPool=function(e,t){return function(n,r,s){n&&e.setStatus({code:$V.SpanStatusCode.ERROR,message:n.message}),e.end(),t.call(this,n,r,s)}},jV.patchClientConnectCallback=function(e,t){return function(n){n&&e.setStatus({code:$V.SpanStatusCode.ERROR,message:n.message}),e.end(),t.apply(this,arguments)}},jV.getErrorMessage=function(e){return"object"==typeof e&&null!==e&&"message"in e?String(e.message):void 0},jV.isObjectWithTextString=function(e){return"object"==typeof e&&"string"==typeof e?.text};var sU={};Object.defineProperty(sU,"__esModule",{value:!0}),sU.PACKAGE_NAME=sU.PACKAGE_VERSION=void 0,sU.PACKAGE_VERSION="0.55.0",sU.PACKAGE_NAME="@opentelemetry/instrumentation-pg",Object.defineProperty(UV,"__esModule",{value:!0}),UV.PgInstrumentation=void 0;const oU=kS,iU=Ft,aU=HV,cU=jV,uU=pD,lU=sU,pU=XV,dU=Q_,hU=GS,mU=WV;function fU(e){return"Module"===e[Symbol.toStringTag]?e.default:e}class _U extends oU.InstrumentationBase{_connectionsCounter={used:0,idle:0,pending:0};constructor(e={}){super(lU.PACKAGE_NAME,lU.PACKAGE_VERSION,e)}_updateMetricInstruments(){this._operationDuration=this.meter.createHistogram(mU.METRIC_DB_CLIENT_OPERATION_DURATION,{description:"Duration of database client operations.",unit:"s",valueType:iU.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.001,.005,.01,.05,.1,.5,1,5,10]}}),this._connectionsCounter={idle:0,pending:0,used:0},this._connectionsCount=this.meter.createUpDownCounter(mU.METRIC_DB_CLIENT_CONNECTION_COUNT,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"}),this._connectionPendingRequests=this.meter.createUpDownCounter(mU.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS,{description:"The number of current pending requests for an open connection.",unit:"{connection}"})}init(){const e=[">=8.0.3 <9"],t=new oU.InstrumentationNodeModuleFile("pg/lib/native/client.js",e,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),n=new oU.InstrumentationNodeModuleFile("pg/lib/client.js",e,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this));return[new oU.InstrumentationNodeModuleDefinition("pg",e,e=>{const t=fU(e);return this._patchPgClient(t.Client),e},e=>{const t=fU(e);return this._unpatchPgClient(t.Client),e},[n,t]),new oU.InstrumentationNodeModuleDefinition("pg-pool",[">=2.0.0 <4"],e=>{const t=fU(e);return(0,oU.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),this._wrap(t.prototype,"connect",this._getPoolConnectPatch()),t},e=>{const t=fU(e);(0,oU.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect")})]}_patchPgClient(e){if(!e)return;const t=fU(e);return(0,oU.isWrapped)(t.prototype.query)&&this._unwrap(t.prototype,"query"),(0,oU.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),this._wrap(t.prototype,"query",this._getClientQueryPatch()),this._wrap(t.prototype,"connect",this._getClientConnectPatch()),e}_unpatchPgClient(e){const t=fU(e);return(0,oU.isWrapped)(t.prototype.query)&&this._unwrap(t.prototype,"query"),(0,oU.isWrapped)(t.prototype.connect)&&this._unwrap(t.prototype,"connect"),e}_getClientConnectPatch(){const e=this;return t=>function(n){if(cU.shouldSkipInstrumentation(e.getConfig()))return t.call(this,n);const r=e.tracer.startSpan(pU.SpanNames.CONNECT,{kind:iU.SpanKind.CLIENT,attributes:cU.getSemanticAttributesFromConnection(this)});if(n){const e=iU.trace.getSpan(iU.context.active());n=cU.patchClientConnectCallback(r,n),e&&(n=iU.context.bind(iU.context.active(),n))}return gU(r,iU.context.with(iU.trace.setSpan(iU.context.active(),r),()=>t.call(this,n)))}}recordOperationDuration(e,t){const n={};[hU.SEMATTRS_DB_SYSTEM,mU.ATTR_DB_NAMESPACE,hU.ATTR_ERROR_TYPE,hU.ATTR_SERVER_PORT,hU.ATTR_SERVER_ADDRESS,mU.ATTR_DB_OPERATION_NAME].forEach(t=>{t in e&&(n[t]=e[t])});const r=(0,dU.hrTimeToMilliseconds)((0,dU.hrTimeDuration)(t,(0,dU.hrTime)()))/1e3;this._operationDuration.record(r,n)}_getClientQueryPatch(){const e=this;return t=>(this._diag.debug("Patching pg.Client.prototype.query"),function(...n){if(cU.shouldSkipInstrumentation(e.getConfig()))return t.apply(this,n);const r=(0,dU.hrTime)(),s=n[0],o="string"==typeof s,i=cU.isObjectWithTextString(s),a=o?{text:s,values:Array.isArray(n[1])?n[1]:void 0}:i?s:void 0,c={[hU.SEMATTRS_DB_SYSTEM]:hU.DBSYSTEMVALUES_POSTGRESQL,[mU.ATTR_DB_NAMESPACE]:this.database,[hU.ATTR_SERVER_PORT]:this.connectionParameters.port,[hU.ATTR_SERVER_ADDRESS]:this.connectionParameters.host};a?.text&&(c[mU.ATTR_DB_OPERATION_NAME]=cU.parseNormalizedOperationName(a?.text));const u=()=>{e.recordOperationDuration(c,r)},l=e.getConfig(),p=cU.handleConfigQuery.call(this,e.tracer,l,a);if(l.addSqlCommenterCommentToQueries&&(o?n[0]=(0,uU.addSqlCommenterComment)(p,s):i&&!("name"in s)&&(n[0]={...s,text:(0,uU.addSqlCommenterComment)(p,s.text)})),n.length>0){const t=iU.trace.getSpan(iU.context.active());if("function"==typeof n[n.length-1])n[n.length-1]=cU.patchCallback(l,p,n[n.length-1],c,u),t&&(n[n.length-1]=iU.context.bind(iU.context.active(),n[n.length-1]));else if("function"==typeof a?.callback){let r=cU.patchCallback(e.getConfig(),p,a.callback,c,u);t&&(r=iU.context.bind(iU.context.active(),r)),n[0].callback=r}}const{requestHook:d}=l;let h;"function"==typeof d&&a&&(0,oU.safeExecuteInTheMiddle)(()=>{const{database:e,host:t,port:n,user:r}=this.connectionParameters;d(p,{connection:{database:e,host:t,port:n,user:r},query:{text:a.text,values:a.values,name:a.name}})},t=>{t&&e._diag.error("Error running query hook",t)},!0);try{h=t.apply(this,n)}catch(e){throw p.setStatus({code:iU.SpanStatusCode.ERROR,message:cU.getErrorMessage(e)}),p.end(),e}return h instanceof Promise?h.then(t=>new Promise(n=>{cU.handleExecutionResult(e.getConfig(),p,t),u(),p.end(),n(t)})).catch(e=>new Promise((t,n)=>{p.setStatus({code:iU.SpanStatusCode.ERROR,message:e.message}),u(),p.end(),n(e)})):h})}_setPoolConnectEventListeners(e){if(e[aU.EVENT_LISTENERS_SET])return;const t=cU.getPoolName(e.options);e.on("connect",()=>{this._connectionsCounter=cU.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("acquire",()=>{this._connectionsCounter=cU.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("remove",()=>{this._connectionsCounter=cU.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e.on("release",()=>{this._connectionsCounter=cU.updateCounter(t,e,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),e[aU.EVENT_LISTENERS_SET]=!0}_getPoolConnectPatch(){const e=this;return t=>function(n){if(cU.shouldSkipInstrumentation(e.getConfig()))return t.call(this,n);const r=e.tracer.startSpan(pU.SpanNames.POOL_CONNECT,{kind:iU.SpanKind.CLIENT,attributes:cU.getSemanticAttributesFromPool(this.options)});if(e._setPoolConnectEventListeners(this),n){const e=iU.trace.getSpan(iU.context.active());n=cU.patchCallbackPGPool(r,n),e&&(n=iU.context.bind(iU.context.active(),n))}return gU(r,iU.context.with(iU.trace.setSpan(iU.context.active(),r),()=>t.call(this,n)))}}}function gU(e,t){if(!(t instanceof Promise))return t;const n=t;return iU.context.bind(iU.context.active(),n.then(t=>(e.end(),t)).catch(t=>(e.setStatus({code:iU.SpanStatusCode.ERROR,message:cU.getErrorMessage(t)}),e.end(),Promise.reject(t))))}UV.PgInstrumentation=_U,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.PgInstrumentation=void 0;var t=UV;Object.defineProperty(e,"PgInstrumentation",{enumerable:!0,get:function(){return t.PgInstrumentation}});var n=ZV;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})}(VV);const EU="Postgres",SU=yO(EU,()=>new VV.PgInstrumentation({requireParentSpan:!0,requestHook(e){iw(e,"auto.db.otel.postgres")}})),yU=()=>({name:EU,setupOnce(){SU()}}),TU="PostgresJs",bU=[">=3.0.0 <4"],AU=yO(TU,e=>new RU({requireParentSpan:e?.requireParentSpan??!0,requestHook:e?.requestHook}));class RU extends IS{constructor(e){super("sentry-postgres-js",ly,e)}init(){const e=new LS("postgres",bU);return["src","cf/src","cjs/src"].forEach(t=>{e.files.push(new wS(`postgres/${t}/connection.js`,["*"],this._patchConnection.bind(this),this._unwrap.bind(this))),e.files.push(new wS(`postgres/${t}/query.js`,bU,this._patchQuery.bind(this),this._unwrap.bind(this)))}),[e]}_shouldCreateSpans(){const e=this.getConfig();return void 0!==Ht.getSpan(bt.active())||!e.requireParentSpan}_patchReject(e,t){return new Proxy(e,{apply:(e,n,r)=>{t.setStatus({code:2,message:r?.[0]?.message||"unknown_error"});const s=Reflect.apply(e,n,r);return t.setAttribute(Vf,r?.[0]?.code||"Unknown error"),t.setAttribute(Hf,r?.[0]?.name||"Unknown error"),t.end(),s}})}_patchResolve(e,t){return new Proxy(e,{apply:(e,n,r)=>{const s=Reflect.apply(e,n,r),o=r?.[0]?.command;return o&&t.setAttribute(Gf,o),t.end(),s}})}_patchQuery(e){return e.Query.prototype.handle=new Proxy(e.Query.prototype.handle,{apply:async(e,t,n)=>{if(!this._shouldCreateSpans())return Reflect.apply(e,t,n);const r=this._sanitizeSqlQuery(t.strings?.[0]);return SA({name:r||"postgresjs.query",op:"db"},s=>{const o=wT().getScopeData().contexts.postgresjsConnection;iw(s,"auto.db.otel.postgres");const{requestHook:i}=this.getConfig();i&&CS(()=>i(s,r,o),e=>{e&&yy.error(`Error in requestHook for ${TU} integration:`,e)});const a=o?.ATTR_DB_NAMESPACE||"<unknown database>",c=o?.ATTR_SERVER_ADDRESS||"<unknown host>",u=o?.ATTR_SERVER_PORT||"<unknown port>";s.setAttribute(Uf,"postgres"),s.setAttribute(kf,a),s.setAttribute(Yf,c),s.setAttribute(Bf,u),s.setAttribute(Df,r),t.resolve=this._patchResolve(t.resolve,s),t.reject=this._patchReject(t.reject,s);try{return Reflect.apply(e,t,n)}catch(e){throw s.setStatus({code:2}),s.end(),e}})}}),e}_patchConnection(e){return new Proxy(e,{apply:(e,t,n)=>{const r=n[0]?.database||"<unknown database>",s=n[0]?.host?.[0]||"<unknown host>",o=n[0]?.port?.[0]||"<unknown port>";return wT().setContext("postgresjsConnection",{ATTR_DB_NAMESPACE:r,ATTR_SERVER_ADDRESS:s,ATTR_SERVER_PORT:o}),Reflect.apply(e,t,n)}})}_sanitizeSqlQuery(e){return e?e.replace(/\s+/g," ").trim().substring(0,1024).replace(/--.*?(\r?\n|$)/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/;\s*$/,"").replace(/\b\d+\b/g,"?").replace(/\s+/g," ").replace(/\bIN\b\s*\(\s*\?(?:\s*,\s*\?)*\s*\)/g,"IN (?)"):"Unknown SQL Query"}}const vU=()=>({name:TU,setupOnce(){AU()}});var NU;!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.TRACE=1]="TRACE",e[e.TRACE2=2]="TRACE2",e[e.TRACE3=3]="TRACE3",e[e.TRACE4=4]="TRACE4",e[e.DEBUG=5]="DEBUG",e[e.DEBUG2=6]="DEBUG2",e[e.DEBUG3=7]="DEBUG3",e[e.DEBUG4=8]="DEBUG4",e[e.INFO=9]="INFO",e[e.INFO2=10]="INFO2",e[e.INFO3=11]="INFO3",e[e.INFO4=12]="INFO4",e[e.WARN=13]="WARN",e[e.WARN2=14]="WARN2",e[e.WARN3=15]="WARN3",e[e.WARN4=16]="WARN4",e[e.ERROR=17]="ERROR",e[e.ERROR2=18]="ERROR2",e[e.ERROR3=19]="ERROR3",e[e.ERROR4=20]="ERROR4",e[e.FATAL=21]="FATAL",e[e.FATAL2=22]="FATAL2",e[e.FATAL3=23]="FATAL3",e[e.FATAL4=24]="FATAL4"}(NU||(NU={}));var CU=function(){function e(){}return e.prototype.emit=function(e){},e}(),OU=new CU,IU=new(function(){function e(){}return e.prototype.getLogger=function(e,t,n){return new CU},e}()),PU=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.emit=function(e){this._getLogger().emit(e)},e.prototype._getLogger=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateLogger(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):OU},e}(),LU=function(){function e(){}return e.prototype.getLogger=function(e,t,n){var r;return null!==(r=this.getDelegateLogger(e,t,n))&&void 0!==r?r:new PU(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:IU},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateLogger=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(e,t,n)},e}(),wU="object"==typeof globalThis?globalThis:global,MU=Symbol.for("io.opentelemetry.js.api.logs"),xU=wU;var kU=function(){function e(){this._proxyLoggerProvider=new LU}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalLoggerProvider=function(e){return xU[MU]?this.getLoggerProvider():(xU[MU]=(t=1,n=e,r=IU,function(e){return e===t?n:r}),this._proxyLoggerProvider.setDelegate(e),e);var t,n,r},e.prototype.getLoggerProvider=function(){var e,t;return null!==(t=null===(e=xU[MU])||void 0===e?void 0:e.call(xU,1))&&void 0!==t?t:this._proxyLoggerProvider},e.prototype.getLogger=function(e,t,n){return this.getLoggerProvider().getLogger(e,t,n)},e.prototype.disable=function(){delete xU[MU],this._proxyLoggerProvider=new LU},e}(),GU=kU.getInstance(),DU={exports:{}};var VU={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var UU="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=VU,o=UU,i=(t=e.exports={}).re=[],a=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],l=t.t={};let p=0;const d="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[d,r]],m=(e,t,n)=>{const r=(e=>{for(const[t,n]of h)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),s=p++;o(e,s,t),l[e]=s,c[s]=t,u[s]=r,i[s]=new RegExp(t,n?"g":void 0),a[s]=new RegExp(r,n?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),m("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${d}+`),m("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),m("FULL",`^${c[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),m("LOOSE",`^${c[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),m("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?`+`(?:${c[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[l.COERCE],!0),m("COERCERTLFULL",c[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(DU,DU.exports);var HU=DU.exports;const jU=Object.freeze({loose:!0}),ZU=Object.freeze({});var WU=e=>e?"object"!=typeof e?jU:e:ZU;const XU=/^[0-9]+$/,$U=(e,t)=>{const n=XU.test(e),r=XU.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var FU={compareIdentifiers:$U,rcompareIdentifiers:(e,t)=>$U(t,e)};const YU=UU,{MAX_LENGTH:BU,MAX_SAFE_INTEGER:KU}=VU,{safeRe:JU,t:zU}=HU,QU=WU,{compareIdentifiers:qU}=FU;var eH=class e{constructor(t,n){if(n=QU(n),t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>BU)throw new TypeError(`version is longer than ${BU} characters`);YU("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?JU[zU.LOOSE]:JU[zU.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>KU||this.major<0)throw new TypeError("Invalid major version");if(this.minor>KU||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>KU||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<KU)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(YU("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),qU(this.major,t.major)||qU(this.minor,t.minor)||qU(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const e=this.prerelease[n],r=t.prerelease[n];if(YU("prerelease compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return qU(e,r)}while(++n)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let n=0;do{const e=this.build[n],r=t.build[n];if(YU("build compare",n,e,r),void 0===e&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===e)return-1;if(e!==r)return qU(e,r)}while(++n)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?JU[zU.PRERELEASELOOSE]:JU[zU.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===qU(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};const tH=eH;var nH=(e,t,n=!1)=>{if(e instanceof tH)return e;try{return new tH(e,t)}catch(e){if(!n)return null;throw e}};const rH=nH;var sH=(e,t)=>{const n=rH(e,t);return n?n.version:null};const oH=nH;var iH=(e,t)=>{const n=oH(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};const aH=eH;var cH=(e,t,n,r,s)=>{"string"==typeof n&&(s=r,r=n,n=void 0);try{return new aH(e instanceof aH?e.version:e,n).inc(t,r,s).version}catch(e){return null}};const uH=nH;var lH=(e,t)=>{const n=uH(e,null,!0),r=uH(t,null,!0),s=n.compare(r);if(0===s)return null;const o=s>0,i=o?n:r,a=o?r:n,c=!!i.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(0===a.compareMain(i))return a.minor&&!a.patch?"minor":"patch"}const u=c?"pre":"";return n.major!==r.major?u+"major":n.minor!==r.minor?u+"minor":n.patch!==r.patch?u+"patch":"prerelease"};const pH=eH;var dH=(e,t)=>new pH(e,t).major;const hH=eH;var mH=(e,t)=>new hH(e,t).minor;const fH=eH;var _H=(e,t)=>new fH(e,t).patch;const gH=nH;var EH=(e,t)=>{const n=gH(e,t);return n&&n.prerelease.length?n.prerelease:null};const SH=eH;var yH=(e,t,n)=>new SH(e,n).compare(new SH(t,n));const TH=yH;var bH=(e,t,n)=>TH(t,e,n);const AH=yH;var RH=(e,t)=>AH(e,t,!0);const vH=eH;var NH=(e,t,n)=>{const r=new vH(e,n),s=new vH(t,n);return r.compare(s)||r.compareBuild(s)};const CH=NH;var OH=(e,t)=>e.sort((e,n)=>CH(e,n,t));const IH=NH;var PH=(e,t)=>e.sort((e,n)=>IH(n,e,t));const LH=yH;var wH=(e,t,n)=>LH(e,t,n)>0;const MH=yH;var xH=(e,t,n)=>MH(e,t,n)<0;const kH=yH;var GH=(e,t,n)=>0===kH(e,t,n);const DH=yH;var VH=(e,t,n)=>0!==DH(e,t,n);const UH=yH;var HH=(e,t,n)=>UH(e,t,n)>=0;const jH=yH;var ZH=(e,t,n)=>jH(e,t,n)<=0;const WH=GH,XH=VH,$H=wH,FH=HH,YH=xH,BH=ZH;var KH=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return WH(e,n,r);case"!=":return XH(e,n,r);case">":return $H(e,n,r);case">=":return FH(e,n,r);case"<":return YH(e,n,r);case"<=":return BH(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const JH=eH,zH=nH,{safeRe:QH,t:qH}=HU;var ej=(e,t)=>{if(e instanceof JH)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){const r=t.includePrerelease?QH[qH.COERCERTLFULL]:QH[qH.COERCERTL];let s;for(;(s=r.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&s.index+s[0].length===n.index+n[0].length||(n=s),r.lastIndex=s.index+s[1].length+s[2].length;r.lastIndex=-1}else n=e.match(t.includePrerelease?QH[qH.COERCEFULL]:QH[qH.COERCE]);if(null===n)return null;const r=n[2],s=n[3]||"0",o=n[4]||"0",i=t.includePrerelease&&n[5]?`-${n[5]}`:"",a=t.includePrerelease&&n[6]?`+${n[6]}`:"";return zH(`${r}.${s}.${o}${i}${a}`,t)};var tj,nj,rj,sj,oj=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};function ij(){if(nj)return tj;nj=1;const e=/\s+/g;class t{constructor(n,o){if(o=r(o),n instanceof t)return n.loose===!!o.loose&&n.includePrerelease===!!o.includePrerelease?n:new t(n.raw,o);if(n instanceof s)return this.raw=n.value,this.set=[[n]],this.formatted=void 0,this;if(this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease,this.raw=n.trim().replace(e," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!m(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&f(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&d)|(this.options.loose&&h))+":"+e,r=n.get(t);if(r)return r;const i=this.options.loose,f=i?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];e=e.replace(f,C(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(a[c.COMPARATORTRIM],u),o("comparator trim",e),e=e.replace(a[c.TILDETRIM],l),o("tilde trim",e),e=e.replace(a[c.CARETTRIM],p),o("caret trim",e);let _=e.split(" ").map(e=>g(e,this.options)).join(" ").split(/\s+/).map(e=>N(e,this.options));i&&(_=_.filter(e=>(o("loose invalid filter",e,this.options),!!e.match(a[c.COMPARATORLOOSE])))),o("range list",_);const E=new Map,S=_.map(e=>new s(e,this.options));for(const e of S){if(m(e))return[e];E.set(e.value,e)}E.size>1&&E.has("")&&E.delete("");const y=[...E.values()];return n.set(t,y),y}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(t=>_(t,n)&&e.set.some(e=>_(e,n)&&t.every(t=>e.every(e=>t.intersects(e,n)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new i(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}tj=t;const n=new oj,r=WU,s=aj(),o=UU,i=eH,{safeRe:a,t:c,comparatorTrimReplace:u,tildeTrimReplace:l,caretTrimReplace:p}=HU,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:h}=VU,m=e=>"<0.0.0-0"===e.value,f=e=>""===e.value,_=(e,t)=>{let n=!0;const r=e.slice();let s=r.pop();for(;n&&r.length;)n=r.every(e=>s.intersects(e,t)),s=r.pop();return n},g=(e,t)=>(o("comp",e,t),e=T(e,t),o("caret",e),e=S(e,t),o("tildes",e),e=A(e,t),o("xrange",e),e=v(e,t),o("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,S=(e,t)=>e.trim().split(/\s+/).map(e=>y(e,t)).join(" "),y=(e,t)=>{const n=t.loose?a[c.TILDELOOSE]:a[c.TILDE];return e.replace(n,(t,n,r,s,i)=>{let a;return o("tilde",e,t,n,r,s,i),E(n)?a="":E(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:E(s)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:i?(o("replaceTilde pr",i),a=`>=${n}.${r}.${s}-${i} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${s} <${n}.${+r+1}.0-0`,o("tilde return",a),a})},T=(e,t)=>e.trim().split(/\s+/).map(e=>b(e,t)).join(" "),b=(e,t)=>{o("caret",e,t);const n=t.loose?a[c.CARETLOOSE]:a[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(t,n,s,i,a)=>{let c;return o("caret",e,t,n,s,i,a),E(n)?c="":E(s)?c=`>=${n}.0.0${r} <${+n+1}.0.0-0`:E(i)?c="0"===n?`>=${n}.${s}.0${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.0${r} <${+n+1}.0.0-0`:a?(o("replaceCaret pr",a),c="0"===n?"0"===s?`>=${n}.${s}.${i}-${a} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}-${a} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i}-${a} <${+n+1}.0.0-0`):(o("no pr"),c="0"===n?"0"===s?`>=${n}.${s}.${i}${r} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i} <${+n+1}.0.0-0`),o("caret return",c),c})},A=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map(e=>R(e,t)).join(" ")),R=(e,t)=>{e=e.trim();const n=t.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return e.replace(n,(n,r,s,i,a,c)=>{o("xRange",e,n,r,s,i,a,c);const u=E(s),l=u||E(i),p=l||E(a),d=p;return"="===r&&d&&(r=""),c=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(l&&(i=0),a=0,">"===r?(r=">=",l?(s=+s+1,i=0,a=0):(i=+i+1,a=0)):"<="===r&&(r="<",l?s=+s+1:i=+i+1),"<"===r&&(c="-0"),n=`${r+s}.${i}.${a}${c}`):l?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:p&&(n=`>=${s}.${i}.0${c} <${s}.${+i+1}.0-0`),o("xRange return",n),n})},v=(e,t)=>(o("replaceStars",e,t),e.trim().replace(a[c.STAR],"")),N=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(a[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),C=e=>(t,n,r,s,o,i,a,c,u,l,p,d)=>`${n=E(r)?"":E(s)?`>=${r}.0.0${e?"-0":""}`:E(o)?`>=${r}.${s}.0${e?"-0":""}`:i?`>=${n}`:`>=${n}${e?"-0":""}`} ${c=E(u)?"":E(l)?`<${+u+1}.0.0-0`:E(p)?`<${u}.${+l+1}.0-0`:d?`<=${u}.${l}.${p}-${d}`:e?`<${u}.${l}.${+p+1}-0`:`<=${c}`}`.trim(),O=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(o(e[n].semver),e[n].semver!==s.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0};return tj}function aj(){if(sj)return rj;sj=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(r,s){if(s=n(s),r instanceof t){if(r.loose===!!s.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),i("comparator",r,s),this.options=s,this.loose=!!s.loose,this.parse(r),this.semver===e?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(t){const n=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],o=t.match(n);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==o[1]?o[1]:"","="===this.operator&&(this.operator=""),o[2]?this.semver=new a(o[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(i("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new a(t,this.options)}catch(e){return!1}return o(t,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,r).test(this.value):""===e.operator?""===e.value||new c(this.value,r).test(e.semver):(!(r=n(r)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(o(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(o(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}rj=t;const n=WU,{safeRe:r,t:s}=HU,o=KH,i=UU,a=eH,c=ij();return rj}const cj=ij();var uj=(e,t,n)=>{try{t=new cj(t,n)}catch(e){return!1}return t.test(e)};const lj=ij();var pj=(e,t)=>new lj(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "));const dj=eH,hj=ij();var mj=(e,t,n)=>{let r=null,s=null,o=null;try{o=new hj(t,n)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(r&&-1!==s.compare(e)||(r=e,s=new dj(r,n)))}),r};const fj=eH,_j=ij();var gj=(e,t,n)=>{let r=null,s=null,o=null;try{o=new _j(t,n)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(r&&1!==s.compare(e)||(r=e,s=new fj(r,n)))}),r};const Ej=eH,Sj=ij(),yj=wH;var Tj=(e,t)=>{e=new Sj(e,t);let n=new Ej("0.0.0");if(e.test(n))return n;if(n=new Ej("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let s=null;r.forEach(e=>{const t=new Ej(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!yj(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),!s||n&&!yj(n,s)||(n=s)}return n&&e.test(n)?n:null};const bj=ij();var Aj=(e,t)=>{try{return new bj(e,t).range||"*"}catch(e){return null}};const Rj=eH,vj=aj(),{ANY:Nj}=vj,Cj=ij(),Oj=uj,Ij=wH,Pj=xH,Lj=ZH,wj=HH;var Mj=(e,t,n,r)=>{let s,o,i,a,c;switch(e=new Rj(e,r),t=new Cj(t,r),n){case">":s=Ij,o=Lj,i=Pj,a=">",c=">=";break;case"<":s=Pj,o=wj,i=Ij,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Oj(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let l=null,p=null;if(u.forEach(e=>{e.semver===Nj&&(e=new vj(">=0.0.0")),l=l||e,p=p||e,s(e.semver,l.semver,r)?l=e:i(e.semver,p.semver,r)&&(p=e)}),l.operator===a||l.operator===c)return!1;if((!p.operator||p.operator===a)&&o(e,p.semver))return!1;if(p.operator===c&&i(e,p.semver))return!1}return!0};const xj=Mj;var kj=(e,t,n)=>xj(e,t,">",n);const Gj=Mj;var Dj=(e,t,n)=>Gj(e,t,"<",n);const Vj=ij();var Uj=(e,t,n)=>(e=new Vj(e,n),t=new Vj(t,n),e.intersects(t,n));const Hj=uj,jj=yH;const Zj=ij(),Wj=aj(),{ANY:Xj}=Wj,$j=uj,Fj=yH,Yj=[new Wj(">=0.0.0-0")],Bj=[new Wj(">=0.0.0")],Kj=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===Xj){if(1===t.length&&t[0].semver===Xj)return!0;e=n.includePrerelease?Yj:Bj}if(1===t.length&&t[0].semver===Xj){if(n.includePrerelease)return!0;t=Bj}const r=new Set;let s,o,i,a,c,u,l;for(const t of e)">"===t.operator||">="===t.operator?s=Jj(s,t,n):"<"===t.operator||"<="===t.operator?o=zj(o,t,n):r.add(t.semver);if(r.size>1)return null;if(s&&o){if(i=Fj(s.semver,o.semver,n),i>0)return null;if(0===i&&(">="!==s.operator||"<="!==o.operator))return null}for(const e of r){if(s&&!$j(e,String(s),n))return null;if(o&&!$j(e,String(o),n))return null;for(const r of t)if(!$j(e,String(r),n))return!1;return!0}let p=!(!o||n.includePrerelease||!o.semver.prerelease.length)&&o.semver,d=!(!s||n.includePrerelease||!s.semver.prerelease.length)&&s.semver;p&&1===p.prerelease.length&&"<"===o.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(l=l||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,s)if(d&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===d.major&&e.semver.minor===d.minor&&e.semver.patch===d.patch&&(d=!1),">"===e.operator||">="===e.operator){if(a=Jj(s,e,n),a===e&&a!==s)return!1}else if(">="===s.operator&&!$j(s.semver,String(e),n))return!1;if(o)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(c=zj(o,e,n),c===e&&c!==o)return!1}else if("<="===o.operator&&!$j(o.semver,String(e),n))return!1;if(!e.operator&&(o||s)&&0!==i)return!1}return!(s&&u&&!o&&0!==i)&&(!(o&&l&&!s&&0!==i)&&(!d&&!p))},Jj=(e,t,n)=>{if(!e)return t;const r=Fj(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},zj=(e,t,n)=>{if(!e)return t;const r=Fj(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var Qj=(e,t,n={})=>{if(e===t)return!0;e=new Zj(e,n),t=new Zj(t,n);let r=!1;e:for(const s of e.set){for(const e of t.set){const t=Kj(s,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0};const qj=HU,eZ=VU,tZ=eH,nZ=FU,rZ=(e,t,n)=>{const r=[];let s=null,o=null;const i=e.sort((e,t)=>jj(e,t,n));for(const e of i){Hj(e,t,n)?(o=e,s||(s=e)):(o&&r.push([s,o]),o=null,s=null)}s&&r.push([s,null]);const a=[];for(const[e,t]of r)e===t?a.push(e):t||e!==i[0]?t?e===i[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const c=a.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return c.length<u.length?c:t};var sZ={parse:nH,valid:sH,clean:iH,inc:cH,diff:lH,major:dH,minor:mH,patch:_H,prerelease:EH,compare:yH,rcompare:bH,compareLoose:RH,compareBuild:NH,sort:OH,rsort:PH,gt:wH,lt:xH,eq:GH,neq:VH,gte:HH,lte:ZH,cmp:KH,coerce:ej,Comparator:aj(),Range:ij(),satisfies:uj,toComparators:pj,maxSatisfying:mj,minSatisfying:gj,minVersion:Tj,validRange:Aj,outside:Mj,gtr:kj,ltr:Dj,intersects:Uj,simplifyRange:rZ,subset:Qj,SemVer:tZ,re:qj.re,src:qj.src,tokens:qj.t,SEMVER_SPEC_VERSION:eZ.SEMVER_SPEC_VERSION,RELEASE_TYPES:eZ.RELEASE_TYPES,compareIdentifiers:nZ.compareIdentifiers,rcompareIdentifiers:nZ.rcompareIdentifiers};function oZ(e){return"function"==typeof e}var iZ=console.error.bind(console);function aZ(e,t,n){var r=!!e[t]&&e.propertyIsEnumerable(t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}function cZ(e){e&&e.logger&&(oZ(e.logger)?iZ=e.logger:iZ("new logger isn't a function, not replacing"))}function uZ(e,t,n){if(e&&e[t]){if(!n)return iZ("no wrapper function"),void iZ((new Error).stack);if(oZ(e[t])&&oZ(n)){var r=e[t],s=n(r,t);return aZ(s,"__original",r),aZ(s,"__unwrap",function(){e[t]===s&&aZ(e,t,r)}),aZ(s,"__wrapped",!0),aZ(e,t,s),s}iZ("original object and wrapper must be functions")}else iZ("no original function "+t+" to wrap")}function lZ(e,t){return e&&e[t]?e[t].__unwrap?e[t].__unwrap():void iZ("no original to unwrap to -- has "+t+" already been unwrapped?"):(iZ("no function to unwrap."),void iZ((new Error).stack))}cZ.wrap=uZ,cZ.massWrap=function(e,t,n){if(!e)return iZ("must provide one or more modules to patch"),void iZ((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){uZ(e,t,n)})}):iZ("must provide one or more functions to wrap on modules")},cZ.unwrap=lZ,cZ.massUnwrap=function(e,t){if(!e)return iZ("must provide one or more modules to patch"),void iZ((new Error).stack);Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){lZ(e,t)})}):iZ("must provide one or more functions to unwrap on modules")};var pZ=cZ,dZ=function(){return dZ=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},dZ.apply(this,arguments)},hZ=function(){function e(e,t,n){this.instrumentationName=e,this.instrumentationVersion=t,this._config={},this._wrap=pZ.wrap,this._unwrap=pZ.unwrap,this._massWrap=pZ.massWrap,this._massUnwrap=pZ.massUnwrap,this.setConfig(n),this._diag=At.createComponentLogger({namespace:e}),this._tracer=Ht.getTracer(e,t),this._meter=Ct.getMeter(e,t),this._logger=GU.getLogger(e,t),this._updateMetricInstruments()}return Object.defineProperty(e.prototype,"meter",{get:function(){return this._meter},enumerable:!1,configurable:!0}),e.prototype.setMeterProvider=function(e){this._meter=e.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()},Object.defineProperty(e.prototype,"logger",{get:function(){return this._logger},enumerable:!1,configurable:!0}),e.prototype.setLoggerProvider=function(e){this._logger=e.getLogger(this.instrumentationName,this.instrumentationVersion)},e.prototype.getModuleDefinitions=function(){var e,t=null!==(e=this.init())&&void 0!==e?e:[];return Array.isArray(t)?t:[t]},e.prototype._updateMetricInstruments=function(){},e.prototype.getConfig=function(){return this._config},e.prototype.setConfig=function(e){this._config=dZ({enabled:!0},e)},e.prototype.setTracerProvider=function(e){this._tracer=e.getTracer(this.instrumentationName,this.instrumentationVersion)},Object.defineProperty(e.prototype,"tracer",{get:function(){return this._tracer},enumerable:!1,configurable:!0}),e.prototype._runSpanCustomizationHook=function(e,t,n,r){if(e)try{e(n,r)}catch(e){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:t},e)}},e}(),mZ=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},fZ=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},_Z=function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},gZ="/",EZ=function(){this.hooks=[],this.children=new Map},SZ=function(){function e(){this._trie=new EZ,this._counter=0}return e.prototype.insert=function(e){var t,n,r=this._trie;try{for(var s=mZ(e.moduleName.split(gZ)),o=s.next();!o.done;o=s.next()){var i=o.value,a=r.children.get(i);a||(a=new EZ,r.children.set(i,a)),r=a}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}r.hooks.push({hook:e,insertedId:this._counter++})},e.prototype.search=function(e,t){var n,r,s=void 0===t?{}:t,o=s.maintainInsertionOrder,i=s.fullOnly,a=this._trie,c=[],u=!0;try{for(var l=mZ(e.split(gZ)),p=l.next();!p.done;p=l.next()){var d=p.value,h=a.children.get(d);if(!h){u=!1;break}i||c.push.apply(c,_Z([],fZ(h.hooks),!1)),a=h}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return i&&u&&c.push.apply(c,_Z([],fZ(a.hooks),!1)),0===c.length?[]:1===c.length?[c[0].hook]:(o&&c.sort(function(e,t){return e.insertedId-t.insertedId}),c.map(function(e){return e.hook}))},e}(),yZ=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},TZ=["afterEach","after","beforeEach","before","describe","it"].every(function(e){return"function"==typeof global[e]}),bZ=function(){function e(){this._moduleNameTrie=new SZ,this._initialize()}return e.prototype._initialize=function(){var e=this;new $E(null,{internals:!0},function(t,n,r){var s,o,i,a=(i=n,O.sep!==gZ?i.split(O.sep).join(gZ):i),c=e._moduleNameTrie.search(a,{maintainInsertionOrder:!0,fullOnly:void 0===r});try{for(var u=yZ(c),l=u.next();!l.done;l=u.next()){t=(0,l.value.onRequire)(t,n,r)}}catch(e){s={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}return t})},e.prototype.register=function(e,t){var n={moduleName:e,onRequire:t};return this._moduleNameTrie.insert(n),n},e.getInstance=function(){var t;return TZ?new e:this._instance=null!==(t=this._instance)&&void 0!==t?t:new e},e}();var AZ=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),RZ=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},vZ=function(t){function n(e,n,r){var o=t.call(this,e,n,r)||this;o._hooks=[],o._requireInTheMiddleSingleton=bZ.getInstance(),o._enabled=!1,o._wrap=function(e,t,n){var r;if("function"==typeof(r=e[t])&&"function"==typeof r.__original&&"function"==typeof r.__unwrap&&!0===r.__wrapped&&o._unwrap(e,t),s.types.isProxy(e)){var i=pZ.wrap(Object.assign({},e),t,n);return Object.defineProperty(e,t,{value:i}),i}return pZ.wrap(e,t,n)},o._unwrap=function(e,t){return s.types.isProxy(e)?Object.defineProperty(e,t,{value:e[t]}):pZ.unwrap(e,t)},o._massWrap=function(e,t,n){e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){o._wrap(e,t,n)})}):At.error("must provide one or more functions to wrap on modules")):At.error("must provide one or more modules to patch")},o._massUnwrap=function(e,t){e?(Array.isArray(e)||(e=[e]),t&&Array.isArray(t)?e.forEach(function(e){t.forEach(function(t){o._unwrap(e,t)})}):At.error("must provide one or more functions to wrap on modules")):At.error("must provide one or more modules to patch")};var i=o.init();return i&&!Array.isArray(i)&&(i=[i]),o._modules=i||[],o._config.enabled&&o.enable(),o}return AZ(n,t),n.prototype._warnOnPreloadedModules=function(){var e=this;this._modules.forEach(function(t){var n=t.name;try{var r=require.resolve(n);require.cache[r]&&e._diag.warn("Module "+n+" has been loaded before "+e.instrumentationName+" so it might not work, please initialize it before requiring "+n)}catch(e){}})},n.prototype._extractPackageVersion=function(t){try{var n=e.readFileSync(O.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return"string"==typeof r?r:void 0}catch(e){At.warn("Failed extracting version",t)}},n.prototype._onRequire=function(e,t,n,r){var s,o=this;if(!r)return"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:e.name}),e.patch(t)):t;var i=this._extractPackageVersion(r);if(e.moduleVersion=i,e.name===n)return NZ(e.supportedVersions,i,e.includePrerelease)&&"function"==typeof e.patch&&(e.moduleExports=t,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:e.name,version:e.moduleVersion,baseDir:r}),e.patch(t,e.moduleVersion)):t;var a=null!==(s=e.files)&&void 0!==s?s:[],c=O.normalize(n);return a.filter(function(e){return e.name===c}).filter(function(t){return NZ(t.supportedVersions,i,e.includePrerelease)}).reduce(function(t,n){return n.moduleExports=t,o._enabled?(o._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:e.name,version:e.moduleVersion,fileName:n.name,baseDir:r}),n.patch(t,e.moduleVersion)):t},t)},n.prototype.enable=function(){var e,t,n,r,s,o,i=this;if(!this._enabled)if(this._enabled=!0,this._hooks.length>0)try{for(var a=RZ(this._modules),c=a.next();!c.done;c=a.next()){var u=c.value;"function"==typeof u.patch&&u.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:u.name,version:u.moduleVersion}),u.patch(u.moduleExports,u.moduleVersion));try{for(var l=(n=void 0,RZ(u.files)),p=l.next();!p.done;p=l.next()){var d=p.value;d.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:u.name,version:u.moduleVersion,fileName:d.name}),d.patch(d.moduleExports,u.moduleVersion))}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else{this._warnOnPreloadedModules();var h=function(e){var t=function(t,n,r){return i._onRequire(e,t,n,r)},n=O.isAbsolute(e.name)?new $E([e.name],{internals:!0},t):m._requireInTheMiddleSingleton.register(e.name,t);m._hooks.push(n);var r=new vS([e.name],{internals:!1},function(t,n,r){if(!r&&O.isAbsolute(n)){var s=O.parse(n);n=s.name,r=s.dir}return i._onRequire(e,t,n,r)});m._hooks.push(r)},m=this;try{for(var f=RZ(this._modules),_=f.next();!_.done;_=f.next()){h(_.value)}}catch(e){s={error:e}}finally{try{_&&!_.done&&(o=f.return)&&o.call(f)}finally{if(s)throw s.error}}}},n.prototype.disable=function(){var e,t,n,r;if(this._enabled){this._enabled=!1;try{for(var s=RZ(this._modules),o=s.next();!o.done;o=s.next()){var i=o.value;"function"==typeof i.unpatch&&i.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:i.name,version:i.moduleVersion}),i.unpatch(i.moduleExports,i.moduleVersion));try{for(var a=(n=void 0,RZ(i.files)),c=a.next();!c.done;c=a.next()){var u=c.value;u.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:i.name,version:i.moduleVersion,fileName:u.name}),u.unpatch(u.moduleExports,i.moduleVersion))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}},n.prototype.isEnabled=function(){return this._enabled},n}(hZ);function NZ(e,t,n){return void 0===t?e.includes("*"):e.some(function(e){return sZ.satisfies(t,e,{includePrerelease:n})})}var CZ=function(e,t,n,r,s){this.name=e,this.supportedVersions=t,this.patch=n,this.unpatch=r,this.files=s||[]},OZ="true"===process.env.PRISMA_SHOW_ALL_TRACES;var IZ=class{tracerProvider;ignoreSpanTypes;constructor({tracerProvider:e,ignoreSpanTypes:t}){this.tracerProvider=e,this.ignoreSpanTypes=t}isEnabled(){return!0}getTraceParent(e){const t=Ht.getSpanContext(e??bt.active());return t?`00-${t.traceId}-${t.spanId}-0${t.traceFlags}`:"00-10-10-00"}dispatchEngineSpans(e){const t=this.tracerProvider.getTracer("prisma"),n=new Map,r=e.filter(e=>null===e.parentId);for(const s of r)PZ(t,s,e,n,this.ignoreSpanTypes)}getActiveContext(){return bt.active()}runInChildSpan(e,t){if("string"==typeof e&&(e={name:e}),e.internal&&!OZ)return t();const n=this.tracerProvider.getTracer("prisma"),r=e.context??this.getActiveContext(),s=`prisma:client:${e.name}`;if(wZ(s,this.ignoreSpanTypes))return t();if(!1===e.active){const o=n.startSpan(s,e,r);return LZ(o,t(o,r))}return n.startActiveSpan(s,e,e=>LZ(e,t(e,r)))}};function PZ(e,t,n,r,s){if(wZ(t.name,s))return;const o={attributes:t.attributes,kind:(i=t.kind,"client"===i?pt.CLIENT:pt.INTERNAL),startTime:t.startTime};var i;e.startActiveSpan(t.name,o,o=>{r.set(t.id,o.spanContext().spanId),t.links&&o.addLinks(t.links.flatMap(e=>{const t=r.get(e);return t?{context:{spanId:t,traceId:o.spanContext().traceId,traceFlags:o.spanContext().traceFlags}}:[]}));const i=n.filter(e=>e.parentId===t.id);for(const t of i)PZ(e,t,n,r,s);o.end(t.endTime)})}function LZ(e,t){return null!=(n=t)&&"function"==typeof n.then?t.then(t=>(e.end(),t),t=>{throw e.end(),t}):(e.end(),t);var n}function wZ(e,t){return t.some(t=>"string"==typeof t?t===e:t.test(e))}var MZ="@prisma/instrumentation",xZ="6.14.0",kZ=xZ.split(".")[0],GZ="PRISMA_INSTRUMENTATION",DZ=`V${kZ}_PRISMA_INSTRUMENTATION`,VZ=MZ,UZ=class extends vZ{tracerProvider;constructor(e={}){super(VZ,xZ,e)}setTracerProvider(e){this.tracerProvider=e}init(){return[new CZ("@prisma/client",[xZ])]}enable(){const e=this._config,t={helper:new IZ({tracerProvider:this.tracerProvider??Ht.getTracerProvider(),ignoreSpanTypes:e.ignoreSpanTypes??[]})};global[GZ]=t,global[DZ]=t}disable(){delete global[GZ],delete global[DZ]}isEnabled(){return Boolean(global[DZ])}};const HZ="Prisma";function jZ(){const e=globalThis.PRISMA_INSTRUMENTATION;return e&&"object"==typeof e&&"helper"in e?e.helper:void 0}class ZZ extends UZ{constructor(){super()}enable(){super.enable();const e=jZ();let t=!1;var n;(n=e)&&"object"==typeof n&&"dispatchEngineSpans"in n&&(e.createEngineSpan=()=>{_y(()=>{t||(t=!0,console.warn("[Sentry] The Sentry SDK supports tracing with Prisma version 5 only with limited capabilities. For full tracing capabilities pass `prismaInstrumentation` for version 5 to the Sentry `prismaIntegration`. Read more: https://docs.sentry.io/platforms/javascript/guides/node/configuration/integrations/prisma/"))})})}}const WZ=yO(HZ,e=>e?.prismaInstrumentation?e.prismaInstrumentation:new ZZ),XZ=({prismaInstrumentation:e}={})=>({name:HZ,setupOnce(){WZ({prismaInstrumentation:e})},setup(e){jZ()&&e.on("spanStart",e=>{const t=Nb(e);t.description?.startsWith("prisma:")&&e.setAttribute(ZT,"auto.db.otel.prisma"),"prisma:engine:db_query"===t.description&&t.data["db.query.text"]&&e.updateName(t.data["db.query.text"]),"prisma:engine:db_query"!==t.description||t.data["db.system"]||e.setAttribute("db.system","prisma")})}});var $Z={},FZ={},YZ={};Object.defineProperty(YZ,"__esModule",{value:!0}),YZ.PACKAGE_NAME=YZ.PACKAGE_VERSION=void 0,YZ.PACKAGE_VERSION="0.50.0",YZ.PACKAGE_NAME="@opentelemetry/instrumentation-hapi";var BZ={};Object.defineProperty(BZ,"__esModule",{value:!0}),BZ.HapiLifecycleMethodNames=BZ.HapiLayerType=BZ.handlerPatched=BZ.HapiComponentName=void 0,BZ.HapiComponentName="@hapi/hapi",BZ.handlerPatched=Symbol("hapi-handler-patched"),BZ.HapiLayerType={ROUTER:"router",PLUGIN:"plugin",EXT:"server.ext"},BZ.HapiLifecycleMethodNames=new Set(["onPreAuth","onCredentials","onPostAuth","onPreHandler","onPostHandler","onPreResponse","onRequest"]);var KZ={},JZ={};Object.defineProperty(JZ,"__esModule",{value:!0}),JZ.ATTR_HTTP_METHOD=void 0,JZ.ATTR_HTTP_METHOD="http.method";var zZ={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.HAPI_TYPE="hapi.type",e.PLUGIN_NAME="hapi.plugin.name",e.EXT_TYPE="server.ext.type"}(e.AttributeNames||(e.AttributeNames={}))}(zZ),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPluginFromInput=e.getExtMetadata=e.getRouteMetadata=e.isPatchableExtMethod=e.isDirectExtInput=e.isLifecycleExtEventObj=e.isLifecycleExtType=e.getPluginName=void 0;const t=GS,n=JZ,r=BZ,s=zZ,o=kS;e.getPluginName=function(e){return e.name?e.name:e.pkg.name};e.isLifecycleExtType=e=>"string"==typeof e&&r.HapiLifecycleMethodNames.has(e);e.isLifecycleExtEventObj=t=>{const n=t?.type;return void 0!==n&&(0,e.isLifecycleExtType)(n)};e.isDirectExtInput=t=>Array.isArray(t)&&t.length<=3&&(0,e.isLifecycleExtType)(t[0])&&"function"==typeof t[1];e.isPatchableExtMethod=e=>!Array.isArray(e);e.getRouteMetadata=(e,i,a)=>{const c={[t.ATTR_HTTP_ROUTE]:e.path};let u;return i&o.SemconvStability.OLD&&(c[n.ATTR_HTTP_METHOD]=e.method),i&o.SemconvStability.STABLE&&(c[t.ATTR_HTTP_REQUEST_METHOD]=e.method),a?(c[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.PLUGIN,c[s.AttributeNames.PLUGIN_NAME]=a,u=`${a}: route - ${e.path}`):(c[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.ROUTER,u=`route - ${e.path}`),{attributes:c,name:u}};e.getExtMetadata=(e,t)=>t?{attributes:{[s.AttributeNames.EXT_TYPE]:e,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT,[s.AttributeNames.PLUGIN_NAME]:t},name:`${t}: ext - ${e}`}:{attributes:{[s.AttributeNames.EXT_TYPE]:e,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT},name:`ext - ${e}`};e.getPluginFromInput=e=>"plugin"in e?"plugin"in e.plugin?e.plugin.plugin:e.plugin:e}(KZ),Object.defineProperty(FZ,"__esModule",{value:!0}),FZ.HapiInstrumentation=void 0;const QZ=Ft,qZ=Q_,eW=kS,tW=YZ,nW=BZ,rW=KZ;class sW extends eW.InstrumentationBase{_semconvStability;constructor(e={}){super(tW.PACKAGE_NAME,tW.PACKAGE_VERSION,e),this._semconvStability=(0,eW.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return new eW.InstrumentationNodeModuleDefinition(nW.HapiComponentName,[">=17.0.0 <22"],e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;return(0,eW.isWrapped)(t.server)||this._wrap(t,"server",this._getServerPatch.bind(this)),(0,eW.isWrapped)(t.Server)||this._wrap(t,"Server",this._getServerPatch.bind(this)),t},e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;this._massUnwrap([t],["server","Server"])})}_getServerPatch(e){const t=this,n=this;return function(r){const s=e.apply(this,[r]);return n._wrap(s,"route",e=>t._getServerRoutePatch.bind(t)(e)),n._wrap(s,"ext",e=>t._getServerExtPatch.bind(t)(e)),n._wrap(s,"register",t._getServerRegisterPatch.bind(t)),s}}_getServerRegisterPatch(e){const t=this;return function(n,r){if(Array.isArray(n))for(const e of n){const n=(0,rW.getPluginFromInput)(e);t._wrapRegisterHandler(n)}else{const e=(0,rW.getPluginFromInput)(n);t._wrapRegisterHandler(e)}return e.apply(this,[n,r])}}_getServerExtPatch(e,t){const n=this;return function(...r){if(Array.isArray(r[0])){const s=r[0];for(let e=0;e<s.length;e++){const r=s[e];if((0,rW.isLifecycleExtType)(r.type)){const o=r,i=n._wrapExtMethods(o.method,r.type,t);o.method=i,s[e]=o}}return e.apply(this,r)}if((0,rW.isDirectExtInput)(r)){const s=r,o=s[1],i=n._wrapExtMethods(o,s[0],t);return e.apply(this,[s[0],i,s[2]])}if((0,rW.isLifecycleExtEventObj)(r[0])){const s=r[0],o=n._wrapExtMethods(s.method,s.type,t);return s.method=o,e.call(this,s)}return e.apply(this,r)}}_getServerRoutePatch(e,t){const n=this;return function(r){if(Array.isArray(r))for(let e=0;e<r.length;e++){const s=n._wrapRouteHandler.call(n,r[e],t);r[e]=s}else r=n._wrapRouteHandler.call(n,r,t);return e.apply(this,[r])}}_wrapRegisterHandler(e){const t=this,n=(0,rW.getPluginName)(e),r=e.register,s=this;e.register=function(e,o){return s._wrap(e,"route",e=>t._getServerRoutePatch.bind(t)(e,n)),s._wrap(e,"ext",e=>t._getServerExtPatch.bind(t)(e,n)),r.call(this,e,o)}}_wrapExtMethods(e,t,n){const r=this;if(e instanceof Array){for(let n=0;n<e.length;n++)e[n]=r._wrapExtMethods(e[n],t);return e}if((0,rW.isPatchableExtMethod)(e)){if(!0===e[nW.handlerPatched])return e;e[nW.handlerPatched]=!0;return async function(...s){if(void 0===QZ.trace.getSpan(QZ.context.active()))return await e.apply(this,s);const o=(0,rW.getExtMetadata)(t,n),i=r.tracer.startSpan(o.name,{attributes:o.attributes});try{return await QZ.context.with(QZ.trace.setSpan(QZ.context.active(),i),e,void 0,...s)}catch(e){throw i.recordException(e),i.setStatus({code:QZ.SpanStatusCode.ERROR,message:e.message}),e}finally{i.end()}}}return e}_wrapRouteHandler(e,t){const n=this;if(!0===e[nW.handlerPatched])return e;e[nW.handlerPatched]=!0;const r=r=>async function(...s){if(void 0===QZ.trace.getSpan(QZ.context.active()))return await r.call(this,...s);const o=(0,qZ.getRPCMetadata)(QZ.context.active());o?.type===qZ.RPCType.HTTP&&(o.route=e.path);const i=(0,rW.getRouteMetadata)(e,n._semconvStability,t),a=n.tracer.startSpan(i.name,{attributes:i.attributes});try{return await QZ.context.with(QZ.trace.setSpan(QZ.context.active(),a),()=>r.call(this,...s))}catch(e){throw a.recordException(e),a.setStatus({code:QZ.SpanStatusCode.ERROR,message:e.message}),e}finally{a.end()}};if("function"==typeof e.handler)e.handler=r(e.handler);else if("function"==typeof e.options){const t=e.options;e.options=function(e){const n=t(e);return"function"==typeof n.handler&&(n.handler=r(n.handler)),n}}else"function"==typeof e.options?.handler&&(e.options.handler=r(e.options.handler));return e}}FZ.HapiInstrumentation=sW,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.HapiInstrumentation=void 0;var t=FZ;Object.defineProperty(e,"HapiInstrumentation",{enumerable:!0,get:function(){return t.HapiInstrumentation}});var n=zZ;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})}($Z);const oW="Hapi",iW=yO(oW,()=>new $Z.HapiInstrumentation),aW=()=>({name:oW,setupOnce(){iW()}});const cW={name:"SentryHapiErrorPlugin",version:ly,register:async function(e){e.events.on({name:"request",channels:["error"]},(e,t)=>{if(MT()!==vT()){const t=e.route;t.path&&MT().setTransactionName(`${t.method.toUpperCase()} ${t.path}`)}else SM&&yy.warn("Isolation scope is still the default isolation scope - skipping setting transactionName");(function(e){return!!(e&&"object"==typeof e&&"error"in e&&e.error)})(t)&&XA(t.error,{mechanism:{type:"hapi",handled:!1,data:{function:"hapiErrorPlugin"}}})})}};var uW={},lW={},pW={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=void 0,(t=e.KoaLayerType||(e.KoaLayerType={})).ROUTER="router",t.MIDDLEWARE="middleware"}(pW);var dW={};Object.defineProperty(dW,"__esModule",{value:!0}),dW.PACKAGE_NAME=dW.PACKAGE_VERSION=void 0,dW.PACKAGE_VERSION="0.51.0",dW.PACKAGE_NAME="@opentelemetry/instrumentation-koa";var hW={},mW={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,function(e){e.KOA_TYPE="koa.type",e.KOA_NAME="koa.name"}(e.AttributeNames||(e.AttributeNames={}))}(mW),Object.defineProperty(hW,"__esModule",{value:!0}),hW.isLayerIgnored=hW.getMiddlewareMetadata=void 0;const fW=pW,_W=mW,gW=GS;hW.getMiddlewareMetadata=(e,t,n,r)=>n?{attributes:{[_W.AttributeNames.KOA_NAME]:r?.toString(),[_W.AttributeNames.KOA_TYPE]:fW.KoaLayerType.ROUTER,[gW.SEMATTRS_HTTP_ROUTE]:r?.toString()},name:e._matchedRouteName||`router - ${r}`}:{attributes:{[_W.AttributeNames.KOA_NAME]:t.name??"middleware",[_W.AttributeNames.KOA_TYPE]:fW.KoaLayerType.MIDDLEWARE},name:`middleware - ${t.name}`};hW.isLayerIgnored=(e,t)=>!(!Array.isArray(t?.ignoreLayersType)||!t?.ignoreLayersType?.includes(e));var EW={};Object.defineProperty(EW,"__esModule",{value:!0}),EW.kLayerPatched=void 0,EW.kLayerPatched=Symbol("koa-layer-patched"),Object.defineProperty(lW,"__esModule",{value:!0}),lW.KoaInstrumentation=void 0;const SW=Ft,yW=kS,TW=pW,bW=dW,AW=hW,RW=Q_,vW=EW;class NW extends yW.InstrumentationBase{constructor(e={}){super(bW.PACKAGE_NAME,bW.PACKAGE_VERSION,e)}init(){return new yW.InstrumentationNodeModuleDefinition("koa",[">=2.0.0 <3"],e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;return null==t?t:((0,yW.isWrapped)(t.prototype.use)&&this._unwrap(t.prototype,"use"),this._wrap(t.prototype,"use",this._getKoaUsePatch.bind(this)),e)},e=>{const t="Module"===e[Symbol.toStringTag]?e.default:e;(0,yW.isWrapped)(t.prototype.use)&&this._unwrap(t.prototype,"use")})}_getKoaUsePatch(e){const t=this;return function(n){let r;return r=n.router?t._patchRouterDispatch(n):t._patchLayer(n,!1),e.apply(this,[r])}}_patchRouterDispatch(e){SW.diag.debug("Patching @koa/router dispatch");const t=e.router,n=t?.stack??[];for(const e of n){const t=e.path,n=e.stack;for(let e=0;e<n.length;e++){const r=n[e];n[e]=this._patchLayer(r,!0,t)}}return e}_patchLayer(e,t,n){const r=t?TW.KoaLayerType.ROUTER:TW.KoaLayerType.MIDDLEWARE;return!0===e[vW.kLayerPatched]||(0,AW.isLayerIgnored)(r,this.getConfig())?e:"GeneratorFunction"===e.constructor.name||"AsyncGeneratorFunction"===e.constructor.name?(SW.diag.debug("ignoring generator-based Koa middleware layer"),e):(e[vW.kLayerPatched]=!0,SW.diag.debug("patching Koa middleware layer"),async(s,o)=>{if(void 0===SW.trace.getSpan(SW.context.active()))return e(s,o);const i=(0,AW.getMiddlewareMetadata)(s,e,t,n),a=this.tracer.startSpan(i.name,{attributes:i.attributes}),c=(0,RW.getRPCMetadata)(SW.context.active());c?.type===RW.RPCType.HTTP&&s._matchedRoute&&(c.route=s._matchedRoute.toString());const{requestHook:u}=this.getConfig();u&&(0,yW.safeExecuteInTheMiddle)(()=>u(a,{context:s,middlewareLayer:e,layerType:r}),e=>{e&&SW.diag.error("koa instrumentation: request hook failed",e)},!0);const l=SW.trace.setSpan(SW.context.active(),a);return SW.context.with(l,async()=>{try{return await e(s,o)}catch(e){throw a.recordException(e),e}finally{a.end()}})})}}lW.KoaInstrumentation=NW,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=e.AttributeNames=e.KoaInstrumentation=void 0;var t=lW;Object.defineProperty(e,"KoaInstrumentation",{enumerable:!0,get:function(){return t.KoaInstrumentation}});var n=mW;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}});var r=pW;Object.defineProperty(e,"KoaLayerType",{enumerable:!0,get:function(){return r.KoaLayerType}})}(uW);const CW=yO("Koa",uW.KoaInstrumentation,(e={})=>({ignoreLayersType:e.ignoreLayersType,requestHook(e,t){iw(e,"auto.http.otel.koa");const n=Nb(e).data,r=n["koa.type"];r&&e.setAttribute(jT,`${r}.koa`);const s=n["koa.name"];if("string"==typeof s&&e.updateName(s||"< unknown >"),MT()===vT())return void(SM&&yy.warn("Isolation scope is default isolation scope - skipping setting transactionName"));const o=n[Ff],i=t.context?.request?.method?.toUpperCase()||"GET";o&&MT().setTransactionName(`${i} ${o}`)}})),OW=(e={})=>({name:"Koa",setupOnce(){CW(e)}});var IW={},PW={},LW={};!function(e){var t,n;Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectNames=e.ConnectTypes=e.AttributeNames=void 0,function(e){e.CONNECT_TYPE="connect.type",e.CONNECT_NAME="connect.name"}(e.AttributeNames||(e.AttributeNames={})),(t=e.ConnectTypes||(e.ConnectTypes={})).MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler",(n=e.ConnectNames||(e.ConnectNames={})).MIDDLEWARE="middleware",n.REQUEST_HANDLER="request handler"}(LW);var wW={};Object.defineProperty(wW,"__esModule",{value:!0}),wW.PACKAGE_NAME=wW.PACKAGE_VERSION=void 0,wW.PACKAGE_VERSION="0.47.0",wW.PACKAGE_NAME="@opentelemetry/instrumentation-connect";var MW={},xW={};Object.defineProperty(xW,"__esModule",{value:!0}),xW._LAYERS_STORE_PROPERTY=void 0,xW._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack"),Object.defineProperty(MW,"__esModule",{value:!0}),MW.generateRoute=MW.replaceCurrentStackRoute=MW.addNewStackLayer=void 0;const kW=Ft,GW=xW;MW.addNewStackLayer=e=>{!1===Array.isArray(e[GW._LAYERS_STORE_PROPERTY])&&Object.defineProperty(e,GW._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),e[GW._LAYERS_STORE_PROPERTY].push("/");const t=e[GW._LAYERS_STORE_PROPERTY].length;return()=>{t===e[GW._LAYERS_STORE_PROPERTY].length?e[GW._LAYERS_STORE_PROPERTY].pop():kW.diag.warn("Connect: Trying to pop the stack multiple time")}};MW.replaceCurrentStackRoute=(e,t)=>{t&&e[GW._LAYERS_STORE_PROPERTY].splice(-1,1,t)};MW.generateRoute=e=>e[GW._LAYERS_STORE_PROPERTY].reduce((e,t)=>e.replace(/\/+$/,"")+t),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectInstrumentation=e.ANONYMOUS_NAME=void 0;const t=Ft,n=Q_,r=LW,s=wW,o=kS,i=GS,a=MW;e.ANONYMOUS_NAME="anonymous";class c extends o.InstrumentationBase{constructor(e={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,e)}init(){return[new o.InstrumentationNodeModuleDefinition("connect",[">=3.0.0 <4"],e=>this._patchConstructor(e))]}_patchApp(e){(0,o.isWrapped)(e.use)||this._wrap(e,"use",this._patchUse.bind(this)),(0,o.isWrapped)(e.handle)||this._wrap(e,"handle",this._patchHandle.bind(this))}_patchConstructor(e){const t=this;return function(...n){const r=e.apply(this,n);return t._patchApp(r),r}}_patchNext(e,t){return function(n){const r=e.apply(this,[n]);return t(),r}}_startSpan(t,n){let s,o,a;t?(s=r.ConnectTypes.REQUEST_HANDLER,a=r.ConnectNames.REQUEST_HANDLER,o=t):(s=r.ConnectTypes.MIDDLEWARE,a=r.ConnectNames.MIDDLEWARE,o=n.name||e.ANONYMOUS_NAME);const c=`${a} - ${o}`,u={attributes:{[i.ATTR_HTTP_ROUTE]:t.length>0?t:"/",[r.AttributeNames.CONNECT_TYPE]:s,[r.AttributeNames.CONNECT_NAME]:o}};return this.tracer.startSpan(c,u)}_patchMiddleware(r,s){const o=this,i=4===s.length;function c(){if(!o.isEnabled())return s.apply(this,arguments);const[c,u,l]=i?[1,2,3]:[0,1,2],p=arguments[c],d=arguments[u],h=arguments[l];(0,a.replaceCurrentStackRoute)(p,r);const m=(0,n.getRPCMetadata)(t.context.active());r&&m?.type===n.RPCType.HTTP&&(m.route=(0,a.generateRoute)(p));let f="";f=r?`request handler - ${r}`:`middleware - ${s.name||e.ANONYMOUS_NAME}`;const _=o._startSpan(r,s);o._diag.debug("start span",f);let g=!1;function E(){g?o._diag.debug(`span ${_.name} - already finished`):(g=!0,o._diag.debug(`finishing span ${_.name}`),_.end()),d.removeListener("close",E)}return d.addListener("close",E),arguments[l]=o._patchNext(h,E),s.apply(this,arguments)}return Object.defineProperty(c,"length",{value:s.length,writable:!1,configurable:!0}),c}_patchUse(e){const t=this;return function(...n){const r=n[n.length-1],s=n[n.length-2]||"";return n[n.length-1]=t._patchMiddleware(s,r),e.apply(this,n)}}_patchHandle(e){const t=this;return function(){const[n,r]=[0,2],s=arguments[n],o=arguments[r],i=(0,a.addNewStackLayer)(s);return"function"==typeof o&&(arguments[r]=t._patchOut(o,i)),e.apply(this,arguments)}}_patchOut(e,t){return function(...n){return t(),Reflect.apply(e,this,n)}}}e.ConnectInstrumentation=c}(PW),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectTypes=e.ConnectNames=e.AttributeNames=e.ANONYMOUS_NAME=e.ConnectInstrumentation=void 0;var t=PW;Object.defineProperty(e,"ConnectInstrumentation",{enumerable:!0,get:function(){return t.ConnectInstrumentation}}),Object.defineProperty(e,"ANONYMOUS_NAME",{enumerable:!0,get:function(){return t.ANONYMOUS_NAME}});var n=LW;Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}}),Object.defineProperty(e,"ConnectNames",{enumerable:!0,get:function(){return n.ConnectNames}}),Object.defineProperty(e,"ConnectTypes",{enumerable:!0,get:function(){return n.ConnectTypes}})}(IW);const DW="Connect",VW=yO(DW,()=>new IW.ConnectInstrumentation),UW=()=>({name:DW,setupOnce(){VW()}});function HW(e,t,n,r){XA(e),r(e)}var jW={},ZW={},WW={};Object.defineProperty(WW,"__esModule",{value:!0}),WW.PACKAGE_NAME=WW.PACKAGE_VERSION=void 0,WW.PACKAGE_VERSION="0.48.0",WW.PACKAGE_NAME="@opentelemetry/instrumentation-knex";var XW={};Object.defineProperty(XW,"__esModule",{value:!0}),XW.SUPPORTED_VERSIONS=XW.MODULE_NAME=void 0,XW.MODULE_NAME="knex",XW.SUPPORTED_VERSIONS=[">=0.22.0 <4",">=0.10.0 <0.18.0",">=0.19.0 <0.22.0",">=0.18.0 <0.19.0"];var $W={},FW={};Object.defineProperty(FW,"__esModule",{value:!0}),FW.DB_SYSTEM_NAME_VALUE_SQLITE=void 0,FW.DB_SYSTEM_NAME_VALUE_SQLITE="sqlite",function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extractTableName=e.limitLength=e.getName=e.mapSystem=e.otelExceptionFromKnexError=e.getFormatter=void 0;const t=GS,n=FW;e.getFormatter=e=>{if(e){if(e.client){if(e.client._formatQuery)return e.client._formatQuery.bind(e.client);if(e.client.SqlString)return e.client.SqlString.format.bind(e.client.SqlString)}if(e.builder)return e.builder.toString.bind(e.builder)}return()=>"<noop formatter>"},e.otelExceptionFromKnexError=function(e,t){return e&&e instanceof Error?{message:t,code:e.code,stack:e.stack,name:e.name}:e};const r=new Map([["sqlite3",n.DB_SYSTEM_NAME_VALUE_SQLITE],["pg",t.DB_SYSTEM_NAME_VALUE_POSTGRESQL]]);e.mapSystem=e=>r.get(e)||e;e.getName=(e,t,n)=>t?n?`${t} ${e}.${n}`:`${t} ${e}`:e;e.limitLength=(e,t)=>"string"==typeof e&&"number"==typeof t&&0<t&&t<e.length?e.substring(0,t)+"..":e;e.extractTableName=t=>{const n=t?._single?.table;return"object"==typeof n?(0,e.extractTableName)(n):n}}($W),Object.defineProperty(ZW,"__esModule",{value:!0}),ZW.KnexInstrumentation=void 0;const YW=Ft,BW=WW,KW=XW,JW=kS,zW=$W,QW=GS,qW=Symbol("opentelemetry.instrumentation-knex.context"),eX={maxQueryLength:1022,requireParentSpan:!1};class tX extends JW.InstrumentationBase{_semconvStability;constructor(e={}){super(BW.PACKAGE_NAME,BW.PACKAGE_VERSION,{...eX,...e}),this._semconvStability=(0,JW.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(e={}){super.setConfig({...eX,...e})}init(){const e=new JW.InstrumentationNodeModuleDefinition(KW.MODULE_NAME,KW.SUPPORTED_VERSIONS);return e.files.push(this.getClientNodeModuleFileInstrumentation("src"),this.getClientNodeModuleFileInstrumentation("lib"),this.getRunnerNodeModuleFileInstrumentation("src"),this.getRunnerNodeModuleFileInstrumentation("lib"),this.getRunnerNodeModuleFileInstrumentation("lib/execution")),e}getRunnerNodeModuleFileInstrumentation(e){return new JW.InstrumentationNodeModuleFile(`knex/${e}/runner.js`,KW.SUPPORTED_VERSIONS,(e,t)=>(this.ensureWrapped(e.prototype,"query",this.createQueryWrapper(t)),e),(e,t)=>(this._unwrap(e.prototype,"query"),e))}getClientNodeModuleFileInstrumentation(e){return new JW.InstrumentationNodeModuleFile(`knex/${e}/client.js`,KW.SUPPORTED_VERSIONS,e=>(this.ensureWrapped(e.prototype,"queryBuilder",this.storeContext.bind(this)),this.ensureWrapped(e.prototype,"schemaBuilder",this.storeContext.bind(this)),this.ensureWrapped(e.prototype,"raw",this.storeContext.bind(this)),e),e=>(this._unwrap(e.prototype,"queryBuilder"),this._unwrap(e.prototype,"schemaBuilder"),this._unwrap(e.prototype,"raw"),e))}createQueryWrapper(e){const t=this;return function(n){return function(r){const s=this.client.config,o=zW.extractTableName(this.builder),i=r?.method,a=s?.connection?.filename||s?.connection?.database,{maxQueryLength:c}=t.getConfig(),u={"knex.version":e},l=":memory:"===s?.connection?.filename?"inproc":void 0;if(t._semconvStability&JW.SemconvStability.OLD&&Object.assign(u,{[QW.SEMATTRS_DB_SYSTEM]:zW.mapSystem(s.client),[QW.SEMATTRS_DB_SQL_TABLE]:o,[QW.SEMATTRS_DB_OPERATION]:i,[QW.SEMATTRS_DB_USER]:s?.connection?.user,[QW.SEMATTRS_DB_NAME]:a,[QW.SEMATTRS_NET_PEER_NAME]:s?.connection?.host,[QW.SEMATTRS_NET_PEER_PORT]:s?.connection?.port,[QW.SEMATTRS_NET_TRANSPORT]:l}),t._semconvStability&JW.SemconvStability.STABLE&&Object.assign(u,{[QW.ATTR_DB_SYSTEM_NAME]:zW.mapSystem(s.client),[QW.ATTR_DB_COLLECTION_NAME]:o,[QW.ATTR_DB_OPERATION_NAME]:i,[QW.ATTR_DB_NAMESPACE]:a,[QW.ATTR_SERVER_ADDRESS]:s?.connection?.host,[QW.ATTR_SERVER_PORT]:s?.connection?.port}),c){const e=zW.limitLength(r?.sql,c);t._semconvStability&JW.SemconvStability.STABLE&&(u[QW.ATTR_DB_QUERY_TEXT]=e),t._semconvStability&JW.SemconvStability.OLD&&(u[QW.SEMATTRS_DB_STATEMENT]=e)}const p=this.builder[qW]||YW.context.active(),d=YW.trace.getSpan(p),h=d&&YW.trace.isSpanContextValid(d.spanContext());if(t._config.requireParentSpan&&!h)return n.bind(this)(...arguments);const m=t.tracer.startSpan(zW.getName(a,i,o),{kind:YW.SpanKind.CLIENT,attributes:u},p),f=YW.trace.setSpan(YW.context.active(),m);return YW.context.with(f,n,this,...arguments).then(e=>(m.end(),e)).catch(e=>{const t=zW.getFormatter(this)(r.sql,r.bindings||[]),n=e.message.replace(t+" - ",""),s=zW.otelExceptionFromKnexError(e,n);throw m.recordException(s),m.setStatus({code:YW.SpanStatusCode.ERROR,message:n}),m.end(),e})}}}storeContext(e){return function(){const t=e.apply(this,arguments);return Object.defineProperty(t,qW,{value:YW.context.active()}),t}}ensureWrapped(e,t,n){(0,JW.isWrapped)(e[t])&&this._unwrap(e,t),this._wrap(e,t,n)}}ZW.KnexInstrumentation=tX,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KnexInstrumentation=void 0;var t=ZW;Object.defineProperty(e,"KnexInstrumentation",{enumerable:!0,get:function(){return t.KnexInstrumentation}})}(jW);const nX="Knex",rX=yO(nX,()=>new jW.KnexInstrumentation({requireParentSpan:!0})),sX=()=>{let e;return{name:nX,setupOnce(){const t=rX();e=TO(t)},setup(t){e?.(()=>t.on("spanStart",e=>{const{data:t}=Nb(e);"knex.version"in t&&e.setAttribute(ZT,"auto.db.otel.knex")}))}}};var oX={},iX={},aX={};Object.defineProperty(aX,"__esModule",{value:!0}),aX.once=aX.getSpanName=void 0,aX.getSpanName=function(e,t,n,r){return"execBulkLoad"===e&&r&&t?`${e} ${r} ${t}`:"callProcedure"===e?t?`${e} ${n} ${t}`:`${e} ${n}`:t?`${e} ${t}`:`${e}`};aX.once=e=>{let t=!1;return(...n)=>{if(!t)return t=!0,e(...n)}};var cX={};Object.defineProperty(cX,"__esModule",{value:!0}),cX.PACKAGE_NAME=cX.PACKAGE_VERSION=void 0,cX.PACKAGE_VERSION="0.22.0",cX.PACKAGE_NAME="@opentelemetry/instrumentation-tedious",Object.defineProperty(iX,"__esModule",{value:!0}),iX.TediousInstrumentation=void 0;const uX=Ft,lX=l,pX=kS,dX=GS,hX=aX,mX=cX,fX=Symbol("opentelemetry.instrumentation-tedious.current-database"),_X=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function gX(e){Object.defineProperty(this,fX,{value:e,writable:!0})}class EX extends pX.InstrumentationBase{static COMPONENT="tedious";constructor(e={}){super(mX.PACKAGE_NAME,mX.PACKAGE_VERSION,e)}init(){return[new pX.InstrumentationNodeModuleDefinition(EX.COMPONENT,[">=1.11.0 <20"],e=>{const t=e.Connection.prototype;for(const e of _X)(0,pX.isWrapped)(t[e])&&this._unwrap(t,e),this._wrap(t,e,this._patchQuery(e));return(0,pX.isWrapped)(t.connect)&&this._unwrap(t,"connect"),this._wrap(t,"connect",this._patchConnect),e},e=>{if(void 0===e)return;const t=e.Connection.prototype;for(const e of _X)this._unwrap(t,e);this._unwrap(t,"connect")})]}_patchConnect(e){return function(){return gX.call(this,this.config?.options?.database),this.removeListener("databaseChange",gX),this.on("databaseChange",gX),this.once("end",()=>{this.removeListener("databaseChange",gX)}),e.apply(this,arguments)}}_patchQuery(e){return t=>{const n=this;function r(r){if(!(r instanceof lX.EventEmitter))return n._diag.warn(`Unexpected invocation of patched ${e} method. Span not recorded`),t.apply(this,arguments);let s=0,o=0;const i=()=>o++,a=()=>s++,c=this[fX],u=(e=>"sp_prepare"===e.sqlTextOrProcedure&&e.parametersByName?.stmt?.value?e.parametersByName.stmt.value:e.sqlTextOrProcedure)(r),l=n.tracer.startSpan((0,hX.getSpanName)(e,c,u,r.table),{kind:uX.SpanKind.CLIENT,attributes:{[dX.SEMATTRS_DB_SYSTEM]:dX.DBSYSTEMVALUES_MSSQL,[dX.SEMATTRS_DB_NAME]:c,[dX.SEMATTRS_NET_PEER_PORT]:this.config?.options?.port,[dX.SEMATTRS_NET_PEER_NAME]:this.config?.server,[dX.SEMATTRS_DB_USER]:this.config?.userName??this.config?.authentication?.options?.userName,[dX.SEMATTRS_DB_STATEMENT]:u,[dX.SEMATTRS_DB_SQL_TABLE]:r.table}}),p=(0,hX.once)(e=>{r.removeListener("done",i),r.removeListener("doneInProc",i),r.removeListener("doneProc",a),r.removeListener("error",p),this.removeListener("end",p),l.setAttribute("tedious.procedure_count",s),l.setAttribute("tedious.statement_count",o),e&&l.setStatus({code:uX.SpanStatusCode.ERROR,message:e.message}),l.end()});return r.on("done",i),r.on("doneInProc",i),r.on("doneProc",a),r.once("error",p),this.on("end",p),"function"==typeof r.callback?n._wrap(r,"callback",n._patchCallbackQuery(p)):n._diag.error("Expected request.callback to be a function"),uX.context.with(uX.trace.setSpan(uX.context.active(),l),t,this,...arguments)}return Object.defineProperty(r,"length",{value:t.length,writable:!1}),r}}_patchCallbackQuery(e){return t=>function(n,r,s){return e(n),t.apply(this,arguments)}}}iX.TediousInstrumentation=EX,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=void 0;var t=iX;Object.defineProperty(e,"TediousInstrumentation",{enumerable:!0,get:function(){return t.TediousInstrumentation}})}(oX);const SX=new Set(["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"]),yX="Tedious",TX=yO(yX,()=>new oX.TediousInstrumentation({})),bX=()=>{let e;return{name:yX,setupOnce(){const t=TX();e=TO(t)},setup(t){e?.(()=>t.on("spanStart",e=>{const{description:t,data:n}=Nb(e);if(!t||"mssql"!==n["db.system"])return;const r=t.split(" ")[0]||"";SX.has(r)&&e.setAttribute(ZT,"auto.db.otel.tedious")}))}}};var AX={},RX={},vX={};Object.defineProperty(vX,"__esModule",{value:!0}),vX.PACKAGE_NAME=vX.PACKAGE_VERSION=void 0,vX.PACKAGE_VERSION="0.47.0",vX.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool",Object.defineProperty(RX,"__esModule",{value:!0}),RX.GenericPoolInstrumentation=void 0;const NX=Ft,CX=kS,OX=vX,IX="generic-pool";class PX extends CX.InstrumentationBase{_isDisabled=!1;constructor(e={}){super(OX.PACKAGE_NAME,OX.PACKAGE_VERSION,e)}init(){return[new CX.InstrumentationNodeModuleDefinition(IX,[">=3.0.0 <4"],e=>{const t=e.Pool;return(0,CX.isWrapped)(t.prototype.acquire)&&this._unwrap(t.prototype,"acquire"),this._wrap(t.prototype,"acquire",this._acquirePatcher.bind(this)),e},e=>{const t=e.Pool;return this._unwrap(t.prototype,"acquire"),e}),new CX.InstrumentationNodeModuleDefinition(IX,[">=2.4.0 <3"],e=>{const t=e.Pool;return(0,CX.isWrapped)(t.prototype.acquire)&&this._unwrap(t.prototype,"acquire"),this._wrap(t.prototype,"acquire",this._acquireWithCallbacksPatcher.bind(this)),e},e=>{const t=e.Pool;return this._unwrap(t.prototype,"acquire"),e}),new CX.InstrumentationNodeModuleDefinition(IX,[">=2.0.0 <2.4"],e=>(this._isDisabled=!1,(0,CX.isWrapped)(e.Pool)&&this._unwrap(e,"Pool"),this._wrap(e,"Pool",this._poolWrapper.bind(this)),e),e=>(this._isDisabled=!0,e))]}_acquirePatcher(e){const t=this;return function(...n){const r=NX.context.active(),s=t.tracer.startSpan("generic-pool.acquire",{},r);return NX.context.with(NX.trace.setSpan(r,s),()=>e.call(this,...n).then(e=>(s.end(),e),e=>{throw s.recordException(e),s.end(),e}))}}_poolWrapper(e){const t=this;return function(){const n=e.apply(this,arguments);return t._wrap(n,"acquire",t._acquireWithCallbacksPatcher.bind(t)),n}}_acquireWithCallbacksPatcher(e){const t=this;return function(n,r){if(t._isDisabled)return e.call(this,n,r);const s=NX.context.active(),o=t.tracer.startSpan("generic-pool.acquire",{},s);return NX.context.with(NX.trace.setSpan(s,o),()=>{e.call(this,(e,t)=>{if(o.end(),n)return n(e,t)},r)})}}}RX.GenericPoolInstrumentation=PX,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenericPoolInstrumentation=void 0;var t=RX;Object.defineProperty(e,"GenericPoolInstrumentation",{enumerable:!0,get:function(){return t.GenericPoolInstrumentation}})}(AX);const LX="GenericPool",wX=yO(LX,()=>new AX.GenericPoolInstrumentation({})),MX=()=>{let e;return{name:LX,setupOnce(){const t=wX();e=TO(t)},setup(t){e?.(()=>t.on("spanStart",e=>{const t=Nb(e).description;("generic-pool.aquire"===t||"generic-pool.acquire"===t)&&e.setAttribute(ZT,"auto.db.otel.generic_pool")}))}}};var xX={},kX={},GX={};Object.defineProperty(GX,"__esModule",{value:!0}),GX.PACKAGE_NAME=GX.PACKAGE_VERSION=void 0,GX.PACKAGE_VERSION="0.21.1",GX.PACKAGE_NAME="@opentelemetry/instrumentation-dataloader",Object.defineProperty(kX,"__esModule",{value:!0}),kX.DataloaderInstrumentation=void 0;const DX=kS,VX=Ft,UX=GX,HX="dataloader";function jX(e){return"Module"===e[Symbol.toStringTag]?e.default:e}class ZX extends DX.InstrumentationBase{constructor(e={}){super(UX.PACKAGE_NAME,UX.PACKAGE_VERSION,e)}init(){return[new DX.InstrumentationNodeModuleDefinition(HX,[">=2.0.0 <3"],e=>{const t=jX(e);return this._patchLoad(t.prototype),this._patchLoadMany(t.prototype),this._patchPrime(t.prototype),this._patchClear(t.prototype),this._patchClearAll(t.prototype),this._getPatchedConstructor(t)},e=>{const t=jX(e);["load","loadMany","prime","clear","clearAll"].forEach(e=>{(0,DX.isWrapped)(t.prototype[e])&&this._unwrap(t.prototype,e)})})]}shouldCreateSpans(){const e=this.getConfig();return void 0!==VX.trace.getSpan(VX.context.active())||!e.requireParentSpan}getSpanName(e,t){const n=e.name;return null==n?`${HX}.${t}`:`${HX}.${t} ${n}`}_wrapBatchLoadFn(e){const t=this;return function(...n){if(!t.isEnabled()||!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"batch"),{links:this._batch?.spanLinks},r);return VX.context.with(VX.trace.setSpan(r,s),()=>e.apply(this,n).then(e=>(s.end(),e)).catch(e=>{throw s.recordException(e),s.setStatus({code:VX.SpanStatusCode.ERROR,message:e.message}),s.end(),e}))}}_getPatchedConstructor(e){const t=this,n=e.prototype;if(!t.isEnabled())return e;function r(...n){return"function"==typeof n[0]&&((0,DX.isWrapped)(n[0])&&t._unwrap(n,0),n[0]=t._wrapBatchLoadFn(n[0])),e.apply(this,n)}return r.prototype=n,r}_patchLoad(e){(0,DX.isWrapped)(e.load)&&this._unwrap(e,"load"),this._wrap(e,"load",this._getPatchedLoad.bind(this))}_getPatchedLoad(e){const t=this;return function(...n){if(!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"load"),{kind:VX.SpanKind.CLIENT},r);return VX.context.with(VX.trace.setSpan(r,s),()=>{const t=e.call(this,...n).then(e=>(s.end(),e)).catch(e=>{throw s.recordException(e),s.setStatus({code:VX.SpanStatusCode.ERROR,message:e.message}),s.end(),e}),r=this;return r._batch&&(r._batch.spanLinks||(r._batch.spanLinks=[]),r._batch.spanLinks.push({context:s.spanContext()})),t})}}_patchLoadMany(e){(0,DX.isWrapped)(e.loadMany)&&this._unwrap(e,"loadMany"),this._wrap(e,"loadMany",this._getPatchedLoadMany.bind(this))}_getPatchedLoadMany(e){const t=this;return function(...n){if(!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"loadMany"),{kind:VX.SpanKind.CLIENT},r);return VX.context.with(VX.trace.setSpan(r,s),()=>e.call(this,...n).then(e=>(s.end(),e)))}}_patchPrime(e){(0,DX.isWrapped)(e.prime)&&this._unwrap(e,"prime"),this._wrap(e,"prime",this._getPatchedPrime.bind(this))}_getPatchedPrime(e){const t=this;return function(...n){if(!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"prime"),{kind:VX.SpanKind.CLIENT},r),o=VX.context.with(VX.trace.setSpan(r,s),()=>e.call(this,...n));return s.end(),o}}_patchClear(e){(0,DX.isWrapped)(e.clear)&&this._unwrap(e,"clear"),this._wrap(e,"clear",this._getPatchedClear.bind(this))}_getPatchedClear(e){const t=this;return function(...n){if(!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"clear"),{kind:VX.SpanKind.CLIENT},r),o=VX.context.with(VX.trace.setSpan(r,s),()=>e.call(this,...n));return s.end(),o}}_patchClearAll(e){(0,DX.isWrapped)(e.clearAll)&&this._unwrap(e,"clearAll"),this._wrap(e,"clearAll",this._getPatchedClearAll.bind(this))}_getPatchedClearAll(e){const t=this;return function(...n){if(!t.shouldCreateSpans())return e.call(this,...n);const r=VX.context.active(),s=t.tracer.startSpan(t.getSpanName(this,"clearAll"),{kind:VX.SpanKind.CLIENT},r),o=VX.context.with(VX.trace.setSpan(r,s),()=>e.call(this,...n));return s.end(),o}}}kX.DataloaderInstrumentation=ZX,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DataloaderInstrumentation=void 0;var t=kX;Object.defineProperty(e,"DataloaderInstrumentation",{enumerable:!0,get:function(){return t.DataloaderInstrumentation}})}(xX);const WX="Dataloader",XX=yO(WX,()=>new xX.DataloaderInstrumentation({requireParentSpan:!0})),$X=()=>{let e;return{name:WX,setupOnce(){const t=XX();e=TO(t)},setup(t){e?.(()=>{t.on("spanStart",e=>{const t=Nb(e);t.description?.startsWith("dataloader")&&e.setAttribute(ZT,"auto.db.otel.dataloader"),"dataloader.load"!==t.description&&"dataloader.loadMany"!==t.description&&"dataloader.batch"!==t.description||e.setAttribute(jT,"cache.get")})})}}};var FX={},YX={},BX={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CONFIG=e.EndOperation=void 0,(t=e.EndOperation||(e.EndOperation={})).AutoAck="auto ack",t.Ack="ack",t.AckAll="ackAll",t.Reject="reject",t.Nack="nack",t.NackAll="nackAll",t.ChannelClosed="channel closed",t.ChannelError="channel error",t.InstrumentationTimeout="instrumentation timeout",e.DEFAULT_CONFIG={consumeTimeoutMs:6e4,useLinksForConsume:!1}}(BX);var KX={};Object.defineProperty(KX,"__esModule",{value:!0}),KX.isConfirmChannelTracing=KX.unmarkConfirmChannelTracing=KX.markConfirmChannelTracing=KX.getConnectionAttributesFromUrl=KX.getConnectionAttributesFromServer=KX.normalizeExchange=KX.CONNECTION_ATTRIBUTES=KX.CHANNEL_CONSUME_TIMEOUT_TIMER=KX.CHANNEL_SPANS_NOT_ENDED=KX.MESSAGE_STORED_SPAN=void 0;const JX=Ft,zX=GS;KX.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span"),KX.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended"),KX.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer"),KX.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");const QX=(0,JX.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel");KX.normalizeExchange=e=>""!==e?e:"<default>";const qX=(e,t)=>e||("AMQP"===t?5672:5671),e$=e=>{const t=e||"amqp";return(t.endsWith(":")?t.substring(0,t.length-1):t).toUpperCase()},t$=e=>e||"localhost",n$=(e,t,n,r)=>n?{[t]:n}:(JX.diag.error(`amqplib instrumentation: could not extract connection attribute ${r} from user supplied url`,{url:e}),{});KX.getConnectionAttributesFromServer=e=>{const t=e.serverProperties.product?.toLowerCase?.();return t?{[zX.SEMATTRS_MESSAGING_SYSTEM]:t}:{}};KX.getConnectionAttributesFromUrl=e=>{const t={[zX.SEMATTRS_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if("object"==typeof(e=e||"amqp://localhost")){const n=e,r=e$(n?.protocol);Object.assign(t,{...n$(e,zX.SEMATTRS_MESSAGING_PROTOCOL,r,"protocol")});const s=t$(n?.hostname);Object.assign(t,{...n$(e,zX.SEMATTRS_NET_PEER_NAME,s,"hostname")});const o=qX(n.port,r);Object.assign(t,{...n$(e,zX.SEMATTRS_NET_PEER_PORT,o,"port")})}else{const n=(e=>e.replace(/:[^:@/]*@/,":***@"))(e);t[zX.SEMATTRS_MESSAGING_URL]=n;try{const e=new URL(n),r=e$(e.protocol);Object.assign(t,{...n$(n,zX.SEMATTRS_MESSAGING_PROTOCOL,r,"protocol")});const s=t$(e.hostname);Object.assign(t,{...n$(n,zX.SEMATTRS_NET_PEER_NAME,s,"hostname")});const o=qX(e.port?parseInt(e.port):void 0,r);Object.assign(t,{...n$(n,zX.SEMATTRS_NET_PEER_PORT,o,"port")})}catch(e){JX.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:n,err:e})}}return t};KX.markConfirmChannelTracing=e=>e.setValue(QX,!0);KX.unmarkConfirmChannelTracing=e=>e.deleteValue(QX);KX.isConfirmChannelTracing=e=>!0===e.getValue(QX);var r$={};Object.defineProperty(r$,"__esModule",{value:!0}),r$.PACKAGE_NAME=r$.PACKAGE_VERSION=void 0,r$.PACKAGE_VERSION="0.50.0",r$.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib",Object.defineProperty(YX,"__esModule",{value:!0}),YX.AmqplibInstrumentation=void 0;const s$=Ft,o$=Q_,i$=kS,a$=GS,c$=BX,u$=KX,l$=r$,p$=[">=0.5.5 <1"];class d$ extends i$.InstrumentationBase{constructor(e={}){super(l$.PACKAGE_NAME,l$.PACKAGE_VERSION,{...c$.DEFAULT_CONFIG,...e})}setConfig(e={}){super.setConfig({...c$.DEFAULT_CONFIG,...e})}init(){const e=new i$.InstrumentationNodeModuleFile("amqplib/lib/channel_model.js",p$,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),t=new i$.InstrumentationNodeModuleFile("amqplib/lib/callback_model.js",p$,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),n=new i$.InstrumentationNodeModuleFile("amqplib/lib/connect.js",p$,this.patchConnect.bind(this),this.unpatchConnect.bind(this));return new i$.InstrumentationNodeModuleDefinition("amqplib",p$,void 0,void 0,[e,n,t])}patchConnect(e){return e=this.unpatchConnect(e),(0,i$.isWrapped)(e.connect)||this._wrap(e,"connect",this.getConnectPatch.bind(this)),e}unpatchConnect(e){return(0,i$.isWrapped)(e.connect)&&this._unwrap(e,"connect"),e}patchChannelModel(e,t){return(0,i$.isWrapped)(e.Channel.prototype.publish)||this._wrap(e.Channel.prototype,"publish",this.getPublishPatch.bind(this,t)),(0,i$.isWrapped)(e.Channel.prototype.consume)||this._wrap(e.Channel.prototype,"consume",this.getConsumePatch.bind(this,t)),(0,i$.isWrapped)(e.Channel.prototype.ack)||this._wrap(e.Channel.prototype,"ack",this.getAckPatch.bind(this,!1,c$.EndOperation.Ack)),(0,i$.isWrapped)(e.Channel.prototype.nack)||this._wrap(e.Channel.prototype,"nack",this.getAckPatch.bind(this,!0,c$.EndOperation.Nack)),(0,i$.isWrapped)(e.Channel.prototype.reject)||this._wrap(e.Channel.prototype,"reject",this.getAckPatch.bind(this,!0,c$.EndOperation.Reject)),(0,i$.isWrapped)(e.Channel.prototype.ackAll)||this._wrap(e.Channel.prototype,"ackAll",this.getAckAllPatch.bind(this,!1,c$.EndOperation.AckAll)),(0,i$.isWrapped)(e.Channel.prototype.nackAll)||this._wrap(e.Channel.prototype,"nackAll",this.getAckAllPatch.bind(this,!0,c$.EndOperation.NackAll)),(0,i$.isWrapped)(e.Channel.prototype.emit)||this._wrap(e.Channel.prototype,"emit",this.getChannelEmitPatch.bind(this)),(0,i$.isWrapped)(e.ConfirmChannel.prototype.publish)||this._wrap(e.ConfirmChannel.prototype,"publish",this.getConfirmedPublishPatch.bind(this,t)),e}unpatchChannelModel(e){return(0,i$.isWrapped)(e.Channel.prototype.publish)&&this._unwrap(e.Channel.prototype,"publish"),(0,i$.isWrapped)(e.Channel.prototype.consume)&&this._unwrap(e.Channel.prototype,"consume"),(0,i$.isWrapped)(e.Channel.prototype.ack)&&this._unwrap(e.Channel.prototype,"ack"),(0,i$.isWrapped)(e.Channel.prototype.nack)&&this._unwrap(e.Channel.prototype,"nack"),(0,i$.isWrapped)(e.Channel.prototype.reject)&&this._unwrap(e.Channel.prototype,"reject"),(0,i$.isWrapped)(e.Channel.prototype.ackAll)&&this._unwrap(e.Channel.prototype,"ackAll"),(0,i$.isWrapped)(e.Channel.prototype.nackAll)&&this._unwrap(e.Channel.prototype,"nackAll"),(0,i$.isWrapped)(e.Channel.prototype.emit)&&this._unwrap(e.Channel.prototype,"emit"),(0,i$.isWrapped)(e.ConfirmChannel.prototype.publish)&&this._unwrap(e.ConfirmChannel.prototype,"publish"),e}getConnectPatch(e){return function(t,n,r){return e.call(this,t,n,function(e,n){if(null==e){const e=(0,u$.getConnectionAttributesFromUrl)(t),r=(0,u$.getConnectionAttributesFromServer)(n);n[u$.CONNECTION_ATTRIBUTES]={...e,...r}}r.apply(this,arguments)})}}getChannelEmitPatch(e){const t=this;return function(n){if("close"===n){t.endAllSpansOnChannel(this,!0,c$.EndOperation.ChannelClosed,void 0);const e=this[u$.CHANNEL_CONSUME_TIMEOUT_TIMER];e&&clearInterval(e),this[u$.CHANNEL_CONSUME_TIMEOUT_TIMER]=void 0}else"error"===n&&t.endAllSpansOnChannel(this,!0,c$.EndOperation.ChannelError,void 0);return e.apply(this,arguments)}}getAckAllPatch(e,t,n){const r=this;return function(s){return r.endAllSpansOnChannel(this,e,t,s),n.apply(this,arguments)}}getAckPatch(e,t,n){const r=this;return function(s,o,i){const a=t===c$.EndOperation.Reject?o:i,c=this[u$.CHANNEL_SPANS_NOT_ENDED]??[],u=c.findIndex(e=>e.msg===s);if(u<0)r.endConsumerSpan(s,e,t,a);else if(t!==c$.EndOperation.Reject&&o){for(let n=0;n<=u;n++)r.endConsumerSpan(c[n].msg,e,t,a);c.splice(0,u+1)}else r.endConsumerSpan(s,e,t,a),c.splice(u,1);return n.apply(this,arguments)}}getConsumePatch(e,t){const n=this;return function(r,s,o){const i=this;if(!Object.prototype.hasOwnProperty.call(i,u$.CHANNEL_SPANS_NOT_ENDED)){const{consumeTimeoutMs:e}=n.getConfig();if(e){const t=setInterval(()=>{n.checkConsumeTimeoutOnChannel(i)},e);t.unref(),i[u$.CHANNEL_CONSUME_TIMEOUT_TIMER]=t}i[u$.CHANNEL_SPANS_NOT_ENDED]=[]}return arguments[1]=function(t){if(!t)return s.call(this,t);const a=t.properties.headers??{};let c=s$.propagation.extract(s$.ROOT_CONTEXT,a);const u=t.fields?.exchange;let l;if(n._config.useLinksForConsume){const e=c?s$.trace.getSpan(c)?.spanContext():void 0;c=void 0,e&&(l=[{context:e}])}const p=n.tracer.startSpan(`${r} process`,{kind:s$.SpanKind.CONSUMER,attributes:{...i?.connection?.[u$.CONNECTION_ATTRIBUTES],[a$.SEMATTRS_MESSAGING_DESTINATION]:u,[a$.SEMATTRS_MESSAGING_DESTINATION_KIND]:a$.MESSAGINGDESTINATIONKINDVALUES_TOPIC,[a$.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY]:t.fields?.routingKey,[a$.SEMATTRS_MESSAGING_OPERATION]:a$.MESSAGINGOPERATIONVALUES_PROCESS,[a$.SEMATTRS_MESSAGING_MESSAGE_ID]:t?.properties.messageId,[a$.SEMATTRS_MESSAGING_CONVERSATION_ID]:t?.properties.correlationId},links:l},c),{consumeHook:d}=n.getConfig();d&&(0,i$.safeExecuteInTheMiddle)(()=>d(p,{moduleVersion:e,msg:t}),e=>{e&&s$.diag.error("amqplib instrumentation: consumerHook error",e)},!0),o?.noAck||(i[u$.CHANNEL_SPANS_NOT_ENDED].push({msg:t,timeOfConsume:(0,o$.hrTime)()}),t[u$.MESSAGE_STORED_SPAN]=p);const h=c||s$.ROOT_CONTEXT;s$.context.with(s$.trace.setSpan(h,p),()=>{s.call(this,t)}),o?.noAck&&(n.callConsumeEndHook(p,t,!1,c$.EndOperation.AutoAck),p.end())},t.apply(this,arguments)}}getConfirmedPublishPatch(e,t){const n=this;return function(r,s,o,i,a){const{span:c,modifiedOptions:u}=n.createPublishSpan(n,r,s,this,i),{publishHook:l}=n.getConfig();l&&(0,i$.safeExecuteInTheMiddle)(()=>l(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:u,isConfirmChannel:!0}),e=>{e&&s$.diag.error("amqplib instrumentation: publishHook error",e)},!0);const p=(0,u$.markConfirmChannelTracing)(s$.context.active()),d=[...arguments];return d[3]=u,d[4]=s$.context.bind((0,u$.unmarkConfirmChannelTracing)(s$.trace.setSpan(p,c)),function(t,u){try{a?.call(this,t,u)}finally{const{publishConfirmHook:a}=n.getConfig();a&&(0,i$.safeExecuteInTheMiddle)(()=>a(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:i,isConfirmChannel:!0,confirmError:t}),e=>{e&&s$.diag.error("amqplib instrumentation: publishConfirmHook error",e)},!0),t&&c.setStatus({code:s$.SpanStatusCode.ERROR,message:"message confirmation has been nack'ed"}),c.end()}}),s$.context.with(p,t.bind(this,...d))}}getPublishPatch(e,t){const n=this;return function(r,s,o,i){if((0,u$.isConfirmChannelTracing)(s$.context.active()))return t.apply(this,arguments);{const a=this,{span:c,modifiedOptions:u}=n.createPublishSpan(n,r,s,a,i),{publishHook:l}=n.getConfig();l&&(0,i$.safeExecuteInTheMiddle)(()=>l(c,{moduleVersion:e,exchange:r,routingKey:s,content:o,options:u,isConfirmChannel:!1}),e=>{e&&s$.diag.error("amqplib instrumentation: publishHook error",e)},!0);const p=[...arguments];p[3]=u;const d=t.apply(this,p);return c.end(),d}}}createPublishSpan(e,t,n,r,s){const o=(0,u$.normalizeExchange)(t),i=e.tracer.startSpan(`publish ${o}`,{kind:s$.SpanKind.PRODUCER,attributes:{...r.connection[u$.CONNECTION_ATTRIBUTES],[a$.SEMATTRS_MESSAGING_DESTINATION]:t,[a$.SEMATTRS_MESSAGING_DESTINATION_KIND]:a$.MESSAGINGDESTINATIONKINDVALUES_TOPIC,[a$.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY]:n,[a$.SEMATTRS_MESSAGING_MESSAGE_ID]:s?.messageId,[a$.SEMATTRS_MESSAGING_CONVERSATION_ID]:s?.correlationId}}),a=s??{};return a.headers=a.headers??{},s$.propagation.inject(s$.trace.setSpan(s$.context.active(),i),a.headers),{span:i,modifiedOptions:a}}endConsumerSpan(e,t,n,r){const s=e[u$.MESSAGE_STORED_SPAN];s&&(!1!==t&&s.setStatus({code:s$.SpanStatusCode.ERROR,message:n!==c$.EndOperation.ChannelClosed&&n!==c$.EndOperation.ChannelError?`${n} called on message${!0===r?" with requeue":!1===r?" without requeue":""}`:n}),this.callConsumeEndHook(s,e,t,n),s.end(),e[u$.MESSAGE_STORED_SPAN]=void 0)}endAllSpansOnChannel(e,t,n,r){(e[u$.CHANNEL_SPANS_NOT_ENDED]??[]).forEach(e=>{this.endConsumerSpan(e.msg,t,n,r)}),e[u$.CHANNEL_SPANS_NOT_ENDED]=[]}callConsumeEndHook(e,t,n,r){const{consumeEndHook:s}=this.getConfig();s&&(0,i$.safeExecuteInTheMiddle)(()=>s(e,{msg:t,rejected:n,endOperation:r}),e=>{e&&s$.diag.error("amqplib instrumentation: consumerEndHook error",e)},!0)}checkConsumeTimeoutOnChannel(e){const t=(0,o$.hrTime)(),n=e[u$.CHANNEL_SPANS_NOT_ENDED]??[];let r;const{consumeTimeoutMs:s}=this.getConfig();for(r=0;r<n.length;r++){const e=n[r],o=(0,o$.hrTimeDuration)(e.timeOfConsume,t);if((0,o$.hrTimeToMilliseconds)(o)<s)break;this.endConsumerSpan(e.msg,null,c$.EndOperation.InstrumentationTimeout,!0)}n.splice(0,r)}}YX.AmqplibInstrumentation=d$,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOperation=e.DEFAULT_CONFIG=e.AmqplibInstrumentation=void 0;var t=YX;Object.defineProperty(e,"AmqplibInstrumentation",{enumerable:!0,get:function(){return t.AmqplibInstrumentation}});var n=BX;Object.defineProperty(e,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_CONFIG}}),Object.defineProperty(e,"EndOperation",{enumerable:!0,get:function(){return n.EndOperation}})}(FX);const h$="Amqplib",m$={consumeEndHook:e=>{iw(e,"auto.amqplib.otel.consumer")},publishHook:e=>{iw(e,"auto.amqplib.otel.publisher")}},f$=yO(h$,()=>new FX.AmqplibInstrumentation(m$)),_$=()=>({name:h$,setupOnce(){f$()}}),g$="VercelAI",E$=["generateText","streamText","generateObject","streamObject","embed","embedMany"];function S$(e){if("object"!=typeof e||null===e)return!1;const t=e;return"type"in t&&"error"in t&&"toolName"in t&&"toolCallId"in t&&"tool-error"===t.type&&t.error instanceof Error}class y$ extends IS{__init(){this._isPatched=!1}__init2(){this._callbacks=[]}constructor(e={}){super("@sentry/instrumentation-vercel-ai",ly,e),y$.prototype.__init.call(this),y$.prototype.__init2.call(this)}init(){return new LS("ai",[">=3.0.0 <6"],this._patch.bind(this))}callWhenPatched(e){this._isPatched?e():this._callbacks.push(e)}_patch(e){function t(e){return(...t)=>{const n=t[0].experimental_telemetry||{},r=n.isEnabled,s=wT().getClient(),o=s?.getIntegrationByName(g$),i=o?.options,a=!!o&&Boolean(s?.getOptions().sendDefaultPii),{recordInputs:c,recordOutputs:u}=(l=i,p=n,d=r,h=a,{recordInputs:void 0!==l?.recordInputs?l.recordInputs:void 0!==p.recordInputs?p.recordInputs:!0===d||h,recordOutputs:void 0!==l?.recordOutputs?l.recordOutputs:void 0!==p.recordOutputs?p.recordOutputs:!0===d||h});var l,p,d,h;return t[0].experimental_telemetry={...n,isEnabled:void 0===r||r,recordInputs:c,recordOutputs:u},fA(async()=>{const n=await e.apply(this,t);return function(e){if("object"!=typeof e||null===e||!("content"in e))return;const t=e;if(Array.isArray(t.content))for(const e of t.content)if(S$(e)){const t=TC(e.toolCallId);if(t){const n=t.spanContext();kT(t=>{t.setContext("trace",{trace_id:n.traceId,span_id:n.spanId}),t.setTag("vercel.ai.tool.name",e.toolName),t.setTag("vercel.ai.tool.callId",e.toolCallId),t.setLevel("error"),XA(e.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})}),bC(e.toolCallId)}else kT(t=>{t.setTag("vercel.ai.tool.name",e.toolName),t.setTag("vercel.ai.tool.callId",e.toolCallId),t.setLevel("error"),XA(e.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})})}}(n),n},e=>{e&&"object"==typeof e&&tT(e,"_sentry_active_span",xb())})}}if(this._isPatched=!0,this._callbacks.forEach(e=>e()),this._callbacks=[],"[object Module]"===Object.prototype.toString.call(e)){for(const n of E$)e[n]=t(e[n]);return e}{const n=E$.reduce((n,r)=>(n[r]=t(e[r]),n),{});return{...e,...n}}}}const T$=yO(g$,()=>new y$({}));const b$=(e={})=>{let t;return{name:g$,options:e,setupOnce(){t=T$()},afterAllSetup(n){const r=e.force??function(e){const t=e.getIntegrationByName("Modules");return!!t?.getModules?.()?.ai}(n);r?DC(n):t?.callWhenPatched(()=>DC(n))}}},A$=[">=4.0.0 <6"];class R$ extends IS{constructor(e={}){super("@sentry/instrumentation-openai",ly,e)}init(){return new LS("openai",A$,this._patch.bind(this))}_patch(e){const t=e.OpenAI,n=function(...e){const n=Reflect.construct(t,e),r=wT().getClient(),s=r?.getIntegrationByName(UC),o=s?.options,i=Boolean(r?.getOptions().sendDefaultPii),{recordInputs:a,recordOutputs:c}=(u=o,l=i,{recordInputs:u?.recordInputs??l,recordOutputs:u?.recordOutputs??l});var u,l;return eO(n,"",{recordInputs:a,recordOutputs:c})};Object.setPrototypeOf(n,t),Object.setPrototypeOf(n.prototype,t.prototype);for(const e of Object.getOwnPropertyNames(t))if(!["length","name","prototype"].includes(e)){const r=Object.getOwnPropertyDescriptor(t,e);r&&Object.defineProperty(n,e,r)}try{e.OpenAI=n}catch(t){Object.defineProperty(e,"OpenAI",{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===t)try{e.default=n}catch(t){Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}return e}}const v$=yO(UC,()=>new R$({})),N$=(e={})=>({name:UC,options:e,setupOnce(){v$()}}),C$=[">=0.19.2 <1.0.0"];class O$ extends IS{constructor(e={}){super("@sentry/instrumentation-anthropic-ai",ly,e)}init(){return new LS("@anthropic-ai/sdk",C$,this._patch.bind(this))}_patch(e){const t=e.Anthropic,n=function(...e){const n=Reflect.construct(t,e),r=wT().getClient(),s=r?.getIntegrationByName(sO),o=s?.options,i=Boolean(r?.getOptions().sendDefaultPii),{recordInputs:a,recordOutputs:c}=(u=o,l=i,{recordInputs:u?.recordInputs??l,recordOutputs:u?.recordOutputs??l});var u,l;return uO(n,"",{recordInputs:a,recordOutputs:c})};Object.setPrototypeOf(n,t),Object.setPrototypeOf(n.prototype,t.prototype);for(const e of Object.getOwnPropertyNames(t))if(!["length","name","prototype"].includes(e)){const r=Object.getOwnPropertyDescriptor(t,e);r&&Object.defineProperty(n,e,r)}try{e.Anthropic=n}catch(t){Object.defineProperty(e,"Anthropic",{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===t)try{e.default=n}catch(t){Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}return e}}const I$=yO(sO,()=>new O$({})),P$=(e={})=>({name:sO,options:e,setupOnce(){I$()}}),L$=e=>(dO()||_y(()=>{console.warn("The launchDarklyIntegration() can only be used in the browser.")}),{name:"LaunchDarkly"});const w$=e=>(dO()||_y(()=>{console.warn("The openFeatureIntegration() can only be used in the browser.")}),{name:"OpenFeature"});const M$=e=>(dO()||_y(()=>{console.warn("The statsigIntegration() can only be used in the browser.")}),{name:"Statsig"}),x$=e=>(dO()||_y(()=>{console.warn("The unleashIntegration() can only be used in the browser.")}),{name:"Unleash"});function k$(e,t,n,r,s){return G$(e,n),t(e,"addDoc",function(e,t){return function(n){return function(r,s){const o=V$(e,"addDoc",r);return t(o),D$(o,()=>n(r,s))}}}(r,s)),t(e,"getDocs",function(e,t){return function(n){return function(r){const s=V$(e,"getDocs",r);return t(s),D$(s,()=>n(r))}}}(r,s)),t(e,"setDoc",function(e,t){return function(n){return function(r,s,o){const i=V$(e,"setDoc",r.parent||r);return t(i),D$(i,()=>void 0!==o?n(r,s,o):n(r,s))}}}(r,s)),t(e,"deleteDoc",function(e,t){return function(n){return function(r){const s=V$(e,"deleteDoc",r.parent||r);return t(s),D$(s,()=>n(r))}}}(r,s)),e}function G$(e,t){for(const n of["addDoc","getDocs","setDoc","deleteDoc"])OS(e[n])&&t(e,n);return e}function D$(e,t){return bt.with(Ht.setSpan(bt.active(),e),()=>CS(()=>t(),t=>{t&&e.recordException(t),e.end()},!0))}function V$(e,t,n){const r=e.startSpan(`${t} ${n.path}`,{kind:pt.CLIENT});return function(e,t){const n=t.firestore.app,r=n.options,s=t.firestore.toJSON()||{},o=s.settings||{},i={[xf]:t.path,[kf]:n.name,[Uf]:"firebase.firestore","firebase.firestore.type":t.type,"firebase.firestore.options.projectId":r.projectId,"firebase.firestore.options.appId":r.appId,"firebase.firestore.options.messagingSenderId":r.messagingSenderId,"firebase.firestore.options.storageBucket":r.storageBucket},{address:a,port:c}=function(e){let t,n;if("string"==typeof e.host)if(e.host.startsWith("[")){if(e.host.endsWith("]"))t=e.host.replace(/^\[|\]$/g,"");else if(e.host.includes("]:")){const r=e.host.lastIndexOf(":");-1!==r&&(t=e.host.slice(1,r).replace(/^\[|\]$/g,""),n=e.host.slice(r+1))}}else if(L.isIPv6(e.host))t=e.host;else{const r=e.host.lastIndexOf(":");-1!==r?(t=e.host.slice(0,r),n=e.host.slice(r+1)):t=e.host}return{address:t,port:n?parseInt(n,10):void 0}}(o);a&&(i[Yf]=a);c&&(i[Bf]=c);e.setAttributes(i)}(r,n),r.setAttribute(Gf,t),r}const U$={},H$=[">=3.0.0 <5"];class j$ extends IS{constructor(e=U$){super("@sentry/instrumentation-firebase",ly,e)}setConfig(e={}){super.setConfig({...U$,...e})}init(){const e=[];return e.push(function(e,t,n,r,s){let o=()=>{};const i=s.firestoreSpanCreationHook;"function"==typeof i&&(o=e=>{CS(()=>i(e),e=>{e&&At.error(e?.message)},!0)});const a=new LS("@firebase/firestore",t,t=>k$(t,n,r,e,o)),c=["@firebase/firestore/dist/lite/index.node.cjs.js","@firebase/firestore/dist/lite/index.node.mjs.js","@firebase/firestore/dist/lite/index.rn.esm2017.js","@firebase/firestore/dist/lite/index.cjs.js"];for(const s of c)a.files.push(new wS(s,t,t=>k$(t,n,r,e,o),e=>G$(e,r)));return a}(this.tracer,H$,this._wrap,this._unwrap,this.getConfig())),e}}const Z$="Firebase",W$={firestoreSpanCreationHook:e=>{iw(e,"auto.firebase.otel.firestore"),e.setAttribute(jT,"db.query")}},X$=yO(Z$,()=>new j$(W$)),$$=()=>({name:Z$,setupOnce(){X$()}});function F$(){return[bM(),mk(),Vk(),wG(),XG(),cD(),ID(),DV(),yU(),XZ(),aW(),OW(),UW(),bX(),MX(),oG(),_$(),fG(),b$(),N$(),vU(),$$(),P$()]}const Y$=1e6;function B$(e,t={}){e.getOptions().debug&&(At.disable(),At.setLogger({error:yy.error,warn:yy.warn,info:yy.log,debug:yy.log,verbose:yy.log},Y.DEBUG));const n=function(e,t={}){const n=new KO({sampler:new eP(e),resource:LO().merge(PO({[Kf]:"node",[Vh]:"sentry",[Jf]:ly})),forceFlushTimeoutMillis:500,spanProcessors:[new qI({timeout:K$(e.getOptions().maxSpanWaitDuration)}),...t.spanProcessors||[]]});return Ht.setGlobalTracerProvider(n),Dt.setGlobalPropagator(new AI),bt.setGlobalContextManager(new DL),n}(e,t);e.traceProvider=n}function K$(e){if(null!=e){if(e>Y$)return SM&&yy.warn("`maxSpanWaitDuration` is too high, using the maximum value of 1000000"),Y$;if(!(e<=0||Number.isNaN(e)))return e;SM&&yy.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.")}}function J$(){return rw().filter(e=>"Http"!==e.name&&"NodeFetch"!==e.name).concat(_w(),ww())}function z$(e){return[...J$(),...Vb(e)?F$():[]]}function Q$(e={}){return q$(e,z$)}function q$(e={},t){HR(e,"node");const n=sw({...e,defaultIntegrations:e.defaultIntegrations??t(e)});return n&&!e.skipOpenTelemetrySetup&&(B$(n,{spanProcessors:e.openTelemetrySpanProcessors}),ow()),n}var eF=Object.freeze({__proto__:null,NODE_VERSION:cP,NodeClient:nw,OpenFeatureIntegrationHook:class{constructor(){dO()||_y(()=>{console.warn("The OpenFeatureIntegrationHook can only be used in the browser.")})}after(){}error(){}},SDK_VERSION:ly,SEMANTIC_ATTRIBUTE_SENTRY_OP:jT,SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN:ZT,SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE:HT,SEMANTIC_ATTRIBUTE_SENTRY_SOURCE:UT,Scope:AT,SentryContextManager:DL,addBreadcrumb:FR,addEventProcessor:function(e){MT().addEventProcessor(e)},addIntegration:function(e){const t=DT();t?t.addIntegration(e):cy&&yy.warn(`Cannot add integration "${e.name}" because no SDK Client is available.`)},amqplibIntegration:_$,anrIntegration:hL,anthropicAIIntegration:P$,buildLaunchDarklyFlagUsedHandler:function(){return dO()||_y(()=>{console.warn("The buildLaunchDarklyFlagUsedHandler() can only be used in the browser.")}),{name:"sentry-flag-auditor",type:"flag-used",synchronous:!0,method:()=>null}},captureCheckIn:YA,captureConsoleIntegration:hv,captureEvent:FA,captureException:XA,captureFeedback:function(e,t={},n=wT()){const{message:r,name:s,email:o,url:i,source:a,associatedEventId:c,tags:u}=e,l={contexts:{feedback:{contact_email:o,name:s,message:r,url:i,source:a,associated_event_id:c}},type:"feedback",level:"info",tags:u},p=n?.getClient()||DT();return p&&p.emit("beforeSendFeedback",l,t),n.captureEvent(l,t)},captureMessage:$A,captureSession:function(e=!1){e?zA():QA()},childProcessIntegration:gL,close:async function(e){const t=DT();return t?t.close(e):(cy&&yy.warn("Cannot flush events and disable SDK. No client defined."),Promise.resolve(!1))},connectIntegration:UW,consoleIntegration:Zv,consoleLoggingIntegration:XN,contextLinesIntegration:HP,continueTrace:(e,t)=>{const n=LT(py());if(n.continueTrace)return n.continueTrace(e,t);const{sentryTrace:r,baggage:s}=e,o=DT(),i=rb(s);return o&&!Eb(o,i?.org_id)?AA(t):kT(e=>{const n=_b(r,s);return e.setPropagationContext(n),t()})},createGetModuleFromFilename:qL,createSentryWinstonTransport:function(e,t){return class extends e{constructor(e){super(e),this._levels=new Set(t?.levels??EL)}log(e,t){try{if(setImmediate(()=>{this.emit("logged",e)}),"object"!=typeof(n=e)||null==n)return;const t=e[SL],{level:r,message:s,timestamp:o,...i}=e;i[SL]=void 0,i[yL]=void 0,i[TL]=void 0;const a=bL[t]??"info";this._levels.has(a)&&gO(a,s,{...i,"sentry.origin":"auto.logging.winston"})}catch{}var n;t&&t()}}},createTransport:xR,cron:pw,dataloaderIntegration:$X,dedupeIntegration:mv,defaultStackParser:tw,disableAnrDetectionForCallback:function(e){const t=DT()?.getIntegrationByName("Anr");if(!t)return e();t.stopWorker();const n=e();return uL(n)?n.finally(()=>t.startWorker()):(t.startWorker(),n)},endSession:zA,eventFiltersIntegration:zR,expressErrorHandler:AM,expressIntegration:bM,extraErrorDataIntegration:Ev,fastifyIntegration:mk,featureFlagsIntegration:Fv,firebaseIntegration:$$,flush:async function(e){const t=DT();return t?t.flush(e):(cy&&yy.warn("Cannot flush events. No client defined."),Promise.resolve(!1))},fsIntegration:Kw,functionToStringIntegration:KR,generateInstrumentOnce:yO,genericPoolIntegration:MX,getActiveSpan:xb,getAutoPerformanceIntegrations:F$,getClient:DT,getCurrentScope:wT,getDefaultIntegrations:z$,getDefaultIntegrationsWithoutPerformance:J$,getGlobalScope:xT,getIsolationScope:MT,getRootSpan:Mb,getSentryRelease:ew,getSpanDescendants:wb,getSpanStatusFromHttpCode:KT,getTraceData:jR,getTraceMetaTags:function(e){return Object.entries(e||jR()).map(([e,t])=>`<meta name="${e}" content="${t}"/>`).join("\n")},graphqlIntegration:Vk,hapiIntegration:aW,httpIntegration:_w,inboundFiltersIntegration:QR,init:Q$,initOpenTelemetry:B$,initWithoutDefaultIntegrations:function(e={}){return q$(e,()=>[])},instrumentSupabaseClient:kv,isEnabled:KA,isInitialized:function(){return!!DT()},kafkaIntegration:oG,knexIntegration:sX,koaIntegration:OW,lastEventId:function(){return MT().lastEventId()},launchDarklyIntegration:L$,linkedErrorsIntegration:ov,localVariablesIntegration:QP,logger:EO,lruMemoizerIntegration:fG,makeNodeTransport:BL,modulesIntegration:nL,mongoIntegration:wG,mongooseIntegration:XG,mysql2Integration:ID,mysqlIntegration:cD,nativeNodeFetchIntegration:ww,nodeContextIntegration:yP,onUncaughtExceptionIntegration:aL,onUnhandledRejectionIntegration:cL,openAIIntegration:N$,openFeatureIntegration:w$,parameterize:VR,postgresIntegration:yU,postgresJsIntegration:vU,preloadOpenTelemetry:function(e={}){const{debug:t}=e;t&&yy.enable(),qP()||function(){const[e=0,t=0]=process.versions.node.split(".").map(Number);if(e>=21||20===e&&t>=6||18===e&&t>=19){if(!uy._sentryEsmLoaderHookRegistered)try{const{addHookMessagePort:e}=NS();a.register("import-in-the-middle/hook.mjs","undefined"==typeof document?require("url").pathToFileURL(__filename).href:document.currentScript&&document.currentScript.src||new URL("index.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){yy.warn("Failed to register ESM hook",e)}}else _y(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})}(),function(e){const t=[fw,TM,VW,hk,lk,iW,sG,CW,mG,IG,WG,aD,OD,SU,iW,Dk,GV,TX,wX,f$,T$,v$,AU,X$,I$];if(!e)return t;return t.filter(t=>{const n=t.id;return e.some(e=>n===e||n.startsWith(`${e}.`))})}(e.integrations).forEach(e=>{e(),t&&yy.log(`[Sentry] Preloaded ${e.id} instrumentation`)})},prismaIntegration:XZ,profiler:Bv,redisIntegration:DV,requestDataIntegration:cv,rewriteFramesIntegration:Rv,setContext:function(e,t){MT().setContext(e,t)},setCurrentClient:function(e){wT().setClient(e)},setExtra:function(e,t){MT().setExtra(e,t)},setExtras:function(e){MT().setExtras(e)},setHttpStatus:JT,setMeasurement:function(e,t,n,r=xb()){const s=r&&Mb(r);s&&(cy&&yy.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),s.addEvent(e,{[XT]:t,[WT]:n}))},setNodeAsyncContextStrategy:HI,setTag:function(e,t){MT().setTag(e,t)},setTags:function(e){MT().setTags(e)},setUser:function(e){MT().setUser(e)},setupConnectErrorHandler:e=>{e.use(HW);const t=DT();t&&t.on("spanStart",e=>{!function(e){const t=Nb(e).data,n=t["connect.type"];if(t[jT]||!n)return;e.setAttributes({[ZT]:"auto.http.otel.connect",[jT]:`${n}.connect`});const r=t["connect.name"];"string"==typeof r&&e.updateName(r)}(e)}),aw(e.use,"connect")},setupExpressErrorHandler:function(e,t){e.use(function(e,t,n){const r=WR(e);MT().setSDKProcessingMetadata({normalizedRequest:r}),n()}),e.use(AM(t)),aw(e.use,"express")},setupFastifyErrorHandler:function(e,t){t?.shouldHandleError&&pk()?.setShouldHandleError(t.shouldHandleError);const n=Object.assign(function(e,t,n){e.addHook("onError",async(e,t,n)=>{dk.call(dk,n,e,t,"onError-hook")}),n()},{[Symbol.for("skip-override")]:!0,[Symbol.for("fastify.display-name")]:"sentry-fastify-error-handler"});e.register(n)},setupHapiErrorHandler:async function(e){await e.register(cW);const t=DT();t&&t.on("spanStart",e=>{!function(e){const t=Nb(e).data,n=t["hapi.type"];if(t[jT]||!n)return;e.setAttributes({[ZT]:"auto.http.otel.hapi",[jT]:`${n}.hapi`})}(e)}),aw(e.register,"hapi")},setupKoaErrorHandler:e=>{e.use(async(e,t)=>{try{await t()}catch(e){throw XA(e),e}}),aw(e.use,"koa")},spanToBaggageHeader:function(e){return sb(Xb(e))},spanToJSON:Nb,spanToTraceHeader:bb,spotlightIntegration:fL,startInactiveSpan:yA,startNewTrace:AA,startSession:JA,startSpan:EA,startSpanManual:SA,statsigIntegration:M$,supabaseIntegration:Gv,suppressTracing:bA,systemErrorIntegration:_L,tediousIntegration:bX,trpcMiddleware:function(e={}){return async function(t){const{path:n,type:r,next:s,rawInput:o,getRawInput:i}=t,a=DT(),c=a?.getOptions(),u={procedure_path:n,procedure_type:r};if(tT(u,"__sentry_override_normalization_depth__",1+(c?.normalizeDepth??5)),(void 0!==e.attachRpcInput?e.attachRpcInput:c?.sendDefaultPii)&&(void 0!==o&&(u.input=Fb(o)),void 0!==i&&"function"==typeof i))try{const e=await i();u.input=Fb(e)}catch{}return GT(t=>(t.setContext("trpc",u),SA({name:`trpc/${n}`,op:"rpc.server",attributes:{[UT]:"route",[ZT]:"auto.rpc.trpc"},forceTransaction:!!e.forceTransaction},async e=>{try{const t=await s();return function(e){"object"==typeof e&&null!==e&&"ok"in e&&!e.ok&&"error"in e&&XA(e.error,Kv)}(t),e.end(),t}catch(t){throw XA(t,Kv),e.end(),t}})))}},unleashIntegration:x$,updateSpanName:function(e,t){e.updateName(t),e.setAttributes({[UT]:"custom",[$T]:t})},validateOpenTelemetrySetup:ow,vercelAIIntegration:b$,withActiveSpan:TA,withIsolationScope:GT,withMonitor:BA,withScope:kT,wrapMcpServerWithSentry:function(e){if(ZN.has(e))return e;if(!("object"==typeof(t=e)&&null!==t&&"resource"in t&&"tool"in t&&"prompt"in t&&"connect"in t||(cy&&yy.warn("Did not patch MCP server. Interface is incompatible."),0)))return e;var t;const n=e;return eT(n,"connect",e=>async function(t,...n){const r=await e.call(this,t,...n);return VN(t),UN(t),HN(t),jN(t),r}),eN(n),ZN.add(e),e},zodErrorsIntegration:jv}),tF={exports:{}};const nF=e,rF=t,sF=n,oF=r,iF={name:"dotenv",version:"17.2.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}.version,aF=["🔐 encrypt with Dotenvx: https://dotenvx.com","🔐 prevent committing .env to code: https://dotenvx.com/precommit","🔐 prevent building .env in docker: https://dotenvx.com/prebuild","📡 observe env with Radar: https://dotenvx.com/radar","📡 auto-backup env with Radar: https://dotenvx.com/radar","📡 version env with Radar: https://dotenvx.com/radar","🛠️  run anywhere with `dotenvx run -- yourcommand`","⚙️  specify custom .env file path with { path: '/custom/path/.env' }","⚙️  enable debug logging with { debug: true }","⚙️  override existing env vars with { override: true }","⚙️  suppress all logs with { quiet: true }","⚙️  write to custom object with { processEnv: myObject }","⚙️  load multiple .env files with { path: ['.env.local', '.env'] }"];function cF(e){return"string"==typeof e?!["false","0","no","off",""].includes(e.toLowerCase()):Boolean(e)}function uF(e){return process.stdout.isTTY?`[2m${e}[0m`:e}const lF=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function pF(e){console.log(`[dotenv@${iF}][DEBUG] ${e}`)}function dF(e){console.log(`[dotenv@${iF}] ${e}`)}function hF(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function mF(e,t){let n;try{n=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const r=n.password;if(!r){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const s=n.searchParams.get("environment");if(!s){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const o=`DOTENV_VAULT_${s.toUpperCase()}`,i=e.parsed[o];if(!i){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${o} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:i,key:r}}function fF(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const n of e.path)nF.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=rF.resolve(process.cwd(),".env.vault");return nF.existsSync(t)?t:null}function _F(e){return"~"===e[0]?rF.join(sF.homedir(),e.slice(1)):e}const gF={configDotenv:function(e){const t=rF.resolve(process.cwd(),".env");let n="utf8",r=process.env;e&&null!=e.processEnv&&(r=e.processEnv);let s=cF(r.DOTENV_CONFIG_DEBUG||e&&e.debug),o=cF(r.DOTENV_CONFIG_QUIET||e&&e.quiet);e&&e.encoding?n=e.encoding:s&&pF("No encoding is specified. UTF-8 is used by default");let i,a=[t];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const t of e.path)a.push(_F(t))}else a=[_F(e.path)];const c={};for(const t of a)try{const r=gF.parse(nF.readFileSync(t,{encoding:n}));gF.populate(c,r,e)}catch(e){s&&pF(`Failed to load ${t} ${e.message}`),i=e}const u=gF.populate(r,c,e);if(s=cF(r.DOTENV_CONFIG_DEBUG||s),o=cF(r.DOTENV_CONFIG_QUIET||o),s||!o){const e=Object.keys(u).length,t=[];for(const e of a)try{const n=rF.relative(process.cwd(),e);t.push(n)}catch(t){s&&pF(`Failed to load ${e} ${t.message}`),i=t}dF(`injecting env (${e}) from ${t.join(",")} ${uF(`-- tip: ${aF[Math.floor(Math.random()*aF.length)]}`)}`)}return i?{parsed:c,error:i}:{parsed:c}},_configVault:function(e){const t=cF(process.env.DOTENV_CONFIG_DEBUG||e&&e.debug),n=cF(process.env.DOTENV_CONFIG_QUIET||e&&e.quiet);!t&&n||dF("Loading env from encrypted .env.vault");const r=gF._parseVault(e);let s=process.env;return e&&null!=e.processEnv&&(s=e.processEnv),gF.populate(s,r,e),{parsed:r}},_parseVault:function(e){const t=fF(e=e||{});e.path=t;const n=gF.configDotenv(e);if(!n.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const r=hF(e).split(","),s=r.length;let o;for(let e=0;e<s;e++)try{const t=mF(n,r[e].trim());o=gF.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=s)throw t}return gF.parse(o)},config:function(e){if(0===hF(e).length)return gF.configDotenv(e);const t=fF(e);return t?gF._configVault(e):(n=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.error(`[dotenv@${iF}][WARN] ${n}`),gF.configDotenv(e));var n},decrypt:function(e,t){const n=Buffer.from(t.slice(-64),"hex");let r=Buffer.from(e,"base64");const s=r.subarray(0,12),o=r.subarray(-16);r=r.subarray(12,-16);try{const e=oF.createDecipheriv("aes-256-gcm",n,s);return e.setAuthTag(o),`${e.update(r)}${e.final()}`}catch(e){const t=e instanceof RangeError,n="Invalid key length"===e.message,r="Unsupported state or unable to authenticate data"===e.message;if(t||n){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let n,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(n=lF.exec(r));){const e=n[1];let r=n[2]||"";r=r.trim();const s=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===s&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),t[e]=r}return t},populate:function(e,t,n={}){const r=Boolean(n&&n.debug),s=Boolean(n&&n.override),o={};if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const n of Object.keys(t))Object.prototype.hasOwnProperty.call(e,n)?(!0===s&&(e[n]=t[n],o[n]=t[n]),r&&pF(!0===s?`"${n}" is already defined and WAS overwritten`:`"${n}" is already defined and was NOT overwritten`)):(e[n]=t[n],o[n]=t[n]);return o}};tF.exports.configDotenv=gF.configDotenv,tF.exports._configVault=gF._configVault,tF.exports._parseVault=gF._parseVault;var EF,SF,yF,TF=tF.exports.config=gF.config;tF.exports.decrypt=gF.decrypt,tF.exports.parse=gF.parse,tF.exports.populate=gF.populate,tF.exports=gF,TF(),Q$({dsn:process.env.SENTRY_DSN,sendDefaultPii:!0}),function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.REVERT="revert",e.COMMENT="comment",e.UPLOAD="upload",e.LOGIN="login",e.RUN="run"}(EF||(EF={})),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(SF||(SF={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(yF||(yF={}));const bF=SF.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),AF=e=>{switch(typeof e){case"undefined":return bF.undefined;case"string":return bF.string;case"number":return isNaN(e)?bF.nan:bF.number;case"boolean":return bF.boolean;case"function":return bF.function;case"bigint":return bF.bigint;case"symbol":return bF.symbol;case"object":return Array.isArray(e)?bF.array:null===e?bF.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?bF.promise:"undefined"!=typeof Map&&e instanceof Map?bF.map:"undefined"!=typeof Set&&e instanceof Set?bF.set:"undefined"!=typeof Date&&e instanceof Date?bF.date:bF.object;default:return bF.unknown}},RF=SF.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class vF extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,r=0;for(;r<s.path.length;){const n=s.path[r];r===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,SF.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}vF.create=e=>new vF(e);const NF=(e,t)=>{let n;switch(e.code){case RF.invalid_type:n=e.received===bF.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case RF.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,SF.jsonStringifyReplacer)}`;break;case RF.unrecognized_keys:n=`Unrecognized key(s) in object: ${SF.joinValues(e.keys,", ")}`;break;case RF.invalid_union:n="Invalid input";break;case RF.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${SF.joinValues(e.options)}`;break;case RF.invalid_enum_value:n=`Invalid enum value. Expected ${SF.joinValues(e.options)}, received '${e.received}'`;break;case RF.invalid_arguments:n="Invalid function arguments";break;case RF.invalid_return_type:n="Invalid function return type";break;case RF.invalid_date:n="Invalid date";break;case RF.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:SF.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case RF.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case RF.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case RF.custom:n="Invalid input";break;case RF.invalid_intersection_types:n="Intersection results could not be merged";break;case RF.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case RF.not_finite:n="Number must be finite";break;default:n=t.defaultError,SF.assertNever(e)}return{message:n}};let CF=NF;function OF(){return CF}const IF=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,o=[...n,...s.path||[]],i={...s,path:o};let a="";const c=r.filter(e=>!!e).slice().reverse();for(const e of c)a=e(i,{data:t,defaultError:a}).message;return{...s,path:o,message:s.message||a}};function PF(e,t){const n=IF({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,OF(),NF].filter(e=>!!e)});e.common.issues.push(n)}class LF{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return wF;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t)n.push({key:await e.key,value:await e.value});return LF.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:s}=r;if("aborted"===t.status)return wF;if("aborted"===s.status)return wF;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),(void 0!==s.value||r.alwaysSet)&&(n[t.value]=s.value)}return{status:e.value,value:n}}}const wF=Object.freeze({status:"aborted"}),MF=e=>({status:"dirty",value:e}),xF=e=>({status:"valid",value:e}),kF=e=>"aborted"===e.status,GF=e=>"dirty"===e.status,DF=e=>"valid"===e.status,VF=e=>"undefined"!=typeof Promise&&e instanceof Promise;var UF;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(UF||(UF={}));class HF{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const jF=(e,t)=>{if(DF(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new vF(e.common.issues);return this._error=t,this._error}}};function ZF(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:s};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=r?r:t.defaultError}:{message:null!=n?n:t.defaultError},description:s}}class WF{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return AF(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:AF(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new LF,ctx:{common:e.parent.common,data:e.data,parsedType:AF(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(VF(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:AF(e)},s=this._parseSync({data:e,path:r.path,parent:r});return jF(r,s)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:AF(e)},r=this._parse({data:e,path:n.path,parent:n}),s=await(VF(r)?r:Promise.resolve(r));return jF(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const s=e(t),o=()=>r.addIssue({code:RF.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(o(),!1)):!!s||(o(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1))}_refinement(e){return new wY({schema:this,typeName:WY.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return MY.create(this,this._def)}nullable(){return xY.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return hY.create(this,this._def)}promise(){return LY.create(this,this._def)}or(e){return _Y.create([this,e],this._def)}and(e){return yY.create(this,e,this._def)}transform(e){return new wY({...ZF(this._def),schema:this,typeName:WY.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new kY({...ZF(this._def),innerType:this,defaultValue:t,typeName:WY.ZodDefault})}brand(){return new UY({typeName:WY.ZodBranded,type:this,...ZF(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new GY({...ZF(this._def),innerType:this,catchValue:t,typeName:WY.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return HY.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const XF=/^c[^\s-]{8,}$/i,$F=/^[a-z][a-z0-9]*$/,FF=/[0-9A-HJKMNP-TV-Z]{26}/,YF=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,BF=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,KF=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,JF=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,zF=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,QF=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function qF(e,t){return!("v4"!==t&&t||!JF.test(e))||!("v6"!==t&&t||!zF.test(e))}class eY extends WF{constructor(){super(...arguments),this._regex=(e,t,n)=>this.refinement(t=>e.test(t),{validation:t,code:RF.invalid_string,...UF.errToObj(n)}),this.nonempty=e=>this.min(1,UF.errToObj(e)),this.trim=()=>new eY({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new eY({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new eY({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==bF.string){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.string,received:t.parsedType}),wF}const t=new LF;let n;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const s=e.data.length>r.value,o=e.data.length<r.value;(s||o)&&(n=this._getOrReturnCtx(e,n),s?PF(n,{code:RF.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):o&&PF(n,{code:RF.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)BF.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"email",code:RF.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)KF.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"emoji",code:RF.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)YF.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"uuid",code:RF.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)XF.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"cuid",code:RF.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)$F.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"cuid2",code:RF.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)FF.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"ulid",code:RF.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(s){n=this._getOrReturnCtx(e,n),PF(n,{validation:"url",code:RF.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"regex",code:RF.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){QF(r).test(e.data)||(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else"ip"===r.kind?qF(e.data,r.version)||(n=this._getOrReturnCtx(e,n),PF(n,{validation:"ip",code:RF.invalid_string,message:r.message}),t.dirty()):SF.assertNever(r);return{status:t.value,value:e.data}}_addCheck(e){return new eY({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...UF.errToObj(e)})}url(e){return this._addCheck({kind:"url",...UF.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...UF.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...UF.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...UF.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...UF.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...UF.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...UF.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...UF.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...UF.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...UF.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...UF.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...UF.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...UF.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...UF.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...UF.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function tY(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}eY.create=e=>{var t;return new eY({checks:[],typeName:WY.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ZF(e)})};class nY extends WF{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==bF.number){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.number,received:t.parsedType}),wF}let t;const n=new LF;for(const r of this._def.checks)if("int"===r.kind)SF.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else"multipleOf"===r.kind?0!==tY(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.not_finite,message:r.message}),n.dirty()):SF.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,UF.toString(t))}gt(e,t){return this.setLimit("min",e,!1,UF.toString(t))}lte(e,t){return this.setLimit("max",e,!0,UF.toString(t))}lt(e,t){return this.setLimit("max",e,!1,UF.toString(t))}setLimit(e,t,n,r){return new nY({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:UF.toString(r)}]})}_addCheck(e){return new nY({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:UF.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:UF.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:UF.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:UF.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:UF.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:UF.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:UF.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:UF.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:UF.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&SF.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}nY.create=e=>new nY({checks:[],typeName:WY.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...ZF(e)});class rY extends WF{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==bF.bigint){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.bigint,received:t.parsedType}),wF}let t;const n=new LF;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),PF(t,{code:RF.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):SF.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,UF.toString(t))}gt(e,t){return this.setLimit("min",e,!1,UF.toString(t))}lte(e,t){return this.setLimit("max",e,!0,UF.toString(t))}lt(e,t){return this.setLimit("max",e,!1,UF.toString(t))}setLimit(e,t,n,r){return new rY({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:UF.toString(r)}]})}_addCheck(e){return new rY({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:UF.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:UF.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:UF.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:UF.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:UF.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}rY.create=e=>{var t;return new rY({checks:[],typeName:WY.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ZF(e)})};class sY extends WF{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==bF.boolean){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.boolean,received:t.parsedType}),wF}return xF(e.data)}}sY.create=e=>new sY({typeName:WY.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...ZF(e)});class oY extends WF{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==bF.date){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.date,received:t.parsedType}),wF}if(isNaN(e.data.getTime())){return PF(this._getOrReturnCtx(e),{code:RF.invalid_date}),wF}const t=new LF;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),PF(n,{code:RF.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):SF.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new oY({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:UF.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:UF.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}oY.create=e=>new oY({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:WY.ZodDate,...ZF(e)});class iY extends WF{_parse(e){if(this._getType(e)!==bF.symbol){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.symbol,received:t.parsedType}),wF}return xF(e.data)}}iY.create=e=>new iY({typeName:WY.ZodSymbol,...ZF(e)});class aY extends WF{_parse(e){if(this._getType(e)!==bF.undefined){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.undefined,received:t.parsedType}),wF}return xF(e.data)}}aY.create=e=>new aY({typeName:WY.ZodUndefined,...ZF(e)});class cY extends WF{_parse(e){if(this._getType(e)!==bF.null){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.null,received:t.parsedType}),wF}return xF(e.data)}}cY.create=e=>new cY({typeName:WY.ZodNull,...ZF(e)});class uY extends WF{constructor(){super(...arguments),this._any=!0}_parse(e){return xF(e.data)}}uY.create=e=>new uY({typeName:WY.ZodAny,...ZF(e)});class lY extends WF{constructor(){super(...arguments),this._unknown=!0}_parse(e){return xF(e.data)}}lY.create=e=>new lY({typeName:WY.ZodUnknown,...ZF(e)});class pY extends WF{_parse(e){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.never,received:t.parsedType}),wF}}pY.create=e=>new pY({typeName:WY.ZodNever,...ZF(e)});class dY extends WF{_parse(e){if(this._getType(e)!==bF.undefined){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.void,received:t.parsedType}),wF}return xF(e.data)}}dY.create=e=>new dY({typeName:WY.ZodVoid,...ZF(e)});class hY extends WF{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==bF.array)return PF(t,{code:RF.invalid_type,expected:bF.array,received:t.parsedType}),wF;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(PF(t,{code:e?RF.too_big:RF.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(PF(t,{code:RF.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(PF(t,{code:RF.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new HF(t,e,t.path,n)))).then(e=>LF.mergeArray(n,e));const s=[...t.data].map((e,n)=>r.type._parseSync(new HF(t,e,t.path,n)));return LF.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new hY({...this._def,minLength:{value:e,message:UF.toString(t)}})}max(e,t){return new hY({...this._def,maxLength:{value:e,message:UF.toString(t)}})}length(e,t){return new hY({...this._def,exactLength:{value:e,message:UF.toString(t)}})}nonempty(e){return this.min(1,e)}}function mY(e){if(e instanceof fY){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=MY.create(mY(r))}return new fY({...e._def,shape:()=>t})}return e instanceof hY?new hY({...e._def,type:mY(e.element)}):e instanceof MY?MY.create(mY(e.unwrap())):e instanceof xY?xY.create(mY(e.unwrap())):e instanceof TY?TY.create(e.items.map(e=>mY(e))):e}hY.create=(e,t)=>new hY({type:e,minLength:null,maxLength:null,exactLength:null,typeName:WY.ZodArray,...ZF(t)});class fY extends WF{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=SF.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==bF.object){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.object,received:t.parsedType}),wF}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof pY&&"strip"===this._def.unknownKeys))for(const e in n.data)s.includes(e)||o.push(e);const i=[];for(const e of s){const t=r[e],s=n.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new HF(n,s,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof pY){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of o)i.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)o.length>0&&(PF(n,{code:RF.unrecognized_keys,keys:o}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of o){const r=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new HF(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key;e.push({key:n,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>LF.mergeObjectSync(t,e)):LF.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return UF.errToObj,new fY({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,s,o,i;const a=null!==(o=null===(s=(r=this._def).errorMap)||void 0===s?void 0:s.call(r,t,n).message)&&void 0!==o?o:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=UF.errToObj(e).message)&&void 0!==i?i:a}:{message:a}}}:{}})}strip(){return new fY({...this._def,unknownKeys:"strip"})}passthrough(){return new fY({...this._def,unknownKeys:"passthrough"})}extend(e){return new fY({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new fY({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:WY.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new fY({...this._def,catchall:e})}pick(e){const t={};return SF.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new fY({...this._def,shape:()=>t})}omit(e){const t={};return SF.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new fY({...this._def,shape:()=>t})}deepPartial(){return mY(this)}partial(e){const t={};return SF.objectKeys(this.shape).forEach(n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}),new fY({...this._def,shape:()=>t})}required(e){const t={};return SF.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof MY;)e=e._def.innerType;t[n]=e}}),new fY({...this._def,shape:()=>t})}keyof(){return OY(SF.objectKeys(this.shape))}}fY.create=(e,t)=>new fY({shape:()=>e,unknownKeys:"strip",catchall:pY.create(),typeName:WY.ZodObject,...ZF(t)}),fY.strictCreate=(e,t)=>new fY({shape:()=>e,unknownKeys:"strict",catchall:pY.create(),typeName:WY.ZodObject,...ZF(t)}),fY.lazycreate=(e,t)=>new fY({shape:e,unknownKeys:"strip",catchall:pY.create(),typeName:WY.ZodObject,...ZF(t)});class _Y extends WF{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map(e=>new vF(e.ctx.common.issues));return PF(t,{code:RF.invalid_union,unionErrors:n}),wF});{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},o=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===o.status)return o;"dirty"!==o.status||e||(e={result:o,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=r.map(e=>new vF(e));return PF(t,{code:RF.invalid_union,unionErrors:s}),wF}}get options(){return this._def.options}}_Y.create=(e,t)=>new _Y({options:e,typeName:WY.ZodUnion,...ZF(t)});const gY=e=>e instanceof NY?gY(e.schema):e instanceof wY?gY(e.innerType()):e instanceof CY?[e.value]:e instanceof IY?e.options:e instanceof PY?Object.keys(e.enum):e instanceof kY?gY(e._def.innerType):e instanceof aY?[void 0]:e instanceof cY?[null]:null;class EY extends WF{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==bF.object)return PF(t,{code:RF.invalid_type,expected:bF.object,received:t.parsedType}),wF;const n=this.discriminator,r=t.data[n],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(PF(t,{code:RF.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),wF)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=gY(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,n)}}return new EY({typeName:WY.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...ZF(n)})}}function SY(e,t){const n=AF(e),r=AF(t);if(e===t)return{valid:!0,data:e};if(n===bF.object&&r===bF.object){const n=SF.objectKeys(t),r=SF.objectKeys(e).filter(e=>-1!==n.indexOf(e)),s={...e,...t};for(const n of r){const r=SY(e[n],t[n]);if(!r.valid)return{valid:!1};s[n]=r.data}return{valid:!0,data:s}}if(n===bF.array&&r===bF.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const s=SY(e[r],t[r]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===bF.date&&r===bF.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class yY extends WF{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(kF(e)||kF(r))return wF;const s=SY(e.value,r.value);return s.valid?((GF(e)||GF(r))&&t.dirty(),{status:t.value,value:s.data}):(PF(n,{code:RF.invalid_intersection_types}),wF)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}yY.create=(e,t,n)=>new yY({left:e,right:t,typeName:WY.ZodIntersection,...ZF(n)});class TY extends WF{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==bF.array)return PF(n,{code:RF.invalid_type,expected:bF.array,received:n.parsedType}),wF;if(n.data.length<this._def.items.length)return PF(n,{code:RF.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),wF;!this._def.rest&&n.data.length>this._def.items.length&&(PF(n,{code:RF.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new HF(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>LF.mergeArray(t,e)):LF.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new TY({...this._def,rest:e})}}TY.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new TY({items:e,typeName:WY.ZodTuple,rest:null,...ZF(t)})};class bY extends WF{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==bF.object)return PF(n,{code:RF.invalid_type,expected:bF.object,received:n.parsedType}),wF;const r=[],s=this._def.keyType,o=this._def.valueType;for(const e in n.data)r.push({key:s._parse(new HF(n,e,n.path,e)),value:o._parse(new HF(n,n.data[e],n.path,e))});return n.common.async?LF.mergeObjectAsync(t,r):LF.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new bY(t instanceof WF?{keyType:e,valueType:t,typeName:WY.ZodRecord,...ZF(n)}:{keyType:eY.create(),valueType:e,typeName:WY.ZodRecord,...ZF(t)})}}class AY extends WF{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==bF.map)return PF(n,{code:RF.invalid_type,expected:bF.map,received:n.parsedType}),wF;const r=this._def.keyType,s=this._def.valueType,o=[...n.data.entries()].map(([e,t],o)=>({key:r._parse(new HF(n,e,n.path,[o,"key"])),value:s._parse(new HF(n,t,n.path,[o,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of o){const r=await n.key,s=await n.value;if("aborted"===r.status||"aborted"===s.status)return wF;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of o){const r=n.key,s=n.value;if("aborted"===r.status||"aborted"===s.status)return wF;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}AY.create=(e,t,n)=>new AY({valueType:t,keyType:e,typeName:WY.ZodMap,...ZF(n)});class RY extends WF{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==bF.set)return PF(n,{code:RF.invalid_type,expected:bF.set,received:n.parsedType}),wF;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(PF(n,{code:RF.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(PF(n,{code:RF.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function o(e){const n=new Set;for(const r of e){if("aborted"===r.status)return wF;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>s._parse(new HF(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>o(e)):o(i)}min(e,t){return new RY({...this._def,minSize:{value:e,message:UF.toString(t)}})}max(e,t){return new RY({...this._def,maxSize:{value:e,message:UF.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}RY.create=(e,t)=>new RY({valueType:e,minSize:null,maxSize:null,typeName:WY.ZodSet,...ZF(t)});class vY extends WF{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==bF.function)return PF(t,{code:RF.invalid_type,expected:bF.function,received:t.parsedType}),wF;function n(e,n){return IF({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,OF(),NF].filter(e=>!!e),issueData:{code:RF.invalid_arguments,argumentsError:n}})}function r(e,n){return IF({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,OF(),NF].filter(e=>!!e),issueData:{code:RF.invalid_return_type,returnTypeError:n}})}const s={errorMap:t.common.contextualErrorMap},o=t.data;return this._def.returns instanceof LY?xF(async(...e)=>{const t=new vF([]),i=await this._def.args.parseAsync(e,s).catch(r=>{throw t.addIssue(n(e,r)),t}),a=await o(...i);return await this._def.returns._def.type.parseAsync(a,s).catch(e=>{throw t.addIssue(r(a,e)),t})}):xF((...e)=>{const t=this._def.args.safeParse(e,s);if(!t.success)throw new vF([n(e,t.error)]);const i=o(...t.data),a=this._def.returns.safeParse(i,s);if(!a.success)throw new vF([r(i,a.error)]);return a.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new vY({...this._def,args:TY.create(e).rest(lY.create())})}returns(e){return new vY({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new vY({args:e||TY.create([]).rest(lY.create()),returns:t||lY.create(),typeName:WY.ZodFunction,...ZF(n)})}}class NY extends WF{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}NY.create=(e,t)=>new NY({getter:e,typeName:WY.ZodLazy,...ZF(t)});class CY extends WF{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return PF(t,{received:t.data,code:RF.invalid_literal,expected:this._def.value}),wF}return{status:"valid",value:e.data}}get value(){return this._def.value}}function OY(e,t){return new IY({values:e,typeName:WY.ZodEnum,...ZF(t)})}CY.create=(e,t)=>new CY({value:e,typeName:WY.ZodLiteral,...ZF(t)});class IY extends WF{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return PF(t,{expected:SF.joinValues(n),received:t.parsedType,code:RF.invalid_type}),wF}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return PF(t,{received:t.data,code:RF.invalid_enum_value,options:n}),wF}return xF(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return IY.create(e)}exclude(e){return IY.create(this.options.filter(t=>!e.includes(t)))}}IY.create=OY;class PY extends WF{_parse(e){const t=SF.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==bF.string&&n.parsedType!==bF.number){const e=SF.objectValues(t);return PF(n,{expected:SF.joinValues(e),received:n.parsedType,code:RF.invalid_type}),wF}if(-1===t.indexOf(e.data)){const e=SF.objectValues(t);return PF(n,{received:n.data,code:RF.invalid_enum_value,options:e}),wF}return xF(e.data)}get enum(){return this._def.values}}PY.create=(e,t)=>new PY({values:e,typeName:WY.ZodNativeEnum,...ZF(t)});class LY extends WF{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==bF.promise&&!1===t.common.async)return PF(t,{code:RF.invalid_type,expected:bF.promise,received:t.parsedType}),wF;const n=t.parsedType===bF.promise?t.data:Promise.resolve(t.data);return xF(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}LY.create=(e,t)=>new LY({type:e,typeName:WY.ZodPromise,...ZF(t)});class wY extends WF{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===WY.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null;if("preprocess"===r.type){const e=r.transform(n.data);return n.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n})):this._def.schema._parseSync({data:e,path:n.path,parent:n})}const s={addIssue:e=>{PF(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"refinement"===r.type){const e=e=>{const t=r.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?wF:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?wF:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!DF(e))return e;const o=r.transform(e.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>DF(e)?Promise.resolve(r.transform(e.value,s)).then(e=>({status:t.value,value:e})):e)}SF.assertNever(r)}}wY.create=(e,t,n)=>new wY({schema:e,typeName:WY.ZodEffects,effect:t,...ZF(n)}),wY.createWithPreprocess=(e,t,n)=>new wY({schema:t,effect:{type:"preprocess",transform:e},typeName:WY.ZodEffects,...ZF(n)});class MY extends WF{_parse(e){return this._getType(e)===bF.undefined?xF(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}MY.create=(e,t)=>new MY({innerType:e,typeName:WY.ZodOptional,...ZF(t)});class xY extends WF{_parse(e){return this._getType(e)===bF.null?xF(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}xY.create=(e,t)=>new xY({innerType:e,typeName:WY.ZodNullable,...ZF(t)});class kY extends WF{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===bF.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}kY.create=(e,t)=>new kY({innerType:e,typeName:WY.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...ZF(t)});class GY extends WF{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return VF(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new vF(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new vF(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}GY.create=(e,t)=>new GY({innerType:e,typeName:WY.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...ZF(t)});class DY extends WF{_parse(e){if(this._getType(e)!==bF.nan){const t=this._getOrReturnCtx(e);return PF(t,{code:RF.invalid_type,expected:bF.nan,received:t.parsedType}),wF}return{status:"valid",value:e.data}}}DY.create=e=>new DY({typeName:WY.ZodNaN,...ZF(e)});const VY=Symbol("zod_brand");class UY extends WF{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class HY extends WF{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?wF:"dirty"===e.status?(t.dirty(),MF(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?wF:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new HY({in:e,out:t,typeName:WY.ZodPipeline})}}const jY=(e,t={},n)=>e?uY.create().superRefine((r,s)=>{var o,i;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,a=null===(i=null!==(o=e.fatal)&&void 0!==o?o:n)||void 0===i||i,c="string"==typeof e?{message:e}:e;s.addIssue({code:"custom",...c,fatal:a})}}):uY.create(),ZY={object:fY.lazycreate};var WY;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"}(WY||(WY={}));const XY=eY.create,$Y=nY.create,FY=DY.create,YY=rY.create,BY=sY.create,KY=oY.create,JY=iY.create,zY=aY.create,QY=cY.create,qY=uY.create,eB=lY.create,tB=pY.create,nB=dY.create,rB=hY.create,sB=fY.create,oB=fY.strictCreate,iB=_Y.create,aB=EY.create,cB=yY.create,uB=TY.create,lB=bY.create,pB=AY.create,dB=RY.create,hB=vY.create,mB=NY.create,fB=CY.create,_B=IY.create,gB=PY.create,EB=LY.create,SB=wY.create,yB=MY.create,TB=xY.create,bB=wY.createWithPreprocess,AB=HY.create,RB={string:e=>eY.create({...e,coerce:!0}),number:e=>nY.create({...e,coerce:!0}),boolean:e=>sY.create({...e,coerce:!0}),bigint:e=>rY.create({...e,coerce:!0}),date:e=>oY.create({...e,coerce:!0})},vB=wF;var NB=Object.freeze({__proto__:null,defaultErrorMap:NF,setErrorMap:function(e){CF=e},getErrorMap:OF,makeIssue:IF,EMPTY_PATH:[],addIssueToContext:PF,ParseStatus:LF,INVALID:wF,DIRTY:MF,OK:xF,isAborted:kF,isDirty:GF,isValid:DF,isAsync:VF,get util(){return SF},get objectUtil(){return yF},ZodParsedType:bF,getParsedType:AF,ZodType:WF,ZodString:eY,ZodNumber:nY,ZodBigInt:rY,ZodBoolean:sY,ZodDate:oY,ZodSymbol:iY,ZodUndefined:aY,ZodNull:cY,ZodAny:uY,ZodUnknown:lY,ZodNever:pY,ZodVoid:dY,ZodArray:hY,ZodObject:fY,ZodUnion:_Y,ZodDiscriminatedUnion:EY,ZodIntersection:yY,ZodTuple:TY,ZodRecord:bY,ZodMap:AY,ZodSet:RY,ZodFunction:vY,ZodLazy:NY,ZodLiteral:CY,ZodEnum:IY,ZodNativeEnum:PY,ZodPromise:LY,ZodEffects:wY,ZodTransformer:wY,ZodOptional:MY,ZodNullable:xY,ZodDefault:kY,ZodCatch:GY,ZodNaN:DY,BRAND:VY,ZodBranded:UY,ZodPipeline:HY,custom:jY,Schema:WF,ZodSchema:WF,late:ZY,get ZodFirstPartyTypeKind(){return WY},coerce:RB,any:qY,array:rB,bigint:YY,boolean:BY,date:KY,discriminatedUnion:aB,effect:SB,enum:_B,function:hB,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>jY(t=>t instanceof e,t),intersection:cB,lazy:mB,literal:fB,map:pB,nan:FY,nativeEnum:gB,never:tB,null:QY,nullable:TB,number:$Y,object:sB,oboolean:()=>BY().optional(),onumber:()=>$Y().optional(),optional:yB,ostring:()=>XY().optional(),pipeline:AB,preprocess:bB,promise:EB,record:lB,set:dB,strictObject:oB,string:XY,symbol:JY,transformer:SB,tuple:uB,undefined:zY,union:iB,unknown:eB,void:nB,NEVER:vB,ZodIssueCode:RF,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:vF});const CB=["interface","display","layout","module","panel"],OB=["hook","endpoint"],IB=["operation"],PB="directus:extension",LB=NB.object({app:NB.string(),api:NB.string()}),wB=NB.union([NB.object({type:NB.union([NB.enum(CB),NB.enum(OB)]),name:NB.string(),source:NB.string()}),NB.object({type:NB.enum(IB),name:NB.string(),source:LB})]),MB=NB.object({host:NB.string(),hidden:NB.boolean().optional()}),xB=NB.object({type:NB.union([NB.enum(CB),NB.enum(OB)]),path:NB.string(),source:NB.string()}),kB=NB.object({type:NB.enum(IB),path:LB,source:LB}),GB=NB.object({type:NB.literal("bundle"),path:LB,entries:NB.array(wB)});NB.array(wB);const DB=MB.and(NB.union([xB,kB,GB]));var VB,UB;NB.object({name:NB.string(),version:NB.string(),dependencies:NB.record(NB.string()).optional(),[PB]:DB}),function(e){e.NULL="null",e.UNDEFINED="undefined",e.STRING="string",e.INTEGER="integer",e.FLOAT="float",e.BOOLEAN="boolean",e.EMPTY="empty"}(VB||(VB={})),function(e){e[e.TRUE=-1]="TRUE",e[e.FALSE=-2]="FALSE",e[e.NULL=-3]="NULL",e[e.EMPTY=-4]="EMPTY",e[e.UNDEFINED=-5]="UNDEFINED"}(UB||(UB={}));var HB=(0).constructor;HB.isFinite,HB.isInteger,[].constructor.isArray;new(function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var n=this.cachedKeys[this.oldestIndex];void 0!==n&&delete this.map[n],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}())(1e3);var jB,ZB,WB,XB,$B,FB,YB,BB={exports:{}};function KB(){return WB||(WB=1,function(e,t){const n=ZB?jB:(ZB=1,jB=function(...e){try{return JSON.stringify(...e)}catch(e){return"[Cannot display object: "+e.message+"]"}});BB.exports=class extends Error{constructor(e){super(e.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:n(e)).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}}(0,BB.exports)),BB.exports}function JB(){if($B)return XB;$B=1;const e=KB();return XB=function(t,...n){if(!t){if(1===n.length&&n[0]instanceof Error)throw n[0];throw new e(n)}}}function zB(){if(YB)return FB;YB=1;const e=JB(),t={};return FB=function(n,r,s){if(!1===r||null==r)return n;"string"==typeof(s=s||{})&&(s={separator:s});const o=Array.isArray(r);e(!o||!s.separator,"Separator option is not valid for array-based chain");const i=o?r:r.split(s.separator||".");let a=n;for(let n=0;n<i.length;++n){let o=i[n];const c=s.iterables&&t.iterables(a);if(Array.isArray(a)||"set"===c){const e=Number(o);Number.isInteger(e)&&(o=e<0?a.length+e:e)}if(!a||"function"==typeof a&&!1===s.functions||!c&&void 0===a[o]){e(!s.strict||n+1===i.length,"Missing segment",o,"in reach path ",r),e("object"==typeof a||!0===s.functions||"function"!=typeof a,"Invalid segment",o,"in reach path ",r),a=s.default;break}a=c?"set"===c?[...a][o]:a.get(o):a[o]}return a},t.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0},FB}var QB,qB={exports:{}};function eK(){return QB||(QB=1,function(e,t){const n={};t=qB.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},n.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const r=Object.prototype.toString.call(e);return n.typeMap.get(r)||t.generic}}(0,qB.exports)),qB.exports}var tK,nK,rK,sK={};function oK(){return tK||(tK=1,sK.keys=function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}),sK}function iK(){if(rK)return nK;rK=1;const e=zB(),t=eK(),n=oK(),r={needsProtoHack:new Set([t.set,t.map,t.weakSet,t.weakMap])};return nK=r.clone=function(e,s={},o=null){if("object"!=typeof e||null===e)return e;let i=r.clone,a=o;if(s.shallow){if(!0!==s.shallow)return r.cloneWithShallow(e,s);i=e=>e}else if(a){const t=a.get(e);if(t)return t}else a=new Map;const c=t.getInternalProto(e);if(c===t.buffer)return Buffer&&Buffer.from(e);if(c===t.date)return new Date(e.getTime());if(c===t.regex)return new RegExp(e);const u=r.base(e,c,s);if(u===e)return e;if(a&&a.set(e,u),c===t.set)for(const t of e)u.add(i(t,s,a));else if(c===t.map)for(const[t,n]of e)u.set(t,i(n,s,a));const l=n.keys(e,s);for(const n of l){if("__proto__"===n)continue;if(c===t.array&&"length"===n){u.length=e.length;continue}const r=Object.getOwnPropertyDescriptor(e,n);r?r.get||r.set?Object.defineProperty(u,n,r):r.enumerable?u[n]=i(e[n],s,a):Object.defineProperty(u,n,{enumerable:!1,writable:!0,configurable:!0,value:i(e[n],s,a)}):Object.defineProperty(u,n,{enumerable:!0,writable:!0,configurable:!0,value:i(e[n],s,a)})}return u},r.cloneWithShallow=function(t,n){const s=n.shallow;(n=Object.assign({},n)).shallow=!1;const o=new Map;for(const n of s){const r=e(t,n);"object"!=typeof r&&"function"!=typeof r||o.set(r,r)}return r.clone(t,n,o)},r.base=function(e,n,s){if(!1===s.prototype)return r.needsProtoHack.has(n)?new n.constructor:n===t.array?[]:{};const o=Object.getPrototypeOf(e);if(o&&o.isImmutable)return e;if(n===t.array){const e=[];return o!==n&&Object.setPrototypeOf(e,o),e}if(r.needsProtoHack.has(n)){const e=new o.constructor;return o!==n&&Object.setPrototypeOf(e,o),e}return Object.create(o)},nK}var aK,cK={},uK={},lK={name:"joi",description:"Object schema validation",version:"17.9.1",repository:"git://github.com/hapijs/joi",main:"lib/index.js",types:"lib/index.d.ts",browser:"dist/joi-browser.min.js",files:["lib/**/*","dist/*"],keywords:["schema","validation"],dependencies:{"@hapi/hoek":"^9.0.0","@hapi/topo":"^5.0.0","@sideway/address":"^4.1.3","@sideway/formula":"^3.0.1","@sideway/pinpoint":"^2.0.0"},devDependencies:{"@hapi/bourne":"2.x.x","@hapi/code":"8.x.x","@hapi/joi-legacy-test":"npm:@hapi/joi@15.x.x","@hapi/lab":"^25.0.1","@types/node":"^14.18.24",typescript:"4.3.x"},scripts:{prepublishOnly:"cd browser && npm install && npm run build",test:"lab -t 100 -a @hapi/code -L -Y","test-cov-html":"lab -r html -o coverage.html -a @hapi/code"},license:"BSD-3-Clause"},pK={};function dK(){if(aK)return pK;aK=1;const e=Cz(),t={};return t.wrap=e.string().min(1).max(2).allow(!1),pK.preferences=e.object({allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),context:e.object(),convert:e.boolean(),dateFormat:e.valid("date","iso","string","time","utc"),debug:e.boolean(),errors:{escapeHtml:e.boolean(),label:e.valid("path","key",!1),language:[e.string(),e.object().ref()],render:e.boolean(),stack:e.boolean(),wrap:{label:t.wrap,array:t.wrap,string:t.wrap}},externals:e.boolean(),messages:e.object(),noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:e.valid("required","optional","forbidden"),skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()}).strict(),t.nameRx=/^[a-zA-Z0-9]\w*$/,t.rule=e.object({alias:e.array().items(e.string().pattern(t.nameRx)).single(),args:e.array().items(e.string(),e.object({name:e.string().pattern(t.nameRx).required(),ref:e.boolean(),assert:e.alternatives([e.function(),e.object().schema()]).conditional("ref",{is:!0,then:e.required()}),normalize:e.function(),message:e.string().when("assert",{is:e.function(),then:e.required()})})),convert:e.boolean(),manifest:e.boolean(),method:e.function().allow(!1),multi:e.boolean(),validate:e.function()}),pK.extension=e.object({type:e.alternatives([e.string(),e.object().regex()]).required(),args:e.function(),cast:e.object().pattern(t.nameRx,e.object({from:e.function().maxArity(1).required(),to:e.function().minArity(1).maxArity(2).required()})),base:e.object().schema().when("type",{is:e.object().regex(),then:e.forbidden()}),coerce:[e.function().maxArity(3),e.object({method:e.function().maxArity(3).required(),from:e.array().items(e.string()).single()})],flags:e.object().pattern(t.nameRx,e.object({setter:e.string(),default:e.any()})),manifest:{build:e.function().arity(2)},messages:[e.object(),e.string()],modifiers:e.object().pattern(t.nameRx,e.function().minArity(1).maxArity(2)),overrides:e.object().pattern(t.nameRx,e.function()),prepare:e.function().maxArity(3),rebuild:e.function().arity(1),rules:e.object().pattern(t.nameRx,t.rule),terms:e.object().pattern(t.nameRx,e.object({init:e.array().allow(null).required(),manifest:e.object().pattern(/.+/,[e.valid("schema","single"),e.object({mapped:e.object({from:e.string().required(),to:e.string().required()}).required()})])})),validate:e.function().maxArity(3)}).strict(),pK.extensions=e.array().items(e.object(),e.function().arity(1)).strict(),t.desc={buffer:e.object({buffer:e.string()}),func:e.object({function:e.function().required(),options:{literal:!0}}),override:e.object({override:!0}),ref:e.object({ref:e.object({type:e.valid("value","global","local"),path:e.array().required(),separator:e.string().length(1).allow(!1),ancestor:e.number().min(0).integer().allow("root"),map:e.array().items(e.array().length(2)).min(1),adjust:e.function(),iterables:e.boolean(),in:e.boolean(),render:e.boolean()}).required()}),regex:e.object({regex:e.string().min(3)}),special:e.object({special:e.valid("deep").required()}),template:e.object({template:e.string().required(),options:e.object()}),value:e.object({value:e.alternatives([e.object(),e.array()]).required()})},t.desc.entity=e.alternatives([e.array().items(e.link("...")),e.boolean(),e.function(),e.number(),e.string(),t.desc.buffer,t.desc.func,t.desc.ref,t.desc.regex,t.desc.special,t.desc.template,t.desc.value,e.link("/")]),t.desc.values=e.array().items(null,e.boolean(),e.function(),e.number().allow(1/0,-1/0),e.string().allow(""),e.symbol(),t.desc.buffer,t.desc.func,t.desc.override,t.desc.ref,t.desc.regex,t.desc.template,t.desc.value),t.desc.messages=e.object().pattern(/.+/,[e.string(),t.desc.template,e.object().pattern(/.+/,[e.string(),t.desc.template])]),pK.description=e.object({type:e.string().required(),flags:e.object({cast:e.string(),default:e.any(),description:e.string(),empty:e.link("/"),failover:t.desc.entity,id:e.string(),label:e.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:e.boolean(),unit:e.string()}).unknown(),preferences:{allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),convert:e.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:e.boolean(),label:["path","key"],language:[e.string(),t.desc.ref],wrap:{label:t.wrap,array:t.wrap}},externals:e.boolean(),messages:t.desc.messages,noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:["required","optional","forbidden"],skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()},allow:t.desc.values,invalid:t.desc.values,rules:e.array().min(1).items({name:e.string().required(),args:e.object().min(1),keep:e.boolean(),message:[e.string(),t.desc.messages],warn:e.boolean()}),keys:e.object().pattern(/.*/,e.link("/")),link:t.desc.ref}).pattern(/^[a-z]\w*$/,e.any()),pK}var hK={},mK={exports:{}};const fK={};var _K=function(e){if(!e)return"";let t="";for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);fK.isSafe(r)?t+=e[n]:t+=fK.escapeHtmlChar(r)}return t};fK.escapeHtmlChar=function(e){const t=fK.namedHtml.get(e);if(t)return t;if(e>=256)return"&#"+e+";";return`&#x${e.toString(16).padStart(2,"0")};`},fK.isSafe=function(e){return fK.safeCharCodes.has(e)},fK.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),fK.safeCharCodes=function(){const e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&e.add(t);return e}();var gK={};!function(e){const t={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(e,n={}){if(!n[t.settings]&&n.constants)for(const e in n.constants){const t=n.constants[e];if(null!==t&&!["boolean","number","string"].includes(typeof t))throw new Error(`Formula constant ${e} contains invalid ${typeof t} value type`)}this.settings=n[t.settings]?n:Object.assign({[t.settings]:!0,constants:{},functions:{}},n),this.single=null,this._parts=null,this._parse(e)}_parse(n){let r=[],s="",o=0,i=!1;const a=n=>{if(o)throw new Error("Formula missing closing parenthesis");const a=r.length?r[r.length-1]:null;if(i||s||n){if(a&&"reference"===a.type&&")"===n)return a.type="function",a.value=this._subFormula(s,a.value),void(s="");if(")"===n){const t=new e.Parser(s,this.settings);r.push({type:"segment",value:t})}else if(i){if("]"===i)return r.push({type:"reference",value:s}),void(s="");r.push({type:"literal",value:s})}else if(t.operatorCharacters.includes(s))a&&"operator"===a.type&&t.operators.includes(a.value+s)?a.value+=s:r.push({type:"operator",value:s});else if(s.match(t.numberRx))r.push({type:"constant",value:parseFloat(s)});else if(void 0!==this.settings.constants[s])r.push({type:"constant",value:this.settings.constants[s]});else{if(!s.match(t.tokenRx))throw new Error(`Formula contains invalid token: ${s}`);r.push({type:"reference",value:s})}s=""}};for(const e of n)i?e===i?(a(),i=!1):s+=e:o?"("===e?(s+=e,++o):")"===e?(--o,o?s+=e:a(e)):s+=e:e in t.literals?i=t.literals[e]:"("===e?(a(),++o):t.operatorCharacters.includes(e)?(a(),s=e,a()):" "!==e?s+=e:a();a(),r=r.map((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==r[t-1].type?e:{type:"operator",value:"n"});let c=!1;for(const e of r){if("operator"===e.type){if(t.operatorsPrefix.includes(e.value))continue;if(!c)throw new Error("Formula contains an operator in invalid position");if(!t.operators.includes(e.value))throw new Error(`Formula contains an unknown operator ${e.value}`)}else if(c)throw new Error("Formula missing expected operator");c=!c}if(!c)throw new Error("Formula contains invalid trailing operator");1===r.length&&["reference","literal","constant"].includes(r[0].type)&&(this.single={type:"reference"===r[0].type?"reference":"value",value:r[0].value}),this._parts=r.map(e=>{if("operator"===e.type)return t.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error(`Formula contains invalid reference ${e.value}`);return this.settings.reference?this.settings.reference(e.value):t.reference(e.value)})}_subFormula(n,r){const s=this.settings.functions[r];if("function"!=typeof s)throw new Error(`Formula contains unknown function ${r}`);let o=[];if(n){let e="",s=0,i=!1;const a=()=>{if(!e)throw new Error(`Formula contains function ${r} with invalid arguments ${n}`);o.push(e),e=""};for(let r=0;r<n.length;++r){const o=n[r];i?(e+=o,o===i&&(i=!1)):o in t.literals&&!s?(e+=o,i=t.literals[o]):","!==o||s?(e+=o,"("===o?++s:")"===o&&--s):a()}a()}return o=o.map(t=>new e.Parser(t,this.settings)),function(e){const t=[];for(const n of o)t.push(n.evaluate(e));return s.call(e,...t)}}evaluate(e){const n=this._parts.slice();for(let r=n.length-2;r>=0;--r){const s=n[r];if(s&&"operator"===s.type){const o=n[r+1];n.splice(r+1,1);const i=t.evaluate(o,e);n[r]=t.single(s.value,i)}}return t.operatorsOrder.forEach(r=>{for(let s=1;s<n.length-1;)if(r.includes(n[s])){const r=n[s],o=t.evaluate(n[s-1],e),i=t.evaluate(n[s+1],e);n.splice(s,2);const a=t.calculate(r,o,i);n[s-1]=0===a?0:a}else s+=2}),t.evaluate(n[0],e)}},e.Parser.prototype[t.symbol]=!0,t.reference=function(e){return function(t){return t&&void 0!==t[e]?t[e]:null}},t.evaluate=function(e,n){return null===e?null:"function"==typeof e?e(n):e[t.symbol]?e.evaluate(n):e},t.single=function(e,t){if("!"===e)return!t;const n=-t;return 0===n?0:n},t.calculate=function(e,n,r){if("??"===e)return t.exists(n)?n:r;if("string"==typeof n||"string"==typeof r){if("+"===e)return(n=t.exists(n)?n:"")+(r=t.exists(r)?r:"")}else switch(e){case"^":return Math.pow(n,r);case"*":return n*r;case"/":return n/r;case"%":return n%r;case"+":return n+r;case"-":return n-r}switch(e){case"<":return n<r;case"<=":return n<=r;case">":return n>r;case">=":return n>=r;case"==":return n===r;case"!=":return n!==r;case"&&":return n&&r;case"||":return n||r}return null},t.exists=function(e){return null!=e}}(gK);var EK,SK,yK={},TK={};function bK(){if(EK)return TK;EK=1;const e=iK(),t=MK(),n={annotations:Symbol("annotations")};return TK.error=function(r){if(!this._original||"object"!=typeof this._original)return this.details[0].message;const s=r?"":"[31m",o=r?"":"[41m",i=r?"":"[0m",a=e(this._original);for(let e=this.details.length-1;e>=0;--e){const r=e+1,s=this.details[e],o=s.path;let i=a;for(let e=0;;++e){const a=o[e];if(t.isSchema(i)&&(i=i.clone()),!(e+1<o.length&&"string"!=typeof i[a])){const e=i[n.annotations]||{errors:{},missing:{}};i[n.annotations]=e;const t=a||s.context.key;void 0!==i[a]?(e.errors[t]=e.errors[t]||[],e.errors[t].push(r)):e.missing[t]=r;break}i=i[a]}}const c=/_\$key\$_([, \d]+)_\$end\$_"/g,u=/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,l=/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,p=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g;let d=n.safeStringify(a,2).replace(c,(e,t)=>`" ${s}[${t}]${i}`).replace(u,(e,t,n)=>`${o}"${t}"${i}${s} [${n}]: -- missing --${i}`).replace(l,(e,t,n)=>`\n${n} ${s}[${t}]${i}`).replace(p,(e,t)=>t);d=`${d}\n${s}`;for(let e=0;e<this.details.length;++e){d=`${d}\n[${e+1}] ${this.details[e].message}`}return d+=i,d},n.safeStringify=function(e,t){return JSON.stringify(e,n.serializer(),t)},n.serializer=function(){const e=[],t=[],r=(n,r)=>t[0]===r?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(r)).join(".")+"]";return function(s,o){if(t.length>0){const n=t.indexOf(this);~n?(t.length=n+1,e.length=n+1,e[n]=s):(t.push(this),e.push(s)),~t.indexOf(o)&&(o=r.call(this,s,o))}else t.push(o);if(o){const e=o[n.annotations];if(e){if(Array.isArray(o)){const t=[];for(let n=0;n<o.length;++n)e.errors[n]&&t.push(`_$idx$_${e.errors[n].sort().join(", ")}_$end$_`),t.push(o[n]);o=t}else{for(const t in e.errors)o[`${t}_$key$_${e.errors[t].sort().join(", ")}_$end$_`]=o[t],o[t]=void 0;for(const t in e.missing)o[`_$miss$_${t}|${e.missing[t]}_$end$_`]="__missing__"}return o}}return o===1/0||o===-1/0||Number.isNaN(o)||"function"==typeof o||"symbol"==typeof o?"["+o.toString()+"]":o}},TK}function AK(){return SK||(SK=1,function(e){const t=bK(),n=MK(),r=LK();e.Report=class{constructor(t,n,r,s,o,i,a){if(this.code=t,this.flags=s,this.messages=o,this.path=i.path,this.prefs=a,this.state=i,this.value=n,this.message=null,this.template=null,this.local=r||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;const e=this.code;if(!this.prefs.errors.render)return this.code;const t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===t?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,n){return e.template(this.value,t,n||this.code,this.state,this.prefs)}},e.path=function(e){let t="";for(const n of e)"object"!=typeof n&&("string"==typeof n?(t&&(t+="."),t+=n):t+=`[${n}]`);return t},e.template=function(e,t,s,o,i){if(!t)return;if(r.isTemplate(t))return"root"!==s?t:null;let a=i.errors.language;if(n.isResolvable(a)&&(a=a.resolve(e,o,i)),a&&t[a]){if(void 0!==t[a][s])return t[a][s];if(void 0!==t[a]["*"])return t[a]["*"]}return t[s]?t[s]:t["*"]},e.label=function(t,n,r,s){if(t.label)return t.label;if(!r.errors.label)return"";let o=n.path;"key"===r.errors.label&&n.path.length>1&&(o=n.path.slice(-1));const i=e.path(o);return i||(e.template(null,r.messages,"root",n,r)||s&&e.template(null,s,"root",n,r)||"value")},e.process=function(t,n,r){if(!t)return null;const{override:s,message:o,details:i}=e.details(t);if(s)return s;if(r.errors.stack)return new e.ValidationError(o,i,n);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const c=new e.ValidationError(o,i,n);return Error.stackTraceLimit=a,c},e.details=function(e,t={}){let n=[];const r=[];for(const s of e){if(s instanceof Error){if(!1!==t.override)return{override:s};const e=s.toString();n.push(e),r.push({message:e,type:"override",context:{error:s}});continue}const e=s.toString();n.push(e),r.push({message:e,path:s.path.filter(e=>"object"!=typeof e),type:s.code,context:s.local})}return n.length>1&&(n=[...new Set(n)]),{message:n.join(". "),details:r}},e.ValidationError=class extends Error{constructor(e,t,n){super(e),this._original=n,this.details=t}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=t.error}(yK)),yK}var RK,vK,NK,CK,OK,IK={};function PK(){return RK||(RK=1,function(e){const t=JB(),n=iK(),r=zB(),s=MK();let o;const i={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(e,n={}){t("string"==typeof e,"Invalid reference key:",e),s.assertOptions(n,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!n.prefix||"object"==typeof n.prefix,"options.prefix must be of type object");const r=Object.assign({},i.defaults,n);delete r.prefix;const o=r.separator,a=i.context(e,o,n.prefix);if(r.type=a.type,e=a.key,"value"===r.type)if(a.root&&(t(!o||e[0]!==o,"Cannot specify relative path with root prefix"),r.ancestor="root",e||(e=null)),o&&o===e)e=null,r.ancestor=0;else if(void 0!==r.ancestor)t(!o||!e||e[0]!==o,"Cannot combine prefix with ancestor option");else{const[t,n]=i.ancestor(e,o);n&&""===(e=e.slice(n))&&(e=null),r.ancestor=t}return r.path=o?null===e?[]:e.split(o):[e],new i.Ref(r)},e.in=function(t,n={}){return e.create(t,{...n,in:!0})},e.isRef=function(e){return!!e&&!!e[s.symbols.ref]},i.Ref=class{constructor(e){t("object"==typeof e,"Invalid reference construction"),s.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),t(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),t(!e.map||Array.isArray(e.map),"options.map must be an array"),t(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,i.defaults,e),t("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,n,r,s,o={}){return t(!this.in||o.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(r.context,n,o):"local"===this.type?this._resolve(s,n,o):this.ancestor?"root"===this.ancestor?this._resolve(n.ancestors[n.ancestors.length-1],n,o):(t(this.ancestor<=n.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(n.ancestors[this.ancestor-1],n,o)):this._resolve(e,n,o)}_resolve(e,t,n){let s;if("value"===this.type&&t.mainstay.shadow&&!1!==n.shadow&&(s=t.mainstay.shadow.get(this.absolute(t))),void 0===s&&(s=r(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(s=this.adjust(s)),this.map){const e=this.map.get(s);void 0!==e&&(s=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,s),s}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new i.Ref(this)}describe(){const e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){const e=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display=`ref:${this.type}:${e}`);if(!this.separator)return void(this.display=`ref:${e}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${e}`);if("root"===this.ancestor)return void(this.display=`ref:root:${e}`);if(1===this.ancestor)return void(this.display=`ref:${e||".."}`);const t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}},i.Ref.prototype[s.symbols.ref]=!0,e.build=function(e){return"value"===(e=Object.assign({},i.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new i.Ref(e)},i.context=function(e,t,n={}){if(e=e.trim(),n){const r=void 0===n.global?"$":n.global;if(r!==t&&e.startsWith(r))return{key:e.slice(r.length),type:"global"};const s=void 0===n.local?"#":n.local;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"local"};const o=void 0===n.root?"/":n.root;if(o!==t&&e.startsWith(o))return{key:e.slice(o.length),type:"value",root:!0}}return{key:e,type:"value"}},i.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let n=2;for(;e[n]===t;)++n;return[n-1,n]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,n){if(t)if(n=void 0===n?e.toParent:n,Array.isArray(t))for(const e of t)this.register(e,n);else if(s.isSchema(t))for(const e of t._refs.refs)e.ancestor-n>=0&&this.refs.push({ancestor:e.ancestor-n,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-n>=0&&this.refs.push({ancestor:t.ancestor-n,root:t.root}),o=o||LK(),o.isTemplate(t)&&this.register(t.refs(),n)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=n(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}}(IK)),IK}function LK(){return vK||(vK=1,function(e){const t=JB(),n=iK(),r=_K,s=gK,o=MK(),i=AK(),a=PK(),c={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=c.Template=class{constructor(e,r){t("string"==typeof e,"Template source must be a string"),t(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,this._settings=n(r),this._parse()}_parse(){if(!this.source.includes("{"))return;const e=c.encode(this.source),t=c.split(e);let n=!1;const r=[],s=t.shift();s&&r.push(s);for(const e of t){const t="{"!==e[0],s=t?"}":"}}",o=e.indexOf(s);if(-1===o||"{"===e[1]){r.push(`{${c.decode(e)}`);continue}let i=e.slice(t?0:1,o);const a=":"===i[0];a&&(i=i.slice(1));const u=this._ref(c.decode(i),{raw:t,wrapped:a});r.push(u),"string"!=typeof u&&(n=!0);const l=e.slice(o+s.length);l&&r.push(c.decode(l))}n?this._template=r:this.rendered=r.join("")}static date(e,t){return c.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;const t={template:this.source};return this._settings&&(t.options=this._settings),t}static build(e){return new c.Template(e.template,e.options)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[o.symbols.template]}refs(){if(!this._template)return;const e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}resolve(e,t,n,r){return this._template&&1===this._template.length?this._part(this._template[0],e,t,n,r,{}):this.render(e,t,n,r)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,n,s,o={}){if(!this.isDynamic())return this.rendered;const i=[];for(const a of this._template)if("string"==typeof a)i.push(a);else{const u=this._part(a,e,t,n,s,o),l=c.stringify(u,e,t,n,s,o);if(void 0!==l){const e=a.raw||!1===(o.errors&&o.errors.escapeHtml)?l:r(l);i.push(c.wrap(e,a.wrapped&&n.errors.wrap.label))}}return i.join("")}_ref(e,{raw:t,wrapped:n}){const r=[],o=e=>{const t=a.create(e,this._settings);return r.push(t),e=>t.resolve(...e)};try{var i=new s.Parser(e,{reference:o,functions:c.functions,constants:c.constants})}catch(t){throw t.message=`Invalid template variable "${e}" fails due to: ${t.message}`,t}if(i.single){if("reference"===i.single.type){const e=r[0];return{ref:e,raw:t,refs:r,wrapped:n||"local"===e.type&&"label"===e.key}}return c.stringify(i.single.value)}return{formula:i,raw:t,refs:r}}toString(){return this.source}},c.Template.prototype[o.symbols.template]=!0,c.Template.prototype.isImmutable=!0,c.encode=function(e){return e.replace(/\\(\{+)/g,(e,t)=>c.opens.slice(0,t.length)).replace(/\\(\}+)/g,(e,t)=>c.closes.slice(0,t.length))},c.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},c.split=function(e){const t=[];let n="";for(let r=0;r<e.length;++r){const s=e[r];if("{"===s){let s="";for(;r+1<e.length&&"{"===e[r+1];)s+="{",++r;t.push(n),n=s}else n+=s}return t.push(n),t},c.wrap=function(e,t){return t?1===t.length?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e},c.stringify=function(e,t,n,r,s,o={}){const i=typeof e,u=r&&r.errors&&r.errors.wrap||{};let l=!1;if(a.isRef(e)&&e.render&&(l=e.in,e=e.resolve(t,n,r,s,{in:e.in,...o})),null===e)return"null";if("string"===i)return c.wrap(e,o.arrayItems&&u.string);if("number"===i||"function"===i||"symbol"===i)return e.toString();if("object"!==i)return JSON.stringify(e);if(e instanceof Date)return c.Template.date(e,r);if(e instanceof Map){const t=[];for(const[n,r]of e.entries())t.push(`${n.toString()} -> ${r.toString()}`);e=t}if(!Array.isArray(e))return e.toString();const p=[];for(const i of e)p.push(c.stringify(i,t,n,r,s,{arrayItems:!0,...o}));return c.wrap(p.join(", "),!l&&u.array)},c.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},c.functions={if:(e,t,n)=>e?t:n,length:e=>"string"==typeof e?e.length:e&&"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:null,msg(e){const[t,n,r,s,o]=this,a=o.messages;if(!a)return"";const c=i.template(t,a[0],e,n,r)||i.template(t,a[1],e,n,r);return c?c.render(t,n,r,s,o):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}}(mK)),mK.exports}function wK(){return NK||(NK=1,function(e){const t=JB(),n=iK(),r=LK();e.compile=function(e,s){if("string"==typeof e)return t(!s,"Cannot set single message string"),new r(e);if(r.isTemplate(e))return t(!s,"Cannot set single message template"),e;t("object"==typeof e&&!Array.isArray(e),"Invalid message options"),s=s?n(s):{};for(let n in e){const o=e[n];if("root"===n||r.isTemplate(o)){s[n]=o;continue}if("string"==typeof o){s[n]=new r(o);continue}t("object"==typeof o&&!Array.isArray(o),"Invalid message for",n);const i=n;for(n in s[i]=s[i]||{},o){const e=o[n];"root"===n||r.isTemplate(e)?s[i][n]=e:(t("string"==typeof e,"Invalid message for",n,"in",i),s[i][n]=new r(e))}}return s},e.decompile=function(e){const t={};for(let n in e){const s=e[n];if("root"===n){t.root=s;continue}if(r.isTemplate(s)){t[n]=s.describe({compact:!0});continue}const o=n;for(n in t[o]={},s){const e=s[n];"root"!==n?t[o][n]=e.describe({compact:!0}):t[o].root=e}}return t},e.merge=function(s,o){if(!s)return e.compile(o);if(!o)return s;if("string"==typeof o)return new r(o);if(r.isTemplate(o))return o;const i=n(s);for(let e in o){const n=o[e];if("root"===e||r.isTemplate(n)){i[e]=n;continue}if("string"==typeof n){i[e]=new r(n);continue}t("object"==typeof n&&!Array.isArray(n),"Invalid message for",e);const s=e;for(e in i[s]=i[s]||{},n){const o=n[e];"root"===e||r.isTemplate(o)?i[s][e]=o:(t("string"==typeof o,"Invalid message for",e,"in",s),i[s][e]=new r(o))}}return i}}(hK)),hK}function MK(){return CK||(CK=1,function(e){const t=JB(),n=KB(),r=lK;let s,o;const i={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=r.version,e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},e.assertOptions=function(e,n,r="Options"){t(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");const s=Object.keys(e).filter(e=>!n.includes(e));t(0===s.length,`${r} contain unknown keys: ${s}`)},e.checkPreferences=function(e){o=o||dK();const t=o.preferences.validate(e);if(t.error)throw new n([t.error.details[0].message])},e.compare=function(e,t,n){switch(n){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}},e.default=function(e,t){return void 0===e?t:e},e.isIsoDate=function(e){return i.isoDate.test(e)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(n,r={}){const s=n&&n[e.symbols.any];return!!s&&(t(r.legacy||s.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(e){return Number.isSafeInteger(e)&&e>=0},e.preferences=function(t,n){s=s||wK(),t=t||{},n=n||{};const r=Object.assign({},t,n);return n.errors&&t.errors&&(r.errors=Object.assign({},t.errors,n.errors),r.errors.wrap=Object.assign({},t.errors.wrap,n.errors.wrap)),n.messages&&(r.messages=s.compile(n.messages,t.messages)),delete r[e.symbols.prefs],r},e.tryWithPath=function(e,t,n={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,n.append&&(e.message=`${e.message} (${e.path})`),e}},e.validateArg=function(t,n,{assert:r,message:s}){if(e.isSchema(r)){const e=r.validate(t);if(!e.error)return;return e.error.message}if(!r(t))return n?`${n} ${s}`:s},e.verifyFlat=function(e,n){for(const r of e)t(!Array.isArray(r),"Method no longer accepts array arguments:",n)}}(uK)),uK}function xK(){if(OK)return cK;OK=1;const e=JB(),t=iK(),n=MK(),r={max:1e3,supported:new Set(["undefined","boolean","number","string"])};return cK.provider={provision:e=>new r.Cache(e)},r.Cache=class{constructor(t={}){n.assertOptions(t,["max"]),e(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||r.max,this._map=new Map,this._list=new r.List}get length(){return this._map.size}set(e,t){if(null!==e&&!r.supported.has(typeof e))return;let n=this._map.get(e);if(n)return n.value=t,void this._list.first(n);n=this._list.unshift({key:e,value:t}),this._map.set(e,n),this._compact()}get(e){const n=this._map.get(e);if(n)return this._list.first(n),t(n.value)}_compact(){if(this._map.size>this._max){const e=this._list.pop();this._map.delete(e.key)}}},r.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){const{next:t,prev:n}=e;return t.prev=n,n&&(n.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}},cK}var kK,GK={};function DK(){return kK||(kK=1,function(e){const t=JB(),n=MK(),r=PK(),s={};e.schema=function(e,t,r={}){n.assertOptions(r,["appendPath","override"]);try{return s.schema(e,t,r)}catch(e){throw r.appendPath&&void 0!==e.path&&(e.message=`${e.message} (${e.path})`),e}},s.schema=function(e,r,o){t(void 0!==r,"Invalid undefined schema"),Array.isArray(r)&&(t(r.length,"Invalid empty array schema"),1===r.length&&(r=r[0]));const i=(t,...n)=>!1!==o.override?t.valid(e.override,...n):t.valid(...n);if(s.simple(r))return i(e,r);if("function"==typeof r)return e.custom(r);if(t("object"==typeof r,"Invalid schema content:",typeof r),n.isResolvable(r))return i(e,r);if(n.isSchema(r))return r;if(Array.isArray(r)){for(const t of r)if(!s.simple(t))return e.alternatives().try(...r);return i(e,...r)}return r instanceof RegExp?e.string().regex(r):r instanceof Date?i(e.date(),r):(t(Object.getPrototypeOf(r)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(r))},e.ref=function(e,t){return r.isRef(e)?e:r.create(e,t)},e.compile=function(r,o,i={}){n.assertOptions(i,["legacy"]);const a=o&&o[n.symbols.any];if(a)return t(i.legacy||a.version===n.version,"Cannot mix different versions of joi schemas:",a.version,n.version),o;if("object"!=typeof o||!i.legacy)return e.schema(r,o,{appendPath:!0});const c=s.walk(o);return c?c.compile(c.root,o):e.schema(r,o,{appendPath:!0})},s.walk=function(e){if("object"!=typeof e)return null;if(Array.isArray(e)){for(const t of e){const e=s.walk(t);if(e)return e}return null}const r=e[n.symbols.any];if(r)return{root:e[r.root],compile:r.compile};t(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const t in e){const n=s.walk(e[t]);if(n)return n}return null},s.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},e.when=function(o,i,a){if(void 0===a&&(t(i&&"object"==typeof i,"Missing options"),a=i,i=r.create(".")),Array.isArray(a)&&(a={switch:a}),n.assertOptions(a,["is","not","then","otherwise","switch","break"]),n.isSchema(i))return t(void 0===a.is,'"is" can not be used with a schema condition'),t(void 0===a.not,'"not" can not be used with a schema condition'),t(void 0===a.switch,'"switch" can not be used with a schema condition'),s.condition(o,{is:i,then:a.then,otherwise:a.otherwise,break:a.break});if(t(r.isRef(i)||"string"==typeof i,"Invalid condition:",i),t(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let c=a;void 0!==a.not&&(c={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let u=void 0!==c.is?o.$_compile(c.is):o.$_root.invalid(null,!1,0,"").required();return t(void 0!==c.then||void 0!==c.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),t(void 0===c.break||void 0===c.then||void 0===c.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||r.isRef(a.is)||n.isSchema(a.is)||(u=u.required()),s.condition(o,{ref:e.ref(i),is:u,then:c.then,otherwise:c.otherwise,break:c.break})}t(Array.isArray(a.switch),'"switch" must be an array'),t(void 0===a.is,'Cannot combine "switch" with "is"'),t(void 0===a.not,'Cannot combine "switch" with "not"'),t(void 0===a.then,'Cannot combine "switch" with "then"');const c={ref:e.ref(i),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const s=a.switch[e],i=e===a.switch.length-1;n.assertOptions(s,i?["is","then","otherwise"]:["is","then"]),t(void 0!==s.is,'Switch statement missing "is"'),t(void 0!==s.then,'Switch statement missing "then"');const u={is:o.$_compile(s.is),then:o.$_compile(s.then)};if(r.isRef(s.is)||n.isSchema(s.is)||(u.is=u.is.required()),i){t(void 0===a.otherwise||void 0===s.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:s.otherwise;void 0!==e&&(t(void 0===c.break,"Cannot specify both otherwise and break"),u.otherwise=o.$_compile(e))}c.switch.push(u)}return c},s.condition=function(e,t){for(const n of["then","otherwise"])void 0===t[n]?delete t[n]:t[n]=e.$_compile(t[n]);return t}}(GK)),GK}var VK,UK={};function HK(){if(VK)return UK;VK=1;const e=JB(),t=iK(),n=MK(),r=wK(),s={};return UK.type=function(o,i){const a=Object.getPrototypeOf(o),c=t(a),u=o._assign(Object.create(c)),l=Object.assign({},i);delete l.base,c._definition=l;const p=a._definition||{};l.messages=r.merge(p.messages,l.messages),l.properties=Object.assign({},p.properties,l.properties),u.type=l.type,l.flags=Object.assign({},p.flags,l.flags);const d=Object.assign({},p.terms);if(l.terms)for(const t in l.terms){const n=l.terms[t];e(void 0===u.$_terms[t],"Invalid term override for",l.type,t),u.$_terms[t]=n.init,d[t]=n}l.terms=d,l.args||(l.args=p.args),l.prepare=s.prepare(l.prepare,p.prepare),l.coerce&&("function"==typeof l.coerce&&(l.coerce={method:l.coerce}),l.coerce.from&&!Array.isArray(l.coerce.from)&&(l.coerce={method:l.coerce.method,from:[].concat(l.coerce.from)})),l.coerce=s.coerce(l.coerce,p.coerce),l.validate=s.validate(l.validate,p.validate);const h=Object.assign({},p.rules);if(l.rules)for(const t in l.rules){const r=l.rules[t];e("object"==typeof r,"Invalid rule definition for",l.type,t);let s=r.method;if(void 0===s&&(s=function(){return this.$_addRule(t)}),s&&(e(!c[t],"Rule conflict in",l.type,t),c[t]=s),e(!h[t],"Rule conflict in",l.type,t),h[t]=r,r.alias){const e=[].concat(r.alias);for(const t of e)c[t]=r.method}r.args&&(r.argsByName=new Map,r.args=r.args.map(t=>("string"==typeof t&&(t={name:t}),e(!r.argsByName.has(t.name),"Duplicated argument name",t.name),n.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),r.argsByName.set(t.name,t),t)))}l.rules=h;const m=Object.assign({},p.modifiers);if(l.modifiers)for(const t in l.modifiers){e(!c[t],"Rule conflict in",l.type,t);const n=l.modifiers[t];e("function"==typeof n,"Invalid modifier definition for",l.type,t);const r=function(e){return this.rule({[t]:e})};c[t]=r,m[t]=n}if(l.modifiers=m,l.overrides){c._super=a,u.$_super={};for(const t in l.overrides)e(a[t],"Cannot override missing",t),l.overrides[t][n.symbols.parent]=a[t],u.$_super[t]=a[t].bind(u);Object.assign(c,l.overrides)}l.cast=Object.assign({},p.cast,l.cast);const f=Object.assign({},p.manifest,l.manifest);return f.build=s.build(l.manifest&&l.manifest.build,p.manifest&&p.manifest.build),l.manifest=f,l.rebuild=s.rebuild(l.rebuild,p.rebuild),u},s.build=function(e,t){return e&&t?function(n,r){return t(e(n,r),r)}:e||t},s.coerce=function(e,t){return e&&t?{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(n,r){let s;if((!t.from||t.from.includes(typeof n))&&(s=t.method(n,r),s)){if(s.errors||void 0===s.value)return s;n=s.value}if(!e.from||e.from.includes(typeof n)){const t=e.method(n,r);if(t)return t}return s}}:e||t},s.prepare=function(e,t){return e&&t?function(n,r){const s=e(n,r);if(s){if(s.errors||void 0===s.value)return s;n=s.value}return t(n,r)||s}:e||t},s.rebuild=function(e,t){return e&&t?function(n){t(n),e(n)}:e||t},s.validate=function(e,t){return e&&t?function(n,r){const s=t(n,r);if(s){if(s.errors&&(!Array.isArray(s.errors)||s.errors.length))return s;n=s.value}return e(n,r)||s}:e||t},UK}var jK,ZK={};function WK(){if(jK)return ZK;jK=1;const e=JB(),t=iK(),n=MK(),r=wK(),s=PK(),o=LK();let i;const a={};return ZK.describe=function(s){const o=s._definition,i={type:s.type,flags:{},rules:[]};for(const e in s._flags)"_"!==e[0]&&(i.flags[e]=a.describe(s._flags[e]));Object.keys(i.flags).length||delete i.flags,s._preferences&&(i.preferences=t(s._preferences,{shallow:["messages"]}),delete i.preferences[n.symbols.prefs],i.preferences.messages&&(i.preferences.messages=r.decompile(i.preferences.messages))),s._valids&&(i.allow=s._valids.describe()),s._invalids&&(i.invalid=s._invalids.describe());for(const e of s._rules){if(!1===o.rules[e.name].manifest)continue;const t={name:e.name};for(const n in o.modifiers)void 0!==e[n]&&(t[n]=a.describe(e[n]));if(e.args){t.args={};for(const n in e.args){const r=e.args[n];("options"!==n||Object.keys(r).length)&&(t.args[n]=a.describe(r,{assign:n}))}Object.keys(t.args).length||delete t.args}i.rules.push(t)}i.rules.length||delete i.rules;for(const t in s.$_terms){if("_"===t[0])continue;e(!i[t],"Cannot describe schema due to internal name conflict with",t);const r=s.$_terms[t];if(!r)continue;if(r instanceof Map){r.size&&(i[t]=[...r.entries()]);continue}if(n.isValues(r)){i[t]=r.describe();continue}e(o.terms[t],"Term",t,"missing configuration");const c=o.terms[t].manifest,u="object"==typeof c;if(!r.length&&!u)continue;const l=[];for(const e of r)l.push(a.describe(e));if(u){const{from:e,to:n}=c.mapped;i[t]={};for(const r of l)i[t][r[n]]=r[e];continue}"single"!==c?i[t]=l:(e(1===l.length,"Term",t,"contains more than one item"),i[t]=l[0])}return a.validate(s.$_root,i),i},a.describe=function(e,r={}){if(Array.isArray(e))return e.map(a.describe);if(e===n.symbols.deepDefault)return{special:"deep"};if("object"!=typeof e||null===e)return e;if("options"===r.assign)return t(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return"regex"===r.assign?e.toString():{regex:e.toString()};if(e[n.symbols.literal])return{function:e.literal};if("function"==typeof e.describe)return"ref"===r.assign?e.describe().ref:e.describe();const s={};for(const t in e){const n=e[t];void 0!==n&&(s[t]=a.describe(n,{assign:t}))}return s},ZK.build=function(e,t){return new a.Builder(e).parse(t)},a.Builder=class{constructor(e){this.joi=e}parse(t){a.validate(this.joi,t);let n=this.joi[t.type]()._bare();const r=n._definition;if(t.flags)for(const s in t.flags){const o=r.flags[s]&&r.flags[s].setter||s;e("function"==typeof n[o],"Invalid flag",s,"for type",t.type),n=n[o](this.build(t.flags[s]))}if(t.preferences&&(n=n.preferences(this.build(t.preferences))),t.allow&&(n=n.allow(...this.build(t.allow))),t.invalid&&(n=n.invalid(...this.build(t.invalid))),t.rules)for(const s of t.rules){e("function"==typeof n[s.name],"Invalid rule",s.name,"for type",t.type);const o=[];if(s.args){const n={};for(const e in s.args)n[e]=this.build(s.args[e],{assign:e});const i=Object.keys(n),a=r.rules[s.name].args;if(a){e(i.length<=a.length,"Invalid number of arguments for",t.type,s.name,"(expected up to",a.length,", found",i.length,")");for(const{name:e}of a)o.push(n[e])}else e(1===i.length,"Invalid number of arguments for",t.type,s.name,"(expected up to 1, found",i.length,")"),o.push(n[i[0]])}n=n[s.name](...o);const i={};for(const e in r.modifiers)void 0!==s[e]&&(i[e]=this.build(s[e]));Object.keys(i).length&&(n=n.rule(i))}const s={};for(const n in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(n))continue;e(r.terms[n],"Term",n,"missing configuration");const o=r.terms[n].manifest;if("schema"!==o)if("values"!==o)if("single"!==o)if("object"!=typeof o)s[n]=this.build(t[n]);else{s[n]={};for(const e in t[n]){const r=t[n][e];s[n][e]=this.parse(r)}}else s[n]=this.build(t[n]);else s[n]=t[n].map(e=>this.build(e));else s[n]=t[n].map(e=>this.parse(e))}return t.whens&&(s.whens=t.whens.map(e=>this.build(e))),n=r.manifest.build(n,s),n.$_temp.ruleset=!1,n}build(r,i={}){if(null===r)return null;if(Array.isArray(r))return r.map(e=>this.build(e));if(r instanceof Error)return r;if("options"===i.assign)return t(r);if("regex"===i.assign)return a.regex(r);if("ref"===i.assign)return s.build(r);if("object"!=typeof r)return r;if(1===Object.keys(r).length){if(r.buffer)return e(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(r.buffer,"binary");if(r.function)return{[n.symbols.literal]:!0,literal:r.function};if(r.override)return n.symbols.override;if(r.ref)return s.build(r.ref);if(r.regex)return a.regex(r.regex);if(r.special)return e(["deep"].includes(r.special),"Unknown special value",r.special),n.symbols.deepDefault;if(r.value)return t(r.value)}if(r.type)return this.parse(r);if(r.template)return o.build(r);const c={};for(const e in r)c[e]=this.build(r[e],{assign:e});return c}},a.regex=function(e){const t=e.lastIndexOf("/"),n=e.slice(1,t),r=e.slice(t+1);return new RegExp(n,r)},a.validate=function(e,t){i=i||dK(),e.assert(t,i.description)},ZK}var XK={};const $K=eK(),FK={mismatched:null};var YK=function(e,t,n){return n=Object.assign({prototype:!0},n),!!FK.isDeepEqual(e,t,n,[])};FK.isDeepEqual=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;const s=typeof e;if(s!==typeof t)return!1;if(null===e||null===t)return!1;if("function"===s){if(!n.deepFunction||e.toString()!==t.toString())return!1}else if("object"!==s)return e!=e&&t!=t;const o=FK.getSharedType(e,t,!!n.prototype);switch(o){case $K.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case $K.promise:return e===t;case $K.regex:return e.toString()===t.toString();case FK.mismatched:return!1}for(let n=r.length-1;n>=0;--n)if(r[n].isSame(e,t))return!0;r.push(new FK.SeenEntry(e,t));try{return!!FK.isDeepEqualObj(o,e,t,n,r)}finally{r.pop()}},FK.getSharedType=function(e,t,n){if(n)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?FK.mismatched:$K.getInternalProto(e);const r=$K.getInternalProto(e);return r!==$K.getInternalProto(t)?FK.mismatched:r},FK.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},FK.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},FK.isSetSimpleEqual=function(e,t){for(const n of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,n))return!1;return!0},FK.isDeepEqualObj=function(e,t,n,r,s){const{isDeepEqual:o,valueOf:i,hasOwnEnumerableProperty:a}=FK,{keys:c,getOwnPropertySymbols:u}=Object;if(e===$K.array){if(!r.part){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!o(t[e],n[e],r,s))return!1;return!0}for(const e of t)for(const t of n)if(o(e,t,r,s))return!0}else if(e===$K.set){if(t.size!==n.size)return!1;if(!FK.isSetSimpleEqual(t,n)){const e=new Set(Set.prototype.values.call(n));for(const n of Set.prototype.values.call(t)){if(e.delete(n))continue;let t=!1;for(const i of e)if(o(n,i,r,s)){e.delete(i),t=!0;break}if(!t)return!1}}}else if(e===$K.map){if(t.size!==n.size)return!1;for(const[e,i]of Map.prototype.entries.call(t)){if(void 0===i&&!Map.prototype.has.call(n,e))return!1;if(!o(i,Map.prototype.get.call(n,e),r,s))return!1}}else if(e===$K.error&&(t.name!==n.name||t.message!==n.message))return!1;const l=i(t),p=i(n);if((t!==l||n!==p)&&!o(l,p,r,s))return!1;const d=c(t);if(!r.part&&d.length!==c(n).length&&!r.skip)return!1;let h=0;for(const e of d)if(r.skip&&r.skip.includes(e))void 0===n[e]&&++h;else{if(!a(n,e))return!1;if(!o(t[e],n[e],r,s))return!1}if(!r.part&&d.length-h!==c(n).length)return!1;if(!1!==r.symbols){const e=u(t),i=new Set(u(n));for(const c of e){if(!r.skip||!r.skip.includes(c))if(a(t,c)){if(!a(n,c))return!1;if(!o(t[c],n[c],r,s))return!1}else if(a(n,c))return!1;i.delete(c)}for(const e of i)if(a(n,e))return!1}return!0},FK.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}};var BK,KK={};function JK(){if(BK)return XK;BK=1;const e=YK,t=KK,n=AK(),r={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};return XK.setup=function(e){const t=function(){return e._tracer=e._tracer||new r.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}},XK.location=function(e){return e.$_setFlag("_tracerLocation",t.location(2))},r.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){const n=this._schemas.get(e);if(n)return n.store;const s=new r.Store(e),{filename:o,line:i}=e._flags._tracerLocation||t.location(5);return this._schemas.set(e,{filename:o,line:i,store:s}),s}_combine(e,t){for(const{store:n}of this._schemas.values())n._combine(e,t)}report(e){const t=[];for(const{filename:n,line:s,store:o}of this._schemas.values()){if(e&&e!==n)continue;const i=[],a=[];for(const[e,t]of o._sources.entries()){if(r.sub(t.paths,a))continue;if(!t.entry){i.push({status:"never reached",paths:[...t.paths]}),a.push(...t.paths);continue}for(const n of["valid","invalid"]){const r=e[`_${n}s`];if(!r)continue;const s=new Set(r._values),o=new Set(r._refs);for(const{value:e,ref:r}of t[n])s.delete(e),o.delete(r);(s.size||o.size)&&i.push({status:[...s,...[...o].map(e=>e.display)],rule:`${n}s`})}const n=e._rules.map(e=>e.name);for(const t of["default","failover"])void 0!==e._flags[t]&&n.push(t);for(const e of n){const n=r.labels[t.rule[e]||0];if(n){const r={rule:e,status:n};t.paths.size&&(r.paths=[...t.paths]),i.push(r)}}}i.length&&t.push({filename:n,line:s,missing:i,severity:"error",message:`Schema missing tests for ${i.map(r.message).join(", ")}`})}return t.length?t:null}},r.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,n,r){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:n,result:r,path:e.path})}entry(e,t){r.debug(t,{type:"entry"}),this._record(e,e=>{e.entry=!0})}filter(e,t,n,s){r.debug(t,{type:n,...s}),this._record(e,e=>{e[n].add(s)})}log(e,t,n,s,o){r.debug(t,{type:n,name:s,result:"full"===o?"pass":o}),this._record(e,e=>{e[n][s]=e[n][s]||0,e[n][s]|=r.codes[o]})}resolve(e,t,n){if(!e.mainstay.debug)return;const r={type:"resolve",ref:t.display,to:n,path:e.path};e.mainstay.debug.push(r)}value(t,n,r,s,o){if(!t.mainstay.debug||e(r,s))return;const i={type:"value",by:n,from:r,to:s,path:t.path};o&&(i.name=o),t.mainstay.debug.push(i)}_record(e,t){const n=this._sources.get(e);if(n)return void t(n);const r=this._combos.get(e);for(const e of r)this._record(e,t)}_scan(e,t){const n=t||[];let s=this._sources.get(e);s||(s={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,s)),n.length&&s.paths.add(n);e.$_modify({each:(e,t)=>{const s=r.id(e,t);this._scan(e,n.concat(s))},ref:!1})}_combine(e,t){this._combos.set(e,t)}},r.message=function(e){return`${e.paths?n.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`},r.id=function(e,{source:t,name:n,path:r,key:s}){return e._flags.id?e._flags.id:s||(n=`@${n}`,"terms"===t?[n,r[Math.min(r.length-1,1)]]:n)},r.sub=function(t,n){for(const r of t)for(const t of n)if(e(r.slice(0,t.length),t))return!0;return!1},r.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))},XK}KK.location=function(e=0){const t=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const n={};Error.captureStackTrace(n,this);const r=n.stack[e+1];return Error.prepareStackTrace=t,{filename:r.getFileName(),line:r.getLineNumber()}};const zK=JB(),QK=iK(),qK=oK(),eJ={};var tJ,nJ=eJ.merge=function(e,t,n){if(zK(e&&"object"==typeof e,"Invalid target value: must be an object"),zK(null==t||"object"==typeof t,"Invalid source value: must be null, undefined, or an object"),!t)return e;if(n=Object.assign({nullOverride:!0,mergeArrays:!0},n),Array.isArray(t)){zK(Array.isArray(e),"Cannot merge array onto an object"),n.mergeArrays||(e.length=0);for(let r=0;r<t.length;++r)e.push(QK(t[r],{symbols:n.symbols}));return e}const r=qK.keys(t,n);for(let s=0;s<r.length;++s){const o=r[s];if("__proto__"===o||!Object.prototype.propertyIsEnumerable.call(t,o))continue;const i=t[o];if(i&&"object"==typeof i){if(e[o]===i)continue;!e[o]||"object"!=typeof e[o]||Array.isArray(e[o])!==Array.isArray(i)||i instanceof Date||Buffer&&Buffer.isBuffer(i)||i instanceof RegExp?e[o]=QK(i,{symbols:n.symbols}):eJ.merge(e[o],i,n)}else(null!=i||n.nullOverride)&&(e[o]=i)}return e},rJ={};var sJ,oJ,iJ,aJ,cJ,uJ,lJ,pJ,dJ,hJ,mJ,fJ,_J,gJ,EJ,SJ,yJ,TJ={},bJ=function(){};function AJ(){return iJ||(iJ=1,function(e){const t=JB(),n=iK(),r=bJ,s=zB(),o=MK(),i=AK(),a=function(){if(oJ)return sJ;oJ=1;const e=iK(),t=zB(),n=MK(),r={value:Symbol("value")};return sJ=r.State=class{constructor(e,t,n){this.path=e,this.ancestors=t,this.mainstay=n.mainstay,this.schemas=n.schemas,this.debug=null}localize(e,t=null,n=null){const s=new r.State(e,t,this);return n&&s.schemas&&(s.schemas=[r.schemas(n),...s.schemas]),s}nest(e,t){const n=new r.State(this.path,this.ancestors,this);return n.schemas=n.schemas&&[r.schemas(e),...n.schemas],n.debug=t,n}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new r.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=e(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}},r.schemas=function(e){return n.isSchema(e)?{schema:e}:e},r.Shadow=class{constructor(){this._values=null}set(e,t,n){if(!e.length)return;if("strip"===n&&"number"==typeof e[e.length-1])return;this._values=this._values||new Map;let s=this._values;for(let t=0;t<e.length;++t){const n=e[t];let r=s.get(n);r||(r=new Map,s.set(n,r)),s=r}s[r.value]=t}get(e){const t=this.node(e);if(t)return t[r.value]}node(e){if(this._values)return t(this._values,e,{iterables:!0})}override(e,n){if(!this._values)return;const r=e.slice(0,-1),s=e[e.length-1],o=t(this._values,r,{iterables:!0});n?o.set(s,n):o&&o.delete(s)}},sJ}(),c={result:Symbol("result")};e.entry=function(e,n,r){let s=o.defaults;r&&(t(void 0===r.warnings,"Cannot override warnings preference in synchronous validation"),t(void 0===r.artifacts,"Cannot override artifacts preference in synchronous validation"),s=o.preferences(o.defaults,r));const a=c.entry(e,n,s);t(!a.mainstay.externals.length,"Schema with external rules must use validateAsync()");const u={value:a.value};return a.error&&(u.error=a.error),a.mainstay.warnings.length&&(u.warning=i.details(a.mainstay.warnings)),a.mainstay.debug&&(u.debug=a.mainstay.debug),a.mainstay.artifacts&&(u.artifacts=a.mainstay.artifacts),u},e.entryAsync=async function(e,t,n){let r=o.defaults;n&&(r=o.preferences(o.defaults,n));const a=c.entry(e,t,r),u=a.mainstay;if(a.error)throw u.debug&&(a.error.debug=u.debug),a.error;if(u.externals.length){let t=a.value;const l=[];for(const a of u.externals){const p=a.state.path,d="link"===a.schema.type?u.links.get(a.schema):null;let h,m,f=t;const _=p.length?[t]:[],g=p.length?s(e,p):e;if(p.length){h=p[p.length-1];let e=t;for(const t of p.slice(0,-1))e=e[t],_.unshift(e);m=_[0],f=m[h]}try{const e=(e,t)=>(d||a.schema).$_createError(e,f,t,a.state,r),s=await a.method(f,{schema:a.schema,linked:d,state:a.state,prefs:n,original:g,error:e,errorsArray:c.errorsArray,warn:(e,t)=>u.warnings.push((d||a.schema).$_createError(e,f,t,a.state,r)),message:(e,t)=>(d||a.schema).$_createError("external",f,t,a.state,r,{messages:e})});if(void 0===s||s===f)continue;if(s instanceof i.Report){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(s),r.abortEarly)break;continue}if(Array.isArray(s)&&s[o.symbols.errors]){if(u.tracer.log(a.schema,a.state,"rule","external","error"),l.push(...s),r.abortEarly)break;continue}m?(u.tracer.value(a.state,"rule",f,s,"external"),m[h]=s):(u.tracer.value(a.state,"rule",t,s,"external"),t=s)}catch(e){throw r.errors.label&&(e.message+=` (${a.label})`),e}}if(a.value=t,l.length)throw a.error=i.process(l,e,r),u.debug&&(a.error.debug=u.debug),a.error}if(!r.warnings&&!r.debug&&!r.artifacts)return a.value;const l={value:a.value};return u.warnings.length&&(l.warning=i.details(u.warnings)),u.debug&&(l.debug=u.debug),u.artifacts&&(l.artifacts=u.artifacts),l},c.Mainstay=class{constructor(e,t,n){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=n,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}},c.entry=function(t,n,r){const{tracer:s,cleanup:o}=c.tracer(n,r),u=r.debug?[]:null,l=n._ids._schemaChain?new Map:null,p=new c.Mainstay(s,u,l),d=n._ids._schemaChain?[{schema:n}]:null,h=new a([],[],{mainstay:p,schemas:d}),m=e.validate(t,n,h,r);o&&n.$_root.untrace();const f=i.process(m.errors,t,r);return{value:m.value,error:f,mainstay:p}},c.tracer=function(e,n){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:n.debug?(t(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:c.ignore}},e.validate=function(e,t,n,r,s={}){if(t.$_terms.whens&&(t=t._generate(e,n,r).schema),t._preferences&&(r=c.prefs(t,r)),t._cache&&r.cache){const r=t._cache.get(e);if(n.mainstay.tracer.debug(n,"validate","cached",!!r),r)return r}const i=(s,o,i)=>t.$_createError(s,e,o,i||n,r),a={original:e,prefs:r,schema:t,state:n,error:i,errorsArray:c.errorsArray,warn:(e,t,r)=>n.mainstay.warnings.push(i(e,t,r)),message:(s,o)=>t.$_createError("custom",e,o,n,r,{messages:s})};n.mainstay.tracer.entry(t,n);const u=t._definition;if(u.prepare&&void 0!==e&&r.convert){const t=u.prepare(e,a);if(t){if(n.mainstay.tracer.value(n,"prepare",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}if(u.coerce&&void 0!==e&&r.convert&&(!u.coerce.from||u.coerce.from.includes(typeof e))){const t=u.coerce.method(e,a);if(t){if(n.mainstay.tracer.value(n,"coerced",e,t.value),t.errors)return c.finalize(t.value,[].concat(t.errors),a);e=t.value}}const l=t._flags.empty;l&&l.$_match(c.trim(e,t),n.nest(l),o.defaults)&&(n.mainstay.tracer.value(n,"empty",e,void 0),e=void 0);const p=s.presence||t._flags.presence||(t._flags._endedSwitch?null:r.presence);if(void 0===e){if("forbidden"===p)return c.finalize(e,null,a);if("required"===p)return c.finalize(e,[t.$_createError("any.required",e,null,n,r)],a);if("optional"===p){if(t._flags.default!==o.symbols.deepDefault)return c.finalize(e,null,a);n.mainstay.tracer.value(n,"default",e,{}),e={}}}else if("forbidden"===p)return c.finalize(e,[t.$_createError("any.unknown",e,null,n,r)],a);const d=[];if(t._valids){const s=t._valids.get(e,n,r,t._flags.insensitive);if(s)return r.convert&&(n.mainstay.tracer.value(n,"valids",e,s.value),e=s.value),n.mainstay.tracer.filter(t,n,"valid",s),c.finalize(e,null,a);if(t._flags.only){const s=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},n,r);if(r.abortEarly)return c.finalize(e,[s],a);d.push(s)}}if(t._invalids){const s=t._invalids.get(e,n,r,t._flags.insensitive);if(s){n.mainstay.tracer.filter(t,n,"invalid",s);const o=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},n,r);if(r.abortEarly)return c.finalize(e,[o],a);d.push(o)}}if(u.validate){const t=u.validate(e,a);if(t&&(n.mainstay.tracer.value(n,"base",e,t.value),e=t.value,t.errors)){if(!Array.isArray(t.errors))return d.push(t.errors),c.finalize(e,d,a);if(t.errors.length)return d.push(...t.errors),c.finalize(e,d,a)}}return t._rules.length?c.rules(e,d,a):c.finalize(e,d,a)},c.rules=function(e,t,n){const{schema:r,state:s,prefs:i}=n;for(const a of r._rules){const u=r._definition.rules[a.method];if(u.convert&&i.convert){s.mainstay.tracer.log(r,s,"rule",a.name,"full");continue}let l,p=a.args;if(a._resolve.length){p=Object.assign({},p);for(const t of a._resolve){const n=u.argsByName.get(t),a=p[t].resolve(e,s,i),c=n.normalize?n.normalize(a):a,d=o.validateArg(c,null,n);if(d){l=r.$_createError("any.ref",a,{arg:t,ref:p[t],reason:d},s,i);break}p[t]=c}}l=l||u.validate(e,n,p,a);const d=c.rule(l,a);if(d.errors){if(s.mainstay.tracer.log(r,s,"rule",a.name,"error"),a.warn){s.mainstay.warnings.push(...d.errors);continue}if(i.abortEarly)return c.finalize(e,d.errors,n);t.push(...d.errors)}else s.mainstay.tracer.log(r,s,"rule",a.name,"pass"),s.mainstay.tracer.value(s,"rule",e,d.value,a.name),e=d.value}return c.finalize(e,t,n)},c.rule=function(e,t){return e instanceof i.Report?(c.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[o.symbols.errors]?(e.forEach(e=>c.error(e,t)),{errors:e,value:null}):{errors:null,value:e}},c.error=function(e,t){return t.message&&e._setTemplate(t.message),e},c.finalize=function(e,n,r){n=n||[];const{schema:s,state:o,prefs:a}=r;if(n.length){const t=c.default("failover",void 0,n,r);void 0!==t&&(o.mainstay.tracer.value(o,"failover",e,t),e=t,n=[])}if(n.length&&s._flags.error)if("function"==typeof s._flags.error){n=s._flags.error(n),Array.isArray(n)||(n=[n]);for(const e of n)t(e instanceof Error||e instanceof i.Report,"error() must return an Error object")}else n=[s._flags.error];if(void 0===e){const t=c.default("default",e,n,r);o.mainstay.tracer.value(o,"default",e,t),e=t}if(s._flags.cast&&void 0!==e){const t=s._definition.cast[s._flags.cast];if(t.from(e)){const n=t.to(e,r);o.mainstay.tracer.value(o,"cast",e,n,s._flags.cast),e=n}}if(s.$_terms.externals&&a.externals&&!1!==a._externals)for(const{method:e}of s.$_terms.externals)o.mainstay.externals.push({method:e,schema:s,state:o,label:i.label(s._flags,o,a)});const u={value:e,errors:n.length?n:null};return s._flags.result&&(u.value="strip"===s._flags.result?void 0:r.original,o.mainstay.tracer.value(o,s._flags.result,e,u.value),o.shadow(e,s._flags.result)),s._cache&&!1!==a.cache&&!s._refs.length&&s._cache.set(r.original,u),void 0===e||u.errors||void 0===s._flags.artifact||(o.mainstay.artifacts=o.mainstay.artifacts||new Map,o.mainstay.artifacts.has(s._flags.artifact)||o.mainstay.artifacts.set(s._flags.artifact,[]),o.mainstay.artifacts.get(s._flags.artifact).push(o.path)),u},c.prefs=function(e,t){const n=t===o.defaults;return n&&e._preferences[o.symbols.prefs]?e._preferences[o.symbols.prefs]:(t=o.preferences(t,e._preferences),n&&(e._preferences[o.symbols.prefs]=t),t)},c.default=function(e,t,r,s){const{schema:i,state:a,prefs:c}=s,u=i._flags[e];if(c.noDefaults||void 0===u)return t;if(a.mainstay.tracer.log(i,a,"rule",e,"full"),!u)return u;if("function"==typeof u){const t=u.length?[n(a.ancestors[0]),s]:[];try{return u(...t)}catch(t){return void r.push(i.$_createError(`any.${e}`,null,{error:t},a,c))}}return"object"!=typeof u?u:u[o.symbols.literal]?u.literal:o.isResolvable(u)?u.resolve(t,a,c):n(u)},c.trim=function(e,t){if("string"!=typeof e)return e;const n=t.$_getRule("trim");return n&&n.args.enabled?e.trim():e},c.ignore={active:!1,debug:r,entry:r,filter:r,log:r,resolve:r,value:r},c.errorsArray=function(){const e=[];return e[o.symbols.errors]=!0,e}}(TJ)),TJ}function RJ(){if(cJ)return aJ;cJ=1;const e=JB(),t=YK,n=MK(),r={};return aJ=r.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=r.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){n.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,n){if(e=e||new r.Values,t){if(t._override)return t.clone();for(const n of[...t._values,...t._refs])e.add(n)}if(n)for(const t of[...n._values,...n._refs])e.remove(t);return e.length?e:null}remove(e){n.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,n,r){return!!this.get(e,t,n,r)}get(e,n,r,s){if(!this.length)return!1;if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&s){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(!this._refs.size&&"object"!=typeof e)return!1;if("object"==typeof e)for(const n of this._values)if(t(n,e))return{value:n};if(n)for(const o of this._refs){const i=o.resolve(e,n,r,null,{in:!0});if(void 0===i)continue;const a=o.in&&"object"==typeof i?Array.isArray(i)?i:Object.keys(i):[i];for(const n of a)if(typeof n==typeof e)if(s&&e&&"string"==typeof e){if(n.toLowerCase()===e.toLowerCase())return{value:n,ref:o}}else if(t(n,e))return{value:n,ref:o}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){const e=new r.Values(this._values,this._refs);return e._override=this._override,e}concat(t){e(!t._override,"Cannot concat override set of values");const n=new r.Values([...this._values,...t._values],[...this._refs,...t._refs]);return n._override=this._override,n}describe(){const e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const t of this._refs.values())e.push(t.describe());return e}},r.Values.prototype[n.symbols.values]=!0,r.Values.prototype.slice=r.Values.prototype.clone,r.lowercases=function(e){const t=new Map;if(e)for(const n of e)"string"==typeof n&&t.set(n.toLowerCase(),n);return t},aJ}function vJ(){if(lJ)return uJ;lJ=1;const e=JB(),t=iK(),n=YK,r=nJ,s=xK(),o=MK(),i=DK(),a=AK(),c=HK(),u=WK(),l=wK(),p=(tJ||(tJ=1,function(e){const t=JB(),n=MK(),r=PK(),s={};e.Ids=s.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const e=new s.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(const[n,r]of e._byId.entries())t(!this._byKey.has(n),"Schema id conflicts with existing key:",n),this._byId.set(n,r);for(const[n,r]of e._byKey.entries())t(!this._byId.has(n),"Schema key conflicts with existing id:",n),this._byKey.set(n,r)}fork(e,r,o){const i=this._collect(e);i.push({schema:o});const a=i.shift();let c={id:a.id,schema:r(a.schema)};t(n.isSchema(c.schema),"adjuster function failed to return a joi schema type");for(const e of i)c={id:e.id,schema:s.fork(e.schema,c.id,c.schema)};return c.schema}labels(e,t=[]){const n=e[0],r=this._get(n);if(!r)return[...t,...e].join(".");const s=e.slice(1);return t=[...t,r.schema._flags.label||n],s.length?r.schema._ids.labels(s,t):t.join(".")}reach(e,n=[]){const r=e[0],s=this._get(r);t(s,"Schema does not contain path",[...n,...e].join("."));const o=e.slice(1);return o.length?s.schema._ids.reach(o,[...n,r]):s.schema}register(e,{key:r}={}){if(!e||!n.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);const s=e._flags.id;if(s){const n=this._byId.get(s);t(!n||n.schema===e,"Cannot add different schemas with the same id:",s),t(!this._byKey.has(s),"Schema id conflicts with existing key:",s),this._byId.set(s,{schema:e,id:s})}r&&(t(!this._byKey.has(r),"Schema already contains key:",r),t(!this._byId.has(r),"Schema key conflicts with existing id:",r),this._byKey.set(r,{schema:e,id:r}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,n=[],r=[]){const s=e[0],o=this._get(s);t(o,"Schema does not contain path",[...n,...e].join(".")),r=[o,...r];const i=e.slice(1);return i.length?o.schema._ids._collect(i,[...n,s],r):r}_get(e){return this._byId.get(e)||this._byKey.get(e)}},s.fork=function(t,n,r){const s=e.schema(t,{each:(e,{key:t})=>{if(n===(e._flags.id||t))return r},ref:!1});return s?s.$_mutateRebuild():t},e.schema=function(e,t){let n;for(const r in e._flags){if("_"===r[0])continue;const o=s.scan(e._flags[r],{source:"flags",name:r},t);void 0!==o&&(n=n||e.clone(),n._flags[r]=o)}for(let r=0;r<e._rules.length;++r){const o=e._rules[r],i=s.scan(o.args,{source:"rules",name:o.name},t);if(void 0!==i){n=n||e.clone();const t=Object.assign({},o);t.args=i,n._rules[r]=t,n._singleRules.get(o.name)===o&&n._singleRules.set(o.name,t)}}for(const r in e.$_terms){if("_"===r[0])continue;const o=s.scan(e.$_terms[r],{source:"terms",name:r},t);void 0!==o&&(n=n||e.clone(),n.$_terms[r]=o)}return n},s.scan=function(e,t,o,i,a){const c=i||[];if(null===e||"object"!=typeof e)return;let u;if(Array.isArray(e)){for(let n=0;n<e.length;++n){const r="terms"===t.source&&"keys"===t.name&&e[n].key,i=s.scan(e[n],t,o,[n,...c],r);void 0!==i&&(u=u||e.slice(),u[n]=i)}return u}if(!1!==o.schema&&n.isSchema(e)||!1!==o.ref&&r.isRef(e)){const n=o.each(e,{...t,path:c,key:a});if(n===e)return;return n}for(const n in e){if("_"===n[0])continue;const r=s.scan(e[n],t,o,[n,...c],a);void 0!==r&&(u=u||Object.assign({},e),u[n]=r)}return u}}(rJ)),rJ),d=PK(),h=JK(),m=AJ(),f=RJ(),_={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new p.Ids,this._preferences=null,this._refs=new d.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return e("function"==typeof u.describe,"Manifest functionality disabled"),u.describe(this)}allow(...e){return o.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(t){e(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),e(!this._inRuleset(),"Cannot set alterations inside a ruleset");const n=this.clone();n.$_terms.alterations=n.$_terms.alterations||[];for(const r in t){const s=t[r];e("function"==typeof s,"Alteration adjuster for",r,"must be a function"),n.$_terms.alterations.push({target:r,adjuster:s})}return n.$_temp.ruleset=!1,n}artifact(t){return e(void 0!==t,"Artifact cannot be undefined"),e(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return e(!1===t||"string"==typeof t,"Invalid to value"),e(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(e,t){return this._default("default",e,t)}description(t){return e(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(e){const t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(t){return e(t,"Missing error"),e(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,n={}){return e(void 0!==t,"Missing example"),o.assertOptions(n,["override"]),this._inner("examples",t,{single:!0,override:n.override})}external(t,n){return"object"==typeof t&&(e(!n,"Cannot combine options with description"),n=t.description,t=t.method),e("function"==typeof t,"Method must be a function"),e(void 0===n||n&&"string"==typeof n,"Description must be a non-empty string"),this._inner("externals",{method:t,description:n},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(t){return t?(e("string"==typeof t,"id must be a non-empty string"),e(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(t){return e(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return e(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){e(t.length,"Missing notes");for(const n of t)e(n&&"string"==typeof n,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return e("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){e(t,"Missing preferences"),e(void 0===t.context,"Cannot override context"),e(void 0===t.externals,"Cannot override externals"),e(void 0===t.warnings,"Cannot override warnings"),e(void 0===t.debug,"Cannot override debug"),o.checkPreferences(t);const n=this.clone();return n._preferences=o.preferences(n._preferences,t),n}presence(t){return e(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(t){return e(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(e){const t=this.clone(),n=void 0!==e&&!e;return t._preferences=o.preferences(t._preferences,{convert:n}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...t){e(t.length,"Missing tags");for(const n of t)e(n&&"string"==typeof n,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return e(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...e){o.verifyFlat(e,"valid");const t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(t,n){const r=this.clone();r.$_terms.whens||(r.$_terms.whens=[]);const s=i.when(r,t,n);if(!["any","link"].includes(r.type)){const t=s.is?[s]:s.switch;for(const n of t)e(!n.then||"any"===n.then.type||n.then.type===r.type,"Cannot combine",r.type,"with",n.then&&n.then.type),e(!n.otherwise||"any"===n.otherwise.type||n.otherwise.type===r.type,"Cannot combine",r.type,"with",n.otherwise&&n.otherwise.type)}return r.$_terms.whens.push(s),r.$_mutateRebuild()}cache(t){e(!this._inRuleset(),"Cannot set caching inside a ruleset"),e(!this._cache,"Cannot override schema cache"),e(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");const n=this.clone();return n._cache=t||s.provider.provision(),n.$_temp.ruleset=!1,n}clone(){const e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(t){e(o.isSchema(t),"Invalid schema object"),e("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),e(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),e(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let n=this.clone();if("any"===this.type&&"any"!==t.type){const e=t.clone();for(const t of Object.keys(n))"type"!==t&&(e[t]=n[t]);n=e}n._ids.concat(t._ids),n._refs.register(t,d.toSibling),n._preferences=n._preferences?o.preferences(n._preferences,t._preferences):t._preferences,n._valids=f.merge(n._valids,t._valids,t._invalids),n._invalids=f.merge(n._invalids,t._invalids,t._valids);for(const e of t._singleRules.keys())n._singleRules.has(e)&&(n._rules=n._rules.filter(t=>t.keep||t.name!==e),n._singleRules.delete(e));for(const e of t._rules)t._definition.rules[e.method].multi||n._singleRules.set(e.name,e),n._rules.push(e);if(n._flags.empty&&t._flags.empty){n._flags.empty=n._flags.empty.concat(t._flags.empty);const e=Object.assign({},t._flags);delete e.empty,r(n._flags,e)}else if(t._flags.empty){n._flags.empty=t._flags.empty;const e=Object.assign({},t._flags);delete e.empty,r(n._flags,e)}else r(n._flags,t._flags);for(const e in t.$_terms){const r=t.$_terms[e];r?n.$_terms[e]?n.$_terms[e]=n.$_terms[e].concat(r):n.$_terms[e]=r.slice():n.$_terms[e]||(n.$_terms[e]=r)}return this.$_root._tracer&&this.$_root._tracer._combine(n,[this,t]),n.$_mutateRebuild()}extend(t){return e(!t.base,"Cannot extend type with another base"),c.type(this,t)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(t,n){e(!this._inRuleset(),"Cannot fork inside a ruleset");let r=this;for(let e of[].concat(t))e=Array.isArray(e)?e:e.split("."),r=r._ids.fork(e,n,r);return r.$_temp.ruleset=!1,r}rule(n){const r=this._definition;o.assertOptions(n,Object.keys(r.modifiers)),e(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const s=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;e(s>=0&&s<this._rules.length,"Cannot apply rules to empty ruleset");const i=this.clone();for(let o=s;o<i._rules.length;++o){const s=i._rules[o],a=t(s);for(const t in n)r.modifiers[t](a,n[t]),e(a.name===s.name,"Cannot change rule name");i._rules[o]=a,i._singleRules.get(a.name)===s&&i._singleRules.set(a.name,a)}return i.$_temp.ruleset=!1,i.$_mutateRebuild()}get ruleset(){e(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),e(!this._inRuleset(),"Cannot tailor inside a ruleset");let n=this;if(this.$_terms.alterations)for(const{target:r,adjuster:s}of this.$_terms.alterations)t.includes(r)&&(n=s(n),e(o.isSchema(n),"Alteration adjuster for",r,"failed to return a schema object"));return n=n.$_modify({each:e=>e.tailor(t),ref:!1}),n.$_temp.ruleset=!1,n.$_mutateRebuild()}tracer(){return h.location?h.location(this):this}validate(e,t){return m.entry(e,this,t)}validateAsync(e,t){return m.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),e(t&&"object"==typeof t,"Invalid options"),e(t.name&&"string"==typeof t.name,"Invalid rule name");for(const n in t)e("_"!==n[0],"Cannot set private rule properties");const n=Object.assign({},t);n._resolve=[],n.method=n.method||n.name;const r=this._definition.rules[n.method],s=n.args;e(r,"Unknown rule",n.method);const i=this.clone();if(s){e(1===Object.keys(s).length||Object.keys(s).length===this._definition.rules[n.name].args.length,"Invalid rule definition for",this.type,n.name);for(const t in s){let a=s[t];if(r.argsByName){const c=r.argsByName.get(t);if(c.ref&&o.isResolvable(a))n._resolve.push(t),i.$_mutateRegister(a);else if(c.normalize&&(a=c.normalize(a),s[t]=a),c.assert){const n=o.validateArg(a,t,c);e(!n,n,"or reference")}}void 0!==a?s[t]=a:delete s[t]}}return r.multi||(i._ruleRemove(n.name,{clone:!1}),i._singleRules.set(n.name,n)),!1===i.$_temp.ruleset&&(i.$_temp.ruleset=null),r.priority?i._rules.unshift(n):i._rules.push(n),i}$_compile(e,t){return i.schema(this.$_root,e,t)}$_createError(e,t,n,r,s,o={}){const i=!1!==o.flags?this._flags:{},c=o.messages?l.merge(this._definition.messages,o.messages):this._definition.messages;return new a.Report(e,t,n,i,c,r,s)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,n,r){(n=Object.assign({},n)).abortEarly=!0,n._externals=!1,t.snapshot();const s=!m.validate(e,this,t,n,r).errors;return t.restore(),s}$_modify(e){return o.assertOptions(e,["each","once","ref","schema"]),p.schema(this,e)||this}$_mutateRebuild(){e(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();return this.$_modify({each:(e,{source:t,name:n,path:r,key:s})=>{const o=this._definition[t][n]&&this._definition[t][n].register;!1!==o&&this.$_mutateRegister(e,{family:o,key:s})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:n}={}){this._refs.register(e,t),this._ids.register(e,{key:n})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,r,s={}){e("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const o=this._definition.flags[t]||{};if(n(r,o.default)&&(r=void 0),n(r,this._flags[t]))return this;const i=!1!==s.clone?this.clone():this;return void 0!==r?(i._flags[t]=r,i.$_mutateRegister(r)):delete i._flags[t],"_"!==t[0]&&(i.$_temp.ruleset=!1),i}$_parent(e,...t){return this[e][o.symbols.parent].call(this,...t)}$_validate(e,t,n){return m.validate(e,this,t,n)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=t(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){const e=this.clone();e._reset();const t=e._definition.terms;for(const n in t){const r=t[n];e.$_terms[n]=r.init}return e.$_mutateRebuild()}_default(t,n,r={}){o.assertOptions(r,"literal"),e(void 0!==n,"Missing",t,"value"),e("function"==typeof n||!r.literal,"Only function value supports literal option"),"function"==typeof n&&r.literal&&(n={[o.symbols.literal]:!0,literal:n});return this.$_setFlag(t,n)}_generate(e,t,n){if(!this.$_terms.whens)return{schema:this};const r=[],s=[];for(let o=0;o<this.$_terms.whens.length;++o){const i=this.$_terms.whens[o];if(i.concat){r.push(i.concat),s.push(`${o}.concat`);continue}const a=i.ref?i.ref.resolve(e,t,n):e,c=i.is?[i]:i.switch,u=s.length;for(let u=0;u<c.length;++u){const{is:l,then:p,otherwise:d}=c[u],h=`${o}${i.switch?"."+u:""}`;if(l.$_match(a,t.nest(l,`${h}.is`),n)){if(p){const o=t.localize([...t.path,`${h}.then`],t.ancestors,t.schemas),{schema:i,id:a}=p._generate(e,o,n);r.push(i),s.push(`${h}.then${a?`(${a})`:""}`);break}}else if(d){const o=t.localize([...t.path,`${h}.otherwise`],t.ancestors,t.schemas),{schema:i,id:a}=d._generate(e,o,n);r.push(i),s.push(`${h}.otherwise${a?`(${a})`:""}`);break}}if(i.break&&s.length>u)break}const o=s.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",o),!o)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[o])return{schema:this.$_temp.whens[o],id:o};let i=this;this._definition.generate&&(i=this._definition.generate(this,e,t,n));for(const e of r)i=i.concat(e);return this.$_root._tracer&&this.$_root._tracer._combine(i,[this,...r]),this.$_temp.whens[o]=i,{schema:i,id:o}}_inner(t,n,r={}){e(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);const s=this.clone();return s.$_terms[t]&&!r.override||(s.$_terms[t]=[]),r.single?s.$_terms[t].push(n):s.$_terms[t].push(...n),s.$_temp.ruleset=!1,s}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;const n=!1!==t.clone?this.clone():this;n._singleRules.delete(e);const r=[];for(let t=0;t<n._rules.length;++t){const s=n._rules[t];s.name!==e||s.keep?r.push(s):n._inRuleset()&&t<n.$_temp.ruleset&&--n.$_temp.ruleset}return n._rules=r,n}_values(t,n){o.verifyFlat(t,n.slice(1,-1));const r=this.clone(),s=t[0]===o.symbols.override;if(s&&(t=t.slice(1)),!r[n]&&t.length?r[n]=new f:s&&(r[n]=t.length?new f:null,r.$_mutateRebuild()),!r[n])return r;s&&r[n].override();for(const s of t){e(void 0!==s,"Cannot call allow/valid/invalid with undefined"),e(s!==o.symbols.override,"Override must be the first value");const t="_invalids"===n?"_valids":"_invalids";r[t]&&(r[t].remove(s),r[t].length||(e("_valids"===n||!r._flags.only,"Setting invalid value",s,"leaves schema rejecting all values due to previous valid rule"),r[t]=null)),r[n].add(s,r._refs)}return r}}};return _.Base.prototype[o.symbols.any]={version:o.version,compile:i.compile,root:"$_root"},_.Base.prototype.isImmutable=!0,_.Base.prototype.deny=_.Base.prototype.invalid,_.Base.prototype.disallow=_.Base.prototype.invalid,_.Base.prototype.equal=_.Base.prototype.valid,_.Base.prototype.exist=_.Base.prototype.required,_.Base.prototype.not=_.Base.prototype.invalid,_.Base.prototype.options=_.Base.prototype.prefs,_.Base.prototype.preferences=_.Base.prototype.prefs,uJ=new _.Base}function NJ(){if(dJ)return pJ;dJ=1;const e=JB(),t=vJ(),n=MK(),r=wK();return pJ=t.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,n){return e("function"==typeof t,"Method must be a function"),e(void 0===n||n&&"string"==typeof n,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:n}})},validate(e,t,{method:n}){try{return n(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(t){e(n.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const r=this.clone();return r.$_terms.shared=r.$_terms.shared||[],r.$_terms.shared.push(t),r.$_mutateRegister(t),r}},warning:{method(t,n){return e(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:n},warn:!0})},validate:(e,t,{code:n,local:r})=>t.error(n,r),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=r.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const n in t){const r=t[n];if(["examples","externals","metas","notes","tags"].includes(n))for(const t of r)e=e[n.slice(0,-1)](t);else{if("alterations"===n){const t={};for(const{target:e,adjuster:n}of r)t[e]=n;e=e.alter(t);continue}if("whens"!==n){if("shared"===n)for(const t of r)e=e.shared(t)}else for(const t of r){const{ref:n,is:r,not:s,then:o,otherwise:i,concat:a}=t;e=a?e.concat(a):n?e.when(n,{is:r,not:s,then:o,otherwise:i,switch:t.switch,break:t.break}):e.when(r,{then:o,otherwise:i,break:t.break})}}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}}),pJ}function CJ(){if(mJ)return hJ;mJ=1;const e=JB(),t=nJ,n=NJ(),r=MK(),s=DK(),o=AK(),i=PK(),a={};return hJ=n.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:i.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(e,n){const{schema:r,error:s,state:i,prefs:c}=n;if(r._flags.match){const n=[],a=[];for(let t=0;t<r.$_terms.matches.length;++t){const s=r.$_terms.matches[t],o=i.nest(s.schema,`match.${t}`);o.snapshot();const u=s.schema.$_validate(e,o,c);u.errors?(a.push(u.errors),o.restore()):n.push(u.value)}if(0===n.length){return{errors:s("alternatives.any",{details:a.map(e=>o.details(e,{override:!1}))})}}if("one"===r._flags.match)return 1===n.length?{value:n[0]}:{errors:s("alternatives.one")};if(n.length!==r.$_terms.matches.length){return{errors:s("alternatives.all",{details:a.map(e=>o.details(e,{override:!1}))})}}const u=e=>e.$_terms.matches.some(e=>"object"===e.schema.type||"alternatives"===e.schema.type&&u(e.schema));return u(r)?{value:n.reduce((e,n)=>t(e,n,{mergeArrays:!1}))}:{value:n[n.length-1]}}const u=[];for(let t=0;t<r.$_terms.matches.length;++t){const n=r.$_terms.matches[t];if(n.schema){const r=i.nest(n.schema,`match.${t}`);r.snapshot();const s=n.schema.$_validate(e,r,c);if(!s.errors)return s;r.restore(),u.push({schema:n.schema,reports:s.errors});continue}const s=n.ref?n.ref.resolve(e,i,c):e,o=n.is?[n]:n.switch;for(let r=0;r<o.length;++r){const a=o[r],{is:u,then:l,otherwise:p}=a,d=`match.${t}${n.switch?"."+r:""}`;if(u.$_match(s,i.nest(u,`${d}.is`),c)){if(l)return l.$_validate(e,i.nest(l,`${d}.then`),c)}else if(p)return p.$_validate(e,i.nest(p,`${d}.otherwise`),c)}}return a.errors(u,n)},rules:{conditional:{method(t,n){e(!this._flags._endedSwitch,"Unreachable condition"),e(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),e(void 0===n.break,"Cannot use break option with alternatives conditional");const r=this.clone(),o=s.when(r,t,n),i=o.is?[o]:o.switch;for(const e of i)if(e.then&&e.otherwise){r.$_setFlag("_endedSwitch",!0,{clone:!1});break}return r.$_terms.matches.push(o),r.$_mutateRebuild()}},match:{method(t){if(e(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const n of this.$_terms.matches)e(n.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){e(t.length,"Missing alternative schemas"),r.verifyFlat(t,"try"),e(!this._flags._endedSwitch,"Unreachable condition");const n=this.clone();for(const e of t)n.$_terms.matches.push({schema:n.$_compile(e)});return n.$_mutateRebuild()}}},overrides:{label(e){return this.$_parent("label",e).$_modify({each:(t,n)=>"is"!==n.path[0]?t.label(e):void 0,ref:!1})}},rebuild(e){e.$_modify({each:t=>{r.isSchema(t)&&"array"===t.type&&e.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const n of t.matches){const{schema:t,ref:r,is:s,not:o,then:i,otherwise:a}=n;e=t?e.try(t):r?e.conditional(r,{is:s,then:i,not:o,otherwise:a,switch:n.switch}):e.conditional(s,{then:i,otherwise:a})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),a.errors=function(e,{error:t,state:n}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};const r=new Set,s=[];for(const{reports:i,schema:c}of e){if(i.length>1)return a.unmatched(e,t);const u=i[0];if(u instanceof o.Report==!1)return a.unmatched(e,t);if(u.state.path.length!==n.path.length){s.push({type:c.type,report:u});continue}if("any.only"===u.code){for(const e of u.local.valids)r.add(e);continue}const[l,p]=u.code.split(".");"base"===p?r.add(l):s.push({type:c.type,report:u})}return s.length?1===s.length?{errors:s[0].report}:a.unmatched(e,t):{errors:t("alternatives.types",{types:[...r]})}},a.unmatched=function(e,t){const n=[];for(const t of e)n.push(...t.reports);return{errors:t("alternatives.match",o.details(n,{override:!1}))}},hJ}function OJ(){if(_J)return fJ;_J=1;const e=JB(),t=YK,n=zB(),r=NJ(),s=MK(),o=DK(),i={};return fJ=r.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:n,prefs:r}){if(!Array.isArray(e))return;const s=t.$_getRule("sort");return s?i.sort(t,e,s.args.options,n,r):void 0}},validate(e,{schema:t,error:n}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[s.symbols.arraySingle]=!0,{value:t}}return{errors:n("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});const t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:n,error:r},{schema:s}){const o=[e,...t.ancestors];for(let r=0;r<e.length;++r){const i=t.localize([...t.path,r],o,s);if(s.$_match(e[r],i,n))return e}const i=s._flags.label;return i?r("array.hasKnown",{patternLabel:i}):r("array.hasUnknown",null)},multi:!0},items:{method(...e){s.verifyFlat(e,"items");const t=this.$_addRule("items");for(let n=0;n<e.length;++n){const r=s.tryWithPath(()=>this.$_compile(e[n]),n,{append:!0});t.$_terms.items.push(r)}return t.$_mutateRebuild()},validate(e,{schema:t,error:n,state:r,prefs:o,errorsArray:a}){const c=t.$_terms._requireds.slice(),u=t.$_terms.ordered.slice(),l=[...t.$_terms._inclusions,...c],p=!e[s.symbols.arraySingle];delete e[s.symbols.arraySingle];const d=a();let h=e.length;for(let s=0;s<h;++s){const a=e[s];let m=!1,f=!1;const _=p?s:new Number(s),g=[...r.path,_];if(!t._flags.sparse&&void 0===a){if(d.push(n("array.sparse",{key:_,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly)return d;u.shift();continue}const E=[e,...r.ancestors];for(const e of t.$_terms._exclusions)if(e.$_match(a,r.localize(g,E,e),o,{presence:"ignore"})){if(d.push(n("array.excludes",{pos:s,value:a},r.localize(g))),o.abortEarly)return d;m=!0,u.shift();break}if(m)continue;if(t.$_terms.ordered.length){if(u.length){const c=u.shift(),l=c.$_validate(a,r.localize(g,E,c),o);if(l.errors){if(d.push(...l.errors),o.abortEarly)return d}else if("strip"===c._flags.result)i.fastSplice(e,s),--s,--h;else{if(!t._flags.sparse&&void 0===l.value){if(d.push(n("array.sparse",{key:_,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly)return d;continue}e[s]=l.value}continue}if(!t.$_terms.items.length){if(d.push(n("array.orderedLength",{pos:s,limit:t.$_terms.ordered.length})),o.abortEarly)return d;break}}const S=[];let y=c.length;for(let u=0;u<y;++u){const l=r.localize(g,E,c[u]);l.snapshot();const p=c[u].$_validate(a,l,o);if(S[u]=p,!p.errors){if(e[s]=p.value,f=!0,i.fastSplice(c,u),--u,--y,!t._flags.sparse&&void 0===p.value&&(d.push(n("array.sparse",{key:_,path:g,pos:s,value:void 0},r.localize(g))),o.abortEarly))return d;break}l.restore()}if(f)continue;const T=o.stripUnknown&&!!o.stripUnknown.arrays||!1;y=l.length;for(const u of l){let l;const p=c.indexOf(u);if(-1!==p)l=S[p];else{const c=r.localize(g,E,u);if(c.snapshot(),l=u.$_validate(a,c,o),!l.errors){"strip"===u._flags.result?(i.fastSplice(e,s),--s,--h):t._flags.sparse||void 0!==l.value?e[s]=l.value:(d.push(n("array.sparse",{key:_,path:g,pos:s,value:void 0},r.localize(g))),m=!0),f=!0;break}c.restore()}if(1===y){if(T){i.fastSplice(e,s),--s,--h,f=!0;break}if(d.push(...l.errors),o.abortEarly)return d;m=!0;break}}if(!m&&((t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!f)){if(T){i.fastSplice(e,s),--s,--h;continue}if(d.push(n("array.includes",{pos:s,value:a},r.localize(g))),o.abortEarly)return d}}return c.length&&i.fillMissedErrors(t,d,c,e,r,o),u.length&&(i.fillOrderedErrors(t,d,u,e,r,o),d.length||i.fillDefault(u,e,r,o)),d.length?d:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:r,operator:o,args:i})=>s.compare(e.length,n,o)?e:t.error("array."+r,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:s.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){s.verifyFlat(e,"ordered");const t=this.$_addRule("items");for(let n=0;n<e.length;++n){const r=s.tryWithPath(()=>this.$_compile(e[n]),n,{append:!0});i.validateSingle(r,t),t.$_mutateRegister(r),t.$_terms.ordered.push(r)}return t.$_mutateRebuild()}},single:{method(t){const n=void 0===t||!!t;return e(!n||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",n)}},sort:{method(t={}){s.assertOptions(t,["by","order"]);const n={order:t.order||"ascending"};return t.by&&(n.by=o.ref(t.by,{ancestor:0}),e(!n.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:n}})},validate(e,{error:t,state:n,prefs:r,schema:s},{options:o}){const{value:a,errors:c}=i.sort(s,e,o,n,r);if(c)return c;for(let n=0;n<e.length;++n)if(e[n]!==a[n])return t("array.sort",{order:o.order,by:o.by?o.by.key:"value"});return e},convert:!0},sparse:{method(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;return(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(t,n={}){e(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),s.assertOptions(n,["ignoreUndefined","separator"]);const r={name:"unique",args:{options:n,comparator:t}};if(t)if("string"==typeof t){const e=s.default(n.separator,".");r.path=e?t.split(e):[t]}else r.comparator=t;return this.$_addRule(r)},validate(r,{state:s,error:o,schema:i},{comparator:a,options:c},{comparator:u,path:l}){const p={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},d=u||t,h=c.ignoreUndefined;for(let t=0;t<r.length;++t){const i=l?n(r[t],l):r[t],c=u?p.custom:p[typeof i];if(e(c,"Failed to find unique map container for type",typeof i),c instanceof Map){const e=c.entries();let n;for(;!(n=e.next()).done;)if(d(n.value[0],i)){const e=s.localize([...s.path,t],[r,...s.ancestors]),i={pos:t,value:r[t],dupePos:n.value[1],dupeValue:r[n.value[1]]};return l&&(i.path=a),o("array.unique",i,e)}c.set(i,t)}else{if((!h||void 0!==i)&&void 0!==c[i]){const e={pos:t,value:r[t],dupePos:c[i],dupeValue:r[c[i]]};l&&(e.path=a);return o("array.unique",e,s.localize([...s.path,t],[r,...s.ancestors]))}c[i]=t}}return r},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)i.validateSingle(t,e),"required"===t._flags.presence?e.$_terms._requireds.push(t):"forbidden"===t._flags.presence?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(const t of e.$_terms.ordered)i.validateSingle(t,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),i.fillMissedErrors=function(e,t,n,r,s,o){const i=[];let a=0;for(const e of n){const t=e._flags.label;t?i.push(t):++a}i.length?a?t.push(e.$_createError("array.includesRequiredBoth",r,{knownMisses:i,unknownMisses:a},s,o)):t.push(e.$_createError("array.includesRequiredKnowns",r,{knownMisses:i},s,o)):t.push(e.$_createError("array.includesRequiredUnknowns",r,{unknownMisses:a},s,o))},i.fillOrderedErrors=function(e,t,n,r,s,o){const a=[];for(const e of n)"required"===e._flags.presence&&a.push(e);a.length&&i.fillMissedErrors(e,t,a,r,s,o)},i.fillDefault=function(e,t,n,r){const s=[];let o=!0;for(let i=e.length-1;i>=0;--i){const a=e[i],c=[t,...n.ancestors],u=a.$_validate(void 0,n.localize(n.path,c,a),r).value;if(o){if(void 0===u)continue;o=!1}s.unshift(u)}s.length&&t.push(...s)},i.fastSplice=function(e,t){let n=t;for(;n<e.length;)e[n++]=e[n];--e.length},i.validateSingle=function(t,n){("array"===t.type||t._flags._arrayItems)&&(e(!n._flags.single,"Cannot specify array item with single rule enabled"),n.$_setFlag("_arrayItems",!0,{clone:!1}))},i.sort=function(e,t,n,r,s){const o="ascending"===n.order?1:-1,a=-1*o,c=o,u=(u,l)=>{let p=i.compare(u,l,a,c);if(null!==p)return p;if(n.by&&(u=n.by.resolve(u,r,s),l=n.by.resolve(l,r,s)),p=i.compare(u,l,a,c),null!==p)return p;const d=typeof u;if(d!==typeof l)throw e.$_createError("array.sort.mismatching",t,null,r,s);if("number"!==d&&"string"!==d)throw e.$_createError("array.sort.unsupported",t,{type:d},r,s);return"number"===d?(u-l)*o:u<l?a:c};try{return{value:t.slice().sort(u)}}catch(e){return{errors:e}}},i.compare=function(e,t,n,r){return e===t?0:void 0===e?1:void 0===t?-1:null===e?r:null===t?n:null},fJ}function IJ(){if(EJ)return gJ;EJ=1;const e=JB(),t=NJ(),n=MK(),r=RJ(),s={isBool:function(e){return"boolean"==typeof e}};return gJ=t.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if("boolean"!=typeof e){if("string"==typeof e){const n=t._flags.sensitive?e:e.toLowerCase();e="true"===n||"false"!==n&&e}return"boolean"!=typeof e&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e),{value:e}}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){n.verifyFlat(t,"truthy");const s=this.clone();s.$_terms.truthy=s.$_terms.truthy||new r;for(let n=0;n<t.length;++n){const r=t[n];e(void 0!==r,"Cannot call truthy with undefined"),s.$_terms.truthy.add(r)}return s}},falsy:{method(...t){n.verifyFlat(t,"falsy");const s=this.clone();s.$_terms.falsy=s.$_terms.falsy||new r;for(let n=0;n<t.length;++n){const r=t[n];e(void 0!==r,"Cannot call falsy with undefined"),s.$_terms.falsy.add(r)}return s}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:s.isBool,to:(e,t)=>e?1:0},string:{from:s.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e)},messages:{"boolean.base":"{{#label}} must be a boolean"}}),gJ}function PJ(){if(yJ)return SJ;yJ=1;const e=JB(),t=NJ(),n=MK(),r=LK(),s={isDate:function(e){return e instanceof Date}};return SJ=t.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:s.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:n,prefs:r}){if(e instanceof Date&&!isNaN(e.getTime()))return;const s=t._flags.format;return r.convert&&s&&"string"==typeof e?{value:e,errors:n("date.format",{format:s})}:{value:e,errors:n("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:r},{name:s,operator:o,args:i}){const a="now"===r?Date.now():r.getTime();return n.compare(e.getTime(),a,o)?e:t.error("date."+s,{limit:i.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:s.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(t){return e(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(t="javascript"){return e(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:s.isDate,to:(e,t)=>e.getTime()},string:{from:s.isDate,to:(e,{prefs:t})=>r.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),s.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return n.isIsoDate(e)?s.date(e.toString()):null;const r=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return s.date(1*e);if("unix"===t)return s.date(1e3*e);if("string"==typeof r)return null}return s.date(e)},s.date=function(e){const t=new Date(e);return isNaN(t.getTime())?null:t},SJ}const LJ=JB(),wJ=iK(),MJ=nJ,xJ=zB(),kJ={};var GJ=function(e,t,n={}){if(LJ(e&&"object"==typeof e,"Invalid defaults value: must be an object"),LJ(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),LJ("object"==typeof n,"Invalid options: must be an object"),!t)return null;if(n.shallow)return kJ.applyToDefaultsWithShallow(e,t,n);const r=wJ(e);if(!0===t)return r;const s=void 0!==n.nullOverride&&n.nullOverride;return MJ(r,t,{nullOverride:s,mergeArrays:!1})};kJ.applyToDefaultsWithShallow=function(e,t,n){const r=n.shallow;LJ(Array.isArray(r),"Invalid keys");const s=new Map,o=!0===t?null:new Set;for(let n of r){n=Array.isArray(n)?n:n.split(".");const r=xJ(e,n);r&&"object"==typeof r?s.set(r,o&&xJ(t,n)||r):o&&o.add(n)}const i=wJ(e,{},s);if(!o)return i;for(const e of o)kJ.reachCopy(i,t,e);const a=void 0!==n.nullOverride&&n.nullOverride;return MJ(i,t,{nullOverride:a,mergeArrays:!1})},kJ.reachCopy=function(e,t,n){for(const e of n){if(!(e in t))return;const n=t[e];if("object"!=typeof n||null===n)return;t=n}const r=t;let s=e;for(let e=0;e<n.length-1;++e){const t=n[e];"object"!=typeof s[t]&&(s[t]={}),s=s[t]}s[n[n.length-1]]=r};var DJ={};const VJ=JB(),UJ={};var HJ,jJ,ZJ,WJ,XJ,$J,FJ,YJ,BJ,KJ;function JJ(){if(jJ)return HJ;jJ=1;const e=GJ,t=JB(),n=iK(),r=DJ,s=NJ(),o=MK(),i=DK(),a=AK(),c=PK(),u=LK(),l={renameDefaults:{alias:!1,multiple:!1,override:!1}};return HJ=s.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:n,state:r,prefs:s}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:n("object.base",{type:t.$_property("typeof")})};if(!(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals))return;e=l.clone(e,s);const o=[];if(t.$_terms.renames&&!l.rename(t,e,r,s,o))return{value:e,errors:o};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:o};const i=new Set(Object.keys(e));if(t.$_terms.keys){const n=[e,...r.ancestors];for(const a of t.$_terms.keys){const t=a.key,c=e[t];i.delete(t);const u=r.localize([...r.path,t],n,a),l=a.schema.$_validate(c,u,s);if(l.errors){if(s.abortEarly)return{value:e,errors:l.errors};void 0!==l.value&&(e[t]=l.value),o.push(...l.errors)}else"strip"===a.schema._flags.result||void 0===l.value&&void 0!==c?delete e[t]:void 0!==l.value&&(e[t]=l.value)}}if(i.size||t._flags._hasPatternMatch){const n=l.unknown(t,e,i,o,r,s);if(n)return n}if(t.$_terms.dependencies)for(const n of t.$_terms.dependencies){if(null!==n.key&&!1===l.isPresent(n.options)(n.key.resolve(e,r,s,null,{shadow:!1})))continue;const i=l.dependencies[n.rel](t,n,e,r,s);if(i){const n=t.$_createError(i.code,e,i.context,r,s);if(s.abortEarly)return{value:e,errors:n};o.push(n)}}return{value:e,errors:o}},rules:{and:{method(...e){return o.verifyFlat(e,"and"),l.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,n,r){u.isTemplate(e)||(e=i.ref(e)),t(void 0===r||"string"==typeof r,"Message must be a string"),n=this.$_compile(n,{appendPath:!0});const s=this.$_addRule({name:"assert",args:{subject:e,schema:n,message:r}});return s.$_mutateRegister(e),s.$_mutateRegister(n),s},validate(e,{error:t,prefs:n,state:r},{subject:s,schema:o,message:i}){const a=s.resolve(e,r,n),u=c.isRef(s)?s.absolute(r):[];return o.$_match(a,r.localize(u,[e,...r.ancestors],o),n)?e:t("object.assert",{subject:s,message:i})},args:["subject","schema","message"],multi:!0},instance:{method(e,n){return t("function"==typeof e,"constructor must be a function"),n=n||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:n}})},validate:(e,t,{constructor:n,name:r})=>e instanceof n?e:t.error("object.instance",{type:r,value:e}),args:["constructor","name"]},keys:{method(e){t(void 0===e||"object"==typeof e,"Object schema must be a valid object"),t(!o.isSchema(e),"Object schema cannot be a joi schema");const n=this.clone();if(e)if(Object.keys(e).length){n.$_terms.keys=n.$_terms.keys?n.$_terms.keys.filter(t=>!e.hasOwnProperty(t.key)):new l.Keys;for(const t in e)o.tryWithPath(()=>n.$_terms.keys.push({key:t,schema:this.$_compile(e[t])}),t)}else n.$_terms.keys=new l.Keys;else n.$_terms.keys=null;return n.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:r,operator:s,args:i})=>o.compare(Object.keys(e).length,n,s)?e:t.error("object."+r,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:o.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return o.verifyFlat(e,"nand"),l.dependency(this,"nand",null,e)}},or:{method(...e){return o.verifyFlat(e,"or"),l.dependency(this,"or",null,e)}},oxor:{method(...e){return l.dependency(this,"oxor",null,e)}},pattern:{method(e,n,r={}){const s=e instanceof RegExp;s||(e=this.$_compile(e,{appendPath:!0})),t(void 0!==n,"Invalid rule"),o.assertOptions(r,["fallthrough","matches"]),s&&t(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),n=this.$_compile(n,{appendPath:!0});const i=this.clone();i.$_terms.patterns=i.$_terms.patterns||[];const a={[s?"regex":"schema"]:e,rule:n};return r.matches&&(a.matches=this.$_compile(r.matches),"array"!==a.matches.type&&(a.matches=a.matches.$_root.array().items(a.matches)),i.$_mutateRegister(a.matches),i.$_setFlag("_hasPatternMatch",!0,{clone:!1})),r.fallthrough&&(a.fallthrough=!0),i.$_terms.patterns.push(a),i.$_mutateRegister(n),i}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>c.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(n,r,s={}){t("string"==typeof n||n instanceof RegExp,"Rename missing the from argument"),t("string"==typeof r||r instanceof u,"Invalid rename to argument"),t(r!==n,"Cannot rename key to same name:",n),o.assertOptions(s,["alias","ignoreUndefined","override","multiple"]);const i=this.clone();i.$_terms.renames=i.$_terms.renames||[];for(const e of i.$_terms.renames)t(e.from!==n,"Cannot rename the same key multiple times");return r instanceof u&&i.$_mutateRegister(r),i.$_terms.renames.push({from:n,to:r,options:e(l.renameDefaults,s)}),i}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:n})=>!o.isSchema(e)||"any"!==n&&e.type!==n?t.error("object.schema",{type:n}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,n={}){return l.dependency(this,"with",e,t,n)}},without:{method(e,t,n={}){return l.dependency(this,"without",e,t,n)}},xor:{method(...e){return o.verifyFlat(e,"xor"),l.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=o.symbols.deepDefault),this.$_parent("default",e,t)}},rebuild(e){if(e.$_terms.keys){const t=new r.Sorter;for(const n of e.$_terms.keys)o.tryWithPath(()=>t.add(n,{after:n.schema.$_rootReferences(),group:n.key}),n.key);e.$_terms.keys=new l.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(const{rel:n,key:r=null,peers:s,options:o}of t.dependencies)e=l.dependency(e,n,r,s,o);if(t.patterns)for(const{regex:n,schema:r,rule:s,fallthrough:o,matches:i}of t.patterns)e=e.pattern(n||r,s,{fallthrough:o,matches:i});if(t.renames)for(const{from:n,to:r,options:s}of t.renames)e=e.rename(n,r,s);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),l.clone=function(e,t){if("object"==typeof e){if(t.nonEnumerables)return n(e,{shallow:!0});const r=Object.create(Object.getPrototypeOf(e));return Object.assign(r,e),r}const r=function(...t){return e.apply(this,t)};return r.prototype=n(e.prototype),Object.defineProperty(r,"name",{value:e.name,writable:!1}),Object.defineProperty(r,"length",{value:e.length,writable:!1}),Object.assign(r,e),r},l.dependency=function(e,n,r,s,a){t(null===r||"string"==typeof r,n,"key must be a strings"),a||(a=s.length>1&&"object"==typeof s[s.length-1]?s.pop():{}),o.assertOptions(a,["separator","isPresent"]),s=[].concat(s);const c=o.default(a.separator,"."),u=[];for(const e of s)t("string"==typeof e,n,"peers must be strings"),u.push(i.ref(e,{separator:c,ancestor:0,prefix:!1}));null!==r&&(r=i.ref(r,{separator:c,ancestor:0,prefix:!1}));const p=e.clone();return p.$_terms.dependencies=p.$_terms.dependencies||[],p.$_terms.dependencies.push(new l.Dependency(n,r,u,s,a)),p},l.dependencies={and(e,t,n,r,s){const o=[],i=[],a=t.peers.length,c=l.isPresent(t.options);for(const e of t.peers)!1===c(e.resolve(n,r,s,null,{shadow:!1}))?o.push(e.key):i.push(e.key);if(o.length!==a&&i.length!==a)return{code:"object.and",context:{present:i,presentWithLabels:l.keysToLabels(e,i),missing:o,missingWithLabels:l.keysToLabels(e,o)}}},nand(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(o.length!==t.peers.length)return;const a=t.paths[0],c=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:l.keysToLabels(e,a),peers:c,peersWithLabels:l.keysToLabels(e,c)}}},or(e,t,n,r,s){const o=l.isPresent(t.options);for(const e of t.peers)if(o(e.resolve(n,r,s,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)}}},oxor(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(!o.length||1===o.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return a.present=o,a.presentWithLabels=l.keysToLabels(e,o),{code:"object.oxor",context:a}},with(e,t,n,r,s){const o=l.isPresent(t.options);for(const i of t.peers)if(!1===o(i.resolve(n,r,s,null,{shadow:!1})))return{code:"object.with",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:i.key,peerWithLabel:l.keysToLabels(e,i.key)}}},without(e,t,n,r,s){const o=l.isPresent(t.options);for(const i of t.peers)if(o(i.resolve(n,r,s,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:l.keysToLabels(e,t.key.key),peer:i.key,peerWithLabel:l.keysToLabels(e,i.key)}}},xor(e,t,n,r,s){const o=[],i=l.isPresent(t.options);for(const e of t.peers)i(e.resolve(n,r,s,null,{shadow:!1}))&&o.push(e.key);if(1===o.length)return;const a={peers:t.paths,peersWithLabels:l.keysToLabels(e,t.paths)};return 0===o.length?{code:"object.missing",context:a}:(a.present=o,a.presentWithLabels=l.keysToLabels(e,o),{code:"object.xor",context:a})}},l.keysToLabels=function(e,t){return Array.isArray(t)?t.map(t=>e.$_mapLabels(t)):e.$_mapLabels(t)},l.isPresent=function(e){return"function"==typeof e.isPresent?e.isPresent:e=>void 0!==e},l.rename=function(e,t,n,r,s){const o={};for(const i of e.$_terms.renames){const a=[],c="string"!=typeof i.from;if(c)for(const e in t){if(void 0===t[e]&&i.options.ignoreUndefined)continue;if(e===i.to)continue;const n=i.from.exec(e);n&&a.push({from:e,to:i.to,match:n})}else!Object.prototype.hasOwnProperty.call(t,i.from)||void 0===t[i.from]&&i.options.ignoreUndefined||a.push(i);for(const l of a){const a=l.from;let p=l.to;if(p instanceof u&&(p=p.render(t,n,r,l.match)),a!==p){if(!i.options.multiple&&o[p]&&(s.push(e.$_createError("object.rename.multiple",t,{from:a,to:p,pattern:c},n,r)),r.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(t,p)&&!i.options.override&&!o[p]&&(s.push(e.$_createError("object.rename.override",t,{from:a,to:p,pattern:c},n,r)),r.abortEarly))return!1;void 0===t[a]?delete t[p]:t[p]=t[a],o[p]=!0,i.options.alias||delete t[a]}}}return!0},l.unknown=function(e,t,n,r,s,i){if(e.$_terms.patterns){let o=!1;const c=e.$_terms.patterns.map(e=>{if(e.matches)return o=!0,[]}),u=[t,...s.ancestors];for(const o of n){const a=t[o],l=[...s.path,o];for(let p=0;p<e.$_terms.patterns.length;++p){const d=e.$_terms.patterns[p];if(d.regex){const e=d.regex.test(o);if(s.mainstay.tracer.debug(s,"rule",`pattern.${p}`,e?"pass":"error"),!e)continue}else if(!d.schema.$_match(o,s.nest(d.schema,`pattern.${p}`),i))continue;n.delete(o);const h=s.localize(l,u,{schema:d.rule,key:o}),m=d.rule.$_validate(a,h,i);if(m.errors){if(i.abortEarly)return{value:t,errors:m.errors};r.push(...m.errors)}if(d.matches&&c[p].push(o),t[o]=m.value,!d.fallthrough)break}}if(o)for(let n=0;n<c.length;++n){const o=c[n];if(!o)continue;const l=e.$_terms.patterns[n].matches,p=s.localize(s.path,u,l),d=l.$_validate(o,p,i);if(d.errors){const n=a.details(d.errors,{override:!1});n.matches=o;const c=e.$_createError("object.pattern.match",t,n,s,i);if(i.abortEarly)return{value:t,errors:c};r.push(c)}}}if(!n.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(i.stripUnknown&&!e._flags.unknown||i.skipFunctions){const e=!!i.stripUnknown&&(!0===i.stripUnknown||!!i.stripUnknown.objects);for(const r of n)e?(delete t[r],n.delete(r)):"function"==typeof t[r]&&n.delete(r)}if(!o.default(e._flags.unknown,i.allowUnknown))for(const o of n){const n=s.localize([...s.path,o],[]),a=e.$_createError("object.unknown",t[o],{child:o},n,i,{flags:!1});if(i.abortEarly)return{value:t,errors:a};r.push(a)}},l.Dependency=class{constructor(e,t,n,r,s){this.rel=e,this.key=t,this.peers=n,this.paths=r,this.options=s}describe(){const e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}},l.Keys=class extends Array{concat(e){const t=this.slice(),n=new Map;for(let e=0;e<t.length;++e)n.set(t[e].key,e);for(const r of e){const e=r.key,s=n.get(e);void 0!==s?t[s]={key:e,schema:t[s].schema.concat(r.schema)}:t.push(r)}return t}},HJ}function zJ(){if(WJ)return ZJ;WJ=1;const e=JB(),t=JJ();return ZJ=t.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(e,t,{n:n})=>e.length===n?e:t.error("function.arity",{n:n})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(t){return e(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(e,t,{n:n})=>e.length>=n?e:t.error("function.minArity",{n:n})},maxArity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(e,t,{n:n})=>e.length<=n?e:t.error("function.maxArity",{n:n})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})}function QJ(){if($J)return XJ;$J=1;const e=JB(),t=NJ(),n=MK(),r=DK(),s=AK(),o={};return XJ=t.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(t,{schema:n,state:r,prefs:s}){e(n.$_terms.link,"Uninitialized link schema");const i=o.generate(n,t,r,s),a=n.$_terms.link[0].ref;return i.$_validate(t,r.nest(i,`link:${a.display}:${i.type}`),s)},generate:(e,t,n,r)=>o.generate(e,t,n,r),rules:{ref:{method(t){e(!this.$_terms.link,"Cannot reinitialize schema"),t=r.ref(t),e("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),e("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const n=this.clone();return n.$_terms.link=[{ref:t}],n}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(t){e(this.$_terms.link,"Uninitialized link schema"),e(n.isSchema(t),"Invalid schema object"),e("link"!==t.type,"Cannot merge type link with another link");const r=this.clone();return r.$_terms.whens||(r.$_terms.whens=[]),r.$_terms.whens.push({concat:t}),r.$_mutateRebuild()}},manifest:{build:(t,n)=>(e(n.link,"Invalid link description missing link"),t.ref(n.link))}}),o.generate=function(e,t,n,r){let s=n.mainstay.links.get(e);if(s)return s._generate(t,n,r).schema;const i=e.$_terms.link[0].ref,{perspective:a,path:c}=o.perspective(i,n);o.assert(a,"which is outside of schema boundaries",i,e,n,r);try{s=c.length?a.$_reach(c):a}catch(t){o.assert(!1,"to non-existing schema",i,e,n,r)}return o.assert("link"!==s.type,"which is another link",i,e,n,r),e._flags.relative||n.mainstay.links.set(e,s),s._generate(t,n,r).schema},o.perspective=function(e,t){if("local"===e.type){for(const{schema:n,key:r}of t.schemas){if((n._flags.id||r)===e.path[0])return{perspective:n,path:e.path.slice(1)};if(n.$_terms.shared)for(const t of n.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}}return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}},o.assert=function(t,n,r,o,i,a){t||e(!1,`"${s.label(o._flags,i,a)}" contains link reference "${r.display}" ${n}`)},XJ}function qJ(){if(YJ)return FJ;YJ=1;const e=JB(),t=NJ(),n=MK(),r={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/};return FJ=t.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:n}){if(!e.match(r.numberRx))return;e=e.trim();const s={value:parseFloat(e)};if(0===s.value&&(s.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(r.extractSignificantDigits(e)!==r.extractSignificantDigits(String(s.value)))return s.errors=n("number.unsafe"),s}else{const t=s.value.toString();if(t.match(/e/i))return s;if(t!==r.normalizeDecimal(e))return s.errors=n("number.unsafe"),s}return s}},validate(e,{schema:t,error:r,prefs:s}){if(e===1/0||e===-1/0)return{value:e,errors:r("number.infinity")};if(!n.isNumber(e))return{value:e,errors:r("number.base")};const o={value:e};if(s.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);o.value=Math.round(o.value*t)/t}}return 0===o.value&&(o.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(o.errors=r("number.unsafe")),o},rules:{compare:{method:!1,validate:(e,t,{limit:r},{name:s,operator:o,args:i})=>n.compare(e,r,o)?e:t.error("number."+s,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:n.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e===0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){return this.$_addRule({name:"multiple",args:{base:e}})},validate:(e,t,{base:n},r)=>e*(1/n)%1==0?e:t.error("number.multiple",{multiple:r.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&e>0,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return e(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(e,t,{limit:n}){const s=e.toString().match(r.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=n?e:t.error("number.precision",{limit:n,value:e})},convert:!0},sign:{method(t){return e(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(e,t,{sign:n})=>"negative"===n&&e<0||"positive"===n&&e>0?e:t.error(`number.${n}`)},unsafe:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),r.extractSignificantDigits=function(e){return e.replace(r.exponentialPartRegex,"").replace(r.dotRegex,"").replace(r.trailingZerosRegex,"").replace(r.leadingSignAndZerosRegex,"")},r.normalizeDecimal=function(e){return(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),"-0"===e?"0":e},FJ}function ez(){if(KJ)return BJ;KJ=1;const e=JJ();return BJ=e.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}})}DJ.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(e,t){const n=[].concat((t=t||{}).before||[]),r=[].concat(t.after||[]),s=t.group||"?",o=t.sort||0;VJ(!n.includes(s),`Item cannot come before itself: ${s}`),VJ(!n.includes("?"),"Item cannot come before unassociated items"),VJ(!r.includes(s),`Item cannot come after itself: ${s}`),VJ(!r.includes("?"),"Item cannot come after unassociated items"),Array.isArray(e)||(e=[e]);for(const t of e){const e={seq:this._items.length,sort:o,before:n,after:r,group:s,node:t};this._items.push(e)}if(!t.manual){const e=this._sort();VJ(e,"item","?"!==s?`added into group ${s}`:"","created a dependencies error")}return this.nodes}merge(e){Array.isArray(e)||(e=[e]);for(const t of e)if(t)for(const e of t._items)this._items.push(Object.assign({},e));this._items.sort(UJ.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return VJ(t,"merge created a dependencies error"),this.nodes}sort(){const e=this._sort();return VJ(e,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),n=Object.create(null);for(const r of this._items){const s=r.seq,o=r.group;n[o]=n[o]||[],n[o].push(s),e[s]=r.before;for(const e of r.after)t[e]=t[e]||[],t[e].push(s)}for(const t in e){const r=[];for(const s in e[t]){const o=e[t][s];n[o]=n[o]||[],r.push(...n[o])}e[t]=r}for(const r in t)if(n[r])for(const s of n[r])e[s].push(...t[r]);const r={};for(const t in e){const n=e[t];for(const e of n)r[e]=r[e]||[],r[e].push(t)}const s={},o=[];for(let e=0;e<this._items.length;++e){let t=e;if(r[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===s[e])continue;r[e]||(r[e]=[]);const n=r[e].length;let o=0;for(let t=0;t<n;++t)s[r[e][t]]&&++o;if(o===n){t=e;break}}}null!==t&&(s[t]=!0,o.push(t))}if(o.length!==this._items.length)return!1;const i={};for(const e of this._items)i[e.seq]=e;this._items=[],this.nodes=[];for(const e of o){const t=i[e];this.nodes.push(t.node),this._items.push(t)}return!0}},UJ.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1;var tz={},nz={};!function(e){e.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},e.code=function(t){return{code:t,error:e.codes[t]}}}(nz),function(e){const t=nz,n={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:i.URL||URL};e.analyze=function(e,r={}){if(!e)return t.code("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(e.length>256)return t.code("DOMAIN_TOO_LONG");if(!!n.nonAsciiRx.test(e)){if(!1===r.allowUnicode)return t.code("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(n.domainControlRx.test(e))return t.code("DOMAIN_INVALID_CHARS");e=n.punycode(e),r.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));const s=r.minDomainSegments||n.minDomainSegments,o=e.split(".");if(o.length<s)return t.code("DOMAIN_SEGMENTS_COUNT");if(r.maxDomainSegments&&o.length>r.maxDomainSegments)return t.code("DOMAIN_SEGMENTS_COUNT_MAX");const i=r.tlds;if(i){const e=o[o.length-1].toLowerCase();if(i.deny&&i.deny.has(e)||i.allow&&!i.allow.has(e))return t.code("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<o.length;++e){const r=o[e];if(!r.length)return t.code("DOMAIN_EMPTY_SEGMENT");if(r.length>63)return t.code("DOMAIN_LONG_SEGMENT");if(e<o.length-1){if(!n.domainSegmentRx.test(r))return t.code("DOMAIN_INVALID_CHARS")}else if(!n.tldSegmentRx.test(r))return t.code("DOMAIN_INVALID_TLDS_CHARS")}return null},e.isValid=function(t,n){return!e.analyze(t,n)},n.punycode=function(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new n.URL(`http://${e}`).host}catch(t){return e}}}(tz);var rz={};const sz=tz,oz=nz,iz={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(s.TextEncoder||TextEncoder)};rz.analyze=function(e,t){return iz.email(e,t)},rz.isValid=function(e,t){return!iz.email(e,t)},iz.email=function(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return oz.code("EMPTY_STRING");const n=!iz.nonAsciiRx.test(e);if(!n){if(!1===t.allowUnicode)return oz.code("FORBIDDEN_UNICODE");e=e.normalize("NFC")}const r=e.split("@");if(2!==r.length)return r.length>2?oz.code("MULTIPLE_AT_CHAR"):oz.code("MISSING_AT_CHAR");const[s,o]=r;if(!s)return oz.code("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return oz.code("ADDRESS_TOO_LONG");if(iz.encoder.encode(s).length>64)return oz.code("LOCAL_TOO_LONG")}return iz.local(s,n)||sz.analyze(o,t)},iz.local=function(e,t){const n=e.split(".");for(const e of n){if(!e.length)return oz.code("EMPTY_LOCAL_SEGMENT");if(t){if(!iz.atextRx.test(e))return oz.code("INVALID_LOCAL_CHARS")}else for(const t of e){if(iz.atextRx.test(t))continue;const e=iz.binary(t);if(!iz.atomRx.test(e))return oz.code("INVALID_LOCAL_CHARS")}}},iz.binary=function(e){return Array.from(iz.encoder.encode(e)).map(e=>String.fromCharCode(e)).join("")},iz.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,iz.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"));var az={},cz={},uz=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};const lz=JB(),pz=uz,dz={generate:function(){const e={},t="\\dA-Fa-f",n="["+t+"]",r="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",o="%"+t,i=r+o+s+":@",a="["+i+"]",c="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+c+"\\.){3}"+c;const u=n+"{1,4}",l="(?:"+u+":"+u+"|"+e.ipv4address+")",p="(?:"+u+":){6}"+l,d="::(?:"+u+":){5}"+l,h="(?:"+u+")?::(?:"+u+":){4}"+l,m="(?:(?:"+u+":){0,1}"+u+")?::(?:"+u+":){3}"+l,f="(?:(?:"+u+":){0,2}"+u+")?::(?:"+u+":){2}"+l,_="(?:(?:"+u+":){0,3}"+u+")?::"+u+":"+l,g="(?:(?:"+u+":){0,4}"+u+")?::"+l,E="(?:(?:"+u+":){0,5}"+u+")?::"+u,S="(?:(?:"+u+":){0,6}"+u+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+p+"|"+d+"|"+h+"|"+m+"|"+f+"|"+_+"|"+g+"|"+E+"|"+S+")",e.ipvFuture="v"+n+"+\\.["+r+s+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);const y="["+r+o+s+":]*",T="["+r+o+s+"]{1,255}",b="(?:"+("\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]")+"|"+e.ipv4address+"|"+T+")",A="(?:"+y+"@)?"+b+"(?::\\d*)?",R="(?:"+y+"@)?("+b+")(?::\\d*)?",v=a+"*",N=a+"+",C="(?:\\/"+v+")*",O="\\/(?:"+N+C+")?",I=N+C,P="["+r+o+s+"@]+"+C,L="(?:\\/\\/\\/"+v+C+")";return e.hierPart="(?:(?:\\/\\/"+A+C+")|"+O+"|"+I+"|"+L+")",e.hierPartCapture="(?:(?:\\/\\/"+R+C+")|"+O+"|"+I+")",e.relativeRef="(?:(?:\\/\\/"+A+C+")|"+O+"|"+P+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+R+C+")|"+O+"|"+P+"|)",e.query="["+i+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+i+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+i+"\\/\\?]*",e}};dz.rfc3986=dz.generate(),cz.ip={v4Cidr:dz.rfc3986.ipv4Cidr,v6Cidr:dz.rfc3986.ipv6Cidr,ipv4:dz.rfc3986.ipv4address,ipv6:dz.rfc3986.ipv6address,ipvfuture:dz.rfc3986.ipvFuture},dz.createRegex=function(e){const t=dz.rfc3986,n="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",r=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return dz.wrap(r+n);let s="";if(e.scheme){lz(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const n=[].concat(e.scheme);lz(n.length>=1,"scheme must have at least 1 scheme specified");const r=[];for(let e=0;e<n.length;++e){const s=n[e];lz(s instanceof RegExp||"string"==typeof s,"scheme at position "+e+" must be a RegExp or String"),s instanceof RegExp?r.push(s.source.toString()):(lz(t.schemeRegex.test(s),"scheme at position "+e+" must be a valid scheme"),r.push(pz(s)))}s=r.join("|")}const o="(?:"+(s?"(?:"+s+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")",i=e.allowRelative?"(?:"+o+"|"+r+")":o;return dz.wrap(i+n,s)},dz.wrap=function(e,t){return{raw:e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,regex:new RegExp(`^${e}$`),scheme:t}},dz.uriRegex=dz.createRegex({}),cz.regex=function(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?dz.createRegex(e):dz.uriRegex};const hz=JB(),mz=cz;az.regex=function(e={}){hz(void 0===e.cidr||"string"==typeof e.cidr,"options.cidr must be a string");const t=e.cidr?e.cidr.toLowerCase():"optional";hz(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),hz(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let n=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(n)||(n=[n]),hz(n.length>=1,"options.version must have at least 1 version specified");for(let e=0;e<n.length;++e)hz("string"==typeof n[e],"options.version must only contain strings"),n[e]=n[e].toLowerCase(),hz(["ipv4","ipv6","ipvfuture"].includes(n[e]),"options.version contains unknown version "+n[e]+" - must be one of ipv4, ipv6, ipvfuture");n=Array.from(new Set(n));const r=n.map(e=>{if("forbidden"===t)return mz.ip[e];const n=`\\/${"ipv4"===e?mz.ip.v4Cidr:mz.ip.v6Cidr}`;return"required"===t?`${mz.ip[e]}${n}`:`${mz.ip[e]}(?:${n})?`}),s=`(?:${r.join("|")})`,o=new RegExp(`^${s}$`);return{cidr:t,versions:n,regex:o,raw:s}};const fz={tlds:["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AVIANCA","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BENTLEY","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMCAST","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DABUR","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUARDIAN","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYLOGISTICS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LANCASTER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIPSY","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NATURA","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAMERICA","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDSTONE","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHAW","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XFINITY","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"]};var _z,gz,Ez,Sz,yz,Tz,bz,Az,Rz=new Set(fz.tlds.map(e=>e.toLowerCase()));function vz(){if(gz)return _z;gz=1;const e=JB(),t=tz,n=rz,r=az,s=uz,o=Rz,i=cz,a=NJ(),c=MK(),u={tlds:o instanceof Set&&{tlds:{allow:o,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:r.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};return _z=a.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:n,prefs:r}){const s=t.$_getRule("normalize");s&&(e=e.normalize(s.args.form));const o=t.$_getRule("case");o&&(e="upper"===o.args.direction?e.toLocaleUpperCase():e.toLocaleLowerCase());const i=t.$_getRule("trim");if(i&&i.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(const n of t.$_terms.replacements)e=e.replace(n.pattern,n.replacement);const a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!=0&&(e=`0${e}`),t.$_getRule("isoDate")){const t=u.isoDate(e);t&&(e=t)}if(t._flags.truncate){const s=t.$_getRule("max");if(s){let o=s.args.limit;if(c.isResolvable(o)&&(o=o.resolve(e,n,r),!c.limit(o)))return{value:e,errors:t.$_createError("any.ref",o,{ref:s.args.limit,arg:"limit",reason:"must be a positive integer"},n,r)};e=e.slice(0,o)}}return{value:e}}},validate(e,{schema:t,error:n}){if("string"!=typeof e)return{value:e,errors:n("string.base")};if(""===e){const r=t.$_getRule("min");if(r&&0===r.args.limit)return;return{value:e,errors:n("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(t={}){return c.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),e("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(e,t,{options:n})=>u.base64Regex[n.paddingRequired][n.urlSafe].test(e)?e:t.error("string.base64")},case:{method(t){return e(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(e,t,{direction:n})=>"lower"===n&&e===e.toLocaleLowerCase()||"upper"===n&&e===e.toLocaleUpperCase()?e:t.error(`string.${n}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let n=e.length,r=0,s=1;for(;n--;){const t=e.charAt(n)*s;r+=t-9*(t>9),s^=3}return r>0&&r%10==0?e:t.error("string.creditCard")}},dataUri:{method(t={}){return c.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(e,t,{options:n}){const r=e.match(u.dataUriRegex);if(r){if(!r[2])return e;if("base64"!==r[2])return e;if(u.base64Regex[n.paddingRequired].false.test(r[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&c.assertOptions(e,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const t=u.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,n,r,{address:s})=>t.isValid(e,s)?e:n.error("string.domain")},email:{method(t={}){c.assertOptions(t,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),e(void 0===t.multiple||"boolean"==typeof t.multiple,"multiple option must be an boolean");const n=u.addressOptions(t),r=new RegExp(`\\s*[${t.separator?s(t.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:t},regex:r,address:n})},validate(e,t,{options:r},{regex:s,address:o}){const i=r.multiple?e.split(s):[e],a=[];for(const e of i)n.isValid(e,o)||a.push(e);return a.length?t.error("string.email",{value:e,invalids:a}):e}},guid:{alias:"uuid",method(t={}){c.assertOptions(t,["version","separator"]);let n="";if(t.version){const r=[].concat(t.version);e(r.length>=1,"version must have at least 1 valid version specified");const s=new Set;for(let t=0;t<r.length;++t){const o=r[t];e("string"==typeof o,"version at position "+t+" must be a string");const i=u.guidVersions[o.toLowerCase()];e(i,"version at position "+t+" must be one of "+Object.keys(u.guidVersions).join(", ")),e(!s.has(i),"version at position "+t+" must not be a duplicate"),n+=i,s.add(i)}}e(u.guidSeparators.has(t.separator),'separator must be one of true, false, "-", or ":"');const r=void 0===t.separator?"[:-]?":!0===t.separator?"[:-]":!1===t.separator?"[]?":`\\${t.separator}`,s=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}(${r})[0-9A-F]{4}\\2?[${n||"0-9A-F"}][0-9A-F]{3}\\2?[${n?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this.$_addRule({name:"guid",args:{options:t},regex:s})},validate(e,t,n,{regex:r}){const s=r.exec(e);return s?u.guidBrackets[s[1]]!==s[s.length-1]?t.error("string.guid"):e:t.error("string.guid")}},hex:{method(t={}){return c.assertOptions(t,["byteAligned"]),t={byteAligned:!1,...t},e("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:t}})},validate:(e,t,{options:n})=>u.hexRegex.test(e)?n.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,n)=>t.isValid(e,{minDomainSegments:1})||u.ipRegex.test(e)?e:n.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){c.assertOptions(e,["cidr","version"]);const{cidr:t,versions:n,regex:s}=r.regex(e),o=e.version?n:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:o}},regex:s})},validate:(e,t,{options:n},{regex:r})=>r.test(e)?e:n.version?t.error("string.ipVersion",{value:e,cidr:n.cidr,version:n.version}):t.error("string.ip",{value:e,cidr:n.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>u.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>u.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return u.length(this,"length",e,"=",t)},validate(e,t,{limit:n,encoding:r},{name:s,operator:o,args:i}){const a=r?Buffer&&Buffer.byteLength(e,r):e.length;return c.compare(a,n,o)?e:t.error("string."+s,{limit:i.limit,value:e,encoding:r})},args:[{name:"limit",ref:!0,assert:c.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return u.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return u.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(t="NFC"){return e(u.normalizationForms.includes(t),"normalization form must be one of "+u.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(e,{error:t},{form:n})=>e===e.normalize(n)?e:t("string.normalize",{value:e,form:n}),convert:!0},pattern:{alias:"regex",method(t,n={}){e(t instanceof RegExp,"regex must be a RegExp"),e(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof n&&(n={name:n}),c.assertOptions(n,["invert","name"]);const r=["string.pattern",n.invert?".invert":"",n.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:n},errorCode:r})},validate:(e,t,{regex:n,options:r},{errorCode:s})=>n.test(e)^r.invert?e:t.error(s,{name:r.name,regex:n,value:e}),args:["regex","options"],multi:!0},replace:{method(t,n){"string"==typeof t&&(t=new RegExp(s(t),"g")),e(t instanceof RegExp,"pattern must be a RegExp"),e("string"==typeof n,"replacement must be a String");const r=this.clone();return r.$_terms.replacements||(r.$_terms.replacements=[]),r.$_terms.replacements.push({pattern:t,replacement:n}),r}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(e,t,{enabled:n})=>n&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){c.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),e.domain&&c.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:t,scheme:n}=i.regex(e),r=e.domain?u.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:r,scheme:n})},validate(e,n,{options:r},{regex:s,domain:o,scheme:i}){if(["http:/","https:/"].includes(e))return n.error("string.uri");const a=s.exec(e);if(a){const s=a[1]||a[2];return!o||r.allowRelative&&!s||t.isValid(s,o)?e:n.error("string.domain",{value:s})}return r.relativeOnly?n.error("string.uriRelativeOnly"):r.scheme?n.error("string.uriCustomScheme",{scheme:i,value:e}):n.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(const{pattern:n,replacement:r}of t.replacements)e=e.replace(n,r);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),u.addressOptions=function(t){if(!t)return t;if(e(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),e(void 0===t.maxDomainSegments||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds);e("object"==typeof t.tlds,"tlds must be true, false, or an object");const n=t.tlds.deny;if(n)return Array.isArray(n)&&(t=Object.assign({},t,{tlds:{deny:new Set(n)}})),e(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),e(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),u.validateTlds(t.tlds.deny,"tlds.deny"),t;const r=t.tlds.allow;return r?!0===r?(e(u.tlds,"Built-in TLD list disabled"),Object.assign({},t,u.tlds)):(Array.isArray(r)&&(t=Object.assign({},t,{tlds:{allow:new Set(r)}})),e(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),u.validateTlds(t.tlds.allow,"tlds.allow"),t):t},u.validateTlds=function(n,r){for(const s of n)e(t.isValid(s,{minDomainSegments:1,maxDomainSegments:1}),`${r} must contain valid top level domain names`)},u.isoDate=function(e){if(!c.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()},u.length=function(t,n,r,s,o){return e(!o||Buffer&&Buffer.isEncoding(o),"Invalid encoding:",o),t.$_addRule({name:n,method:"length",args:{limit:r,encoding:o},operator:s})},_z}function Nz(){if(Sz)return Ez;Sz=1;const e=JB(),t=NJ(),n={};return n.Map=class extends Map{slice(){return new n.Map(this)}},Ez=t.extend({type:"symbol",terms:{map:{init:new n.Map}},coerce:{method(e,{schema:t,error:n}){const r=t.$_terms.map.get(e);return r&&(e=r),t._flags.only&&"symbol"!=typeof e?{value:e,errors:n("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),e(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const n=this.clone(),r=[];for(const s of t){e(s&&s[Symbol.iterator],"Entry must be an iterable");const[t,o]=s;e("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),e("symbol"==typeof o,"Value must be a Symbol"),n.$_terms.map.set(t,o),r.push(o)}return n.valid(...r)}}},manifest:{build:(e,t)=>(t.map&&(e=e.map(t.map)),e)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}}),Ez}function Cz(){if(Az)return bz;Az=1;const e=JB(),t=iK(),n=xK(),r=MK(),s=DK(),o=AK(),i=HK(),a=WK(),c=PK(),u=LK(),l=JK();let p;const d={types:{alternatives:CJ(),any:NJ(),array:OJ(),boolean:IJ(),date:PJ(),function:zJ(),link:QJ(),number:qJ(),object:ez(),string:vz(),symbol:Nz()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};return Buffer&&(d.types.binary=function(){if(Tz)return yz;Tz=1;const e=JB(),t=NJ(),n=MK();return yz=t.extend({type:"binary",coerce:{from:"string",method(e,{schema:t}){try{return{value:Buffer.from(e,t._flags.encoding)}}catch(e){}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(t){return e(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:s,operator:o,args:i})=>n.compare(e.length,r,o)?e:t.error("binary."+s,{limit:i.limit,value:e}),args:[{name:"limit",ref:!0,assert:n.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to:(e,t)=>e.toString()}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}}),yz}()),d.root=function(){const t={_types:new Set(Object.keys(d.types))};for(const n of t._types)t[n]=function(...t){return e(!t.length||["alternatives","link","object"].includes(n),"The",n,"type does not allow arguments"),d.generate(this,d.types[n],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,d.methods);for(const e in d.aliases){const n=d.aliases[e];t[e]=t[n]}return t.x=t.expression,l.setup&&l.setup(t),t},d.methods={ValidationError:o.ValidationError,version:r.version,cache:n.provider,assert(e,t,...n){d.assert(e,t,!0,n)},attempt:(e,t,...n)=>d.assert(e,t,!1,n),build(t){return e("function"==typeof a.build,"Manifest functionality disabled"),a.build(this,t)},checkPreferences(e){r.checkPreferences(e)},compile(e,t){return s.compile(this,e,t)},defaults(t){e("function"==typeof t,"modifier must be a function");const n=Object.assign({},this);for(const s of n._types){const o=t(n[s]());e(r.isSchema(o),"modifier must return a valid schema object"),n[s]=function(...e){return d.generate(this,o,e)}}return n},expression:(...e)=>new u(...e),extend(...t){r.verifyFlat(t,"extend"),p=p||dK(),e(t.length,"You need to provide at least one extension"),this.assert(t,p.extensions);const n=Object.assign({},this);n._types=new Set(n._types);for(let r of t){"function"==typeof r&&(r=r(n)),this.assert(r,p.extension);const t=d.expandExtension(r,n);for(const r of t){e(void 0===n[r.type]||n._types.has(r.type),"Cannot override name",r.type);const t=r.base||this.any(),s=i.type(t,r);n._types.add(r.type),n[r.type]=function(...e){return d.generate(this,s,e)}}}return n},isError:o.ValidationError.isError,isExpression:u.isTemplate,isRef:c.isRef,isSchema:r.isSchema,in:(...e)=>c.in(...e),override:r.symbols.override,ref:(...e)=>c.create(...e),types(){const e={};for(const t of this._types)e[t]=this[t]();for(const t in d.aliases)e[t]=this[t]();return e}},d.assert=function(e,n,s,i){const a=i[0]instanceof Error||"string"==typeof i[0]?i[0]:null,c=null!==a?i[1]:i[0],u=n.validate(e,r.preferences({errors:{stack:!0}},c||{}));let l=u.error;if(!l)return u.value;if(a instanceof Error)throw a;const p=s&&"function"==typeof l.annotate?l.annotate():l.message;throw l instanceof o.ValidationError==!1&&(l=t(l)),l.message=a?`${a} ${p}`:p,l},d.generate=function(t,n,r){return e(t,"Must be invoked on a Joi instance."),n.$_root=t,n._definition.args&&r.length?n._definition.args(n,...r):n},d.expandExtension=function(e,t){if("string"==typeof e.type)return[e];const n=[];for(const r of t._types)if(e.type.test(r)){const s=Object.assign({},e);s.type=r,s.base=t[r](),n.push(s)}return n},bz=d.root()}var Oz=Zt(Cz());Oz.extend({type:"string",base:Oz.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate:(e,t,{substring:n})=>!1===e.includes(n)?t.error("string.contains",{substring:n}):e},ncontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate:(e,t,{substring:n})=>!0===e.includes(n)?t.error("string.ncontains",{substring:n}):e}}});var Iz=e=>{e.post("/",(e,t)=>{let n=!1;const r=e=>{if(!n)try{n=!0,t.status(e).send()}catch(e){console.error("Failed to send response:",e)}};try{if(!e.body||"object"!=typeof e.body)return console.warn("Log API called with invalid body"),r(400);if(!e.body.message||"string"!=typeof e.body.message)return console.warn("Log API called with invalid message"),r(400);const t=1e4;let n=e.body.message;n.length>t&&(n=n.substring(0,t)+"... [truncated]"),n=n.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");let s=e.body.level;s&&["fatal","error","warning","log","debug","info"].includes(s)||(s="log");try{switch(s){case"fatal":case"error":console.error(n);break;case"warning":console.warn(n);break;case"log":case"info":console.log(n);break;case"debug":console.debug(n)}}catch(e){console.error("Console logging failed:",e)}try{eF&&setImmediate(()=>{try{$A(n,s)}catch(e){console.error("Sentry logging failed:",e)}})}catch(e){console.error("Sentry initialization failed:",e)}r(202)}catch(e){try{const t=`Logging API error: ${e}`;console.error(t),setImmediate(()=>{try{eF&&XA(e)}catch(e){console.error("Failed to log error to Sentry:",e)}})}catch(e){console.error("Failed during error handling:",e)}r(500)}})};module.exports=Iz;
