"use strict";var e=require("crypto");var t=new(require("pdfmake"))({Roboto:{normal:"fonts/Roboto-Regular.ttf",bold:"fonts/Roboto-Medium.ttf",italics:"fonts/Roboto-Italic.ttf",bolditalics:"fonts/Roboto-MediumItalic.ttf"}}),n=require("fs");const a={footer:{fontSize:10,bold:!0,color:"lightgrey"},bigfont:{fontSize:15},midfont:{fontSize:13},smlfont:{fontSize:10},xsmlfont:{fontSize:8},tableExample:{margin:[0,5,0,15],fontSize:8},tableExample2:{margin:[0,5,0,0],fontSize:8},tableHeader:{bold:!0,fontSize:10,color:"black"},sectionHeader:{bold:!0,fontSize:10,color:"black",decoration:"underline"},bigSectionHeader:{margin:[0,12,0,12],bold:!0,fontSize:15,color:"black",decoration:"underline"},bigDocTitleInHeaderWithTop27Padding:{margin:[10,27,0,10],bold:!0,fontSize:15,color:"black",decoration:"underline"},bigDocTitleInHeader:{margin:[10,0,0,10],bold:!0,fontSize:15,color:"black",decoration:"underline"}};function o(a,o,r=null,i=null){var l=t.createPdfKitDocument(a);const s=e.randomUUID(),c=process.env.STORAGE_LOCATIONS||"local";return console.log(`[generatePdf] generated doc ${s} will be stored to ${c}`),"local"===c?(l.pipe(n.createWriteStream(`uploads/${o}.pdf`)),l.end(),Promise.resolve(void 0)):new Promise(((e,t)=>{const n=[];l.on("data",(e=>n.push(e))),l.on("end",(()=>{const t=Buffer.concat(n).toString("base64");console.log(`folder=${i}`);const a={id:s,file:t,filename_disk:`${s}.pdf`,filename_download:`${o}.pdf`,title:null!=r?r:o,type:"application/pdf",storage:"gcs",folder:i,charset:null,filesize:t.length,width:null,height:null,duration:null,embed:null,description:null,location:null,tags:null,metadata:null};e(a)})),l.on("error",t),l.end()}))}function r(e){return"number"==typeof e&&(e=e.toString()),e?e.replace(/\s/g,"_"):"undefined"}function i(e,t=4,n=!0){if(isNaN(e)||null===e)return"-";const a=Math.round(e*Math.pow(10,t))/Math.pow(10,t),[o,r]=a.toString().split("."),i=(null!=o?o:"0").replace(/\B(?=(\d{3})+(?!\d))/g,",");if(!r&&!n)return i;return`${i}.${(null!=r?r:"").padEnd(t,"0")}`}function l(e){return e&&"-"!==e?e.startsWith("-")?`(${e.slice(1)})`:e:"-"}function s(e){return e?`data:image/png;base64,${e}`:null}function c(){const e=new Date,t=60*e.getTimezoneOffset()*1e3,n=e.getTime()-t,a=new Date(n).toISOString().slice(0,19),o=e.getTimezoneOffset()/60*-1;return`${a}GMT${o>0?"+":""}${o}`.replace(/:/g,"")}function d(e){const t=new Date(e),n=60*t.getTimezoneOffset()*1e3,a=t.getTime()-n;return new Date(a).toISOString().slice(0,10)}function g(e){const t=e.signature?0:80;return[e.signature?{image:s(e.signature),fit:[90,80]}:null,{canvas:[{type:"line",x1:0,y1:t,x2:100,y2:t,lineWidth:1}]},`${e.signatoryName}\n${e.signatoryTitle}\n${e.company}`]}function m(e,t){var n,a,o,r,i,l,s,c;if(e.length!==t.length)throw new Error(`[Assay Exchange Doc Builder] number of assays=${e.length} does not match the number of weights=${t.length}`);const d=e.length;let g=0,m=0;for(let u=0;u<d;u++)void 0!==e[u]&&void 0!==(null==(n=e[u])?void 0:n.analyticalAssay)&&void 0!==t[u]&&void 0!==(null==(a=t[u])?void 0:a.dryWeight)?(g+=(null!=(r=null==(o=e[u])?void 0:o.analyticalAssay)?r:0)*(null!=(l=null==(i=t[u])?void 0:i.dryWeight)?l:0),m+=null!=(c=null==(s=t[u])?void 0:s.dryWeight)?c:0):console.error(`[Assay Exchange Doc Builder] assay (${JSON.stringify(e[u])}) or weight (${JSON.stringify(t[u])}) no.${u} is undefined or one of their value is undefined`);return g/m}function u(e,t){var n,a,o,r,l,s,c,d,g;t.sort(((e,t)=>e.lotNumber-t.lotNumber));const u=function(e){const t=e.reduce(((e,t)=>e+t.wetWeight),0),n=e.reduce(((e,t)=>e+t.dryWeight),0);return{totalWetWeight:t,totalDryWeight:n,avgMoisture:(t-n)/t*100}}(t),y=function(e){const t={};for(const n of e)void 0===t[n.commodityCode]&&(t[n.commodityCode]=[]),t[n.commodityCode].push(n);const n=Object.values(t);return n.forEach((e=>e.sort(((e,t)=>e.lotNumber-t.lotNumber)))),n}(e),h=function(e,t){const n=[];for(let a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n}(2,y),p=[];for(const e of h)if(2===e.length){const c=e[0].sort(((e,t)=>e.lotNumber-t.lotNumber)),d=m(c,t),g=e[1].sort(((e,t)=>e.lotNumber-t.lotNumber)),y=m(g,t);p.push({style:"tableExample",table:{headerRows:1,widths:[50,60,30,60,30,60,30,60,60],body:[[{text:"Lot",alignment:"center"},{text:"WMT",alignment:"right"},{text:"UoM",alignment:"left"},{text:"Moisture",alignment:"right"},{text:"UoM",alignment:"left"},{text:"DMT",alignment:"right"},{text:"UoM",alignment:"left"},{text:`${null==(n=c[0])?void 0:n.commodityName} (${null==(a=c[0])?void 0:a.commodityCode} - ${null==(o=c[0])?void 0:o.assayUom})`,alignment:"center"},{text:`${null==(r=g[0])?void 0:r.commodityName} (${null==(l=g[0])?void 0:l.commodityCode} - ${null==(s=g[0])?void 0:s.assayUom})`,alignment:"center"}],...t.map(((e,t)=>{var n,a;return[{text:e.lotNumber,alignment:"center"},{text:i(e.wetWeight),alignment:"right"},e.wetWeightUom,{text:i(e.moisture),alignment:"right"},e.moistureUom,{text:i(e.dryWeight),alignment:"right"},e.dryWeightUom,{text:i(null==(n=c[t])?void 0:n.analyticalAssay),alignment:"center"},{text:i(null==(a=g[t])?void 0:a.analyticalAssay),alignment:"center"}]}))]}}),p.push({style:"tableExample",table:{headerRows:0,widths:[50,60,30,60,30,60,30,60,60],body:[[{text:"Total / Average",alignment:"center"},{text:i(u.totalWetWeight),alignment:"right"},"",{text:i(u.avgMoisture),alignment:"right"},"",{text:i(u.totalDryWeight),alignment:"right"},"",{text:i(d),alignment:"center"},{text:i(y),alignment:"center"}]]},pageBreak:"after"})}else if(1===e.length){const n=e[0].sort(((e,t)=>e.lotNumber-t.lotNumber)),a=m(n,t);p.push({style:"tableExample",table:{headerRows:1,widths:[50,60,30,60,30,60,30,120],body:[[{text:"Lot",alignment:"center"},{text:"WMT",alignment:"right"},{text:"UoM",alignment:"left"},{text:"Moisture",alignment:"right"},{text:"UoM",alignment:"left"},{text:"DMT",alignment:"right"},{text:"UoM",alignment:"left"},{text:`${null==(c=n[0])?void 0:c.commodityName} (${null==(d=n[0])?void 0:d.commodityCode} - ${null==(g=n[0])?void 0:g.assayUom})`,alignment:"center"}],...t.map(((e,t)=>{var a;return[{text:e.lotNumber,alignment:"center"},{text:i(e.wetWeight),alignment:"right"},e.wetWeightUom,{text:i(e.moisture),alignment:"right"},e.moistureUom,{text:i(e.dryWeight),alignment:"right"},e.dryWeightUom,{text:i(null==(a=n[t])?void 0:a.analyticalAssay),alignment:"center"}]}))]}}),p.push({style:"tableExample",table:{headerRows:0,widths:[50,60,30,60,30,60,30,120],body:[[{text:"Total / Average",alignment:"center"},{text:i(u.totalWetWeight),alignment:"right"},"",{text:i(u.avgMoisture),alignment:"right"},"",{text:i(u.totalDryWeight),alignment:"right"},"",{text:i(a),alignment:"center"}]]},pageBreak:"after"})}return p}function y(e){const t=[{text:"Composites",style:"sectionHeader"}];return 0===e.length||t.push({style:"tableExample",table:{headerRows:1,widths:[100,60,100],body:[...e.map((e=>[{text:`${e.commodityName} (${e.commodityCode})`},{text:e.assayUom},{text:i(e.analyticalAssay)}]))]}}),t}require("dotenv").config(),require("dotenv").config();const h="GST Data Missing";function p(e,t,n="USD"){return e&&0!==e.length?e.flatMap((e=>[["",`Payment received: ${e.payment_received_source}`,"",{text:`${n} ${l(e.payment_received)}`,alignment:"right"}],...t?[["",t[e.payment_received_source]?`GST payment received from ${e.payment_received_source}`:h,{text:t[e.payment_received_source]?`${t[e.payment_received_source].local_currency} ${l(t[e.payment_received_source].gst_in_local_currency)}`:"",alignment:"right"},{text:t[e.payment_received_source]?`USD ${l(t[e.payment_received_source].gst_in_usd)}`:"",alignment:"right"}]]:[]])):[]}function x(e){return[{text:"Assays:",style:"sectionHeader"},{style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[...e.map((e=>[e.commodity_name,":",`${i(e.analytical_assay)} ${e.assay_uom}`]))]},layout:"noBorders"}]}function $(e,t,n,a){return[{style:"tableExample",table:{headerRows:1,widths:[52,150,45,45,45,45,45,45,45,45,45,45],body:[["Parcel ID","Parcel Name","Mine","Commodity","Counterparty","Vessel","Invoice",t,"Assay","Element",`Rate (${n})`,`Value (${a})`],..._(e)]}},f(e)]}function _(e){const t=[];return e.forEach((e=>{t.push(...function(e){return e.penalties.map((t=>[e.id,e.name,t.mine,t.commodity_code,t.counterparty,e.vessel,e.invoice_type,i(e.dry_weight,2),i(t.assay),`${t.commodity_code} ${t.assay_uom}`,"0.00"===i(t.penalty_rate,2)?i(t.penalty_rate,6):i(t.penalty_rate,2),i(t.penalty_amount,2)]))}(e))})),t}function f(e){return{style:"tableExample",table:{headerRows:0,widths:["*",45],body:[[{text:"Grand Total",bold:!0},i(e.reduce(((e,t)=>e+t.penalties.reduce(((e,t)=>e+t.penalty_amount),0)),0),2)]]}}}async function b(e){const{folder_id:t,company_logo:n,start_date:l,end_date:g,filter_date:m,parcels:u,wet_weight_uom:y,dry_weight_uom:h}=e.body,p=s(n),x=function(e,t,n,a){const o=function(e){const t=[];e.forEach((e=>{e.assays.forEach((e=>{t.push(e)}))}));const n=t.filter(((e,t,n)=>t===n.findIndex((t=>t.code===e.code)))),a=[];for(let e=0;e<n.length;e+=2)a.push(n.slice(e,e+2));return a}(e),r=function(e){const t=[];e.forEach((e=>{const n={};e.assays.forEach((e=>{n[e.code]=e})),t.push({name:e.name,counterparty:e.counterparty,port:e.port,vessel:e.vessel,phy_status:e.phy_status,fin_status:e.fin_status,shipment_date:e.shipment_date,weight_source:e.weight_source,wet_weight:e.wet_weight,dry_weight:e.dry_weight,moisture:e.moisture,assay_source:e.assay_source,assays:n})}));const n=[];return t.forEach((e=>{if(n.includes(e.name)){let t=1;for(;n.includes(`${e.name} (${t})`);)t++;n.push(`${e.name} (${t})`),e.name=`${e.name} (${t})`}else n.push(e.name)})),t}(e),l=function(e){const t=e.reduce(((e,t)=>e+t.wet_weight),0),n=e.reduce(((e,t)=>e+t.dry_weight),0);return{totalWetWeight:t,totalMoisture:(t-n)/t*100,totalDryWeight:n}}(e),s=function(e){const t={};return e.forEach((e=>{e.assays.forEach((e=>{t[e.code]?t[e.code]+=e.contained_metal:t[e.code]=e.contained_metal}))})),t}(e),c=[],d=o.length;return o.forEach(((e,o)=>{var g,m,u,y,h,p,x,$,_,f,b,v,E,W,D;2===e.length?(c.push({style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[["Filter Date",":",t]]},layout:"noBorders"}),c.push({style:"tableExample",table:{headerRows:2,widths:[43,46,46,46,37,37,37,37,37,37,37,37,37,37,37,37],body:[[{text:"Parcel",rowSpan:2,alignment:"center"},{text:"Counterparty",rowSpan:2,alignment:"center"},{text:"Port",rowSpan:2,alignment:"center"},{text:"Vessel",rowSpan:2,alignment:"center"},{text:"Status",colSpan:2,alignment:"center"},"",{text:"Shipment Date",rowSpan:2,alignment:"center"},{text:"Weight Source",rowSpan:2,alignment:"center"},{text:n,rowSpan:2,alignment:"center"},{text:"Moist",rowSpan:2,alignment:"center"},{text:a,rowSpan:2,alignment:"center"},{text:"Assay Source",rowSpan:2,alignment:"center"},{text:`${null==(g=e[0])?void 0:g.commodity} (${null==(m=e[0])?void 0:m.code})`,colSpan:2,alignment:"center"},"",{text:`${null==(u=e[1])?void 0:u.commodity} (${null==(y=e[1])?void 0:y.code})`,colSpan:2,alignment:"center"},""],["","","","","Physical","Financial","","","","","","",`Assay (${null==(h=e[0])?void 0:h.assay_uom})`,`Assay (${null==(p=e[0])?void 0:p.contained_metal_uom})`,`Assay (${null==(x=e[1])?void 0:x.assay_uom})`,`Assay (${null==($=e[1])?void 0:$.contained_metal_uom})`],...w(r,e)]}}),c.push({style:"tableExample",table:{headerRows:0,widths:["*",37,37,37,37,37,37,37,37],body:[[{text:"Grand Total",bold:!0},i(l.totalWetWeight,3),i(l.totalMoisture,3),i(l.totalDryWeight,3),"","",{text:i(S(s,null==(_=e[0])?void 0:_.code)),bold:!0,alignment:"right"},"",{text:i(S(s,null==(f=e[1])?void 0:f.code)),bold:!0,alignment:"right"}]]},pageBreak:d===o+1?void 0:"after"})):1===e.length&&(c.push({style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[["Filter Date",":",t]]},layout:"noBorders"}),c.push({style:"tableExample",table:{headerRows:2,widths:[43,46,46,46,37,37,37,37,37,37,37,37,37,37,37,37],body:[[{text:"Parcel",rowSpan:2,alignment:"center"},{text:"Counterparty",rowSpan:2,alignment:"center"},{text:"Port",rowSpan:2,alignment:"center"},{text:"Vessel",rowSpan:2,alignment:"center"},{text:"Status",colSpan:2,alignment:"center"},"",{text:"Shipment Date",rowSpan:2,alignment:"center"},{text:"Weight Source",rowSpan:2,alignment:"center"},{text:n,rowSpan:2,alignment:"center"},{text:"Moist",rowSpan:2,alignment:"center"},{text:a,rowSpan:2,alignment:"center"},{text:"Assay Source",rowSpan:2,alignment:"center"},{text:`${null==(b=e[0])?void 0:b.commodity} (${null==(v=e[0])?void 0:v.code})`,colSpan:4,alignment:"center"},"","",""],["","","","","Physical","Financial","","","","","","",{text:`Assay (${null==(E=e[0])?void 0:E.assay_uom})`,colSpan:2,alignment:"center"},"",{text:`Assay (${null==(W=e[0])?void 0:W.contained_metal_uom})`,colSpan:2,alignment:"center"},""],...w(r,e)]}}),c.push({style:"tableExample",table:{headerRows:0,widths:["*",37,37,37,37,37,37,37,37],body:[[{text:"Grand Total",bold:!0},i(l.totalWetWeight,3),i(l.totalMoisture,3),i(l.totalDryWeight,3),"",{text:"",colSpan:2},"",{text:i(S(s,null==(D=e[0])?void 0:D.code)),colSpan:2,bold:!0,alignment:"right"},""]]},pageBreak:d===o+1?void 0:"after"}))})),c}(u,m,y,h);var $={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,120,40,60],info:{title:"Shipment Latest",author:"Navarch Technologies",subject:"Shipment Latest",keywords:`shipment-latest-${r(l)}-${r(g)}`},header:function(e,t,n){return{margin:[40,60,40,0],stack:[{columns:[{text:"",width:"25%",alignment:"right"},{width:"50%",stack:[{text:"Shipment Latest",style:"bigDocTitleInHeader",alignment:"center",bold:!0},{text:`From ${l} to ${g}`,alignment:"center",italics:!0}]},{[p?"image":"text"]:null!=p?p:"",fit:[70,70],width:"25%",alignment:"right"}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],columns:[{text:`Shipment Latest - with Metals\nFrom ${l} to ${g}`,style:"xsmlfont",alignment:"left"},{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}},content:[...x],styles:a};const _=d(l),f=d(l),b=`ShipmentLatest-[${c()}]-${_}-${f}`,v=`Shipment Latest - ${m} (${l} ~ ${g})`;return await o($,b,v,null!=t?t:null)}function w(e,t){return e.map((e=>{var n,a,o,r,l,s;return 2===t.length?[e.name,e.counterparty,e.port,e.vessel,e.phy_status,e.fin_status,e.shipment_date,e.weight_source,i(e.wet_weight,3),i(e.moisture,2),i(e.dry_weight,3),e.assay_source,i(v(e,null==(n=t[0])?void 0:n.code,"assay")),i(v(e,null==(a=t[0])?void 0:a.code,"contained_metal")),i(v(e,null==(o=t[1])?void 0:o.code,"assay")),i(v(e,null==(r=t[1])?void 0:r.code,"contained_metal"))]:1===t.length?[e.name,e.counterparty,e.port,e.vessel,e.phy_status,e.fin_status,e.shipment_date,e.weight_source,i(e.wet_weight,3),i(e.moisture,2),i(e.dry_weight,3),e.assay_source,{text:i(v(e,null==(l=t[0])?void 0:l.code,"assay")),colSpan:2},"",{text:i(v(e,null==(s=t[0])?void 0:s.code,"contained_metal")),colSpan:2},""]:[]}))}function v(e,t,n){if(t){const a=e.assays[t];if(a)return a[n]}return"-"}function S(e,t){if(!t)return"";const n=e[t];return n||""}async function E(e){const{folder_id:t,company_logo:n,start_date:i,end_date:l,metal:g,assay_uom:m,parcels:u,dry_weight_uom:y,dry_weight_uom_name:h}=e.body,p=s(n),x=function(e,t,n,a,o){const r=W(e.map((e=>e.dry_weight))),i=W(e.map((e=>e.grade))),l=W(e.map((e=>e.metal)),1);return[{style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[["Metal",":",`${t} (${n})`]]},layout:"noBorders"},{style:"tableExample",table:{headerRows:2,widths:[25,40,40,40,33,30,30,30,30,30,30,30,30,30,30,30,30,25,25],body:[[{text:"Parcel ID",rowSpan:2,alignment:"center"},{text:"Parcel",rowSpan:2,alignment:"center"},{text:"Vessel",rowSpan:2,alignment:"center"},{text:"Port",rowSpan:2,alignment:"center"},{text:"Shipment",rowSpan:2,alignment:"center"},{text:`${o} (${a})`,colSpan:4,alignment:"center"},"","","",{text:"Grade",colSpan:4,alignment:"center"},"","","",{text:"Metal",colSpan:6,alignment:"center"},"","","","",""],["","","","","","Loadport","Disport","Variance","Variance %","Loadport","Disport","Variance","Variance %","Loadport","Disport","Variance","Variance %","Unit","Gain/Loss"],...D(e)]}},{style:"tableExample",table:{headerRows:0,widths:["*",30,30,30,30,30,30,30,30,30,30,30,30,50],body:[[{text:"Grand Total",bold:!0},r.loadport,r.disport,r.variance,r.variance_percent,i.loadport,i.disport,i.variance,i.variance_percent,l.loadport,l.disport,l.variance,l.variance_percent,""]]}}]}(u,g,m,y,h);var $={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,120,40,60],info:{title:"Loadport - Disport Comparison - Grouped",author:"Navarch Technologies",subject:"Loadport - Disport Comparison - Grouped",keywords:`Loadport-Disport-Comparison-Grouped-${r(i)}-${r(l)}`},header:function(e,t,n){return{margin:[40,60,40,0],stack:[{columns:[{text:"",width:"25%",alignment:"right"},{width:"50%",stack:[{text:"Loadport - Disport Comparison - Grouped",style:"bigDocTitleInHeader",alignment:"center",bold:!0},{text:`From ${i} to ${l}`,alignment:"center",italics:!0}]},{[p?"image":"text"]:null!=p?p:"",fit:[70,70],width:"25%",alignment:"right"}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],columns:[{text:`Loadport - Disport Comparison - Grouped\nFrom ${i} to ${l}`,style:"xsmlfont",alignment:"left"},{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}},content:[...x],styles:a};const _=d(i),f=d(i),b=`LoadportDisportCompare-[${c()}]-Comparison_Period-${_}~${f}`,w=`Loadport-Disport Comparison (${_} ~ ${f})`;return await o($,b,w,null!=t?t:null)}function W(e,t=2){const n=e.reduce(((e,t)=>e+t.loadport),0),a=e.reduce(((e,t)=>e+t.disport),0),o=a-n,r=o/n*100;return{loadport:i(n,t),disport:i(a,t),variance:i(o,t),variance_percent:i(r,t)}}function D(e){return e.map((e=>[e.id,e.name,e.vessel,e.port,e.shipment_date,i(e.dry_weight.loadport,2),i(e.dry_weight.disport,2),i(e.dry_weight.variance,2),i(e.dry_weight.variance_percent,2),i(e.grade.loadport,2),i(e.grade.disport,2),i(e.grade.variance,2),i(e.grade.variance_percent,2),i(e.metal.loadport,2),i(e.metal.disport,2),i(e.metal.variance,2),i(e.metal.variance_percent,2),e.metal_uom,e.gain_loss]))}var P=e=>{e.post("/assay-exchange",((e,t)=>{(async function(e){const{folder_id:t,company_logo:n,seller:i,seller_address:l,seller_phone_number:d,buyer:m,parcel_ref:h,contract_ref:p,vessel:x,bl_date:$,port_of_loading:_,port_of_discharge:f,assays:b,composite_assays:w,weights:v,signatory:S}=e.body,E=s(n);var W={pageSize:"A4",pageMargins:[40,260,40,60],info:{title:`${i}`,author:"Navarch Technologies",subject:`Assay Exchange Certificate (${h})`,keywords:`${r(h)}-assay-exchange-cert`},header:function(e,t,n){return{margin:[40,60,40,0],stack:[{columns:[{width:"25%",stack:[{text:`${i}\n`,style:i&&i.length<=20?"midfont":"smlfont",bold:!0},{text:`${l}\n\n`,style:"xsmlfont"},{text:`${d}\n\n\n`,style:"xsmlfont"}]},{width:"50%",text:"Assay Exchange Certificate",style:"bigDocTitleInHeaderWithTop27Padding",alignment:"center"},E?{image:E,fit:[70,70],width:"25%",alignment:"right"}:null]},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Buyer Information",style:"tableHeader",decoration:"underline",colSpan:3},"","",{text:"Shipment Information",style:"tableHeader",decoration:"underline",alignment:"right"}],["Buyer:",{text:`${m}`,bold:!0},"Vessel:",{text:`${x}`,alignment:"right"}],["Seller Contract:",`${p}`,"Port of Loading:",{text:`${_}`,alignment:"right"}],["Parcel:",`${h}`,"B/L Date:",{text:`${$}`,alignment:"right"}],["","","Port of Discharge:",{text:`${f}`,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],stack:[{canvas:[{type:"line",x1:0,y1:0,x2:522,y2:0,lineWidth:1}]}," ",{columns:[" ",{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}]}},content:[...u(b,v),...y(w),...g(S)],styles:a};const D=`AssayExchangeCertificate-[${c()}]-${r(h)}`,P=`Assay Exchange Certificate (Parcel #${h})`;return await o(W,D,P,null!=t?t:null)})(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Assay Exchange Certificate document. Error=${e}`)}))})),e.post("/cert-of-origin",((e,t)=>{(async function(e){const{folder_id:t,parcel_id:n,company_logo:l,seller:d,seller_address:m,seller_phone_number:u,buyer:y,contract_ref:h,vessel:p,bl_date:x,port_of_loading:$,port_of_discharge:_,wet_weight:f,wet_weight_uom:b,country_of_origin:w,commodity_name:v,other_comments:S,signatory:E}=e.body,W=s(l);var D={pageSize:"A4",pageMargins:[40,260,40,60],info:{title:`${d}`,author:"Navarch Technologies",subject:`Certificate of Origin for Parcel ${n}`,keywords:`cert-of-origin-${r(v)}`},header:function(e,t,n){return{margin:[40,60,40,0],stack:[{columns:[{width:"25%",stack:[{text:`${d}\n`,style:d&&d.length<=20?"midfont":"smlfont",bold:!0},{text:`${m}\n\n`,style:"xsmlfont"},{text:`${u}\n\n\n`,style:"xsmlfont"}]},{width:"50%",text:"Certificate of Origin",style:"bigDocTitleInHeaderWithTop27Padding",alignment:"center"},W?{image:W,fit:[70,70],width:"25%",alignment:"right"}:null]},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Buyer Information",style:"tableHeader",decoration:"underline",colSpan:3},"","",{text:"Shipment Information",style:"tableHeader",decoration:"underline",alignment:"right"}],["Buyer:",{text:`${y}`,bold:!0},"Vessel:",{text:`${p}`,alignment:"right"}],["Contract Reference:",`${h}`,"Port of Loading:",{text:`${$}`,alignment:"right"}],["Commodity:",""===v?"No primary commodity":`${v} Concentrates`,"B/L Date:",{text:`${x}`,alignment:"right"}],["","","Port of Discharge:",{text:`${_}`,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],stack:[{canvas:[{type:"line",x1:0,y1:0,x2:522,y2:0,lineWidth:1}]}," ",{columns:[" ",{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}]}},content:[{text:"Certificate of Origin",style:"bigSectionHeader",alignment:"center"},{style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[[{text:"Material"},":",{text:`${i(f)} ${b}`+(""===v?"":` of ${v} Concentrates`)}],[{text:"Country of Origin"},":",w],[{text:"Other Comments"},":",S]]},layout:"noBorders"},...g(E)],styles:a};const P=`CertificateOfOrigin-[${c()}]-Parcel#${r(n)}-Contract#${r(h)}`,A=`Certificate of Origin (Parcel #${n})`;return await o(D,P,A,null!=t?t:null)})(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Certificate of Origin document. Error=${e}`)}))})),e.post("/loadport-disport-compare",((e,t)=>{E(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Loadport - Disport Comparison document. Error=${e}`)}))})),e.post("/shipment-latest",((e,t)=>{b(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Shipment Latest document. Error=${e}`)}))})),e.post("/penalty-elements",((e,t)=>{(async function(e){const{folder_id:t,company_logo:n,start_date:i,end_date:l,filter_date:d,invoice_type:g,parcels:m,dry_weight_uom:u,penalty_rate_uom:y,currency:h}=e.body,p=s(n);var x={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,120,40,60],info:{title:"Penalty Elements",author:"Navarch Technologies",subject:"Penalty Elements",keywords:`penalty-elments-${r(i)}-${r(l)}`},header:function(e,t,n){return{margin:[40,50,40,0],stack:[{columns:[{text:"",width:"25%",alignment:"right"},{width:"50%",stack:[{text:"Penalty Elements",style:"bigDocTitleInHeader",alignment:"center",bold:!0},{text:`From ${i} to ${l}`,alignment:"center",italics:!0}]},{[p?"image":"text"]:null!=p?p:"",fit:[70,70],width:"25%",alignment:"right"}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],stack:[{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0,lineWidth:1}]}," ",{columns:[{text:`Penalty Elements\nFrom ${i} to ${l}`,style:"xsmlfont",alignment:"left"},{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}]}},content:[{style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[["Filter Date",":",d],["Invoice Type",":",g]]},layout:"noBorders"},...$(m,u,y,h)],styles:a};const _=`PenaltyElements-[${c()}]-${r(i)}-${r(l)}`,f=`Penalty Elements (${i} ~ ${l})`;return await o(x,_,f,null!=t?t:null)})(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Penalty Element document. Error=${e}`)}))})),e.post("/weight-and-assay-cert",((e,t)=>{(async function(e){const{folder_id:t,invoice_type:n,company_logo:l,seller:d,seller_address:m,seller_phone_number:u,buyer:y,contract_ref:h,vessel:p,bl_date:$,commodity_name:_,port_of_loading:f,port_of_discharge:b,wet_weight:w,wet_weight_uom:v,dry_weight:S,dry_weight_uom:E,moisture:W,moisture_uom:D,assays:P,signatory:A}=e.body,T=s(l);var C={pageSize:"A4",pageMargins:[40,260,40,60],info:{title:`${d}`,author:"Navarch Technologies",subject:`${n} Weight and Assay Certificate`,keywords:`${n}-weight-and-assay-cert-${r(h)}`},header:function(e,t,a){return{margin:[40,60,40,0],stack:[{columns:[{width:"25%",stack:[{text:`${d}\n`,style:d&&d.length<=20?"midfont":"smlfont",bold:!0},{text:`${m}\n\n`,style:"xsmlfont"},{text:`${u}\n\n\n`,style:"xsmlfont"}]},{width:"50%",text:`${n} Weight & Assay Certificate`,style:"bigDocTitleInHeaderWithTop27Padding",alignment:"center"},T?{image:T,fit:[70,70],width:"25%",alignment:"right"}:null]},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Buyer Information",style:"tableHeader",decoration:"underline",colSpan:3},"","",{text:"Shipment Information",style:"tableHeader",decoration:"underline",alignment:"right"}],["Buyer:",{text:`${y}`,bold:!0},"Vessel:",{text:`${p}`,alignment:"right"}],["Contract Reference:",`${h}`,"Port of Loading:",{text:`${f}`,alignment:"right"}],["Commodity:",`${_} Concentrates`,"B/L Date:",{text:`${$}`,alignment:"right"}],["","","Port of Discharge:",{text:`${b}`,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],stack:[{canvas:[{type:"line",x1:0,y1:0,x2:522,y2:0,lineWidth:1}]}," ",{columns:[" ",{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}]}},content:[{text:"We hereby certify the following provisional weights and assays for the above mentioned shipment.",alignment:"center",margin:[0,12,0,12]},{text:"Weights:",style:"sectionHeader"},{style:"tableExample",table:{headerRows:0,widths:[100,10,"*"],body:[[{text:"Wet Weight"},":",`${i(w)} ${v}`],[{text:"Moisture"},":",`${i(W)} ${D}`],[{text:"Dry Weight"},":",`${i(S)} ${E}`]]},layout:"noBorders"},...x(P),...g(A)],styles:a};const B=`WeightAndAssayCert-[${c()}]-${n}-${r(h)}`,M=`Weight & Assay Certificate (Invoice #${n})`;return await o(C,B,M,null!=t?t:null)})(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Provisional/Final Weight And Assay Certificate document. Error=${e}`)}))})),e.post("/invoice",((e,t)=>{(async function(e){const{folder_id:t,seller:n,seller_address:i,seller_phone_number:d,company_logo:m,buyer:u,buyer_address:y,shipment_code:x,vessel:$,bl_date:_,invoice_type:f,invoice_date:b,revision:w,invoice_number:v,parcel:S,port_of_loading:E,port_of_discharge:W,primary_commodity:D,due_date:P,wet_weight:A,wet_weight_uom:T,wet_weight_uom_name:C,moisture:B,moisture_uom:M,dry_weight:N,dry_weight_uom:R,dry_weight_uom_name:I,total_revenue:k,total_deductions:L,currency:H,commodities:U,penalties:V,adjustments:O,invoice_value:z,payable_percentage:G,payable_amount:j,payments_received:F,gst:q,balance_of_gst_payable:J,balance_in_sellers_favor:Q,signatory:K,remittance:X}=e.body,Y=function(e,t,n,a="USD"){var o=[];for(const r of e)o.push({style:"tableExample2",table:{widths:[70,120,"*",70],body:[[{text:`${r.commodity}:`,style:"tableHeader"},"","",""],[{text:`${r.analytical_assay}${r.assay_uom}`,alignment:"right"},`${r.commodity} Analytical Assay`,"",""],[{text:`${r.payable_assay}${r.assay_uom}`,alignment:"right"},`${r.commodity} Payable Assay`,`${r.deduction_expression}`,""],[{text:`${r.payable_metal} ${r.payable_metal_uom}`,alignment:"right"},`${r.commodity} Payable Metal`,`${r.payable_metal_expression}`,""],[{text:`${r.qp}`,alignment:"right"},`${r.commodity} QP Month`,"",""],[{text:`${a} ${r.price_rate}/${r.price_per_uom}`,alignment:"right"},{text:`${r.commodity} Price: ${r.qp_start_date} - ${r.qp_end_date} - ${r.price_method}`,colSpan:2},"",""],["",`${r.commodity} Payable Value`,`${r.payable_metal} ${r.payable_metal_uom} * ${a} ${r.price_rate}/${r.price_per_uom}`,{text:`${a} ${r.price}`,alignment:"right",bold:!0}],...r.treatment_charge?r.treatment_charge.rate===r.treatment_charge.final_rate?[["","Treatment Charge",`${t} ${n} * ${a} ${r.treatment_charge.final_rate}/${r.treatment_charge.per_uom}`,{text:`${a} (${r.treatment_charge.final_amount})`,alignment:"right",bold:!0}]]:[[{text:`${a} ${r.treatment_charge.discount}/${r.treatment_charge.per_uom}`,alignment:"right"},"Treatment Charge Discount","",""],[{text:`${a} ${r.treatment_charge.final_rate}/${r.treatment_charge.per_uom}`,alignment:"right"},`${r.commodity} Treatment Charge Rate`,`${a} ${r.treatment_charge.rate}/${r.treatment_charge.per_uom}${void 0===r.treatment_charge.discount||0===r.treatment_charge.discount?"":` - ${a} ${r.treatment_charge.discount}/${r.treatment_charge.per_uom}`}`,""],["","Treatment Charge",`${t} ${n} * ${a} ${r.treatment_charge.final_rate}/${r.treatment_charge.per_uom}`,{text:`${a} (${r.treatment_charge.final_amount})`,alignment:"right",bold:!0}]]:[],...r.refining_charge?r.refining_charge.rate===r.refining_charge.final_rate?[["","Refining Charge",`${t} ${n} * ${a} ${r.refining_charge.final_rate}/${r.refining_charge.per_uom}`,{text:`${a} (${r.refining_charge.final_amount})`,alignment:"right",bold:!0}]]:[[{text:`${a} ${r.refining_charge.discount}/${r.refining_charge.per_uom}`,alignment:"right"},"Refining Charge Discount","",""],[{text:`${a} ${r.refining_charge.final_rate}/${r.refining_charge.per_uom}`,alignment:"right"},`${r.commodity} Refining Charge Rate`,`${a} ${r.refining_charge.rate}/${r.refining_charge.per_uom}${void 0===r.refining_charge.discount||0===r.refining_charge.discount?"":` - ${a} ${r.refining_charge.discount}/${r.refining_charge.per_uom}`}`,""],["","Refining Charge",`${t} ${n} * ${a} ${r.refining_charge.final_rate}/${r.refining_charge.per_uom}`,{text:`${a} (${r.refining_charge.final_amount})`,alignment:"right",bold:!0}]]:[]]},layout:"noBorders"}),o.push({canvas:[{type:"line",x1:442,y1:5,x2:522,y2:5,lineWidth:1}]}),o.push({style:"tableExample2",table:{widths:[70,120,"*",70],body:[["","",{text:`Total ${r.commodity}:`,alignment:"right",bold:!0},{text:`${a} ${r.final_total}`,alignment:"right",bold:!0}]]},layout:"noBorders"}),o.push({canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]});return o}(U,N,R,H),Z=function(e,t,n,a="USD"){const o=[];if(0===e.penalties.length)return[];const r=[];return o.push({style:"tableExample2",table:{widths:[70,120,"*",70],body:[[{text:"Penalties:",style:"tableHeader"},"","",""],...r.concat(...e.penalties.map((e=>"No penalty"===e.deduction_expression?[[{text:`${e.analytical_assay}${e.assay_uom}`,alignment:"right"},`${e.commodity} Analytical Assay`,"",""]]:[[{text:`${e.analytical_assay}${e.assay_uom}`,alignment:"right"},`${e.commodity} Analytical Assay`,"",""],[{text:`${a} ${e.final_penalty_rate}/${e.penalty_per_uom}`,alignment:"right"},`${e.commodity} Penalty`,`${e.deduction_expression}`,""],["",`${e.commodity} Penalty`,`${t} ${n} * ${a} ${e.final_penalty_rate}/${e.penalty_per_uom}`,{text:`${a} (${e.final_penalty})`,alignment:"right",bold:!0}]])))]},layout:"noBorders"}),o.push({canvas:[{type:"line",x1:442,y1:5,x2:522,y2:5,lineWidth:1}]}),o.push({style:"tableExample2",table:{widths:[70,160,"*",70],body:[["","",{text:"Total Penalties:",alignment:"right",bold:!0},{text:`${a} (${e.total_penalties})`,alignment:"right",bold:!0}]]},layout:"noBorders"}),o.push({canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]}),o}(V,N,R,H),ee=function(e,t="USD"){if(!e||0===e.adjustments.length)return[];const n=[];return n.push({style:"tableExample2",table:{widths:[70,120,"*",70],body:[[{text:"Adjustments:",style:"tableHeader"},"","",""],...e.adjustments.map((e=>["",`${e.description} :`,"",{text:`${t} ${e.amount}`,alignment:"right",bold:!0}]))]},layout:"noBorders"}),n.push({canvas:[{type:"line",x1:442,y1:5,x2:522,y2:5,lineWidth:1}]}),n.push({style:"tableExample2",table:{widths:[70,160,"*",70],body:[["","",{text:"Total Adjustments:",alignment:"right",bold:!0},{text:`${t} ${e.total_adjustments}`,alignment:"right",bold:!0}]]},layout:"noBorders"}),n.push({canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]}),n}(O,H),te=function(e,t="USD"){const n=[];for(const t of e)n.push(["",`${t.commodity} Analytical Assay`,"",{text:`${t.analytical_assay}${t.assay_uom}`,alignment:"right"}]);for(const a of e)n.push(["",{text:`${a.commodity} Price: ${a.qp_start_date} - ${a.qp_end_date} - ${a.price_method}`,colSpan:2},"",{text:`${t} ${a.price_rate}/${a.price_per_uom}`,alignment:"right"}]);for(const t of e)n.push(["",`${t.commodity} QP Month : (To Be Declared)`,"",{text:`${t.qp}`,alignment:"right"}]);return n}(U,H),ne=s(m);var ae={pageSize:"A4",pageMargins:[40,380,40,60],info:{title:`${n}`,author:"Navarch Technologies",subject:`Invoice ${v}`,keywords:`${r(v)}`},header:function(e,t,a){return{margin:[40,60,40,0],stack:[{columns:[{width:"25%",stack:[{text:`${n}\n`,style:n&&n.length<=20?"midfont":"smlfont",bold:!0},{text:`${i}\n\n`,style:"xsmlfont"},{text:`${d}\n\n\n`,style:"xsmlfont"}]},,{width:"50%",text:"",alignment:"center"},ne?{image:ne,fit:[70,70],width:"25%",alignment:"right"}:null]},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Buyer Information",style:"tableHeader",decoration:"underline",colSpan:3},"","",{text:"Shipment Information",style:"tableHeader",decoration:"underline",alignment:"right"}],[{text:`${u}`,bold:!0,colSpan:2},"","Shipment:",{text:`${x}`,alignment:"right"}],[{text:`${y}`,rowSpan:2},"","Vessel:",{text:`${$}`,alignment:"right"}],["","","B/L Date:",{text:`${_}`,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Invoice",style:"tableHeader"},{text:`${f}`,style:"tableHeader"},"Port of Loading:",{text:`${E}`,alignment:"right"}],["Invoice Date:",`${b}`,"Port of Discharge:",{text:`${W}`,alignment:"right"}],["Revision:",`${null!=w?w:"-"}`,"Commodity:",{text:`${D}`,alignment:"right"}],["Invoice Number:",`${v}`,"",""],["Parcel:",`${S}`,"",""]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]}]}},footer:function(e,t,n){return{margin:[40,0,40,0],stack:[{canvas:[{type:"line",x1:0,y1:0,x2:522,y2:0,lineWidth:1}]}," ",{columns:[" ",{text:"Page "+e.toString()+" of "+t.toString(),alignment:"center"},{text:"by Navarch Technologies",alignment:"right",style:"footer"}]}]}},content:[{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Summary:",style:"tableHeader"},"","",""],["",`${C} `,"",{text:`${A} ${T}`,alignment:"right"}],["","Moisture","",{text:`${B}${M}`,alignment:"right"}],["",`${I} `,"",{text:`${N} ${R}`,alignment:"right"}],...te,["","Total Revenue","",{text:`${H} ${k}`,alignment:"right"}],["","Total Deductions","",{text:`${H} ${L}`,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]},{style:"tableExample2",table:{widths:[90,220,"*",100],body:[[{text:"Totals:",style:"tableHeader"},"","",""],["","Invoice Value","",{text:`${H} ${l(z)}`,alignment:"right"}],["",`Payable Value @ ${G}% of Invoice Value`,"",{text:`${H} ${l(j)}`,alignment:"right"}],...q?[["",q.current?`GST @ 100 % of Parcel Value (${q.current.local_currency}/USD: ${q.current.conversion_rate_to_usd})`:h,{text:q.current?`${q.current.local_currency} ${l(q.current.gst_in_local_currency)}`:"",alignment:"right"},{text:q.current?`USD ${l(q.current.gst_in_usd)}`:"",alignment:"right"}]]:[],...p(F,q,H),...J?[["","Balance of GST Payable",{text:`${J.local_currency} ${l(J.gst_in_local_currency)}`,alignment:"right"},{text:`USD ${l(J.gst_in_usd)}`,alignment:"right"}]]:[]]},layout:"noBorders"},{canvas:[{type:"line",x1:442,y1:5,x2:522,y2:5,lineWidth:1}]},{style:"tableExample2",table:{widths:[90,220,"*",100],body:[["",{text:"BALANCE IN SELLERS FAVOUR",bold:!0,colSpan:2,alignment:"right"},"",{text:`${H} ${l(Q)}`,bold:!0,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[[{text:"Payment Advice:",style:"tableHeader"},`Due ${P}`,"",""],["",`When remitting please quote: ${v}`,"",""]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},{style:"tableExample",table:{widths:[90,220,"*",100],body:[["",{text:"Please remit to",decoration:"underline"},"",""],["",X,"",""]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:2}]},...g(K),{text:"",pageBreak:"after"},{style:"tableExample2",table:{widths:[70,220,"*",100],body:[[{text:"Weights:",style:"tableHeader"},"","",""],[{text:`${A} ${T}`,alignment:"right"},`${C} `,"",""],[{text:`${B}${M}`,alignment:"right"},"Moisture","",""],[{text:`${N} ${R}`,alignment:"right"},`${I} `,"",""]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]},...Y,...Z,...ee,{style:"tableExample2",table:{widths:[70,160,"*",70],body:[[{text:"Totals:",style:"tableHeader"},"","",""],["","Invoice Value","",{text:`${H} ${l(z)}`,alignment:"right",bold:!0}],["",`Payable Value @ ${G}% of Invoice Value`,"",{text:`${H} ${l(j)}`,alignment:"right",bold:!0}],...q?[["",q.current?`GST @ 100 % of Parcel Value (${q.current.local_currency}/USD: ${q.current.conversion_rate_to_usd})`:h,{text:q.current?`${q.current.local_currency} ${l(q.current.gst_in_local_currency)}`:"",alignment:"right"},{text:q.current?`USD ${l(q.current.gst_in_usd)}`:"",alignment:"right"}]]:[],...p(F,q,H)]},layout:"noBorders"},{canvas:[{type:"line",x1:442,y1:5,x2:522,y2:5,lineWidth:1}]},{style:"tableExample2",table:{widths:[70,160,"*",70],body:[["",{text:"BALANCE IN SELLERS FAVOUR",bold:!0,colSpan:2,alignment:"right"},"",{text:`${H} ${l(Q)}`,bold:!0,alignment:"right"}]]},layout:"noBorders"},{canvas:[{type:"line",x1:0,y1:10,x2:522,y2:10,lineWidth:1}]}],styles:a};const oe=r(`Invoice-[${c()}]-${v}-${f}`),re=`${f} Invoice - ${v}`;return await o(ae,oe,re,null!=t?t:null)})(e).then((e=>{t.send(e)})).catch((e=>{console.error(e),t.status(400).send(`An error occurred while generating the Invoice document. Error=${e}`)}))}))};module.exports=P;
