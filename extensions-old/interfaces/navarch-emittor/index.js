import{useStores as e,useItems as t}from"@directus/extensions-sdk";import{ref as n,resolveComponent as l,openBlock as i,createElementBlock as o,createVNode as s,createSlots as a,withCtx as r,createElementVNode as c,toDisplayString as d,createCommentVNode as u}from"vue";const f=()=>{},p=Array.isArray,h=e=>"symbol"==typeof e;const m=e=>(e.w&_)>0,v=e=>(e.n&_)>0;let y=0,_=1;let g;class b{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,function(e,t){t&&t.active&&t.effects.push(e)}(this,n)}run(){if(!this.active)return this.fn();let e=g,t=S;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=g,g=this,S=!0,_=1<<++y,y<=30?(({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=_})(this):w(this),this.fn()}finally{y<=30&&(e=>{const{deps:t}=e;if(t.length){let n=0;for(let l=0;l<t.length;l++){const i=t[l];m(i)&&!v(i)?i.delete(e):t[n++]=i,i.w&=~_,i.n&=~_}t.length=n}})(this),_=1<<--y,g=this.parent,S=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){g===this?this.deferStop=!0:this.active&&(w(this),this.onStop&&this.onStop(),this.active=!1)}}function w(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let S=!0;function R(e,t){(e!==g||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}function D(e){const t=e&&e.__v_raw;return t?D(t):e}function T(e){S&&g&&function(e,t){let n=!1;y<=30?v(e)||(e.n|=_,n=!m(e)):n=!e.has(g),n&&(e.add(g),g.deps.push(e))}((e=D(e)).dep||(e.dep=(e=>{const t=new Set(e);return t.w=0,t.n=0,t})()))}function $(e,t){(e=D(e)).dep&&function(e,t){const n=p(e)?e:[...e];for(const e of n)e.computed&&R(e);for(const e of n)e.computed||R(e)}(e.dep)}var x;new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(h));class G{constructor(e,t,n,l){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[x]=!1,this._dirty=!0,this.effect=new b(e,(()=>{this._dirty||(this._dirty=!0,$(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!l,this.__v_isReadonly=n}get value(){const e=D(this);return T(e),!e._dirty&&e._cacheable||(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function U(e,t,n=!1){let l,i;const o="function"==typeof e;o?(l=e,i=f):(l=e.get,i=e.set);return new G(l,i,o||!i,n)}x="__v_isReadonly";var A={props:{value:{type:String,default:null},collection:{type:String},field:{type:String},fieldsToDisplay:{type:Array},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0}},emits:["navarchInput"],setup(l,{emit:i}){console.info("%cüê∞üê∞üê∞üê∞ Loading custom interface...","color:Green");const{collection:o,field:s,fieldsToDisplay:a}=l,{useRelationsStore:r}=e(),c=r().getRelationForField(o,s).related_collection,d=n(c),u=n(a),f=t(d,{fields:u}),p=n(!1),h=U((()=>{console.info("%cüê∞üê∞üê∞üê∞ Related items... %d","color:Green",f.items.value.length);for(let e=0;e<f.items.value.length;e++)console.info("%cüê∞üê∞üê∞üê∞ Related items... %s","color:Green",f.items.value[e].toString());return f.items})),m=n(null),v=U((()=>{if(!l.value)return!1;console.info("%cüê∞üê∞üê∞üê∞ Watch value changed!","color:Green")}));return{items:f,relatedCollectionRef:d,selectModalActive:p,selection:h,selected:m,onUpdate:e=>{l.value=e,console.info("%cüê∞üê∞üê∞üê∞ Emit! navarchInput: %s %s %s %s","color:Green",e,value,a[0],a[1]),i("input",e),i("navarchInput",e)},edited:v}}};A.render=function(e,t,n,f,p,h){const m=l("v-icon"),v=l("v-select");return i(),o("div",null,[s(v,{"model-value":n.value,items:f.selection.value,"item-text":n.fieldsToDisplay[0],"item-value":n.fieldsToDisplay[1],placeholder:"Select foreign relationship key","show-deselect":!0,"onUpdate:modelValue":f.onUpdate},a({_:2},[e.icon?{name:"prepend",fn:r((()=>[s(m,{name:e.icon},null,8,["name"])])),key:"0"}:void 0]),1032,["model-value","items","item-text","item-value","onUpdate:modelValue"]),c("span",null,d(n.value),1),u(' <v-input\r\n\t\t:model-value="selected"\r\n\t\t@update:model-value="onUpdate"\r\n\t\tplaceholder="To be prefilled"\r\n\t>\r\n\t</v-input> ')])},A.__file="src/interface.vue";var I={id:"navarch-dropdown-emittor",name:"Dropdown M2O Emittor",description:"$t:interfaces.select-dropdown-m2o.description",icon:"arrow_right_alt",component:A,types:["uuid","string","text","integer","bigInteger","alias"],relational:!0,localTypes:["m2o"],group:"relational",options:({relations:e})=>{var t;const n=null===(t=e.m2o)||void 0===t?void 0:t.related_collection;return[{field:"fieldsToDisplay",name:"Display Fields",meta:{interface:"system-fields",options:{collectionName:n}}},{field:"template",name:"$t:interfaces.select-dropdown-m2o.display_template",meta:{interface:"system-display-template",options:{collectionName:n}}},{field:"enableCreate",name:"$t:creating_items",schema:{default_value:!1},meta:{interface:"boolean",options:{label:"$t:enable_create_button"},width:"half"}},{field:"enableSelect",name:"$t:selecting_items",schema:{default_value:!0},meta:{interface:"boolean",options:{label:"$t:enable_select_button"},width:"half"}},{field:"filter",name:"$t:filter",type:"json",meta:{interface:"system-filter",options:{collectionName:n}}}]},recommendedDisplays:["related-values"]};export{I as default};
